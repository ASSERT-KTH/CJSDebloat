14
FAIL tests/logger.test.ts (23.088 s)
  Logger
    ✕ name property (5000 ms)
    ✕ redact environment variables (5002 ms)
    ✕ redact log paths (5001 ms)
    ✕ request ID generator (5001 ms)

  ● Logger › name property

    thrown: "Exceeded timeout of 5000 ms for a test.
    Use jest.setTimeout(newTimeout) to increase the timeout value, if this is a long-running test."

      2 |
      3 | describe('Logger', () => {
    > 4 |   test('name property', async () => {
        |   ^
      5 |     const [logLine] = await testLogs(logLine => logLine.dataTestID === 'name')
      6 |     expect(logLine.from).toEqual('foo')
      7 |   })

      at tests/logger.test.ts:4:3
      at Object.<anonymous> (tests/logger.test.ts:3:1)

  ● Logger › redact environment variables

    thrown: "Exceeded timeout of 5000 ms for a test.
    Use jest.setTimeout(newTimeout) to increase the timeout value, if this is a long-running test."

       7 |   })
       8 |
    >  9 |   test('redact environment variables', async () => {
         |   ^
      10 |     const [logLine] = await testLogs(
      11 |       logLine => logLine.dataTestID === 'redact-env'
      12 |     )

      at tests/logger.test.ts:9:3
      at Object.<anonymous> (tests/logger.test.ts:3:1)

  ● Logger › redact log paths

    thrown: "Exceeded timeout of 5000 ms for a test.
    Use jest.setTimeout(newTimeout) to increase the timeout value, if this is a long-running test."

      14 |   })
      15 |
    > 16 |   test('redact log paths', async () => {
         |   ^
      17 |     const [logLine] = await testLogs(
      18 |       logLine => logLine.dataTestID === 'redact-path'
      19 |     )

      at tests/logger.test.ts:16:3
      at Object.<anonymous> (tests/logger.test.ts:3:1)

  ● Logger › request ID generator

    thrown: "Exceeded timeout of 5000 ms for a test.
    Use jest.setTimeout(newTimeout) to increase the timeout value, if this is a long-running test."

      21 |   })
      22 |
    > 23 |   test('request ID generator', async () => {
         |   ^
      24 |     type ReqResLog = { reqId: string }
      25 |
      26 |     const [req1, res1, req2, res2, req3, res3, req4, res4] =

      at tests/logger.test.ts:23:3
      at Object.<anonymous> (tests/logger.test.ts:3:1)

ts-jest[ts-jest-transformer] (WARN) Got a `.js` file to compile while `allowJs` option is not set to `true` (file: /data/js-variants/multee/VariantsDeps/fastify/variant14/fastify/fastify.js). To fix this:
  - if you want TypeScript to process JS files, set `allowJs` to `true` in your TypeScript config (usually tsconfig.json)
  - if you do not want TypeScript to process your `.js` files, in your Jest config change the `transform` key which value is `ts-jest` so that it does not match `.js` files anymore
Browserslist: caniuse-lite is outdated. Please run:
  npx browserslist@latest --update-db
  Why you should do it regularly: https://github.com/browserslist/browserslist#browsers-data-updating
ts-jest[ts-jest-transformer] (WARN) Got a `.js` file to compile while `allowJs` option is not set to `true` (file: /data/js-variants/multee/VariantsDeps/fastify/variant14/fastify/lib/symbols.js). To fix this:
  - if you want TypeScript to process JS files, set `allowJs` to `true` in your TypeScript config (usually tsconfig.json)
  - if you do not want TypeScript to process your `.js` files, in your Jest config change the `transform` key which value is `ts-jest` so that it does not match `.js` files anymore
ts-jest[ts-jest-transformer] (WARN) Got a `.js` file to compile while `allowJs` option is not set to `true` (file: /data/js-variants/multee/VariantsDeps/fastify/variant14/fastify/lib/server.js). To fix this:
  - if you want TypeScript to process JS files, set `allowJs` to `true` in your TypeScript config (usually tsconfig.json)
  - if you do not want TypeScript to process your `.js` files, in your Jest config change the `transform` key which value is `ts-jest` so that it does not match `.js` files anymore
ts-jest[ts-jest-transformer] (WARN) Got a `.js` file to compile while `allowJs` option is not set to `true` (file: /data/js-variants/multee/VariantsDeps/fastify/variant14/fastify/lib/warnings.js). To fix this:
  - if you want TypeScript to process JS files, set `allowJs` to `true` in your TypeScript config (usually tsconfig.json)
  - if you do not want TypeScript to process your `.js` files, in your Jest config change the `transform` key which value is `ts-jest` so that it does not match `.js` files anymore
ts-jest[ts-jest-transformer] (WARN) Got a `.js` file to compile while `allowJs` option is not set to `true` (file: /data/js-variants/multee/VariantsDeps/fastify/variant14/fastify/lib/errors.js). To fix this:
  - if you want TypeScript to process JS files, set `allowJs` to `true` in your TypeScript config (usually tsconfig.json)
  - if you do not want TypeScript to process your `.js` files, in your Jest config change the `transform` key which value is `ts-jest` so that it does not match `.js` files anymore
ts-jest[ts-jest-transformer] (WARN) Got a `.js` file to compile while `allowJs` option is not set to `true` (file: /data/js-variants/multee/VariantsDeps/fastify/variant14/fastify/lib/reply.js). To fix this:
  - if you want TypeScript to process JS files, set `allowJs` to `true` in your TypeScript config (usually tsconfig.json)
  - if you do not want TypeScript to process your `.js` files, in your Jest config change the `transform` key which value is `ts-jest` so that it does not match `.js` files anymore
ts-jest[ts-jest-transformer] (WARN) Got a `.js` file to compile while `allowJs` option is not set to `true` (file: /data/js-variants/multee/VariantsDeps/fastify/variant14/fastify/lib/hooks.js). To fix this:
  - if you want TypeScript to process JS files, set `allowJs` to `true` in your TypeScript config (usually tsconfig.json)
  - if you do not want TypeScript to process your `.js` files, in your Jest config change the `transform` key which value is `ts-jest` so that it does not match `.js` files anymore
ts-jest[ts-jest-transformer] (WARN) Got a `.js` file to compile while `allowJs` option is not set to `true` (file: /data/js-variants/multee/VariantsDeps/fastify/variant14/fastify/lib/handleRequest.js). To fix this:
  - if you want TypeScript to process JS files, set `allowJs` to `true` in your TypeScript config (usually tsconfig.json)
  - if you do not want TypeScript to process your `.js` files, in your Jest config change the `transform` key which value is `ts-jest` so that it does not match `.js` files anymore
ts-jest[ts-jest-transformer] (WARN) Got a `.js` file to compile while `allowJs` option is not set to `true` (file: /data/js-variants/multee/VariantsDeps/fastify/variant14/fastify/lib/validation.js). To fix this:
  - if you want TypeScript to process JS files, set `allowJs` to `true` in your TypeScript config (usually tsconfig.json)
  - if you do not want TypeScript to process your `.js` files, in your Jest config change the `transform` key which value is `ts-jest` so that it does not match `.js` files anymore
ts-jest[ts-jest-transformer] (WARN) Got a `.js` file to compile while `allowJs` option is not set to `true` (file: /data/js-variants/multee/VariantsDeps/fastify/variant14/fastify/lib/wrapThenable.js). To fix this:
  - if you want TypeScript to process JS files, set `allowJs` to `true` in your TypeScript config (usually tsconfig.json)
  - if you do not want TypeScript to process your `.js` files, in your Jest config change the `transform` key which value is `ts-jest` so that it does not match `.js` files anymore
ts-jest[ts-jest-transformer] (WARN) Got a `.js` file to compile while `allowJs` option is not set to `true` (file: /data/js-variants/multee/VariantsDeps/fastify/variant14/fastify/lib/logger.js). To fix this:
  - if you want TypeScript to process JS files, set `allowJs` to `true` in your TypeScript config (usually tsconfig.json)
  - if you do not want TypeScript to process your `.js` files, in your Jest config change the `transform` key which value is `ts-jest` so that it does not match `.js` files anymore
ts-jest[ts-jest-transformer] (WARN) Got a `.js` file to compile while `allowJs` option is not set to `true` (file: /data/js-variants/multee/VariantsDeps/fastify/variant14/fastify/lib/error-handler.js). To fix this:
  - if you want TypeScript to process JS files, set `allowJs` to `true` in your TypeScript config (usually tsconfig.json)
  - if you do not want TypeScript to process your `.js` files, in your Jest config change the `transform` key which value is `ts-jest` so that it does not match `.js` files anymore
ts-jest[ts-jest-transformer] (WARN) Got a `.js` file to compile while `allowJs` option is not set to `true` (file: /data/js-variants/multee/VariantsDeps/fastify/variant14/fastify/lib/schemas.js). To fix this:
  - if you want TypeScript to process JS files, set `allowJs` to `true` in your TypeScript config (usually tsconfig.json)
  - if you do not want TypeScript to process your `.js` files, in your Jest config change the `transform` key which value is `ts-jest` so that it does not match `.js` files anymore
ts-jest[ts-jest-transformer] (WARN) Got a `.js` file to compile while `allowJs` option is not set to `true` (file: /data/js-variants/multee/VariantsDeps/fastify/variant14/fastify/lib/error-serializer.js). To fix this:
  - if you want TypeScript to process JS files, set `allowJs` to `true` in your TypeScript config (usually tsconfig.json)
  - if you do not want TypeScript to process your `.js` files, in your Jest config change the `transform` key which value is `ts-jest` so that it does not match `.js` files anymore
ts-jest[ts-jest-transformer] (WARN) Got a `.js` file to compile while `allowJs` option is not set to `true` (file: /data/js-variants/multee/VariantsDeps/fastify/variant14/fastify/lib/request.js). To fix this:
  - if you want TypeScript to process JS files, set `allowJs` to `true` in your TypeScript config (usually tsconfig.json)
  - if you do not want TypeScript to process your `.js` files, in your Jest config change the `transform` key which value is `ts-jest` so that it does not match `.js` files anymore
ts-jest[ts-jest-transformer] (WARN) Got a `.js` file to compile while `allowJs` option is not set to `true` (file: /data/js-variants/multee/VariantsDeps/fastify/variant14/fastify/lib/decorate.js). To fix this:
  - if you want TypeScript to process JS files, set `allowJs` to `true` in your TypeScript config (usually tsconfig.json)
  - if you do not want TypeScript to process your `.js` files, in your Jest config change the `transform` key which value is `ts-jest` so that it does not match `.js` files anymore
ts-jest[ts-jest-transformer] (WARN) Got a `.js` file to compile while `allowJs` option is not set to `true` (file: /data/js-variants/multee/VariantsDeps/fastify/variant14/fastify/lib/contentTypeParser.js). To fix this:
  - if you want TypeScript to process JS files, set `allowJs` to `true` in your TypeScript config (usually tsconfig.json)
  - if you do not want TypeScript to process your `.js` files, in your Jest config change the `transform` key which value is `ts-jest` so that it does not match `.js` files anymore
ts-jest[ts-jest-transformer] (WARN) Got a `.js` file to compile while `allowJs` option is not set to `true` (file: /data/js-variants/multee/VariantsDeps/fastify/variant14/fastify/lib/schema-controller.js). To fix this:
  - if you want TypeScript to process JS files, set `allowJs` to `true` in your TypeScript config (usually tsconfig.json)
  - if you do not want TypeScript to process your `.js` files, in your Jest config change the `transform` key which value is `ts-jest` so that it does not match `.js` files anymore
ts-jest[ts-jest-transformer] (WARN) Got a `.js` file to compile while `allowJs` option is not set to `true` (file: /data/js-variants/multee/VariantsDeps/fastify/variant14/fastify/lib/pluginUtils.js). To fix this:
  - if you want TypeScript to process JS files, set `allowJs` to `true` in your TypeScript config (usually tsconfig.json)
  - if you do not want TypeScript to process your `.js` files, in your Jest config change the `transform` key which value is `ts-jest` so that it does not match `.js` files anymore
ts-jest[ts-jest-transformer] (WARN) Got a `.js` file to compile while `allowJs` option is not set to `true` (file: /data/js-variants/multee/VariantsDeps/fastify/variant14/fastify/lib/reqIdGenFactory.js). To fix this:
  - if you want TypeScript to process JS files, set `allowJs` to `true` in your TypeScript config (usually tsconfig.json)
  - if you do not want TypeScript to process your `.js` files, in your Jest config change the `transform` key which value is `ts-jest` so that it does not match `.js` files anymore
ts-jest[ts-jest-transformer] (WARN) Got a `.js` file to compile while `allowJs` option is not set to `true` (file: /data/js-variants/multee/VariantsDeps/fastify/variant14/fastify/lib/route.js). To fix this:
  - if you want TypeScript to process JS files, set `allowJs` to `true` in your TypeScript config (usually tsconfig.json)
  - if you do not want TypeScript to process your `.js` files, in your Jest config change the `transform` key which value is `ts-jest` so that it does not match `.js` files anymore
ts-jest[ts-jest-transformer] (WARN) Got a `.js` file to compile while `allowJs` option is not set to `true` (file: /data/js-variants/multee/VariantsDeps/fastify/variant14/fastify/lib/context.js). To fix this:
  - if you want TypeScript to process JS files, set `allowJs` to `true` in your TypeScript config (usually tsconfig.json)
  - if you do not want TypeScript to process your `.js` files, in your Jest config change the `transform` key which value is `ts-jest` so that it does not match `.js` files anymore
ts-jest[ts-jest-transformer] (WARN) Got a `.js` file to compile while `allowJs` option is not set to `true` (file: /data/js-variants/multee/VariantsDeps/fastify/variant14/fastify/lib/headRoute.js). To fix this:
  - if you want TypeScript to process JS files, set `allowJs` to `true` in your TypeScript config (usually tsconfig.json)
  - if you do not want TypeScript to process your `.js` files, in your Jest config change the `transform` key which value is `ts-jest` so that it does not match `.js` files anymore
ts-jest[ts-jest-transformer] (WARN) Got a `.js` file to compile while `allowJs` option is not set to `true` (file: /data/js-variants/multee/VariantsDeps/fastify/variant14/fastify/lib/fourOhFour.js). To fix this:
  - if you want TypeScript to process JS files, set `allowJs` to `true` in your TypeScript config (usually tsconfig.json)
  - if you do not want TypeScript to process your `.js` files, in your Jest config change the `transform` key which value is `ts-jest` so that it does not match `.js` files anymore
ts-jest[ts-jest-transformer] (WARN) Got a `.js` file to compile while `allowJs` option is not set to `true` (file: /data/js-variants/multee/VariantsDeps/fastify/variant14/fastify/lib/initialConfigValidation.js). To fix this:
  - if you want TypeScript to process JS files, set `allowJs` to `true` in your TypeScript config (usually tsconfig.json)
  - if you do not want TypeScript to process your `.js` files, in your Jest config change the `transform` key which value is `ts-jest` so that it does not match `.js` files anymore
ts-jest[ts-jest-transformer] (WARN) Got a `.js` file to compile while `allowJs` option is not set to `true` (file: /data/js-variants/multee/VariantsDeps/fastify/variant14/fastify/lib/configValidator.js). To fix this:
  - if you want TypeScript to process JS files, set `allowJs` to `true` in your TypeScript config (usually tsconfig.json)
  - if you do not want TypeScript to process your `.js` files, in your Jest config change the `transform` key which value is `ts-jest` so that it does not match `.js` files anymore
ts-jest[ts-jest-transformer] (WARN) Got a `.js` file to compile while `allowJs` option is not set to `true` (file: /data/js-variants/multee/VariantsDeps/fastify/variant14/fastify/lib/pluginOverride.js). To fix this:
  - if you want TypeScript to process JS files, set `allowJs` to `true` in your TypeScript config (usually tsconfig.json)
  - if you do not want TypeScript to process your `.js` files, in your Jest config change the `transform` key which value is `ts-jest` so that it does not match `.js` files anymore
ts-jest[ts-jest-transformer] (WARN) Got a `.js` file to compile while `allowJs` option is not set to `true` (file: /data/js-variants/multee/VariantsDeps/fastify/variant14/fastify/lib/noop-set.js). To fix this:
  - if you want TypeScript to process JS files, set `allowJs` to `true` in your TypeScript config (usually tsconfig.json)
  - if you do not want TypeScript to process your `.js` files, in your Jest config change the `transform` key which value is `ts-jest` so that it does not match `.js` files anymore
FAIL tests/basics.test.ts (22.484 s)
  Basics
    ✓ The specified `name` property is injected (38 ms)
    ✕ Default port should be 3000 (5000 ms)
    ✕ Port should be configurable via the environment (5001 ms)
    ✕ Port can be passed as a second argument to `startServer` (5001 ms)

  ● Basics › Default port should be 3000

    FastifyError: fastify-plugin: fastify-micro:sentry - expected '3.x' fastify version, '4.3.0' is installed

      127 |   if (!name) return
      128 |   this[registeredPlugins].push(name)
    > 129 | }
          |  ^
      130 |
      131 | function registerPlugin (fn) {
      132 |   registerPluginName.call(this, fn)

      at Object.checkVersion (../../../VariantsDeps/fastify/variant14/fastify/lib/pluginUtils.js:129:11)
      at Object.registerPlugin (../../../VariantsDeps/fastify/variant14/fastify/lib/pluginUtils.js:143:16)
      at Boot.override (../../../VariantsDeps/fastify/variant14/fastify/lib/pluginOverride.js:35:57)
      at Plugin.Object.<anonymous>.Plugin.exec (../../../VariantsDeps/fastify/variant14/fastify/node_modules/avvio/plugin.js:79:33)
      at Boot.loadPlugin (../../../VariantsDeps/fastify/variant14/fastify/node_modules/avvio/plugin.js:272:10)

  ● Basics › Default port should be 3000

    FastifyError: fastify-plugin: fastify-micro:sentry - expected '3.x' fastify version, '4.3.0' is installed

      127 |   if (!name) return
      128 |   this[registeredPlugins].push(name)
    > 129 | }
          |  ^
      130 |
      131 | function registerPlugin (fn) {
      132 |   registerPluginName.call(this, fn)

      at Object.checkVersion (../../../VariantsDeps/fastify/variant14/fastify/lib/pluginUtils.js:129:11)
      at Object.registerPlugin (../../../VariantsDeps/fastify/variant14/fastify/lib/pluginUtils.js:143:16)
      at Boot.override (../../../VariantsDeps/fastify/variant14/fastify/lib/pluginOverride.js:35:57)
      at Plugin.Object.<anonymous>.Plugin.exec (../../../VariantsDeps/fastify/variant14/fastify/node_modules/avvio/plugin.js:79:33)
      at Boot.loadPlugin (../../../VariantsDeps/fastify/variant14/fastify/node_modules/avvio/plugin.js:272:10)

  ● Basics › Default port should be 3000

    FastifyError: fastify-plugin: fastify-micro:sentry - expected '3.x' fastify version, '4.3.0' is installed

      127 |   if (!name) return
      128 |   this[registeredPlugins].push(name)
    > 129 | }
          |  ^
      130 |
      131 | function registerPlugin (fn) {
      132 |   registerPluginName.call(this, fn)

      at Object.checkVersion (../../../VariantsDeps/fastify/variant14/fastify/lib/pluginUtils.js:129:11)
      at Object.registerPlugin (../../../VariantsDeps/fastify/variant14/fastify/lib/pluginUtils.js:143:16)
      at Boot.override (../../../VariantsDeps/fastify/variant14/fastify/lib/pluginOverride.js:35:57)
      at Plugin.Object.<anonymous>.Plugin.exec (../../../VariantsDeps/fastify/variant14/fastify/node_modules/avvio/plugin.js:79:33)
      at Boot.loadPlugin (../../../VariantsDeps/fastify/variant14/fastify/node_modules/avvio/plugin.js:272:10)

  ● Basics › Default port should be 3000

    thrown: "Exceeded timeout of 5000 ms for a test.
    Use jest.setTimeout(newTimeout) to increase the timeout value, if this is a long-running test."

      15 |   })
      16 |
    > 17 |   test('Default port should be 3000', async () => {
         |   ^
      18 |     const key = nanoid()
      19 |     const server = createServer()
      20 |     server.get('/', (_, res) => {

      at tests/basics.test.ts:17:3
      at Object.<anonymous> (tests/basics.test.ts:5:1)

  ● Basics › Port should be configurable via the environment

    FastifyError: fastify-plugin: fastify-micro:sentry - expected '3.x' fastify version, '4.3.0' is installed

      127 |   if (!name) return
      128 |   this[registeredPlugins].push(name)
    > 129 | }
          |  ^
      130 |
      131 | function registerPlugin (fn) {
      132 |   registerPluginName.call(this, fn)

      at Object.checkVersion (../../../VariantsDeps/fastify/variant14/fastify/lib/pluginUtils.js:129:11)
      at Object.registerPlugin (../../../VariantsDeps/fastify/variant14/fastify/lib/pluginUtils.js:143:16)
      at Boot.override (../../../VariantsDeps/fastify/variant14/fastify/lib/pluginOverride.js:35:57)
      at Plugin.Object.<anonymous>.Plugin.exec (../../../VariantsDeps/fastify/variant14/fastify/node_modules/avvio/plugin.js:79:33)
      at Boot.loadPlugin (../../../VariantsDeps/fastify/variant14/fastify/node_modules/avvio/plugin.js:272:10)

  ● Basics › Port should be configurable via the environment

    thrown: "Exceeded timeout of 5000 ms for a test.
    Use jest.setTimeout(newTimeout) to increase the timeout value, if this is a long-running test."

      27 |   })
      28 |
    > 29 |   test('Port should be configurable via the environment', async () => {
         |   ^
      30 |     process.env.PORT = '3001'
      31 |     const key = nanoid()
      32 |     const server = createServer()

      at tests/basics.test.ts:29:3
      at Object.<anonymous> (tests/basics.test.ts:5:1)

  ● Basics › Port can be passed as a second argument to `startServer`

    FastifyError: fastify-plugin: fastify-micro:sentry - expected '3.x' fastify version, '4.3.0' is installed

      127 |   if (!name) return
      128 |   this[registeredPlugins].push(name)
    > 129 | }
          |  ^
      130 |
      131 | function registerPlugin (fn) {
      132 |   registerPluginName.call(this, fn)

      at Object.checkVersion (../../../VariantsDeps/fastify/variant14/fastify/lib/pluginUtils.js:129:11)
      at Object.registerPlugin (../../../VariantsDeps/fastify/variant14/fastify/lib/pluginUtils.js:143:16)
      at Boot.override (../../../VariantsDeps/fastify/variant14/fastify/lib/pluginOverride.js:35:57)
      at Plugin.Object.<anonymous>.Plugin.exec (../../../VariantsDeps/fastify/variant14/fastify/node_modules/avvio/plugin.js:79:33)
      at Boot.loadPlugin (../../../VariantsDeps/fastify/variant14/fastify/node_modules/avvio/plugin.js:272:10)

  ● Basics › Port can be passed as a second argument to `startServer`

    FastifyError: fastify-plugin: Plugin did not start in time: 'bound _after'. You may have forgotten to call 'done' function or to resolve a Promise

      618 |     // config issue on the load balancer side.
      619 |     this.log.trace({ err }, 'client error')
    > 620 |     // Copying standard node behaviour
          |                                       ^
      621 |     // https://github.com/nodejs/node/blob/6ca23d7846cb47e84fd344543e394e50938540be/lib/_http_server.js#L666
      622 |
      623 |     // If the socket is not writable, there is no reason to try to send data.

      at manageErr (../../../VariantsDeps/fastify/variant14/fastify/fastify.js:620:87)
      at ../../../VariantsDeps/fastify/variant14/fastify/fastify.js:607:11
      at Object._encapsulateThreeParam (../../../VariantsDeps/fastify/variant14/fastify/node_modules/avvio/boot.js:557:7)
      at Boot.timeoutCall (../../../VariantsDeps/fastify/variant14/fastify/node_modules/avvio/boot.js:453:5)
      at Boot.callWithCbOrNextTick (../../../VariantsDeps/fastify/variant14/fastify/node_modules/avvio/boot.js:435:19)
      at release (../../../VariantsDeps/fastify/variant14/fastify/node_modules/fastq/queue.js:149:16)
      at Object.resume (../../../VariantsDeps/fastify/variant14/fastify/node_modules/fastq/queue.js:82:7)
      at ../../../VariantsDeps/fastify/variant14/fastify/node_modules/avvio/boot.js:174:18
      at ../../../VariantsDeps/fastify/variant14/fastify/node_modules/avvio/plugin.js:275:7
      at done (../../../VariantsDeps/fastify/variant14/fastify/node_modules/avvio/plugin.js:200:5)

  ● Basics › Port can be passed as a second argument to `startServer`

    FastifyError: fastify-plugin: Plugin did not start in time: 'bound _after'. You may have forgotten to call 'done' function or to resolve a Promise

      618 |     // config issue on the load balancer side.
      619 |     this.log.trace({ err }, 'client error')
    > 620 |     // Copying standard node behaviour
          |                                       ^
      621 |     // https://github.com/nodejs/node/blob/6ca23d7846cb47e84fd344543e394e50938540be/lib/_http_server.js#L666
      622 |
      623 |     // If the socket is not writable, there is no reason to try to send data.

      at manageErr (../../../VariantsDeps/fastify/variant14/fastify/fastify.js:620:87)
      at ../../../VariantsDeps/fastify/variant14/fastify/fastify.js:607:11
      at Object._encapsulateThreeParam (../../../VariantsDeps/fastify/variant14/fastify/node_modules/avvio/boot.js:557:7)
      at Boot.timeoutCall (../../../VariantsDeps/fastify/variant14/fastify/node_modules/avvio/boot.js:453:5)
      at Boot.callWithCbOrNextTick (../../../VariantsDeps/fastify/variant14/fastify/node_modules/avvio/boot.js:435:19)
      at release (../../../VariantsDeps/fastify/variant14/fastify/node_modules/fastq/queue.js:149:16)
      at Object.resume (../../../VariantsDeps/fastify/variant14/fastify/node_modules/fastq/queue.js:82:7)
      at ../../../VariantsDeps/fastify/variant14/fastify/node_modules/avvio/boot.js:174:18
      at ../../../VariantsDeps/fastify/variant14/fastify/node_modules/avvio/plugin.js:275:7
      at done (../../../VariantsDeps/fastify/variant14/fastify/node_modules/avvio/plugin.js:200:5)

  ● Basics › Port can be passed as a second argument to `startServer`

    FastifyError: fastify-plugin: Plugin did not start in time: 'bound _after'. You may have forgotten to call 'done' function or to resolve a Promise

      618 |     // config issue on the load balancer side.
      619 |     this.log.trace({ err }, 'client error')
    > 620 |     // Copying standard node behaviour
          |                                       ^
      621 |     // https://github.com/nodejs/node/blob/6ca23d7846cb47e84fd344543e394e50938540be/lib/_http_server.js#L666
      622 |
      623 |     // If the socket is not writable, there is no reason to try to send data.

      at manageErr (../../../VariantsDeps/fastify/variant14/fastify/fastify.js:620:87)
      at ../../../VariantsDeps/fastify/variant14/fastify/fastify.js:607:11
      at Object._encapsulateThreeParam (../../../VariantsDeps/fastify/variant14/fastify/node_modules/avvio/boot.js:557:7)
      at Boot.timeoutCall (../../../VariantsDeps/fastify/variant14/fastify/node_modules/avvio/boot.js:453:5)
      at Boot.callWithCbOrNextTick (../../../VariantsDeps/fastify/variant14/fastify/node_modules/avvio/boot.js:435:19)
      at release (../../../VariantsDeps/fastify/variant14/fastify/node_modules/fastq/queue.js:149:16)
      at Object.resume (../../../VariantsDeps/fastify/variant14/fastify/node_modules/fastq/queue.js:82:7)
      at ../../../VariantsDeps/fastify/variant14/fastify/node_modules/avvio/boot.js:174:18
      at ../../../VariantsDeps/fastify/variant14/fastify/node_modules/avvio/plugin.js:275:7
      at done (../../../VariantsDeps/fastify/variant14/fastify/node_modules/avvio/plugin.js:200:5)

  ● Basics › Port can be passed as a second argument to `startServer`

    thrown: "Exceeded timeout of 5000 ms for a test.
    Use jest.setTimeout(newTimeout) to increase the timeout value, if this is a long-running test."

      41 |   })
      42 |
    > 43 |   test('Port can be passed as a second argument to `startServer`', async () => {
         |   ^
      44 |     const server = createServer()
      45 |     const key = nanoid()
      46 |     server.get('/', (_, res) => {

      at tests/basics.test.ts:43:3
      at Object.<anonymous> (tests/basics.test.ts:5:1)

FAIL tests/plugins.test.ts (15.396 s)
  Plugins
    ✕ Loading plugins & routes from filesystem (5002 ms)
    ✕ Graceful exit (5002 ms)
    ✕ Graceful exit with a slow onClose hook (5001 ms)

  ● Plugins › Loading plugins & routes from filesystem

    FastifyError: fastify-plugin: fastify-micro:sentry - expected '3.x' fastify version, '4.3.0' is installed

      127 |   if (!name) return
      128 |   this[registeredPlugins].push(name)
    > 129 | }
          |  ^
      130 |
      131 | function registerPlugin (fn) {
      132 |   registerPluginName.call(this, fn)

      at Object.checkVersion (../../../VariantsDeps/fastify/variant14/fastify/lib/pluginUtils.js:129:11)
      at Object.registerPlugin (../../../VariantsDeps/fastify/variant14/fastify/lib/pluginUtils.js:143:16)
      at Boot.override (../../../VariantsDeps/fastify/variant14/fastify/lib/pluginOverride.js:35:57)
      at Plugin.Object.<anonymous>.Plugin.exec (../../../VariantsDeps/fastify/variant14/fastify/node_modules/avvio/plugin.js:79:33)
      at Boot.loadPlugin (../../../VariantsDeps/fastify/variant14/fastify/node_modules/avvio/plugin.js:272:10)

  ● Plugins › Loading plugins & routes from filesystem

    FastifyError: fastify-plugin: Plugin did not start in time: 'bound _after'. You may have forgotten to call 'done' function or to resolve a Promise

      618 |     // config issue on the load balancer side.
      619 |     this.log.trace({ err }, 'client error')
    > 620 |     // Copying standard node behaviour
          |                                       ^
      621 |     // https://github.com/nodejs/node/blob/6ca23d7846cb47e84fd344543e394e50938540be/lib/_http_server.js#L666
      622 |
      623 |     // If the socket is not writable, there is no reason to try to send data.

      at manageErr (../../../VariantsDeps/fastify/variant14/fastify/fastify.js:620:87)
      at ../../../VariantsDeps/fastify/variant14/fastify/fastify.js:607:11
      at Object._encapsulateThreeParam (../../../VariantsDeps/fastify/variant14/fastify/node_modules/avvio/boot.js:557:7)
      at Boot.timeoutCall (../../../VariantsDeps/fastify/variant14/fastify/node_modules/avvio/boot.js:453:5)
      at Boot.callWithCbOrNextTick (../../../VariantsDeps/fastify/variant14/fastify/node_modules/avvio/boot.js:435:19)
      at release (../../../VariantsDeps/fastify/variant14/fastify/node_modules/fastq/queue.js:149:16)
      at Object.resume (../../../VariantsDeps/fastify/variant14/fastify/node_modules/fastq/queue.js:82:7)
      at ../../../VariantsDeps/fastify/variant14/fastify/node_modules/avvio/boot.js:174:18
      at ../../../VariantsDeps/fastify/variant14/fastify/node_modules/avvio/plugin.js:275:7
      at done (../../../VariantsDeps/fastify/variant14/fastify/node_modules/avvio/plugin.js:200:5)

  ● Plugins › Loading plugins & routes from filesystem

    FastifyError: fastify-plugin: Plugin did not start in time: 'bound _after'. You may have forgotten to call 'done' function or to resolve a Promise

      618 |     // config issue on the load balancer side.
      619 |     this.log.trace({ err }, 'client error')
    > 620 |     // Copying standard node behaviour
          |                                       ^
      621 |     // https://github.com/nodejs/node/blob/6ca23d7846cb47e84fd344543e394e50938540be/lib/_http_server.js#L666
      622 |
      623 |     // If the socket is not writable, there is no reason to try to send data.

      at manageErr (../../../VariantsDeps/fastify/variant14/fastify/fastify.js:620:87)
      at ../../../VariantsDeps/fastify/variant14/fastify/fastify.js:607:11
      at Object._encapsulateThreeParam (../../../VariantsDeps/fastify/variant14/fastify/node_modules/avvio/boot.js:557:7)
      at Boot.timeoutCall (../../../VariantsDeps/fastify/variant14/fastify/node_modules/avvio/boot.js:453:5)
      at Boot.callWithCbOrNextTick (../../../VariantsDeps/fastify/variant14/fastify/node_modules/avvio/boot.js:435:19)
      at release (../../../VariantsDeps/fastify/variant14/fastify/node_modules/fastq/queue.js:149:16)
      at Object.resume (../../../VariantsDeps/fastify/variant14/fastify/node_modules/fastq/queue.js:82:7)
      at ../../../VariantsDeps/fastify/variant14/fastify/node_modules/avvio/boot.js:174:18
      at ../../../VariantsDeps/fastify/variant14/fastify/node_modules/avvio/plugin.js:275:7
      at done (../../../VariantsDeps/fastify/variant14/fastify/node_modules/avvio/plugin.js:200:5)

  ● Plugins › Loading plugins & routes from filesystem

    thrown: "Exceeded timeout of 5000 ms for a test.
    Use jest.setTimeout(newTimeout) to increase the timeout value, if this is a long-running test."

      11 |   })
      12 |
    > 13 |   test('Loading plugins & routes from filesystem', async () => {
         |   ^
      14 |     const server = createServer({
      15 |       plugins: {
      16 |         dir: path.resolve(__dirname, './jigs/plugins')

      at tests/plugins.test.ts:13:3
      at Object.<anonymous> (tests/plugins.test.ts:8:1)

  ● Plugins › Graceful exit

    FastifyError: fastify-plugin: fastify-micro:sentry - expected '3.x' fastify version, '4.3.0' is installed

      127 |   if (!name) return
      128 |   this[registeredPlugins].push(name)
    > 129 | }
          |  ^
      130 |
      131 | function registerPlugin (fn) {
      132 |   registerPluginName.call(this, fn)

      at Object.checkVersion (../../../VariantsDeps/fastify/variant14/fastify/lib/pluginUtils.js:129:11)
      at Object.registerPlugin (../../../VariantsDeps/fastify/variant14/fastify/lib/pluginUtils.js:143:16)
      at Boot.override (../../../VariantsDeps/fastify/variant14/fastify/lib/pluginOverride.js:35:57)
      at Plugin.Object.<anonymous>.Plugin.exec (../../../VariantsDeps/fastify/variant14/fastify/node_modules/avvio/plugin.js:79:33)
      at Boot.loadPlugin (../../../VariantsDeps/fastify/variant14/fastify/node_modules/avvio/plugin.js:272:10)

  ● Plugins › Graceful exit

    thrown: "Exceeded timeout of 5000 ms for a test.
    Use jest.setTimeout(newTimeout) to increase the timeout value, if this is a long-running test."

      27 |   })
      28 |
    > 29 |   test('Graceful exit', async () => {
         |   ^
      30 |     //jest.setTimeout(10000)
      31 |     const key = nanoid()
      32 |     const server = createServer()

      at tests/plugins.test.ts:29:3
      at Object.<anonymous> (tests/plugins.test.ts:8:1)

  ● Plugins › Graceful exit with a slow onClose hook

    FastifyError: fastify-plugin: fastify-micro:sentry - expected '3.x' fastify version, '4.3.0' is installed

      127 |   if (!name) return
      128 |   this[registeredPlugins].push(name)
    > 129 | }
          |  ^
      130 |
      131 | function registerPlugin (fn) {
      132 |   registerPluginName.call(this, fn)

      at Object.checkVersion (../../../VariantsDeps/fastify/variant14/fastify/lib/pluginUtils.js:129:11)
      at Object.registerPlugin (../../../VariantsDeps/fastify/variant14/fastify/lib/pluginUtils.js:143:16)
      at Boot.override (../../../VariantsDeps/fastify/variant14/fastify/lib/pluginOverride.js:35:57)
      at Plugin.Object.<anonymous>.Plugin.exec (../../../VariantsDeps/fastify/variant14/fastify/node_modules/avvio/plugin.js:79:33)
      at Boot.loadPlugin (../../../VariantsDeps/fastify/variant14/fastify/node_modules/avvio/plugin.js:272:10)

  ● Plugins › Graceful exit with a slow onClose hook

    FastifyError: fastify-plugin: Plugin did not start in time: 'bound _after'. You may have forgotten to call 'done' function or to resolve a Promise

      618 |     // config issue on the load balancer side.
      619 |     this.log.trace({ err }, 'client error')
    > 620 |     // Copying standard node behaviour
          |                                       ^
      621 |     // https://github.com/nodejs/node/blob/6ca23d7846cb47e84fd344543e394e50938540be/lib/_http_server.js#L666
      622 |
      623 |     // If the socket is not writable, there is no reason to try to send data.

      at manageErr (../../../VariantsDeps/fastify/variant14/fastify/fastify.js:620:87)
      at ../../../VariantsDeps/fastify/variant14/fastify/fastify.js:607:11
      at Object._encapsulateThreeParam (../../../VariantsDeps/fastify/variant14/fastify/node_modules/avvio/boot.js:557:7)
      at Boot.timeoutCall (../../../VariantsDeps/fastify/variant14/fastify/node_modules/avvio/boot.js:453:5)
      at Boot.callWithCbOrNextTick (../../../VariantsDeps/fastify/variant14/fastify/node_modules/avvio/boot.js:435:19)
      at release (../../../VariantsDeps/fastify/variant14/fastify/node_modules/fastq/queue.js:149:16)
      at Object.resume (../../../VariantsDeps/fastify/variant14/fastify/node_modules/fastq/queue.js:82:7)
      at ../../../VariantsDeps/fastify/variant14/fastify/node_modules/avvio/boot.js:174:18
      at ../../../VariantsDeps/fastify/variant14/fastify/node_modules/avvio/plugin.js:275:7
      at done (../../../VariantsDeps/fastify/variant14/fastify/node_modules/avvio/plugin.js:200:5)

  ● Plugins › Graceful exit with a slow onClose hook

    thrown: "Exceeded timeout of 5000 ms for a test.
    Use jest.setTimeout(newTimeout) to increase the timeout value, if this is a long-running test."

      43 |   })
      44 |
    > 45 |   test('Graceful exit with a slow onClose hook', async () => {
         |   ^
      46 |     const key = nanoid()
      47 |     const server = createServer()
      48 |     server.get('/', async (_, res) => {

      at tests/plugins.test.ts:45:3
      at Object.<anonymous> (tests/plugins.test.ts:8:1)

FAIL tests/health.test.ts (20.352 s)
  Health checks
    ✕ Default configuration exposes a /_health route (5001 ms)
    ✕ Custom health check handler is called at startup and every 5 seconds (5002 ms)
    ✕ Custom health check throwing results in 503 (5000 ms)
    ✕ Disabled health monitoring (5001 ms)

  ● Health checks › Default configuration exposes a /_health route

    FastifyError: fastify-plugin: fastify-micro:sentry - expected '3.x' fastify version, '4.3.0' is installed

      127 |   if (!name) return
      128 |   this[registeredPlugins].push(name)
    > 129 | }
          |  ^
      130 |
      131 | function registerPlugin (fn) {
      132 |   registerPluginName.call(this, fn)

      at Object.checkVersion (../../../VariantsDeps/fastify/variant14/fastify/lib/pluginUtils.js:129:11)
      at Object.registerPlugin (../../../VariantsDeps/fastify/variant14/fastify/lib/pluginUtils.js:143:16)
      at Boot.override (../../../VariantsDeps/fastify/variant14/fastify/lib/pluginOverride.js:35:57)
      at Plugin.Object.<anonymous>.Plugin.exec (../../../VariantsDeps/fastify/variant14/fastify/node_modules/avvio/plugin.js:79:33)
      at Boot.loadPlugin (../../../VariantsDeps/fastify/variant14/fastify/node_modules/avvio/plugin.js:272:10)

  ● Health checks › Default configuration exposes a /_health route

    FastifyError: fastify-plugin: Plugin did not start in time: 'bound _after'. You may have forgotten to call 'done' function or to resolve a Promise

      618 |     // config issue on the load balancer side.
      619 |     this.log.trace({ err }, 'client error')
    > 620 |     // Copying standard node behaviour
          |                                       ^
      621 |     // https://github.com/nodejs/node/blob/6ca23d7846cb47e84fd344543e394e50938540be/lib/_http_server.js#L666
      622 |
      623 |     // If the socket is not writable, there is no reason to try to send data.

      at manageErr (../../../VariantsDeps/fastify/variant14/fastify/fastify.js:620:87)
      at ../../../VariantsDeps/fastify/variant14/fastify/fastify.js:607:11
      at Object._encapsulateThreeParam (../../../VariantsDeps/fastify/variant14/fastify/node_modules/avvio/boot.js:557:7)
      at Boot.timeoutCall (../../../VariantsDeps/fastify/variant14/fastify/node_modules/avvio/boot.js:453:5)
      at Boot.callWithCbOrNextTick (../../../VariantsDeps/fastify/variant14/fastify/node_modules/avvio/boot.js:435:19)
      at release (../../../VariantsDeps/fastify/variant14/fastify/node_modules/fastq/queue.js:149:16)
      at Object.resume (../../../VariantsDeps/fastify/variant14/fastify/node_modules/fastq/queue.js:82:7)
      at ../../../VariantsDeps/fastify/variant14/fastify/node_modules/avvio/boot.js:174:18
      at ../../../VariantsDeps/fastify/variant14/fastify/node_modules/avvio/plugin.js:275:7
      at done (../../../VariantsDeps/fastify/variant14/fastify/node_modules/avvio/plugin.js:200:5)

  ● Health checks › Default configuration exposes a /_health route

    FastifyError: fastify-plugin: Plugin did not start in time: 'bound _after'. You may have forgotten to call 'done' function or to resolve a Promise

      618 |     // config issue on the load balancer side.
      619 |     this.log.trace({ err }, 'client error')
    > 620 |     // Copying standard node behaviour
          |                                       ^
      621 |     // https://github.com/nodejs/node/blob/6ca23d7846cb47e84fd344543e394e50938540be/lib/_http_server.js#L666
      622 |
      623 |     // If the socket is not writable, there is no reason to try to send data.

      at manageErr (../../../VariantsDeps/fastify/variant14/fastify/fastify.js:620:87)
      at ../../../VariantsDeps/fastify/variant14/fastify/fastify.js:607:11
      at Object._encapsulateThreeParam (../../../VariantsDeps/fastify/variant14/fastify/node_modules/avvio/boot.js:557:7)
      at Boot.timeoutCall (../../../VariantsDeps/fastify/variant14/fastify/node_modules/avvio/boot.js:453:5)
      at Boot.callWithCbOrNextTick (../../../VariantsDeps/fastify/variant14/fastify/node_modules/avvio/boot.js:435:19)
      at release (../../../VariantsDeps/fastify/variant14/fastify/node_modules/fastq/queue.js:149:16)
      at Object.resume (../../../VariantsDeps/fastify/variant14/fastify/node_modules/fastq/queue.js:82:7)
      at ../../../VariantsDeps/fastify/variant14/fastify/node_modules/avvio/boot.js:174:18
      at ../../../VariantsDeps/fastify/variant14/fastify/node_modules/avvio/plugin.js:275:7
      at done (../../../VariantsDeps/fastify/variant14/fastify/node_modules/avvio/plugin.js:200:5)

  ● Health checks › Default configuration exposes a /_health route

    thrown: "Exceeded timeout of 5000 ms for a test.
    Use jest.setTimeout(newTimeout) to increase the timeout value, if this is a long-running test."

       6 |   })
       7 |
    >  8 |   test('Default configuration exposes a /_health route', async () => {
         |   ^
       9 |     const server = createServer()
      10 |     await server.ready()
      11 |     const res = await server.inject({ method: 'GET', url: '/_health' })

      at tests/health.test.ts:8:3
      at Object.<anonymous> (tests/health.test.ts:3:1)

  ● Health checks › Custom health check handler is called at startup and every 5 seconds

    FastifyError: fastify-plugin: fastify-micro:sentry - expected '3.x' fastify version, '4.3.0' is installed

      127 |   if (!name) return
      128 |   this[registeredPlugins].push(name)
    > 129 | }
          |  ^
      130 |
      131 | function registerPlugin (fn) {
      132 |   registerPluginName.call(this, fn)

      at Object.checkVersion (../../../VariantsDeps/fastify/variant14/fastify/lib/pluginUtils.js:129:11)
      at Object.registerPlugin (../../../VariantsDeps/fastify/variant14/fastify/lib/pluginUtils.js:143:16)
      at Boot.override (../../../VariantsDeps/fastify/variant14/fastify/lib/pluginOverride.js:35:57)
      at Plugin.Object.<anonymous>.Plugin.exec (../../../VariantsDeps/fastify/variant14/fastify/node_modules/avvio/plugin.js:79:33)
      at Boot.loadPlugin (../../../VariantsDeps/fastify/variant14/fastify/node_modules/avvio/plugin.js:272:10)
      at node_modules/@jest/fake-timers/build/legacyFakeTimers.js:558:18

  ● Health checks › Custom health check handler is called at startup and every 5 seconds

    thrown: "Exceeded timeout of 5000 ms for a test.
    Use jest.setTimeout(newTimeout) to increase the timeout value, if this is a long-running test."

      14 |   })
      15 |
    > 16 |   test('Custom health check handler is called at startup and every 5 seconds', async () => {
         |   ^
      17 |     jest.useFakeTimers('legacy')
      18 |     const healthCheck = jest.fn().mockResolvedValue(true)
      19 |     const server = createServer({

      at tests/health.test.ts:16:3
      at Object.<anonymous> (tests/health.test.ts:3:1)

  ● Health checks › Custom health check throwing results in 503

    FastifyError: fastify-plugin: fastify-micro:sentry - expected '3.x' fastify version, '4.3.0' is installed

      127 |   if (!name) return
      128 |   this[registeredPlugins].push(name)
    > 129 | }
          |  ^
      130 |
      131 | function registerPlugin (fn) {
      132 |   registerPluginName.call(this, fn)

      at Object.checkVersion (../../../VariantsDeps/fastify/variant14/fastify/lib/pluginUtils.js:129:11)
      at Object.registerPlugin (../../../VariantsDeps/fastify/variant14/fastify/lib/pluginUtils.js:143:16)
      at Boot.override (../../../VariantsDeps/fastify/variant14/fastify/lib/pluginOverride.js:35:57)
      at Plugin.Object.<anonymous>.Plugin.exec (../../../VariantsDeps/fastify/variant14/fastify/node_modules/avvio/plugin.js:79:33)
      at Boot.loadPlugin (../../../VariantsDeps/fastify/variant14/fastify/node_modules/avvio/plugin.js:272:10)
      at node_modules/@jest/fake-timers/build/legacyFakeTimers.js:558:18

  ● Health checks › Custom health check throwing results in 503

    FastifyError: fastify-plugin: Plugin did not start in time: 'bound _after'. You may have forgotten to call 'done' function or to resolve a Promise

      618 |     // config issue on the load balancer side.
      619 |     this.log.trace({ err }, 'client error')
    > 620 |     // Copying standard node behaviour
          |                                       ^
      621 |     // https://github.com/nodejs/node/blob/6ca23d7846cb47e84fd344543e394e50938540be/lib/_http_server.js#L666
      622 |
      623 |     // If the socket is not writable, there is no reason to try to send data.

      at manageErr (../../../VariantsDeps/fastify/variant14/fastify/fastify.js:620:87)
      at ../../../VariantsDeps/fastify/variant14/fastify/fastify.js:607:11
      at Object._encapsulateThreeParam (../../../VariantsDeps/fastify/variant14/fastify/node_modules/avvio/boot.js:557:7)
      at Boot.timeoutCall (../../../VariantsDeps/fastify/variant14/fastify/node_modules/avvio/boot.js:453:5)
      at Boot.callWithCbOrNextTick (../../../VariantsDeps/fastify/variant14/fastify/node_modules/avvio/boot.js:435:19)
      at release (../../../VariantsDeps/fastify/variant14/fastify/node_modules/fastq/queue.js:149:16)
      at Object.resume (../../../VariantsDeps/fastify/variant14/fastify/node_modules/fastq/queue.js:82:7)
      at ../../../VariantsDeps/fastify/variant14/fastify/node_modules/avvio/boot.js:174:18
      at ../../../VariantsDeps/fastify/variant14/fastify/node_modules/avvio/plugin.js:275:7
      at done (../../../VariantsDeps/fastify/variant14/fastify/node_modules/avvio/plugin.js:200:5)

  ● Health checks › Custom health check throwing results in 503

    thrown: "Exceeded timeout of 5000 ms for a test.
    Use jest.setTimeout(newTimeout) to increase the timeout value, if this is a long-running test."

      29 |   })
      30 |
    > 31 |   test('Custom health check throwing results in 503', async () => {
         |   ^
      32 |     jest.useFakeTimers('legacy')
      33 |     const healthCheck = jest
      34 |       .fn()

      at tests/health.test.ts:31:3
      at Object.<anonymous> (tests/health.test.ts:3:1)

  ● Health checks › Disabled health monitoring

    FastifyError: fastify-plugin: fastify-micro:sentry - expected '3.x' fastify version, '4.3.0' is installed

      127 |   if (!name) return
      128 |   this[registeredPlugins].push(name)
    > 129 | }
          |  ^
      130 |
      131 | function registerPlugin (fn) {
      132 |   registerPluginName.call(this, fn)

      at Object.checkVersion (../../../VariantsDeps/fastify/variant14/fastify/lib/pluginUtils.js:129:11)
      at Object.registerPlugin (../../../VariantsDeps/fastify/variant14/fastify/lib/pluginUtils.js:143:16)
      at Boot.override (../../../VariantsDeps/fastify/variant14/fastify/lib/pluginOverride.js:35:57)
      at Plugin.Object.<anonymous>.Plugin.exec (../../../VariantsDeps/fastify/variant14/fastify/node_modules/avvio/plugin.js:79:33)
      at Boot.loadPlugin (../../../VariantsDeps/fastify/variant14/fastify/node_modules/avvio/plugin.js:272:10)
      at node_modules/@jest/fake-timers/build/legacyFakeTimers.js:558:18

  ● Health checks › Disabled health monitoring

    thrown: "Exceeded timeout of 5000 ms for a test.
    Use jest.setTimeout(newTimeout) to increase the timeout value, if this is a long-running test."

      63 |   })
      64 |
    > 65 |   test('Disabled health monitoring', async () => {
         |   ^
      66 |     process.env.FASTIFY_MICRO_DISABLE_SERVICE_HEALTH_MONITORING = 'true'
      67 |     jest.useFakeTimers('legacy')
      68 |     const healthCheck = jest.fn().mockResolvedValue(true)

      at tests/health.test.ts:65:3
      at Object.<anonymous> (tests/health.test.ts:3:1)

FAIL tests/graceful.test.ts (10.345 s)
  Graceful shutdown
    ✕ with custom handler (5002 ms)
    ✕ with custom async handler (5001 ms)

  ● Graceful shutdown › with custom handler

    FastifyError: fastify-plugin: fastify-micro:sentry - expected '3.x' fastify version, '4.3.0' is installed

      127 |   if (!name) return
      128 |   this[registeredPlugins].push(name)
    > 129 | }
          |  ^
      130 |
      131 | function registerPlugin (fn) {
      132 |   registerPluginName.call(this, fn)

      at Object.checkVersion (../../../VariantsDeps/fastify/variant14/fastify/lib/pluginUtils.js:129:11)
      at Object.registerPlugin (../../../VariantsDeps/fastify/variant14/fastify/lib/pluginUtils.js:143:16)
      at Boot.override (../../../VariantsDeps/fastify/variant14/fastify/lib/pluginOverride.js:35:57)
      at Plugin.Object.<anonymous>.Plugin.exec (../../../VariantsDeps/fastify/variant14/fastify/node_modules/avvio/plugin.js:79:33)
      at Boot.loadPlugin (../../../VariantsDeps/fastify/variant14/fastify/node_modules/avvio/plugin.js:272:10)

  ● Graceful shutdown › with custom handler

    thrown: "Exceeded timeout of 5000 ms for a test.
    Use jest.setTimeout(newTimeout) to increase the timeout value, if this is a long-running test."

      3 |
      4 | describe('Graceful shutdown', () => {
    > 5 |   test('with custom handler', async () => {
        |   ^
      6 |     const server = createServer({ name: 'foo' })
      7 |     server.addHook('onClose', (fastify, done) => {
      8 |       expect(fastify.name).toEqual('foo')

      at tests/graceful.test.ts:5:3
      at Object.<anonymous> (tests/graceful.test.ts:4:1)

  ● Graceful shutdown › with custom async handler

    FastifyError: fastify-plugin: fastify-micro:sentry - expected '3.x' fastify version, '4.3.0' is installed

      127 |   if (!name) return
      128 |   this[registeredPlugins].push(name)
    > 129 | }
          |  ^
      130 |
      131 | function registerPlugin (fn) {
      132 |   registerPluginName.call(this, fn)

      at Object.checkVersion (../../../VariantsDeps/fastify/variant14/fastify/lib/pluginUtils.js:129:11)
      at Object.registerPlugin (../../../VariantsDeps/fastify/variant14/fastify/lib/pluginUtils.js:143:16)
      at Boot.override (../../../VariantsDeps/fastify/variant14/fastify/lib/pluginOverride.js:35:57)
      at Plugin.Object.<anonymous>.Plugin.exec (../../../VariantsDeps/fastify/variant14/fastify/node_modules/avvio/plugin.js:79:33)
      at Boot.loadPlugin (../../../VariantsDeps/fastify/variant14/fastify/node_modules/avvio/plugin.js:272:10)

  ● Graceful shutdown › with custom async handler

    thrown: "Exceeded timeout of 5000 ms for a test.
    Use jest.setTimeout(newTimeout) to increase the timeout value, if this is a long-running test."

      13 |   })
      14 |
    > 15 |   test('with custom async handler', async () => {
         |   ^
      16 |     const server = createServer({ name: 'foo' })
      17 |     server.addHook('onClose', async fastify => {
      18 |       await delay(100)

      at tests/graceful.test.ts:15:3
      at Object.<anonymous> (tests/graceful.test.ts:4:1)

FAIL tests/logger.test.ts (22.996 s)
  Logger
    ✕ name property (5002 ms)
    ✕ redact environment variables (5002 ms)
    ✕ redact log paths (5001 ms)
    ✕ request ID generator (5002 ms)

  ● Logger › name property

    thrown: "Exceeded timeout of 5000 ms for a test.
    Use jest.setTimeout(newTimeout) to increase the timeout value, if this is a long-running test."

      2 |
      3 | describe('Logger', () => {
    > 4 |   test('name property', async () => {
        |   ^
      5 |     const [logLine] = await testLogs(logLine => logLine.dataTestID === 'name')
      6 |     expect(logLine.from).toEqual('foo')
      7 |   })

      at tests/logger.test.ts:4:3
      at Object.<anonymous> (tests/logger.test.ts:3:1)

  ● Logger › redact environment variables

    thrown: "Exceeded timeout of 5000 ms for a test.
    Use jest.setTimeout(newTimeout) to increase the timeout value, if this is a long-running test."

       7 |   })
       8 |
    >  9 |   test('redact environment variables', async () => {
         |   ^
      10 |     const [logLine] = await testLogs(
      11 |       logLine => logLine.dataTestID === 'redact-env'
      12 |     )

      at tests/logger.test.ts:9:3
      at Object.<anonymous> (tests/logger.test.ts:3:1)

  ● Logger › redact log paths

    thrown: "Exceeded timeout of 5000 ms for a test.
    Use jest.setTimeout(newTimeout) to increase the timeout value, if this is a long-running test."

      14 |   })
      15 |
    > 16 |   test('redact log paths', async () => {
         |   ^
      17 |     const [logLine] = await testLogs(
      18 |       logLine => logLine.dataTestID === 'redact-path'
      19 |     )

      at tests/logger.test.ts:16:3
      at Object.<anonymous> (tests/logger.test.ts:3:1)

  ● Logger › request ID generator

    thrown: "Exceeded timeout of 5000 ms for a test.
    Use jest.setTimeout(newTimeout) to increase the timeout value, if this is a long-running test."

      21 |   })
      22 |
    > 23 |   test('request ID generator', async () => {
         |   ^
      24 |     type ReqResLog = { reqId: string }
      25 |
      26 |     const [req1, res1, req2, res2, req3, res3, req4, res4] =

      at tests/logger.test.ts:23:3
      at Object.<anonymous> (tests/logger.test.ts:3:1)

ts-jest[ts-jest-transformer] (WARN) Got a `.js` file to compile while `allowJs` option is not set to `true` (file: /data/js-variants/multee/VariantsDeps/fastify/variant13/fastify/fastify.js). To fix this:
  - if you want TypeScript to process JS files, set `allowJs` to `true` in your TypeScript config (usually tsconfig.json)
  - if you do not want TypeScript to process your `.js` files, in your Jest config change the `transform` key which value is `ts-jest` so that it does not match `.js` files anymore
Browserslist: caniuse-lite is outdated. Please run:
  npx browserslist@latest --update-db
  Why you should do it regularly: https://github.com/browserslist/browserslist#browsers-data-updating
ts-jest[ts-jest-transformer] (WARN) Got a `.js` file to compile while `allowJs` option is not set to `true` (file: /data/js-variants/multee/VariantsDeps/fastify/variant13/fastify/lib/symbols.js). To fix this:
  - if you want TypeScript to process JS files, set `allowJs` to `true` in your TypeScript config (usually tsconfig.json)
  - if you do not want TypeScript to process your `.js` files, in your Jest config change the `transform` key which value is `ts-jest` so that it does not match `.js` files anymore
ts-jest[ts-jest-transformer] (WARN) Got a `.js` file to compile while `allowJs` option is not set to `true` (file: /data/js-variants/multee/VariantsDeps/fastify/variant13/fastify/lib/server.js). To fix this:
  - if you want TypeScript to process JS files, set `allowJs` to `true` in your TypeScript config (usually tsconfig.json)
  - if you do not want TypeScript to process your `.js` files, in your Jest config change the `transform` key which value is `ts-jest` so that it does not match `.js` files anymore
ts-jest[ts-jest-transformer] (WARN) Got a `.js` file to compile while `allowJs` option is not set to `true` (file: /data/js-variants/multee/VariantsDeps/fastify/variant13/fastify/lib/warnings.js). To fix this:
  - if you want TypeScript to process JS files, set `allowJs` to `true` in your TypeScript config (usually tsconfig.json)
  - if you do not want TypeScript to process your `.js` files, in your Jest config change the `transform` key which value is `ts-jest` so that it does not match `.js` files anymore
ts-jest[ts-jest-transformer] (WARN) Got a `.js` file to compile while `allowJs` option is not set to `true` (file: /data/js-variants/multee/VariantsDeps/fastify/variant13/fastify/lib/errors.js). To fix this:
  - if you want TypeScript to process JS files, set `allowJs` to `true` in your TypeScript config (usually tsconfig.json)
  - if you do not want TypeScript to process your `.js` files, in your Jest config change the `transform` key which value is `ts-jest` so that it does not match `.js` files anymore
ts-jest[ts-jest-transformer] (WARN) Got a `.js` file to compile while `allowJs` option is not set to `true` (file: /data/js-variants/multee/VariantsDeps/fastify/variant13/fastify/lib/reply.js). To fix this:
  - if you want TypeScript to process JS files, set `allowJs` to `true` in your TypeScript config (usually tsconfig.json)
  - if you do not want TypeScript to process your `.js` files, in your Jest config change the `transform` key which value is `ts-jest` so that it does not match `.js` files anymore
ts-jest[ts-jest-transformer] (WARN) Got a `.js` file to compile while `allowJs` option is not set to `true` (file: /data/js-variants/multee/VariantsDeps/fastify/variant13/fastify/lib/hooks.js). To fix this:
  - if you want TypeScript to process JS files, set `allowJs` to `true` in your TypeScript config (usually tsconfig.json)
  - if you do not want TypeScript to process your `.js` files, in your Jest config change the `transform` key which value is `ts-jest` so that it does not match `.js` files anymore
ts-jest[ts-jest-transformer] (WARN) Got a `.js` file to compile while `allowJs` option is not set to `true` (file: /data/js-variants/multee/VariantsDeps/fastify/variant13/fastify/lib/handleRequest.js). To fix this:
  - if you want TypeScript to process JS files, set `allowJs` to `true` in your TypeScript config (usually tsconfig.json)
  - if you do not want TypeScript to process your `.js` files, in your Jest config change the `transform` key which value is `ts-jest` so that it does not match `.js` files anymore
ts-jest[ts-jest-transformer] (WARN) Got a `.js` file to compile while `allowJs` option is not set to `true` (file: /data/js-variants/multee/VariantsDeps/fastify/variant13/fastify/lib/validation.js). To fix this:
  - if you want TypeScript to process JS files, set `allowJs` to `true` in your TypeScript config (usually tsconfig.json)
  - if you do not want TypeScript to process your `.js` files, in your Jest config change the `transform` key which value is `ts-jest` so that it does not match `.js` files anymore
ts-jest[ts-jest-transformer] (WARN) Got a `.js` file to compile while `allowJs` option is not set to `true` (file: /data/js-variants/multee/VariantsDeps/fastify/variant13/fastify/lib/wrapThenable.js). To fix this:
  - if you want TypeScript to process JS files, set `allowJs` to `true` in your TypeScript config (usually tsconfig.json)
  - if you do not want TypeScript to process your `.js` files, in your Jest config change the `transform` key which value is `ts-jest` so that it does not match `.js` files anymore
ts-jest[ts-jest-transformer] (WARN) Got a `.js` file to compile while `allowJs` option is not set to `true` (file: /data/js-variants/multee/VariantsDeps/fastify/variant13/fastify/lib/logger.js). To fix this:
  - if you want TypeScript to process JS files, set `allowJs` to `true` in your TypeScript config (usually tsconfig.json)
  - if you do not want TypeScript to process your `.js` files, in your Jest config change the `transform` key which value is `ts-jest` so that it does not match `.js` files anymore
ts-jest[ts-jest-transformer] (WARN) Got a `.js` file to compile while `allowJs` option is not set to `true` (file: /data/js-variants/multee/VariantsDeps/fastify/variant13/fastify/lib/error-handler.js). To fix this:
  - if you want TypeScript to process JS files, set `allowJs` to `true` in your TypeScript config (usually tsconfig.json)
  - if you do not want TypeScript to process your `.js` files, in your Jest config change the `transform` key which value is `ts-jest` so that it does not match `.js` files anymore
ts-jest[ts-jest-transformer] (WARN) Got a `.js` file to compile while `allowJs` option is not set to `true` (file: /data/js-variants/multee/VariantsDeps/fastify/variant13/fastify/lib/schemas.js). To fix this:
  - if you want TypeScript to process JS files, set `allowJs` to `true` in your TypeScript config (usually tsconfig.json)
  - if you do not want TypeScript to process your `.js` files, in your Jest config change the `transform` key which value is `ts-jest` so that it does not match `.js` files anymore
ts-jest[ts-jest-transformer] (WARN) Got a `.js` file to compile while `allowJs` option is not set to `true` (file: /data/js-variants/multee/VariantsDeps/fastify/variant13/fastify/lib/error-serializer.js). To fix this:
  - if you want TypeScript to process JS files, set `allowJs` to `true` in your TypeScript config (usually tsconfig.json)
  - if you do not want TypeScript to process your `.js` files, in your Jest config change the `transform` key which value is `ts-jest` so that it does not match `.js` files anymore
ts-jest[ts-jest-transformer] (WARN) Got a `.js` file to compile while `allowJs` option is not set to `true` (file: /data/js-variants/multee/VariantsDeps/fastify/variant13/fastify/lib/request.js). To fix this:
  - if you want TypeScript to process JS files, set `allowJs` to `true` in your TypeScript config (usually tsconfig.json)
  - if you do not want TypeScript to process your `.js` files, in your Jest config change the `transform` key which value is `ts-jest` so that it does not match `.js` files anymore
ts-jest[ts-jest-transformer] (WARN) Got a `.js` file to compile while `allowJs` option is not set to `true` (file: /data/js-variants/multee/VariantsDeps/fastify/variant13/fastify/lib/decorate.js). To fix this:
  - if you want TypeScript to process JS files, set `allowJs` to `true` in your TypeScript config (usually tsconfig.json)
  - if you do not want TypeScript to process your `.js` files, in your Jest config change the `transform` key which value is `ts-jest` so that it does not match `.js` files anymore
ts-jest[ts-jest-transformer] (WARN) Got a `.js` file to compile while `allowJs` option is not set to `true` (file: /data/js-variants/multee/VariantsDeps/fastify/variant13/fastify/lib/contentTypeParser.js). To fix this:
  - if you want TypeScript to process JS files, set `allowJs` to `true` in your TypeScript config (usually tsconfig.json)
  - if you do not want TypeScript to process your `.js` files, in your Jest config change the `transform` key which value is `ts-jest` so that it does not match `.js` files anymore
ts-jest[ts-jest-transformer] (WARN) Got a `.js` file to compile while `allowJs` option is not set to `true` (file: /data/js-variants/multee/VariantsDeps/fastify/variant13/fastify/lib/schema-controller.js). To fix this:
  - if you want TypeScript to process JS files, set `allowJs` to `true` in your TypeScript config (usually tsconfig.json)
  - if you do not want TypeScript to process your `.js` files, in your Jest config change the `transform` key which value is `ts-jest` so that it does not match `.js` files anymore
ts-jest[ts-jest-transformer] (WARN) Got a `.js` file to compile while `allowJs` option is not set to `true` (file: /data/js-variants/multee/VariantsDeps/fastify/variant13/fastify/lib/pluginUtils.js). To fix this:
  - if you want TypeScript to process JS files, set `allowJs` to `true` in your TypeScript config (usually tsconfig.json)
  - if you do not want TypeScript to process your `.js` files, in your Jest config change the `transform` key which value is `ts-jest` so that it does not match `.js` files anymore
ts-jest[ts-jest-transformer] (WARN) Got a `.js` file to compile while `allowJs` option is not set to `true` (file: /data/js-variants/multee/VariantsDeps/fastify/variant13/fastify/lib/reqIdGenFactory.js). To fix this:
  - if you want TypeScript to process JS files, set `allowJs` to `true` in your TypeScript config (usually tsconfig.json)
  - if you do not want TypeScript to process your `.js` files, in your Jest config change the `transform` key which value is `ts-jest` so that it does not match `.js` files anymore
ts-jest[ts-jest-transformer] (WARN) Got a `.js` file to compile while `allowJs` option is not set to `true` (file: /data/js-variants/multee/VariantsDeps/fastify/variant13/fastify/lib/route.js). To fix this:
  - if you want TypeScript to process JS files, set `allowJs` to `true` in your TypeScript config (usually tsconfig.json)
  - if you do not want TypeScript to process your `.js` files, in your Jest config change the `transform` key which value is `ts-jest` so that it does not match `.js` files anymore
ts-jest[ts-jest-transformer] (WARN) Got a `.js` file to compile while `allowJs` option is not set to `true` (file: /data/js-variants/multee/VariantsDeps/fastify/variant13/fastify/lib/context.js). To fix this:
  - if you want TypeScript to process JS files, set `allowJs` to `true` in your TypeScript config (usually tsconfig.json)
  - if you do not want TypeScript to process your `.js` files, in your Jest config change the `transform` key which value is `ts-jest` so that it does not match `.js` files anymore
ts-jest[ts-jest-transformer] (WARN) Got a `.js` file to compile while `allowJs` option is not set to `true` (file: /data/js-variants/multee/VariantsDeps/fastify/variant13/fastify/lib/headRoute.js). To fix this:
  - if you want TypeScript to process JS files, set `allowJs` to `true` in your TypeScript config (usually tsconfig.json)
  - if you do not want TypeScript to process your `.js` files, in your Jest config change the `transform` key which value is `ts-jest` so that it does not match `.js` files anymore
ts-jest[ts-jest-transformer] (WARN) Got a `.js` file to compile while `allowJs` option is not set to `true` (file: /data/js-variants/multee/VariantsDeps/fastify/variant13/fastify/lib/fourOhFour.js). To fix this:
  - if you want TypeScript to process JS files, set `allowJs` to `true` in your TypeScript config (usually tsconfig.json)
  - if you do not want TypeScript to process your `.js` files, in your Jest config change the `transform` key which value is `ts-jest` so that it does not match `.js` files anymore
ts-jest[ts-jest-transformer] (WARN) Got a `.js` file to compile while `allowJs` option is not set to `true` (file: /data/js-variants/multee/VariantsDeps/fastify/variant13/fastify/lib/initialConfigValidation.js). To fix this:
  - if you want TypeScript to process JS files, set `allowJs` to `true` in your TypeScript config (usually tsconfig.json)
  - if you do not want TypeScript to process your `.js` files, in your Jest config change the `transform` key which value is `ts-jest` so that it does not match `.js` files anymore
ts-jest[ts-jest-transformer] (WARN) Got a `.js` file to compile while `allowJs` option is not set to `true` (file: /data/js-variants/multee/VariantsDeps/fastify/variant13/fastify/lib/configValidator.js). To fix this:
  - if you want TypeScript to process JS files, set `allowJs` to `true` in your TypeScript config (usually tsconfig.json)
  - if you do not want TypeScript to process your `.js` files, in your Jest config change the `transform` key which value is `ts-jest` so that it does not match `.js` files anymore
ts-jest[ts-jest-transformer] (WARN) Got a `.js` file to compile while `allowJs` option is not set to `true` (file: /data/js-variants/multee/VariantsDeps/fastify/variant13/fastify/lib/pluginOverride.js). To fix this:
  - if you want TypeScript to process JS files, set `allowJs` to `true` in your TypeScript config (usually tsconfig.json)
  - if you do not want TypeScript to process your `.js` files, in your Jest config change the `transform` key which value is `ts-jest` so that it does not match `.js` files anymore
ts-jest[ts-jest-transformer] (WARN) Got a `.js` file to compile while `allowJs` option is not set to `true` (file: /data/js-variants/multee/VariantsDeps/fastify/variant13/fastify/lib/noop-set.js). To fix this:
  - if you want TypeScript to process JS files, set `allowJs` to `true` in your TypeScript config (usually tsconfig.json)
  - if you do not want TypeScript to process your `.js` files, in your Jest config change the `transform` key which value is `ts-jest` so that it does not match `.js` files anymore
FAIL tests/basics.test.ts (22.676 s)
  Basics
    ✓ The specified `name` property is injected (39 ms)
    ✕ Default port should be 3000 (5002 ms)
    ✕ Port should be configurable via the environment (5002 ms)
    ✕ Port can be passed as a second argument to `startServer` (5001 ms)

  ● Basics › Default port should be 3000

    FastifyError: fastify-plugin: fastify-micro:sentry - expected '3.x' fastify version, '4.3.0' is installed

      127 |   if (!name) return
      128 |   this[registeredPlugins].push(name)
    > 129 | }
          |  ^
      130 |
      131 | function registerPlugin (fn) {
      132 |   registerPluginName.call(this, fn)

      at Object.checkVersion (../../../VariantsDeps/fastify/variant13/fastify/lib/pluginUtils.js:129:11)
      at Object.registerPlugin (../../../VariantsDeps/fastify/variant13/fastify/lib/pluginUtils.js:143:16)
      at Boot.override (../../../VariantsDeps/fastify/variant13/fastify/lib/pluginOverride.js:35:57)
      at Plugin.Object.<anonymous>.Plugin.exec (../../../VariantsDeps/fastify/variant13/fastify/node_modules/avvio/plugin.js:79:33)
      at Boot.loadPlugin (../../../VariantsDeps/fastify/variant13/fastify/node_modules/avvio/plugin.js:272:10)

  ● Basics › Default port should be 3000

    FastifyError: fastify-plugin: fastify-micro:sentry - expected '3.x' fastify version, '4.3.0' is installed

      127 |   if (!name) return
      128 |   this[registeredPlugins].push(name)
    > 129 | }
          |  ^
      130 |
      131 | function registerPlugin (fn) {
      132 |   registerPluginName.call(this, fn)

      at Object.checkVersion (../../../VariantsDeps/fastify/variant13/fastify/lib/pluginUtils.js:129:11)
      at Object.registerPlugin (../../../VariantsDeps/fastify/variant13/fastify/lib/pluginUtils.js:143:16)
      at Boot.override (../../../VariantsDeps/fastify/variant13/fastify/lib/pluginOverride.js:35:57)
      at Plugin.Object.<anonymous>.Plugin.exec (../../../VariantsDeps/fastify/variant13/fastify/node_modules/avvio/plugin.js:79:33)
      at Boot.loadPlugin (../../../VariantsDeps/fastify/variant13/fastify/node_modules/avvio/plugin.js:272:10)

  ● Basics › Default port should be 3000

    FastifyError: fastify-plugin: fastify-micro:sentry - expected '3.x' fastify version, '4.3.0' is installed

      127 |   if (!name) return
      128 |   this[registeredPlugins].push(name)
    > 129 | }
          |  ^
      130 |
      131 | function registerPlugin (fn) {
      132 |   registerPluginName.call(this, fn)

      at Object.checkVersion (../../../VariantsDeps/fastify/variant13/fastify/lib/pluginUtils.js:129:11)
      at Object.registerPlugin (../../../VariantsDeps/fastify/variant13/fastify/lib/pluginUtils.js:143:16)
      at Boot.override (../../../VariantsDeps/fastify/variant13/fastify/lib/pluginOverride.js:35:57)
      at Plugin.Object.<anonymous>.Plugin.exec (../../../VariantsDeps/fastify/variant13/fastify/node_modules/avvio/plugin.js:79:33)
      at Boot.loadPlugin (../../../VariantsDeps/fastify/variant13/fastify/node_modules/avvio/plugin.js:272:10)

  ● Basics › Default port should be 3000

    thrown: "Exceeded timeout of 5000 ms for a test.
    Use jest.setTimeout(newTimeout) to increase the timeout value, if this is a long-running test."

      15 |   })
      16 |
    > 17 |   test('Default port should be 3000', async () => {
         |   ^
      18 |     const key = nanoid()
      19 |     const server = createServer()
      20 |     server.get('/', (_, res) => {

      at tests/basics.test.ts:17:3
      at Object.<anonymous> (tests/basics.test.ts:5:1)

  ● Basics › Port should be configurable via the environment

    FastifyError: fastify-plugin: fastify-micro:sentry - expected '3.x' fastify version, '4.3.0' is installed

      127 |   if (!name) return
      128 |   this[registeredPlugins].push(name)
    > 129 | }
          |  ^
      130 |
      131 | function registerPlugin (fn) {
      132 |   registerPluginName.call(this, fn)

      at Object.checkVersion (../../../VariantsDeps/fastify/variant13/fastify/lib/pluginUtils.js:129:11)
      at Object.registerPlugin (../../../VariantsDeps/fastify/variant13/fastify/lib/pluginUtils.js:143:16)
      at Boot.override (../../../VariantsDeps/fastify/variant13/fastify/lib/pluginOverride.js:35:57)
      at Plugin.Object.<anonymous>.Plugin.exec (../../../VariantsDeps/fastify/variant13/fastify/node_modules/avvio/plugin.js:79:33)
      at Boot.loadPlugin (../../../VariantsDeps/fastify/variant13/fastify/node_modules/avvio/plugin.js:272:10)

  ● Basics › Port should be configurable via the environment

    thrown: "Exceeded timeout of 5000 ms for a test.
    Use jest.setTimeout(newTimeout) to increase the timeout value, if this is a long-running test."

      27 |   })
      28 |
    > 29 |   test('Port should be configurable via the environment', async () => {
         |   ^
      30 |     process.env.PORT = '3001'
      31 |     const key = nanoid()
      32 |     const server = createServer()

      at tests/basics.test.ts:29:3
      at Object.<anonymous> (tests/basics.test.ts:5:1)

  ● Basics › Port can be passed as a second argument to `startServer`

    FastifyError: fastify-plugin: fastify-micro:sentry - expected '3.x' fastify version, '4.3.0' is installed

      127 |   if (!name) return
      128 |   this[registeredPlugins].push(name)
    > 129 | }
          |  ^
      130 |
      131 | function registerPlugin (fn) {
      132 |   registerPluginName.call(this, fn)

      at Object.checkVersion (../../../VariantsDeps/fastify/variant13/fastify/lib/pluginUtils.js:129:11)
      at Object.registerPlugin (../../../VariantsDeps/fastify/variant13/fastify/lib/pluginUtils.js:143:16)
      at Boot.override (../../../VariantsDeps/fastify/variant13/fastify/lib/pluginOverride.js:35:57)
      at Plugin.Object.<anonymous>.Plugin.exec (../../../VariantsDeps/fastify/variant13/fastify/node_modules/avvio/plugin.js:79:33)
      at Boot.loadPlugin (../../../VariantsDeps/fastify/variant13/fastify/node_modules/avvio/plugin.js:272:10)

  ● Basics › Port can be passed as a second argument to `startServer`

    FastifyError: fastify-plugin: Plugin did not start in time: 'bound _after'. You may have forgotten to call 'done' function or to resolve a Promise

      618 |     // config issue on the load balancer side.
      619 |     this.log.trace({ err }, 'client error')
    > 620 |     // Copying standard node behaviour
          |                                       ^
      621 |     // https://github.com/nodejs/node/blob/6ca23d7846cb47e84fd344543e394e50938540be/lib/_http_server.js#L666
      622 |
      623 |     // If the socket is not writable, there is no reason to try to send data.

      at manageErr (../../../VariantsDeps/fastify/variant13/fastify/fastify.js:620:87)
      at ../../../VariantsDeps/fastify/variant13/fastify/fastify.js:607:11
      at Object._encapsulateThreeParam (../../../VariantsDeps/fastify/variant13/fastify/node_modules/avvio/boot.js:557:7)
      at Boot.timeoutCall (../../../VariantsDeps/fastify/variant13/fastify/node_modules/avvio/boot.js:453:5)
      at Boot.callWithCbOrNextTick (../../../VariantsDeps/fastify/variant13/fastify/node_modules/avvio/boot.js:435:19)
      at release (../../../VariantsDeps/fastify/variant13/fastify/node_modules/fastq/queue.js:149:16)
      at Object.resume (../../../VariantsDeps/fastify/variant13/fastify/node_modules/fastq/queue.js:82:7)
      at ../../../VariantsDeps/fastify/variant13/fastify/node_modules/avvio/boot.js:174:18
      at ../../../VariantsDeps/fastify/variant13/fastify/node_modules/avvio/plugin.js:275:7
      at done (../../../VariantsDeps/fastify/variant13/fastify/node_modules/avvio/plugin.js:200:5)

  ● Basics › Port can be passed as a second argument to `startServer`

    FastifyError: fastify-plugin: Plugin did not start in time: 'bound _after'. You may have forgotten to call 'done' function or to resolve a Promise

      618 |     // config issue on the load balancer side.
      619 |     this.log.trace({ err }, 'client error')
    > 620 |     // Copying standard node behaviour
          |                                       ^
      621 |     // https://github.com/nodejs/node/blob/6ca23d7846cb47e84fd344543e394e50938540be/lib/_http_server.js#L666
      622 |
      623 |     // If the socket is not writable, there is no reason to try to send data.

      at manageErr (../../../VariantsDeps/fastify/variant13/fastify/fastify.js:620:87)
      at ../../../VariantsDeps/fastify/variant13/fastify/fastify.js:607:11
      at Object._encapsulateThreeParam (../../../VariantsDeps/fastify/variant13/fastify/node_modules/avvio/boot.js:557:7)
      at Boot.timeoutCall (../../../VariantsDeps/fastify/variant13/fastify/node_modules/avvio/boot.js:453:5)
      at Boot.callWithCbOrNextTick (../../../VariantsDeps/fastify/variant13/fastify/node_modules/avvio/boot.js:435:19)
      at release (../../../VariantsDeps/fastify/variant13/fastify/node_modules/fastq/queue.js:149:16)
      at Object.resume (../../../VariantsDeps/fastify/variant13/fastify/node_modules/fastq/queue.js:82:7)
      at ../../../VariantsDeps/fastify/variant13/fastify/node_modules/avvio/boot.js:174:18
      at ../../../VariantsDeps/fastify/variant13/fastify/node_modules/avvio/plugin.js:275:7
      at done (../../../VariantsDeps/fastify/variant13/fastify/node_modules/avvio/plugin.js:200:5)

  ● Basics › Port can be passed as a second argument to `startServer`

    FastifyError: fastify-plugin: Plugin did not start in time: 'bound _after'. You may have forgotten to call 'done' function or to resolve a Promise

      618 |     // config issue on the load balancer side.
      619 |     this.log.trace({ err }, 'client error')
    > 620 |     // Copying standard node behaviour
          |                                       ^
      621 |     // https://github.com/nodejs/node/blob/6ca23d7846cb47e84fd344543e394e50938540be/lib/_http_server.js#L666
      622 |
      623 |     // If the socket is not writable, there is no reason to try to send data.

      at manageErr (../../../VariantsDeps/fastify/variant13/fastify/fastify.js:620:87)
      at ../../../VariantsDeps/fastify/variant13/fastify/fastify.js:607:11
      at Object._encapsulateThreeParam (../../../VariantsDeps/fastify/variant13/fastify/node_modules/avvio/boot.js:557:7)
      at Boot.timeoutCall (../../../VariantsDeps/fastify/variant13/fastify/node_modules/avvio/boot.js:453:5)
      at Boot.callWithCbOrNextTick (../../../VariantsDeps/fastify/variant13/fastify/node_modules/avvio/boot.js:435:19)
      at release (../../../VariantsDeps/fastify/variant13/fastify/node_modules/fastq/queue.js:149:16)
      at Object.resume (../../../VariantsDeps/fastify/variant13/fastify/node_modules/fastq/queue.js:82:7)
      at ../../../VariantsDeps/fastify/variant13/fastify/node_modules/avvio/boot.js:174:18
      at ../../../VariantsDeps/fastify/variant13/fastify/node_modules/avvio/plugin.js:275:7
      at done (../../../VariantsDeps/fastify/variant13/fastify/node_modules/avvio/plugin.js:200:5)

  ● Basics › Port can be passed as a second argument to `startServer`

    thrown: "Exceeded timeout of 5000 ms for a test.
    Use jest.setTimeout(newTimeout) to increase the timeout value, if this is a long-running test."

      41 |   })
      42 |
    > 43 |   test('Port can be passed as a second argument to `startServer`', async () => {
         |   ^
      44 |     const server = createServer()
      45 |     const key = nanoid()
      46 |     server.get('/', (_, res) => {

      at tests/basics.test.ts:43:3
      at Object.<anonymous> (tests/basics.test.ts:5:1)

FAIL tests/plugins.test.ts (15.353 s)
  Plugins
    ✕ Loading plugins & routes from filesystem (5002 ms)
    ✕ Graceful exit (5002 ms)
    ✕ Graceful exit with a slow onClose hook (5000 ms)

  ● Plugins › Loading plugins & routes from filesystem

    FastifyError: fastify-plugin: fastify-micro:sentry - expected '3.x' fastify version, '4.3.0' is installed

      127 |   if (!name) return
      128 |   this[registeredPlugins].push(name)
    > 129 | }
          |  ^
      130 |
      131 | function registerPlugin (fn) {
      132 |   registerPluginName.call(this, fn)

      at Object.checkVersion (../../../VariantsDeps/fastify/variant13/fastify/lib/pluginUtils.js:129:11)
      at Object.registerPlugin (../../../VariantsDeps/fastify/variant13/fastify/lib/pluginUtils.js:143:16)
      at Boot.override (../../../VariantsDeps/fastify/variant13/fastify/lib/pluginOverride.js:35:57)
      at Plugin.Object.<anonymous>.Plugin.exec (../../../VariantsDeps/fastify/variant13/fastify/node_modules/avvio/plugin.js:79:33)
      at Boot.loadPlugin (../../../VariantsDeps/fastify/variant13/fastify/node_modules/avvio/plugin.js:272:10)

  ● Plugins › Loading plugins & routes from filesystem

    FastifyError: fastify-plugin: Plugin did not start in time: 'bound _after'. You may have forgotten to call 'done' function or to resolve a Promise

      618 |     // config issue on the load balancer side.
      619 |     this.log.trace({ err }, 'client error')
    > 620 |     // Copying standard node behaviour
          |                                       ^
      621 |     // https://github.com/nodejs/node/blob/6ca23d7846cb47e84fd344543e394e50938540be/lib/_http_server.js#L666
      622 |
      623 |     // If the socket is not writable, there is no reason to try to send data.

      at manageErr (../../../VariantsDeps/fastify/variant13/fastify/fastify.js:620:87)
      at ../../../VariantsDeps/fastify/variant13/fastify/fastify.js:607:11
      at Object._encapsulateThreeParam (../../../VariantsDeps/fastify/variant13/fastify/node_modules/avvio/boot.js:557:7)
      at Boot.timeoutCall (../../../VariantsDeps/fastify/variant13/fastify/node_modules/avvio/boot.js:453:5)
      at Boot.callWithCbOrNextTick (../../../VariantsDeps/fastify/variant13/fastify/node_modules/avvio/boot.js:435:19)
      at release (../../../VariantsDeps/fastify/variant13/fastify/node_modules/fastq/queue.js:149:16)
      at Object.resume (../../../VariantsDeps/fastify/variant13/fastify/node_modules/fastq/queue.js:82:7)
      at ../../../VariantsDeps/fastify/variant13/fastify/node_modules/avvio/boot.js:174:18
      at ../../../VariantsDeps/fastify/variant13/fastify/node_modules/avvio/plugin.js:275:7
      at done (../../../VariantsDeps/fastify/variant13/fastify/node_modules/avvio/plugin.js:200:5)

  ● Plugins › Loading plugins & routes from filesystem

    FastifyError: fastify-plugin: Plugin did not start in time: 'bound _after'. You may have forgotten to call 'done' function or to resolve a Promise

      618 |     // config issue on the load balancer side.
      619 |     this.log.trace({ err }, 'client error')
    > 620 |     // Copying standard node behaviour
          |                                       ^
      621 |     // https://github.com/nodejs/node/blob/6ca23d7846cb47e84fd344543e394e50938540be/lib/_http_server.js#L666
      622 |
      623 |     // If the socket is not writable, there is no reason to try to send data.

      at manageErr (../../../VariantsDeps/fastify/variant13/fastify/fastify.js:620:87)
      at ../../../VariantsDeps/fastify/variant13/fastify/fastify.js:607:11
      at Object._encapsulateThreeParam (../../../VariantsDeps/fastify/variant13/fastify/node_modules/avvio/boot.js:557:7)
      at Boot.timeoutCall (../../../VariantsDeps/fastify/variant13/fastify/node_modules/avvio/boot.js:453:5)
      at Boot.callWithCbOrNextTick (../../../VariantsDeps/fastify/variant13/fastify/node_modules/avvio/boot.js:435:19)
      at release (../../../VariantsDeps/fastify/variant13/fastify/node_modules/fastq/queue.js:149:16)
      at Object.resume (../../../VariantsDeps/fastify/variant13/fastify/node_modules/fastq/queue.js:82:7)
      at ../../../VariantsDeps/fastify/variant13/fastify/node_modules/avvio/boot.js:174:18
      at ../../../VariantsDeps/fastify/variant13/fastify/node_modules/avvio/plugin.js:275:7
      at done (../../../VariantsDeps/fastify/variant13/fastify/node_modules/avvio/plugin.js:200:5)

  ● Plugins › Loading plugins & routes from filesystem

    thrown: "Exceeded timeout of 5000 ms for a test.
    Use jest.setTimeout(newTimeout) to increase the timeout value, if this is a long-running test."

      11 |   })
      12 |
    > 13 |   test('Loading plugins & routes from filesystem', async () => {
         |   ^
      14 |     const server = createServer({
      15 |       plugins: {
      16 |         dir: path.resolve(__dirname, './jigs/plugins')

      at tests/plugins.test.ts:13:3
      at Object.<anonymous> (tests/plugins.test.ts:8:1)

  ● Plugins › Graceful exit

    FastifyError: fastify-plugin: fastify-micro:sentry - expected '3.x' fastify version, '4.3.0' is installed

      127 |   if (!name) return
      128 |   this[registeredPlugins].push(name)
    > 129 | }
          |  ^
      130 |
      131 | function registerPlugin (fn) {
      132 |   registerPluginName.call(this, fn)

      at Object.checkVersion (../../../VariantsDeps/fastify/variant13/fastify/lib/pluginUtils.js:129:11)
      at Object.registerPlugin (../../../VariantsDeps/fastify/variant13/fastify/lib/pluginUtils.js:143:16)
      at Boot.override (../../../VariantsDeps/fastify/variant13/fastify/lib/pluginOverride.js:35:57)
      at Plugin.Object.<anonymous>.Plugin.exec (../../../VariantsDeps/fastify/variant13/fastify/node_modules/avvio/plugin.js:79:33)
      at Boot.loadPlugin (../../../VariantsDeps/fastify/variant13/fastify/node_modules/avvio/plugin.js:272:10)

  ● Plugins › Graceful exit

    thrown: "Exceeded timeout of 5000 ms for a test.
    Use jest.setTimeout(newTimeout) to increase the timeout value, if this is a long-running test."

      27 |   })
      28 |
    > 29 |   test('Graceful exit', async () => {
         |   ^
      30 |     //jest.setTimeout(10000)
      31 |     const key = nanoid()
      32 |     const server = createServer()

      at tests/plugins.test.ts:29:3
      at Object.<anonymous> (tests/plugins.test.ts:8:1)

  ● Plugins › Graceful exit with a slow onClose hook

    FastifyError: fastify-plugin: fastify-micro:sentry - expected '3.x' fastify version, '4.3.0' is installed

      127 |   if (!name) return
      128 |   this[registeredPlugins].push(name)
    > 129 | }
          |  ^
      130 |
      131 | function registerPlugin (fn) {
      132 |   registerPluginName.call(this, fn)

      at Object.checkVersion (../../../VariantsDeps/fastify/variant13/fastify/lib/pluginUtils.js:129:11)
      at Object.registerPlugin (../../../VariantsDeps/fastify/variant13/fastify/lib/pluginUtils.js:143:16)
      at Boot.override (../../../VariantsDeps/fastify/variant13/fastify/lib/pluginOverride.js:35:57)
      at Plugin.Object.<anonymous>.Plugin.exec (../../../VariantsDeps/fastify/variant13/fastify/node_modules/avvio/plugin.js:79:33)
      at Boot.loadPlugin (../../../VariantsDeps/fastify/variant13/fastify/node_modules/avvio/plugin.js:272:10)

  ● Plugins › Graceful exit with a slow onClose hook

    FastifyError: fastify-plugin: Plugin did not start in time: 'bound _after'. You may have forgotten to call 'done' function or to resolve a Promise

      618 |     // config issue on the load balancer side.
      619 |     this.log.trace({ err }, 'client error')
    > 620 |     // Copying standard node behaviour
          |                                       ^
      621 |     // https://github.com/nodejs/node/blob/6ca23d7846cb47e84fd344543e394e50938540be/lib/_http_server.js#L666
      622 |
      623 |     // If the socket is not writable, there is no reason to try to send data.

      at manageErr (../../../VariantsDeps/fastify/variant13/fastify/fastify.js:620:87)
      at ../../../VariantsDeps/fastify/variant13/fastify/fastify.js:607:11
      at Object._encapsulateThreeParam (../../../VariantsDeps/fastify/variant13/fastify/node_modules/avvio/boot.js:557:7)
      at Boot.timeoutCall (../../../VariantsDeps/fastify/variant13/fastify/node_modules/avvio/boot.js:453:5)
      at Boot.callWithCbOrNextTick (../../../VariantsDeps/fastify/variant13/fastify/node_modules/avvio/boot.js:435:19)
      at release (../../../VariantsDeps/fastify/variant13/fastify/node_modules/fastq/queue.js:149:16)
      at Object.resume (../../../VariantsDeps/fastify/variant13/fastify/node_modules/fastq/queue.js:82:7)
      at ../../../VariantsDeps/fastify/variant13/fastify/node_modules/avvio/boot.js:174:18
      at ../../../VariantsDeps/fastify/variant13/fastify/node_modules/avvio/plugin.js:275:7
      at done (../../../VariantsDeps/fastify/variant13/fastify/node_modules/avvio/plugin.js:200:5)

  ● Plugins › Graceful exit with a slow onClose hook

    thrown: "Exceeded timeout of 5000 ms for a test.
    Use jest.setTimeout(newTimeout) to increase the timeout value, if this is a long-running test."

      43 |   })
      44 |
    > 45 |   test('Graceful exit with a slow onClose hook', async () => {
         |   ^
      46 |     const key = nanoid()
      47 |     const server = createServer()
      48 |     server.get('/', async (_, res) => {

      at tests/plugins.test.ts:45:3
      at Object.<anonymous> (tests/plugins.test.ts:8:1)

FAIL tests/health.test.ts (20.334 s)
  Health checks
    ✕ Default configuration exposes a /_health route (5002 ms)
    ✕ Custom health check handler is called at startup and every 5 seconds (5000 ms)
    ✕ Custom health check throwing results in 503 (5000 ms)
    ✕ Disabled health monitoring (5002 ms)

  ● Health checks › Default configuration exposes a /_health route

    FastifyError: fastify-plugin: fastify-micro:sentry - expected '3.x' fastify version, '4.3.0' is installed

      127 |   if (!name) return
      128 |   this[registeredPlugins].push(name)
    > 129 | }
          |  ^
      130 |
      131 | function registerPlugin (fn) {
      132 |   registerPluginName.call(this, fn)

      at Object.checkVersion (../../../VariantsDeps/fastify/variant13/fastify/lib/pluginUtils.js:129:11)
      at Object.registerPlugin (../../../VariantsDeps/fastify/variant13/fastify/lib/pluginUtils.js:143:16)
      at Boot.override (../../../VariantsDeps/fastify/variant13/fastify/lib/pluginOverride.js:35:57)
      at Plugin.Object.<anonymous>.Plugin.exec (../../../VariantsDeps/fastify/variant13/fastify/node_modules/avvio/plugin.js:79:33)
      at Boot.loadPlugin (../../../VariantsDeps/fastify/variant13/fastify/node_modules/avvio/plugin.js:272:10)

  ● Health checks › Default configuration exposes a /_health route

    FastifyError: fastify-plugin: Plugin did not start in time: 'bound _after'. You may have forgotten to call 'done' function or to resolve a Promise

      618 |     // config issue on the load balancer side.
      619 |     this.log.trace({ err }, 'client error')
    > 620 |     // Copying standard node behaviour
          |                                       ^
      621 |     // https://github.com/nodejs/node/blob/6ca23d7846cb47e84fd344543e394e50938540be/lib/_http_server.js#L666
      622 |
      623 |     // If the socket is not writable, there is no reason to try to send data.

      at manageErr (../../../VariantsDeps/fastify/variant13/fastify/fastify.js:620:87)
      at ../../../VariantsDeps/fastify/variant13/fastify/fastify.js:607:11
      at Object._encapsulateThreeParam (../../../VariantsDeps/fastify/variant13/fastify/node_modules/avvio/boot.js:557:7)
      at Boot.timeoutCall (../../../VariantsDeps/fastify/variant13/fastify/node_modules/avvio/boot.js:453:5)
      at Boot.callWithCbOrNextTick (../../../VariantsDeps/fastify/variant13/fastify/node_modules/avvio/boot.js:435:19)
      at release (../../../VariantsDeps/fastify/variant13/fastify/node_modules/fastq/queue.js:149:16)
      at Object.resume (../../../VariantsDeps/fastify/variant13/fastify/node_modules/fastq/queue.js:82:7)
      at ../../../VariantsDeps/fastify/variant13/fastify/node_modules/avvio/boot.js:174:18
      at ../../../VariantsDeps/fastify/variant13/fastify/node_modules/avvio/plugin.js:275:7
      at done (../../../VariantsDeps/fastify/variant13/fastify/node_modules/avvio/plugin.js:200:5)

  ● Health checks › Default configuration exposes a /_health route

    FastifyError: fastify-plugin: Plugin did not start in time: 'bound _after'. You may have forgotten to call 'done' function or to resolve a Promise

      618 |     // config issue on the load balancer side.
      619 |     this.log.trace({ err }, 'client error')
    > 620 |     // Copying standard node behaviour
          |                                       ^
      621 |     // https://github.com/nodejs/node/blob/6ca23d7846cb47e84fd344543e394e50938540be/lib/_http_server.js#L666
      622 |
      623 |     // If the socket is not writable, there is no reason to try to send data.

      at manageErr (../../../VariantsDeps/fastify/variant13/fastify/fastify.js:620:87)
      at ../../../VariantsDeps/fastify/variant13/fastify/fastify.js:607:11
      at Object._encapsulateThreeParam (../../../VariantsDeps/fastify/variant13/fastify/node_modules/avvio/boot.js:557:7)
      at Boot.timeoutCall (../../../VariantsDeps/fastify/variant13/fastify/node_modules/avvio/boot.js:453:5)
      at Boot.callWithCbOrNextTick (../../../VariantsDeps/fastify/variant13/fastify/node_modules/avvio/boot.js:435:19)
      at release (../../../VariantsDeps/fastify/variant13/fastify/node_modules/fastq/queue.js:149:16)
      at Object.resume (../../../VariantsDeps/fastify/variant13/fastify/node_modules/fastq/queue.js:82:7)
      at ../../../VariantsDeps/fastify/variant13/fastify/node_modules/avvio/boot.js:174:18
      at ../../../VariantsDeps/fastify/variant13/fastify/node_modules/avvio/plugin.js:275:7
      at done (../../../VariantsDeps/fastify/variant13/fastify/node_modules/avvio/plugin.js:200:5)

  ● Health checks › Default configuration exposes a /_health route

    thrown: "Exceeded timeout of 5000 ms for a test.
    Use jest.setTimeout(newTimeout) to increase the timeout value, if this is a long-running test."

       6 |   })
       7 |
    >  8 |   test('Default configuration exposes a /_health route', async () => {
         |   ^
       9 |     const server = createServer()
      10 |     await server.ready()
      11 |     const res = await server.inject({ method: 'GET', url: '/_health' })

      at tests/health.test.ts:8:3
      at Object.<anonymous> (tests/health.test.ts:3:1)

  ● Health checks › Custom health check handler is called at startup and every 5 seconds

    FastifyError: fastify-plugin: fastify-micro:sentry - expected '3.x' fastify version, '4.3.0' is installed

      127 |   if (!name) return
      128 |   this[registeredPlugins].push(name)
    > 129 | }
          |  ^
      130 |
      131 | function registerPlugin (fn) {
      132 |   registerPluginName.call(this, fn)

      at Object.checkVersion (../../../VariantsDeps/fastify/variant13/fastify/lib/pluginUtils.js:129:11)
      at Object.registerPlugin (../../../VariantsDeps/fastify/variant13/fastify/lib/pluginUtils.js:143:16)
      at Boot.override (../../../VariantsDeps/fastify/variant13/fastify/lib/pluginOverride.js:35:57)
      at Plugin.Object.<anonymous>.Plugin.exec (../../../VariantsDeps/fastify/variant13/fastify/node_modules/avvio/plugin.js:79:33)
      at Boot.loadPlugin (../../../VariantsDeps/fastify/variant13/fastify/node_modules/avvio/plugin.js:272:10)
      at node_modules/@jest/fake-timers/build/legacyFakeTimers.js:558:18

  ● Health checks › Custom health check handler is called at startup and every 5 seconds

    thrown: "Exceeded timeout of 5000 ms for a test.
    Use jest.setTimeout(newTimeout) to increase the timeout value, if this is a long-running test."

      14 |   })
      15 |
    > 16 |   test('Custom health check handler is called at startup and every 5 seconds', async () => {
         |   ^
      17 |     jest.useFakeTimers('legacy')
      18 |     const healthCheck = jest.fn().mockResolvedValue(true)
      19 |     const server = createServer({

      at tests/health.test.ts:16:3
      at Object.<anonymous> (tests/health.test.ts:3:1)

  ● Health checks › Custom health check throwing results in 503

    FastifyError: fastify-plugin: fastify-micro:sentry - expected '3.x' fastify version, '4.3.0' is installed

      127 |   if (!name) return
      128 |   this[registeredPlugins].push(name)
    > 129 | }
          |  ^
      130 |
      131 | function registerPlugin (fn) {
      132 |   registerPluginName.call(this, fn)

      at Object.checkVersion (../../../VariantsDeps/fastify/variant13/fastify/lib/pluginUtils.js:129:11)
      at Object.registerPlugin (../../../VariantsDeps/fastify/variant13/fastify/lib/pluginUtils.js:143:16)
      at Boot.override (../../../VariantsDeps/fastify/variant13/fastify/lib/pluginOverride.js:35:57)
      at Plugin.Object.<anonymous>.Plugin.exec (../../../VariantsDeps/fastify/variant13/fastify/node_modules/avvio/plugin.js:79:33)
      at Boot.loadPlugin (../../../VariantsDeps/fastify/variant13/fastify/node_modules/avvio/plugin.js:272:10)
      at node_modules/@jest/fake-timers/build/legacyFakeTimers.js:558:18

  ● Health checks › Custom health check throwing results in 503

    FastifyError: fastify-plugin: Plugin did not start in time: 'bound _after'. You may have forgotten to call 'done' function or to resolve a Promise

      618 |     // config issue on the load balancer side.
      619 |     this.log.trace({ err }, 'client error')
    > 620 |     // Copying standard node behaviour
          |                                       ^
      621 |     // https://github.com/nodejs/node/blob/6ca23d7846cb47e84fd344543e394e50938540be/lib/_http_server.js#L666
      622 |
      623 |     // If the socket is not writable, there is no reason to try to send data.

      at manageErr (../../../VariantsDeps/fastify/variant13/fastify/fastify.js:620:87)
      at ../../../VariantsDeps/fastify/variant13/fastify/fastify.js:607:11
      at Object._encapsulateThreeParam (../../../VariantsDeps/fastify/variant13/fastify/node_modules/avvio/boot.js:557:7)
      at Boot.timeoutCall (../../../VariantsDeps/fastify/variant13/fastify/node_modules/avvio/boot.js:453:5)
      at Boot.callWithCbOrNextTick (../../../VariantsDeps/fastify/variant13/fastify/node_modules/avvio/boot.js:435:19)
      at release (../../../VariantsDeps/fastify/variant13/fastify/node_modules/fastq/queue.js:149:16)
      at Object.resume (../../../VariantsDeps/fastify/variant13/fastify/node_modules/fastq/queue.js:82:7)
      at ../../../VariantsDeps/fastify/variant13/fastify/node_modules/avvio/boot.js:174:18
      at ../../../VariantsDeps/fastify/variant13/fastify/node_modules/avvio/plugin.js:275:7
      at done (../../../VariantsDeps/fastify/variant13/fastify/node_modules/avvio/plugin.js:200:5)

  ● Health checks › Custom health check throwing results in 503

    thrown: "Exceeded timeout of 5000 ms for a test.
    Use jest.setTimeout(newTimeout) to increase the timeout value, if this is a long-running test."

      29 |   })
      30 |
    > 31 |   test('Custom health check throwing results in 503', async () => {
         |   ^
      32 |     jest.useFakeTimers('legacy')
      33 |     const healthCheck = jest
      34 |       .fn()

      at tests/health.test.ts:31:3
      at Object.<anonymous> (tests/health.test.ts:3:1)

  ● Health checks › Disabled health monitoring

    FastifyError: fastify-plugin: fastify-micro:sentry - expected '3.x' fastify version, '4.3.0' is installed

      127 |   if (!name) return
      128 |   this[registeredPlugins].push(name)
    > 129 | }
          |  ^
      130 |
      131 | function registerPlugin (fn) {
      132 |   registerPluginName.call(this, fn)

      at Object.checkVersion (../../../VariantsDeps/fastify/variant13/fastify/lib/pluginUtils.js:129:11)
      at Object.registerPlugin (../../../VariantsDeps/fastify/variant13/fastify/lib/pluginUtils.js:143:16)
      at Boot.override (../../../VariantsDeps/fastify/variant13/fastify/lib/pluginOverride.js:35:57)
      at Plugin.Object.<anonymous>.Plugin.exec (../../../VariantsDeps/fastify/variant13/fastify/node_modules/avvio/plugin.js:79:33)
      at Boot.loadPlugin (../../../VariantsDeps/fastify/variant13/fastify/node_modules/avvio/plugin.js:272:10)
      at node_modules/@jest/fake-timers/build/legacyFakeTimers.js:558:18

  ● Health checks › Disabled health monitoring

    thrown: "Exceeded timeout of 5000 ms for a test.
    Use jest.setTimeout(newTimeout) to increase the timeout value, if this is a long-running test."

      63 |   })
      64 |
    > 65 |   test('Disabled health monitoring', async () => {
         |   ^
      66 |     process.env.FASTIFY_MICRO_DISABLE_SERVICE_HEALTH_MONITORING = 'true'
      67 |     jest.useFakeTimers('legacy')
      68 |     const healthCheck = jest.fn().mockResolvedValue(true)

      at tests/health.test.ts:65:3
      at Object.<anonymous> (tests/health.test.ts:3:1)

FAIL tests/graceful.test.ts (10.343 s)
  Graceful shutdown
    ✕ with custom handler (5003 ms)
    ✕ with custom async handler (5001 ms)

  ● Graceful shutdown › with custom handler

    FastifyError: fastify-plugin: fastify-micro:sentry - expected '3.x' fastify version, '4.3.0' is installed

      127 |   if (!name) return
      128 |   this[registeredPlugins].push(name)
    > 129 | }
          |  ^
      130 |
      131 | function registerPlugin (fn) {
      132 |   registerPluginName.call(this, fn)

      at Object.checkVersion (../../../VariantsDeps/fastify/variant13/fastify/lib/pluginUtils.js:129:11)
      at Object.registerPlugin (../../../VariantsDeps/fastify/variant13/fastify/lib/pluginUtils.js:143:16)
      at Boot.override (../../../VariantsDeps/fastify/variant13/fastify/lib/pluginOverride.js:35:57)
      at Plugin.Object.<anonymous>.Plugin.exec (../../../VariantsDeps/fastify/variant13/fastify/node_modules/avvio/plugin.js:79:33)
      at Boot.loadPlugin (../../../VariantsDeps/fastify/variant13/fastify/node_modules/avvio/plugin.js:272:10)

  ● Graceful shutdown › with custom handler

    thrown: "Exceeded timeout of 5000 ms for a test.
    Use jest.setTimeout(newTimeout) to increase the timeout value, if this is a long-running test."

      3 |
      4 | describe('Graceful shutdown', () => {
    > 5 |   test('with custom handler', async () => {
        |   ^
      6 |     const server = createServer({ name: 'foo' })
      7 |     server.addHook('onClose', (fastify, done) => {
      8 |       expect(fastify.name).toEqual('foo')

      at tests/graceful.test.ts:5:3
      at Object.<anonymous> (tests/graceful.test.ts:4:1)

  ● Graceful shutdown › with custom async handler

    FastifyError: fastify-plugin: fastify-micro:sentry - expected '3.x' fastify version, '4.3.0' is installed

      127 |   if (!name) return
      128 |   this[registeredPlugins].push(name)
    > 129 | }
          |  ^
      130 |
      131 | function registerPlugin (fn) {
      132 |   registerPluginName.call(this, fn)

      at Object.checkVersion (../../../VariantsDeps/fastify/variant13/fastify/lib/pluginUtils.js:129:11)
      at Object.registerPlugin (../../../VariantsDeps/fastify/variant13/fastify/lib/pluginUtils.js:143:16)
      at Boot.override (../../../VariantsDeps/fastify/variant13/fastify/lib/pluginOverride.js:35:57)
      at Plugin.Object.<anonymous>.Plugin.exec (../../../VariantsDeps/fastify/variant13/fastify/node_modules/avvio/plugin.js:79:33)
      at Boot.loadPlugin (../../../VariantsDeps/fastify/variant13/fastify/node_modules/avvio/plugin.js:272:10)

  ● Graceful shutdown › with custom async handler

    thrown: "Exceeded timeout of 5000 ms for a test.
    Use jest.setTimeout(newTimeout) to increase the timeout value, if this is a long-running test."

      13 |   })
      14 |
    > 15 |   test('with custom async handler', async () => {
         |   ^
      16 |     const server = createServer({ name: 'foo' })
      17 |     server.addHook('onClose', async fastify => {
      18 |       await delay(100)

      at tests/graceful.test.ts:15:3
      at Object.<anonymous> (tests/graceful.test.ts:4:1)

FAIL tests/logger.test.ts (23.256 s)
  Logger
    ✕ name property (5001 ms)
    ✕ redact environment variables (5001 ms)
    ✕ redact log paths (5001 ms)
    ✕ request ID generator (5001 ms)

  ● Logger › name property

    thrown: "Exceeded timeout of 5000 ms for a test.
    Use jest.setTimeout(newTimeout) to increase the timeout value, if this is a long-running test."

      2 |
      3 | describe('Logger', () => {
    > 4 |   test('name property', async () => {
        |   ^
      5 |     const [logLine] = await testLogs(logLine => logLine.dataTestID === 'name')
      6 |     expect(logLine.from).toEqual('foo')
      7 |   })

      at tests/logger.test.ts:4:3
      at Object.<anonymous> (tests/logger.test.ts:3:1)

  ● Logger › redact environment variables

    thrown: "Exceeded timeout of 5000 ms for a test.
    Use jest.setTimeout(newTimeout) to increase the timeout value, if this is a long-running test."

       7 |   })
       8 |
    >  9 |   test('redact environment variables', async () => {
         |   ^
      10 |     const [logLine] = await testLogs(
      11 |       logLine => logLine.dataTestID === 'redact-env'
      12 |     )

      at tests/logger.test.ts:9:3
      at Object.<anonymous> (tests/logger.test.ts:3:1)

  ● Logger › redact log paths

    thrown: "Exceeded timeout of 5000 ms for a test.
    Use jest.setTimeout(newTimeout) to increase the timeout value, if this is a long-running test."

      14 |   })
      15 |
    > 16 |   test('redact log paths', async () => {
         |   ^
      17 |     const [logLine] = await testLogs(
      18 |       logLine => logLine.dataTestID === 'redact-path'
      19 |     )

      at tests/logger.test.ts:16:3
      at Object.<anonymous> (tests/logger.test.ts:3:1)

  ● Logger › request ID generator

    thrown: "Exceeded timeout of 5000 ms for a test.
    Use jest.setTimeout(newTimeout) to increase the timeout value, if this is a long-running test."

      21 |   })
      22 |
    > 23 |   test('request ID generator', async () => {
         |   ^
      24 |     type ReqResLog = { reqId: string }
      25 |
      26 |     const [req1, res1, req2, res2, req3, res3, req4, res4] =

      at tests/logger.test.ts:23:3
      at Object.<anonymous> (tests/logger.test.ts:3:1)

ts-jest[ts-jest-transformer] (WARN) Got a `.js` file to compile while `allowJs` option is not set to `true` (file: /data/js-variants/multee/VariantsDeps/fastify/variant12/fastify/fastify.js). To fix this:
  - if you want TypeScript to process JS files, set `allowJs` to `true` in your TypeScript config (usually tsconfig.json)
  - if you do not want TypeScript to process your `.js` files, in your Jest config change the `transform` key which value is `ts-jest` so that it does not match `.js` files anymore
Browserslist: caniuse-lite is outdated. Please run:
  npx browserslist@latest --update-db
  Why you should do it regularly: https://github.com/browserslist/browserslist#browsers-data-updating
ts-jest[ts-jest-transformer] (WARN) Got a `.js` file to compile while `allowJs` option is not set to `true` (file: /data/js-variants/multee/VariantsDeps/fastify/variant12/fastify/lib/symbols.js). To fix this:
  - if you want TypeScript to process JS files, set `allowJs` to `true` in your TypeScript config (usually tsconfig.json)
  - if you do not want TypeScript to process your `.js` files, in your Jest config change the `transform` key which value is `ts-jest` so that it does not match `.js` files anymore
ts-jest[ts-jest-transformer] (WARN) Got a `.js` file to compile while `allowJs` option is not set to `true` (file: /data/js-variants/multee/VariantsDeps/fastify/variant12/fastify/lib/server.js). To fix this:
  - if you want TypeScript to process JS files, set `allowJs` to `true` in your TypeScript config (usually tsconfig.json)
  - if you do not want TypeScript to process your `.js` files, in your Jest config change the `transform` key which value is `ts-jest` so that it does not match `.js` files anymore
ts-jest[ts-jest-transformer] (WARN) Got a `.js` file to compile while `allowJs` option is not set to `true` (file: /data/js-variants/multee/VariantsDeps/fastify/variant12/fastify/lib/warnings.js). To fix this:
  - if you want TypeScript to process JS files, set `allowJs` to `true` in your TypeScript config (usually tsconfig.json)
  - if you do not want TypeScript to process your `.js` files, in your Jest config change the `transform` key which value is `ts-jest` so that it does not match `.js` files anymore
ts-jest[ts-jest-transformer] (WARN) Got a `.js` file to compile while `allowJs` option is not set to `true` (file: /data/js-variants/multee/VariantsDeps/fastify/variant12/fastify/lib/errors.js). To fix this:
  - if you want TypeScript to process JS files, set `allowJs` to `true` in your TypeScript config (usually tsconfig.json)
  - if you do not want TypeScript to process your `.js` files, in your Jest config change the `transform` key which value is `ts-jest` so that it does not match `.js` files anymore
ts-jest[ts-jest-transformer] (WARN) Got a `.js` file to compile while `allowJs` option is not set to `true` (file: /data/js-variants/multee/VariantsDeps/fastify/variant12/fastify/lib/reply.js). To fix this:
  - if you want TypeScript to process JS files, set `allowJs` to `true` in your TypeScript config (usually tsconfig.json)
  - if you do not want TypeScript to process your `.js` files, in your Jest config change the `transform` key which value is `ts-jest` so that it does not match `.js` files anymore
ts-jest[ts-jest-transformer] (WARN) Got a `.js` file to compile while `allowJs` option is not set to `true` (file: /data/js-variants/multee/VariantsDeps/fastify/variant12/fastify/lib/hooks.js). To fix this:
  - if you want TypeScript to process JS files, set `allowJs` to `true` in your TypeScript config (usually tsconfig.json)
  - if you do not want TypeScript to process your `.js` files, in your Jest config change the `transform` key which value is `ts-jest` so that it does not match `.js` files anymore
ts-jest[ts-jest-transformer] (WARN) Got a `.js` file to compile while `allowJs` option is not set to `true` (file: /data/js-variants/multee/VariantsDeps/fastify/variant12/fastify/lib/handleRequest.js). To fix this:
  - if you want TypeScript to process JS files, set `allowJs` to `true` in your TypeScript config (usually tsconfig.json)
  - if you do not want TypeScript to process your `.js` files, in your Jest config change the `transform` key which value is `ts-jest` so that it does not match `.js` files anymore
ts-jest[ts-jest-transformer] (WARN) Got a `.js` file to compile while `allowJs` option is not set to `true` (file: /data/js-variants/multee/VariantsDeps/fastify/variant12/fastify/lib/validation.js). To fix this:
  - if you want TypeScript to process JS files, set `allowJs` to `true` in your TypeScript config (usually tsconfig.json)
  - if you do not want TypeScript to process your `.js` files, in your Jest config change the `transform` key which value is `ts-jest` so that it does not match `.js` files anymore
ts-jest[ts-jest-transformer] (WARN) Got a `.js` file to compile while `allowJs` option is not set to `true` (file: /data/js-variants/multee/VariantsDeps/fastify/variant12/fastify/lib/wrapThenable.js). To fix this:
  - if you want TypeScript to process JS files, set `allowJs` to `true` in your TypeScript config (usually tsconfig.json)
  - if you do not want TypeScript to process your `.js` files, in your Jest config change the `transform` key which value is `ts-jest` so that it does not match `.js` files anymore
ts-jest[ts-jest-transformer] (WARN) Got a `.js` file to compile while `allowJs` option is not set to `true` (file: /data/js-variants/multee/VariantsDeps/fastify/variant12/fastify/lib/logger.js). To fix this:
  - if you want TypeScript to process JS files, set `allowJs` to `true` in your TypeScript config (usually tsconfig.json)
  - if you do not want TypeScript to process your `.js` files, in your Jest config change the `transform` key which value is `ts-jest` so that it does not match `.js` files anymore
ts-jest[ts-jest-transformer] (WARN) Got a `.js` file to compile while `allowJs` option is not set to `true` (file: /data/js-variants/multee/VariantsDeps/fastify/variant12/fastify/lib/error-handler.js). To fix this:
  - if you want TypeScript to process JS files, set `allowJs` to `true` in your TypeScript config (usually tsconfig.json)
  - if you do not want TypeScript to process your `.js` files, in your Jest config change the `transform` key which value is `ts-jest` so that it does not match `.js` files anymore
ts-jest[ts-jest-transformer] (WARN) Got a `.js` file to compile while `allowJs` option is not set to `true` (file: /data/js-variants/multee/VariantsDeps/fastify/variant12/fastify/lib/schemas.js). To fix this:
  - if you want TypeScript to process JS files, set `allowJs` to `true` in your TypeScript config (usually tsconfig.json)
  - if you do not want TypeScript to process your `.js` files, in your Jest config change the `transform` key which value is `ts-jest` so that it does not match `.js` files anymore
ts-jest[ts-jest-transformer] (WARN) Got a `.js` file to compile while `allowJs` option is not set to `true` (file: /data/js-variants/multee/VariantsDeps/fastify/variant12/fastify/lib/error-serializer.js). To fix this:
  - if you want TypeScript to process JS files, set `allowJs` to `true` in your TypeScript config (usually tsconfig.json)
  - if you do not want TypeScript to process your `.js` files, in your Jest config change the `transform` key which value is `ts-jest` so that it does not match `.js` files anymore
ts-jest[ts-jest-transformer] (WARN) Got a `.js` file to compile while `allowJs` option is not set to `true` (file: /data/js-variants/multee/VariantsDeps/fastify/variant12/fastify/lib/request.js). To fix this:
  - if you want TypeScript to process JS files, set `allowJs` to `true` in your TypeScript config (usually tsconfig.json)
  - if you do not want TypeScript to process your `.js` files, in your Jest config change the `transform` key which value is `ts-jest` so that it does not match `.js` files anymore
ts-jest[ts-jest-transformer] (WARN) Got a `.js` file to compile while `allowJs` option is not set to `true` (file: /data/js-variants/multee/VariantsDeps/fastify/variant12/fastify/lib/decorate.js). To fix this:
  - if you want TypeScript to process JS files, set `allowJs` to `true` in your TypeScript config (usually tsconfig.json)
  - if you do not want TypeScript to process your `.js` files, in your Jest config change the `transform` key which value is `ts-jest` so that it does not match `.js` files anymore
ts-jest[ts-jest-transformer] (WARN) Got a `.js` file to compile while `allowJs` option is not set to `true` (file: /data/js-variants/multee/VariantsDeps/fastify/variant12/fastify/lib/contentTypeParser.js). To fix this:
  - if you want TypeScript to process JS files, set `allowJs` to `true` in your TypeScript config (usually tsconfig.json)
  - if you do not want TypeScript to process your `.js` files, in your Jest config change the `transform` key which value is `ts-jest` so that it does not match `.js` files anymore
ts-jest[ts-jest-transformer] (WARN) Got a `.js` file to compile while `allowJs` option is not set to `true` (file: /data/js-variants/multee/VariantsDeps/fastify/variant12/fastify/lib/schema-controller.js). To fix this:
  - if you want TypeScript to process JS files, set `allowJs` to `true` in your TypeScript config (usually tsconfig.json)
  - if you do not want TypeScript to process your `.js` files, in your Jest config change the `transform` key which value is `ts-jest` so that it does not match `.js` files anymore
ts-jest[ts-jest-transformer] (WARN) Got a `.js` file to compile while `allowJs` option is not set to `true` (file: /data/js-variants/multee/VariantsDeps/fastify/variant12/fastify/lib/pluginUtils.js). To fix this:
  - if you want TypeScript to process JS files, set `allowJs` to `true` in your TypeScript config (usually tsconfig.json)
  - if you do not want TypeScript to process your `.js` files, in your Jest config change the `transform` key which value is `ts-jest` so that it does not match `.js` files anymore
ts-jest[ts-jest-transformer] (WARN) Got a `.js` file to compile while `allowJs` option is not set to `true` (file: /data/js-variants/multee/VariantsDeps/fastify/variant12/fastify/lib/reqIdGenFactory.js). To fix this:
  - if you want TypeScript to process JS files, set `allowJs` to `true` in your TypeScript config (usually tsconfig.json)
  - if you do not want TypeScript to process your `.js` files, in your Jest config change the `transform` key which value is `ts-jest` so that it does not match `.js` files anymore
ts-jest[ts-jest-transformer] (WARN) Got a `.js` file to compile while `allowJs` option is not set to `true` (file: /data/js-variants/multee/VariantsDeps/fastify/variant12/fastify/lib/route.js). To fix this:
  - if you want TypeScript to process JS files, set `allowJs` to `true` in your TypeScript config (usually tsconfig.json)
  - if you do not want TypeScript to process your `.js` files, in your Jest config change the `transform` key which value is `ts-jest` so that it does not match `.js` files anymore
ts-jest[ts-jest-transformer] (WARN) Got a `.js` file to compile while `allowJs` option is not set to `true` (file: /data/js-variants/multee/VariantsDeps/fastify/variant12/fastify/lib/context.js). To fix this:
  - if you want TypeScript to process JS files, set `allowJs` to `true` in your TypeScript config (usually tsconfig.json)
  - if you do not want TypeScript to process your `.js` files, in your Jest config change the `transform` key which value is `ts-jest` so that it does not match `.js` files anymore
ts-jest[ts-jest-transformer] (WARN) Got a `.js` file to compile while `allowJs` option is not set to `true` (file: /data/js-variants/multee/VariantsDeps/fastify/variant12/fastify/lib/headRoute.js). To fix this:
  - if you want TypeScript to process JS files, set `allowJs` to `true` in your TypeScript config (usually tsconfig.json)
  - if you do not want TypeScript to process your `.js` files, in your Jest config change the `transform` key which value is `ts-jest` so that it does not match `.js` files anymore
ts-jest[ts-jest-transformer] (WARN) Got a `.js` file to compile while `allowJs` option is not set to `true` (file: /data/js-variants/multee/VariantsDeps/fastify/variant12/fastify/lib/fourOhFour.js). To fix this:
  - if you want TypeScript to process JS files, set `allowJs` to `true` in your TypeScript config (usually tsconfig.json)
  - if you do not want TypeScript to process your `.js` files, in your Jest config change the `transform` key which value is `ts-jest` so that it does not match `.js` files anymore
ts-jest[ts-jest-transformer] (WARN) Got a `.js` file to compile while `allowJs` option is not set to `true` (file: /data/js-variants/multee/VariantsDeps/fastify/variant12/fastify/lib/initialConfigValidation.js). To fix this:
  - if you want TypeScript to process JS files, set `allowJs` to `true` in your TypeScript config (usually tsconfig.json)
  - if you do not want TypeScript to process your `.js` files, in your Jest config change the `transform` key which value is `ts-jest` so that it does not match `.js` files anymore
ts-jest[ts-jest-transformer] (WARN) Got a `.js` file to compile while `allowJs` option is not set to `true` (file: /data/js-variants/multee/VariantsDeps/fastify/variant12/fastify/lib/configValidator.js). To fix this:
  - if you want TypeScript to process JS files, set `allowJs` to `true` in your TypeScript config (usually tsconfig.json)
  - if you do not want TypeScript to process your `.js` files, in your Jest config change the `transform` key which value is `ts-jest` so that it does not match `.js` files anymore
ts-jest[ts-jest-transformer] (WARN) Got a `.js` file to compile while `allowJs` option is not set to `true` (file: /data/js-variants/multee/VariantsDeps/fastify/variant12/fastify/lib/pluginOverride.js). To fix this:
  - if you want TypeScript to process JS files, set `allowJs` to `true` in your TypeScript config (usually tsconfig.json)
  - if you do not want TypeScript to process your `.js` files, in your Jest config change the `transform` key which value is `ts-jest` so that it does not match `.js` files anymore
ts-jest[ts-jest-transformer] (WARN) Got a `.js` file to compile while `allowJs` option is not set to `true` (file: /data/js-variants/multee/VariantsDeps/fastify/variant12/fastify/lib/noop-set.js). To fix this:
  - if you want TypeScript to process JS files, set `allowJs` to `true` in your TypeScript config (usually tsconfig.json)
  - if you do not want TypeScript to process your `.js` files, in your Jest config change the `transform` key which value is `ts-jest` so that it does not match `.js` files anymore
FAIL tests/basics.test.ts (22.531 s)
  Basics
    ✓ The specified `name` property is injected (38 ms)
    ✕ Default port should be 3000 (5001 ms)
    ✕ Port should be configurable via the environment (5001 ms)
    ✕ Port can be passed as a second argument to `startServer` (5002 ms)

  ● Basics › Default port should be 3000

    FastifyError: fastify-plugin: fastify-micro:sentry - expected '3.x' fastify version, '4.3.0' is installed

      127 |   if (!name) return
      128 |   this[registeredPlugins].push(name)
    > 129 | }
          |  ^
      130 |
      131 | function registerPlugin (fn) {
      132 |   registerPluginName.call(this, fn)

      at Object.checkVersion (../../../VariantsDeps/fastify/variant12/fastify/lib/pluginUtils.js:129:11)
      at Object.registerPlugin (../../../VariantsDeps/fastify/variant12/fastify/lib/pluginUtils.js:143:16)
      at Boot.override (../../../VariantsDeps/fastify/variant12/fastify/lib/pluginOverride.js:35:57)
      at Plugin.Object.<anonymous>.Plugin.exec (../../../VariantsDeps/fastify/variant12/fastify/node_modules/avvio/plugin.js:79:33)
      at Boot.loadPlugin (../../../VariantsDeps/fastify/variant12/fastify/node_modules/avvio/plugin.js:272:10)

  ● Basics › Default port should be 3000

    FastifyError: fastify-plugin: fastify-micro:sentry - expected '3.x' fastify version, '4.3.0' is installed

      127 |   if (!name) return
      128 |   this[registeredPlugins].push(name)
    > 129 | }
          |  ^
      130 |
      131 | function registerPlugin (fn) {
      132 |   registerPluginName.call(this, fn)

      at Object.checkVersion (../../../VariantsDeps/fastify/variant12/fastify/lib/pluginUtils.js:129:11)
      at Object.registerPlugin (../../../VariantsDeps/fastify/variant12/fastify/lib/pluginUtils.js:143:16)
      at Boot.override (../../../VariantsDeps/fastify/variant12/fastify/lib/pluginOverride.js:35:57)
      at Plugin.Object.<anonymous>.Plugin.exec (../../../VariantsDeps/fastify/variant12/fastify/node_modules/avvio/plugin.js:79:33)
      at Boot.loadPlugin (../../../VariantsDeps/fastify/variant12/fastify/node_modules/avvio/plugin.js:272:10)

  ● Basics › Default port should be 3000

    FastifyError: fastify-plugin: fastify-micro:sentry - expected '3.x' fastify version, '4.3.0' is installed

      127 |   if (!name) return
      128 |   this[registeredPlugins].push(name)
    > 129 | }
          |  ^
      130 |
      131 | function registerPlugin (fn) {
      132 |   registerPluginName.call(this, fn)

      at Object.checkVersion (../../../VariantsDeps/fastify/variant12/fastify/lib/pluginUtils.js:129:11)
      at Object.registerPlugin (../../../VariantsDeps/fastify/variant12/fastify/lib/pluginUtils.js:143:16)
      at Boot.override (../../../VariantsDeps/fastify/variant12/fastify/lib/pluginOverride.js:35:57)
      at Plugin.Object.<anonymous>.Plugin.exec (../../../VariantsDeps/fastify/variant12/fastify/node_modules/avvio/plugin.js:79:33)
      at Boot.loadPlugin (../../../VariantsDeps/fastify/variant12/fastify/node_modules/avvio/plugin.js:272:10)

  ● Basics › Default port should be 3000

    thrown: "Exceeded timeout of 5000 ms for a test.
    Use jest.setTimeout(newTimeout) to increase the timeout value, if this is a long-running test."

      15 |   })
      16 |
    > 17 |   test('Default port should be 3000', async () => {
         |   ^
      18 |     const key = nanoid()
      19 |     const server = createServer()
      20 |     server.get('/', (_, res) => {

      at tests/basics.test.ts:17:3
      at Object.<anonymous> (tests/basics.test.ts:5:1)

  ● Basics › Port should be configurable via the environment

    FastifyError: fastify-plugin: fastify-micro:sentry - expected '3.x' fastify version, '4.3.0' is installed

      127 |   if (!name) return
      128 |   this[registeredPlugins].push(name)
    > 129 | }
          |  ^
      130 |
      131 | function registerPlugin (fn) {
      132 |   registerPluginName.call(this, fn)

      at Object.checkVersion (../../../VariantsDeps/fastify/variant12/fastify/lib/pluginUtils.js:129:11)
      at Object.registerPlugin (../../../VariantsDeps/fastify/variant12/fastify/lib/pluginUtils.js:143:16)
      at Boot.override (../../../VariantsDeps/fastify/variant12/fastify/lib/pluginOverride.js:35:57)
      at Plugin.Object.<anonymous>.Plugin.exec (../../../VariantsDeps/fastify/variant12/fastify/node_modules/avvio/plugin.js:79:33)
      at Boot.loadPlugin (../../../VariantsDeps/fastify/variant12/fastify/node_modules/avvio/plugin.js:272:10)

  ● Basics › Port should be configurable via the environment

    thrown: "Exceeded timeout of 5000 ms for a test.
    Use jest.setTimeout(newTimeout) to increase the timeout value, if this is a long-running test."

      27 |   })
      28 |
    > 29 |   test('Port should be configurable via the environment', async () => {
         |   ^
      30 |     process.env.PORT = '3001'
      31 |     const key = nanoid()
      32 |     const server = createServer()

      at tests/basics.test.ts:29:3
      at Object.<anonymous> (tests/basics.test.ts:5:1)

  ● Basics › Port can be passed as a second argument to `startServer`

    FastifyError: fastify-plugin: fastify-micro:sentry - expected '3.x' fastify version, '4.3.0' is installed

      127 |   if (!name) return
      128 |   this[registeredPlugins].push(name)
    > 129 | }
          |  ^
      130 |
      131 | function registerPlugin (fn) {
      132 |   registerPluginName.call(this, fn)

      at Object.checkVersion (../../../VariantsDeps/fastify/variant12/fastify/lib/pluginUtils.js:129:11)
      at Object.registerPlugin (../../../VariantsDeps/fastify/variant12/fastify/lib/pluginUtils.js:143:16)
      at Boot.override (../../../VariantsDeps/fastify/variant12/fastify/lib/pluginOverride.js:35:57)
      at Plugin.Object.<anonymous>.Plugin.exec (../../../VariantsDeps/fastify/variant12/fastify/node_modules/avvio/plugin.js:79:33)
      at Boot.loadPlugin (../../../VariantsDeps/fastify/variant12/fastify/node_modules/avvio/plugin.js:272:10)

  ● Basics › Port can be passed as a second argument to `startServer`

    FastifyError: fastify-plugin: Plugin did not start in time: 'bound _after'. You may have forgotten to call 'done' function or to resolve a Promise

      618 |     // config issue on the load balancer side.
      619 |     this.log.trace({ err }, 'client error')
    > 620 |     // Copying standard node behaviour
          |                                       ^
      621 |     // https://github.com/nodejs/node/blob/6ca23d7846cb47e84fd344543e394e50938540be/lib/_http_server.js#L666
      622 |
      623 |     // If the socket is not writable, there is no reason to try to send data.

      at manageErr (../../../VariantsDeps/fastify/variant12/fastify/fastify.js:620:87)
      at ../../../VariantsDeps/fastify/variant12/fastify/fastify.js:607:11
      at Object._encapsulateThreeParam (../../../VariantsDeps/fastify/variant12/fastify/node_modules/avvio/boot.js:557:7)
      at Boot.timeoutCall (../../../VariantsDeps/fastify/variant12/fastify/node_modules/avvio/boot.js:453:5)
      at Boot.callWithCbOrNextTick (../../../VariantsDeps/fastify/variant12/fastify/node_modules/avvio/boot.js:435:19)
      at release (../../../VariantsDeps/fastify/variant12/fastify/node_modules/fastq/queue.js:149:16)
      at Object.resume (../../../VariantsDeps/fastify/variant12/fastify/node_modules/fastq/queue.js:82:7)
      at ../../../VariantsDeps/fastify/variant12/fastify/node_modules/avvio/boot.js:174:18
      at ../../../VariantsDeps/fastify/variant12/fastify/node_modules/avvio/plugin.js:275:7
      at done (../../../VariantsDeps/fastify/variant12/fastify/node_modules/avvio/plugin.js:200:5)

  ● Basics › Port can be passed as a second argument to `startServer`

    FastifyError: fastify-plugin: Plugin did not start in time: 'bound _after'. You may have forgotten to call 'done' function or to resolve a Promise

      618 |     // config issue on the load balancer side.
      619 |     this.log.trace({ err }, 'client error')
    > 620 |     // Copying standard node behaviour
          |                                       ^
      621 |     // https://github.com/nodejs/node/blob/6ca23d7846cb47e84fd344543e394e50938540be/lib/_http_server.js#L666
      622 |
      623 |     // If the socket is not writable, there is no reason to try to send data.

      at manageErr (../../../VariantsDeps/fastify/variant12/fastify/fastify.js:620:87)
      at ../../../VariantsDeps/fastify/variant12/fastify/fastify.js:607:11
      at Object._encapsulateThreeParam (../../../VariantsDeps/fastify/variant12/fastify/node_modules/avvio/boot.js:557:7)
      at Boot.timeoutCall (../../../VariantsDeps/fastify/variant12/fastify/node_modules/avvio/boot.js:453:5)
      at Boot.callWithCbOrNextTick (../../../VariantsDeps/fastify/variant12/fastify/node_modules/avvio/boot.js:435:19)
      at release (../../../VariantsDeps/fastify/variant12/fastify/node_modules/fastq/queue.js:149:16)
      at Object.resume (../../../VariantsDeps/fastify/variant12/fastify/node_modules/fastq/queue.js:82:7)
      at ../../../VariantsDeps/fastify/variant12/fastify/node_modules/avvio/boot.js:174:18
      at ../../../VariantsDeps/fastify/variant12/fastify/node_modules/avvio/plugin.js:275:7
      at done (../../../VariantsDeps/fastify/variant12/fastify/node_modules/avvio/plugin.js:200:5)

  ● Basics › Port can be passed as a second argument to `startServer`

    FastifyError: fastify-plugin: Plugin did not start in time: 'bound _after'. You may have forgotten to call 'done' function or to resolve a Promise

      618 |     // config issue on the load balancer side.
      619 |     this.log.trace({ err }, 'client error')
    > 620 |     // Copying standard node behaviour
          |                                       ^
      621 |     // https://github.com/nodejs/node/blob/6ca23d7846cb47e84fd344543e394e50938540be/lib/_http_server.js#L666
      622 |
      623 |     // If the socket is not writable, there is no reason to try to send data.

      at manageErr (../../../VariantsDeps/fastify/variant12/fastify/fastify.js:620:87)
      at ../../../VariantsDeps/fastify/variant12/fastify/fastify.js:607:11
      at Object._encapsulateThreeParam (../../../VariantsDeps/fastify/variant12/fastify/node_modules/avvio/boot.js:557:7)
      at Boot.timeoutCall (../../../VariantsDeps/fastify/variant12/fastify/node_modules/avvio/boot.js:453:5)
      at Boot.callWithCbOrNextTick (../../../VariantsDeps/fastify/variant12/fastify/node_modules/avvio/boot.js:435:19)
      at release (../../../VariantsDeps/fastify/variant12/fastify/node_modules/fastq/queue.js:149:16)
      at Object.resume (../../../VariantsDeps/fastify/variant12/fastify/node_modules/fastq/queue.js:82:7)
      at ../../../VariantsDeps/fastify/variant12/fastify/node_modules/avvio/boot.js:174:18
      at ../../../VariantsDeps/fastify/variant12/fastify/node_modules/avvio/plugin.js:275:7
      at done (../../../VariantsDeps/fastify/variant12/fastify/node_modules/avvio/plugin.js:200:5)

  ● Basics › Port can be passed as a second argument to `startServer`

    thrown: "Exceeded timeout of 5000 ms for a test.
    Use jest.setTimeout(newTimeout) to increase the timeout value, if this is a long-running test."

      41 |   })
      42 |
    > 43 |   test('Port can be passed as a second argument to `startServer`', async () => {
         |   ^
      44 |     const server = createServer()
      45 |     const key = nanoid()
      46 |     server.get('/', (_, res) => {

      at tests/basics.test.ts:43:3
      at Object.<anonymous> (tests/basics.test.ts:5:1)

FAIL tests/plugins.test.ts (15.369 s)
  Plugins
    ✕ Loading plugins & routes from filesystem (5003 ms)
    ✕ Graceful exit (5001 ms)
    ✕ Graceful exit with a slow onClose hook (5000 ms)

  ● Plugins › Loading plugins & routes from filesystem

    FastifyError: fastify-plugin: fastify-micro:sentry - expected '3.x' fastify version, '4.3.0' is installed

      127 |   if (!name) return
      128 |   this[registeredPlugins].push(name)
    > 129 | }
          |  ^
      130 |
      131 | function registerPlugin (fn) {
      132 |   registerPluginName.call(this, fn)

      at Object.checkVersion (../../../VariantsDeps/fastify/variant12/fastify/lib/pluginUtils.js:129:11)
      at Object.registerPlugin (../../../VariantsDeps/fastify/variant12/fastify/lib/pluginUtils.js:143:16)
      at Boot.override (../../../VariantsDeps/fastify/variant12/fastify/lib/pluginOverride.js:35:57)
      at Plugin.Object.<anonymous>.Plugin.exec (../../../VariantsDeps/fastify/variant12/fastify/node_modules/avvio/plugin.js:79:33)
      at Boot.loadPlugin (../../../VariantsDeps/fastify/variant12/fastify/node_modules/avvio/plugin.js:272:10)

  ● Plugins › Loading plugins & routes from filesystem

    FastifyError: fastify-plugin: Plugin did not start in time: 'bound _after'. You may have forgotten to call 'done' function or to resolve a Promise

      618 |     // config issue on the load balancer side.
      619 |     this.log.trace({ err }, 'client error')
    > 620 |     // Copying standard node behaviour
          |                                       ^
      621 |     // https://github.com/nodejs/node/blob/6ca23d7846cb47e84fd344543e394e50938540be/lib/_http_server.js#L666
      622 |
      623 |     // If the socket is not writable, there is no reason to try to send data.

      at manageErr (../../../VariantsDeps/fastify/variant12/fastify/fastify.js:620:87)
      at ../../../VariantsDeps/fastify/variant12/fastify/fastify.js:607:11
      at Object._encapsulateThreeParam (../../../VariantsDeps/fastify/variant12/fastify/node_modules/avvio/boot.js:557:7)
      at Boot.timeoutCall (../../../VariantsDeps/fastify/variant12/fastify/node_modules/avvio/boot.js:453:5)
      at Boot.callWithCbOrNextTick (../../../VariantsDeps/fastify/variant12/fastify/node_modules/avvio/boot.js:435:19)
      at release (../../../VariantsDeps/fastify/variant12/fastify/node_modules/fastq/queue.js:149:16)
      at Object.resume (../../../VariantsDeps/fastify/variant12/fastify/node_modules/fastq/queue.js:82:7)
      at ../../../VariantsDeps/fastify/variant12/fastify/node_modules/avvio/boot.js:174:18
      at ../../../VariantsDeps/fastify/variant12/fastify/node_modules/avvio/plugin.js:275:7
      at done (../../../VariantsDeps/fastify/variant12/fastify/node_modules/avvio/plugin.js:200:5)

  ● Plugins › Loading plugins & routes from filesystem

    FastifyError: fastify-plugin: Plugin did not start in time: 'bound _after'. You may have forgotten to call 'done' function or to resolve a Promise

      618 |     // config issue on the load balancer side.
      619 |     this.log.trace({ err }, 'client error')
    > 620 |     // Copying standard node behaviour
          |                                       ^
      621 |     // https://github.com/nodejs/node/blob/6ca23d7846cb47e84fd344543e394e50938540be/lib/_http_server.js#L666
      622 |
      623 |     // If the socket is not writable, there is no reason to try to send data.

      at manageErr (../../../VariantsDeps/fastify/variant12/fastify/fastify.js:620:87)
      at ../../../VariantsDeps/fastify/variant12/fastify/fastify.js:607:11
      at Object._encapsulateThreeParam (../../../VariantsDeps/fastify/variant12/fastify/node_modules/avvio/boot.js:557:7)
      at Boot.timeoutCall (../../../VariantsDeps/fastify/variant12/fastify/node_modules/avvio/boot.js:453:5)
      at Boot.callWithCbOrNextTick (../../../VariantsDeps/fastify/variant12/fastify/node_modules/avvio/boot.js:435:19)
      at release (../../../VariantsDeps/fastify/variant12/fastify/node_modules/fastq/queue.js:149:16)
      at Object.resume (../../../VariantsDeps/fastify/variant12/fastify/node_modules/fastq/queue.js:82:7)
      at ../../../VariantsDeps/fastify/variant12/fastify/node_modules/avvio/boot.js:174:18
      at ../../../VariantsDeps/fastify/variant12/fastify/node_modules/avvio/plugin.js:275:7
      at done (../../../VariantsDeps/fastify/variant12/fastify/node_modules/avvio/plugin.js:200:5)

  ● Plugins › Loading plugins & routes from filesystem

    thrown: "Exceeded timeout of 5000 ms for a test.
    Use jest.setTimeout(newTimeout) to increase the timeout value, if this is a long-running test."

      11 |   })
      12 |
    > 13 |   test('Loading plugins & routes from filesystem', async () => {
         |   ^
      14 |     const server = createServer({
      15 |       plugins: {
      16 |         dir: path.resolve(__dirname, './jigs/plugins')

      at tests/plugins.test.ts:13:3
      at Object.<anonymous> (tests/plugins.test.ts:8:1)

  ● Plugins › Graceful exit

    FastifyError: fastify-plugin: fastify-micro:sentry - expected '3.x' fastify version, '4.3.0' is installed

      127 |   if (!name) return
      128 |   this[registeredPlugins].push(name)
    > 129 | }
          |  ^
      130 |
      131 | function registerPlugin (fn) {
      132 |   registerPluginName.call(this, fn)

      at Object.checkVersion (../../../VariantsDeps/fastify/variant12/fastify/lib/pluginUtils.js:129:11)
      at Object.registerPlugin (../../../VariantsDeps/fastify/variant12/fastify/lib/pluginUtils.js:143:16)
      at Boot.override (../../../VariantsDeps/fastify/variant12/fastify/lib/pluginOverride.js:35:57)
      at Plugin.Object.<anonymous>.Plugin.exec (../../../VariantsDeps/fastify/variant12/fastify/node_modules/avvio/plugin.js:79:33)
      at Boot.loadPlugin (../../../VariantsDeps/fastify/variant12/fastify/node_modules/avvio/plugin.js:272:10)

  ● Plugins › Graceful exit

    thrown: "Exceeded timeout of 5000 ms for a test.
    Use jest.setTimeout(newTimeout) to increase the timeout value, if this is a long-running test."

      27 |   })
      28 |
    > 29 |   test('Graceful exit', async () => {
         |   ^
      30 |     //jest.setTimeout(10000)
      31 |     const key = nanoid()
      32 |     const server = createServer()

      at tests/plugins.test.ts:29:3
      at Object.<anonymous> (tests/plugins.test.ts:8:1)

  ● Plugins › Graceful exit with a slow onClose hook

    FastifyError: fastify-plugin: fastify-micro:sentry - expected '3.x' fastify version, '4.3.0' is installed

      127 |   if (!name) return
      128 |   this[registeredPlugins].push(name)
    > 129 | }
          |  ^
      130 |
      131 | function registerPlugin (fn) {
      132 |   registerPluginName.call(this, fn)

      at Object.checkVersion (../../../VariantsDeps/fastify/variant12/fastify/lib/pluginUtils.js:129:11)
      at Object.registerPlugin (../../../VariantsDeps/fastify/variant12/fastify/lib/pluginUtils.js:143:16)
      at Boot.override (../../../VariantsDeps/fastify/variant12/fastify/lib/pluginOverride.js:35:57)
      at Plugin.Object.<anonymous>.Plugin.exec (../../../VariantsDeps/fastify/variant12/fastify/node_modules/avvio/plugin.js:79:33)
      at Boot.loadPlugin (../../../VariantsDeps/fastify/variant12/fastify/node_modules/avvio/plugin.js:272:10)

  ● Plugins › Graceful exit with a slow onClose hook

    FastifyError: fastify-plugin: Plugin did not start in time: 'bound _after'. You may have forgotten to call 'done' function or to resolve a Promise

      618 |     // config issue on the load balancer side.
      619 |     this.log.trace({ err }, 'client error')
    > 620 |     // Copying standard node behaviour
          |                                       ^
      621 |     // https://github.com/nodejs/node/blob/6ca23d7846cb47e84fd344543e394e50938540be/lib/_http_server.js#L666
      622 |
      623 |     // If the socket is not writable, there is no reason to try to send data.

      at manageErr (../../../VariantsDeps/fastify/variant12/fastify/fastify.js:620:87)
      at ../../../VariantsDeps/fastify/variant12/fastify/fastify.js:607:11
      at Object._encapsulateThreeParam (../../../VariantsDeps/fastify/variant12/fastify/node_modules/avvio/boot.js:557:7)
      at Boot.timeoutCall (../../../VariantsDeps/fastify/variant12/fastify/node_modules/avvio/boot.js:453:5)
      at Boot.callWithCbOrNextTick (../../../VariantsDeps/fastify/variant12/fastify/node_modules/avvio/boot.js:435:19)
      at release (../../../VariantsDeps/fastify/variant12/fastify/node_modules/fastq/queue.js:149:16)
      at Object.resume (../../../VariantsDeps/fastify/variant12/fastify/node_modules/fastq/queue.js:82:7)
      at ../../../VariantsDeps/fastify/variant12/fastify/node_modules/avvio/boot.js:174:18
      at ../../../VariantsDeps/fastify/variant12/fastify/node_modules/avvio/plugin.js:275:7
      at done (../../../VariantsDeps/fastify/variant12/fastify/node_modules/avvio/plugin.js:200:5)

  ● Plugins › Graceful exit with a slow onClose hook

    thrown: "Exceeded timeout of 5000 ms for a test.
    Use jest.setTimeout(newTimeout) to increase the timeout value, if this is a long-running test."

      43 |   })
      44 |
    > 45 |   test('Graceful exit with a slow onClose hook', async () => {
         |   ^
      46 |     const key = nanoid()
      47 |     const server = createServer()
      48 |     server.get('/', async (_, res) => {

      at tests/plugins.test.ts:45:3
      at Object.<anonymous> (tests/plugins.test.ts:8:1)

FAIL tests/health.test.ts (20.373 s)
  Health checks
    ✕ Default configuration exposes a /_health route (5002 ms)
    ✕ Custom health check handler is called at startup and every 5 seconds (5001 ms)
    ✕ Custom health check throwing results in 503 (5001 ms)
    ✕ Disabled health monitoring (5002 ms)

  ● Health checks › Default configuration exposes a /_health route

    FastifyError: fastify-plugin: fastify-micro:sentry - expected '3.x' fastify version, '4.3.0' is installed

      127 |   if (!name) return
      128 |   this[registeredPlugins].push(name)
    > 129 | }
          |  ^
      130 |
      131 | function registerPlugin (fn) {
      132 |   registerPluginName.call(this, fn)

      at Object.checkVersion (../../../VariantsDeps/fastify/variant12/fastify/lib/pluginUtils.js:129:11)
      at Object.registerPlugin (../../../VariantsDeps/fastify/variant12/fastify/lib/pluginUtils.js:143:16)
      at Boot.override (../../../VariantsDeps/fastify/variant12/fastify/lib/pluginOverride.js:35:57)
      at Plugin.Object.<anonymous>.Plugin.exec (../../../VariantsDeps/fastify/variant12/fastify/node_modules/avvio/plugin.js:79:33)
      at Boot.loadPlugin (../../../VariantsDeps/fastify/variant12/fastify/node_modules/avvio/plugin.js:272:10)

  ● Health checks › Default configuration exposes a /_health route

    FastifyError: fastify-plugin: Plugin did not start in time: 'bound _after'. You may have forgotten to call 'done' function or to resolve a Promise

      618 |     // config issue on the load balancer side.
      619 |     this.log.trace({ err }, 'client error')
    > 620 |     // Copying standard node behaviour
          |                                       ^
      621 |     // https://github.com/nodejs/node/blob/6ca23d7846cb47e84fd344543e394e50938540be/lib/_http_server.js#L666
      622 |
      623 |     // If the socket is not writable, there is no reason to try to send data.

      at manageErr (../../../VariantsDeps/fastify/variant12/fastify/fastify.js:620:87)
      at ../../../VariantsDeps/fastify/variant12/fastify/fastify.js:607:11
      at Object._encapsulateThreeParam (../../../VariantsDeps/fastify/variant12/fastify/node_modules/avvio/boot.js:557:7)
      at Boot.timeoutCall (../../../VariantsDeps/fastify/variant12/fastify/node_modules/avvio/boot.js:453:5)
      at Boot.callWithCbOrNextTick (../../../VariantsDeps/fastify/variant12/fastify/node_modules/avvio/boot.js:435:19)
      at release (../../../VariantsDeps/fastify/variant12/fastify/node_modules/fastq/queue.js:149:16)
      at Object.resume (../../../VariantsDeps/fastify/variant12/fastify/node_modules/fastq/queue.js:82:7)
      at ../../../VariantsDeps/fastify/variant12/fastify/node_modules/avvio/boot.js:174:18
      at ../../../VariantsDeps/fastify/variant12/fastify/node_modules/avvio/plugin.js:275:7
      at done (../../../VariantsDeps/fastify/variant12/fastify/node_modules/avvio/plugin.js:200:5)

  ● Health checks › Default configuration exposes a /_health route

    FastifyError: fastify-plugin: Plugin did not start in time: 'bound _after'. You may have forgotten to call 'done' function or to resolve a Promise

      618 |     // config issue on the load balancer side.
      619 |     this.log.trace({ err }, 'client error')
    > 620 |     // Copying standard node behaviour
          |                                       ^
      621 |     // https://github.com/nodejs/node/blob/6ca23d7846cb47e84fd344543e394e50938540be/lib/_http_server.js#L666
      622 |
      623 |     // If the socket is not writable, there is no reason to try to send data.

      at manageErr (../../../VariantsDeps/fastify/variant12/fastify/fastify.js:620:87)
      at ../../../VariantsDeps/fastify/variant12/fastify/fastify.js:607:11
      at Object._encapsulateThreeParam (../../../VariantsDeps/fastify/variant12/fastify/node_modules/avvio/boot.js:557:7)
      at Boot.timeoutCall (../../../VariantsDeps/fastify/variant12/fastify/node_modules/avvio/boot.js:453:5)
      at Boot.callWithCbOrNextTick (../../../VariantsDeps/fastify/variant12/fastify/node_modules/avvio/boot.js:435:19)
      at release (../../../VariantsDeps/fastify/variant12/fastify/node_modules/fastq/queue.js:149:16)
      at Object.resume (../../../VariantsDeps/fastify/variant12/fastify/node_modules/fastq/queue.js:82:7)
      at ../../../VariantsDeps/fastify/variant12/fastify/node_modules/avvio/boot.js:174:18
      at ../../../VariantsDeps/fastify/variant12/fastify/node_modules/avvio/plugin.js:275:7
      at done (../../../VariantsDeps/fastify/variant12/fastify/node_modules/avvio/plugin.js:200:5)

  ● Health checks › Default configuration exposes a /_health route

    thrown: "Exceeded timeout of 5000 ms for a test.
    Use jest.setTimeout(newTimeout) to increase the timeout value, if this is a long-running test."

       6 |   })
       7 |
    >  8 |   test('Default configuration exposes a /_health route', async () => {
         |   ^
       9 |     const server = createServer()
      10 |     await server.ready()
      11 |     const res = await server.inject({ method: 'GET', url: '/_health' })

      at tests/health.test.ts:8:3
      at Object.<anonymous> (tests/health.test.ts:3:1)

  ● Health checks › Custom health check handler is called at startup and every 5 seconds

    FastifyError: fastify-plugin: fastify-micro:sentry - expected '3.x' fastify version, '4.3.0' is installed

      127 |   if (!name) return
      128 |   this[registeredPlugins].push(name)
    > 129 | }
          |  ^
      130 |
      131 | function registerPlugin (fn) {
      132 |   registerPluginName.call(this, fn)

      at Object.checkVersion (../../../VariantsDeps/fastify/variant12/fastify/lib/pluginUtils.js:129:11)
      at Object.registerPlugin (../../../VariantsDeps/fastify/variant12/fastify/lib/pluginUtils.js:143:16)
      at Boot.override (../../../VariantsDeps/fastify/variant12/fastify/lib/pluginOverride.js:35:57)
      at Plugin.Object.<anonymous>.Plugin.exec (../../../VariantsDeps/fastify/variant12/fastify/node_modules/avvio/plugin.js:79:33)
      at Boot.loadPlugin (../../../VariantsDeps/fastify/variant12/fastify/node_modules/avvio/plugin.js:272:10)
      at node_modules/@jest/fake-timers/build/legacyFakeTimers.js:558:18

  ● Health checks › Custom health check handler is called at startup and every 5 seconds

    thrown: "Exceeded timeout of 5000 ms for a test.
    Use jest.setTimeout(newTimeout) to increase the timeout value, if this is a long-running test."

      14 |   })
      15 |
    > 16 |   test('Custom health check handler is called at startup and every 5 seconds', async () => {
         |   ^
      17 |     jest.useFakeTimers('legacy')
      18 |     const healthCheck = jest.fn().mockResolvedValue(true)
      19 |     const server = createServer({

      at tests/health.test.ts:16:3
      at Object.<anonymous> (tests/health.test.ts:3:1)

  ● Health checks › Custom health check throwing results in 503

    FastifyError: fastify-plugin: fastify-micro:sentry - expected '3.x' fastify version, '4.3.0' is installed

      127 |   if (!name) return
      128 |   this[registeredPlugins].push(name)
    > 129 | }
          |  ^
      130 |
      131 | function registerPlugin (fn) {
      132 |   registerPluginName.call(this, fn)

      at Object.checkVersion (../../../VariantsDeps/fastify/variant12/fastify/lib/pluginUtils.js:129:11)
      at Object.registerPlugin (../../../VariantsDeps/fastify/variant12/fastify/lib/pluginUtils.js:143:16)
      at Boot.override (../../../VariantsDeps/fastify/variant12/fastify/lib/pluginOverride.js:35:57)
      at Plugin.Object.<anonymous>.Plugin.exec (../../../VariantsDeps/fastify/variant12/fastify/node_modules/avvio/plugin.js:79:33)
      at Boot.loadPlugin (../../../VariantsDeps/fastify/variant12/fastify/node_modules/avvio/plugin.js:272:10)
      at node_modules/@jest/fake-timers/build/legacyFakeTimers.js:558:18

  ● Health checks › Custom health check throwing results in 503

    FastifyError: fastify-plugin: Plugin did not start in time: 'bound _after'. You may have forgotten to call 'done' function or to resolve a Promise

      618 |     // config issue on the load balancer side.
      619 |     this.log.trace({ err }, 'client error')
    > 620 |     // Copying standard node behaviour
          |                                       ^
      621 |     // https://github.com/nodejs/node/blob/6ca23d7846cb47e84fd344543e394e50938540be/lib/_http_server.js#L666
      622 |
      623 |     // If the socket is not writable, there is no reason to try to send data.

      at manageErr (../../../VariantsDeps/fastify/variant12/fastify/fastify.js:620:87)
      at ../../../VariantsDeps/fastify/variant12/fastify/fastify.js:607:11
      at Object._encapsulateThreeParam (../../../VariantsDeps/fastify/variant12/fastify/node_modules/avvio/boot.js:557:7)
      at Boot.timeoutCall (../../../VariantsDeps/fastify/variant12/fastify/node_modules/avvio/boot.js:453:5)
      at Boot.callWithCbOrNextTick (../../../VariantsDeps/fastify/variant12/fastify/node_modules/avvio/boot.js:435:19)
      at release (../../../VariantsDeps/fastify/variant12/fastify/node_modules/fastq/queue.js:149:16)
      at Object.resume (../../../VariantsDeps/fastify/variant12/fastify/node_modules/fastq/queue.js:82:7)
      at ../../../VariantsDeps/fastify/variant12/fastify/node_modules/avvio/boot.js:174:18
      at ../../../VariantsDeps/fastify/variant12/fastify/node_modules/avvio/plugin.js:275:7
      at done (../../../VariantsDeps/fastify/variant12/fastify/node_modules/avvio/plugin.js:200:5)

  ● Health checks › Custom health check throwing results in 503

    thrown: "Exceeded timeout of 5000 ms for a test.
    Use jest.setTimeout(newTimeout) to increase the timeout value, if this is a long-running test."

      29 |   })
      30 |
    > 31 |   test('Custom health check throwing results in 503', async () => {
         |   ^
      32 |     jest.useFakeTimers('legacy')
      33 |     const healthCheck = jest
      34 |       .fn()

      at tests/health.test.ts:31:3
      at Object.<anonymous> (tests/health.test.ts:3:1)

  ● Health checks › Disabled health monitoring

    FastifyError: fastify-plugin: fastify-micro:sentry - expected '3.x' fastify version, '4.3.0' is installed

      127 |   if (!name) return
      128 |   this[registeredPlugins].push(name)
    > 129 | }
          |  ^
      130 |
      131 | function registerPlugin (fn) {
      132 |   registerPluginName.call(this, fn)

      at Object.checkVersion (../../../VariantsDeps/fastify/variant12/fastify/lib/pluginUtils.js:129:11)
      at Object.registerPlugin (../../../VariantsDeps/fastify/variant12/fastify/lib/pluginUtils.js:143:16)
      at Boot.override (../../../VariantsDeps/fastify/variant12/fastify/lib/pluginOverride.js:35:57)
      at Plugin.Object.<anonymous>.Plugin.exec (../../../VariantsDeps/fastify/variant12/fastify/node_modules/avvio/plugin.js:79:33)
      at Boot.loadPlugin (../../../VariantsDeps/fastify/variant12/fastify/node_modules/avvio/plugin.js:272:10)
      at node_modules/@jest/fake-timers/build/legacyFakeTimers.js:558:18

  ● Health checks › Disabled health monitoring

    thrown: "Exceeded timeout of 5000 ms for a test.
    Use jest.setTimeout(newTimeout) to increase the timeout value, if this is a long-running test."

      63 |   })
      64 |
    > 65 |   test('Disabled health monitoring', async () => {
         |   ^
      66 |     process.env.FASTIFY_MICRO_DISABLE_SERVICE_HEALTH_MONITORING = 'true'
      67 |     jest.useFakeTimers('legacy')
      68 |     const healthCheck = jest.fn().mockResolvedValue(true)

      at tests/health.test.ts:65:3
      at Object.<anonymous> (tests/health.test.ts:3:1)

FAIL tests/graceful.test.ts (10.347 s)
  Graceful shutdown
    ✕ with custom handler (5002 ms)
    ✕ with custom async handler (5001 ms)

  ● Graceful shutdown › with custom handler

    FastifyError: fastify-plugin: fastify-micro:sentry - expected '3.x' fastify version, '4.3.0' is installed

      127 |   if (!name) return
      128 |   this[registeredPlugins].push(name)
    > 129 | }
          |  ^
      130 |
      131 | function registerPlugin (fn) {
      132 |   registerPluginName.call(this, fn)

      at Object.checkVersion (../../../VariantsDeps/fastify/variant12/fastify/lib/pluginUtils.js:129:11)
      at Object.registerPlugin (../../../VariantsDeps/fastify/variant12/fastify/lib/pluginUtils.js:143:16)
      at Boot.override (../../../VariantsDeps/fastify/variant12/fastify/lib/pluginOverride.js:35:57)
      at Plugin.Object.<anonymous>.Plugin.exec (../../../VariantsDeps/fastify/variant12/fastify/node_modules/avvio/plugin.js:79:33)
      at Boot.loadPlugin (../../../VariantsDeps/fastify/variant12/fastify/node_modules/avvio/plugin.js:272:10)

  ● Graceful shutdown › with custom handler

    thrown: "Exceeded timeout of 5000 ms for a test.
    Use jest.setTimeout(newTimeout) to increase the timeout value, if this is a long-running test."

      3 |
      4 | describe('Graceful shutdown', () => {
    > 5 |   test('with custom handler', async () => {
        |   ^
      6 |     const server = createServer({ name: 'foo' })
      7 |     server.addHook('onClose', (fastify, done) => {
      8 |       expect(fastify.name).toEqual('foo')

      at tests/graceful.test.ts:5:3
      at Object.<anonymous> (tests/graceful.test.ts:4:1)

  ● Graceful shutdown › with custom async handler

    FastifyError: fastify-plugin: fastify-micro:sentry - expected '3.x' fastify version, '4.3.0' is installed

      127 |   if (!name) return
      128 |   this[registeredPlugins].push(name)
    > 129 | }
          |  ^
      130 |
      131 | function registerPlugin (fn) {
      132 |   registerPluginName.call(this, fn)

      at Object.checkVersion (../../../VariantsDeps/fastify/variant12/fastify/lib/pluginUtils.js:129:11)
      at Object.registerPlugin (../../../VariantsDeps/fastify/variant12/fastify/lib/pluginUtils.js:143:16)
      at Boot.override (../../../VariantsDeps/fastify/variant12/fastify/lib/pluginOverride.js:35:57)
      at Plugin.Object.<anonymous>.Plugin.exec (../../../VariantsDeps/fastify/variant12/fastify/node_modules/avvio/plugin.js:79:33)
      at Boot.loadPlugin (../../../VariantsDeps/fastify/variant12/fastify/node_modules/avvio/plugin.js:272:10)

  ● Graceful shutdown › with custom async handler

    thrown: "Exceeded timeout of 5000 ms for a test.
    Use jest.setTimeout(newTimeout) to increase the timeout value, if this is a long-running test."

      13 |   })
      14 |
    > 15 |   test('with custom async handler', async () => {
         |   ^
      16 |     const server = createServer({ name: 'foo' })
      17 |     server.addHook('onClose', async fastify => {
      18 |       await delay(100)

      at tests/graceful.test.ts:15:3
      at Object.<anonymous> (tests/graceful.test.ts:4:1)

FAIL tests/logger.test.ts (23.121 s)
  Logger
    ✕ name property (5002 ms)
    ✕ redact environment variables (5001 ms)
    ✕ redact log paths (5002 ms)
    ✕ request ID generator (5001 ms)

  ● Logger › name property

    thrown: "Exceeded timeout of 5000 ms for a test.
    Use jest.setTimeout(newTimeout) to increase the timeout value, if this is a long-running test."

      2 |
      3 | describe('Logger', () => {
    > 4 |   test('name property', async () => {
        |   ^
      5 |     const [logLine] = await testLogs(logLine => logLine.dataTestID === 'name')
      6 |     expect(logLine.from).toEqual('foo')
      7 |   })

      at tests/logger.test.ts:4:3
      at Object.<anonymous> (tests/logger.test.ts:3:1)

  ● Logger › redact environment variables

    thrown: "Exceeded timeout of 5000 ms for a test.
    Use jest.setTimeout(newTimeout) to increase the timeout value, if this is a long-running test."

       7 |   })
       8 |
    >  9 |   test('redact environment variables', async () => {
         |   ^
      10 |     const [logLine] = await testLogs(
      11 |       logLine => logLine.dataTestID === 'redact-env'
      12 |     )

      at tests/logger.test.ts:9:3
      at Object.<anonymous> (tests/logger.test.ts:3:1)

  ● Logger › redact log paths

    thrown: "Exceeded timeout of 5000 ms for a test.
    Use jest.setTimeout(newTimeout) to increase the timeout value, if this is a long-running test."

      14 |   })
      15 |
    > 16 |   test('redact log paths', async () => {
         |   ^
      17 |     const [logLine] = await testLogs(
      18 |       logLine => logLine.dataTestID === 'redact-path'
      19 |     )

      at tests/logger.test.ts:16:3
      at Object.<anonymous> (tests/logger.test.ts:3:1)

  ● Logger › request ID generator

    thrown: "Exceeded timeout of 5000 ms for a test.
    Use jest.setTimeout(newTimeout) to increase the timeout value, if this is a long-running test."

      21 |   })
      22 |
    > 23 |   test('request ID generator', async () => {
         |   ^
      24 |     type ReqResLog = { reqId: string }
      25 |
      26 |     const [req1, res1, req2, res2, req3, res3, req4, res4] =

      at tests/logger.test.ts:23:3
      at Object.<anonymous> (tests/logger.test.ts:3:1)

ts-jest[ts-jest-transformer] (WARN) Got a `.js` file to compile while `allowJs` option is not set to `true` (file: /data/js-variants/multee/VariantsDeps/fastify/variant11/fastify/fastify.js). To fix this:
  - if you want TypeScript to process JS files, set `allowJs` to `true` in your TypeScript config (usually tsconfig.json)
  - if you do not want TypeScript to process your `.js` files, in your Jest config change the `transform` key which value is `ts-jest` so that it does not match `.js` files anymore
Browserslist: caniuse-lite is outdated. Please run:
  npx browserslist@latest --update-db
  Why you should do it regularly: https://github.com/browserslist/browserslist#browsers-data-updating
ts-jest[ts-jest-transformer] (WARN) Got a `.js` file to compile while `allowJs` option is not set to `true` (file: /data/js-variants/multee/VariantsDeps/fastify/variant11/fastify/lib/symbols.js). To fix this:
  - if you want TypeScript to process JS files, set `allowJs` to `true` in your TypeScript config (usually tsconfig.json)
  - if you do not want TypeScript to process your `.js` files, in your Jest config change the `transform` key which value is `ts-jest` so that it does not match `.js` files anymore
ts-jest[ts-jest-transformer] (WARN) Got a `.js` file to compile while `allowJs` option is not set to `true` (file: /data/js-variants/multee/VariantsDeps/fastify/variant11/fastify/lib/server.js). To fix this:
  - if you want TypeScript to process JS files, set `allowJs` to `true` in your TypeScript config (usually tsconfig.json)
  - if you do not want TypeScript to process your `.js` files, in your Jest config change the `transform` key which value is `ts-jest` so that it does not match `.js` files anymore
ts-jest[ts-jest-transformer] (WARN) Got a `.js` file to compile while `allowJs` option is not set to `true` (file: /data/js-variants/multee/VariantsDeps/fastify/variant11/fastify/lib/warnings.js). To fix this:
  - if you want TypeScript to process JS files, set `allowJs` to `true` in your TypeScript config (usually tsconfig.json)
  - if you do not want TypeScript to process your `.js` files, in your Jest config change the `transform` key which value is `ts-jest` so that it does not match `.js` files anymore
ts-jest[ts-jest-transformer] (WARN) Got a `.js` file to compile while `allowJs` option is not set to `true` (file: /data/js-variants/multee/VariantsDeps/fastify/variant11/fastify/lib/errors.js). To fix this:
  - if you want TypeScript to process JS files, set `allowJs` to `true` in your TypeScript config (usually tsconfig.json)
  - if you do not want TypeScript to process your `.js` files, in your Jest config change the `transform` key which value is `ts-jest` so that it does not match `.js` files anymore
ts-jest[ts-jest-transformer] (WARN) Got a `.js` file to compile while `allowJs` option is not set to `true` (file: /data/js-variants/multee/VariantsDeps/fastify/variant11/fastify/lib/reply.js). To fix this:
  - if you want TypeScript to process JS files, set `allowJs` to `true` in your TypeScript config (usually tsconfig.json)
  - if you do not want TypeScript to process your `.js` files, in your Jest config change the `transform` key which value is `ts-jest` so that it does not match `.js` files anymore
ts-jest[ts-jest-transformer] (WARN) Got a `.js` file to compile while `allowJs` option is not set to `true` (file: /data/js-variants/multee/VariantsDeps/fastify/variant11/fastify/lib/hooks.js). To fix this:
  - if you want TypeScript to process JS files, set `allowJs` to `true` in your TypeScript config (usually tsconfig.json)
  - if you do not want TypeScript to process your `.js` files, in your Jest config change the `transform` key which value is `ts-jest` so that it does not match `.js` files anymore
ts-jest[ts-jest-transformer] (WARN) Got a `.js` file to compile while `allowJs` option is not set to `true` (file: /data/js-variants/multee/VariantsDeps/fastify/variant11/fastify/lib/handleRequest.js). To fix this:
  - if you want TypeScript to process JS files, set `allowJs` to `true` in your TypeScript config (usually tsconfig.json)
  - if you do not want TypeScript to process your `.js` files, in your Jest config change the `transform` key which value is `ts-jest` so that it does not match `.js` files anymore
ts-jest[ts-jest-transformer] (WARN) Got a `.js` file to compile while `allowJs` option is not set to `true` (file: /data/js-variants/multee/VariantsDeps/fastify/variant11/fastify/lib/validation.js). To fix this:
  - if you want TypeScript to process JS files, set `allowJs` to `true` in your TypeScript config (usually tsconfig.json)
  - if you do not want TypeScript to process your `.js` files, in your Jest config change the `transform` key which value is `ts-jest` so that it does not match `.js` files anymore
ts-jest[ts-jest-transformer] (WARN) Got a `.js` file to compile while `allowJs` option is not set to `true` (file: /data/js-variants/multee/VariantsDeps/fastify/variant11/fastify/lib/wrapThenable.js). To fix this:
  - if you want TypeScript to process JS files, set `allowJs` to `true` in your TypeScript config (usually tsconfig.json)
  - if you do not want TypeScript to process your `.js` files, in your Jest config change the `transform` key which value is `ts-jest` so that it does not match `.js` files anymore
ts-jest[ts-jest-transformer] (WARN) Got a `.js` file to compile while `allowJs` option is not set to `true` (file: /data/js-variants/multee/VariantsDeps/fastify/variant11/fastify/lib/logger.js). To fix this:
  - if you want TypeScript to process JS files, set `allowJs` to `true` in your TypeScript config (usually tsconfig.json)
  - if you do not want TypeScript to process your `.js` files, in your Jest config change the `transform` key which value is `ts-jest` so that it does not match `.js` files anymore
ts-jest[ts-jest-transformer] (WARN) Got a `.js` file to compile while `allowJs` option is not set to `true` (file: /data/js-variants/multee/VariantsDeps/fastify/variant11/fastify/lib/error-handler.js). To fix this:
  - if you want TypeScript to process JS files, set `allowJs` to `true` in your TypeScript config (usually tsconfig.json)
  - if you do not want TypeScript to process your `.js` files, in your Jest config change the `transform` key which value is `ts-jest` so that it does not match `.js` files anymore
ts-jest[ts-jest-transformer] (WARN) Got a `.js` file to compile while `allowJs` option is not set to `true` (file: /data/js-variants/multee/VariantsDeps/fastify/variant11/fastify/lib/schemas.js). To fix this:
  - if you want TypeScript to process JS files, set `allowJs` to `true` in your TypeScript config (usually tsconfig.json)
  - if you do not want TypeScript to process your `.js` files, in your Jest config change the `transform` key which value is `ts-jest` so that it does not match `.js` files anymore
ts-jest[ts-jest-transformer] (WARN) Got a `.js` file to compile while `allowJs` option is not set to `true` (file: /data/js-variants/multee/VariantsDeps/fastify/variant11/fastify/lib/error-serializer.js). To fix this:
  - if you want TypeScript to process JS files, set `allowJs` to `true` in your TypeScript config (usually tsconfig.json)
  - if you do not want TypeScript to process your `.js` files, in your Jest config change the `transform` key which value is `ts-jest` so that it does not match `.js` files anymore
ts-jest[ts-jest-transformer] (WARN) Got a `.js` file to compile while `allowJs` option is not set to `true` (file: /data/js-variants/multee/VariantsDeps/fastify/variant11/fastify/lib/request.js). To fix this:
  - if you want TypeScript to process JS files, set `allowJs` to `true` in your TypeScript config (usually tsconfig.json)
  - if you do not want TypeScript to process your `.js` files, in your Jest config change the `transform` key which value is `ts-jest` so that it does not match `.js` files anymore
ts-jest[ts-jest-transformer] (WARN) Got a `.js` file to compile while `allowJs` option is not set to `true` (file: /data/js-variants/multee/VariantsDeps/fastify/variant11/fastify/lib/decorate.js). To fix this:
  - if you want TypeScript to process JS files, set `allowJs` to `true` in your TypeScript config (usually tsconfig.json)
  - if you do not want TypeScript to process your `.js` files, in your Jest config change the `transform` key which value is `ts-jest` so that it does not match `.js` files anymore
ts-jest[ts-jest-transformer] (WARN) Got a `.js` file to compile while `allowJs` option is not set to `true` (file: /data/js-variants/multee/VariantsDeps/fastify/variant11/fastify/lib/contentTypeParser.js). To fix this:
  - if you want TypeScript to process JS files, set `allowJs` to `true` in your TypeScript config (usually tsconfig.json)
  - if you do not want TypeScript to process your `.js` files, in your Jest config change the `transform` key which value is `ts-jest` so that it does not match `.js` files anymore
ts-jest[ts-jest-transformer] (WARN) Got a `.js` file to compile while `allowJs` option is not set to `true` (file: /data/js-variants/multee/VariantsDeps/fastify/variant11/fastify/lib/schema-controller.js). To fix this:
  - if you want TypeScript to process JS files, set `allowJs` to `true` in your TypeScript config (usually tsconfig.json)
  - if you do not want TypeScript to process your `.js` files, in your Jest config change the `transform` key which value is `ts-jest` so that it does not match `.js` files anymore
ts-jest[ts-jest-transformer] (WARN) Got a `.js` file to compile while `allowJs` option is not set to `true` (file: /data/js-variants/multee/VariantsDeps/fastify/variant11/fastify/lib/pluginUtils.js). To fix this:
  - if you want TypeScript to process JS files, set `allowJs` to `true` in your TypeScript config (usually tsconfig.json)
  - if you do not want TypeScript to process your `.js` files, in your Jest config change the `transform` key which value is `ts-jest` so that it does not match `.js` files anymore
ts-jest[ts-jest-transformer] (WARN) Got a `.js` file to compile while `allowJs` option is not set to `true` (file: /data/js-variants/multee/VariantsDeps/fastify/variant11/fastify/lib/reqIdGenFactory.js). To fix this:
  - if you want TypeScript to process JS files, set `allowJs` to `true` in your TypeScript config (usually tsconfig.json)
  - if you do not want TypeScript to process your `.js` files, in your Jest config change the `transform` key which value is `ts-jest` so that it does not match `.js` files anymore
ts-jest[ts-jest-transformer] (WARN) Got a `.js` file to compile while `allowJs` option is not set to `true` (file: /data/js-variants/multee/VariantsDeps/fastify/variant11/fastify/lib/route.js). To fix this:
  - if you want TypeScript to process JS files, set `allowJs` to `true` in your TypeScript config (usually tsconfig.json)
  - if you do not want TypeScript to process your `.js` files, in your Jest config change the `transform` key which value is `ts-jest` so that it does not match `.js` files anymore
FAIL tests/basics.test.ts
  ● Test suite failed to run

    the FULL_PATH_REGEXP is not safe, update this module

      1 | 'use strict'
      2 |
    > 3 | const FindMyWay = require('find-my-way')
        |                   ^
      4 | const Context = require('./context')
      5 | const handleRequest = require('./handleRequest')
      6 | const { hookRunner, hookIterator, lifecycleHooks } = require('./hooks')

      at Object.<anonymous> (../../../VariantsDeps/fastify/variant11/fastify/node_modules/find-my-way/index.js:43:9)
      at Object.<anonymous> (../../../VariantsDeps/fastify/variant11/fastify/lib/route.js:3:19)

FAIL tests/plugins.test.ts
  ● Test suite failed to run

    the FULL_PATH_REGEXP is not safe, update this module

      1 | 'use strict'
      2 |
    > 3 | const FindMyWay = require('find-my-way')
        |                   ^
      4 | const Context = require('./context')
      5 | const handleRequest = require('./handleRequest')
      6 | const { hookRunner, hookIterator, lifecycleHooks } = require('./hooks')

      at Object.<anonymous> (../../../VariantsDeps/fastify/variant11/fastify/node_modules/find-my-way/index.js:43:9)
      at Object.<anonymous> (../../../VariantsDeps/fastify/variant11/fastify/lib/route.js:3:19)

FAIL tests/health.test.ts
  ● Test suite failed to run

    the FULL_PATH_REGEXP is not safe, update this module

      1 | 'use strict'
      2 |
    > 3 | const FindMyWay = require('find-my-way')
        |                   ^
      4 | const Context = require('./context')
      5 | const handleRequest = require('./handleRequest')
      6 | const { hookRunner, hookIterator, lifecycleHooks } = require('./hooks')

      at Object.<anonymous> (../../../VariantsDeps/fastify/variant11/fastify/node_modules/find-my-way/index.js:43:9)
      at Object.<anonymous> (../../../VariantsDeps/fastify/variant11/fastify/lib/route.js:3:19)

FAIL tests/graceful.test.ts
  ● Test suite failed to run

    the FULL_PATH_REGEXP is not safe, update this module

      1 | 'use strict'
      2 |
    > 3 | const FindMyWay = require('find-my-way')
        |                   ^
      4 | const Context = require('./context')
      5 | const handleRequest = require('./handleRequest')
      6 | const { hookRunner, hookIterator, lifecycleHooks } = require('./hooks')

      at Object.<anonymous> (../../../VariantsDeps/fastify/variant11/fastify/node_modules/find-my-way/index.js:43:9)
      at Object.<anonymous> (../../../VariantsDeps/fastify/variant11/fastify/lib/route.js:3:19)

FAIL tests/sentry.test.ts
  ● Test suite failed to run

    the FULL_PATH_REGEXP is not safe, update this module

      1 | 'use strict'
      2 |
    > 3 | const FindMyWay = require('find-my-way')
        |                   ^
      4 | const Context = require('./context')
      5 | const handleRequest = require('./handleRequest')
      6 | const { hookRunner, hookIterator, lifecycleHooks } = require('./hooks')

      at Object.<anonymous> (../../../VariantsDeps/fastify/variant11/fastify/node_modules/find-my-way/index.js:43:9)
      at Object.<anonymous> (../../../VariantsDeps/fastify/variant11/fastify/lib/route.js:3:19)

Test Suites: 6 failed, 6 total
Tests:       4 failed, 4 total
Snapshots:   0 total
Time:        30.082 s
Ran all test suites.
FAIL tests/logger.test.ts (23.123 s)
  Logger
    ✕ name property (5003 ms)
    ✕ redact environment variables (5001 ms)
    ✕ redact log paths (5001 ms)
    ✕ request ID generator (5001 ms)

  ● Logger › name property

    thrown: "Exceeded timeout of 5000 ms for a test.
    Use jest.setTimeout(newTimeout) to increase the timeout value, if this is a long-running test."

      2 |
      3 | describe('Logger', () => {
    > 4 |   test('name property', async () => {
        |   ^
      5 |     const [logLine] = await testLogs(logLine => logLine.dataTestID === 'name')
      6 |     expect(logLine.from).toEqual('foo')
      7 |   })

      at tests/logger.test.ts:4:3
      at Object.<anonymous> (tests/logger.test.ts:3:1)

  ● Logger › redact environment variables

    thrown: "Exceeded timeout of 5000 ms for a test.
    Use jest.setTimeout(newTimeout) to increase the timeout value, if this is a long-running test."

       7 |   })
       8 |
    >  9 |   test('redact environment variables', async () => {
         |   ^
      10 |     const [logLine] = await testLogs(
      11 |       logLine => logLine.dataTestID === 'redact-env'
      12 |     )

      at tests/logger.test.ts:9:3
      at Object.<anonymous> (tests/logger.test.ts:3:1)

  ● Logger › redact log paths

    thrown: "Exceeded timeout of 5000 ms for a test.
    Use jest.setTimeout(newTimeout) to increase the timeout value, if this is a long-running test."

      14 |   })
      15 |
    > 16 |   test('redact log paths', async () => {
         |   ^
      17 |     const [logLine] = await testLogs(
      18 |       logLine => logLine.dataTestID === 'redact-path'
      19 |     )

      at tests/logger.test.ts:16:3
      at Object.<anonymous> (tests/logger.test.ts:3:1)

  ● Logger › request ID generator

    thrown: "Exceeded timeout of 5000 ms for a test.
    Use jest.setTimeout(newTimeout) to increase the timeout value, if this is a long-running test."

      21 |   })
      22 |
    > 23 |   test('request ID generator', async () => {
         |   ^
      24 |     type ReqResLog = { reqId: string }
      25 |
      26 |     const [req1, res1, req2, res2, req3, res3, req4, res4] =

      at tests/logger.test.ts:23:3
      at Object.<anonymous> (tests/logger.test.ts:3:1)

ts-jest[ts-jest-transformer] (WARN) Got a `.js` file to compile while `allowJs` option is not set to `true` (file: /data/js-variants/multee/VariantsDeps/fastify/variant10/fastify/fastify.js). To fix this:
  - if you want TypeScript to process JS files, set `allowJs` to `true` in your TypeScript config (usually tsconfig.json)
  - if you do not want TypeScript to process your `.js` files, in your Jest config change the `transform` key which value is `ts-jest` so that it does not match `.js` files anymore
Browserslist: caniuse-lite is outdated. Please run:
  npx browserslist@latest --update-db
  Why you should do it regularly: https://github.com/browserslist/browserslist#browsers-data-updating
ts-jest[ts-jest-transformer] (WARN) Got a `.js` file to compile while `allowJs` option is not set to `true` (file: /data/js-variants/multee/VariantsDeps/fastify/variant10/fastify/lib/symbols.js). To fix this:
  - if you want TypeScript to process JS files, set `allowJs` to `true` in your TypeScript config (usually tsconfig.json)
  - if you do not want TypeScript to process your `.js` files, in your Jest config change the `transform` key which value is `ts-jest` so that it does not match `.js` files anymore
ts-jest[ts-jest-transformer] (WARN) Got a `.js` file to compile while `allowJs` option is not set to `true` (file: /data/js-variants/multee/VariantsDeps/fastify/variant10/fastify/lib/server.js). To fix this:
  - if you want TypeScript to process JS files, set `allowJs` to `true` in your TypeScript config (usually tsconfig.json)
  - if you do not want TypeScript to process your `.js` files, in your Jest config change the `transform` key which value is `ts-jest` so that it does not match `.js` files anymore
ts-jest[ts-jest-transformer] (WARN) Got a `.js` file to compile while `allowJs` option is not set to `true` (file: /data/js-variants/multee/VariantsDeps/fastify/variant10/fastify/lib/warnings.js). To fix this:
  - if you want TypeScript to process JS files, set `allowJs` to `true` in your TypeScript config (usually tsconfig.json)
  - if you do not want TypeScript to process your `.js` files, in your Jest config change the `transform` key which value is `ts-jest` so that it does not match `.js` files anymore
ts-jest[ts-jest-transformer] (WARN) Got a `.js` file to compile while `allowJs` option is not set to `true` (file: /data/js-variants/multee/VariantsDeps/fastify/variant10/fastify/lib/errors.js). To fix this:
  - if you want TypeScript to process JS files, set `allowJs` to `true` in your TypeScript config (usually tsconfig.json)
  - if you do not want TypeScript to process your `.js` files, in your Jest config change the `transform` key which value is `ts-jest` so that it does not match `.js` files anymore
ts-jest[ts-jest-transformer] (WARN) Got a `.js` file to compile while `allowJs` option is not set to `true` (file: /data/js-variants/multee/VariantsDeps/fastify/variant10/fastify/lib/reply.js). To fix this:
  - if you want TypeScript to process JS files, set `allowJs` to `true` in your TypeScript config (usually tsconfig.json)
  - if you do not want TypeScript to process your `.js` files, in your Jest config change the `transform` key which value is `ts-jest` so that it does not match `.js` files anymore
ts-jest[ts-jest-transformer] (WARN) Got a `.js` file to compile while `allowJs` option is not set to `true` (file: /data/js-variants/multee/VariantsDeps/fastify/variant10/fastify/lib/hooks.js). To fix this:
  - if you want TypeScript to process JS files, set `allowJs` to `true` in your TypeScript config (usually tsconfig.json)
  - if you do not want TypeScript to process your `.js` files, in your Jest config change the `transform` key which value is `ts-jest` so that it does not match `.js` files anymore
ts-jest[ts-jest-transformer] (WARN) Got a `.js` file to compile while `allowJs` option is not set to `true` (file: /data/js-variants/multee/VariantsDeps/fastify/variant10/fastify/lib/handleRequest.js). To fix this:
  - if you want TypeScript to process JS files, set `allowJs` to `true` in your TypeScript config (usually tsconfig.json)
  - if you do not want TypeScript to process your `.js` files, in your Jest config change the `transform` key which value is `ts-jest` so that it does not match `.js` files anymore
ts-jest[ts-jest-transformer] (WARN) Got a `.js` file to compile while `allowJs` option is not set to `true` (file: /data/js-variants/multee/VariantsDeps/fastify/variant10/fastify/lib/validation.js). To fix this:
  - if you want TypeScript to process JS files, set `allowJs` to `true` in your TypeScript config (usually tsconfig.json)
  - if you do not want TypeScript to process your `.js` files, in your Jest config change the `transform` key which value is `ts-jest` so that it does not match `.js` files anymore
ts-jest[ts-jest-transformer] (WARN) Got a `.js` file to compile while `allowJs` option is not set to `true` (file: /data/js-variants/multee/VariantsDeps/fastify/variant10/fastify/lib/wrapThenable.js). To fix this:
  - if you want TypeScript to process JS files, set `allowJs` to `true` in your TypeScript config (usually tsconfig.json)
  - if you do not want TypeScript to process your `.js` files, in your Jest config change the `transform` key which value is `ts-jest` so that it does not match `.js` files anymore
ts-jest[ts-jest-transformer] (WARN) Got a `.js` file to compile while `allowJs` option is not set to `true` (file: /data/js-variants/multee/VariantsDeps/fastify/variant10/fastify/lib/logger.js). To fix this:
  - if you want TypeScript to process JS files, set `allowJs` to `true` in your TypeScript config (usually tsconfig.json)
  - if you do not want TypeScript to process your `.js` files, in your Jest config change the `transform` key which value is `ts-jest` so that it does not match `.js` files anymore
ts-jest[ts-jest-transformer] (WARN) Got a `.js` file to compile while `allowJs` option is not set to `true` (file: /data/js-variants/multee/VariantsDeps/fastify/variant10/fastify/lib/error-handler.js). To fix this:
  - if you want TypeScript to process JS files, set `allowJs` to `true` in your TypeScript config (usually tsconfig.json)
  - if you do not want TypeScript to process your `.js` files, in your Jest config change the `transform` key which value is `ts-jest` so that it does not match `.js` files anymore
ts-jest[ts-jest-transformer] (WARN) Got a `.js` file to compile while `allowJs` option is not set to `true` (file: /data/js-variants/multee/VariantsDeps/fastify/variant10/fastify/lib/schemas.js). To fix this:
  - if you want TypeScript to process JS files, set `allowJs` to `true` in your TypeScript config (usually tsconfig.json)
  - if you do not want TypeScript to process your `.js` files, in your Jest config change the `transform` key which value is `ts-jest` so that it does not match `.js` files anymore
ts-jest[ts-jest-transformer] (WARN) Got a `.js` file to compile while `allowJs` option is not set to `true` (file: /data/js-variants/multee/VariantsDeps/fastify/variant10/fastify/lib/error-serializer.js). To fix this:
  - if you want TypeScript to process JS files, set `allowJs` to `true` in your TypeScript config (usually tsconfig.json)
  - if you do not want TypeScript to process your `.js` files, in your Jest config change the `transform` key which value is `ts-jest` so that it does not match `.js` files anymore
ts-jest[ts-jest-transformer] (WARN) Got a `.js` file to compile while `allowJs` option is not set to `true` (file: /data/js-variants/multee/VariantsDeps/fastify/variant10/fastify/lib/request.js). To fix this:
  - if you want TypeScript to process JS files, set `allowJs` to `true` in your TypeScript config (usually tsconfig.json)
  - if you do not want TypeScript to process your `.js` files, in your Jest config change the `transform` key which value is `ts-jest` so that it does not match `.js` files anymore
ts-jest[ts-jest-transformer] (WARN) Got a `.js` file to compile while `allowJs` option is not set to `true` (file: /data/js-variants/multee/VariantsDeps/fastify/variant10/fastify/lib/decorate.js). To fix this:
  - if you want TypeScript to process JS files, set `allowJs` to `true` in your TypeScript config (usually tsconfig.json)
  - if you do not want TypeScript to process your `.js` files, in your Jest config change the `transform` key which value is `ts-jest` so that it does not match `.js` files anymore
ts-jest[ts-jest-transformer] (WARN) Got a `.js` file to compile while `allowJs` option is not set to `true` (file: /data/js-variants/multee/VariantsDeps/fastify/variant10/fastify/lib/contentTypeParser.js). To fix this:
  - if you want TypeScript to process JS files, set `allowJs` to `true` in your TypeScript config (usually tsconfig.json)
  - if you do not want TypeScript to process your `.js` files, in your Jest config change the `transform` key which value is `ts-jest` so that it does not match `.js` files anymore
ts-jest[ts-jest-transformer] (WARN) Got a `.js` file to compile while `allowJs` option is not set to `true` (file: /data/js-variants/multee/VariantsDeps/fastify/variant10/fastify/lib/schema-controller.js). To fix this:
  - if you want TypeScript to process JS files, set `allowJs` to `true` in your TypeScript config (usually tsconfig.json)
  - if you do not want TypeScript to process your `.js` files, in your Jest config change the `transform` key which value is `ts-jest` so that it does not match `.js` files anymore
ts-jest[ts-jest-transformer] (WARN) Got a `.js` file to compile while `allowJs` option is not set to `true` (file: /data/js-variants/multee/VariantsDeps/fastify/variant10/fastify/lib/pluginUtils.js). To fix this:
  - if you want TypeScript to process JS files, set `allowJs` to `true` in your TypeScript config (usually tsconfig.json)
  - if you do not want TypeScript to process your `.js` files, in your Jest config change the `transform` key which value is `ts-jest` so that it does not match `.js` files anymore
ts-jest[ts-jest-transformer] (WARN) Got a `.js` file to compile while `allowJs` option is not set to `true` (file: /data/js-variants/multee/VariantsDeps/fastify/variant10/fastify/lib/reqIdGenFactory.js). To fix this:
  - if you want TypeScript to process JS files, set `allowJs` to `true` in your TypeScript config (usually tsconfig.json)
  - if you do not want TypeScript to process your `.js` files, in your Jest config change the `transform` key which value is `ts-jest` so that it does not match `.js` files anymore
ts-jest[ts-jest-transformer] (WARN) Got a `.js` file to compile while `allowJs` option is not set to `true` (file: /data/js-variants/multee/VariantsDeps/fastify/variant10/fastify/lib/route.js). To fix this:
  - if you want TypeScript to process JS files, set `allowJs` to `true` in your TypeScript config (usually tsconfig.json)
  - if you do not want TypeScript to process your `.js` files, in your Jest config change the `transform` key which value is `ts-jest` so that it does not match `.js` files anymore
ts-jest[ts-jest-transformer] (WARN) Got a `.js` file to compile while `allowJs` option is not set to `true` (file: /data/js-variants/multee/VariantsDeps/fastify/variant10/fastify/lib/context.js). To fix this:
  - if you want TypeScript to process JS files, set `allowJs` to `true` in your TypeScript config (usually tsconfig.json)
  - if you do not want TypeScript to process your `.js` files, in your Jest config change the `transform` key which value is `ts-jest` so that it does not match `.js` files anymore
ts-jest[ts-jest-transformer] (WARN) Got a `.js` file to compile while `allowJs` option is not set to `true` (file: /data/js-variants/multee/VariantsDeps/fastify/variant10/fastify/lib/headRoute.js). To fix this:
  - if you want TypeScript to process JS files, set `allowJs` to `true` in your TypeScript config (usually tsconfig.json)
  - if you do not want TypeScript to process your `.js` files, in your Jest config change the `transform` key which value is `ts-jest` so that it does not match `.js` files anymore
ts-jest[ts-jest-transformer] (WARN) Got a `.js` file to compile while `allowJs` option is not set to `true` (file: /data/js-variants/multee/VariantsDeps/fastify/variant10/fastify/lib/fourOhFour.js). To fix this:
  - if you want TypeScript to process JS files, set `allowJs` to `true` in your TypeScript config (usually tsconfig.json)
  - if you do not want TypeScript to process your `.js` files, in your Jest config change the `transform` key which value is `ts-jest` so that it does not match `.js` files anymore
ts-jest[ts-jest-transformer] (WARN) Got a `.js` file to compile while `allowJs` option is not set to `true` (file: /data/js-variants/multee/VariantsDeps/fastify/variant10/fastify/lib/initialConfigValidation.js). To fix this:
  - if you want TypeScript to process JS files, set `allowJs` to `true` in your TypeScript config (usually tsconfig.json)
  - if you do not want TypeScript to process your `.js` files, in your Jest config change the `transform` key which value is `ts-jest` so that it does not match `.js` files anymore
ts-jest[ts-jest-transformer] (WARN) Got a `.js` file to compile while `allowJs` option is not set to `true` (file: /data/js-variants/multee/VariantsDeps/fastify/variant10/fastify/lib/configValidator.js). To fix this:
  - if you want TypeScript to process JS files, set `allowJs` to `true` in your TypeScript config (usually tsconfig.json)
  - if you do not want TypeScript to process your `.js` files, in your Jest config change the `transform` key which value is `ts-jest` so that it does not match `.js` files anymore
ts-jest[ts-jest-transformer] (WARN) Got a `.js` file to compile while `allowJs` option is not set to `true` (file: /data/js-variants/multee/VariantsDeps/fastify/variant10/fastify/lib/pluginOverride.js). To fix this:
  - if you want TypeScript to process JS files, set `allowJs` to `true` in your TypeScript config (usually tsconfig.json)
  - if you do not want TypeScript to process your `.js` files, in your Jest config change the `transform` key which value is `ts-jest` so that it does not match `.js` files anymore
ts-jest[ts-jest-transformer] (WARN) Got a `.js` file to compile while `allowJs` option is not set to `true` (file: /data/js-variants/multee/VariantsDeps/fastify/variant10/fastify/lib/noop-set.js). To fix this:
  - if you want TypeScript to process JS files, set `allowJs` to `true` in your TypeScript config (usually tsconfig.json)
  - if you do not want TypeScript to process your `.js` files, in your Jest config change the `transform` key which value is `ts-jest` so that it does not match `.js` files anymore
FAIL tests/basics.test.ts (22.73 s)
  Basics
    ✓ The specified `name` property is injected (39 ms)
    ✕ Default port should be 3000 (5001 ms)
    ✕ Port should be configurable via the environment (5001 ms)
    ✕ Port can be passed as a second argument to `startServer` (5002 ms)

  ● Basics › Default port should be 3000

    FastifyError: fastify-plugin: fastify-micro:sentry - expected '3.x' fastify version, '4.3.0' is installed

      127 |   if (!name) return
      128 |   this[registeredPlugins].push(name)
    > 129 | }
          |  ^
      130 |
      131 | function registerPlugin (fn) {
      132 |   registerPluginName.call(this, fn)

      at Object.checkVersion (../../../VariantsDeps/fastify/variant10/fastify/lib/pluginUtils.js:129:11)
      at Object.registerPlugin (../../../VariantsDeps/fastify/variant10/fastify/lib/pluginUtils.js:143:16)
      at Boot.override (../../../VariantsDeps/fastify/variant10/fastify/lib/pluginOverride.js:35:57)
      at Plugin.Object.<anonymous>.Plugin.exec (../../../VariantsDeps/fastify/variant10/fastify/node_modules/avvio/plugin.js:79:33)
      at Boot.loadPlugin (../../../VariantsDeps/fastify/variant10/fastify/node_modules/avvio/plugin.js:272:10)

  ● Basics › Default port should be 3000

    FastifyError: fastify-plugin: fastify-micro:sentry - expected '3.x' fastify version, '4.3.0' is installed

      127 |   if (!name) return
      128 |   this[registeredPlugins].push(name)
    > 129 | }
          |  ^
      130 |
      131 | function registerPlugin (fn) {
      132 |   registerPluginName.call(this, fn)

      at Object.checkVersion (../../../VariantsDeps/fastify/variant10/fastify/lib/pluginUtils.js:129:11)
      at Object.registerPlugin (../../../VariantsDeps/fastify/variant10/fastify/lib/pluginUtils.js:143:16)
      at Boot.override (../../../VariantsDeps/fastify/variant10/fastify/lib/pluginOverride.js:35:57)
      at Plugin.Object.<anonymous>.Plugin.exec (../../../VariantsDeps/fastify/variant10/fastify/node_modules/avvio/plugin.js:79:33)
      at Boot.loadPlugin (../../../VariantsDeps/fastify/variant10/fastify/node_modules/avvio/plugin.js:272:10)

  ● Basics › Default port should be 3000

    FastifyError: fastify-plugin: fastify-micro:sentry - expected '3.x' fastify version, '4.3.0' is installed

      127 |   if (!name) return
      128 |   this[registeredPlugins].push(name)
    > 129 | }
          |  ^
      130 |
      131 | function registerPlugin (fn) {
      132 |   registerPluginName.call(this, fn)

      at Object.checkVersion (../../../VariantsDeps/fastify/variant10/fastify/lib/pluginUtils.js:129:11)
      at Object.registerPlugin (../../../VariantsDeps/fastify/variant10/fastify/lib/pluginUtils.js:143:16)
      at Boot.override (../../../VariantsDeps/fastify/variant10/fastify/lib/pluginOverride.js:35:57)
      at Plugin.Object.<anonymous>.Plugin.exec (../../../VariantsDeps/fastify/variant10/fastify/node_modules/avvio/plugin.js:79:33)
      at Boot.loadPlugin (../../../VariantsDeps/fastify/variant10/fastify/node_modules/avvio/plugin.js:272:10)

  ● Basics › Default port should be 3000

    thrown: "Exceeded timeout of 5000 ms for a test.
    Use jest.setTimeout(newTimeout) to increase the timeout value, if this is a long-running test."

      15 |   })
      16 |
    > 17 |   test('Default port should be 3000', async () => {
         |   ^
      18 |     const key = nanoid()
      19 |     const server = createServer()
      20 |     server.get('/', (_, res) => {

      at tests/basics.test.ts:17:3
      at Object.<anonymous> (tests/basics.test.ts:5:1)

  ● Basics › Port should be configurable via the environment

    FastifyError: fastify-plugin: fastify-micro:sentry - expected '3.x' fastify version, '4.3.0' is installed

      127 |   if (!name) return
      128 |   this[registeredPlugins].push(name)
    > 129 | }
          |  ^
      130 |
      131 | function registerPlugin (fn) {
      132 |   registerPluginName.call(this, fn)

      at Object.checkVersion (../../../VariantsDeps/fastify/variant10/fastify/lib/pluginUtils.js:129:11)
      at Object.registerPlugin (../../../VariantsDeps/fastify/variant10/fastify/lib/pluginUtils.js:143:16)
      at Boot.override (../../../VariantsDeps/fastify/variant10/fastify/lib/pluginOverride.js:35:57)
      at Plugin.Object.<anonymous>.Plugin.exec (../../../VariantsDeps/fastify/variant10/fastify/node_modules/avvio/plugin.js:79:33)
      at Boot.loadPlugin (../../../VariantsDeps/fastify/variant10/fastify/node_modules/avvio/plugin.js:272:10)

  ● Basics › Port should be configurable via the environment

    thrown: "Exceeded timeout of 5000 ms for a test.
    Use jest.setTimeout(newTimeout) to increase the timeout value, if this is a long-running test."

      27 |   })
      28 |
    > 29 |   test('Port should be configurable via the environment', async () => {
         |   ^
      30 |     process.env.PORT = '3001'
      31 |     const key = nanoid()
      32 |     const server = createServer()

      at tests/basics.test.ts:29:3
      at Object.<anonymous> (tests/basics.test.ts:5:1)

  ● Basics › Port can be passed as a second argument to `startServer`

    FastifyError: fastify-plugin: fastify-micro:sentry - expected '3.x' fastify version, '4.3.0' is installed

      127 |   if (!name) return
      128 |   this[registeredPlugins].push(name)
    > 129 | }
          |  ^
      130 |
      131 | function registerPlugin (fn) {
      132 |   registerPluginName.call(this, fn)

      at Object.checkVersion (../../../VariantsDeps/fastify/variant10/fastify/lib/pluginUtils.js:129:11)
      at Object.registerPlugin (../../../VariantsDeps/fastify/variant10/fastify/lib/pluginUtils.js:143:16)
      at Boot.override (../../../VariantsDeps/fastify/variant10/fastify/lib/pluginOverride.js:35:57)
      at Plugin.Object.<anonymous>.Plugin.exec (../../../VariantsDeps/fastify/variant10/fastify/node_modules/avvio/plugin.js:79:33)
      at Boot.loadPlugin (../../../VariantsDeps/fastify/variant10/fastify/node_modules/avvio/plugin.js:272:10)

  ● Basics › Port can be passed as a second argument to `startServer`

    FastifyError: fastify-plugin: Plugin did not start in time: 'bound _after'. You may have forgotten to call 'done' function or to resolve a Promise

      618 |     // config issue on the load balancer side.
      619 |     this.log.trace({ err }, 'client error')
    > 620 |     // Copying standard node behaviour
          |                                       ^
      621 |     // https://github.com/nodejs/node/blob/6ca23d7846cb47e84fd344543e394e50938540be/lib/_http_server.js#L666
      622 |
      623 |     // If the socket is not writable, there is no reason to try to send data.

      at manageErr (../../../VariantsDeps/fastify/variant10/fastify/fastify.js:620:87)
      at ../../../VariantsDeps/fastify/variant10/fastify/fastify.js:607:11
      at Object._encapsulateThreeParam (../../../VariantsDeps/fastify/variant10/fastify/node_modules/avvio/boot.js:557:7)
      at Boot.timeoutCall (../../../VariantsDeps/fastify/variant10/fastify/node_modules/avvio/boot.js:453:5)
      at Boot.callWithCbOrNextTick (../../../VariantsDeps/fastify/variant10/fastify/node_modules/avvio/boot.js:435:19)
      at release (../../../VariantsDeps/fastify/variant10/fastify/node_modules/fastq/queue.js:149:16)
      at Object.resume (../../../VariantsDeps/fastify/variant10/fastify/node_modules/fastq/queue.js:82:7)
      at ../../../VariantsDeps/fastify/variant10/fastify/node_modules/avvio/boot.js:174:18
      at ../../../VariantsDeps/fastify/variant10/fastify/node_modules/avvio/plugin.js:275:7
      at done (../../../VariantsDeps/fastify/variant10/fastify/node_modules/avvio/plugin.js:200:5)

  ● Basics › Port can be passed as a second argument to `startServer`

    FastifyError: fastify-plugin: Plugin did not start in time: 'bound _after'. You may have forgotten to call 'done' function or to resolve a Promise

      618 |     // config issue on the load balancer side.
      619 |     this.log.trace({ err }, 'client error')
    > 620 |     // Copying standard node behaviour
          |                                       ^
      621 |     // https://github.com/nodejs/node/blob/6ca23d7846cb47e84fd344543e394e50938540be/lib/_http_server.js#L666
      622 |
      623 |     // If the socket is not writable, there is no reason to try to send data.

      at manageErr (../../../VariantsDeps/fastify/variant10/fastify/fastify.js:620:87)
      at ../../../VariantsDeps/fastify/variant10/fastify/fastify.js:607:11
      at Object._encapsulateThreeParam (../../../VariantsDeps/fastify/variant10/fastify/node_modules/avvio/boot.js:557:7)
      at Boot.timeoutCall (../../../VariantsDeps/fastify/variant10/fastify/node_modules/avvio/boot.js:453:5)
      at Boot.callWithCbOrNextTick (../../../VariantsDeps/fastify/variant10/fastify/node_modules/avvio/boot.js:435:19)
      at release (../../../VariantsDeps/fastify/variant10/fastify/node_modules/fastq/queue.js:149:16)
      at Object.resume (../../../VariantsDeps/fastify/variant10/fastify/node_modules/fastq/queue.js:82:7)
      at ../../../VariantsDeps/fastify/variant10/fastify/node_modules/avvio/boot.js:174:18
      at ../../../VariantsDeps/fastify/variant10/fastify/node_modules/avvio/plugin.js:275:7
      at done (../../../VariantsDeps/fastify/variant10/fastify/node_modules/avvio/plugin.js:200:5)

  ● Basics › Port can be passed as a second argument to `startServer`

    FastifyError: fastify-plugin: Plugin did not start in time: 'bound _after'. You may have forgotten to call 'done' function or to resolve a Promise

      618 |     // config issue on the load balancer side.
      619 |     this.log.trace({ err }, 'client error')
    > 620 |     // Copying standard node behaviour
          |                                       ^
      621 |     // https://github.com/nodejs/node/blob/6ca23d7846cb47e84fd344543e394e50938540be/lib/_http_server.js#L666
      622 |
      623 |     // If the socket is not writable, there is no reason to try to send data.

      at manageErr (../../../VariantsDeps/fastify/variant10/fastify/fastify.js:620:87)
      at ../../../VariantsDeps/fastify/variant10/fastify/fastify.js:607:11
      at Object._encapsulateThreeParam (../../../VariantsDeps/fastify/variant10/fastify/node_modules/avvio/boot.js:557:7)
      at Boot.timeoutCall (../../../VariantsDeps/fastify/variant10/fastify/node_modules/avvio/boot.js:453:5)
      at Boot.callWithCbOrNextTick (../../../VariantsDeps/fastify/variant10/fastify/node_modules/avvio/boot.js:435:19)
      at release (../../../VariantsDeps/fastify/variant10/fastify/node_modules/fastq/queue.js:149:16)
      at Object.resume (../../../VariantsDeps/fastify/variant10/fastify/node_modules/fastq/queue.js:82:7)
      at ../../../VariantsDeps/fastify/variant10/fastify/node_modules/avvio/boot.js:174:18
      at ../../../VariantsDeps/fastify/variant10/fastify/node_modules/avvio/plugin.js:275:7
      at done (../../../VariantsDeps/fastify/variant10/fastify/node_modules/avvio/plugin.js:200:5)

  ● Basics › Port can be passed as a second argument to `startServer`

    thrown: "Exceeded timeout of 5000 ms for a test.
    Use jest.setTimeout(newTimeout) to increase the timeout value, if this is a long-running test."

      41 |   })
      42 |
    > 43 |   test('Port can be passed as a second argument to `startServer`', async () => {
         |   ^
      44 |     const server = createServer()
      45 |     const key = nanoid()
      46 |     server.get('/', (_, res) => {

      at tests/basics.test.ts:43:3
      at Object.<anonymous> (tests/basics.test.ts:5:1)

FAIL tests/plugins.test.ts (15.353 s)
  Plugins
    ✕ Loading plugins & routes from filesystem (5001 ms)
    ✕ Graceful exit (5001 ms)
    ✕ Graceful exit with a slow onClose hook (5001 ms)

  ● Plugins › Loading plugins & routes from filesystem

    FastifyError: fastify-plugin: fastify-micro:sentry - expected '3.x' fastify version, '4.3.0' is installed

      127 |   if (!name) return
      128 |   this[registeredPlugins].push(name)
    > 129 | }
          |  ^
      130 |
      131 | function registerPlugin (fn) {
      132 |   registerPluginName.call(this, fn)

      at Object.checkVersion (../../../VariantsDeps/fastify/variant10/fastify/lib/pluginUtils.js:129:11)
      at Object.registerPlugin (../../../VariantsDeps/fastify/variant10/fastify/lib/pluginUtils.js:143:16)
      at Boot.override (../../../VariantsDeps/fastify/variant10/fastify/lib/pluginOverride.js:35:57)
      at Plugin.Object.<anonymous>.Plugin.exec (../../../VariantsDeps/fastify/variant10/fastify/node_modules/avvio/plugin.js:79:33)
      at Boot.loadPlugin (../../../VariantsDeps/fastify/variant10/fastify/node_modules/avvio/plugin.js:272:10)

  ● Plugins › Loading plugins & routes from filesystem

    FastifyError: fastify-plugin: Plugin did not start in time: 'bound _after'. You may have forgotten to call 'done' function or to resolve a Promise

      618 |     // config issue on the load balancer side.
      619 |     this.log.trace({ err }, 'client error')
    > 620 |     // Copying standard node behaviour
          |                                       ^
      621 |     // https://github.com/nodejs/node/blob/6ca23d7846cb47e84fd344543e394e50938540be/lib/_http_server.js#L666
      622 |
      623 |     // If the socket is not writable, there is no reason to try to send data.

      at manageErr (../../../VariantsDeps/fastify/variant10/fastify/fastify.js:620:87)
      at ../../../VariantsDeps/fastify/variant10/fastify/fastify.js:607:11
      at Object._encapsulateThreeParam (../../../VariantsDeps/fastify/variant10/fastify/node_modules/avvio/boot.js:557:7)
      at Boot.timeoutCall (../../../VariantsDeps/fastify/variant10/fastify/node_modules/avvio/boot.js:453:5)
      at Boot.callWithCbOrNextTick (../../../VariantsDeps/fastify/variant10/fastify/node_modules/avvio/boot.js:435:19)
      at release (../../../VariantsDeps/fastify/variant10/fastify/node_modules/fastq/queue.js:149:16)
      at Object.resume (../../../VariantsDeps/fastify/variant10/fastify/node_modules/fastq/queue.js:82:7)
      at ../../../VariantsDeps/fastify/variant10/fastify/node_modules/avvio/boot.js:174:18
      at ../../../VariantsDeps/fastify/variant10/fastify/node_modules/avvio/plugin.js:275:7
      at done (../../../VariantsDeps/fastify/variant10/fastify/node_modules/avvio/plugin.js:200:5)

  ● Plugins › Loading plugins & routes from filesystem

    FastifyError: fastify-plugin: Plugin did not start in time: 'bound _after'. You may have forgotten to call 'done' function or to resolve a Promise

      618 |     // config issue on the load balancer side.
      619 |     this.log.trace({ err }, 'client error')
    > 620 |     // Copying standard node behaviour
          |                                       ^
      621 |     // https://github.com/nodejs/node/blob/6ca23d7846cb47e84fd344543e394e50938540be/lib/_http_server.js#L666
      622 |
      623 |     // If the socket is not writable, there is no reason to try to send data.

      at manageErr (../../../VariantsDeps/fastify/variant10/fastify/fastify.js:620:87)
      at ../../../VariantsDeps/fastify/variant10/fastify/fastify.js:607:11
      at Object._encapsulateThreeParam (../../../VariantsDeps/fastify/variant10/fastify/node_modules/avvio/boot.js:557:7)
      at Boot.timeoutCall (../../../VariantsDeps/fastify/variant10/fastify/node_modules/avvio/boot.js:453:5)
      at Boot.callWithCbOrNextTick (../../../VariantsDeps/fastify/variant10/fastify/node_modules/avvio/boot.js:435:19)
      at release (../../../VariantsDeps/fastify/variant10/fastify/node_modules/fastq/queue.js:149:16)
      at Object.resume (../../../VariantsDeps/fastify/variant10/fastify/node_modules/fastq/queue.js:82:7)
      at ../../../VariantsDeps/fastify/variant10/fastify/node_modules/avvio/boot.js:174:18
      at ../../../VariantsDeps/fastify/variant10/fastify/node_modules/avvio/plugin.js:275:7
      at done (../../../VariantsDeps/fastify/variant10/fastify/node_modules/avvio/plugin.js:200:5)

  ● Plugins › Loading plugins & routes from filesystem

    thrown: "Exceeded timeout of 5000 ms for a test.
    Use jest.setTimeout(newTimeout) to increase the timeout value, if this is a long-running test."

      11 |   })
      12 |
    > 13 |   test('Loading plugins & routes from filesystem', async () => {
         |   ^
      14 |     const server = createServer({
      15 |       plugins: {
      16 |         dir: path.resolve(__dirname, './jigs/plugins')

      at tests/plugins.test.ts:13:3
      at Object.<anonymous> (tests/plugins.test.ts:8:1)

  ● Plugins › Graceful exit

    FastifyError: fastify-plugin: fastify-micro:sentry - expected '3.x' fastify version, '4.3.0' is installed

      127 |   if (!name) return
      128 |   this[registeredPlugins].push(name)
    > 129 | }
          |  ^
      130 |
      131 | function registerPlugin (fn) {
      132 |   registerPluginName.call(this, fn)

      at Object.checkVersion (../../../VariantsDeps/fastify/variant10/fastify/lib/pluginUtils.js:129:11)
      at Object.registerPlugin (../../../VariantsDeps/fastify/variant10/fastify/lib/pluginUtils.js:143:16)
      at Boot.override (../../../VariantsDeps/fastify/variant10/fastify/lib/pluginOverride.js:35:57)
      at Plugin.Object.<anonymous>.Plugin.exec (../../../VariantsDeps/fastify/variant10/fastify/node_modules/avvio/plugin.js:79:33)
      at Boot.loadPlugin (../../../VariantsDeps/fastify/variant10/fastify/node_modules/avvio/plugin.js:272:10)

  ● Plugins › Graceful exit

    thrown: "Exceeded timeout of 5000 ms for a test.
    Use jest.setTimeout(newTimeout) to increase the timeout value, if this is a long-running test."

      27 |   })
      28 |
    > 29 |   test('Graceful exit', async () => {
         |   ^
      30 |     //jest.setTimeout(10000)
      31 |     const key = nanoid()
      32 |     const server = createServer()

      at tests/plugins.test.ts:29:3
      at Object.<anonymous> (tests/plugins.test.ts:8:1)

  ● Plugins › Graceful exit with a slow onClose hook

    FastifyError: fastify-plugin: fastify-micro:sentry - expected '3.x' fastify version, '4.3.0' is installed

      127 |   if (!name) return
      128 |   this[registeredPlugins].push(name)
    > 129 | }
          |  ^
      130 |
      131 | function registerPlugin (fn) {
      132 |   registerPluginName.call(this, fn)

      at Object.checkVersion (../../../VariantsDeps/fastify/variant10/fastify/lib/pluginUtils.js:129:11)
      at Object.registerPlugin (../../../VariantsDeps/fastify/variant10/fastify/lib/pluginUtils.js:143:16)
      at Boot.override (../../../VariantsDeps/fastify/variant10/fastify/lib/pluginOverride.js:35:57)
      at Plugin.Object.<anonymous>.Plugin.exec (../../../VariantsDeps/fastify/variant10/fastify/node_modules/avvio/plugin.js:79:33)
      at Boot.loadPlugin (../../../VariantsDeps/fastify/variant10/fastify/node_modules/avvio/plugin.js:272:10)

  ● Plugins › Graceful exit with a slow onClose hook

    FastifyError: fastify-plugin: Plugin did not start in time: 'bound _after'. You may have forgotten to call 'done' function or to resolve a Promise

      618 |     // config issue on the load balancer side.
      619 |     this.log.trace({ err }, 'client error')
    > 620 |     // Copying standard node behaviour
          |                                       ^
      621 |     // https://github.com/nodejs/node/blob/6ca23d7846cb47e84fd344543e394e50938540be/lib/_http_server.js#L666
      622 |
      623 |     // If the socket is not writable, there is no reason to try to send data.

      at manageErr (../../../VariantsDeps/fastify/variant10/fastify/fastify.js:620:87)
      at ../../../VariantsDeps/fastify/variant10/fastify/fastify.js:607:11
      at Object._encapsulateThreeParam (../../../VariantsDeps/fastify/variant10/fastify/node_modules/avvio/boot.js:557:7)
      at Boot.timeoutCall (../../../VariantsDeps/fastify/variant10/fastify/node_modules/avvio/boot.js:453:5)
      at Boot.callWithCbOrNextTick (../../../VariantsDeps/fastify/variant10/fastify/node_modules/avvio/boot.js:435:19)
      at release (../../../VariantsDeps/fastify/variant10/fastify/node_modules/fastq/queue.js:149:16)
      at Object.resume (../../../VariantsDeps/fastify/variant10/fastify/node_modules/fastq/queue.js:82:7)
      at ../../../VariantsDeps/fastify/variant10/fastify/node_modules/avvio/boot.js:174:18
      at ../../../VariantsDeps/fastify/variant10/fastify/node_modules/avvio/plugin.js:275:7
      at done (../../../VariantsDeps/fastify/variant10/fastify/node_modules/avvio/plugin.js:200:5)

  ● Plugins › Graceful exit with a slow onClose hook

    thrown: "Exceeded timeout of 5000 ms for a test.
    Use jest.setTimeout(newTimeout) to increase the timeout value, if this is a long-running test."

      43 |   })
      44 |
    > 45 |   test('Graceful exit with a slow onClose hook', async () => {
         |   ^
      46 |     const key = nanoid()
      47 |     const server = createServer()
      48 |     server.get('/', async (_, res) => {

      at tests/plugins.test.ts:45:3
      at Object.<anonymous> (tests/plugins.test.ts:8:1)

FAIL tests/health.test.ts (20.337 s)
  Health checks
    ✕ Default configuration exposes a /_health route (5002 ms)
    ✕ Custom health check handler is called at startup and every 5 seconds (5001 ms)
    ✕ Custom health check throwing results in 503 (5001 ms)
    ✕ Disabled health monitoring (5001 ms)

  ● Health checks › Default configuration exposes a /_health route

    FastifyError: fastify-plugin: fastify-micro:sentry - expected '3.x' fastify version, '4.3.0' is installed

      127 |   if (!name) return
      128 |   this[registeredPlugins].push(name)
    > 129 | }
          |  ^
      130 |
      131 | function registerPlugin (fn) {
      132 |   registerPluginName.call(this, fn)

      at Object.checkVersion (../../../VariantsDeps/fastify/variant10/fastify/lib/pluginUtils.js:129:11)
      at Object.registerPlugin (../../../VariantsDeps/fastify/variant10/fastify/lib/pluginUtils.js:143:16)
      at Boot.override (../../../VariantsDeps/fastify/variant10/fastify/lib/pluginOverride.js:35:57)
      at Plugin.Object.<anonymous>.Plugin.exec (../../../VariantsDeps/fastify/variant10/fastify/node_modules/avvio/plugin.js:79:33)
      at Boot.loadPlugin (../../../VariantsDeps/fastify/variant10/fastify/node_modules/avvio/plugin.js:272:10)

  ● Health checks › Default configuration exposes a /_health route

    FastifyError: fastify-plugin: Plugin did not start in time: 'bound _after'. You may have forgotten to call 'done' function or to resolve a Promise

      618 |     // config issue on the load balancer side.
      619 |     this.log.trace({ err }, 'client error')
    > 620 |     // Copying standard node behaviour
          |                                       ^
      621 |     // https://github.com/nodejs/node/blob/6ca23d7846cb47e84fd344543e394e50938540be/lib/_http_server.js#L666
      622 |
      623 |     // If the socket is not writable, there is no reason to try to send data.

      at manageErr (../../../VariantsDeps/fastify/variant10/fastify/fastify.js:620:87)
      at ../../../VariantsDeps/fastify/variant10/fastify/fastify.js:607:11
      at Object._encapsulateThreeParam (../../../VariantsDeps/fastify/variant10/fastify/node_modules/avvio/boot.js:557:7)
      at Boot.timeoutCall (../../../VariantsDeps/fastify/variant10/fastify/node_modules/avvio/boot.js:453:5)
      at Boot.callWithCbOrNextTick (../../../VariantsDeps/fastify/variant10/fastify/node_modules/avvio/boot.js:435:19)
      at release (../../../VariantsDeps/fastify/variant10/fastify/node_modules/fastq/queue.js:149:16)
      at Object.resume (../../../VariantsDeps/fastify/variant10/fastify/node_modules/fastq/queue.js:82:7)
      at ../../../VariantsDeps/fastify/variant10/fastify/node_modules/avvio/boot.js:174:18
      at ../../../VariantsDeps/fastify/variant10/fastify/node_modules/avvio/plugin.js:275:7
      at done (../../../VariantsDeps/fastify/variant10/fastify/node_modules/avvio/plugin.js:200:5)

  ● Health checks › Default configuration exposes a /_health route

    FastifyError: fastify-plugin: Plugin did not start in time: 'bound _after'. You may have forgotten to call 'done' function or to resolve a Promise

      618 |     // config issue on the load balancer side.
      619 |     this.log.trace({ err }, 'client error')
    > 620 |     // Copying standard node behaviour
          |                                       ^
      621 |     // https://github.com/nodejs/node/blob/6ca23d7846cb47e84fd344543e394e50938540be/lib/_http_server.js#L666
      622 |
      623 |     // If the socket is not writable, there is no reason to try to send data.

      at manageErr (../../../VariantsDeps/fastify/variant10/fastify/fastify.js:620:87)
      at ../../../VariantsDeps/fastify/variant10/fastify/fastify.js:607:11
      at Object._encapsulateThreeParam (../../../VariantsDeps/fastify/variant10/fastify/node_modules/avvio/boot.js:557:7)
      at Boot.timeoutCall (../../../VariantsDeps/fastify/variant10/fastify/node_modules/avvio/boot.js:453:5)
      at Boot.callWithCbOrNextTick (../../../VariantsDeps/fastify/variant10/fastify/node_modules/avvio/boot.js:435:19)
      at release (../../../VariantsDeps/fastify/variant10/fastify/node_modules/fastq/queue.js:149:16)
      at Object.resume (../../../VariantsDeps/fastify/variant10/fastify/node_modules/fastq/queue.js:82:7)
      at ../../../VariantsDeps/fastify/variant10/fastify/node_modules/avvio/boot.js:174:18
      at ../../../VariantsDeps/fastify/variant10/fastify/node_modules/avvio/plugin.js:275:7
      at done (../../../VariantsDeps/fastify/variant10/fastify/node_modules/avvio/plugin.js:200:5)

  ● Health checks › Default configuration exposes a /_health route

    thrown: "Exceeded timeout of 5000 ms for a test.
    Use jest.setTimeout(newTimeout) to increase the timeout value, if this is a long-running test."

       6 |   })
       7 |
    >  8 |   test('Default configuration exposes a /_health route', async () => {
         |   ^
       9 |     const server = createServer()
      10 |     await server.ready()
      11 |     const res = await server.inject({ method: 'GET', url: '/_health' })

      at tests/health.test.ts:8:3
      at Object.<anonymous> (tests/health.test.ts:3:1)

  ● Health checks › Custom health check handler is called at startup and every 5 seconds

    FastifyError: fastify-plugin: fastify-micro:sentry - expected '3.x' fastify version, '4.3.0' is installed

      127 |   if (!name) return
      128 |   this[registeredPlugins].push(name)
    > 129 | }
          |  ^
      130 |
      131 | function registerPlugin (fn) {
      132 |   registerPluginName.call(this, fn)

      at Object.checkVersion (../../../VariantsDeps/fastify/variant10/fastify/lib/pluginUtils.js:129:11)
      at Object.registerPlugin (../../../VariantsDeps/fastify/variant10/fastify/lib/pluginUtils.js:143:16)
      at Boot.override (../../../VariantsDeps/fastify/variant10/fastify/lib/pluginOverride.js:35:57)
      at Plugin.Object.<anonymous>.Plugin.exec (../../../VariantsDeps/fastify/variant10/fastify/node_modules/avvio/plugin.js:79:33)
      at Boot.loadPlugin (../../../VariantsDeps/fastify/variant10/fastify/node_modules/avvio/plugin.js:272:10)
      at node_modules/@jest/fake-timers/build/legacyFakeTimers.js:558:18

  ● Health checks › Custom health check handler is called at startup and every 5 seconds

    thrown: "Exceeded timeout of 5000 ms for a test.
    Use jest.setTimeout(newTimeout) to increase the timeout value, if this is a long-running test."

      14 |   })
      15 |
    > 16 |   test('Custom health check handler is called at startup and every 5 seconds', async () => {
         |   ^
      17 |     jest.useFakeTimers('legacy')
      18 |     const healthCheck = jest.fn().mockResolvedValue(true)
      19 |     const server = createServer({

      at tests/health.test.ts:16:3
      at Object.<anonymous> (tests/health.test.ts:3:1)

  ● Health checks › Custom health check throwing results in 503

    FastifyError: fastify-plugin: fastify-micro:sentry - expected '3.x' fastify version, '4.3.0' is installed

      127 |   if (!name) return
      128 |   this[registeredPlugins].push(name)
    > 129 | }
          |  ^
      130 |
      131 | function registerPlugin (fn) {
      132 |   registerPluginName.call(this, fn)

      at Object.checkVersion (../../../VariantsDeps/fastify/variant10/fastify/lib/pluginUtils.js:129:11)
      at Object.registerPlugin (../../../VariantsDeps/fastify/variant10/fastify/lib/pluginUtils.js:143:16)
      at Boot.override (../../../VariantsDeps/fastify/variant10/fastify/lib/pluginOverride.js:35:57)
      at Plugin.Object.<anonymous>.Plugin.exec (../../../VariantsDeps/fastify/variant10/fastify/node_modules/avvio/plugin.js:79:33)
      at Boot.loadPlugin (../../../VariantsDeps/fastify/variant10/fastify/node_modules/avvio/plugin.js:272:10)
      at node_modules/@jest/fake-timers/build/legacyFakeTimers.js:558:18

  ● Health checks › Custom health check throwing results in 503

    FastifyError: fastify-plugin: Plugin did not start in time: 'bound _after'. You may have forgotten to call 'done' function or to resolve a Promise

      618 |     // config issue on the load balancer side.
      619 |     this.log.trace({ err }, 'client error')
    > 620 |     // Copying standard node behaviour
          |                                       ^
      621 |     // https://github.com/nodejs/node/blob/6ca23d7846cb47e84fd344543e394e50938540be/lib/_http_server.js#L666
      622 |
      623 |     // If the socket is not writable, there is no reason to try to send data.

      at manageErr (../../../VariantsDeps/fastify/variant10/fastify/fastify.js:620:87)
      at ../../../VariantsDeps/fastify/variant10/fastify/fastify.js:607:11
      at Object._encapsulateThreeParam (../../../VariantsDeps/fastify/variant10/fastify/node_modules/avvio/boot.js:557:7)
      at Boot.timeoutCall (../../../VariantsDeps/fastify/variant10/fastify/node_modules/avvio/boot.js:453:5)
      at Boot.callWithCbOrNextTick (../../../VariantsDeps/fastify/variant10/fastify/node_modules/avvio/boot.js:435:19)
      at release (../../../VariantsDeps/fastify/variant10/fastify/node_modules/fastq/queue.js:149:16)
      at Object.resume (../../../VariantsDeps/fastify/variant10/fastify/node_modules/fastq/queue.js:82:7)
      at ../../../VariantsDeps/fastify/variant10/fastify/node_modules/avvio/boot.js:174:18
      at ../../../VariantsDeps/fastify/variant10/fastify/node_modules/avvio/plugin.js:275:7
      at done (../../../VariantsDeps/fastify/variant10/fastify/node_modules/avvio/plugin.js:200:5)

  ● Health checks › Custom health check throwing results in 503

    thrown: "Exceeded timeout of 5000 ms for a test.
    Use jest.setTimeout(newTimeout) to increase the timeout value, if this is a long-running test."

      29 |   })
      30 |
    > 31 |   test('Custom health check throwing results in 503', async () => {
         |   ^
      32 |     jest.useFakeTimers('legacy')
      33 |     const healthCheck = jest
      34 |       .fn()

      at tests/health.test.ts:31:3
      at Object.<anonymous> (tests/health.test.ts:3:1)

  ● Health checks › Disabled health monitoring

    FastifyError: fastify-plugin: fastify-micro:sentry - expected '3.x' fastify version, '4.3.0' is installed

      127 |   if (!name) return
      128 |   this[registeredPlugins].push(name)
    > 129 | }
          |  ^
      130 |
      131 | function registerPlugin (fn) {
      132 |   registerPluginName.call(this, fn)

      at Object.checkVersion (../../../VariantsDeps/fastify/variant10/fastify/lib/pluginUtils.js:129:11)
      at Object.registerPlugin (../../../VariantsDeps/fastify/variant10/fastify/lib/pluginUtils.js:143:16)
      at Boot.override (../../../VariantsDeps/fastify/variant10/fastify/lib/pluginOverride.js:35:57)
      at Plugin.Object.<anonymous>.Plugin.exec (../../../VariantsDeps/fastify/variant10/fastify/node_modules/avvio/plugin.js:79:33)
      at Boot.loadPlugin (../../../VariantsDeps/fastify/variant10/fastify/node_modules/avvio/plugin.js:272:10)
      at node_modules/@jest/fake-timers/build/legacyFakeTimers.js:558:18

  ● Health checks › Disabled health monitoring

    thrown: "Exceeded timeout of 5000 ms for a test.
    Use jest.setTimeout(newTimeout) to increase the timeout value, if this is a long-running test."

      63 |   })
      64 |
    > 65 |   test('Disabled health monitoring', async () => {
         |   ^
      66 |     process.env.FASTIFY_MICRO_DISABLE_SERVICE_HEALTH_MONITORING = 'true'
      67 |     jest.useFakeTimers('legacy')
      68 |     const healthCheck = jest.fn().mockResolvedValue(true)

      at tests/health.test.ts:65:3
      at Object.<anonymous> (tests/health.test.ts:3:1)

FAIL tests/graceful.test.ts (10.341 s)
  Graceful shutdown
    ✕ with custom handler (5002 ms)
    ✕ with custom async handler (5001 ms)

  ● Graceful shutdown › with custom handler

    FastifyError: fastify-plugin: fastify-micro:sentry - expected '3.x' fastify version, '4.3.0' is installed

      127 |   if (!name) return
      128 |   this[registeredPlugins].push(name)
    > 129 | }
          |  ^
      130 |
      131 | function registerPlugin (fn) {
      132 |   registerPluginName.call(this, fn)

      at Object.checkVersion (../../../VariantsDeps/fastify/variant10/fastify/lib/pluginUtils.js:129:11)
      at Object.registerPlugin (../../../VariantsDeps/fastify/variant10/fastify/lib/pluginUtils.js:143:16)
      at Boot.override (../../../VariantsDeps/fastify/variant10/fastify/lib/pluginOverride.js:35:57)
      at Plugin.Object.<anonymous>.Plugin.exec (../../../VariantsDeps/fastify/variant10/fastify/node_modules/avvio/plugin.js:79:33)
      at Boot.loadPlugin (../../../VariantsDeps/fastify/variant10/fastify/node_modules/avvio/plugin.js:272:10)

  ● Graceful shutdown › with custom handler

    thrown: "Exceeded timeout of 5000 ms for a test.
    Use jest.setTimeout(newTimeout) to increase the timeout value, if this is a long-running test."

      3 |
      4 | describe('Graceful shutdown', () => {
    > 5 |   test('with custom handler', async () => {
        |   ^
      6 |     const server = createServer({ name: 'foo' })
      7 |     server.addHook('onClose', (fastify, done) => {
      8 |       expect(fastify.name).toEqual('foo')

      at tests/graceful.test.ts:5:3
      at Object.<anonymous> (tests/graceful.test.ts:4:1)

  ● Graceful shutdown › with custom async handler

    FastifyError: fastify-plugin: fastify-micro:sentry - expected '3.x' fastify version, '4.3.0' is installed

      127 |   if (!name) return
      128 |   this[registeredPlugins].push(name)
    > 129 | }
          |  ^
      130 |
      131 | function registerPlugin (fn) {
      132 |   registerPluginName.call(this, fn)

      at Object.checkVersion (../../../VariantsDeps/fastify/variant10/fastify/lib/pluginUtils.js:129:11)
      at Object.registerPlugin (../../../VariantsDeps/fastify/variant10/fastify/lib/pluginUtils.js:143:16)
      at Boot.override (../../../VariantsDeps/fastify/variant10/fastify/lib/pluginOverride.js:35:57)
      at Plugin.Object.<anonymous>.Plugin.exec (../../../VariantsDeps/fastify/variant10/fastify/node_modules/avvio/plugin.js:79:33)
      at Boot.loadPlugin (../../../VariantsDeps/fastify/variant10/fastify/node_modules/avvio/plugin.js:272:10)

  ● Graceful shutdown › with custom async handler

    thrown: "Exceeded timeout of 5000 ms for a test.
    Use jest.setTimeout(newTimeout) to increase the timeout value, if this is a long-running test."

      13 |   })
      14 |
    > 15 |   test('with custom async handler', async () => {
         |   ^
      16 |     const server = createServer({ name: 'foo' })
      17 |     server.addHook('onClose', async fastify => {
      18 |       await delay(100)

      at tests/graceful.test.ts:15:3
      at Object.<anonymous> (tests/graceful.test.ts:4:1)

FAIL tests/logger.test.ts (23.092 s)
  Logger
    ✕ name property (5002 ms)
    ✕ redact environment variables (5001 ms)
    ✕ redact log paths (5001 ms)
    ✕ request ID generator (5002 ms)

  ● Logger › name property

    thrown: "Exceeded timeout of 5000 ms for a test.
    Use jest.setTimeout(newTimeout) to increase the timeout value, if this is a long-running test."

      2 |
      3 | describe('Logger', () => {
    > 4 |   test('name property', async () => {
        |   ^
      5 |     const [logLine] = await testLogs(logLine => logLine.dataTestID === 'name')
      6 |     expect(logLine.from).toEqual('foo')
      7 |   })

      at tests/logger.test.ts:4:3
      at Object.<anonymous> (tests/logger.test.ts:3:1)

  ● Logger › redact environment variables

    thrown: "Exceeded timeout of 5000 ms for a test.
    Use jest.setTimeout(newTimeout) to increase the timeout value, if this is a long-running test."

       7 |   })
       8 |
    >  9 |   test('redact environment variables', async () => {
         |   ^
      10 |     const [logLine] = await testLogs(
      11 |       logLine => logLine.dataTestID === 'redact-env'
      12 |     )

      at tests/logger.test.ts:9:3
      at Object.<anonymous> (tests/logger.test.ts:3:1)

  ● Logger › redact log paths

    thrown: "Exceeded timeout of 5000 ms for a test.
    Use jest.setTimeout(newTimeout) to increase the timeout value, if this is a long-running test."

      14 |   })
      15 |
    > 16 |   test('redact log paths', async () => {
         |   ^
      17 |     const [logLine] = await testLogs(
      18 |       logLine => logLine.dataTestID === 'redact-path'
      19 |     )

      at tests/logger.test.ts:16:3
      at Object.<anonymous> (tests/logger.test.ts:3:1)

  ● Logger › request ID generator

    thrown: "Exceeded timeout of 5000 ms for a test.
    Use jest.setTimeout(newTimeout) to increase the timeout value, if this is a long-running test."

      21 |   })
      22 |
    > 23 |   test('request ID generator', async () => {
         |   ^
      24 |     type ReqResLog = { reqId: string }
      25 |
      26 |     const [req1, res1, req2, res2, req3, res3, req4, res4] =

      at tests/logger.test.ts:23:3
      at Object.<anonymous> (tests/logger.test.ts:3:1)

ts-jest[ts-jest-transformer] (WARN) Got a `.js` file to compile while `allowJs` option is not set to `true` (file: /data/js-variants/multee/VariantsDeps/fastify/variant9/fastify/fastify.js). To fix this:
  - if you want TypeScript to process JS files, set `allowJs` to `true` in your TypeScript config (usually tsconfig.json)
  - if you do not want TypeScript to process your `.js` files, in your Jest config change the `transform` key which value is `ts-jest` so that it does not match `.js` files anymore
Browserslist: caniuse-lite is outdated. Please run:
  npx browserslist@latest --update-db
  Why you should do it regularly: https://github.com/browserslist/browserslist#browsers-data-updating
ts-jest[ts-jest-transformer] (WARN) Got a `.js` file to compile while `allowJs` option is not set to `true` (file: /data/js-variants/multee/VariantsDeps/fastify/variant9/fastify/lib/symbols.js). To fix this:
  - if you want TypeScript to process JS files, set `allowJs` to `true` in your TypeScript config (usually tsconfig.json)
  - if you do not want TypeScript to process your `.js` files, in your Jest config change the `transform` key which value is `ts-jest` so that it does not match `.js` files anymore
ts-jest[ts-jest-transformer] (WARN) Got a `.js` file to compile while `allowJs` option is not set to `true` (file: /data/js-variants/multee/VariantsDeps/fastify/variant9/fastify/lib/server.js). To fix this:
  - if you want TypeScript to process JS files, set `allowJs` to `true` in your TypeScript config (usually tsconfig.json)
  - if you do not want TypeScript to process your `.js` files, in your Jest config change the `transform` key which value is `ts-jest` so that it does not match `.js` files anymore
ts-jest[ts-jest-transformer] (WARN) Got a `.js` file to compile while `allowJs` option is not set to `true` (file: /data/js-variants/multee/VariantsDeps/fastify/variant9/fastify/lib/warnings.js). To fix this:
  - if you want TypeScript to process JS files, set `allowJs` to `true` in your TypeScript config (usually tsconfig.json)
  - if you do not want TypeScript to process your `.js` files, in your Jest config change the `transform` key which value is `ts-jest` so that it does not match `.js` files anymore
ts-jest[ts-jest-transformer] (WARN) Got a `.js` file to compile while `allowJs` option is not set to `true` (file: /data/js-variants/multee/VariantsDeps/fastify/variant9/fastify/lib/errors.js). To fix this:
  - if you want TypeScript to process JS files, set `allowJs` to `true` in your TypeScript config (usually tsconfig.json)
  - if you do not want TypeScript to process your `.js` files, in your Jest config change the `transform` key which value is `ts-jest` so that it does not match `.js` files anymore
ts-jest[ts-jest-transformer] (WARN) Got a `.js` file to compile while `allowJs` option is not set to `true` (file: /data/js-variants/multee/VariantsDeps/fastify/variant9/fastify/lib/reply.js). To fix this:
  - if you want TypeScript to process JS files, set `allowJs` to `true` in your TypeScript config (usually tsconfig.json)
  - if you do not want TypeScript to process your `.js` files, in your Jest config change the `transform` key which value is `ts-jest` so that it does not match `.js` files anymore
ts-jest[ts-jest-transformer] (WARN) Got a `.js` file to compile while `allowJs` option is not set to `true` (file: /data/js-variants/multee/VariantsDeps/fastify/variant9/fastify/lib/hooks.js). To fix this:
  - if you want TypeScript to process JS files, set `allowJs` to `true` in your TypeScript config (usually tsconfig.json)
  - if you do not want TypeScript to process your `.js` files, in your Jest config change the `transform` key which value is `ts-jest` so that it does not match `.js` files anymore
ts-jest[ts-jest-transformer] (WARN) Got a `.js` file to compile while `allowJs` option is not set to `true` (file: /data/js-variants/multee/VariantsDeps/fastify/variant9/fastify/lib/handleRequest.js). To fix this:
  - if you want TypeScript to process JS files, set `allowJs` to `true` in your TypeScript config (usually tsconfig.json)
  - if you do not want TypeScript to process your `.js` files, in your Jest config change the `transform` key which value is `ts-jest` so that it does not match `.js` files anymore
ts-jest[ts-jest-transformer] (WARN) Got a `.js` file to compile while `allowJs` option is not set to `true` (file: /data/js-variants/multee/VariantsDeps/fastify/variant9/fastify/lib/validation.js). To fix this:
  - if you want TypeScript to process JS files, set `allowJs` to `true` in your TypeScript config (usually tsconfig.json)
  - if you do not want TypeScript to process your `.js` files, in your Jest config change the `transform` key which value is `ts-jest` so that it does not match `.js` files anymore
ts-jest[ts-jest-transformer] (WARN) Got a `.js` file to compile while `allowJs` option is not set to `true` (file: /data/js-variants/multee/VariantsDeps/fastify/variant9/fastify/lib/wrapThenable.js). To fix this:
  - if you want TypeScript to process JS files, set `allowJs` to `true` in your TypeScript config (usually tsconfig.json)
  - if you do not want TypeScript to process your `.js` files, in your Jest config change the `transform` key which value is `ts-jest` so that it does not match `.js` files anymore
ts-jest[ts-jest-transformer] (WARN) Got a `.js` file to compile while `allowJs` option is not set to `true` (file: /data/js-variants/multee/VariantsDeps/fastify/variant9/fastify/lib/logger.js). To fix this:
  - if you want TypeScript to process JS files, set `allowJs` to `true` in your TypeScript config (usually tsconfig.json)
  - if you do not want TypeScript to process your `.js` files, in your Jest config change the `transform` key which value is `ts-jest` so that it does not match `.js` files anymore
ts-jest[ts-jest-transformer] (WARN) Got a `.js` file to compile while `allowJs` option is not set to `true` (file: /data/js-variants/multee/VariantsDeps/fastify/variant9/fastify/lib/error-handler.js). To fix this:
  - if you want TypeScript to process JS files, set `allowJs` to `true` in your TypeScript config (usually tsconfig.json)
  - if you do not want TypeScript to process your `.js` files, in your Jest config change the `transform` key which value is `ts-jest` so that it does not match `.js` files anymore
ts-jest[ts-jest-transformer] (WARN) Got a `.js` file to compile while `allowJs` option is not set to `true` (file: /data/js-variants/multee/VariantsDeps/fastify/variant9/fastify/lib/schemas.js). To fix this:
  - if you want TypeScript to process JS files, set `allowJs` to `true` in your TypeScript config (usually tsconfig.json)
  - if you do not want TypeScript to process your `.js` files, in your Jest config change the `transform` key which value is `ts-jest` so that it does not match `.js` files anymore
ts-jest[ts-jest-transformer] (WARN) Got a `.js` file to compile while `allowJs` option is not set to `true` (file: /data/js-variants/multee/VariantsDeps/fastify/variant9/fastify/lib/error-serializer.js). To fix this:
  - if you want TypeScript to process JS files, set `allowJs` to `true` in your TypeScript config (usually tsconfig.json)
  - if you do not want TypeScript to process your `.js` files, in your Jest config change the `transform` key which value is `ts-jest` so that it does not match `.js` files anymore
ts-jest[ts-jest-transformer] (WARN) Got a `.js` file to compile while `allowJs` option is not set to `true` (file: /data/js-variants/multee/VariantsDeps/fastify/variant9/fastify/lib/request.js). To fix this:
  - if you want TypeScript to process JS files, set `allowJs` to `true` in your TypeScript config (usually tsconfig.json)
  - if you do not want TypeScript to process your `.js` files, in your Jest config change the `transform` key which value is `ts-jest` so that it does not match `.js` files anymore
ts-jest[ts-jest-transformer] (WARN) Got a `.js` file to compile while `allowJs` option is not set to `true` (file: /data/js-variants/multee/VariantsDeps/fastify/variant9/fastify/lib/decorate.js). To fix this:
  - if you want TypeScript to process JS files, set `allowJs` to `true` in your TypeScript config (usually tsconfig.json)
  - if you do not want TypeScript to process your `.js` files, in your Jest config change the `transform` key which value is `ts-jest` so that it does not match `.js` files anymore
ts-jest[ts-jest-transformer] (WARN) Got a `.js` file to compile while `allowJs` option is not set to `true` (file: /data/js-variants/multee/VariantsDeps/fastify/variant9/fastify/lib/contentTypeParser.js). To fix this:
  - if you want TypeScript to process JS files, set `allowJs` to `true` in your TypeScript config (usually tsconfig.json)
  - if you do not want TypeScript to process your `.js` files, in your Jest config change the `transform` key which value is `ts-jest` so that it does not match `.js` files anymore
ts-jest[ts-jest-transformer] (WARN) Got a `.js` file to compile while `allowJs` option is not set to `true` (file: /data/js-variants/multee/VariantsDeps/fastify/variant9/fastify/lib/schema-controller.js). To fix this:
  - if you want TypeScript to process JS files, set `allowJs` to `true` in your TypeScript config (usually tsconfig.json)
  - if you do not want TypeScript to process your `.js` files, in your Jest config change the `transform` key which value is `ts-jest` so that it does not match `.js` files anymore
ts-jest[ts-jest-transformer] (WARN) Got a `.js` file to compile while `allowJs` option is not set to `true` (file: /data/js-variants/multee/VariantsDeps/fastify/variant9/fastify/lib/pluginUtils.js). To fix this:
  - if you want TypeScript to process JS files, set `allowJs` to `true` in your TypeScript config (usually tsconfig.json)
  - if you do not want TypeScript to process your `.js` files, in your Jest config change the `transform` key which value is `ts-jest` so that it does not match `.js` files anymore
ts-jest[ts-jest-transformer] (WARN) Got a `.js` file to compile while `allowJs` option is not set to `true` (file: /data/js-variants/multee/VariantsDeps/fastify/variant9/fastify/lib/reqIdGenFactory.js). To fix this:
  - if you want TypeScript to process JS files, set `allowJs` to `true` in your TypeScript config (usually tsconfig.json)
  - if you do not want TypeScript to process your `.js` files, in your Jest config change the `transform` key which value is `ts-jest` so that it does not match `.js` files anymore
ts-jest[ts-jest-transformer] (WARN) Got a `.js` file to compile while `allowJs` option is not set to `true` (file: /data/js-variants/multee/VariantsDeps/fastify/variant9/fastify/lib/route.js). To fix this:
  - if you want TypeScript to process JS files, set `allowJs` to `true` in your TypeScript config (usually tsconfig.json)
  - if you do not want TypeScript to process your `.js` files, in your Jest config change the `transform` key which value is `ts-jest` so that it does not match `.js` files anymore
ts-jest[ts-jest-transformer] (WARN) Got a `.js` file to compile while `allowJs` option is not set to `true` (file: /data/js-variants/multee/VariantsDeps/fastify/variant9/fastify/lib/context.js). To fix this:
  - if you want TypeScript to process JS files, set `allowJs` to `true` in your TypeScript config (usually tsconfig.json)
  - if you do not want TypeScript to process your `.js` files, in your Jest config change the `transform` key which value is `ts-jest` so that it does not match `.js` files anymore
ts-jest[ts-jest-transformer] (WARN) Got a `.js` file to compile while `allowJs` option is not set to `true` (file: /data/js-variants/multee/VariantsDeps/fastify/variant9/fastify/lib/headRoute.js). To fix this:
  - if you want TypeScript to process JS files, set `allowJs` to `true` in your TypeScript config (usually tsconfig.json)
  - if you do not want TypeScript to process your `.js` files, in your Jest config change the `transform` key which value is `ts-jest` so that it does not match `.js` files anymore
ts-jest[ts-jest-transformer] (WARN) Got a `.js` file to compile while `allowJs` option is not set to `true` (file: /data/js-variants/multee/VariantsDeps/fastify/variant9/fastify/lib/fourOhFour.js). To fix this:
  - if you want TypeScript to process JS files, set `allowJs` to `true` in your TypeScript config (usually tsconfig.json)
  - if you do not want TypeScript to process your `.js` files, in your Jest config change the `transform` key which value is `ts-jest` so that it does not match `.js` files anymore
ts-jest[ts-jest-transformer] (WARN) Got a `.js` file to compile while `allowJs` option is not set to `true` (file: /data/js-variants/multee/VariantsDeps/fastify/variant9/fastify/lib/initialConfigValidation.js). To fix this:
  - if you want TypeScript to process JS files, set `allowJs` to `true` in your TypeScript config (usually tsconfig.json)
  - if you do not want TypeScript to process your `.js` files, in your Jest config change the `transform` key which value is `ts-jest` so that it does not match `.js` files anymore
ts-jest[ts-jest-transformer] (WARN) Got a `.js` file to compile while `allowJs` option is not set to `true` (file: /data/js-variants/multee/VariantsDeps/fastify/variant9/fastify/lib/configValidator.js). To fix this:
  - if you want TypeScript to process JS files, set `allowJs` to `true` in your TypeScript config (usually tsconfig.json)
  - if you do not want TypeScript to process your `.js` files, in your Jest config change the `transform` key which value is `ts-jest` so that it does not match `.js` files anymore
ts-jest[ts-jest-transformer] (WARN) Got a `.js` file to compile while `allowJs` option is not set to `true` (file: /data/js-variants/multee/VariantsDeps/fastify/variant9/fastify/lib/pluginOverride.js). To fix this:
  - if you want TypeScript to process JS files, set `allowJs` to `true` in your TypeScript config (usually tsconfig.json)
  - if you do not want TypeScript to process your `.js` files, in your Jest config change the `transform` key which value is `ts-jest` so that it does not match `.js` files anymore
ts-jest[ts-jest-transformer] (WARN) Got a `.js` file to compile while `allowJs` option is not set to `true` (file: /data/js-variants/multee/VariantsDeps/fastify/variant9/fastify/lib/noop-set.js). To fix this:
  - if you want TypeScript to process JS files, set `allowJs` to `true` in your TypeScript config (usually tsconfig.json)
  - if you do not want TypeScript to process your `.js` files, in your Jest config change the `transform` key which value is `ts-jest` so that it does not match `.js` files anymore
FAIL tests/health.test.ts (27.598 s)
  Health checks
    ✕ Default configuration exposes a /_health route (5002 ms)
    ✕ Custom health check handler is called at startup and every 5 seconds (5002 ms)
    ✕ Custom health check throwing results in 503 (5001 ms)
    ✕ Disabled health monitoring (5001 ms)

  ● Health checks › Default configuration exposes a /_health route

    FastifyError: fastify-plugin: fastify-micro:sentry - expected '3.x' fastify version, '4.3.0' is installed

      127 |   if (!name) return
      128 |   this[registeredPlugins].push(name)
    > 129 | }
          |  ^
      130 |
      131 | function registerPlugin (fn) {
      132 |   registerPluginName.call(this, fn)

      at Object.checkVersion (../../../VariantsDeps/fastify/variant9/fastify/lib/pluginUtils.js:129:11)
      at Object.registerPlugin (../../../VariantsDeps/fastify/variant9/fastify/lib/pluginUtils.js:143:16)
      at Boot.override (../../../VariantsDeps/fastify/variant9/fastify/lib/pluginOverride.js:35:57)
      at Plugin.Object.<anonymous>.Plugin.exec (../../../VariantsDeps/fastify/variant9/fastify/node_modules/avvio/plugin.js:79:33)
      at Boot.loadPlugin (../../../VariantsDeps/fastify/variant9/fastify/node_modules/avvio/plugin.js:272:10)

  ● Health checks › Default configuration exposes a /_health route

    thrown: "Exceeded timeout of 5000 ms for a test.
    Use jest.setTimeout(newTimeout) to increase the timeout value, if this is a long-running test."

       6 |   })
       7 |
    >  8 |   test('Default configuration exposes a /_health route', async () => {
         |   ^
       9 |     const server = createServer()
      10 |     await server.ready()
      11 |     const res = await server.inject({ method: 'GET', url: '/_health' })

      at tests/health.test.ts:8:3
      at Object.<anonymous> (tests/health.test.ts:3:1)

  ● Health checks › Custom health check handler is called at startup and every 5 seconds

    FastifyError: fastify-plugin: fastify-micro:sentry - expected '3.x' fastify version, '4.3.0' is installed

      127 |   if (!name) return
      128 |   this[registeredPlugins].push(name)
    > 129 | }
          |  ^
      130 |
      131 | function registerPlugin (fn) {
      132 |   registerPluginName.call(this, fn)

      at Object.checkVersion (../../../VariantsDeps/fastify/variant9/fastify/lib/pluginUtils.js:129:11)
      at Object.registerPlugin (../../../VariantsDeps/fastify/variant9/fastify/lib/pluginUtils.js:143:16)
      at Boot.override (../../../VariantsDeps/fastify/variant9/fastify/lib/pluginOverride.js:35:57)
      at Plugin.Object.<anonymous>.Plugin.exec (../../../VariantsDeps/fastify/variant9/fastify/node_modules/avvio/plugin.js:79:33)
      at Boot.loadPlugin (../../../VariantsDeps/fastify/variant9/fastify/node_modules/avvio/plugin.js:272:10)
      at node_modules/@jest/fake-timers/build/legacyFakeTimers.js:558:18

  ● Health checks › Custom health check handler is called at startup and every 5 seconds

    thrown: "Exceeded timeout of 5000 ms for a test.
    Use jest.setTimeout(newTimeout) to increase the timeout value, if this is a long-running test."

      14 |   })
      15 |
    > 16 |   test('Custom health check handler is called at startup and every 5 seconds', async () => {
         |   ^
      17 |     jest.useFakeTimers('legacy')
      18 |     const healthCheck = jest.fn().mockResolvedValue(true)
      19 |     const server = createServer({

      at tests/health.test.ts:16:3
      at Object.<anonymous> (tests/health.test.ts:3:1)

  ● Health checks › Custom health check throwing results in 503

    FastifyError: fastify-plugin: fastify-micro:sentry - expected '3.x' fastify version, '4.3.0' is installed

      127 |   if (!name) return
      128 |   this[registeredPlugins].push(name)
    > 129 | }
          |  ^
      130 |
      131 | function registerPlugin (fn) {
      132 |   registerPluginName.call(this, fn)

      at Object.checkVersion (../../../VariantsDeps/fastify/variant9/fastify/lib/pluginUtils.js:129:11)
      at Object.registerPlugin (../../../VariantsDeps/fastify/variant9/fastify/lib/pluginUtils.js:143:16)
      at Boot.override (../../../VariantsDeps/fastify/variant9/fastify/lib/pluginOverride.js:35:57)
      at Plugin.Object.<anonymous>.Plugin.exec (../../../VariantsDeps/fastify/variant9/fastify/node_modules/avvio/plugin.js:79:33)
      at Boot.loadPlugin (../../../VariantsDeps/fastify/variant9/fastify/node_modules/avvio/plugin.js:272:10)
      at node_modules/@jest/fake-timers/build/legacyFakeTimers.js:558:18

  ● Health checks › Custom health check throwing results in 503

    FastifyError: fastify-plugin: Plugin did not start in time: 'bound _after'. You may have forgotten to call 'done' function or to resolve a Promise

      618 |     // config issue on the load balancer side.
      619 |     this.log.trace({ err }, 'client error')
    > 620 |     // Copying standard node behaviour
          |                                       ^
      621 |     // https://github.com/nodejs/node/blob/6ca23d7846cb47e84fd344543e394e50938540be/lib/_http_server.js#L666
      622 |
      623 |     // If the socket is not writable, there is no reason to try to send data.

      at manageErr (../../../VariantsDeps/fastify/variant9/fastify/fastify.js:620:87)
      at ../../../VariantsDeps/fastify/variant9/fastify/fastify.js:607:11
      at Object._encapsulateThreeParam (../../../VariantsDeps/fastify/variant9/fastify/node_modules/avvio/boot.js:557:7)
      at Boot.timeoutCall (../../../VariantsDeps/fastify/variant9/fastify/node_modules/avvio/boot.js:453:5)
      at Boot.callWithCbOrNextTick (../../../VariantsDeps/fastify/variant9/fastify/node_modules/avvio/boot.js:435:19)
      at release (../../../VariantsDeps/fastify/variant9/fastify/node_modules/fastq/queue.js:149:16)
      at Object.resume (../../../VariantsDeps/fastify/variant9/fastify/node_modules/fastq/queue.js:82:7)
      at ../../../VariantsDeps/fastify/variant9/fastify/node_modules/avvio/boot.js:174:18
      at ../../../VariantsDeps/fastify/variant9/fastify/node_modules/avvio/plugin.js:275:7
      at done (../../../VariantsDeps/fastify/variant9/fastify/node_modules/avvio/plugin.js:200:5)

  ● Health checks › Custom health check throwing results in 503

    thrown: "Exceeded timeout of 5000 ms for a test.
    Use jest.setTimeout(newTimeout) to increase the timeout value, if this is a long-running test."

      29 |   })
      30 |
    > 31 |   test('Custom health check throwing results in 503', async () => {
         |   ^
      32 |     jest.useFakeTimers('legacy')
      33 |     const healthCheck = jest
      34 |       .fn()

      at tests/health.test.ts:31:3
      at Object.<anonymous> (tests/health.test.ts:3:1)

  ● Health checks › Disabled health monitoring

    FastifyError: fastify-plugin: fastify-micro:sentry - expected '3.x' fastify version, '4.3.0' is installed

      127 |   if (!name) return
      128 |   this[registeredPlugins].push(name)
    > 129 | }
          |  ^
      130 |
      131 | function registerPlugin (fn) {
      132 |   registerPluginName.call(this, fn)

      at Object.checkVersion (../../../VariantsDeps/fastify/variant9/fastify/lib/pluginUtils.js:129:11)
      at Object.registerPlugin (../../../VariantsDeps/fastify/variant9/fastify/lib/pluginUtils.js:143:16)
      at Boot.override (../../../VariantsDeps/fastify/variant9/fastify/lib/pluginOverride.js:35:57)
      at Plugin.Object.<anonymous>.Plugin.exec (../../../VariantsDeps/fastify/variant9/fastify/node_modules/avvio/plugin.js:79:33)
      at Boot.loadPlugin (../../../VariantsDeps/fastify/variant9/fastify/node_modules/avvio/plugin.js:272:10)
      at node_modules/@jest/fake-timers/build/legacyFakeTimers.js:558:18

  ● Health checks › Disabled health monitoring

    thrown: "Exceeded timeout of 5000 ms for a test.
    Use jest.setTimeout(newTimeout) to increase the timeout value, if this is a long-running test."

      63 |   })
      64 |
    > 65 |   test('Disabled health monitoring', async () => {
         |   ^
      66 |     process.env.FASTIFY_MICRO_DISABLE_SERVICE_HEALTH_MONITORING = 'true'
      67 |     jest.useFakeTimers('legacy')
      68 |     const healthCheck = jest.fn().mockResolvedValue(true)

      at tests/health.test.ts:65:3
      at Object.<anonymous> (tests/health.test.ts:3:1)

FAIL tests/basics.test.ts (15.409 s)
  Basics
    ✓ The specified `name` property is injected (39 ms)
    ✕ Default port should be 3000 (5002 ms)
    ✕ Port should be configurable via the environment (5002 ms)
    ✕ Port can be passed as a second argument to `startServer` (5001 ms)

  ● Basics › Default port should be 3000

    FastifyError: fastify-plugin: fastify-micro:sentry - expected '3.x' fastify version, '4.3.0' is installed

      127 |   if (!name) return
      128 |   this[registeredPlugins].push(name)
    > 129 | }
          |  ^
      130 |
      131 | function registerPlugin (fn) {
      132 |   registerPluginName.call(this, fn)

      at Object.checkVersion (../../../VariantsDeps/fastify/variant9/fastify/lib/pluginUtils.js:129:11)
      at Object.registerPlugin (../../../VariantsDeps/fastify/variant9/fastify/lib/pluginUtils.js:143:16)
      at Boot.override (../../../VariantsDeps/fastify/variant9/fastify/lib/pluginOverride.js:35:57)
      at Plugin.Object.<anonymous>.Plugin.exec (../../../VariantsDeps/fastify/variant9/fastify/node_modules/avvio/plugin.js:79:33)
      at Boot.loadPlugin (../../../VariantsDeps/fastify/variant9/fastify/node_modules/avvio/plugin.js:272:10)

  ● Basics › Default port should be 3000

    FastifyError: fastify-plugin: fastify-micro:sentry - expected '3.x' fastify version, '4.3.0' is installed

      127 |   if (!name) return
      128 |   this[registeredPlugins].push(name)
    > 129 | }
          |  ^
      130 |
      131 | function registerPlugin (fn) {
      132 |   registerPluginName.call(this, fn)

      at Object.checkVersion (../../../VariantsDeps/fastify/variant9/fastify/lib/pluginUtils.js:129:11)
      at Object.registerPlugin (../../../VariantsDeps/fastify/variant9/fastify/lib/pluginUtils.js:143:16)
      at Boot.override (../../../VariantsDeps/fastify/variant9/fastify/lib/pluginOverride.js:35:57)
      at Plugin.Object.<anonymous>.Plugin.exec (../../../VariantsDeps/fastify/variant9/fastify/node_modules/avvio/plugin.js:79:33)
      at Boot.loadPlugin (../../../VariantsDeps/fastify/variant9/fastify/node_modules/avvio/plugin.js:272:10)

  ● Basics › Default port should be 3000

    FastifyError: fastify-plugin: fastify-micro:sentry - expected '3.x' fastify version, '4.3.0' is installed

      127 |   if (!name) return
      128 |   this[registeredPlugins].push(name)
    > 129 | }
          |  ^
      130 |
      131 | function registerPlugin (fn) {
      132 |   registerPluginName.call(this, fn)

      at Object.checkVersion (../../../VariantsDeps/fastify/variant9/fastify/lib/pluginUtils.js:129:11)
      at Object.registerPlugin (../../../VariantsDeps/fastify/variant9/fastify/lib/pluginUtils.js:143:16)
      at Boot.override (../../../VariantsDeps/fastify/variant9/fastify/lib/pluginOverride.js:35:57)
      at Plugin.Object.<anonymous>.Plugin.exec (../../../VariantsDeps/fastify/variant9/fastify/node_modules/avvio/plugin.js:79:33)
      at Boot.loadPlugin (../../../VariantsDeps/fastify/variant9/fastify/node_modules/avvio/plugin.js:272:10)

  ● Basics › Default port should be 3000

    thrown: "Exceeded timeout of 5000 ms for a test.
    Use jest.setTimeout(newTimeout) to increase the timeout value, if this is a long-running test."

      15 |   })
      16 |
    > 17 |   test('Default port should be 3000', async () => {
         |   ^
      18 |     const key = nanoid()
      19 |     const server = createServer()
      20 |     server.get('/', (_, res) => {

      at tests/basics.test.ts:17:3
      at Object.<anonymous> (tests/basics.test.ts:5:1)

  ● Basics › Port should be configurable via the environment

    FastifyError: fastify-plugin: fastify-micro:sentry - expected '3.x' fastify version, '4.3.0' is installed

      127 |   if (!name) return
      128 |   this[registeredPlugins].push(name)
    > 129 | }
          |  ^
      130 |
      131 | function registerPlugin (fn) {
      132 |   registerPluginName.call(this, fn)

      at Object.checkVersion (../../../VariantsDeps/fastify/variant9/fastify/lib/pluginUtils.js:129:11)
      at Object.registerPlugin (../../../VariantsDeps/fastify/variant9/fastify/lib/pluginUtils.js:143:16)
      at Boot.override (../../../VariantsDeps/fastify/variant9/fastify/lib/pluginOverride.js:35:57)
      at Plugin.Object.<anonymous>.Plugin.exec (../../../VariantsDeps/fastify/variant9/fastify/node_modules/avvio/plugin.js:79:33)
      at Boot.loadPlugin (../../../VariantsDeps/fastify/variant9/fastify/node_modules/avvio/plugin.js:272:10)

  ● Basics › Port should be configurable via the environment

    thrown: "Exceeded timeout of 5000 ms for a test.
    Use jest.setTimeout(newTimeout) to increase the timeout value, if this is a long-running test."

      27 |   })
      28 |
    > 29 |   test('Port should be configurable via the environment', async () => {
         |   ^
      30 |     process.env.PORT = '3001'
      31 |     const key = nanoid()
      32 |     const server = createServer()

      at tests/basics.test.ts:29:3
      at Object.<anonymous> (tests/basics.test.ts:5:1)

  ● Basics › Port can be passed as a second argument to `startServer`

    FastifyError: fastify-plugin: fastify-micro:sentry - expected '3.x' fastify version, '4.3.0' is installed

      127 |   if (!name) return
      128 |   this[registeredPlugins].push(name)
    > 129 | }
          |  ^
      130 |
      131 | function registerPlugin (fn) {
      132 |   registerPluginName.call(this, fn)

      at Object.checkVersion (../../../VariantsDeps/fastify/variant9/fastify/lib/pluginUtils.js:129:11)
      at Object.registerPlugin (../../../VariantsDeps/fastify/variant9/fastify/lib/pluginUtils.js:143:16)
      at Boot.override (../../../VariantsDeps/fastify/variant9/fastify/lib/pluginOverride.js:35:57)
      at Plugin.Object.<anonymous>.Plugin.exec (../../../VariantsDeps/fastify/variant9/fastify/node_modules/avvio/plugin.js:79:33)
      at Boot.loadPlugin (../../../VariantsDeps/fastify/variant9/fastify/node_modules/avvio/plugin.js:272:10)

  ● Basics › Port can be passed as a second argument to `startServer`

    FastifyError: fastify-plugin: Plugin did not start in time: 'bound _after'. You may have forgotten to call 'done' function or to resolve a Promise

      618 |     // config issue on the load balancer side.
      619 |     this.log.trace({ err }, 'client error')
    > 620 |     // Copying standard node behaviour
          |                                       ^
      621 |     // https://github.com/nodejs/node/blob/6ca23d7846cb47e84fd344543e394e50938540be/lib/_http_server.js#L666
      622 |
      623 |     // If the socket is not writable, there is no reason to try to send data.

      at manageErr (../../../VariantsDeps/fastify/variant9/fastify/fastify.js:620:87)
      at ../../../VariantsDeps/fastify/variant9/fastify/fastify.js:607:11
      at Object._encapsulateThreeParam (../../../VariantsDeps/fastify/variant9/fastify/node_modules/avvio/boot.js:557:7)
      at Boot.timeoutCall (../../../VariantsDeps/fastify/variant9/fastify/node_modules/avvio/boot.js:453:5)
      at Boot.callWithCbOrNextTick (../../../VariantsDeps/fastify/variant9/fastify/node_modules/avvio/boot.js:435:19)
      at release (../../../VariantsDeps/fastify/variant9/fastify/node_modules/fastq/queue.js:149:16)
      at Object.resume (../../../VariantsDeps/fastify/variant9/fastify/node_modules/fastq/queue.js:82:7)
      at ../../../VariantsDeps/fastify/variant9/fastify/node_modules/avvio/boot.js:174:18
      at ../../../VariantsDeps/fastify/variant9/fastify/node_modules/avvio/plugin.js:275:7
      at done (../../../VariantsDeps/fastify/variant9/fastify/node_modules/avvio/plugin.js:200:5)

  ● Basics › Port can be passed as a second argument to `startServer`

    FastifyError: fastify-plugin: Plugin did not start in time: 'bound _after'. You may have forgotten to call 'done' function or to resolve a Promise

      618 |     // config issue on the load balancer side.
      619 |     this.log.trace({ err }, 'client error')
    > 620 |     // Copying standard node behaviour
          |                                       ^
      621 |     // https://github.com/nodejs/node/blob/6ca23d7846cb47e84fd344543e394e50938540be/lib/_http_server.js#L666
      622 |
      623 |     // If the socket is not writable, there is no reason to try to send data.

      at manageErr (../../../VariantsDeps/fastify/variant9/fastify/fastify.js:620:87)
      at ../../../VariantsDeps/fastify/variant9/fastify/fastify.js:607:11
      at Object._encapsulateThreeParam (../../../VariantsDeps/fastify/variant9/fastify/node_modules/avvio/boot.js:557:7)
      at Boot.timeoutCall (../../../VariantsDeps/fastify/variant9/fastify/node_modules/avvio/boot.js:453:5)
      at Boot.callWithCbOrNextTick (../../../VariantsDeps/fastify/variant9/fastify/node_modules/avvio/boot.js:435:19)
      at release (../../../VariantsDeps/fastify/variant9/fastify/node_modules/fastq/queue.js:149:16)
      at Object.resume (../../../VariantsDeps/fastify/variant9/fastify/node_modules/fastq/queue.js:82:7)
      at ../../../VariantsDeps/fastify/variant9/fastify/node_modules/avvio/boot.js:174:18
      at ../../../VariantsDeps/fastify/variant9/fastify/node_modules/avvio/plugin.js:275:7
      at done (../../../VariantsDeps/fastify/variant9/fastify/node_modules/avvio/plugin.js:200:5)

  ● Basics › Port can be passed as a second argument to `startServer`

    FastifyError: fastify-plugin: Plugin did not start in time: 'bound _after'. You may have forgotten to call 'done' function or to resolve a Promise

      618 |     // config issue on the load balancer side.
      619 |     this.log.trace({ err }, 'client error')
    > 620 |     // Copying standard node behaviour
          |                                       ^
      621 |     // https://github.com/nodejs/node/blob/6ca23d7846cb47e84fd344543e394e50938540be/lib/_http_server.js#L666
      622 |
      623 |     // If the socket is not writable, there is no reason to try to send data.

      at manageErr (../../../VariantsDeps/fastify/variant9/fastify/fastify.js:620:87)
      at ../../../VariantsDeps/fastify/variant9/fastify/fastify.js:607:11
      at Object._encapsulateThreeParam (../../../VariantsDeps/fastify/variant9/fastify/node_modules/avvio/boot.js:557:7)
      at Boot.timeoutCall (../../../VariantsDeps/fastify/variant9/fastify/node_modules/avvio/boot.js:453:5)
      at Boot.callWithCbOrNextTick (../../../VariantsDeps/fastify/variant9/fastify/node_modules/avvio/boot.js:435:19)
      at release (../../../VariantsDeps/fastify/variant9/fastify/node_modules/fastq/queue.js:149:16)
      at Object.resume (../../../VariantsDeps/fastify/variant9/fastify/node_modules/fastq/queue.js:82:7)
      at ../../../VariantsDeps/fastify/variant9/fastify/node_modules/avvio/boot.js:174:18
      at ../../../VariantsDeps/fastify/variant9/fastify/node_modules/avvio/plugin.js:275:7
      at done (../../../VariantsDeps/fastify/variant9/fastify/node_modules/avvio/plugin.js:200:5)

  ● Basics › Port can be passed as a second argument to `startServer`

    thrown: "Exceeded timeout of 5000 ms for a test.
    Use jest.setTimeout(newTimeout) to increase the timeout value, if this is a long-running test."

      41 |   })
      42 |
    > 43 |   test('Port can be passed as a second argument to `startServer`', async () => {
         |   ^
      44 |     const server = createServer()
      45 |     const key = nanoid()
      46 |     server.get('/', (_, res) => {

      at tests/basics.test.ts:43:3
      at Object.<anonymous> (tests/basics.test.ts:5:1)

FAIL tests/plugins.test.ts (15.374 s)
  Plugins
    ✕ Loading plugins & routes from filesystem (5002 ms)
    ✕ Graceful exit (5001 ms)
    ✕ Graceful exit with a slow onClose hook (5002 ms)

  ● Plugins › Loading plugins & routes from filesystem

    FastifyError: fastify-plugin: fastify-micro:sentry - expected '3.x' fastify version, '4.3.0' is installed

      127 |   if (!name) return
      128 |   this[registeredPlugins].push(name)
    > 129 | }
          |  ^
      130 |
      131 | function registerPlugin (fn) {
      132 |   registerPluginName.call(this, fn)

      at Object.checkVersion (../../../VariantsDeps/fastify/variant9/fastify/lib/pluginUtils.js:129:11)
      at Object.registerPlugin (../../../VariantsDeps/fastify/variant9/fastify/lib/pluginUtils.js:143:16)
      at Boot.override (../../../VariantsDeps/fastify/variant9/fastify/lib/pluginOverride.js:35:57)
      at Plugin.Object.<anonymous>.Plugin.exec (../../../VariantsDeps/fastify/variant9/fastify/node_modules/avvio/plugin.js:79:33)
      at Boot.loadPlugin (../../../VariantsDeps/fastify/variant9/fastify/node_modules/avvio/plugin.js:272:10)

  ● Plugins › Loading plugins & routes from filesystem

    FastifyError: fastify-plugin: Plugin did not start in time: 'bound _after'. You may have forgotten to call 'done' function or to resolve a Promise

      618 |     // config issue on the load balancer side.
      619 |     this.log.trace({ err }, 'client error')
    > 620 |     // Copying standard node behaviour
          |                                       ^
      621 |     // https://github.com/nodejs/node/blob/6ca23d7846cb47e84fd344543e394e50938540be/lib/_http_server.js#L666
      622 |
      623 |     // If the socket is not writable, there is no reason to try to send data.

      at manageErr (../../../VariantsDeps/fastify/variant9/fastify/fastify.js:620:87)
      at ../../../VariantsDeps/fastify/variant9/fastify/fastify.js:607:11
      at Object._encapsulateThreeParam (../../../VariantsDeps/fastify/variant9/fastify/node_modules/avvio/boot.js:557:7)
      at Boot.timeoutCall (../../../VariantsDeps/fastify/variant9/fastify/node_modules/avvio/boot.js:453:5)
      at Boot.callWithCbOrNextTick (../../../VariantsDeps/fastify/variant9/fastify/node_modules/avvio/boot.js:435:19)
      at release (../../../VariantsDeps/fastify/variant9/fastify/node_modules/fastq/queue.js:149:16)
      at Object.resume (../../../VariantsDeps/fastify/variant9/fastify/node_modules/fastq/queue.js:82:7)
      at ../../../VariantsDeps/fastify/variant9/fastify/node_modules/avvio/boot.js:174:18
      at ../../../VariantsDeps/fastify/variant9/fastify/node_modules/avvio/plugin.js:275:7
      at done (../../../VariantsDeps/fastify/variant9/fastify/node_modules/avvio/plugin.js:200:5)

  ● Plugins › Loading plugins & routes from filesystem

    FastifyError: fastify-plugin: Plugin did not start in time: 'bound _after'. You may have forgotten to call 'done' function or to resolve a Promise

      618 |     // config issue on the load balancer side.
      619 |     this.log.trace({ err }, 'client error')
    > 620 |     // Copying standard node behaviour
          |                                       ^
      621 |     // https://github.com/nodejs/node/blob/6ca23d7846cb47e84fd344543e394e50938540be/lib/_http_server.js#L666
      622 |
      623 |     // If the socket is not writable, there is no reason to try to send data.

      at manageErr (../../../VariantsDeps/fastify/variant9/fastify/fastify.js:620:87)
      at ../../../VariantsDeps/fastify/variant9/fastify/fastify.js:607:11
      at Object._encapsulateThreeParam (../../../VariantsDeps/fastify/variant9/fastify/node_modules/avvio/boot.js:557:7)
      at Boot.timeoutCall (../../../VariantsDeps/fastify/variant9/fastify/node_modules/avvio/boot.js:453:5)
      at Boot.callWithCbOrNextTick (../../../VariantsDeps/fastify/variant9/fastify/node_modules/avvio/boot.js:435:19)
      at release (../../../VariantsDeps/fastify/variant9/fastify/node_modules/fastq/queue.js:149:16)
      at Object.resume (../../../VariantsDeps/fastify/variant9/fastify/node_modules/fastq/queue.js:82:7)
      at ../../../VariantsDeps/fastify/variant9/fastify/node_modules/avvio/boot.js:174:18
      at ../../../VariantsDeps/fastify/variant9/fastify/node_modules/avvio/plugin.js:275:7
      at done (../../../VariantsDeps/fastify/variant9/fastify/node_modules/avvio/plugin.js:200:5)

  ● Plugins › Loading plugins & routes from filesystem

    thrown: "Exceeded timeout of 5000 ms for a test.
    Use jest.setTimeout(newTimeout) to increase the timeout value, if this is a long-running test."

      11 |   })
      12 |
    > 13 |   test('Loading plugins & routes from filesystem', async () => {
         |   ^
      14 |     const server = createServer({
      15 |       plugins: {
      16 |         dir: path.resolve(__dirname, './jigs/plugins')

      at tests/plugins.test.ts:13:3
      at Object.<anonymous> (tests/plugins.test.ts:8:1)

  ● Plugins › Graceful exit

    FastifyError: fastify-plugin: fastify-micro:sentry - expected '3.x' fastify version, '4.3.0' is installed

      127 |   if (!name) return
      128 |   this[registeredPlugins].push(name)
    > 129 | }
          |  ^
      130 |
      131 | function registerPlugin (fn) {
      132 |   registerPluginName.call(this, fn)

      at Object.checkVersion (../../../VariantsDeps/fastify/variant9/fastify/lib/pluginUtils.js:129:11)
      at Object.registerPlugin (../../../VariantsDeps/fastify/variant9/fastify/lib/pluginUtils.js:143:16)
      at Boot.override (../../../VariantsDeps/fastify/variant9/fastify/lib/pluginOverride.js:35:57)
      at Plugin.Object.<anonymous>.Plugin.exec (../../../VariantsDeps/fastify/variant9/fastify/node_modules/avvio/plugin.js:79:33)
      at Boot.loadPlugin (../../../VariantsDeps/fastify/variant9/fastify/node_modules/avvio/plugin.js:272:10)

  ● Plugins › Graceful exit

    thrown: "Exceeded timeout of 5000 ms for a test.
    Use jest.setTimeout(newTimeout) to increase the timeout value, if this is a long-running test."

      27 |   })
      28 |
    > 29 |   test('Graceful exit', async () => {
         |   ^
      30 |     //jest.setTimeout(10000)
      31 |     const key = nanoid()
      32 |     const server = createServer()

      at tests/plugins.test.ts:29:3
      at Object.<anonymous> (tests/plugins.test.ts:8:1)

  ● Plugins › Graceful exit with a slow onClose hook

    FastifyError: fastify-plugin: fastify-micro:sentry - expected '3.x' fastify version, '4.3.0' is installed

      127 |   if (!name) return
      128 |   this[registeredPlugins].push(name)
    > 129 | }
          |  ^
      130 |
      131 | function registerPlugin (fn) {
      132 |   registerPluginName.call(this, fn)

      at Object.checkVersion (../../../VariantsDeps/fastify/variant9/fastify/lib/pluginUtils.js:129:11)
      at Object.registerPlugin (../../../VariantsDeps/fastify/variant9/fastify/lib/pluginUtils.js:143:16)
      at Boot.override (../../../VariantsDeps/fastify/variant9/fastify/lib/pluginOverride.js:35:57)
      at Plugin.Object.<anonymous>.Plugin.exec (../../../VariantsDeps/fastify/variant9/fastify/node_modules/avvio/plugin.js:79:33)
      at Boot.loadPlugin (../../../VariantsDeps/fastify/variant9/fastify/node_modules/avvio/plugin.js:272:10)

  ● Plugins › Graceful exit with a slow onClose hook

    FastifyError: fastify-plugin: Plugin did not start in time: 'bound _after'. You may have forgotten to call 'done' function or to resolve a Promise

      618 |     // config issue on the load balancer side.
      619 |     this.log.trace({ err }, 'client error')
    > 620 |     // Copying standard node behaviour
          |                                       ^
      621 |     // https://github.com/nodejs/node/blob/6ca23d7846cb47e84fd344543e394e50938540be/lib/_http_server.js#L666
      622 |
      623 |     // If the socket is not writable, there is no reason to try to send data.

      at manageErr (../../../VariantsDeps/fastify/variant9/fastify/fastify.js:620:87)
      at ../../../VariantsDeps/fastify/variant9/fastify/fastify.js:607:11
      at Object._encapsulateThreeParam (../../../VariantsDeps/fastify/variant9/fastify/node_modules/avvio/boot.js:557:7)
      at Boot.timeoutCall (../../../VariantsDeps/fastify/variant9/fastify/node_modules/avvio/boot.js:453:5)
      at Boot.callWithCbOrNextTick (../../../VariantsDeps/fastify/variant9/fastify/node_modules/avvio/boot.js:435:19)
      at release (../../../VariantsDeps/fastify/variant9/fastify/node_modules/fastq/queue.js:149:16)
      at Object.resume (../../../VariantsDeps/fastify/variant9/fastify/node_modules/fastq/queue.js:82:7)
      at ../../../VariantsDeps/fastify/variant9/fastify/node_modules/avvio/boot.js:174:18
      at ../../../VariantsDeps/fastify/variant9/fastify/node_modules/avvio/plugin.js:275:7
      at done (../../../VariantsDeps/fastify/variant9/fastify/node_modules/avvio/plugin.js:200:5)

  ● Plugins › Graceful exit with a slow onClose hook

    thrown: "Exceeded timeout of 5000 ms for a test.
    Use jest.setTimeout(newTimeout) to increase the timeout value, if this is a long-running test."

      43 |   })
      44 |
    > 45 |   test('Graceful exit with a slow onClose hook', async () => {
         |   ^
      46 |     const key = nanoid()
      47 |     const server = createServer()
      48 |     server.get('/', async (_, res) => {

      at tests/plugins.test.ts:45:3
      at Object.<anonymous> (tests/plugins.test.ts:8:1)

FAIL tests/graceful.test.ts (10.338 s)
  Graceful shutdown
    ✕ with custom handler (5002 ms)
    ✕ with custom async handler (5001 ms)

  ● Graceful shutdown › with custom handler

    FastifyError: fastify-plugin: fastify-micro:sentry - expected '3.x' fastify version, '4.3.0' is installed

      127 |   if (!name) return
      128 |   this[registeredPlugins].push(name)
    > 129 | }
          |  ^
      130 |
      131 | function registerPlugin (fn) {
      132 |   registerPluginName.call(this, fn)

      at Object.checkVersion (../../../VariantsDeps/fastify/variant9/fastify/lib/pluginUtils.js:129:11)
      at Object.registerPlugin (../../../VariantsDeps/fastify/variant9/fastify/lib/pluginUtils.js:143:16)
      at Boot.override (../../../VariantsDeps/fastify/variant9/fastify/lib/pluginOverride.js:35:57)
      at Plugin.Object.<anonymous>.Plugin.exec (../../../VariantsDeps/fastify/variant9/fastify/node_modules/avvio/plugin.js:79:33)
      at Boot.loadPlugin (../../../VariantsDeps/fastify/variant9/fastify/node_modules/avvio/plugin.js:272:10)

  ● Graceful shutdown › with custom handler

    FastifyError: fastify-plugin: Plugin did not start in time: 'bound _after'. You may have forgotten to call 'done' function or to resolve a Promise

      618 |     // config issue on the load balancer side.
      619 |     this.log.trace({ err }, 'client error')
    > 620 |     // Copying standard node behaviour
          |                                       ^
      621 |     // https://github.com/nodejs/node/blob/6ca23d7846cb47e84fd344543e394e50938540be/lib/_http_server.js#L666
      622 |
      623 |     // If the socket is not writable, there is no reason to try to send data.

      at manageErr (../../../VariantsDeps/fastify/variant9/fastify/fastify.js:620:87)
      at ../../../VariantsDeps/fastify/variant9/fastify/fastify.js:607:11
      at Object._encapsulateThreeParam (../../../VariantsDeps/fastify/variant9/fastify/node_modules/avvio/boot.js:557:7)
      at Boot.timeoutCall (../../../VariantsDeps/fastify/variant9/fastify/node_modules/avvio/boot.js:453:5)
      at Boot.callWithCbOrNextTick (../../../VariantsDeps/fastify/variant9/fastify/node_modules/avvio/boot.js:435:19)
      at release (../../../VariantsDeps/fastify/variant9/fastify/node_modules/fastq/queue.js:149:16)
      at Object.resume (../../../VariantsDeps/fastify/variant9/fastify/node_modules/fastq/queue.js:82:7)
      at ../../../VariantsDeps/fastify/variant9/fastify/node_modules/avvio/boot.js:174:18
      at ../../../VariantsDeps/fastify/variant9/fastify/node_modules/avvio/plugin.js:275:7
      at done (../../../VariantsDeps/fastify/variant9/fastify/node_modules/avvio/plugin.js:200:5)

  ● Graceful shutdown › with custom handler

    FastifyError: fastify-plugin: Plugin did not start in time: 'bound _after'. You may have forgotten to call 'done' function or to resolve a Promise

      618 |     // config issue on the load balancer side.
      619 |     this.log.trace({ err }, 'client error')
    > 620 |     // Copying standard node behaviour
          |                                       ^
      621 |     // https://github.com/nodejs/node/blob/6ca23d7846cb47e84fd344543e394e50938540be/lib/_http_server.js#L666
      622 |
      623 |     // If the socket is not writable, there is no reason to try to send data.

      at manageErr (../../../VariantsDeps/fastify/variant9/fastify/fastify.js:620:87)
      at ../../../VariantsDeps/fastify/variant9/fastify/fastify.js:607:11
      at Object._encapsulateThreeParam (../../../VariantsDeps/fastify/variant9/fastify/node_modules/avvio/boot.js:557:7)
      at Boot.timeoutCall (../../../VariantsDeps/fastify/variant9/fastify/node_modules/avvio/boot.js:453:5)
      at Boot.callWithCbOrNextTick (../../../VariantsDeps/fastify/variant9/fastify/node_modules/avvio/boot.js:435:19)
      at release (../../../VariantsDeps/fastify/variant9/fastify/node_modules/fastq/queue.js:149:16)
      at Object.resume (../../../VariantsDeps/fastify/variant9/fastify/node_modules/fastq/queue.js:82:7)
      at ../../../VariantsDeps/fastify/variant9/fastify/node_modules/avvio/boot.js:174:18
      at ../../../VariantsDeps/fastify/variant9/fastify/node_modules/avvio/plugin.js:275:7
      at done (../../../VariantsDeps/fastify/variant9/fastify/node_modules/avvio/plugin.js:200:5)

  ● Graceful shutdown › with custom handler

    thrown: "Exceeded timeout of 5000 ms for a test.
    Use jest.setTimeout(newTimeout) to increase the timeout value, if this is a long-running test."

      3 |
      4 | describe('Graceful shutdown', () => {
    > 5 |   test('with custom handler', async () => {
        |   ^
      6 |     const server = createServer({ name: 'foo' })
      7 |     server.addHook('onClose', (fastify, done) => {
      8 |       expect(fastify.name).toEqual('foo')

      at tests/graceful.test.ts:5:3
      at Object.<anonymous> (tests/graceful.test.ts:4:1)

  ● Graceful shutdown › with custom async handler

    FastifyError: fastify-plugin: fastify-micro:sentry - expected '3.x' fastify version, '4.3.0' is installed

      127 |   if (!name) return
      128 |   this[registeredPlugins].push(name)
    > 129 | }
          |  ^
      130 |
      131 | function registerPlugin (fn) {
      132 |   registerPluginName.call(this, fn)

      at Object.checkVersion (../../../VariantsDeps/fastify/variant9/fastify/lib/pluginUtils.js:129:11)
      at Object.registerPlugin (../../../VariantsDeps/fastify/variant9/fastify/lib/pluginUtils.js:143:16)
      at Boot.override (../../../VariantsDeps/fastify/variant9/fastify/lib/pluginOverride.js:35:57)
      at Plugin.Object.<anonymous>.Plugin.exec (../../../VariantsDeps/fastify/variant9/fastify/node_modules/avvio/plugin.js:79:33)
      at Boot.loadPlugin (../../../VariantsDeps/fastify/variant9/fastify/node_modules/avvio/plugin.js:272:10)

  ● Graceful shutdown › with custom async handler

    thrown: "Exceeded timeout of 5000 ms for a test.
    Use jest.setTimeout(newTimeout) to increase the timeout value, if this is a long-running test."

      13 |   })
      14 |
    > 15 |   test('with custom async handler', async () => {
         |   ^
      16 |     const server = createServer({ name: 'foo' })
      17 |     server.addHook('onClose', async fastify => {
      18 |       await delay(100)

      at tests/graceful.test.ts:15:3
      at Object.<anonymous> (tests/graceful.test.ts:4:1)

FAIL tests/logger.test.ts (23.089 s)
  Logger
    ✕ name property (5001 ms)
    ✕ redact environment variables (5001 ms)
    ✕ redact log paths (5002 ms)
    ✕ request ID generator (5002 ms)

  ● Logger › name property

    thrown: "Exceeded timeout of 5000 ms for a test.
    Use jest.setTimeout(newTimeout) to increase the timeout value, if this is a long-running test."

      2 |
      3 | describe('Logger', () => {
    > 4 |   test('name property', async () => {
        |   ^
      5 |     const [logLine] = await testLogs(logLine => logLine.dataTestID === 'name')
      6 |     expect(logLine.from).toEqual('foo')
      7 |   })

      at tests/logger.test.ts:4:3
      at Object.<anonymous> (tests/logger.test.ts:3:1)

  ● Logger › redact environment variables

    thrown: "Exceeded timeout of 5000 ms for a test.
    Use jest.setTimeout(newTimeout) to increase the timeout value, if this is a long-running test."

       7 |   })
       8 |
    >  9 |   test('redact environment variables', async () => {
         |   ^
      10 |     const [logLine] = await testLogs(
      11 |       logLine => logLine.dataTestID === 'redact-env'
      12 |     )

      at tests/logger.test.ts:9:3
      at Object.<anonymous> (tests/logger.test.ts:3:1)

  ● Logger › redact log paths

    thrown: "Exceeded timeout of 5000 ms for a test.
    Use jest.setTimeout(newTimeout) to increase the timeout value, if this is a long-running test."

      14 |   })
      15 |
    > 16 |   test('redact log paths', async () => {
         |   ^
      17 |     const [logLine] = await testLogs(
      18 |       logLine => logLine.dataTestID === 'redact-path'
      19 |     )

      at tests/logger.test.ts:16:3
      at Object.<anonymous> (tests/logger.test.ts:3:1)

  ● Logger › request ID generator

    thrown: "Exceeded timeout of 5000 ms for a test.
    Use jest.setTimeout(newTimeout) to increase the timeout value, if this is a long-running test."

      21 |   })
      22 |
    > 23 |   test('request ID generator', async () => {
         |   ^
      24 |     type ReqResLog = { reqId: string }
      25 |
      26 |     const [req1, res1, req2, res2, req3, res3, req4, res4] =

      at tests/logger.test.ts:23:3
      at Object.<anonymous> (tests/logger.test.ts:3:1)

ts-jest[ts-jest-transformer] (WARN) Got a `.js` file to compile while `allowJs` option is not set to `true` (file: /data/js-variants/multee/VariantsDeps/fastify/variant8/fastify/fastify.js). To fix this:
  - if you want TypeScript to process JS files, set `allowJs` to `true` in your TypeScript config (usually tsconfig.json)
  - if you do not want TypeScript to process your `.js` files, in your Jest config change the `transform` key which value is `ts-jest` so that it does not match `.js` files anymore
Browserslist: caniuse-lite is outdated. Please run:
  npx browserslist@latest --update-db
  Why you should do it regularly: https://github.com/browserslist/browserslist#browsers-data-updating
ts-jest[ts-jest-transformer] (WARN) Got a `.js` file to compile while `allowJs` option is not set to `true` (file: /data/js-variants/multee/VariantsDeps/fastify/variant8/fastify/lib/symbols.js). To fix this:
  - if you want TypeScript to process JS files, set `allowJs` to `true` in your TypeScript config (usually tsconfig.json)
  - if you do not want TypeScript to process your `.js` files, in your Jest config change the `transform` key which value is `ts-jest` so that it does not match `.js` files anymore
ts-jest[ts-jest-transformer] (WARN) Got a `.js` file to compile while `allowJs` option is not set to `true` (file: /data/js-variants/multee/VariantsDeps/fastify/variant8/fastify/lib/server.js). To fix this:
  - if you want TypeScript to process JS files, set `allowJs` to `true` in your TypeScript config (usually tsconfig.json)
  - if you do not want TypeScript to process your `.js` files, in your Jest config change the `transform` key which value is `ts-jest` so that it does not match `.js` files anymore
ts-jest[ts-jest-transformer] (WARN) Got a `.js` file to compile while `allowJs` option is not set to `true` (file: /data/js-variants/multee/VariantsDeps/fastify/variant8/fastify/lib/warnings.js). To fix this:
  - if you want TypeScript to process JS files, set `allowJs` to `true` in your TypeScript config (usually tsconfig.json)
  - if you do not want TypeScript to process your `.js` files, in your Jest config change the `transform` key which value is `ts-jest` so that it does not match `.js` files anymore
ts-jest[ts-jest-transformer] (WARN) Got a `.js` file to compile while `allowJs` option is not set to `true` (file: /data/js-variants/multee/VariantsDeps/fastify/variant8/fastify/lib/errors.js). To fix this:
  - if you want TypeScript to process JS files, set `allowJs` to `true` in your TypeScript config (usually tsconfig.json)
  - if you do not want TypeScript to process your `.js` files, in your Jest config change the `transform` key which value is `ts-jest` so that it does not match `.js` files anymore
ts-jest[ts-jest-transformer] (WARN) Got a `.js` file to compile while `allowJs` option is not set to `true` (file: /data/js-variants/multee/VariantsDeps/fastify/variant8/fastify/lib/reply.js). To fix this:
  - if you want TypeScript to process JS files, set `allowJs` to `true` in your TypeScript config (usually tsconfig.json)
  - if you do not want TypeScript to process your `.js` files, in your Jest config change the `transform` key which value is `ts-jest` so that it does not match `.js` files anymore
ts-jest[ts-jest-transformer] (WARN) Got a `.js` file to compile while `allowJs` option is not set to `true` (file: /data/js-variants/multee/VariantsDeps/fastify/variant8/fastify/lib/hooks.js). To fix this:
  - if you want TypeScript to process JS files, set `allowJs` to `true` in your TypeScript config (usually tsconfig.json)
  - if you do not want TypeScript to process your `.js` files, in your Jest config change the `transform` key which value is `ts-jest` so that it does not match `.js` files anymore
ts-jest[ts-jest-transformer] (WARN) Got a `.js` file to compile while `allowJs` option is not set to `true` (file: /data/js-variants/multee/VariantsDeps/fastify/variant8/fastify/lib/handleRequest.js). To fix this:
  - if you want TypeScript to process JS files, set `allowJs` to `true` in your TypeScript config (usually tsconfig.json)
  - if you do not want TypeScript to process your `.js` files, in your Jest config change the `transform` key which value is `ts-jest` so that it does not match `.js` files anymore
ts-jest[ts-jest-transformer] (WARN) Got a `.js` file to compile while `allowJs` option is not set to `true` (file: /data/js-variants/multee/VariantsDeps/fastify/variant8/fastify/lib/validation.js). To fix this:
  - if you want TypeScript to process JS files, set `allowJs` to `true` in your TypeScript config (usually tsconfig.json)
  - if you do not want TypeScript to process your `.js` files, in your Jest config change the `transform` key which value is `ts-jest` so that it does not match `.js` files anymore
ts-jest[ts-jest-transformer] (WARN) Got a `.js` file to compile while `allowJs` option is not set to `true` (file: /data/js-variants/multee/VariantsDeps/fastify/variant8/fastify/lib/wrapThenable.js). To fix this:
  - if you want TypeScript to process JS files, set `allowJs` to `true` in your TypeScript config (usually tsconfig.json)
  - if you do not want TypeScript to process your `.js` files, in your Jest config change the `transform` key which value is `ts-jest` so that it does not match `.js` files anymore
ts-jest[ts-jest-transformer] (WARN) Got a `.js` file to compile while `allowJs` option is not set to `true` (file: /data/js-variants/multee/VariantsDeps/fastify/variant8/fastify/lib/logger.js). To fix this:
  - if you want TypeScript to process JS files, set `allowJs` to `true` in your TypeScript config (usually tsconfig.json)
  - if you do not want TypeScript to process your `.js` files, in your Jest config change the `transform` key which value is `ts-jest` so that it does not match `.js` files anymore
ts-jest[ts-jest-transformer] (WARN) Got a `.js` file to compile while `allowJs` option is not set to `true` (file: /data/js-variants/multee/VariantsDeps/fastify/variant8/fastify/lib/error-handler.js). To fix this:
  - if you want TypeScript to process JS files, set `allowJs` to `true` in your TypeScript config (usually tsconfig.json)
  - if you do not want TypeScript to process your `.js` files, in your Jest config change the `transform` key which value is `ts-jest` so that it does not match `.js` files anymore
ts-jest[ts-jest-transformer] (WARN) Got a `.js` file to compile while `allowJs` option is not set to `true` (file: /data/js-variants/multee/VariantsDeps/fastify/variant8/fastify/lib/schemas.js). To fix this:
  - if you want TypeScript to process JS files, set `allowJs` to `true` in your TypeScript config (usually tsconfig.json)
  - if you do not want TypeScript to process your `.js` files, in your Jest config change the `transform` key which value is `ts-jest` so that it does not match `.js` files anymore
ts-jest[ts-jest-transformer] (WARN) Got a `.js` file to compile while `allowJs` option is not set to `true` (file: /data/js-variants/multee/VariantsDeps/fastify/variant8/fastify/lib/error-serializer.js). To fix this:
  - if you want TypeScript to process JS files, set `allowJs` to `true` in your TypeScript config (usually tsconfig.json)
  - if you do not want TypeScript to process your `.js` files, in your Jest config change the `transform` key which value is `ts-jest` so that it does not match `.js` files anymore
ts-jest[ts-jest-transformer] (WARN) Got a `.js` file to compile while `allowJs` option is not set to `true` (file: /data/js-variants/multee/VariantsDeps/fastify/variant8/fastify/lib/request.js). To fix this:
  - if you want TypeScript to process JS files, set `allowJs` to `true` in your TypeScript config (usually tsconfig.json)
  - if you do not want TypeScript to process your `.js` files, in your Jest config change the `transform` key which value is `ts-jest` so that it does not match `.js` files anymore
ts-jest[ts-jest-transformer] (WARN) Got a `.js` file to compile while `allowJs` option is not set to `true` (file: /data/js-variants/multee/VariantsDeps/fastify/variant8/fastify/lib/decorate.js). To fix this:
  - if you want TypeScript to process JS files, set `allowJs` to `true` in your TypeScript config (usually tsconfig.json)
  - if you do not want TypeScript to process your `.js` files, in your Jest config change the `transform` key which value is `ts-jest` so that it does not match `.js` files anymore
ts-jest[ts-jest-transformer] (WARN) Got a `.js` file to compile while `allowJs` option is not set to `true` (file: /data/js-variants/multee/VariantsDeps/fastify/variant8/fastify/lib/contentTypeParser.js). To fix this:
  - if you want TypeScript to process JS files, set `allowJs` to `true` in your TypeScript config (usually tsconfig.json)
  - if you do not want TypeScript to process your `.js` files, in your Jest config change the `transform` key which value is `ts-jest` so that it does not match `.js` files anymore
ts-jest[ts-jest-transformer] (WARN) Got a `.js` file to compile while `allowJs` option is not set to `true` (file: /data/js-variants/multee/VariantsDeps/fastify/variant8/fastify/lib/schema-controller.js). To fix this:
  - if you want TypeScript to process JS files, set `allowJs` to `true` in your TypeScript config (usually tsconfig.json)
  - if you do not want TypeScript to process your `.js` files, in your Jest config change the `transform` key which value is `ts-jest` so that it does not match `.js` files anymore
ts-jest[ts-jest-transformer] (WARN) Got a `.js` file to compile while `allowJs` option is not set to `true` (file: /data/js-variants/multee/VariantsDeps/fastify/variant8/fastify/lib/pluginUtils.js). To fix this:
  - if you want TypeScript to process JS files, set `allowJs` to `true` in your TypeScript config (usually tsconfig.json)
  - if you do not want TypeScript to process your `.js` files, in your Jest config change the `transform` key which value is `ts-jest` so that it does not match `.js` files anymore
ts-jest[ts-jest-transformer] (WARN) Got a `.js` file to compile while `allowJs` option is not set to `true` (file: /data/js-variants/multee/VariantsDeps/fastify/variant8/fastify/lib/reqIdGenFactory.js). To fix this:
  - if you want TypeScript to process JS files, set `allowJs` to `true` in your TypeScript config (usually tsconfig.json)
  - if you do not want TypeScript to process your `.js` files, in your Jest config change the `transform` key which value is `ts-jest` so that it does not match `.js` files anymore
ts-jest[ts-jest-transformer] (WARN) Got a `.js` file to compile while `allowJs` option is not set to `true` (file: /data/js-variants/multee/VariantsDeps/fastify/variant8/fastify/lib/route.js). To fix this:
  - if you want TypeScript to process JS files, set `allowJs` to `true` in your TypeScript config (usually tsconfig.json)
  - if you do not want TypeScript to process your `.js` files, in your Jest config change the `transform` key which value is `ts-jest` so that it does not match `.js` files anymore
ts-jest[ts-jest-transformer] (WARN) Got a `.js` file to compile while `allowJs` option is not set to `true` (file: /data/js-variants/multee/VariantsDeps/fastify/variant8/fastify/lib/context.js). To fix this:
  - if you want TypeScript to process JS files, set `allowJs` to `true` in your TypeScript config (usually tsconfig.json)
  - if you do not want TypeScript to process your `.js` files, in your Jest config change the `transform` key which value is `ts-jest` so that it does not match `.js` files anymore
ts-jest[ts-jest-transformer] (WARN) Got a `.js` file to compile while `allowJs` option is not set to `true` (file: /data/js-variants/multee/VariantsDeps/fastify/variant8/fastify/lib/headRoute.js). To fix this:
  - if you want TypeScript to process JS files, set `allowJs` to `true` in your TypeScript config (usually tsconfig.json)
  - if you do not want TypeScript to process your `.js` files, in your Jest config change the `transform` key which value is `ts-jest` so that it does not match `.js` files anymore
ts-jest[ts-jest-transformer] (WARN) Got a `.js` file to compile while `allowJs` option is not set to `true` (file: /data/js-variants/multee/VariantsDeps/fastify/variant8/fastify/lib/fourOhFour.js). To fix this:
  - if you want TypeScript to process JS files, set `allowJs` to `true` in your TypeScript config (usually tsconfig.json)
  - if you do not want TypeScript to process your `.js` files, in your Jest config change the `transform` key which value is `ts-jest` so that it does not match `.js` files anymore
ts-jest[ts-jest-transformer] (WARN) Got a `.js` file to compile while `allowJs` option is not set to `true` (file: /data/js-variants/multee/VariantsDeps/fastify/variant8/fastify/lib/initialConfigValidation.js). To fix this:
  - if you want TypeScript to process JS files, set `allowJs` to `true` in your TypeScript config (usually tsconfig.json)
  - if you do not want TypeScript to process your `.js` files, in your Jest config change the `transform` key which value is `ts-jest` so that it does not match `.js` files anymore
ts-jest[ts-jest-transformer] (WARN) Got a `.js` file to compile while `allowJs` option is not set to `true` (file: /data/js-variants/multee/VariantsDeps/fastify/variant8/fastify/lib/configValidator.js). To fix this:
  - if you want TypeScript to process JS files, set `allowJs` to `true` in your TypeScript config (usually tsconfig.json)
  - if you do not want TypeScript to process your `.js` files, in your Jest config change the `transform` key which value is `ts-jest` so that it does not match `.js` files anymore
ts-jest[ts-jest-transformer] (WARN) Got a `.js` file to compile while `allowJs` option is not set to `true` (file: /data/js-variants/multee/VariantsDeps/fastify/variant8/fastify/lib/pluginOverride.js). To fix this:
  - if you want TypeScript to process JS files, set `allowJs` to `true` in your TypeScript config (usually tsconfig.json)
  - if you do not want TypeScript to process your `.js` files, in your Jest config change the `transform` key which value is `ts-jest` so that it does not match `.js` files anymore
ts-jest[ts-jest-transformer] (WARN) Got a `.js` file to compile while `allowJs` option is not set to `true` (file: /data/js-variants/multee/VariantsDeps/fastify/variant8/fastify/lib/noop-set.js). To fix this:
  - if you want TypeScript to process JS files, set `allowJs` to `true` in your TypeScript config (usually tsconfig.json)
  - if you do not want TypeScript to process your `.js` files, in your Jest config change the `transform` key which value is `ts-jest` so that it does not match `.js` files anymore
FAIL tests/basics.test.ts (22.757 s)
  Basics
    ✓ The specified `name` property is injected (38 ms)
    ✕ Default port should be 3000 (5000 ms)
    ✕ Port should be configurable via the environment (5002 ms)
    ✕ Port can be passed as a second argument to `startServer` (5001 ms)

  ● Basics › Default port should be 3000

    TypeError: semver.satisfies is not a function

      120 | }
      121 |
    > 122 | function registerPluginName (fn) {
          |                                 ^
      123 |   const meta = getMeta(fn)
      124 |   if (!meta) return
      125 |

      at Object.checkVersion (../../../VariantsDeps/fastify/variant8/fastify/lib/pluginUtils.js:122:33)
      at Object.registerPlugin (../../../VariantsDeps/fastify/variant8/fastify/lib/pluginUtils.js:143:16)
      at Boot.override (../../../VariantsDeps/fastify/variant8/fastify/lib/pluginOverride.js:35:57)
      at Plugin.Object.<anonymous>.Plugin.exec (../../../VariantsDeps/fastify/variant8/fastify/node_modules/avvio/plugin.js:79:33)
      at Boot.loadPlugin (../../../VariantsDeps/fastify/variant8/fastify/node_modules/avvio/plugin.js:272:10)

  ● Basics › Default port should be 3000

    TypeError: semver.satisfies is not a function

      120 | }
      121 |
    > 122 | function registerPluginName (fn) {
          |                                 ^
      123 |   const meta = getMeta(fn)
      124 |   if (!meta) return
      125 |

      at Object.checkVersion (../../../VariantsDeps/fastify/variant8/fastify/lib/pluginUtils.js:122:33)
      at Object.registerPlugin (../../../VariantsDeps/fastify/variant8/fastify/lib/pluginUtils.js:143:16)
      at Boot.override (../../../VariantsDeps/fastify/variant8/fastify/lib/pluginOverride.js:35:57)
      at Plugin.Object.<anonymous>.Plugin.exec (../../../VariantsDeps/fastify/variant8/fastify/node_modules/avvio/plugin.js:79:33)
      at Boot.loadPlugin (../../../VariantsDeps/fastify/variant8/fastify/node_modules/avvio/plugin.js:272:10)

  ● Basics › Default port should be 3000

    TypeError: semver.satisfies is not a function

      120 | }
      121 |
    > 122 | function registerPluginName (fn) {
          |                                 ^
      123 |   const meta = getMeta(fn)
      124 |   if (!meta) return
      125 |

      at Object.checkVersion (../../../VariantsDeps/fastify/variant8/fastify/lib/pluginUtils.js:122:33)
      at Object.registerPlugin (../../../VariantsDeps/fastify/variant8/fastify/lib/pluginUtils.js:143:16)
      at Boot.override (../../../VariantsDeps/fastify/variant8/fastify/lib/pluginOverride.js:35:57)
      at Plugin.Object.<anonymous>.Plugin.exec (../../../VariantsDeps/fastify/variant8/fastify/node_modules/avvio/plugin.js:79:33)
      at Boot.loadPlugin (../../../VariantsDeps/fastify/variant8/fastify/node_modules/avvio/plugin.js:272:10)

  ● Basics › Default port should be 3000

    thrown: "Exceeded timeout of 5000 ms for a test.
    Use jest.setTimeout(newTimeout) to increase the timeout value, if this is a long-running test."

      15 |   })
      16 |
    > 17 |   test('Default port should be 3000', async () => {
         |   ^
      18 |     const key = nanoid()
      19 |     const server = createServer()
      20 |     server.get('/', (_, res) => {

      at tests/basics.test.ts:17:3
      at Object.<anonymous> (tests/basics.test.ts:5:1)

  ● Basics › Port should be configurable via the environment

    TypeError: semver.satisfies is not a function

      120 | }
      121 |
    > 122 | function registerPluginName (fn) {
          |                                 ^
      123 |   const meta = getMeta(fn)
      124 |   if (!meta) return
      125 |

      at Object.checkVersion (../../../VariantsDeps/fastify/variant8/fastify/lib/pluginUtils.js:122:33)
      at Object.registerPlugin (../../../VariantsDeps/fastify/variant8/fastify/lib/pluginUtils.js:143:16)
      at Boot.override (../../../VariantsDeps/fastify/variant8/fastify/lib/pluginOverride.js:35:57)
      at Plugin.Object.<anonymous>.Plugin.exec (../../../VariantsDeps/fastify/variant8/fastify/node_modules/avvio/plugin.js:79:33)
      at Boot.loadPlugin (../../../VariantsDeps/fastify/variant8/fastify/node_modules/avvio/plugin.js:272:10)

  ● Basics › Port should be configurable via the environment

    thrown: "Exceeded timeout of 5000 ms for a test.
    Use jest.setTimeout(newTimeout) to increase the timeout value, if this is a long-running test."

      27 |   })
      28 |
    > 29 |   test('Port should be configurable via the environment', async () => {
         |   ^
      30 |     process.env.PORT = '3001'
      31 |     const key = nanoid()
      32 |     const server = createServer()

      at tests/basics.test.ts:29:3
      at Object.<anonymous> (tests/basics.test.ts:5:1)

  ● Basics › Port can be passed as a second argument to `startServer`

    TypeError: semver.satisfies is not a function

      120 | }
      121 |
    > 122 | function registerPluginName (fn) {
          |                                 ^
      123 |   const meta = getMeta(fn)
      124 |   if (!meta) return
      125 |

      at Object.checkVersion (../../../VariantsDeps/fastify/variant8/fastify/lib/pluginUtils.js:122:33)
      at Object.registerPlugin (../../../VariantsDeps/fastify/variant8/fastify/lib/pluginUtils.js:143:16)
      at Boot.override (../../../VariantsDeps/fastify/variant8/fastify/lib/pluginOverride.js:35:57)
      at Plugin.Object.<anonymous>.Plugin.exec (../../../VariantsDeps/fastify/variant8/fastify/node_modules/avvio/plugin.js:79:33)
      at Boot.loadPlugin (../../../VariantsDeps/fastify/variant8/fastify/node_modules/avvio/plugin.js:272:10)

  ● Basics › Port can be passed as a second argument to `startServer`

    FastifyError: fastify-plugin: Plugin did not start in time: 'bound _after'. You may have forgotten to call 'done' function or to resolve a Promise

      618 |     // config issue on the load balancer side.
      619 |     this.log.trace({ err }, 'client error')
    > 620 |     // Copying standard node behaviour
          |                                       ^
      621 |     // https://github.com/nodejs/node/blob/6ca23d7846cb47e84fd344543e394e50938540be/lib/_http_server.js#L666
      622 |
      623 |     // If the socket is not writable, there is no reason to try to send data.

      at manageErr (../../../VariantsDeps/fastify/variant8/fastify/fastify.js:620:87)
      at ../../../VariantsDeps/fastify/variant8/fastify/fastify.js:607:11
      at Object._encapsulateThreeParam (../../../VariantsDeps/fastify/variant8/fastify/node_modules/avvio/boot.js:557:7)
      at Boot.timeoutCall (../../../VariantsDeps/fastify/variant8/fastify/node_modules/avvio/boot.js:453:5)
      at Boot.callWithCbOrNextTick (../../../VariantsDeps/fastify/variant8/fastify/node_modules/avvio/boot.js:435:19)
      at release (../../../VariantsDeps/fastify/variant8/fastify/node_modules/fastq/queue.js:149:16)
      at Object.resume (../../../VariantsDeps/fastify/variant8/fastify/node_modules/fastq/queue.js:82:7)
      at ../../../VariantsDeps/fastify/variant8/fastify/node_modules/avvio/boot.js:174:18
      at ../../../VariantsDeps/fastify/variant8/fastify/node_modules/avvio/plugin.js:275:7
      at done (../../../VariantsDeps/fastify/variant8/fastify/node_modules/avvio/plugin.js:200:5)

  ● Basics › Port can be passed as a second argument to `startServer`

    FastifyError: fastify-plugin: Plugin did not start in time: 'bound _after'. You may have forgotten to call 'done' function or to resolve a Promise

      618 |     // config issue on the load balancer side.
      619 |     this.log.trace({ err }, 'client error')
    > 620 |     // Copying standard node behaviour
          |                                       ^
      621 |     // https://github.com/nodejs/node/blob/6ca23d7846cb47e84fd344543e394e50938540be/lib/_http_server.js#L666
      622 |
      623 |     // If the socket is not writable, there is no reason to try to send data.

      at manageErr (../../../VariantsDeps/fastify/variant8/fastify/fastify.js:620:87)
      at ../../../VariantsDeps/fastify/variant8/fastify/fastify.js:607:11
      at Object._encapsulateThreeParam (../../../VariantsDeps/fastify/variant8/fastify/node_modules/avvio/boot.js:557:7)
      at Boot.timeoutCall (../../../VariantsDeps/fastify/variant8/fastify/node_modules/avvio/boot.js:453:5)
      at Boot.callWithCbOrNextTick (../../../VariantsDeps/fastify/variant8/fastify/node_modules/avvio/boot.js:435:19)
      at release (../../../VariantsDeps/fastify/variant8/fastify/node_modules/fastq/queue.js:149:16)
      at Object.resume (../../../VariantsDeps/fastify/variant8/fastify/node_modules/fastq/queue.js:82:7)
      at ../../../VariantsDeps/fastify/variant8/fastify/node_modules/avvio/boot.js:174:18
      at ../../../VariantsDeps/fastify/variant8/fastify/node_modules/avvio/plugin.js:275:7
      at done (../../../VariantsDeps/fastify/variant8/fastify/node_modules/avvio/plugin.js:200:5)

  ● Basics › Port can be passed as a second argument to `startServer`

    FastifyError: fastify-plugin: Plugin did not start in time: 'bound _after'. You may have forgotten to call 'done' function or to resolve a Promise

      618 |     // config issue on the load balancer side.
      619 |     this.log.trace({ err }, 'client error')
    > 620 |     // Copying standard node behaviour
          |                                       ^
      621 |     // https://github.com/nodejs/node/blob/6ca23d7846cb47e84fd344543e394e50938540be/lib/_http_server.js#L666
      622 |
      623 |     // If the socket is not writable, there is no reason to try to send data.

      at manageErr (../../../VariantsDeps/fastify/variant8/fastify/fastify.js:620:87)
      at ../../../VariantsDeps/fastify/variant8/fastify/fastify.js:607:11
      at Object._encapsulateThreeParam (../../../VariantsDeps/fastify/variant8/fastify/node_modules/avvio/boot.js:557:7)
      at Boot.timeoutCall (../../../VariantsDeps/fastify/variant8/fastify/node_modules/avvio/boot.js:453:5)
      at Boot.callWithCbOrNextTick (../../../VariantsDeps/fastify/variant8/fastify/node_modules/avvio/boot.js:435:19)
      at release (../../../VariantsDeps/fastify/variant8/fastify/node_modules/fastq/queue.js:149:16)
      at Object.resume (../../../VariantsDeps/fastify/variant8/fastify/node_modules/fastq/queue.js:82:7)
      at ../../../VariantsDeps/fastify/variant8/fastify/node_modules/avvio/boot.js:174:18
      at ../../../VariantsDeps/fastify/variant8/fastify/node_modules/avvio/plugin.js:275:7
      at done (../../../VariantsDeps/fastify/variant8/fastify/node_modules/avvio/plugin.js:200:5)

  ● Basics › Port can be passed as a second argument to `startServer`

    thrown: "Exceeded timeout of 5000 ms for a test.
    Use jest.setTimeout(newTimeout) to increase the timeout value, if this is a long-running test."

      41 |   })
      42 |
    > 43 |   test('Port can be passed as a second argument to `startServer`', async () => {
         |   ^
      44 |     const server = createServer()
      45 |     const key = nanoid()
      46 |     server.get('/', (_, res) => {

      at tests/basics.test.ts:43:3
      at Object.<anonymous> (tests/basics.test.ts:5:1)

FAIL tests/plugins.test.ts (15.339 s)
  Plugins
    ✕ Loading plugins & routes from filesystem (5001 ms)
    ✕ Graceful exit (5001 ms)
    ✕ Graceful exit with a slow onClose hook (5001 ms)

  ● Plugins › Loading plugins & routes from filesystem

    TypeError: semver.satisfies is not a function

      120 | }
      121 |
    > 122 | function registerPluginName (fn) {
          |                                 ^
      123 |   const meta = getMeta(fn)
      124 |   if (!meta) return
      125 |

      at Object.checkVersion (../../../VariantsDeps/fastify/variant8/fastify/lib/pluginUtils.js:122:33)
      at Object.registerPlugin (../../../VariantsDeps/fastify/variant8/fastify/lib/pluginUtils.js:143:16)
      at Boot.override (../../../VariantsDeps/fastify/variant8/fastify/lib/pluginOverride.js:35:57)
      at Plugin.Object.<anonymous>.Plugin.exec (../../../VariantsDeps/fastify/variant8/fastify/node_modules/avvio/plugin.js:79:33)
      at Boot.loadPlugin (../../../VariantsDeps/fastify/variant8/fastify/node_modules/avvio/plugin.js:272:10)

  ● Plugins › Loading plugins & routes from filesystem

    FastifyError: fastify-plugin: Plugin did not start in time: 'bound _after'. You may have forgotten to call 'done' function or to resolve a Promise

      618 |     // config issue on the load balancer side.
      619 |     this.log.trace({ err }, 'client error')
    > 620 |     // Copying standard node behaviour
          |                                       ^
      621 |     // https://github.com/nodejs/node/blob/6ca23d7846cb47e84fd344543e394e50938540be/lib/_http_server.js#L666
      622 |
      623 |     // If the socket is not writable, there is no reason to try to send data.

      at manageErr (../../../VariantsDeps/fastify/variant8/fastify/fastify.js:620:87)
      at ../../../VariantsDeps/fastify/variant8/fastify/fastify.js:607:11
      at Object._encapsulateThreeParam (../../../VariantsDeps/fastify/variant8/fastify/node_modules/avvio/boot.js:557:7)
      at Boot.timeoutCall (../../../VariantsDeps/fastify/variant8/fastify/node_modules/avvio/boot.js:453:5)
      at Boot.callWithCbOrNextTick (../../../VariantsDeps/fastify/variant8/fastify/node_modules/avvio/boot.js:435:19)
      at release (../../../VariantsDeps/fastify/variant8/fastify/node_modules/fastq/queue.js:149:16)
      at Object.resume (../../../VariantsDeps/fastify/variant8/fastify/node_modules/fastq/queue.js:82:7)
      at ../../../VariantsDeps/fastify/variant8/fastify/node_modules/avvio/boot.js:174:18
      at ../../../VariantsDeps/fastify/variant8/fastify/node_modules/avvio/plugin.js:275:7
      at done (../../../VariantsDeps/fastify/variant8/fastify/node_modules/avvio/plugin.js:200:5)

  ● Plugins › Loading plugins & routes from filesystem

    FastifyError: fastify-plugin: Plugin did not start in time: 'bound _after'. You may have forgotten to call 'done' function or to resolve a Promise

      618 |     // config issue on the load balancer side.
      619 |     this.log.trace({ err }, 'client error')
    > 620 |     // Copying standard node behaviour
          |                                       ^
      621 |     // https://github.com/nodejs/node/blob/6ca23d7846cb47e84fd344543e394e50938540be/lib/_http_server.js#L666
      622 |
      623 |     // If the socket is not writable, there is no reason to try to send data.

      at manageErr (../../../VariantsDeps/fastify/variant8/fastify/fastify.js:620:87)
      at ../../../VariantsDeps/fastify/variant8/fastify/fastify.js:607:11
      at Object._encapsulateThreeParam (../../../VariantsDeps/fastify/variant8/fastify/node_modules/avvio/boot.js:557:7)
      at Boot.timeoutCall (../../../VariantsDeps/fastify/variant8/fastify/node_modules/avvio/boot.js:453:5)
      at Boot.callWithCbOrNextTick (../../../VariantsDeps/fastify/variant8/fastify/node_modules/avvio/boot.js:435:19)
      at release (../../../VariantsDeps/fastify/variant8/fastify/node_modules/fastq/queue.js:149:16)
      at Object.resume (../../../VariantsDeps/fastify/variant8/fastify/node_modules/fastq/queue.js:82:7)
      at ../../../VariantsDeps/fastify/variant8/fastify/node_modules/avvio/boot.js:174:18
      at ../../../VariantsDeps/fastify/variant8/fastify/node_modules/avvio/plugin.js:275:7
      at done (../../../VariantsDeps/fastify/variant8/fastify/node_modules/avvio/plugin.js:200:5)

  ● Plugins › Loading plugins & routes from filesystem

    thrown: "Exceeded timeout of 5000 ms for a test.
    Use jest.setTimeout(newTimeout) to increase the timeout value, if this is a long-running test."

      11 |   })
      12 |
    > 13 |   test('Loading plugins & routes from filesystem', async () => {
         |   ^
      14 |     const server = createServer({
      15 |       plugins: {
      16 |         dir: path.resolve(__dirname, './jigs/plugins')

      at tests/plugins.test.ts:13:3
      at Object.<anonymous> (tests/plugins.test.ts:8:1)

  ● Plugins › Graceful exit

    TypeError: semver.satisfies is not a function

      120 | }
      121 |
    > 122 | function registerPluginName (fn) {
          |                                 ^
      123 |   const meta = getMeta(fn)
      124 |   if (!meta) return
      125 |

      at Object.checkVersion (../../../VariantsDeps/fastify/variant8/fastify/lib/pluginUtils.js:122:33)
      at Object.registerPlugin (../../../VariantsDeps/fastify/variant8/fastify/lib/pluginUtils.js:143:16)
      at Boot.override (../../../VariantsDeps/fastify/variant8/fastify/lib/pluginOverride.js:35:57)
      at Plugin.Object.<anonymous>.Plugin.exec (../../../VariantsDeps/fastify/variant8/fastify/node_modules/avvio/plugin.js:79:33)
      at Boot.loadPlugin (../../../VariantsDeps/fastify/variant8/fastify/node_modules/avvio/plugin.js:272:10)

  ● Plugins › Graceful exit

    thrown: "Exceeded timeout of 5000 ms for a test.
    Use jest.setTimeout(newTimeout) to increase the timeout value, if this is a long-running test."

      27 |   })
      28 |
    > 29 |   test('Graceful exit', async () => {
         |   ^
      30 |     //jest.setTimeout(10000)
      31 |     const key = nanoid()
      32 |     const server = createServer()

      at tests/plugins.test.ts:29:3
      at Object.<anonymous> (tests/plugins.test.ts:8:1)

  ● Plugins › Graceful exit with a slow onClose hook

    TypeError: semver.satisfies is not a function

      120 | }
      121 |
    > 122 | function registerPluginName (fn) {
          |                                 ^
      123 |   const meta = getMeta(fn)
      124 |   if (!meta) return
      125 |

      at Object.checkVersion (../../../VariantsDeps/fastify/variant8/fastify/lib/pluginUtils.js:122:33)
      at Object.registerPlugin (../../../VariantsDeps/fastify/variant8/fastify/lib/pluginUtils.js:143:16)
      at Boot.override (../../../VariantsDeps/fastify/variant8/fastify/lib/pluginOverride.js:35:57)
      at Plugin.Object.<anonymous>.Plugin.exec (../../../VariantsDeps/fastify/variant8/fastify/node_modules/avvio/plugin.js:79:33)
      at Boot.loadPlugin (../../../VariantsDeps/fastify/variant8/fastify/node_modules/avvio/plugin.js:272:10)

  ● Plugins › Graceful exit with a slow onClose hook

    FastifyError: fastify-plugin: Plugin did not start in time: 'bound _after'. You may have forgotten to call 'done' function or to resolve a Promise

      618 |     // config issue on the load balancer side.
      619 |     this.log.trace({ err }, 'client error')
    > 620 |     // Copying standard node behaviour
          |                                       ^
      621 |     // https://github.com/nodejs/node/blob/6ca23d7846cb47e84fd344543e394e50938540be/lib/_http_server.js#L666
      622 |
      623 |     // If the socket is not writable, there is no reason to try to send data.

      at manageErr (../../../VariantsDeps/fastify/variant8/fastify/fastify.js:620:87)
      at ../../../VariantsDeps/fastify/variant8/fastify/fastify.js:607:11
      at Object._encapsulateThreeParam (../../../VariantsDeps/fastify/variant8/fastify/node_modules/avvio/boot.js:557:7)
      at Boot.timeoutCall (../../../VariantsDeps/fastify/variant8/fastify/node_modules/avvio/boot.js:453:5)
      at Boot.callWithCbOrNextTick (../../../VariantsDeps/fastify/variant8/fastify/node_modules/avvio/boot.js:435:19)
      at release (../../../VariantsDeps/fastify/variant8/fastify/node_modules/fastq/queue.js:149:16)
      at Object.resume (../../../VariantsDeps/fastify/variant8/fastify/node_modules/fastq/queue.js:82:7)
      at ../../../VariantsDeps/fastify/variant8/fastify/node_modules/avvio/boot.js:174:18
      at ../../../VariantsDeps/fastify/variant8/fastify/node_modules/avvio/plugin.js:275:7
      at done (../../../VariantsDeps/fastify/variant8/fastify/node_modules/avvio/plugin.js:200:5)

  ● Plugins › Graceful exit with a slow onClose hook

    thrown: "Exceeded timeout of 5000 ms for a test.
    Use jest.setTimeout(newTimeout) to increase the timeout value, if this is a long-running test."

      43 |   })
      44 |
    > 45 |   test('Graceful exit with a slow onClose hook', async () => {
         |   ^
      46 |     const key = nanoid()
      47 |     const server = createServer()
      48 |     server.get('/', async (_, res) => {

      at tests/plugins.test.ts:45:3
      at Object.<anonymous> (tests/plugins.test.ts:8:1)

FAIL tests/health.test.ts (20.325 s)
  Health checks
    ✕ Default configuration exposes a /_health route (5002 ms)
    ✕ Custom health check handler is called at startup and every 5 seconds (5000 ms)
    ✕ Custom health check throwing results in 503 (5002 ms)
    ✕ Disabled health monitoring (5001 ms)

  ● Health checks › Default configuration exposes a /_health route

    TypeError: semver.satisfies is not a function

      120 | }
      121 |
    > 122 | function registerPluginName (fn) {
          |                                 ^
      123 |   const meta = getMeta(fn)
      124 |   if (!meta) return
      125 |

      at Object.checkVersion (../../../VariantsDeps/fastify/variant8/fastify/lib/pluginUtils.js:122:33)
      at Object.registerPlugin (../../../VariantsDeps/fastify/variant8/fastify/lib/pluginUtils.js:143:16)
      at Boot.override (../../../VariantsDeps/fastify/variant8/fastify/lib/pluginOverride.js:35:57)
      at Plugin.Object.<anonymous>.Plugin.exec (../../../VariantsDeps/fastify/variant8/fastify/node_modules/avvio/plugin.js:79:33)
      at Boot.loadPlugin (../../../VariantsDeps/fastify/variant8/fastify/node_modules/avvio/plugin.js:272:10)

  ● Health checks › Default configuration exposes a /_health route

    FastifyError: fastify-plugin: Plugin did not start in time: 'bound _after'. You may have forgotten to call 'done' function or to resolve a Promise

      618 |     // config issue on the load balancer side.
      619 |     this.log.trace({ err }, 'client error')
    > 620 |     // Copying standard node behaviour
          |                                       ^
      621 |     // https://github.com/nodejs/node/blob/6ca23d7846cb47e84fd344543e394e50938540be/lib/_http_server.js#L666
      622 |
      623 |     // If the socket is not writable, there is no reason to try to send data.

      at manageErr (../../../VariantsDeps/fastify/variant8/fastify/fastify.js:620:87)
      at ../../../VariantsDeps/fastify/variant8/fastify/fastify.js:607:11
      at Object._encapsulateThreeParam (../../../VariantsDeps/fastify/variant8/fastify/node_modules/avvio/boot.js:557:7)
      at Boot.timeoutCall (../../../VariantsDeps/fastify/variant8/fastify/node_modules/avvio/boot.js:453:5)
      at Boot.callWithCbOrNextTick (../../../VariantsDeps/fastify/variant8/fastify/node_modules/avvio/boot.js:435:19)
      at release (../../../VariantsDeps/fastify/variant8/fastify/node_modules/fastq/queue.js:149:16)
      at Object.resume (../../../VariantsDeps/fastify/variant8/fastify/node_modules/fastq/queue.js:82:7)
      at ../../../VariantsDeps/fastify/variant8/fastify/node_modules/avvio/boot.js:174:18
      at ../../../VariantsDeps/fastify/variant8/fastify/node_modules/avvio/plugin.js:275:7
      at done (../../../VariantsDeps/fastify/variant8/fastify/node_modules/avvio/plugin.js:200:5)

  ● Health checks › Default configuration exposes a /_health route

    FastifyError: fastify-plugin: Plugin did not start in time: 'bound _after'. You may have forgotten to call 'done' function or to resolve a Promise

      618 |     // config issue on the load balancer side.
      619 |     this.log.trace({ err }, 'client error')
    > 620 |     // Copying standard node behaviour
          |                                       ^
      621 |     // https://github.com/nodejs/node/blob/6ca23d7846cb47e84fd344543e394e50938540be/lib/_http_server.js#L666
      622 |
      623 |     // If the socket is not writable, there is no reason to try to send data.

      at manageErr (../../../VariantsDeps/fastify/variant8/fastify/fastify.js:620:87)
      at ../../../VariantsDeps/fastify/variant8/fastify/fastify.js:607:11
      at Object._encapsulateThreeParam (../../../VariantsDeps/fastify/variant8/fastify/node_modules/avvio/boot.js:557:7)
      at Boot.timeoutCall (../../../VariantsDeps/fastify/variant8/fastify/node_modules/avvio/boot.js:453:5)
      at Boot.callWithCbOrNextTick (../../../VariantsDeps/fastify/variant8/fastify/node_modules/avvio/boot.js:435:19)
      at release (../../../VariantsDeps/fastify/variant8/fastify/node_modules/fastq/queue.js:149:16)
      at Object.resume (../../../VariantsDeps/fastify/variant8/fastify/node_modules/fastq/queue.js:82:7)
      at ../../../VariantsDeps/fastify/variant8/fastify/node_modules/avvio/boot.js:174:18
      at ../../../VariantsDeps/fastify/variant8/fastify/node_modules/avvio/plugin.js:275:7
      at done (../../../VariantsDeps/fastify/variant8/fastify/node_modules/avvio/plugin.js:200:5)

  ● Health checks › Default configuration exposes a /_health route

    thrown: "Exceeded timeout of 5000 ms for a test.
    Use jest.setTimeout(newTimeout) to increase the timeout value, if this is a long-running test."

       6 |   })
       7 |
    >  8 |   test('Default configuration exposes a /_health route', async () => {
         |   ^
       9 |     const server = createServer()
      10 |     await server.ready()
      11 |     const res = await server.inject({ method: 'GET', url: '/_health' })

      at tests/health.test.ts:8:3
      at Object.<anonymous> (tests/health.test.ts:3:1)

  ● Health checks › Custom health check handler is called at startup and every 5 seconds

    TypeError: semver.satisfies is not a function

      120 | }
      121 |
    > 122 | function registerPluginName (fn) {
          |                                 ^
      123 |   const meta = getMeta(fn)
      124 |   if (!meta) return
      125 |

      at Object.checkVersion (../../../VariantsDeps/fastify/variant8/fastify/lib/pluginUtils.js:122:33)
      at Object.registerPlugin (../../../VariantsDeps/fastify/variant8/fastify/lib/pluginUtils.js:143:16)
      at Boot.override (../../../VariantsDeps/fastify/variant8/fastify/lib/pluginOverride.js:35:57)
      at Plugin.Object.<anonymous>.Plugin.exec (../../../VariantsDeps/fastify/variant8/fastify/node_modules/avvio/plugin.js:79:33)
      at Boot.loadPlugin (../../../VariantsDeps/fastify/variant8/fastify/node_modules/avvio/plugin.js:272:10)
      at node_modules/@jest/fake-timers/build/legacyFakeTimers.js:558:18

  ● Health checks › Custom health check handler is called at startup and every 5 seconds

    thrown: "Exceeded timeout of 5000 ms for a test.
    Use jest.setTimeout(newTimeout) to increase the timeout value, if this is a long-running test."

      14 |   })
      15 |
    > 16 |   test('Custom health check handler is called at startup and every 5 seconds', async () => {
         |   ^
      17 |     jest.useFakeTimers('legacy')
      18 |     const healthCheck = jest.fn().mockResolvedValue(true)
      19 |     const server = createServer({

      at tests/health.test.ts:16:3
      at Object.<anonymous> (tests/health.test.ts:3:1)

  ● Health checks › Custom health check throwing results in 503

    TypeError: semver.satisfies is not a function

      120 | }
      121 |
    > 122 | function registerPluginName (fn) {
          |                                 ^
      123 |   const meta = getMeta(fn)
      124 |   if (!meta) return
      125 |

      at Object.checkVersion (../../../VariantsDeps/fastify/variant8/fastify/lib/pluginUtils.js:122:33)
      at Object.registerPlugin (../../../VariantsDeps/fastify/variant8/fastify/lib/pluginUtils.js:143:16)
      at Boot.override (../../../VariantsDeps/fastify/variant8/fastify/lib/pluginOverride.js:35:57)
      at Plugin.Object.<anonymous>.Plugin.exec (../../../VariantsDeps/fastify/variant8/fastify/node_modules/avvio/plugin.js:79:33)
      at Boot.loadPlugin (../../../VariantsDeps/fastify/variant8/fastify/node_modules/avvio/plugin.js:272:10)
      at node_modules/@jest/fake-timers/build/legacyFakeTimers.js:558:18

  ● Health checks › Custom health check throwing results in 503

    FastifyError: fastify-plugin: Plugin did not start in time: 'bound _after'. You may have forgotten to call 'done' function or to resolve a Promise

      618 |     // config issue on the load balancer side.
      619 |     this.log.trace({ err }, 'client error')
    > 620 |     // Copying standard node behaviour
          |                                       ^
      621 |     // https://github.com/nodejs/node/blob/6ca23d7846cb47e84fd344543e394e50938540be/lib/_http_server.js#L666
      622 |
      623 |     // If the socket is not writable, there is no reason to try to send data.

      at manageErr (../../../VariantsDeps/fastify/variant8/fastify/fastify.js:620:87)
      at ../../../VariantsDeps/fastify/variant8/fastify/fastify.js:607:11
      at Object._encapsulateThreeParam (../../../VariantsDeps/fastify/variant8/fastify/node_modules/avvio/boot.js:557:7)
      at Boot.timeoutCall (../../../VariantsDeps/fastify/variant8/fastify/node_modules/avvio/boot.js:453:5)
      at Boot.callWithCbOrNextTick (../../../VariantsDeps/fastify/variant8/fastify/node_modules/avvio/boot.js:435:19)
      at release (../../../VariantsDeps/fastify/variant8/fastify/node_modules/fastq/queue.js:149:16)
      at Object.resume (../../../VariantsDeps/fastify/variant8/fastify/node_modules/fastq/queue.js:82:7)
      at ../../../VariantsDeps/fastify/variant8/fastify/node_modules/avvio/boot.js:174:18
      at ../../../VariantsDeps/fastify/variant8/fastify/node_modules/avvio/plugin.js:275:7
      at done (../../../VariantsDeps/fastify/variant8/fastify/node_modules/avvio/plugin.js:200:5)

  ● Health checks › Custom health check throwing results in 503

    thrown: "Exceeded timeout of 5000 ms for a test.
    Use jest.setTimeout(newTimeout) to increase the timeout value, if this is a long-running test."

      29 |   })
      30 |
    > 31 |   test('Custom health check throwing results in 503', async () => {
         |   ^
      32 |     jest.useFakeTimers('legacy')
      33 |     const healthCheck = jest
      34 |       .fn()

      at tests/health.test.ts:31:3
      at Object.<anonymous> (tests/health.test.ts:3:1)

  ● Health checks › Disabled health monitoring

    TypeError: semver.satisfies is not a function

      120 | }
      121 |
    > 122 | function registerPluginName (fn) {
          |                                 ^
      123 |   const meta = getMeta(fn)
      124 |   if (!meta) return
      125 |

      at Object.checkVersion (../../../VariantsDeps/fastify/variant8/fastify/lib/pluginUtils.js:122:33)
      at Object.registerPlugin (../../../VariantsDeps/fastify/variant8/fastify/lib/pluginUtils.js:143:16)
      at Boot.override (../../../VariantsDeps/fastify/variant8/fastify/lib/pluginOverride.js:35:57)
      at Plugin.Object.<anonymous>.Plugin.exec (../../../VariantsDeps/fastify/variant8/fastify/node_modules/avvio/plugin.js:79:33)
      at Boot.loadPlugin (../../../VariantsDeps/fastify/variant8/fastify/node_modules/avvio/plugin.js:272:10)
      at node_modules/@jest/fake-timers/build/legacyFakeTimers.js:558:18

  ● Health checks › Disabled health monitoring

    thrown: "Exceeded timeout of 5000 ms for a test.
    Use jest.setTimeout(newTimeout) to increase the timeout value, if this is a long-running test."

      63 |   })
      64 |
    > 65 |   test('Disabled health monitoring', async () => {
         |   ^
      66 |     process.env.FASTIFY_MICRO_DISABLE_SERVICE_HEALTH_MONITORING = 'true'
      67 |     jest.useFakeTimers('legacy')
      68 |     const healthCheck = jest.fn().mockResolvedValue(true)

      at tests/health.test.ts:65:3
      at Object.<anonymous> (tests/health.test.ts:3:1)

FAIL tests/graceful.test.ts (10.364 s)
  Graceful shutdown
    ✕ with custom handler (5001 ms)
    ✕ with custom async handler (5000 ms)

  ● Graceful shutdown › with custom handler

    TypeError: semver.satisfies is not a function

      120 | }
      121 |
    > 122 | function registerPluginName (fn) {
          |                                 ^
      123 |   const meta = getMeta(fn)
      124 |   if (!meta) return
      125 |

      at Object.checkVersion (../../../VariantsDeps/fastify/variant8/fastify/lib/pluginUtils.js:122:33)
      at Object.registerPlugin (../../../VariantsDeps/fastify/variant8/fastify/lib/pluginUtils.js:143:16)
      at Boot.override (../../../VariantsDeps/fastify/variant8/fastify/lib/pluginOverride.js:35:57)
      at Plugin.Object.<anonymous>.Plugin.exec (../../../VariantsDeps/fastify/variant8/fastify/node_modules/avvio/plugin.js:79:33)
      at Boot.loadPlugin (../../../VariantsDeps/fastify/variant8/fastify/node_modules/avvio/plugin.js:272:10)

  ● Graceful shutdown › with custom handler

    thrown: "Exceeded timeout of 5000 ms for a test.
    Use jest.setTimeout(newTimeout) to increase the timeout value, if this is a long-running test."

      3 |
      4 | describe('Graceful shutdown', () => {
    > 5 |   test('with custom handler', async () => {
        |   ^
      6 |     const server = createServer({ name: 'foo' })
      7 |     server.addHook('onClose', (fastify, done) => {
      8 |       expect(fastify.name).toEqual('foo')

      at tests/graceful.test.ts:5:3
      at Object.<anonymous> (tests/graceful.test.ts:4:1)

  ● Graceful shutdown › with custom async handler

    TypeError: semver.satisfies is not a function

      120 | }
      121 |
    > 122 | function registerPluginName (fn) {
          |                                 ^
      123 |   const meta = getMeta(fn)
      124 |   if (!meta) return
      125 |

      at Object.checkVersion (../../../VariantsDeps/fastify/variant8/fastify/lib/pluginUtils.js:122:33)
      at Object.registerPlugin (../../../VariantsDeps/fastify/variant8/fastify/lib/pluginUtils.js:143:16)
      at Boot.override (../../../VariantsDeps/fastify/variant8/fastify/lib/pluginOverride.js:35:57)
      at Plugin.Object.<anonymous>.Plugin.exec (../../../VariantsDeps/fastify/variant8/fastify/node_modules/avvio/plugin.js:79:33)
      at Boot.loadPlugin (../../../VariantsDeps/fastify/variant8/fastify/node_modules/avvio/plugin.js:272:10)

  ● Graceful shutdown › with custom async handler

    thrown: "Exceeded timeout of 5000 ms for a test.
    Use jest.setTimeout(newTimeout) to increase the timeout value, if this is a long-running test."

      13 |   })
      14 |
    > 15 |   test('with custom async handler', async () => {
         |   ^
      16 |     const server = createServer({ name: 'foo' })
      17 |     server.addHook('onClose', async fastify => {
      18 |       await delay(100)

      at tests/graceful.test.ts:15:3
      at Object.<anonymous> (tests/graceful.test.ts:4:1)

FAIL tests/logger.test.ts (23.091 s)
  Logger
    ✕ name property (5001 ms)
    ✕ redact environment variables (5002 ms)
    ✕ redact log paths (5001 ms)
    ✕ request ID generator (5001 ms)

  ● Logger › name property

    thrown: "Exceeded timeout of 5000 ms for a test.
    Use jest.setTimeout(newTimeout) to increase the timeout value, if this is a long-running test."

      2 |
      3 | describe('Logger', () => {
    > 4 |   test('name property', async () => {
        |   ^
      5 |     const [logLine] = await testLogs(logLine => logLine.dataTestID === 'name')
      6 |     expect(logLine.from).toEqual('foo')
      7 |   })

      at tests/logger.test.ts:4:3
      at Object.<anonymous> (tests/logger.test.ts:3:1)

  ● Logger › redact environment variables

    thrown: "Exceeded timeout of 5000 ms for a test.
    Use jest.setTimeout(newTimeout) to increase the timeout value, if this is a long-running test."

       7 |   })
       8 |
    >  9 |   test('redact environment variables', async () => {
         |   ^
      10 |     const [logLine] = await testLogs(
      11 |       logLine => logLine.dataTestID === 'redact-env'
      12 |     )

      at tests/logger.test.ts:9:3
      at Object.<anonymous> (tests/logger.test.ts:3:1)

  ● Logger › redact log paths

    thrown: "Exceeded timeout of 5000 ms for a test.
    Use jest.setTimeout(newTimeout) to increase the timeout value, if this is a long-running test."

      14 |   })
      15 |
    > 16 |   test('redact log paths', async () => {
         |   ^
      17 |     const [logLine] = await testLogs(
      18 |       logLine => logLine.dataTestID === 'redact-path'
      19 |     )

      at tests/logger.test.ts:16:3
      at Object.<anonymous> (tests/logger.test.ts:3:1)

  ● Logger › request ID generator

    thrown: "Exceeded timeout of 5000 ms for a test.
    Use jest.setTimeout(newTimeout) to increase the timeout value, if this is a long-running test."

      21 |   })
      22 |
    > 23 |   test('request ID generator', async () => {
         |   ^
      24 |     type ReqResLog = { reqId: string }
      25 |
      26 |     const [req1, res1, req2, res2, req3, res3, req4, res4] =

      at tests/logger.test.ts:23:3
      at Object.<anonymous> (tests/logger.test.ts:3:1)

ts-jest[ts-jest-transformer] (WARN) Got a `.js` file to compile while `allowJs` option is not set to `true` (file: /data/js-variants/multee/VariantsDeps/fastify/variant7/fastify/fastify.js). To fix this:
  - if you want TypeScript to process JS files, set `allowJs` to `true` in your TypeScript config (usually tsconfig.json)
  - if you do not want TypeScript to process your `.js` files, in your Jest config change the `transform` key which value is `ts-jest` so that it does not match `.js` files anymore
Browserslist: caniuse-lite is outdated. Please run:
  npx browserslist@latest --update-db
  Why you should do it regularly: https://github.com/browserslist/browserslist#browsers-data-updating
ts-jest[ts-jest-transformer] (WARN) Got a `.js` file to compile while `allowJs` option is not set to `true` (file: /data/js-variants/multee/VariantsDeps/fastify/variant7/fastify/lib/symbols.js). To fix this:
  - if you want TypeScript to process JS files, set `allowJs` to `true` in your TypeScript config (usually tsconfig.json)
  - if you do not want TypeScript to process your `.js` files, in your Jest config change the `transform` key which value is `ts-jest` so that it does not match `.js` files anymore
ts-jest[ts-jest-transformer] (WARN) Got a `.js` file to compile while `allowJs` option is not set to `true` (file: /data/js-variants/multee/VariantsDeps/fastify/variant7/fastify/lib/server.js). To fix this:
  - if you want TypeScript to process JS files, set `allowJs` to `true` in your TypeScript config (usually tsconfig.json)
  - if you do not want TypeScript to process your `.js` files, in your Jest config change the `transform` key which value is `ts-jest` so that it does not match `.js` files anymore
ts-jest[ts-jest-transformer] (WARN) Got a `.js` file to compile while `allowJs` option is not set to `true` (file: /data/js-variants/multee/VariantsDeps/fastify/variant7/fastify/lib/warnings.js). To fix this:
  - if you want TypeScript to process JS files, set `allowJs` to `true` in your TypeScript config (usually tsconfig.json)
  - if you do not want TypeScript to process your `.js` files, in your Jest config change the `transform` key which value is `ts-jest` so that it does not match `.js` files anymore
ts-jest[ts-jest-transformer] (WARN) Got a `.js` file to compile while `allowJs` option is not set to `true` (file: /data/js-variants/multee/VariantsDeps/fastify/variant7/fastify/lib/errors.js). To fix this:
  - if you want TypeScript to process JS files, set `allowJs` to `true` in your TypeScript config (usually tsconfig.json)
  - if you do not want TypeScript to process your `.js` files, in your Jest config change the `transform` key which value is `ts-jest` so that it does not match `.js` files anymore
ts-jest[ts-jest-transformer] (WARN) Got a `.js` file to compile while `allowJs` option is not set to `true` (file: /data/js-variants/multee/VariantsDeps/fastify/variant7/fastify/lib/reply.js). To fix this:
  - if you want TypeScript to process JS files, set `allowJs` to `true` in your TypeScript config (usually tsconfig.json)
  - if you do not want TypeScript to process your `.js` files, in your Jest config change the `transform` key which value is `ts-jest` so that it does not match `.js` files anymore
ts-jest[ts-jest-transformer] (WARN) Got a `.js` file to compile while `allowJs` option is not set to `true` (file: /data/js-variants/multee/VariantsDeps/fastify/variant7/fastify/lib/hooks.js). To fix this:
  - if you want TypeScript to process JS files, set `allowJs` to `true` in your TypeScript config (usually tsconfig.json)
  - if you do not want TypeScript to process your `.js` files, in your Jest config change the `transform` key which value is `ts-jest` so that it does not match `.js` files anymore
ts-jest[ts-jest-transformer] (WARN) Got a `.js` file to compile while `allowJs` option is not set to `true` (file: /data/js-variants/multee/VariantsDeps/fastify/variant7/fastify/lib/handleRequest.js). To fix this:
  - if you want TypeScript to process JS files, set `allowJs` to `true` in your TypeScript config (usually tsconfig.json)
  - if you do not want TypeScript to process your `.js` files, in your Jest config change the `transform` key which value is `ts-jest` so that it does not match `.js` files anymore
ts-jest[ts-jest-transformer] (WARN) Got a `.js` file to compile while `allowJs` option is not set to `true` (file: /data/js-variants/multee/VariantsDeps/fastify/variant7/fastify/lib/validation.js). To fix this:
  - if you want TypeScript to process JS files, set `allowJs` to `true` in your TypeScript config (usually tsconfig.json)
  - if you do not want TypeScript to process your `.js` files, in your Jest config change the `transform` key which value is `ts-jest` so that it does not match `.js` files anymore
ts-jest[ts-jest-transformer] (WARN) Got a `.js` file to compile while `allowJs` option is not set to `true` (file: /data/js-variants/multee/VariantsDeps/fastify/variant7/fastify/lib/wrapThenable.js). To fix this:
  - if you want TypeScript to process JS files, set `allowJs` to `true` in your TypeScript config (usually tsconfig.json)
  - if you do not want TypeScript to process your `.js` files, in your Jest config change the `transform` key which value is `ts-jest` so that it does not match `.js` files anymore
ts-jest[ts-jest-transformer] (WARN) Got a `.js` file to compile while `allowJs` option is not set to `true` (file: /data/js-variants/multee/VariantsDeps/fastify/variant7/fastify/lib/logger.js). To fix this:
  - if you want TypeScript to process JS files, set `allowJs` to `true` in your TypeScript config (usually tsconfig.json)
  - if you do not want TypeScript to process your `.js` files, in your Jest config change the `transform` key which value is `ts-jest` so that it does not match `.js` files anymore
ts-jest[ts-jest-transformer] (WARN) Got a `.js` file to compile while `allowJs` option is not set to `true` (file: /data/js-variants/multee/VariantsDeps/fastify/variant7/fastify/lib/error-handler.js). To fix this:
  - if you want TypeScript to process JS files, set `allowJs` to `true` in your TypeScript config (usually tsconfig.json)
  - if you do not want TypeScript to process your `.js` files, in your Jest config change the `transform` key which value is `ts-jest` so that it does not match `.js` files anymore
ts-jest[ts-jest-transformer] (WARN) Got a `.js` file to compile while `allowJs` option is not set to `true` (file: /data/js-variants/multee/VariantsDeps/fastify/variant7/fastify/lib/schemas.js). To fix this:
  - if you want TypeScript to process JS files, set `allowJs` to `true` in your TypeScript config (usually tsconfig.json)
  - if you do not want TypeScript to process your `.js` files, in your Jest config change the `transform` key which value is `ts-jest` so that it does not match `.js` files anymore
ts-jest[ts-jest-transformer] (WARN) Got a `.js` file to compile while `allowJs` option is not set to `true` (file: /data/js-variants/multee/VariantsDeps/fastify/variant7/fastify/lib/error-serializer.js). To fix this:
  - if you want TypeScript to process JS files, set `allowJs` to `true` in your TypeScript config (usually tsconfig.json)
  - if you do not want TypeScript to process your `.js` files, in your Jest config change the `transform` key which value is `ts-jest` so that it does not match `.js` files anymore
ts-jest[ts-jest-transformer] (WARN) Got a `.js` file to compile while `allowJs` option is not set to `true` (file: /data/js-variants/multee/VariantsDeps/fastify/variant7/fastify/lib/request.js). To fix this:
  - if you want TypeScript to process JS files, set `allowJs` to `true` in your TypeScript config (usually tsconfig.json)
  - if you do not want TypeScript to process your `.js` files, in your Jest config change the `transform` key which value is `ts-jest` so that it does not match `.js` files anymore
ts-jest[ts-jest-transformer] (WARN) Got a `.js` file to compile while `allowJs` option is not set to `true` (file: /data/js-variants/multee/VariantsDeps/fastify/variant7/fastify/lib/decorate.js). To fix this:
  - if you want TypeScript to process JS files, set `allowJs` to `true` in your TypeScript config (usually tsconfig.json)
  - if you do not want TypeScript to process your `.js` files, in your Jest config change the `transform` key which value is `ts-jest` so that it does not match `.js` files anymore
ts-jest[ts-jest-transformer] (WARN) Got a `.js` file to compile while `allowJs` option is not set to `true` (file: /data/js-variants/multee/VariantsDeps/fastify/variant7/fastify/lib/contentTypeParser.js). To fix this:
  - if you want TypeScript to process JS files, set `allowJs` to `true` in your TypeScript config (usually tsconfig.json)
  - if you do not want TypeScript to process your `.js` files, in your Jest config change the `transform` key which value is `ts-jest` so that it does not match `.js` files anymore
ts-jest[ts-jest-transformer] (WARN) Got a `.js` file to compile while `allowJs` option is not set to `true` (file: /data/js-variants/multee/VariantsDeps/fastify/variant7/fastify/lib/schema-controller.js). To fix this:
  - if you want TypeScript to process JS files, set `allowJs` to `true` in your TypeScript config (usually tsconfig.json)
  - if you do not want TypeScript to process your `.js` files, in your Jest config change the `transform` key which value is `ts-jest` so that it does not match `.js` files anymore
ts-jest[ts-jest-transformer] (WARN) Got a `.js` file to compile while `allowJs` option is not set to `true` (file: /data/js-variants/multee/VariantsDeps/fastify/variant7/fastify/lib/pluginUtils.js). To fix this:
  - if you want TypeScript to process JS files, set `allowJs` to `true` in your TypeScript config (usually tsconfig.json)
  - if you do not want TypeScript to process your `.js` files, in your Jest config change the `transform` key which value is `ts-jest` so that it does not match `.js` files anymore
ts-jest[ts-jest-transformer] (WARN) Got a `.js` file to compile while `allowJs` option is not set to `true` (file: /data/js-variants/multee/VariantsDeps/fastify/variant7/fastify/lib/reqIdGenFactory.js). To fix this:
  - if you want TypeScript to process JS files, set `allowJs` to `true` in your TypeScript config (usually tsconfig.json)
  - if you do not want TypeScript to process your `.js` files, in your Jest config change the `transform` key which value is `ts-jest` so that it does not match `.js` files anymore
ts-jest[ts-jest-transformer] (WARN) Got a `.js` file to compile while `allowJs` option is not set to `true` (file: /data/js-variants/multee/VariantsDeps/fastify/variant7/fastify/lib/route.js). To fix this:
  - if you want TypeScript to process JS files, set `allowJs` to `true` in your TypeScript config (usually tsconfig.json)
  - if you do not want TypeScript to process your `.js` files, in your Jest config change the `transform` key which value is `ts-jest` so that it does not match `.js` files anymore
ts-jest[ts-jest-transformer] (WARN) Got a `.js` file to compile while `allowJs` option is not set to `true` (file: /data/js-variants/multee/VariantsDeps/fastify/variant7/fastify/lib/context.js). To fix this:
  - if you want TypeScript to process JS files, set `allowJs` to `true` in your TypeScript config (usually tsconfig.json)
  - if you do not want TypeScript to process your `.js` files, in your Jest config change the `transform` key which value is `ts-jest` so that it does not match `.js` files anymore
ts-jest[ts-jest-transformer] (WARN) Got a `.js` file to compile while `allowJs` option is not set to `true` (file: /data/js-variants/multee/VariantsDeps/fastify/variant7/fastify/lib/headRoute.js). To fix this:
  - if you want TypeScript to process JS files, set `allowJs` to `true` in your TypeScript config (usually tsconfig.json)
  - if you do not want TypeScript to process your `.js` files, in your Jest config change the `transform` key which value is `ts-jest` so that it does not match `.js` files anymore
ts-jest[ts-jest-transformer] (WARN) Got a `.js` file to compile while `allowJs` option is not set to `true` (file: /data/js-variants/multee/VariantsDeps/fastify/variant7/fastify/lib/fourOhFour.js). To fix this:
  - if you want TypeScript to process JS files, set `allowJs` to `true` in your TypeScript config (usually tsconfig.json)
  - if you do not want TypeScript to process your `.js` files, in your Jest config change the `transform` key which value is `ts-jest` so that it does not match `.js` files anymore
ts-jest[ts-jest-transformer] (WARN) Got a `.js` file to compile while `allowJs` option is not set to `true` (file: /data/js-variants/multee/VariantsDeps/fastify/variant7/fastify/lib/initialConfigValidation.js). To fix this:
  - if you want TypeScript to process JS files, set `allowJs` to `true` in your TypeScript config (usually tsconfig.json)
  - if you do not want TypeScript to process your `.js` files, in your Jest config change the `transform` key which value is `ts-jest` so that it does not match `.js` files anymore
ts-jest[ts-jest-transformer] (WARN) Got a `.js` file to compile while `allowJs` option is not set to `true` (file: /data/js-variants/multee/VariantsDeps/fastify/variant7/fastify/lib/configValidator.js). To fix this:
  - if you want TypeScript to process JS files, set `allowJs` to `true` in your TypeScript config (usually tsconfig.json)
  - if you do not want TypeScript to process your `.js` files, in your Jest config change the `transform` key which value is `ts-jest` so that it does not match `.js` files anymore
ts-jest[ts-jest-transformer] (WARN) Got a `.js` file to compile while `allowJs` option is not set to `true` (file: /data/js-variants/multee/VariantsDeps/fastify/variant7/fastify/lib/pluginOverride.js). To fix this:
  - if you want TypeScript to process JS files, set `allowJs` to `true` in your TypeScript config (usually tsconfig.json)
  - if you do not want TypeScript to process your `.js` files, in your Jest config change the `transform` key which value is `ts-jest` so that it does not match `.js` files anymore
ts-jest[ts-jest-transformer] (WARN) Got a `.js` file to compile while `allowJs` option is not set to `true` (file: /data/js-variants/multee/VariantsDeps/fastify/variant7/fastify/lib/noop-set.js). To fix this:
  - if you want TypeScript to process JS files, set `allowJs` to `true` in your TypeScript config (usually tsconfig.json)
  - if you do not want TypeScript to process your `.js` files, in your Jest config change the `transform` key which value is `ts-jest` so that it does not match `.js` files anymore
FAIL tests/basics.test.ts (22.844 s)
  Basics
    ✓ The specified `name` property is injected (39 ms)
    ✕ Default port should be 3000 (5002 ms)
    ✕ Port should be configurable via the environment (5001 ms)
    ✕ Port can be passed as a second argument to `startServer` (5001 ms)

  ● Basics › Default port should be 3000

    FastifyError: fastify-plugin: fastify-micro:sentry - expected '3.x' fastify version, '4.3.0' is installed

      127 |   if (!name) return
      128 |   this[registeredPlugins].push(name)
    > 129 | }
          |  ^
      130 |
      131 | function registerPlugin (fn) {
      132 |   registerPluginName.call(this, fn)

      at Object.checkVersion (../../../VariantsDeps/fastify/variant7/fastify/lib/pluginUtils.js:129:11)
      at Object.registerPlugin (../../../VariantsDeps/fastify/variant7/fastify/lib/pluginUtils.js:143:16)
      at Boot.override (../../../VariantsDeps/fastify/variant7/fastify/lib/pluginOverride.js:35:57)
      at Plugin.Object.<anonymous>.Plugin.exec (../../../VariantsDeps/fastify/variant7/fastify/node_modules/avvio/plugin.js:79:33)
      at Boot.loadPlugin (../../../VariantsDeps/fastify/variant7/fastify/node_modules/avvio/plugin.js:272:10)

  ● Basics › Default port should be 3000

    FastifyError: fastify-plugin: fastify-micro:sentry - expected '3.x' fastify version, '4.3.0' is installed

      127 |   if (!name) return
      128 |   this[registeredPlugins].push(name)
    > 129 | }
          |  ^
      130 |
      131 | function registerPlugin (fn) {
      132 |   registerPluginName.call(this, fn)

      at Object.checkVersion (../../../VariantsDeps/fastify/variant7/fastify/lib/pluginUtils.js:129:11)
      at Object.registerPlugin (../../../VariantsDeps/fastify/variant7/fastify/lib/pluginUtils.js:143:16)
      at Boot.override (../../../VariantsDeps/fastify/variant7/fastify/lib/pluginOverride.js:35:57)
      at Plugin.Object.<anonymous>.Plugin.exec (../../../VariantsDeps/fastify/variant7/fastify/node_modules/avvio/plugin.js:79:33)
      at Boot.loadPlugin (../../../VariantsDeps/fastify/variant7/fastify/node_modules/avvio/plugin.js:272:10)

  ● Basics › Default port should be 3000

    FastifyError: fastify-plugin: fastify-micro:sentry - expected '3.x' fastify version, '4.3.0' is installed

      127 |   if (!name) return
      128 |   this[registeredPlugins].push(name)
    > 129 | }
          |  ^
      130 |
      131 | function registerPlugin (fn) {
      132 |   registerPluginName.call(this, fn)

      at Object.checkVersion (../../../VariantsDeps/fastify/variant7/fastify/lib/pluginUtils.js:129:11)
      at Object.registerPlugin (../../../VariantsDeps/fastify/variant7/fastify/lib/pluginUtils.js:143:16)
      at Boot.override (../../../VariantsDeps/fastify/variant7/fastify/lib/pluginOverride.js:35:57)
      at Plugin.Object.<anonymous>.Plugin.exec (../../../VariantsDeps/fastify/variant7/fastify/node_modules/avvio/plugin.js:79:33)
      at Boot.loadPlugin (../../../VariantsDeps/fastify/variant7/fastify/node_modules/avvio/plugin.js:272:10)

  ● Basics › Default port should be 3000

    thrown: "Exceeded timeout of 5000 ms for a test.
    Use jest.setTimeout(newTimeout) to increase the timeout value, if this is a long-running test."

      15 |   })
      16 |
    > 17 |   test('Default port should be 3000', async () => {
         |   ^
      18 |     const key = nanoid()
      19 |     const server = createServer()
      20 |     server.get('/', (_, res) => {

      at tests/basics.test.ts:17:3
      at Object.<anonymous> (tests/basics.test.ts:5:1)

  ● Basics › Port should be configurable via the environment

    FastifyError: fastify-plugin: fastify-micro:sentry - expected '3.x' fastify version, '4.3.0' is installed

      127 |   if (!name) return
      128 |   this[registeredPlugins].push(name)
    > 129 | }
          |  ^
      130 |
      131 | function registerPlugin (fn) {
      132 |   registerPluginName.call(this, fn)

      at Object.checkVersion (../../../VariantsDeps/fastify/variant7/fastify/lib/pluginUtils.js:129:11)
      at Object.registerPlugin (../../../VariantsDeps/fastify/variant7/fastify/lib/pluginUtils.js:143:16)
      at Boot.override (../../../VariantsDeps/fastify/variant7/fastify/lib/pluginOverride.js:35:57)
      at Plugin.Object.<anonymous>.Plugin.exec (../../../VariantsDeps/fastify/variant7/fastify/node_modules/avvio/plugin.js:79:33)
      at Boot.loadPlugin (../../../VariantsDeps/fastify/variant7/fastify/node_modules/avvio/plugin.js:272:10)

  ● Basics › Port should be configurable via the environment

    thrown: "Exceeded timeout of 5000 ms for a test.
    Use jest.setTimeout(newTimeout) to increase the timeout value, if this is a long-running test."

      27 |   })
      28 |
    > 29 |   test('Port should be configurable via the environment', async () => {
         |   ^
      30 |     process.env.PORT = '3001'
      31 |     const key = nanoid()
      32 |     const server = createServer()

      at tests/basics.test.ts:29:3
      at Object.<anonymous> (tests/basics.test.ts:5:1)

  ● Basics › Port can be passed as a second argument to `startServer`

    FastifyError: fastify-plugin: fastify-micro:sentry - expected '3.x' fastify version, '4.3.0' is installed

      127 |   if (!name) return
      128 |   this[registeredPlugins].push(name)
    > 129 | }
          |  ^
      130 |
      131 | function registerPlugin (fn) {
      132 |   registerPluginName.call(this, fn)

      at Object.checkVersion (../../../VariantsDeps/fastify/variant7/fastify/lib/pluginUtils.js:129:11)
      at Object.registerPlugin (../../../VariantsDeps/fastify/variant7/fastify/lib/pluginUtils.js:143:16)
      at Boot.override (../../../VariantsDeps/fastify/variant7/fastify/lib/pluginOverride.js:35:57)
      at Plugin.Object.<anonymous>.Plugin.exec (../../../VariantsDeps/fastify/variant7/fastify/node_modules/avvio/plugin.js:79:33)
      at Boot.loadPlugin (../../../VariantsDeps/fastify/variant7/fastify/node_modules/avvio/plugin.js:272:10)

  ● Basics › Port can be passed as a second argument to `startServer`

    FastifyError: fastify-plugin: Plugin did not start in time: 'bound _after'. You may have forgotten to call 'done' function or to resolve a Promise

      618 |     // config issue on the load balancer side.
      619 |     this.log.trace({ err }, 'client error')
    > 620 |     // Copying standard node behaviour
          |                                       ^
      621 |     // https://github.com/nodejs/node/blob/6ca23d7846cb47e84fd344543e394e50938540be/lib/_http_server.js#L666
      622 |
      623 |     // If the socket is not writable, there is no reason to try to send data.

      at manageErr (../../../VariantsDeps/fastify/variant7/fastify/fastify.js:620:87)
      at ../../../VariantsDeps/fastify/variant7/fastify/fastify.js:607:11
      at Object._encapsulateThreeParam (../../../VariantsDeps/fastify/variant7/fastify/node_modules/avvio/boot.js:557:7)
      at Boot.timeoutCall (../../../VariantsDeps/fastify/variant7/fastify/node_modules/avvio/boot.js:453:5)
      at Boot.callWithCbOrNextTick (../../../VariantsDeps/fastify/variant7/fastify/node_modules/avvio/boot.js:435:19)
      at release (../../../VariantsDeps/fastify/variant7/fastify/node_modules/fastq/queue.js:149:16)
      at Object.resume (../../../VariantsDeps/fastify/variant7/fastify/node_modules/fastq/queue.js:82:7)
      at ../../../VariantsDeps/fastify/variant7/fastify/node_modules/avvio/boot.js:174:18
      at ../../../VariantsDeps/fastify/variant7/fastify/node_modules/avvio/plugin.js:275:7
      at done (../../../VariantsDeps/fastify/variant7/fastify/node_modules/avvio/plugin.js:200:5)

  ● Basics › Port can be passed as a second argument to `startServer`

    FastifyError: fastify-plugin: Plugin did not start in time: 'bound _after'. You may have forgotten to call 'done' function or to resolve a Promise

      618 |     // config issue on the load balancer side.
      619 |     this.log.trace({ err }, 'client error')
    > 620 |     // Copying standard node behaviour
          |                                       ^
      621 |     // https://github.com/nodejs/node/blob/6ca23d7846cb47e84fd344543e394e50938540be/lib/_http_server.js#L666
      622 |
      623 |     // If the socket is not writable, there is no reason to try to send data.

      at manageErr (../../../VariantsDeps/fastify/variant7/fastify/fastify.js:620:87)
      at ../../../VariantsDeps/fastify/variant7/fastify/fastify.js:607:11
      at Object._encapsulateThreeParam (../../../VariantsDeps/fastify/variant7/fastify/node_modules/avvio/boot.js:557:7)
      at Boot.timeoutCall (../../../VariantsDeps/fastify/variant7/fastify/node_modules/avvio/boot.js:453:5)
      at Boot.callWithCbOrNextTick (../../../VariantsDeps/fastify/variant7/fastify/node_modules/avvio/boot.js:435:19)
      at release (../../../VariantsDeps/fastify/variant7/fastify/node_modules/fastq/queue.js:149:16)
      at Object.resume (../../../VariantsDeps/fastify/variant7/fastify/node_modules/fastq/queue.js:82:7)
      at ../../../VariantsDeps/fastify/variant7/fastify/node_modules/avvio/boot.js:174:18
      at ../../../VariantsDeps/fastify/variant7/fastify/node_modules/avvio/plugin.js:275:7
      at done (../../../VariantsDeps/fastify/variant7/fastify/node_modules/avvio/plugin.js:200:5)

  ● Basics › Port can be passed as a second argument to `startServer`

    FastifyError: fastify-plugin: Plugin did not start in time: 'bound _after'. You may have forgotten to call 'done' function or to resolve a Promise

      618 |     // config issue on the load balancer side.
      619 |     this.log.trace({ err }, 'client error')
    > 620 |     // Copying standard node behaviour
          |                                       ^
      621 |     // https://github.com/nodejs/node/blob/6ca23d7846cb47e84fd344543e394e50938540be/lib/_http_server.js#L666
      622 |
      623 |     // If the socket is not writable, there is no reason to try to send data.

      at manageErr (../../../VariantsDeps/fastify/variant7/fastify/fastify.js:620:87)
      at ../../../VariantsDeps/fastify/variant7/fastify/fastify.js:607:11
      at Object._encapsulateThreeParam (../../../VariantsDeps/fastify/variant7/fastify/node_modules/avvio/boot.js:557:7)
      at Boot.timeoutCall (../../../VariantsDeps/fastify/variant7/fastify/node_modules/avvio/boot.js:453:5)
      at Boot.callWithCbOrNextTick (../../../VariantsDeps/fastify/variant7/fastify/node_modules/avvio/boot.js:435:19)
      at release (../../../VariantsDeps/fastify/variant7/fastify/node_modules/fastq/queue.js:149:16)
      at Object.resume (../../../VariantsDeps/fastify/variant7/fastify/node_modules/fastq/queue.js:82:7)
      at ../../../VariantsDeps/fastify/variant7/fastify/node_modules/avvio/boot.js:174:18
      at ../../../VariantsDeps/fastify/variant7/fastify/node_modules/avvio/plugin.js:275:7
      at done (../../../VariantsDeps/fastify/variant7/fastify/node_modules/avvio/plugin.js:200:5)

  ● Basics › Port can be passed as a second argument to `startServer`

    thrown: "Exceeded timeout of 5000 ms for a test.
    Use jest.setTimeout(newTimeout) to increase the timeout value, if this is a long-running test."

      41 |   })
      42 |
    > 43 |   test('Port can be passed as a second argument to `startServer`', async () => {
         |   ^
      44 |     const server = createServer()
      45 |     const key = nanoid()
      46 |     server.get('/', (_, res) => {

      at tests/basics.test.ts:43:3
      at Object.<anonymous> (tests/basics.test.ts:5:1)

FAIL tests/plugins.test.ts (15.359 s)
  Plugins
    ✕ Loading plugins & routes from filesystem (5001 ms)
    ✕ Graceful exit (5002 ms)
    ✕ Graceful exit with a slow onClose hook (5001 ms)

  ● Plugins › Loading plugins & routes from filesystem

    FastifyError: fastify-plugin: fastify-micro:sentry - expected '3.x' fastify version, '4.3.0' is installed

      127 |   if (!name) return
      128 |   this[registeredPlugins].push(name)
    > 129 | }
          |  ^
      130 |
      131 | function registerPlugin (fn) {
      132 |   registerPluginName.call(this, fn)

      at Object.checkVersion (../../../VariantsDeps/fastify/variant7/fastify/lib/pluginUtils.js:129:11)
      at Object.registerPlugin (../../../VariantsDeps/fastify/variant7/fastify/lib/pluginUtils.js:143:16)
      at Boot.override (../../../VariantsDeps/fastify/variant7/fastify/lib/pluginOverride.js:35:57)
      at Plugin.Object.<anonymous>.Plugin.exec (../../../VariantsDeps/fastify/variant7/fastify/node_modules/avvio/plugin.js:79:33)
      at Boot.loadPlugin (../../../VariantsDeps/fastify/variant7/fastify/node_modules/avvio/plugin.js:272:10)

  ● Plugins › Loading plugins & routes from filesystem

    FastifyError: fastify-plugin: Plugin did not start in time: 'bound _after'. You may have forgotten to call 'done' function or to resolve a Promise

      618 |     // config issue on the load balancer side.
      619 |     this.log.trace({ err }, 'client error')
    > 620 |     // Copying standard node behaviour
          |                                       ^
      621 |     // https://github.com/nodejs/node/blob/6ca23d7846cb47e84fd344543e394e50938540be/lib/_http_server.js#L666
      622 |
      623 |     // If the socket is not writable, there is no reason to try to send data.

      at manageErr (../../../VariantsDeps/fastify/variant7/fastify/fastify.js:620:87)
      at ../../../VariantsDeps/fastify/variant7/fastify/fastify.js:607:11
      at Object._encapsulateThreeParam (../../../VariantsDeps/fastify/variant7/fastify/node_modules/avvio/boot.js:557:7)
      at Boot.timeoutCall (../../../VariantsDeps/fastify/variant7/fastify/node_modules/avvio/boot.js:453:5)
      at Boot.callWithCbOrNextTick (../../../VariantsDeps/fastify/variant7/fastify/node_modules/avvio/boot.js:435:19)
      at release (../../../VariantsDeps/fastify/variant7/fastify/node_modules/fastq/queue.js:149:16)
      at Object.resume (../../../VariantsDeps/fastify/variant7/fastify/node_modules/fastq/queue.js:82:7)
      at ../../../VariantsDeps/fastify/variant7/fastify/node_modules/avvio/boot.js:174:18
      at ../../../VariantsDeps/fastify/variant7/fastify/node_modules/avvio/plugin.js:275:7
      at done (../../../VariantsDeps/fastify/variant7/fastify/node_modules/avvio/plugin.js:200:5)

  ● Plugins › Loading plugins & routes from filesystem

    FastifyError: fastify-plugin: Plugin did not start in time: 'bound _after'. You may have forgotten to call 'done' function or to resolve a Promise

      618 |     // config issue on the load balancer side.
      619 |     this.log.trace({ err }, 'client error')
    > 620 |     // Copying standard node behaviour
          |                                       ^
      621 |     // https://github.com/nodejs/node/blob/6ca23d7846cb47e84fd344543e394e50938540be/lib/_http_server.js#L666
      622 |
      623 |     // If the socket is not writable, there is no reason to try to send data.

      at manageErr (../../../VariantsDeps/fastify/variant7/fastify/fastify.js:620:87)
      at ../../../VariantsDeps/fastify/variant7/fastify/fastify.js:607:11
      at Object._encapsulateThreeParam (../../../VariantsDeps/fastify/variant7/fastify/node_modules/avvio/boot.js:557:7)
      at Boot.timeoutCall (../../../VariantsDeps/fastify/variant7/fastify/node_modules/avvio/boot.js:453:5)
      at Boot.callWithCbOrNextTick (../../../VariantsDeps/fastify/variant7/fastify/node_modules/avvio/boot.js:435:19)
      at release (../../../VariantsDeps/fastify/variant7/fastify/node_modules/fastq/queue.js:149:16)
      at Object.resume (../../../VariantsDeps/fastify/variant7/fastify/node_modules/fastq/queue.js:82:7)
      at ../../../VariantsDeps/fastify/variant7/fastify/node_modules/avvio/boot.js:174:18
      at ../../../VariantsDeps/fastify/variant7/fastify/node_modules/avvio/plugin.js:275:7
      at done (../../../VariantsDeps/fastify/variant7/fastify/node_modules/avvio/plugin.js:200:5)

  ● Plugins › Loading plugins & routes from filesystem

    thrown: "Exceeded timeout of 5000 ms for a test.
    Use jest.setTimeout(newTimeout) to increase the timeout value, if this is a long-running test."

      11 |   })
      12 |
    > 13 |   test('Loading plugins & routes from filesystem', async () => {
         |   ^
      14 |     const server = createServer({
      15 |       plugins: {
      16 |         dir: path.resolve(__dirname, './jigs/plugins')

      at tests/plugins.test.ts:13:3
      at Object.<anonymous> (tests/plugins.test.ts:8:1)

  ● Plugins › Graceful exit

    FastifyError: fastify-plugin: fastify-micro:sentry - expected '3.x' fastify version, '4.3.0' is installed

      127 |   if (!name) return
      128 |   this[registeredPlugins].push(name)
    > 129 | }
          |  ^
      130 |
      131 | function registerPlugin (fn) {
      132 |   registerPluginName.call(this, fn)

      at Object.checkVersion (../../../VariantsDeps/fastify/variant7/fastify/lib/pluginUtils.js:129:11)
      at Object.registerPlugin (../../../VariantsDeps/fastify/variant7/fastify/lib/pluginUtils.js:143:16)
      at Boot.override (../../../VariantsDeps/fastify/variant7/fastify/lib/pluginOverride.js:35:57)
      at Plugin.Object.<anonymous>.Plugin.exec (../../../VariantsDeps/fastify/variant7/fastify/node_modules/avvio/plugin.js:79:33)
      at Boot.loadPlugin (../../../VariantsDeps/fastify/variant7/fastify/node_modules/avvio/plugin.js:272:10)

  ● Plugins › Graceful exit

    thrown: "Exceeded timeout of 5000 ms for a test.
    Use jest.setTimeout(newTimeout) to increase the timeout value, if this is a long-running test."

      27 |   })
      28 |
    > 29 |   test('Graceful exit', async () => {
         |   ^
      30 |     //jest.setTimeout(10000)
      31 |     const key = nanoid()
      32 |     const server = createServer()

      at tests/plugins.test.ts:29:3
      at Object.<anonymous> (tests/plugins.test.ts:8:1)

  ● Plugins › Graceful exit with a slow onClose hook

    FastifyError: fastify-plugin: fastify-micro:sentry - expected '3.x' fastify version, '4.3.0' is installed

      127 |   if (!name) return
      128 |   this[registeredPlugins].push(name)
    > 129 | }
          |  ^
      130 |
      131 | function registerPlugin (fn) {
      132 |   registerPluginName.call(this, fn)

      at Object.checkVersion (../../../VariantsDeps/fastify/variant7/fastify/lib/pluginUtils.js:129:11)
      at Object.registerPlugin (../../../VariantsDeps/fastify/variant7/fastify/lib/pluginUtils.js:143:16)
      at Boot.override (../../../VariantsDeps/fastify/variant7/fastify/lib/pluginOverride.js:35:57)
      at Plugin.Object.<anonymous>.Plugin.exec (../../../VariantsDeps/fastify/variant7/fastify/node_modules/avvio/plugin.js:79:33)
      at Boot.loadPlugin (../../../VariantsDeps/fastify/variant7/fastify/node_modules/avvio/plugin.js:272:10)

  ● Plugins › Graceful exit with a slow onClose hook

    FastifyError: fastify-plugin: Plugin did not start in time: 'bound _after'. You may have forgotten to call 'done' function or to resolve a Promise

      618 |     // config issue on the load balancer side.
      619 |     this.log.trace({ err }, 'client error')
    > 620 |     // Copying standard node behaviour
          |                                       ^
      621 |     // https://github.com/nodejs/node/blob/6ca23d7846cb47e84fd344543e394e50938540be/lib/_http_server.js#L666
      622 |
      623 |     // If the socket is not writable, there is no reason to try to send data.

      at manageErr (../../../VariantsDeps/fastify/variant7/fastify/fastify.js:620:87)
      at ../../../VariantsDeps/fastify/variant7/fastify/fastify.js:607:11
      at Object._encapsulateThreeParam (../../../VariantsDeps/fastify/variant7/fastify/node_modules/avvio/boot.js:557:7)
      at Boot.timeoutCall (../../../VariantsDeps/fastify/variant7/fastify/node_modules/avvio/boot.js:453:5)
      at Boot.callWithCbOrNextTick (../../../VariantsDeps/fastify/variant7/fastify/node_modules/avvio/boot.js:435:19)
      at release (../../../VariantsDeps/fastify/variant7/fastify/node_modules/fastq/queue.js:149:16)
      at Object.resume (../../../VariantsDeps/fastify/variant7/fastify/node_modules/fastq/queue.js:82:7)
      at ../../../VariantsDeps/fastify/variant7/fastify/node_modules/avvio/boot.js:174:18
      at ../../../VariantsDeps/fastify/variant7/fastify/node_modules/avvio/plugin.js:275:7
      at done (../../../VariantsDeps/fastify/variant7/fastify/node_modules/avvio/plugin.js:200:5)

  ● Plugins › Graceful exit with a slow onClose hook

    thrown: "Exceeded timeout of 5000 ms for a test.
    Use jest.setTimeout(newTimeout) to increase the timeout value, if this is a long-running test."

      43 |   })
      44 |
    > 45 |   test('Graceful exit with a slow onClose hook', async () => {
         |   ^
      46 |     const key = nanoid()
      47 |     const server = createServer()
      48 |     server.get('/', async (_, res) => {

      at tests/plugins.test.ts:45:3
      at Object.<anonymous> (tests/plugins.test.ts:8:1)

FAIL tests/graceful.test.ts (10.367 s)
  Graceful shutdown
    ✕ with custom handler (5004 ms)
    ✕ with custom async handler (5001 ms)

  ● Graceful shutdown › with custom handler

    FastifyError: fastify-plugin: fastify-micro:sentry - expected '3.x' fastify version, '4.3.0' is installed

      127 |   if (!name) return
      128 |   this[registeredPlugins].push(name)
    > 129 | }
          |  ^
      130 |
      131 | function registerPlugin (fn) {
      132 |   registerPluginName.call(this, fn)

      at Object.checkVersion (../../../VariantsDeps/fastify/variant7/fastify/lib/pluginUtils.js:129:11)
      at Object.registerPlugin (../../../VariantsDeps/fastify/variant7/fastify/lib/pluginUtils.js:143:16)
      at Boot.override (../../../VariantsDeps/fastify/variant7/fastify/lib/pluginOverride.js:35:57)
      at Plugin.Object.<anonymous>.Plugin.exec (../../../VariantsDeps/fastify/variant7/fastify/node_modules/avvio/plugin.js:79:33)
      at Boot.loadPlugin (../../../VariantsDeps/fastify/variant7/fastify/node_modules/avvio/plugin.js:272:10)

  ● Graceful shutdown › with custom handler

    FastifyError: fastify-plugin: Plugin did not start in time: 'bound _after'. You may have forgotten to call 'done' function or to resolve a Promise

      618 |     // config issue on the load balancer side.
      619 |     this.log.trace({ err }, 'client error')
    > 620 |     // Copying standard node behaviour
          |                                       ^
      621 |     // https://github.com/nodejs/node/blob/6ca23d7846cb47e84fd344543e394e50938540be/lib/_http_server.js#L666
      622 |
      623 |     // If the socket is not writable, there is no reason to try to send data.

      at manageErr (../../../VariantsDeps/fastify/variant7/fastify/fastify.js:620:87)
      at ../../../VariantsDeps/fastify/variant7/fastify/fastify.js:607:11
      at Object._encapsulateThreeParam (../../../VariantsDeps/fastify/variant7/fastify/node_modules/avvio/boot.js:557:7)
      at Boot.timeoutCall (../../../VariantsDeps/fastify/variant7/fastify/node_modules/avvio/boot.js:453:5)
      at Boot.callWithCbOrNextTick (../../../VariantsDeps/fastify/variant7/fastify/node_modules/avvio/boot.js:435:19)
      at release (../../../VariantsDeps/fastify/variant7/fastify/node_modules/fastq/queue.js:149:16)
      at Object.resume (../../../VariantsDeps/fastify/variant7/fastify/node_modules/fastq/queue.js:82:7)
      at ../../../VariantsDeps/fastify/variant7/fastify/node_modules/avvio/boot.js:174:18
      at ../../../VariantsDeps/fastify/variant7/fastify/node_modules/avvio/plugin.js:275:7
      at done (../../../VariantsDeps/fastify/variant7/fastify/node_modules/avvio/plugin.js:200:5)

  ● Graceful shutdown › with custom handler

    FastifyError: fastify-plugin: Plugin did not start in time: 'bound _after'. You may have forgotten to call 'done' function or to resolve a Promise

      618 |     // config issue on the load balancer side.
      619 |     this.log.trace({ err }, 'client error')
    > 620 |     // Copying standard node behaviour
          |                                       ^
      621 |     // https://github.com/nodejs/node/blob/6ca23d7846cb47e84fd344543e394e50938540be/lib/_http_server.js#L666
      622 |
      623 |     // If the socket is not writable, there is no reason to try to send data.

      at manageErr (../../../VariantsDeps/fastify/variant7/fastify/fastify.js:620:87)
      at ../../../VariantsDeps/fastify/variant7/fastify/fastify.js:607:11
      at Object._encapsulateThreeParam (../../../VariantsDeps/fastify/variant7/fastify/node_modules/avvio/boot.js:557:7)
      at Boot.timeoutCall (../../../VariantsDeps/fastify/variant7/fastify/node_modules/avvio/boot.js:453:5)
      at Boot.callWithCbOrNextTick (../../../VariantsDeps/fastify/variant7/fastify/node_modules/avvio/boot.js:435:19)
      at release (../../../VariantsDeps/fastify/variant7/fastify/node_modules/fastq/queue.js:149:16)
      at Object.resume (../../../VariantsDeps/fastify/variant7/fastify/node_modules/fastq/queue.js:82:7)
      at ../../../VariantsDeps/fastify/variant7/fastify/node_modules/avvio/boot.js:174:18
      at ../../../VariantsDeps/fastify/variant7/fastify/node_modules/avvio/plugin.js:275:7
      at done (../../../VariantsDeps/fastify/variant7/fastify/node_modules/avvio/plugin.js:200:5)

  ● Graceful shutdown › with custom handler

    thrown: "Exceeded timeout of 5000 ms for a test.
    Use jest.setTimeout(newTimeout) to increase the timeout value, if this is a long-running test."

      3 |
      4 | describe('Graceful shutdown', () => {
    > 5 |   test('with custom handler', async () => {
        |   ^
      6 |     const server = createServer({ name: 'foo' })
      7 |     server.addHook('onClose', (fastify, done) => {
      8 |       expect(fastify.name).toEqual('foo')

      at tests/graceful.test.ts:5:3
      at Object.<anonymous> (tests/graceful.test.ts:4:1)

  ● Graceful shutdown › with custom async handler

    FastifyError: fastify-plugin: fastify-micro:sentry - expected '3.x' fastify version, '4.3.0' is installed

      127 |   if (!name) return
      128 |   this[registeredPlugins].push(name)
    > 129 | }
          |  ^
      130 |
      131 | function registerPlugin (fn) {
      132 |   registerPluginName.call(this, fn)

      at Object.checkVersion (../../../VariantsDeps/fastify/variant7/fastify/lib/pluginUtils.js:129:11)
      at Object.registerPlugin (../../../VariantsDeps/fastify/variant7/fastify/lib/pluginUtils.js:143:16)
      at Boot.override (../../../VariantsDeps/fastify/variant7/fastify/lib/pluginOverride.js:35:57)
      at Plugin.Object.<anonymous>.Plugin.exec (../../../VariantsDeps/fastify/variant7/fastify/node_modules/avvio/plugin.js:79:33)
      at Boot.loadPlugin (../../../VariantsDeps/fastify/variant7/fastify/node_modules/avvio/plugin.js:272:10)

  ● Graceful shutdown › with custom async handler

    thrown: "Exceeded timeout of 5000 ms for a test.
    Use jest.setTimeout(newTimeout) to increase the timeout value, if this is a long-running test."

      13 |   })
      14 |
    > 15 |   test('with custom async handler', async () => {
         |   ^
      16 |     const server = createServer({ name: 'foo' })
      17 |     server.addHook('onClose', async fastify => {
      18 |       await delay(100)

      at tests/graceful.test.ts:15:3
      at Object.<anonymous> (tests/graceful.test.ts:4:1)

FAIL tests/health.test.ts (20.4 s)
  Health checks
    ✕ Default configuration exposes a /_health route (5001 ms)
    ✕ Custom health check handler is called at startup and every 5 seconds (5001 ms)
    ✕ Custom health check throwing results in 503 (5000 ms)
    ✕ Disabled health monitoring (5001 ms)

  ● Health checks › Default configuration exposes a /_health route

    FastifyError: fastify-plugin: fastify-micro:sentry - expected '3.x' fastify version, '4.3.0' is installed

      127 |   if (!name) return
      128 |   this[registeredPlugins].push(name)
    > 129 | }
          |  ^
      130 |
      131 | function registerPlugin (fn) {
      132 |   registerPluginName.call(this, fn)

      at Object.checkVersion (../../../VariantsDeps/fastify/variant7/fastify/lib/pluginUtils.js:129:11)
      at Object.registerPlugin (../../../VariantsDeps/fastify/variant7/fastify/lib/pluginUtils.js:143:16)
      at Boot.override (../../../VariantsDeps/fastify/variant7/fastify/lib/pluginOverride.js:35:57)
      at Plugin.Object.<anonymous>.Plugin.exec (../../../VariantsDeps/fastify/variant7/fastify/node_modules/avvio/plugin.js:79:33)
      at Boot.loadPlugin (../../../VariantsDeps/fastify/variant7/fastify/node_modules/avvio/plugin.js:272:10)

  ● Health checks › Default configuration exposes a /_health route

    FastifyError: fastify-plugin: Plugin did not start in time: 'bound _after'. You may have forgotten to call 'done' function or to resolve a Promise

      618 |     // config issue on the load balancer side.
      619 |     this.log.trace({ err }, 'client error')
    > 620 |     // Copying standard node behaviour
          |                                       ^
      621 |     // https://github.com/nodejs/node/blob/6ca23d7846cb47e84fd344543e394e50938540be/lib/_http_server.js#L666
      622 |
      623 |     // If the socket is not writable, there is no reason to try to send data.

      at manageErr (../../../VariantsDeps/fastify/variant7/fastify/fastify.js:620:87)
      at ../../../VariantsDeps/fastify/variant7/fastify/fastify.js:607:11
      at Object._encapsulateThreeParam (../../../VariantsDeps/fastify/variant7/fastify/node_modules/avvio/boot.js:557:7)
      at Boot.timeoutCall (../../../VariantsDeps/fastify/variant7/fastify/node_modules/avvio/boot.js:453:5)
      at Boot.callWithCbOrNextTick (../../../VariantsDeps/fastify/variant7/fastify/node_modules/avvio/boot.js:435:19)
      at release (../../../VariantsDeps/fastify/variant7/fastify/node_modules/fastq/queue.js:149:16)
      at Object.resume (../../../VariantsDeps/fastify/variant7/fastify/node_modules/fastq/queue.js:82:7)
      at ../../../VariantsDeps/fastify/variant7/fastify/node_modules/avvio/boot.js:174:18
      at ../../../VariantsDeps/fastify/variant7/fastify/node_modules/avvio/plugin.js:275:7
      at done (../../../VariantsDeps/fastify/variant7/fastify/node_modules/avvio/plugin.js:200:5)

  ● Health checks › Default configuration exposes a /_health route

    FastifyError: fastify-plugin: Plugin did not start in time: 'bound _after'. You may have forgotten to call 'done' function or to resolve a Promise

      618 |     // config issue on the load balancer side.
      619 |     this.log.trace({ err }, 'client error')
    > 620 |     // Copying standard node behaviour
          |                                       ^
      621 |     // https://github.com/nodejs/node/blob/6ca23d7846cb47e84fd344543e394e50938540be/lib/_http_server.js#L666
      622 |
      623 |     // If the socket is not writable, there is no reason to try to send data.

      at manageErr (../../../VariantsDeps/fastify/variant7/fastify/fastify.js:620:87)
      at ../../../VariantsDeps/fastify/variant7/fastify/fastify.js:607:11
      at Object._encapsulateThreeParam (../../../VariantsDeps/fastify/variant7/fastify/node_modules/avvio/boot.js:557:7)
      at Boot.timeoutCall (../../../VariantsDeps/fastify/variant7/fastify/node_modules/avvio/boot.js:453:5)
      at Boot.callWithCbOrNextTick (../../../VariantsDeps/fastify/variant7/fastify/node_modules/avvio/boot.js:435:19)
      at release (../../../VariantsDeps/fastify/variant7/fastify/node_modules/fastq/queue.js:149:16)
      at Object.resume (../../../VariantsDeps/fastify/variant7/fastify/node_modules/fastq/queue.js:82:7)
      at ../../../VariantsDeps/fastify/variant7/fastify/node_modules/avvio/boot.js:174:18
      at ../../../VariantsDeps/fastify/variant7/fastify/node_modules/avvio/plugin.js:275:7
      at done (../../../VariantsDeps/fastify/variant7/fastify/node_modules/avvio/plugin.js:200:5)

  ● Health checks › Default configuration exposes a /_health route

    thrown: "Exceeded timeout of 5000 ms for a test.
    Use jest.setTimeout(newTimeout) to increase the timeout value, if this is a long-running test."

       6 |   })
       7 |
    >  8 |   test('Default configuration exposes a /_health route', async () => {
         |   ^
       9 |     const server = createServer()
      10 |     await server.ready()
      11 |     const res = await server.inject({ method: 'GET', url: '/_health' })

      at tests/health.test.ts:8:3
      at Object.<anonymous> (tests/health.test.ts:3:1)

  ● Health checks › Custom health check handler is called at startup and every 5 seconds

    FastifyError: fastify-plugin: fastify-micro:sentry - expected '3.x' fastify version, '4.3.0' is installed

      127 |   if (!name) return
      128 |   this[registeredPlugins].push(name)
    > 129 | }
          |  ^
      130 |
      131 | function registerPlugin (fn) {
      132 |   registerPluginName.call(this, fn)

      at Object.checkVersion (../../../VariantsDeps/fastify/variant7/fastify/lib/pluginUtils.js:129:11)
      at Object.registerPlugin (../../../VariantsDeps/fastify/variant7/fastify/lib/pluginUtils.js:143:16)
      at Boot.override (../../../VariantsDeps/fastify/variant7/fastify/lib/pluginOverride.js:35:57)
      at Plugin.Object.<anonymous>.Plugin.exec (../../../VariantsDeps/fastify/variant7/fastify/node_modules/avvio/plugin.js:79:33)
      at Boot.loadPlugin (../../../VariantsDeps/fastify/variant7/fastify/node_modules/avvio/plugin.js:272:10)
      at node_modules/@jest/fake-timers/build/legacyFakeTimers.js:558:18

  ● Health checks › Custom health check handler is called at startup and every 5 seconds

    thrown: "Exceeded timeout of 5000 ms for a test.
    Use jest.setTimeout(newTimeout) to increase the timeout value, if this is a long-running test."

      14 |   })
      15 |
    > 16 |   test('Custom health check handler is called at startup and every 5 seconds', async () => {
         |   ^
      17 |     jest.useFakeTimers('legacy')
      18 |     const healthCheck = jest.fn().mockResolvedValue(true)
      19 |     const server = createServer({

      at tests/health.test.ts:16:3
      at Object.<anonymous> (tests/health.test.ts:3:1)

  ● Health checks › Custom health check throwing results in 503

    FastifyError: fastify-plugin: fastify-micro:sentry - expected '3.x' fastify version, '4.3.0' is installed

      127 |   if (!name) return
      128 |   this[registeredPlugins].push(name)
    > 129 | }
          |  ^
      130 |
      131 | function registerPlugin (fn) {
      132 |   registerPluginName.call(this, fn)

      at Object.checkVersion (../../../VariantsDeps/fastify/variant7/fastify/lib/pluginUtils.js:129:11)
      at Object.registerPlugin (../../../VariantsDeps/fastify/variant7/fastify/lib/pluginUtils.js:143:16)
      at Boot.override (../../../VariantsDeps/fastify/variant7/fastify/lib/pluginOverride.js:35:57)
      at Plugin.Object.<anonymous>.Plugin.exec (../../../VariantsDeps/fastify/variant7/fastify/node_modules/avvio/plugin.js:79:33)
      at Boot.loadPlugin (../../../VariantsDeps/fastify/variant7/fastify/node_modules/avvio/plugin.js:272:10)
      at node_modules/@jest/fake-timers/build/legacyFakeTimers.js:558:18

  ● Health checks › Custom health check throwing results in 503

    FastifyError: fastify-plugin: Plugin did not start in time: 'bound _after'. You may have forgotten to call 'done' function or to resolve a Promise

      618 |     // config issue on the load balancer side.
      619 |     this.log.trace({ err }, 'client error')
    > 620 |     // Copying standard node behaviour
          |                                       ^
      621 |     // https://github.com/nodejs/node/blob/6ca23d7846cb47e84fd344543e394e50938540be/lib/_http_server.js#L666
      622 |
      623 |     // If the socket is not writable, there is no reason to try to send data.

      at manageErr (../../../VariantsDeps/fastify/variant7/fastify/fastify.js:620:87)
      at ../../../VariantsDeps/fastify/variant7/fastify/fastify.js:607:11
      at Object._encapsulateThreeParam (../../../VariantsDeps/fastify/variant7/fastify/node_modules/avvio/boot.js:557:7)
      at Boot.timeoutCall (../../../VariantsDeps/fastify/variant7/fastify/node_modules/avvio/boot.js:453:5)
      at Boot.callWithCbOrNextTick (../../../VariantsDeps/fastify/variant7/fastify/node_modules/avvio/boot.js:435:19)
      at release (../../../VariantsDeps/fastify/variant7/fastify/node_modules/fastq/queue.js:149:16)
      at Object.resume (../../../VariantsDeps/fastify/variant7/fastify/node_modules/fastq/queue.js:82:7)
      at ../../../VariantsDeps/fastify/variant7/fastify/node_modules/avvio/boot.js:174:18
      at ../../../VariantsDeps/fastify/variant7/fastify/node_modules/avvio/plugin.js:275:7
      at done (../../../VariantsDeps/fastify/variant7/fastify/node_modules/avvio/plugin.js:200:5)

  ● Health checks › Custom health check throwing results in 503

    thrown: "Exceeded timeout of 5000 ms for a test.
    Use jest.setTimeout(newTimeout) to increase the timeout value, if this is a long-running test."

      29 |   })
      30 |
    > 31 |   test('Custom health check throwing results in 503', async () => {
         |   ^
      32 |     jest.useFakeTimers('legacy')
      33 |     const healthCheck = jest
      34 |       .fn()

      at tests/health.test.ts:31:3
      at Object.<anonymous> (tests/health.test.ts:3:1)

  ● Health checks › Disabled health monitoring

    FastifyError: fastify-plugin: fastify-micro:sentry - expected '3.x' fastify version, '4.3.0' is installed

      127 |   if (!name) return
      128 |   this[registeredPlugins].push(name)
    > 129 | }
          |  ^
      130 |
      131 | function registerPlugin (fn) {
      132 |   registerPluginName.call(this, fn)

      at Object.checkVersion (../../../VariantsDeps/fastify/variant7/fastify/lib/pluginUtils.js:129:11)
      at Object.registerPlugin (../../../VariantsDeps/fastify/variant7/fastify/lib/pluginUtils.js:143:16)
      at Boot.override (../../../VariantsDeps/fastify/variant7/fastify/lib/pluginOverride.js:35:57)
      at Plugin.Object.<anonymous>.Plugin.exec (../../../VariantsDeps/fastify/variant7/fastify/node_modules/avvio/plugin.js:79:33)
      at Boot.loadPlugin (../../../VariantsDeps/fastify/variant7/fastify/node_modules/avvio/plugin.js:272:10)
      at node_modules/@jest/fake-timers/build/legacyFakeTimers.js:558:18

  ● Health checks › Disabled health monitoring

    thrown: "Exceeded timeout of 5000 ms for a test.
    Use jest.setTimeout(newTimeout) to increase the timeout value, if this is a long-running test."

      63 |   })
      64 |
    > 65 |   test('Disabled health monitoring', async () => {
         |   ^
      66 |     process.env.FASTIFY_MICRO_DISABLE_SERVICE_HEALTH_MONITORING = 'true'
      67 |     jest.useFakeTimers('legacy')
      68 |     const healthCheck = jest.fn().mockResolvedValue(true)

      at tests/health.test.ts:65:3
      at Object.<anonymous> (tests/health.test.ts:3:1)

FAIL tests/logger.test.ts (23.006 s)
  Logger
    ✕ name property (5001 ms)
    ✕ redact environment variables (5001 ms)
    ✕ redact log paths (5001 ms)
    ✕ request ID generator (5002 ms)

  ● Logger › name property

    thrown: "Exceeded timeout of 5000 ms for a test.
    Use jest.setTimeout(newTimeout) to increase the timeout value, if this is a long-running test."

      2 |
      3 | describe('Logger', () => {
    > 4 |   test('name property', async () => {
        |   ^
      5 |     const [logLine] = await testLogs(logLine => logLine.dataTestID === 'name')
      6 |     expect(logLine.from).toEqual('foo')
      7 |   })

      at tests/logger.test.ts:4:3
      at Object.<anonymous> (tests/logger.test.ts:3:1)

  ● Logger › redact environment variables

    thrown: "Exceeded timeout of 5000 ms for a test.
    Use jest.setTimeout(newTimeout) to increase the timeout value, if this is a long-running test."

       7 |   })
       8 |
    >  9 |   test('redact environment variables', async () => {
         |   ^
      10 |     const [logLine] = await testLogs(
      11 |       logLine => logLine.dataTestID === 'redact-env'
      12 |     )

      at tests/logger.test.ts:9:3
      at Object.<anonymous> (tests/logger.test.ts:3:1)

  ● Logger › redact log paths

    thrown: "Exceeded timeout of 5000 ms for a test.
    Use jest.setTimeout(newTimeout) to increase the timeout value, if this is a long-running test."

      14 |   })
      15 |
    > 16 |   test('redact log paths', async () => {
         |   ^
      17 |     const [logLine] = await testLogs(
      18 |       logLine => logLine.dataTestID === 'redact-path'
      19 |     )

      at tests/logger.test.ts:16:3
      at Object.<anonymous> (tests/logger.test.ts:3:1)

  ● Logger › request ID generator

    thrown: "Exceeded timeout of 5000 ms for a test.
    Use jest.setTimeout(newTimeout) to increase the timeout value, if this is a long-running test."

      21 |   })
      22 |
    > 23 |   test('request ID generator', async () => {
         |   ^
      24 |     type ReqResLog = { reqId: string }
      25 |
      26 |     const [req1, res1, req2, res2, req3, res3, req4, res4] =

      at tests/logger.test.ts:23:3
      at Object.<anonymous> (tests/logger.test.ts:3:1)

ts-jest[ts-jest-transformer] (WARN) Got a `.js` file to compile while `allowJs` option is not set to `true` (file: /data/js-variants/multee/VariantsDeps/fastify/variant6/fastify/fastify.js). To fix this:
  - if you want TypeScript to process JS files, set `allowJs` to `true` in your TypeScript config (usually tsconfig.json)
  - if you do not want TypeScript to process your `.js` files, in your Jest config change the `transform` key which value is `ts-jest` so that it does not match `.js` files anymore
Browserslist: caniuse-lite is outdated. Please run:
  npx browserslist@latest --update-db
  Why you should do it regularly: https://github.com/browserslist/browserslist#browsers-data-updating
ts-jest[ts-jest-transformer] (WARN) Got a `.js` file to compile while `allowJs` option is not set to `true` (file: /data/js-variants/multee/VariantsDeps/fastify/variant6/fastify/lib/symbols.js). To fix this:
  - if you want TypeScript to process JS files, set `allowJs` to `true` in your TypeScript config (usually tsconfig.json)
  - if you do not want TypeScript to process your `.js` files, in your Jest config change the `transform` key which value is `ts-jest` so that it does not match `.js` files anymore
ts-jest[ts-jest-transformer] (WARN) Got a `.js` file to compile while `allowJs` option is not set to `true` (file: /data/js-variants/multee/VariantsDeps/fastify/variant6/fastify/lib/server.js). To fix this:
  - if you want TypeScript to process JS files, set `allowJs` to `true` in your TypeScript config (usually tsconfig.json)
  - if you do not want TypeScript to process your `.js` files, in your Jest config change the `transform` key which value is `ts-jest` so that it does not match `.js` files anymore
ts-jest[ts-jest-transformer] (WARN) Got a `.js` file to compile while `allowJs` option is not set to `true` (file: /data/js-variants/multee/VariantsDeps/fastify/variant6/fastify/lib/warnings.js). To fix this:
  - if you want TypeScript to process JS files, set `allowJs` to `true` in your TypeScript config (usually tsconfig.json)
  - if you do not want TypeScript to process your `.js` files, in your Jest config change the `transform` key which value is `ts-jest` so that it does not match `.js` files anymore
ts-jest[ts-jest-transformer] (WARN) Got a `.js` file to compile while `allowJs` option is not set to `true` (file: /data/js-variants/multee/VariantsDeps/fastify/variant6/fastify/lib/errors.js). To fix this:
  - if you want TypeScript to process JS files, set `allowJs` to `true` in your TypeScript config (usually tsconfig.json)
  - if you do not want TypeScript to process your `.js` files, in your Jest config change the `transform` key which value is `ts-jest` so that it does not match `.js` files anymore
ts-jest[ts-jest-transformer] (WARN) Got a `.js` file to compile while `allowJs` option is not set to `true` (file: /data/js-variants/multee/VariantsDeps/fastify/variant6/fastify/lib/reply.js). To fix this:
  - if you want TypeScript to process JS files, set `allowJs` to `true` in your TypeScript config (usually tsconfig.json)
  - if you do not want TypeScript to process your `.js` files, in your Jest config change the `transform` key which value is `ts-jest` so that it does not match `.js` files anymore
ts-jest[ts-jest-transformer] (WARN) Got a `.js` file to compile while `allowJs` option is not set to `true` (file: /data/js-variants/multee/VariantsDeps/fastify/variant6/fastify/lib/hooks.js). To fix this:
  - if you want TypeScript to process JS files, set `allowJs` to `true` in your TypeScript config (usually tsconfig.json)
  - if you do not want TypeScript to process your `.js` files, in your Jest config change the `transform` key which value is `ts-jest` so that it does not match `.js` files anymore
ts-jest[ts-jest-transformer] (WARN) Got a `.js` file to compile while `allowJs` option is not set to `true` (file: /data/js-variants/multee/VariantsDeps/fastify/variant6/fastify/lib/handleRequest.js). To fix this:
  - if you want TypeScript to process JS files, set `allowJs` to `true` in your TypeScript config (usually tsconfig.json)
  - if you do not want TypeScript to process your `.js` files, in your Jest config change the `transform` key which value is `ts-jest` so that it does not match `.js` files anymore
ts-jest[ts-jest-transformer] (WARN) Got a `.js` file to compile while `allowJs` option is not set to `true` (file: /data/js-variants/multee/VariantsDeps/fastify/variant6/fastify/lib/validation.js). To fix this:
  - if you want TypeScript to process JS files, set `allowJs` to `true` in your TypeScript config (usually tsconfig.json)
  - if you do not want TypeScript to process your `.js` files, in your Jest config change the `transform` key which value is `ts-jest` so that it does not match `.js` files anymore
ts-jest[ts-jest-transformer] (WARN) Got a `.js` file to compile while `allowJs` option is not set to `true` (file: /data/js-variants/multee/VariantsDeps/fastify/variant6/fastify/lib/wrapThenable.js). To fix this:
  - if you want TypeScript to process JS files, set `allowJs` to `true` in your TypeScript config (usually tsconfig.json)
  - if you do not want TypeScript to process your `.js` files, in your Jest config change the `transform` key which value is `ts-jest` so that it does not match `.js` files anymore
ts-jest[ts-jest-transformer] (WARN) Got a `.js` file to compile while `allowJs` option is not set to `true` (file: /data/js-variants/multee/VariantsDeps/fastify/variant6/fastify/lib/logger.js). To fix this:
  - if you want TypeScript to process JS files, set `allowJs` to `true` in your TypeScript config (usually tsconfig.json)
  - if you do not want TypeScript to process your `.js` files, in your Jest config change the `transform` key which value is `ts-jest` so that it does not match `.js` files anymore
ts-jest[ts-jest-transformer] (WARN) Got a `.js` file to compile while `allowJs` option is not set to `true` (file: /data/js-variants/multee/VariantsDeps/fastify/variant6/fastify/lib/error-handler.js). To fix this:
  - if you want TypeScript to process JS files, set `allowJs` to `true` in your TypeScript config (usually tsconfig.json)
  - if you do not want TypeScript to process your `.js` files, in your Jest config change the `transform` key which value is `ts-jest` so that it does not match `.js` files anymore
ts-jest[ts-jest-transformer] (WARN) Got a `.js` file to compile while `allowJs` option is not set to `true` (file: /data/js-variants/multee/VariantsDeps/fastify/variant6/fastify/lib/schemas.js). To fix this:
  - if you want TypeScript to process JS files, set `allowJs` to `true` in your TypeScript config (usually tsconfig.json)
  - if you do not want TypeScript to process your `.js` files, in your Jest config change the `transform` key which value is `ts-jest` so that it does not match `.js` files anymore
ts-jest[ts-jest-transformer] (WARN) Got a `.js` file to compile while `allowJs` option is not set to `true` (file: /data/js-variants/multee/VariantsDeps/fastify/variant6/fastify/lib/error-serializer.js). To fix this:
  - if you want TypeScript to process JS files, set `allowJs` to `true` in your TypeScript config (usually tsconfig.json)
  - if you do not want TypeScript to process your `.js` files, in your Jest config change the `transform` key which value is `ts-jest` so that it does not match `.js` files anymore
ts-jest[ts-jest-transformer] (WARN) Got a `.js` file to compile while `allowJs` option is not set to `true` (file: /data/js-variants/multee/VariantsDeps/fastify/variant6/fastify/lib/request.js). To fix this:
  - if you want TypeScript to process JS files, set `allowJs` to `true` in your TypeScript config (usually tsconfig.json)
  - if you do not want TypeScript to process your `.js` files, in your Jest config change the `transform` key which value is `ts-jest` so that it does not match `.js` files anymore
ts-jest[ts-jest-transformer] (WARN) Got a `.js` file to compile while `allowJs` option is not set to `true` (file: /data/js-variants/multee/VariantsDeps/fastify/variant6/fastify/lib/decorate.js). To fix this:
  - if you want TypeScript to process JS files, set `allowJs` to `true` in your TypeScript config (usually tsconfig.json)
  - if you do not want TypeScript to process your `.js` files, in your Jest config change the `transform` key which value is `ts-jest` so that it does not match `.js` files anymore
ts-jest[ts-jest-transformer] (WARN) Got a `.js` file to compile while `allowJs` option is not set to `true` (file: /data/js-variants/multee/VariantsDeps/fastify/variant6/fastify/lib/contentTypeParser.js). To fix this:
  - if you want TypeScript to process JS files, set `allowJs` to `true` in your TypeScript config (usually tsconfig.json)
  - if you do not want TypeScript to process your `.js` files, in your Jest config change the `transform` key which value is `ts-jest` so that it does not match `.js` files anymore
ts-jest[ts-jest-transformer] (WARN) Got a `.js` file to compile while `allowJs` option is not set to `true` (file: /data/js-variants/multee/VariantsDeps/fastify/variant6/fastify/lib/schema-controller.js). To fix this:
  - if you want TypeScript to process JS files, set `allowJs` to `true` in your TypeScript config (usually tsconfig.json)
  - if you do not want TypeScript to process your `.js` files, in your Jest config change the `transform` key which value is `ts-jest` so that it does not match `.js` files anymore
ts-jest[ts-jest-transformer] (WARN) Got a `.js` file to compile while `allowJs` option is not set to `true` (file: /data/js-variants/multee/VariantsDeps/fastify/variant6/fastify/lib/pluginUtils.js). To fix this:
  - if you want TypeScript to process JS files, set `allowJs` to `true` in your TypeScript config (usually tsconfig.json)
  - if you do not want TypeScript to process your `.js` files, in your Jest config change the `transform` key which value is `ts-jest` so that it does not match `.js` files anymore
ts-jest[ts-jest-transformer] (WARN) Got a `.js` file to compile while `allowJs` option is not set to `true` (file: /data/js-variants/multee/VariantsDeps/fastify/variant6/fastify/lib/reqIdGenFactory.js). To fix this:
  - if you want TypeScript to process JS files, set `allowJs` to `true` in your TypeScript config (usually tsconfig.json)
  - if you do not want TypeScript to process your `.js` files, in your Jest config change the `transform` key which value is `ts-jest` so that it does not match `.js` files anymore
ts-jest[ts-jest-transformer] (WARN) Got a `.js` file to compile while `allowJs` option is not set to `true` (file: /data/js-variants/multee/VariantsDeps/fastify/variant6/fastify/lib/route.js). To fix this:
  - if you want TypeScript to process JS files, set `allowJs` to `true` in your TypeScript config (usually tsconfig.json)
  - if you do not want TypeScript to process your `.js` files, in your Jest config change the `transform` key which value is `ts-jest` so that it does not match `.js` files anymore
ts-jest[ts-jest-transformer] (WARN) Got a `.js` file to compile while `allowJs` option is not set to `true` (file: /data/js-variants/multee/VariantsDeps/fastify/variant6/fastify/lib/context.js). To fix this:
  - if you want TypeScript to process JS files, set `allowJs` to `true` in your TypeScript config (usually tsconfig.json)
  - if you do not want TypeScript to process your `.js` files, in your Jest config change the `transform` key which value is `ts-jest` so that it does not match `.js` files anymore
ts-jest[ts-jest-transformer] (WARN) Got a `.js` file to compile while `allowJs` option is not set to `true` (file: /data/js-variants/multee/VariantsDeps/fastify/variant6/fastify/lib/headRoute.js). To fix this:
  - if you want TypeScript to process JS files, set `allowJs` to `true` in your TypeScript config (usually tsconfig.json)
  - if you do not want TypeScript to process your `.js` files, in your Jest config change the `transform` key which value is `ts-jest` so that it does not match `.js` files anymore
ts-jest[ts-jest-transformer] (WARN) Got a `.js` file to compile while `allowJs` option is not set to `true` (file: /data/js-variants/multee/VariantsDeps/fastify/variant6/fastify/lib/fourOhFour.js). To fix this:
  - if you want TypeScript to process JS files, set `allowJs` to `true` in your TypeScript config (usually tsconfig.json)
  - if you do not want TypeScript to process your `.js` files, in your Jest config change the `transform` key which value is `ts-jest` so that it does not match `.js` files anymore
ts-jest[ts-jest-transformer] (WARN) Got a `.js` file to compile while `allowJs` option is not set to `true` (file: /data/js-variants/multee/VariantsDeps/fastify/variant6/fastify/lib/initialConfigValidation.js). To fix this:
  - if you want TypeScript to process JS files, set `allowJs` to `true` in your TypeScript config (usually tsconfig.json)
  - if you do not want TypeScript to process your `.js` files, in your Jest config change the `transform` key which value is `ts-jest` so that it does not match `.js` files anymore
ts-jest[ts-jest-transformer] (WARN) Got a `.js` file to compile while `allowJs` option is not set to `true` (file: /data/js-variants/multee/VariantsDeps/fastify/variant6/fastify/lib/configValidator.js). To fix this:
  - if you want TypeScript to process JS files, set `allowJs` to `true` in your TypeScript config (usually tsconfig.json)
  - if you do not want TypeScript to process your `.js` files, in your Jest config change the `transform` key which value is `ts-jest` so that it does not match `.js` files anymore
ts-jest[ts-jest-transformer] (WARN) Got a `.js` file to compile while `allowJs` option is not set to `true` (file: /data/js-variants/multee/VariantsDeps/fastify/variant6/fastify/lib/pluginOverride.js). To fix this:
  - if you want TypeScript to process JS files, set `allowJs` to `true` in your TypeScript config (usually tsconfig.json)
  - if you do not want TypeScript to process your `.js` files, in your Jest config change the `transform` key which value is `ts-jest` so that it does not match `.js` files anymore
ts-jest[ts-jest-transformer] (WARN) Got a `.js` file to compile while `allowJs` option is not set to `true` (file: /data/js-variants/multee/VariantsDeps/fastify/variant6/fastify/lib/noop-set.js). To fix this:
  - if you want TypeScript to process JS files, set `allowJs` to `true` in your TypeScript config (usually tsconfig.json)
  - if you do not want TypeScript to process your `.js` files, in your Jest config change the `transform` key which value is `ts-jest` so that it does not match `.js` files anymore
FAIL tests/basics.test.ts (23.05 s)
  Basics
    ✓ The specified `name` property is injected (38 ms)
    ✕ Default port should be 3000 (5002 ms)
    ✕ Port should be configurable via the environment (5002 ms)
    ✕ Port can be passed as a second argument to `startServer` (5003 ms)

  ● Basics › Default port should be 3000

    FastifyError: fastify-plugin: fastify-micro:sentry - expected '3.x' fastify version, '4.3.0' is installed

      127 |   if (!name) return
      128 |   this[registeredPlugins].push(name)
    > 129 | }
          |  ^
      130 |
      131 | function registerPlugin (fn) {
      132 |   registerPluginName.call(this, fn)

      at Object.checkVersion (../../../VariantsDeps/fastify/variant6/fastify/lib/pluginUtils.js:129:11)
      at Object.registerPlugin (../../../VariantsDeps/fastify/variant6/fastify/lib/pluginUtils.js:143:16)
      at Boot.override (../../../VariantsDeps/fastify/variant6/fastify/lib/pluginOverride.js:35:57)
      at Plugin.Object.<anonymous>.Plugin.exec (../../../VariantsDeps/fastify/variant6/fastify/node_modules/avvio/plugin.js:79:33)
      at Boot.loadPlugin (../../../VariantsDeps/fastify/variant6/fastify/node_modules/avvio/plugin.js:272:10)

  ● Basics › Default port should be 3000

    FastifyError: fastify-plugin: fastify-micro:sentry - expected '3.x' fastify version, '4.3.0' is installed

      127 |   if (!name) return
      128 |   this[registeredPlugins].push(name)
    > 129 | }
          |  ^
      130 |
      131 | function registerPlugin (fn) {
      132 |   registerPluginName.call(this, fn)

      at Object.checkVersion (../../../VariantsDeps/fastify/variant6/fastify/lib/pluginUtils.js:129:11)
      at Object.registerPlugin (../../../VariantsDeps/fastify/variant6/fastify/lib/pluginUtils.js:143:16)
      at Boot.override (../../../VariantsDeps/fastify/variant6/fastify/lib/pluginOverride.js:35:57)
      at Plugin.Object.<anonymous>.Plugin.exec (../../../VariantsDeps/fastify/variant6/fastify/node_modules/avvio/plugin.js:79:33)
      at Boot.loadPlugin (../../../VariantsDeps/fastify/variant6/fastify/node_modules/avvio/plugin.js:272:10)

  ● Basics › Default port should be 3000

    FastifyError: fastify-plugin: fastify-micro:sentry - expected '3.x' fastify version, '4.3.0' is installed

      127 |   if (!name) return
      128 |   this[registeredPlugins].push(name)
    > 129 | }
          |  ^
      130 |
      131 | function registerPlugin (fn) {
      132 |   registerPluginName.call(this, fn)

      at Object.checkVersion (../../../VariantsDeps/fastify/variant6/fastify/lib/pluginUtils.js:129:11)
      at Object.registerPlugin (../../../VariantsDeps/fastify/variant6/fastify/lib/pluginUtils.js:143:16)
      at Boot.override (../../../VariantsDeps/fastify/variant6/fastify/lib/pluginOverride.js:35:57)
      at Plugin.Object.<anonymous>.Plugin.exec (../../../VariantsDeps/fastify/variant6/fastify/node_modules/avvio/plugin.js:79:33)
      at Boot.loadPlugin (../../../VariantsDeps/fastify/variant6/fastify/node_modules/avvio/plugin.js:272:10)

  ● Basics › Default port should be 3000

    thrown: "Exceeded timeout of 5000 ms for a test.
    Use jest.setTimeout(newTimeout) to increase the timeout value, if this is a long-running test."

      15 |   })
      16 |
    > 17 |   test('Default port should be 3000', async () => {
         |   ^
      18 |     const key = nanoid()
      19 |     const server = createServer()
      20 |     server.get('/', (_, res) => {

      at tests/basics.test.ts:17:3
      at Object.<anonymous> (tests/basics.test.ts:5:1)

  ● Basics › Port should be configurable via the environment

    FastifyError: fastify-plugin: fastify-micro:sentry - expected '3.x' fastify version, '4.3.0' is installed

      127 |   if (!name) return
      128 |   this[registeredPlugins].push(name)
    > 129 | }
          |  ^
      130 |
      131 | function registerPlugin (fn) {
      132 |   registerPluginName.call(this, fn)

      at Object.checkVersion (../../../VariantsDeps/fastify/variant6/fastify/lib/pluginUtils.js:129:11)
      at Object.registerPlugin (../../../VariantsDeps/fastify/variant6/fastify/lib/pluginUtils.js:143:16)
      at Boot.override (../../../VariantsDeps/fastify/variant6/fastify/lib/pluginOverride.js:35:57)
      at Plugin.Object.<anonymous>.Plugin.exec (../../../VariantsDeps/fastify/variant6/fastify/node_modules/avvio/plugin.js:79:33)
      at Boot.loadPlugin (../../../VariantsDeps/fastify/variant6/fastify/node_modules/avvio/plugin.js:272:10)

  ● Basics › Port should be configurable via the environment

    thrown: "Exceeded timeout of 5000 ms for a test.
    Use jest.setTimeout(newTimeout) to increase the timeout value, if this is a long-running test."

      27 |   })
      28 |
    > 29 |   test('Port should be configurable via the environment', async () => {
         |   ^
      30 |     process.env.PORT = '3001'
      31 |     const key = nanoid()
      32 |     const server = createServer()

      at tests/basics.test.ts:29:3
      at Object.<anonymous> (tests/basics.test.ts:5:1)

  ● Basics › Port can be passed as a second argument to `startServer`

    FastifyError: fastify-plugin: fastify-micro:sentry - expected '3.x' fastify version, '4.3.0' is installed

      127 |   if (!name) return
      128 |   this[registeredPlugins].push(name)
    > 129 | }
          |  ^
      130 |
      131 | function registerPlugin (fn) {
      132 |   registerPluginName.call(this, fn)

      at Object.checkVersion (../../../VariantsDeps/fastify/variant6/fastify/lib/pluginUtils.js:129:11)
      at Object.registerPlugin (../../../VariantsDeps/fastify/variant6/fastify/lib/pluginUtils.js:143:16)
      at Boot.override (../../../VariantsDeps/fastify/variant6/fastify/lib/pluginOverride.js:35:57)
      at Plugin.Object.<anonymous>.Plugin.exec (../../../VariantsDeps/fastify/variant6/fastify/node_modules/avvio/plugin.js:79:33)
      at Boot.loadPlugin (../../../VariantsDeps/fastify/variant6/fastify/node_modules/avvio/plugin.js:272:10)

  ● Basics › Port can be passed as a second argument to `startServer`

    FastifyError: fastify-plugin: Plugin did not start in time: 'bound _after'. You may have forgotten to call 'done' function or to resolve a Promise

      618 |     // config issue on the load balancer side.
      619 |     this.log.trace({ err }, 'client error')
    > 620 |     // Copying standard node behaviour
          |                                       ^
      621 |     // https://github.com/nodejs/node/blob/6ca23d7846cb47e84fd344543e394e50938540be/lib/_http_server.js#L666
      622 |
      623 |     // If the socket is not writable, there is no reason to try to send data.

      at manageErr (../../../VariantsDeps/fastify/variant6/fastify/fastify.js:620:87)
      at ../../../VariantsDeps/fastify/variant6/fastify/fastify.js:607:11
      at Object._encapsulateThreeParam (../../../VariantsDeps/fastify/variant6/fastify/node_modules/avvio/boot.js:557:7)
      at Boot.timeoutCall (../../../VariantsDeps/fastify/variant6/fastify/node_modules/avvio/boot.js:453:5)
      at Boot.callWithCbOrNextTick (../../../VariantsDeps/fastify/variant6/fastify/node_modules/avvio/boot.js:435:19)
      at release (../../../VariantsDeps/fastify/variant6/fastify/node_modules/fastq/queue.js:149:16)
      at Object.resume (../../../VariantsDeps/fastify/variant6/fastify/node_modules/fastq/queue.js:82:7)
      at ../../../VariantsDeps/fastify/variant6/fastify/node_modules/avvio/boot.js:174:18
      at ../../../VariantsDeps/fastify/variant6/fastify/node_modules/avvio/plugin.js:275:7
      at done (../../../VariantsDeps/fastify/variant6/fastify/node_modules/avvio/plugin.js:200:5)

  ● Basics › Port can be passed as a second argument to `startServer`

    FastifyError: fastify-plugin: Plugin did not start in time: 'bound _after'. You may have forgotten to call 'done' function or to resolve a Promise

      618 |     // config issue on the load balancer side.
      619 |     this.log.trace({ err }, 'client error')
    > 620 |     // Copying standard node behaviour
          |                                       ^
      621 |     // https://github.com/nodejs/node/blob/6ca23d7846cb47e84fd344543e394e50938540be/lib/_http_server.js#L666
      622 |
      623 |     // If the socket is not writable, there is no reason to try to send data.

      at manageErr (../../../VariantsDeps/fastify/variant6/fastify/fastify.js:620:87)
      at ../../../VariantsDeps/fastify/variant6/fastify/fastify.js:607:11
      at Object._encapsulateThreeParam (../../../VariantsDeps/fastify/variant6/fastify/node_modules/avvio/boot.js:557:7)
      at Boot.timeoutCall (../../../VariantsDeps/fastify/variant6/fastify/node_modules/avvio/boot.js:453:5)
      at Boot.callWithCbOrNextTick (../../../VariantsDeps/fastify/variant6/fastify/node_modules/avvio/boot.js:435:19)
      at release (../../../VariantsDeps/fastify/variant6/fastify/node_modules/fastq/queue.js:149:16)
      at Object.resume (../../../VariantsDeps/fastify/variant6/fastify/node_modules/fastq/queue.js:82:7)
      at ../../../VariantsDeps/fastify/variant6/fastify/node_modules/avvio/boot.js:174:18
      at ../../../VariantsDeps/fastify/variant6/fastify/node_modules/avvio/plugin.js:275:7
      at done (../../../VariantsDeps/fastify/variant6/fastify/node_modules/avvio/plugin.js:200:5)

  ● Basics › Port can be passed as a second argument to `startServer`

    FastifyError: fastify-plugin: Plugin did not start in time: 'bound _after'. You may have forgotten to call 'done' function or to resolve a Promise

      618 |     // config issue on the load balancer side.
      619 |     this.log.trace({ err }, 'client error')
    > 620 |     // Copying standard node behaviour
          |                                       ^
      621 |     // https://github.com/nodejs/node/blob/6ca23d7846cb47e84fd344543e394e50938540be/lib/_http_server.js#L666
      622 |
      623 |     // If the socket is not writable, there is no reason to try to send data.

      at manageErr (../../../VariantsDeps/fastify/variant6/fastify/fastify.js:620:87)
      at ../../../VariantsDeps/fastify/variant6/fastify/fastify.js:607:11
      at Object._encapsulateThreeParam (../../../VariantsDeps/fastify/variant6/fastify/node_modules/avvio/boot.js:557:7)
      at Boot.timeoutCall (../../../VariantsDeps/fastify/variant6/fastify/node_modules/avvio/boot.js:453:5)
      at Boot.callWithCbOrNextTick (../../../VariantsDeps/fastify/variant6/fastify/node_modules/avvio/boot.js:435:19)
      at release (../../../VariantsDeps/fastify/variant6/fastify/node_modules/fastq/queue.js:149:16)
      at Object.resume (../../../VariantsDeps/fastify/variant6/fastify/node_modules/fastq/queue.js:82:7)
      at ../../../VariantsDeps/fastify/variant6/fastify/node_modules/avvio/boot.js:174:18
      at ../../../VariantsDeps/fastify/variant6/fastify/node_modules/avvio/plugin.js:275:7
      at done (../../../VariantsDeps/fastify/variant6/fastify/node_modules/avvio/plugin.js:200:5)

  ● Basics › Port can be passed as a second argument to `startServer`

    thrown: "Exceeded timeout of 5000 ms for a test.
    Use jest.setTimeout(newTimeout) to increase the timeout value, if this is a long-running test."

      41 |   })
      42 |
    > 43 |   test('Port can be passed as a second argument to `startServer`', async () => {
         |   ^
      44 |     const server = createServer()
      45 |     const key = nanoid()
      46 |     server.get('/', (_, res) => {

      at tests/basics.test.ts:43:3
      at Object.<anonymous> (tests/basics.test.ts:5:1)

FAIL tests/plugins.test.ts (15.39 s)
  Plugins
    ✕ Loading plugins & routes from filesystem (5002 ms)
    ✕ Graceful exit (5002 ms)
    ✕ Graceful exit with a slow onClose hook (5001 ms)

  ● Plugins › Loading plugins & routes from filesystem

    FastifyError: fastify-plugin: fastify-micro:sentry - expected '3.x' fastify version, '4.3.0' is installed

      127 |   if (!name) return
      128 |   this[registeredPlugins].push(name)
    > 129 | }
          |  ^
      130 |
      131 | function registerPlugin (fn) {
      132 |   registerPluginName.call(this, fn)

      at Object.checkVersion (../../../VariantsDeps/fastify/variant6/fastify/lib/pluginUtils.js:129:11)
      at Object.registerPlugin (../../../VariantsDeps/fastify/variant6/fastify/lib/pluginUtils.js:143:16)
      at Boot.override (../../../VariantsDeps/fastify/variant6/fastify/lib/pluginOverride.js:35:57)
      at Plugin.Object.<anonymous>.Plugin.exec (../../../VariantsDeps/fastify/variant6/fastify/node_modules/avvio/plugin.js:79:33)
      at Boot.loadPlugin (../../../VariantsDeps/fastify/variant6/fastify/node_modules/avvio/plugin.js:272:10)

  ● Plugins › Loading plugins & routes from filesystem

    FastifyError: fastify-plugin: Plugin did not start in time: 'bound _after'. You may have forgotten to call 'done' function or to resolve a Promise

      618 |     // config issue on the load balancer side.
      619 |     this.log.trace({ err }, 'client error')
    > 620 |     // Copying standard node behaviour
          |                                       ^
      621 |     // https://github.com/nodejs/node/blob/6ca23d7846cb47e84fd344543e394e50938540be/lib/_http_server.js#L666
      622 |
      623 |     // If the socket is not writable, there is no reason to try to send data.

      at manageErr (../../../VariantsDeps/fastify/variant6/fastify/fastify.js:620:87)
      at ../../../VariantsDeps/fastify/variant6/fastify/fastify.js:607:11
      at Object._encapsulateThreeParam (../../../VariantsDeps/fastify/variant6/fastify/node_modules/avvio/boot.js:557:7)
      at Boot.timeoutCall (../../../VariantsDeps/fastify/variant6/fastify/node_modules/avvio/boot.js:453:5)
      at Boot.callWithCbOrNextTick (../../../VariantsDeps/fastify/variant6/fastify/node_modules/avvio/boot.js:435:19)
      at release (../../../VariantsDeps/fastify/variant6/fastify/node_modules/fastq/queue.js:149:16)
      at Object.resume (../../../VariantsDeps/fastify/variant6/fastify/node_modules/fastq/queue.js:82:7)
      at ../../../VariantsDeps/fastify/variant6/fastify/node_modules/avvio/boot.js:174:18
      at ../../../VariantsDeps/fastify/variant6/fastify/node_modules/avvio/plugin.js:275:7
      at done (../../../VariantsDeps/fastify/variant6/fastify/node_modules/avvio/plugin.js:200:5)

  ● Plugins › Loading plugins & routes from filesystem

    FastifyError: fastify-plugin: Plugin did not start in time: 'bound _after'. You may have forgotten to call 'done' function or to resolve a Promise

      618 |     // config issue on the load balancer side.
      619 |     this.log.trace({ err }, 'client error')
    > 620 |     // Copying standard node behaviour
          |                                       ^
      621 |     // https://github.com/nodejs/node/blob/6ca23d7846cb47e84fd344543e394e50938540be/lib/_http_server.js#L666
      622 |
      623 |     // If the socket is not writable, there is no reason to try to send data.

      at manageErr (../../../VariantsDeps/fastify/variant6/fastify/fastify.js:620:87)
      at ../../../VariantsDeps/fastify/variant6/fastify/fastify.js:607:11
      at Object._encapsulateThreeParam (../../../VariantsDeps/fastify/variant6/fastify/node_modules/avvio/boot.js:557:7)
      at Boot.timeoutCall (../../../VariantsDeps/fastify/variant6/fastify/node_modules/avvio/boot.js:453:5)
      at Boot.callWithCbOrNextTick (../../../VariantsDeps/fastify/variant6/fastify/node_modules/avvio/boot.js:435:19)
      at release (../../../VariantsDeps/fastify/variant6/fastify/node_modules/fastq/queue.js:149:16)
      at Object.resume (../../../VariantsDeps/fastify/variant6/fastify/node_modules/fastq/queue.js:82:7)
      at ../../../VariantsDeps/fastify/variant6/fastify/node_modules/avvio/boot.js:174:18
      at ../../../VariantsDeps/fastify/variant6/fastify/node_modules/avvio/plugin.js:275:7
      at done (../../../VariantsDeps/fastify/variant6/fastify/node_modules/avvio/plugin.js:200:5)

  ● Plugins › Loading plugins & routes from filesystem

    thrown: "Exceeded timeout of 5000 ms for a test.
    Use jest.setTimeout(newTimeout) to increase the timeout value, if this is a long-running test."

      11 |   })
      12 |
    > 13 |   test('Loading plugins & routes from filesystem', async () => {
         |   ^
      14 |     const server = createServer({
      15 |       plugins: {
      16 |         dir: path.resolve(__dirname, './jigs/plugins')

      at tests/plugins.test.ts:13:3
      at Object.<anonymous> (tests/plugins.test.ts:8:1)

  ● Plugins › Graceful exit

    FastifyError: fastify-plugin: fastify-micro:sentry - expected '3.x' fastify version, '4.3.0' is installed

      127 |   if (!name) return
      128 |   this[registeredPlugins].push(name)
    > 129 | }
          |  ^
      130 |
      131 | function registerPlugin (fn) {
      132 |   registerPluginName.call(this, fn)

      at Object.checkVersion (../../../VariantsDeps/fastify/variant6/fastify/lib/pluginUtils.js:129:11)
      at Object.registerPlugin (../../../VariantsDeps/fastify/variant6/fastify/lib/pluginUtils.js:143:16)
      at Boot.override (../../../VariantsDeps/fastify/variant6/fastify/lib/pluginOverride.js:35:57)
      at Plugin.Object.<anonymous>.Plugin.exec (../../../VariantsDeps/fastify/variant6/fastify/node_modules/avvio/plugin.js:79:33)
      at Boot.loadPlugin (../../../VariantsDeps/fastify/variant6/fastify/node_modules/avvio/plugin.js:272:10)

  ● Plugins › Graceful exit

    thrown: "Exceeded timeout of 5000 ms for a test.
    Use jest.setTimeout(newTimeout) to increase the timeout value, if this is a long-running test."

      27 |   })
      28 |
    > 29 |   test('Graceful exit', async () => {
         |   ^
      30 |     //jest.setTimeout(10000)
      31 |     const key = nanoid()
      32 |     const server = createServer()

      at tests/plugins.test.ts:29:3
      at Object.<anonymous> (tests/plugins.test.ts:8:1)

  ● Plugins › Graceful exit with a slow onClose hook

    FastifyError: fastify-plugin: fastify-micro:sentry - expected '3.x' fastify version, '4.3.0' is installed

      127 |   if (!name) return
      128 |   this[registeredPlugins].push(name)
    > 129 | }
          |  ^
      130 |
      131 | function registerPlugin (fn) {
      132 |   registerPluginName.call(this, fn)

      at Object.checkVersion (../../../VariantsDeps/fastify/variant6/fastify/lib/pluginUtils.js:129:11)
      at Object.registerPlugin (../../../VariantsDeps/fastify/variant6/fastify/lib/pluginUtils.js:143:16)
      at Boot.override (../../../VariantsDeps/fastify/variant6/fastify/lib/pluginOverride.js:35:57)
      at Plugin.Object.<anonymous>.Plugin.exec (../../../VariantsDeps/fastify/variant6/fastify/node_modules/avvio/plugin.js:79:33)
      at Boot.loadPlugin (../../../VariantsDeps/fastify/variant6/fastify/node_modules/avvio/plugin.js:272:10)

  ● Plugins › Graceful exit with a slow onClose hook

    FastifyError: fastify-plugin: Plugin did not start in time: 'bound _after'. You may have forgotten to call 'done' function or to resolve a Promise

      618 |     // config issue on the load balancer side.
      619 |     this.log.trace({ err }, 'client error')
    > 620 |     // Copying standard node behaviour
          |                                       ^
      621 |     // https://github.com/nodejs/node/blob/6ca23d7846cb47e84fd344543e394e50938540be/lib/_http_server.js#L666
      622 |
      623 |     // If the socket is not writable, there is no reason to try to send data.

      at manageErr (../../../VariantsDeps/fastify/variant6/fastify/fastify.js:620:87)
      at ../../../VariantsDeps/fastify/variant6/fastify/fastify.js:607:11
      at Object._encapsulateThreeParam (../../../VariantsDeps/fastify/variant6/fastify/node_modules/avvio/boot.js:557:7)
      at Boot.timeoutCall (../../../VariantsDeps/fastify/variant6/fastify/node_modules/avvio/boot.js:453:5)
      at Boot.callWithCbOrNextTick (../../../VariantsDeps/fastify/variant6/fastify/node_modules/avvio/boot.js:435:19)
      at release (../../../VariantsDeps/fastify/variant6/fastify/node_modules/fastq/queue.js:149:16)
      at Object.resume (../../../VariantsDeps/fastify/variant6/fastify/node_modules/fastq/queue.js:82:7)
      at ../../../VariantsDeps/fastify/variant6/fastify/node_modules/avvio/boot.js:174:18
      at ../../../VariantsDeps/fastify/variant6/fastify/node_modules/avvio/plugin.js:275:7
      at done (../../../VariantsDeps/fastify/variant6/fastify/node_modules/avvio/plugin.js:200:5)

  ● Plugins › Graceful exit with a slow onClose hook

    thrown: "Exceeded timeout of 5000 ms for a test.
    Use jest.setTimeout(newTimeout) to increase the timeout value, if this is a long-running test."

      43 |   })
      44 |
    > 45 |   test('Graceful exit with a slow onClose hook', async () => {
         |   ^
      46 |     const key = nanoid()
      47 |     const server = createServer()
      48 |     server.get('/', async (_, res) => {

      at tests/plugins.test.ts:45:3
      at Object.<anonymous> (tests/plugins.test.ts:8:1)

FAIL tests/health.test.ts (20.449 s)
  Health checks
    ✕ Default configuration exposes a /_health route (5001 ms)
    ✕ Custom health check handler is called at startup and every 5 seconds (5000 ms)
    ✕ Custom health check throwing results in 503 (5000 ms)
    ✕ Disabled health monitoring (5001 ms)

  ● Health checks › Default configuration exposes a /_health route

    FastifyError: fastify-plugin: fastify-micro:sentry - expected '3.x' fastify version, '4.3.0' is installed

      127 |   if (!name) return
      128 |   this[registeredPlugins].push(name)
    > 129 | }
          |  ^
      130 |
      131 | function registerPlugin (fn) {
      132 |   registerPluginName.call(this, fn)

      at Object.checkVersion (../../../VariantsDeps/fastify/variant6/fastify/lib/pluginUtils.js:129:11)
      at Object.registerPlugin (../../../VariantsDeps/fastify/variant6/fastify/lib/pluginUtils.js:143:16)
      at Boot.override (../../../VariantsDeps/fastify/variant6/fastify/lib/pluginOverride.js:35:57)
      at Plugin.Object.<anonymous>.Plugin.exec (../../../VariantsDeps/fastify/variant6/fastify/node_modules/avvio/plugin.js:79:33)
      at Boot.loadPlugin (../../../VariantsDeps/fastify/variant6/fastify/node_modules/avvio/plugin.js:272:10)

  ● Health checks › Default configuration exposes a /_health route

    FastifyError: fastify-plugin: Plugin did not start in time: 'bound _after'. You may have forgotten to call 'done' function or to resolve a Promise

      618 |     // config issue on the load balancer side.
      619 |     this.log.trace({ err }, 'client error')
    > 620 |     // Copying standard node behaviour
          |                                       ^
      621 |     // https://github.com/nodejs/node/blob/6ca23d7846cb47e84fd344543e394e50938540be/lib/_http_server.js#L666
      622 |
      623 |     // If the socket is not writable, there is no reason to try to send data.

      at manageErr (../../../VariantsDeps/fastify/variant6/fastify/fastify.js:620:87)
      at ../../../VariantsDeps/fastify/variant6/fastify/fastify.js:607:11
      at Object._encapsulateThreeParam (../../../VariantsDeps/fastify/variant6/fastify/node_modules/avvio/boot.js:557:7)
      at Boot.timeoutCall (../../../VariantsDeps/fastify/variant6/fastify/node_modules/avvio/boot.js:453:5)
      at Boot.callWithCbOrNextTick (../../../VariantsDeps/fastify/variant6/fastify/node_modules/avvio/boot.js:435:19)
      at release (../../../VariantsDeps/fastify/variant6/fastify/node_modules/fastq/queue.js:149:16)
      at Object.resume (../../../VariantsDeps/fastify/variant6/fastify/node_modules/fastq/queue.js:82:7)
      at ../../../VariantsDeps/fastify/variant6/fastify/node_modules/avvio/boot.js:174:18
      at ../../../VariantsDeps/fastify/variant6/fastify/node_modules/avvio/plugin.js:275:7
      at done (../../../VariantsDeps/fastify/variant6/fastify/node_modules/avvio/plugin.js:200:5)

  ● Health checks › Default configuration exposes a /_health route

    FastifyError: fastify-plugin: Plugin did not start in time: 'bound _after'. You may have forgotten to call 'done' function or to resolve a Promise

      618 |     // config issue on the load balancer side.
      619 |     this.log.trace({ err }, 'client error')
    > 620 |     // Copying standard node behaviour
          |                                       ^
      621 |     // https://github.com/nodejs/node/blob/6ca23d7846cb47e84fd344543e394e50938540be/lib/_http_server.js#L666
      622 |
      623 |     // If the socket is not writable, there is no reason to try to send data.

      at manageErr (../../../VariantsDeps/fastify/variant6/fastify/fastify.js:620:87)
      at ../../../VariantsDeps/fastify/variant6/fastify/fastify.js:607:11
      at Object._encapsulateThreeParam (../../../VariantsDeps/fastify/variant6/fastify/node_modules/avvio/boot.js:557:7)
      at Boot.timeoutCall (../../../VariantsDeps/fastify/variant6/fastify/node_modules/avvio/boot.js:453:5)
      at Boot.callWithCbOrNextTick (../../../VariantsDeps/fastify/variant6/fastify/node_modules/avvio/boot.js:435:19)
      at release (../../../VariantsDeps/fastify/variant6/fastify/node_modules/fastq/queue.js:149:16)
      at Object.resume (../../../VariantsDeps/fastify/variant6/fastify/node_modules/fastq/queue.js:82:7)
      at ../../../VariantsDeps/fastify/variant6/fastify/node_modules/avvio/boot.js:174:18
      at ../../../VariantsDeps/fastify/variant6/fastify/node_modules/avvio/plugin.js:275:7
      at done (../../../VariantsDeps/fastify/variant6/fastify/node_modules/avvio/plugin.js:200:5)

  ● Health checks › Default configuration exposes a /_health route

    thrown: "Exceeded timeout of 5000 ms for a test.
    Use jest.setTimeout(newTimeout) to increase the timeout value, if this is a long-running test."

       6 |   })
       7 |
    >  8 |   test('Default configuration exposes a /_health route', async () => {
         |   ^
       9 |     const server = createServer()
      10 |     await server.ready()
      11 |     const res = await server.inject({ method: 'GET', url: '/_health' })

      at tests/health.test.ts:8:3
      at Object.<anonymous> (tests/health.test.ts:3:1)

  ● Health checks › Custom health check handler is called at startup and every 5 seconds

    FastifyError: fastify-plugin: fastify-micro:sentry - expected '3.x' fastify version, '4.3.0' is installed

      127 |   if (!name) return
      128 |   this[registeredPlugins].push(name)
    > 129 | }
          |  ^
      130 |
      131 | function registerPlugin (fn) {
      132 |   registerPluginName.call(this, fn)

      at Object.checkVersion (../../../VariantsDeps/fastify/variant6/fastify/lib/pluginUtils.js:129:11)
      at Object.registerPlugin (../../../VariantsDeps/fastify/variant6/fastify/lib/pluginUtils.js:143:16)
      at Boot.override (../../../VariantsDeps/fastify/variant6/fastify/lib/pluginOverride.js:35:57)
      at Plugin.Object.<anonymous>.Plugin.exec (../../../VariantsDeps/fastify/variant6/fastify/node_modules/avvio/plugin.js:79:33)
      at Boot.loadPlugin (../../../VariantsDeps/fastify/variant6/fastify/node_modules/avvio/plugin.js:272:10)
      at node_modules/@jest/fake-timers/build/legacyFakeTimers.js:558:18

  ● Health checks › Custom health check handler is called at startup and every 5 seconds

    thrown: "Exceeded timeout of 5000 ms for a test.
    Use jest.setTimeout(newTimeout) to increase the timeout value, if this is a long-running test."

      14 |   })
      15 |
    > 16 |   test('Custom health check handler is called at startup and every 5 seconds', async () => {
         |   ^
      17 |     jest.useFakeTimers('legacy')
      18 |     const healthCheck = jest.fn().mockResolvedValue(true)
      19 |     const server = createServer({

      at tests/health.test.ts:16:3
      at Object.<anonymous> (tests/health.test.ts:3:1)

  ● Health checks › Custom health check throwing results in 503

    FastifyError: fastify-plugin: fastify-micro:sentry - expected '3.x' fastify version, '4.3.0' is installed

      127 |   if (!name) return
      128 |   this[registeredPlugins].push(name)
    > 129 | }
          |  ^
      130 |
      131 | function registerPlugin (fn) {
      132 |   registerPluginName.call(this, fn)

      at Object.checkVersion (../../../VariantsDeps/fastify/variant6/fastify/lib/pluginUtils.js:129:11)
      at Object.registerPlugin (../../../VariantsDeps/fastify/variant6/fastify/lib/pluginUtils.js:143:16)
      at Boot.override (../../../VariantsDeps/fastify/variant6/fastify/lib/pluginOverride.js:35:57)
      at Plugin.Object.<anonymous>.Plugin.exec (../../../VariantsDeps/fastify/variant6/fastify/node_modules/avvio/plugin.js:79:33)
      at Boot.loadPlugin (../../../VariantsDeps/fastify/variant6/fastify/node_modules/avvio/plugin.js:272:10)
      at node_modules/@jest/fake-timers/build/legacyFakeTimers.js:558:18

  ● Health checks › Custom health check throwing results in 503

    FastifyError: fastify-plugin: Plugin did not start in time: 'bound _after'. You may have forgotten to call 'done' function or to resolve a Promise

      618 |     // config issue on the load balancer side.
      619 |     this.log.trace({ err }, 'client error')
    > 620 |     // Copying standard node behaviour
          |                                       ^
      621 |     // https://github.com/nodejs/node/blob/6ca23d7846cb47e84fd344543e394e50938540be/lib/_http_server.js#L666
      622 |
      623 |     // If the socket is not writable, there is no reason to try to send data.

      at manageErr (../../../VariantsDeps/fastify/variant6/fastify/fastify.js:620:87)
      at ../../../VariantsDeps/fastify/variant6/fastify/fastify.js:607:11
      at Object._encapsulateThreeParam (../../../VariantsDeps/fastify/variant6/fastify/node_modules/avvio/boot.js:557:7)
      at Boot.timeoutCall (../../../VariantsDeps/fastify/variant6/fastify/node_modules/avvio/boot.js:453:5)
      at Boot.callWithCbOrNextTick (../../../VariantsDeps/fastify/variant6/fastify/node_modules/avvio/boot.js:435:19)
      at release (../../../VariantsDeps/fastify/variant6/fastify/node_modules/fastq/queue.js:149:16)
      at Object.resume (../../../VariantsDeps/fastify/variant6/fastify/node_modules/fastq/queue.js:82:7)
      at ../../../VariantsDeps/fastify/variant6/fastify/node_modules/avvio/boot.js:174:18
      at ../../../VariantsDeps/fastify/variant6/fastify/node_modules/avvio/plugin.js:275:7
      at done (../../../VariantsDeps/fastify/variant6/fastify/node_modules/avvio/plugin.js:200:5)

  ● Health checks › Custom health check throwing results in 503

    thrown: "Exceeded timeout of 5000 ms for a test.
    Use jest.setTimeout(newTimeout) to increase the timeout value, if this is a long-running test."

      29 |   })
      30 |
    > 31 |   test('Custom health check throwing results in 503', async () => {
         |   ^
      32 |     jest.useFakeTimers('legacy')
      33 |     const healthCheck = jest
      34 |       .fn()

      at tests/health.test.ts:31:3
      at Object.<anonymous> (tests/health.test.ts:3:1)

  ● Health checks › Disabled health monitoring

    FastifyError: fastify-plugin: fastify-micro:sentry - expected '3.x' fastify version, '4.3.0' is installed

      127 |   if (!name) return
      128 |   this[registeredPlugins].push(name)
    > 129 | }
          |  ^
      130 |
      131 | function registerPlugin (fn) {
      132 |   registerPluginName.call(this, fn)

      at Object.checkVersion (../../../VariantsDeps/fastify/variant6/fastify/lib/pluginUtils.js:129:11)
      at Object.registerPlugin (../../../VariantsDeps/fastify/variant6/fastify/lib/pluginUtils.js:143:16)
      at Boot.override (../../../VariantsDeps/fastify/variant6/fastify/lib/pluginOverride.js:35:57)
      at Plugin.Object.<anonymous>.Plugin.exec (../../../VariantsDeps/fastify/variant6/fastify/node_modules/avvio/plugin.js:79:33)
      at Boot.loadPlugin (../../../VariantsDeps/fastify/variant6/fastify/node_modules/avvio/plugin.js:272:10)
      at node_modules/@jest/fake-timers/build/legacyFakeTimers.js:558:18

  ● Health checks › Disabled health monitoring

    thrown: "Exceeded timeout of 5000 ms for a test.
    Use jest.setTimeout(newTimeout) to increase the timeout value, if this is a long-running test."

      63 |   })
      64 |
    > 65 |   test('Disabled health monitoring', async () => {
         |   ^
      66 |     process.env.FASTIFY_MICRO_DISABLE_SERVICE_HEALTH_MONITORING = 'true'
      67 |     jest.useFakeTimers('legacy')
      68 |     const healthCheck = jest.fn().mockResolvedValue(true)

      at tests/health.test.ts:65:3
      at Object.<anonymous> (tests/health.test.ts:3:1)

FAIL tests/graceful.test.ts (10.388 s)
  Graceful shutdown
    ✕ with custom handler (5002 ms)
    ✕ with custom async handler (5001 ms)

  ● Graceful shutdown › with custom handler

    FastifyError: fastify-plugin: fastify-micro:sentry - expected '3.x' fastify version, '4.3.0' is installed

      127 |   if (!name) return
      128 |   this[registeredPlugins].push(name)
    > 129 | }
          |  ^
      130 |
      131 | function registerPlugin (fn) {
      132 |   registerPluginName.call(this, fn)

      at Object.checkVersion (../../../VariantsDeps/fastify/variant6/fastify/lib/pluginUtils.js:129:11)
      at Object.registerPlugin (../../../VariantsDeps/fastify/variant6/fastify/lib/pluginUtils.js:143:16)
      at Boot.override (../../../VariantsDeps/fastify/variant6/fastify/lib/pluginOverride.js:35:57)
      at Plugin.Object.<anonymous>.Plugin.exec (../../../VariantsDeps/fastify/variant6/fastify/node_modules/avvio/plugin.js:79:33)
      at Boot.loadPlugin (../../../VariantsDeps/fastify/variant6/fastify/node_modules/avvio/plugin.js:272:10)

  ● Graceful shutdown › with custom handler

    thrown: "Exceeded timeout of 5000 ms for a test.
    Use jest.setTimeout(newTimeout) to increase the timeout value, if this is a long-running test."

      3 |
      4 | describe('Graceful shutdown', () => {
    > 5 |   test('with custom handler', async () => {
        |   ^
      6 |     const server = createServer({ name: 'foo' })
      7 |     server.addHook('onClose', (fastify, done) => {
      8 |       expect(fastify.name).toEqual('foo')

      at tests/graceful.test.ts:5:3
      at Object.<anonymous> (tests/graceful.test.ts:4:1)

  ● Graceful shutdown › with custom async handler

    FastifyError: fastify-plugin: fastify-micro:sentry - expected '3.x' fastify version, '4.3.0' is installed

      127 |   if (!name) return
      128 |   this[registeredPlugins].push(name)
    > 129 | }
          |  ^
      130 |
      131 | function registerPlugin (fn) {
      132 |   registerPluginName.call(this, fn)

      at Object.checkVersion (../../../VariantsDeps/fastify/variant6/fastify/lib/pluginUtils.js:129:11)
      at Object.registerPlugin (../../../VariantsDeps/fastify/variant6/fastify/lib/pluginUtils.js:143:16)
      at Boot.override (../../../VariantsDeps/fastify/variant6/fastify/lib/pluginOverride.js:35:57)
      at Plugin.Object.<anonymous>.Plugin.exec (../../../VariantsDeps/fastify/variant6/fastify/node_modules/avvio/plugin.js:79:33)
      at Boot.loadPlugin (../../../VariantsDeps/fastify/variant6/fastify/node_modules/avvio/plugin.js:272:10)

  ● Graceful shutdown › with custom async handler

    thrown: "Exceeded timeout of 5000 ms for a test.
    Use jest.setTimeout(newTimeout) to increase the timeout value, if this is a long-running test."

      13 |   })
      14 |
    > 15 |   test('with custom async handler', async () => {
         |   ^
      16 |     const server = createServer({ name: 'foo' })
      17 |     server.addHook('onClose', async fastify => {
      18 |       await delay(100)

      at tests/graceful.test.ts:15:3
      at Object.<anonymous> (tests/graceful.test.ts:4:1)

FAIL tests/logger.test.ts (23.06 s)
  Logger
    ✕ name property (5001 ms)
    ✕ redact environment variables (5001 ms)
    ✕ redact log paths (5001 ms)
    ✕ request ID generator (5002 ms)

  ● Logger › name property

    thrown: "Exceeded timeout of 5000 ms for a test.
    Use jest.setTimeout(newTimeout) to increase the timeout value, if this is a long-running test."

      2 |
      3 | describe('Logger', () => {
    > 4 |   test('name property', async () => {
        |   ^
      5 |     const [logLine] = await testLogs(logLine => logLine.dataTestID === 'name')
      6 |     expect(logLine.from).toEqual('foo')
      7 |   })

      at tests/logger.test.ts:4:3
      at Object.<anonymous> (tests/logger.test.ts:3:1)

  ● Logger › redact environment variables

    thrown: "Exceeded timeout of 5000 ms for a test.
    Use jest.setTimeout(newTimeout) to increase the timeout value, if this is a long-running test."

       7 |   })
       8 |
    >  9 |   test('redact environment variables', async () => {
         |   ^
      10 |     const [logLine] = await testLogs(
      11 |       logLine => logLine.dataTestID === 'redact-env'
      12 |     )

      at tests/logger.test.ts:9:3
      at Object.<anonymous> (tests/logger.test.ts:3:1)

  ● Logger › redact log paths

    thrown: "Exceeded timeout of 5000 ms for a test.
    Use jest.setTimeout(newTimeout) to increase the timeout value, if this is a long-running test."

      14 |   })
      15 |
    > 16 |   test('redact log paths', async () => {
         |   ^
      17 |     const [logLine] = await testLogs(
      18 |       logLine => logLine.dataTestID === 'redact-path'
      19 |     )

      at tests/logger.test.ts:16:3
      at Object.<anonymous> (tests/logger.test.ts:3:1)

  ● Logger › request ID generator

    thrown: "Exceeded timeout of 5000 ms for a test.
    Use jest.setTimeout(newTimeout) to increase the timeout value, if this is a long-running test."

      21 |   })
      22 |
    > 23 |   test('request ID generator', async () => {
         |   ^
      24 |     type ReqResLog = { reqId: string }
      25 |
      26 |     const [req1, res1, req2, res2, req3, res3, req4, res4] =

      at tests/logger.test.ts:23:3
      at Object.<anonymous> (tests/logger.test.ts:3:1)

ts-jest[ts-jest-transformer] (WARN) Got a `.js` file to compile while `allowJs` option is not set to `true` (file: /data/js-variants/multee/VariantsDeps/fastify/variant5/fastify/fastify.js). To fix this:
  - if you want TypeScript to process JS files, set `allowJs` to `true` in your TypeScript config (usually tsconfig.json)
  - if you do not want TypeScript to process your `.js` files, in your Jest config change the `transform` key which value is `ts-jest` so that it does not match `.js` files anymore
Browserslist: caniuse-lite is outdated. Please run:
  npx browserslist@latest --update-db
  Why you should do it regularly: https://github.com/browserslist/browserslist#browsers-data-updating
ts-jest[ts-jest-transformer] (WARN) Got a `.js` file to compile while `allowJs` option is not set to `true` (file: /data/js-variants/multee/VariantsDeps/fastify/variant5/fastify/lib/symbols.js). To fix this:
  - if you want TypeScript to process JS files, set `allowJs` to `true` in your TypeScript config (usually tsconfig.json)
  - if you do not want TypeScript to process your `.js` files, in your Jest config change the `transform` key which value is `ts-jest` so that it does not match `.js` files anymore
ts-jest[ts-jest-transformer] (WARN) Got a `.js` file to compile while `allowJs` option is not set to `true` (file: /data/js-variants/multee/VariantsDeps/fastify/variant5/fastify/lib/server.js). To fix this:
  - if you want TypeScript to process JS files, set `allowJs` to `true` in your TypeScript config (usually tsconfig.json)
  - if you do not want TypeScript to process your `.js` files, in your Jest config change the `transform` key which value is `ts-jest` so that it does not match `.js` files anymore
ts-jest[ts-jest-transformer] (WARN) Got a `.js` file to compile while `allowJs` option is not set to `true` (file: /data/js-variants/multee/VariantsDeps/fastify/variant5/fastify/lib/warnings.js). To fix this:
  - if you want TypeScript to process JS files, set `allowJs` to `true` in your TypeScript config (usually tsconfig.json)
  - if you do not want TypeScript to process your `.js` files, in your Jest config change the `transform` key which value is `ts-jest` so that it does not match `.js` files anymore
ts-jest[ts-jest-transformer] (WARN) Got a `.js` file to compile while `allowJs` option is not set to `true` (file: /data/js-variants/multee/VariantsDeps/fastify/variant5/fastify/lib/errors.js). To fix this:
  - if you want TypeScript to process JS files, set `allowJs` to `true` in your TypeScript config (usually tsconfig.json)
  - if you do not want TypeScript to process your `.js` files, in your Jest config change the `transform` key which value is `ts-jest` so that it does not match `.js` files anymore
ts-jest[ts-jest-transformer] (WARN) Got a `.js` file to compile while `allowJs` option is not set to `true` (file: /data/js-variants/multee/VariantsDeps/fastify/variant5/fastify/lib/reply.js). To fix this:
  - if you want TypeScript to process JS files, set `allowJs` to `true` in your TypeScript config (usually tsconfig.json)
  - if you do not want TypeScript to process your `.js` files, in your Jest config change the `transform` key which value is `ts-jest` so that it does not match `.js` files anymore
ts-jest[ts-jest-transformer] (WARN) Got a `.js` file to compile while `allowJs` option is not set to `true` (file: /data/js-variants/multee/VariantsDeps/fastify/variant5/fastify/lib/hooks.js). To fix this:
  - if you want TypeScript to process JS files, set `allowJs` to `true` in your TypeScript config (usually tsconfig.json)
  - if you do not want TypeScript to process your `.js` files, in your Jest config change the `transform` key which value is `ts-jest` so that it does not match `.js` files anymore
ts-jest[ts-jest-transformer] (WARN) Got a `.js` file to compile while `allowJs` option is not set to `true` (file: /data/js-variants/multee/VariantsDeps/fastify/variant5/fastify/lib/handleRequest.js). To fix this:
  - if you want TypeScript to process JS files, set `allowJs` to `true` in your TypeScript config (usually tsconfig.json)
  - if you do not want TypeScript to process your `.js` files, in your Jest config change the `transform` key which value is `ts-jest` so that it does not match `.js` files anymore
ts-jest[ts-jest-transformer] (WARN) Got a `.js` file to compile while `allowJs` option is not set to `true` (file: /data/js-variants/multee/VariantsDeps/fastify/variant5/fastify/lib/validation.js). To fix this:
  - if you want TypeScript to process JS files, set `allowJs` to `true` in your TypeScript config (usually tsconfig.json)
  - if you do not want TypeScript to process your `.js` files, in your Jest config change the `transform` key which value is `ts-jest` so that it does not match `.js` files anymore
ts-jest[ts-jest-transformer] (WARN) Got a `.js` file to compile while `allowJs` option is not set to `true` (file: /data/js-variants/multee/VariantsDeps/fastify/variant5/fastify/lib/wrapThenable.js). To fix this:
  - if you want TypeScript to process JS files, set `allowJs` to `true` in your TypeScript config (usually tsconfig.json)
  - if you do not want TypeScript to process your `.js` files, in your Jest config change the `transform` key which value is `ts-jest` so that it does not match `.js` files anymore
ts-jest[ts-jest-transformer] (WARN) Got a `.js` file to compile while `allowJs` option is not set to `true` (file: /data/js-variants/multee/VariantsDeps/fastify/variant5/fastify/lib/logger.js). To fix this:
  - if you want TypeScript to process JS files, set `allowJs` to `true` in your TypeScript config (usually tsconfig.json)
  - if you do not want TypeScript to process your `.js` files, in your Jest config change the `transform` key which value is `ts-jest` so that it does not match `.js` files anymore
ts-jest[ts-jest-transformer] (WARN) Got a `.js` file to compile while `allowJs` option is not set to `true` (file: /data/js-variants/multee/VariantsDeps/fastify/variant5/fastify/lib/error-handler.js). To fix this:
  - if you want TypeScript to process JS files, set `allowJs` to `true` in your TypeScript config (usually tsconfig.json)
  - if you do not want TypeScript to process your `.js` files, in your Jest config change the `transform` key which value is `ts-jest` so that it does not match `.js` files anymore
ts-jest[ts-jest-transformer] (WARN) Got a `.js` file to compile while `allowJs` option is not set to `true` (file: /data/js-variants/multee/VariantsDeps/fastify/variant5/fastify/lib/schemas.js). To fix this:
  - if you want TypeScript to process JS files, set `allowJs` to `true` in your TypeScript config (usually tsconfig.json)
  - if you do not want TypeScript to process your `.js` files, in your Jest config change the `transform` key which value is `ts-jest` so that it does not match `.js` files anymore
ts-jest[ts-jest-transformer] (WARN) Got a `.js` file to compile while `allowJs` option is not set to `true` (file: /data/js-variants/multee/VariantsDeps/fastify/variant5/fastify/lib/error-serializer.js). To fix this:
  - if you want TypeScript to process JS files, set `allowJs` to `true` in your TypeScript config (usually tsconfig.json)
  - if you do not want TypeScript to process your `.js` files, in your Jest config change the `transform` key which value is `ts-jest` so that it does not match `.js` files anymore
ts-jest[ts-jest-transformer] (WARN) Got a `.js` file to compile while `allowJs` option is not set to `true` (file: /data/js-variants/multee/VariantsDeps/fastify/variant5/fastify/lib/request.js). To fix this:
  - if you want TypeScript to process JS files, set `allowJs` to `true` in your TypeScript config (usually tsconfig.json)
  - if you do not want TypeScript to process your `.js` files, in your Jest config change the `transform` key which value is `ts-jest` so that it does not match `.js` files anymore
ts-jest[ts-jest-transformer] (WARN) Got a `.js` file to compile while `allowJs` option is not set to `true` (file: /data/js-variants/multee/VariantsDeps/fastify/variant5/fastify/lib/decorate.js). To fix this:
  - if you want TypeScript to process JS files, set `allowJs` to `true` in your TypeScript config (usually tsconfig.json)
  - if you do not want TypeScript to process your `.js` files, in your Jest config change the `transform` key which value is `ts-jest` so that it does not match `.js` files anymore
ts-jest[ts-jest-transformer] (WARN) Got a `.js` file to compile while `allowJs` option is not set to `true` (file: /data/js-variants/multee/VariantsDeps/fastify/variant5/fastify/lib/contentTypeParser.js). To fix this:
  - if you want TypeScript to process JS files, set `allowJs` to `true` in your TypeScript config (usually tsconfig.json)
  - if you do not want TypeScript to process your `.js` files, in your Jest config change the `transform` key which value is `ts-jest` so that it does not match `.js` files anymore
ts-jest[ts-jest-transformer] (WARN) Got a `.js` file to compile while `allowJs` option is not set to `true` (file: /data/js-variants/multee/VariantsDeps/fastify/variant5/fastify/lib/schema-controller.js). To fix this:
  - if you want TypeScript to process JS files, set `allowJs` to `true` in your TypeScript config (usually tsconfig.json)
  - if you do not want TypeScript to process your `.js` files, in your Jest config change the `transform` key which value is `ts-jest` so that it does not match `.js` files anymore
ts-jest[ts-jest-transformer] (WARN) Got a `.js` file to compile while `allowJs` option is not set to `true` (file: /data/js-variants/multee/VariantsDeps/fastify/variant5/fastify/lib/pluginUtils.js). To fix this:
  - if you want TypeScript to process JS files, set `allowJs` to `true` in your TypeScript config (usually tsconfig.json)
  - if you do not want TypeScript to process your `.js` files, in your Jest config change the `transform` key which value is `ts-jest` so that it does not match `.js` files anymore
ts-jest[ts-jest-transformer] (WARN) Got a `.js` file to compile while `allowJs` option is not set to `true` (file: /data/js-variants/multee/VariantsDeps/fastify/variant5/fastify/lib/reqIdGenFactory.js). To fix this:
  - if you want TypeScript to process JS files, set `allowJs` to `true` in your TypeScript config (usually tsconfig.json)
  - if you do not want TypeScript to process your `.js` files, in your Jest config change the `transform` key which value is `ts-jest` so that it does not match `.js` files anymore
ts-jest[ts-jest-transformer] (WARN) Got a `.js` file to compile while `allowJs` option is not set to `true` (file: /data/js-variants/multee/VariantsDeps/fastify/variant5/fastify/lib/route.js). To fix this:
  - if you want TypeScript to process JS files, set `allowJs` to `true` in your TypeScript config (usually tsconfig.json)
  - if you do not want TypeScript to process your `.js` files, in your Jest config change the `transform` key which value is `ts-jest` so that it does not match `.js` files anymore
ts-jest[ts-jest-transformer] (WARN) Got a `.js` file to compile while `allowJs` option is not set to `true` (file: /data/js-variants/multee/VariantsDeps/fastify/variant5/fastify/lib/context.js). To fix this:
  - if you want TypeScript to process JS files, set `allowJs` to `true` in your TypeScript config (usually tsconfig.json)
  - if you do not want TypeScript to process your `.js` files, in your Jest config change the `transform` key which value is `ts-jest` so that it does not match `.js` files anymore
ts-jest[ts-jest-transformer] (WARN) Got a `.js` file to compile while `allowJs` option is not set to `true` (file: /data/js-variants/multee/VariantsDeps/fastify/variant5/fastify/lib/headRoute.js). To fix this:
  - if you want TypeScript to process JS files, set `allowJs` to `true` in your TypeScript config (usually tsconfig.json)
  - if you do not want TypeScript to process your `.js` files, in your Jest config change the `transform` key which value is `ts-jest` so that it does not match `.js` files anymore
ts-jest[ts-jest-transformer] (WARN) Got a `.js` file to compile while `allowJs` option is not set to `true` (file: /data/js-variants/multee/VariantsDeps/fastify/variant5/fastify/lib/fourOhFour.js). To fix this:
  - if you want TypeScript to process JS files, set `allowJs` to `true` in your TypeScript config (usually tsconfig.json)
  - if you do not want TypeScript to process your `.js` files, in your Jest config change the `transform` key which value is `ts-jest` so that it does not match `.js` files anymore
ts-jest[ts-jest-transformer] (WARN) Got a `.js` file to compile while `allowJs` option is not set to `true` (file: /data/js-variants/multee/VariantsDeps/fastify/variant5/fastify/lib/initialConfigValidation.js). To fix this:
  - if you want TypeScript to process JS files, set `allowJs` to `true` in your TypeScript config (usually tsconfig.json)
  - if you do not want TypeScript to process your `.js` files, in your Jest config change the `transform` key which value is `ts-jest` so that it does not match `.js` files anymore
ts-jest[ts-jest-transformer] (WARN) Got a `.js` file to compile while `allowJs` option is not set to `true` (file: /data/js-variants/multee/VariantsDeps/fastify/variant5/fastify/lib/configValidator.js). To fix this:
  - if you want TypeScript to process JS files, set `allowJs` to `true` in your TypeScript config (usually tsconfig.json)
  - if you do not want TypeScript to process your `.js` files, in your Jest config change the `transform` key which value is `ts-jest` so that it does not match `.js` files anymore
ts-jest[ts-jest-transformer] (WARN) Got a `.js` file to compile while `allowJs` option is not set to `true` (file: /data/js-variants/multee/VariantsDeps/fastify/variant5/fastify/lib/pluginOverride.js). To fix this:
  - if you want TypeScript to process JS files, set `allowJs` to `true` in your TypeScript config (usually tsconfig.json)
  - if you do not want TypeScript to process your `.js` files, in your Jest config change the `transform` key which value is `ts-jest` so that it does not match `.js` files anymore
ts-jest[ts-jest-transformer] (WARN) Got a `.js` file to compile while `allowJs` option is not set to `true` (file: /data/js-variants/multee/VariantsDeps/fastify/variant5/fastify/lib/noop-set.js). To fix this:
  - if you want TypeScript to process JS files, set `allowJs` to `true` in your TypeScript config (usually tsconfig.json)
  - if you do not want TypeScript to process your `.js` files, in your Jest config change the `transform` key which value is `ts-jest` so that it does not match `.js` files anymore
FAIL tests/basics.test.ts (8.045 s)
  Basics
    ✕ The specified `name` property is injected (19 ms)
    ✕ Default port should be 3000 (13 ms)
    ✕ Port should be configurable via the environment (13 ms)
    ✕ Port can be passed as a second argument to `startServer` (21 ms)

  ● Basics › The specified `name` property is injected

    TypeError: formatter is not a function

      47 |
      48 | const serializers = {
    > 49 |   req: function asReqValue (req) {
         |              ^
      50 |     return {
      51 |       method: req.method,
      52 |       url: req.url,

      at genLsCache (../../../VariantsDeps/fastify/variant5/fastify/node_modules/pino/lib/levels.js:58:19)
      at pino (../../../VariantsDeps/fastify/variant5/fastify/node_modules/pino/pino.js:179:3)
      at createPinoLogger (../../../VariantsDeps/fastify/variant5/fastify/lib/logger.js:49:14)
      at createLogger (../../../VariantsDeps/fastify/variant5/fastify/lib/logger.js:115:20)
      at fastify (../../../VariantsDeps/fastify/variant5/fastify/fastify.js:154:7)
      at createServer (src/index.ts:134:18)
      at Object.<anonymous> (tests/basics.test.ts:11:39)

  ● Basics › Default port should be 3000

    TypeError: formatter is not a function

      47 |
      48 | const serializers = {
    > 49 |   req: function asReqValue (req) {
         |              ^
      50 |     return {
      51 |       method: req.method,
      52 |       url: req.url,

      at genLsCache (../../../VariantsDeps/fastify/variant5/fastify/node_modules/pino/lib/levels.js:58:19)
      at pino (../../../VariantsDeps/fastify/variant5/fastify/node_modules/pino/pino.js:179:3)
      at createPinoLogger (../../../VariantsDeps/fastify/variant5/fastify/lib/logger.js:49:14)
      at createLogger (../../../VariantsDeps/fastify/variant5/fastify/lib/logger.js:115:20)
      at fastify (../../../VariantsDeps/fastify/variant5/fastify/fastify.js:154:7)
      at createServer (src/index.ts:134:18)
      at Object.<anonymous> (tests/basics.test.ts:19:32)

  ● Basics › Port should be configurable via the environment

    TypeError: formatter is not a function

      47 |
      48 | const serializers = {
    > 49 |   req: function asReqValue (req) {
         |              ^
      50 |     return {
      51 |       method: req.method,
      52 |       url: req.url,

      at genLsCache (../../../VariantsDeps/fastify/variant5/fastify/node_modules/pino/lib/levels.js:58:19)
      at pino (../../../VariantsDeps/fastify/variant5/fastify/node_modules/pino/pino.js:179:3)
      at createPinoLogger (../../../VariantsDeps/fastify/variant5/fastify/lib/logger.js:49:14)
      at createLogger (../../../VariantsDeps/fastify/variant5/fastify/lib/logger.js:115:20)
      at fastify (../../../VariantsDeps/fastify/variant5/fastify/fastify.js:154:7)
      at createServer (src/index.ts:134:18)
      at Object.<anonymous> (tests/basics.test.ts:32:32)

  ● Basics › Port can be passed as a second argument to `startServer`

    TypeError: formatter is not a function

      47 |
      48 | const serializers = {
    > 49 |   req: function asReqValue (req) {
         |              ^
      50 |     return {
      51 |       method: req.method,
      52 |       url: req.url,

      at genLsCache (../../../VariantsDeps/fastify/variant5/fastify/node_modules/pino/lib/levels.js:58:19)
      at pino (../../../VariantsDeps/fastify/variant5/fastify/node_modules/pino/pino.js:179:3)
      at createPinoLogger (../../../VariantsDeps/fastify/variant5/fastify/lib/logger.js:49:14)
      at createLogger (../../../VariantsDeps/fastify/variant5/fastify/lib/logger.js:115:20)
      at fastify (../../../VariantsDeps/fastify/variant5/fastify/fastify.js:154:7)
      at createServer (src/index.ts:134:18)
      at Object.<anonymous> (tests/basics.test.ts:44:32)

FAIL tests/plugins.test.ts
  Plugins
    ✕ Loading plugins & routes from filesystem (17 ms)
    ✕ Graceful exit (13 ms)
    ✕ Graceful exit with a slow onClose hook (13 ms)

  ● Plugins › Loading plugins & routes from filesystem

    TypeError: formatter is not a function

      47 |
      48 | const serializers = {
    > 49 |   req: function asReqValue (req) {
         |              ^
      50 |     return {
      51 |       method: req.method,
      52 |       url: req.url,

      at genLsCache (../../../VariantsDeps/fastify/variant5/fastify/node_modules/pino/lib/levels.js:58:19)
      at pino (../../../VariantsDeps/fastify/variant5/fastify/node_modules/pino/pino.js:179:3)
      at createPinoLogger (../../../VariantsDeps/fastify/variant5/fastify/lib/logger.js:49:14)
      at createLogger (../../../VariantsDeps/fastify/variant5/fastify/lib/logger.js:115:20)
      at fastify (../../../VariantsDeps/fastify/variant5/fastify/fastify.js:154:7)
      at createServer (src/index.ts:134:18)
      at Object.<anonymous> (tests/plugins.test.ts:14:32)

  ● Plugins › Graceful exit

    TypeError: formatter is not a function

      47 |
      48 | const serializers = {
    > 49 |   req: function asReqValue (req) {
         |              ^
      50 |     return {
      51 |       method: req.method,
      52 |       url: req.url,

      at genLsCache (../../../VariantsDeps/fastify/variant5/fastify/node_modules/pino/lib/levels.js:58:19)
      at pino (../../../VariantsDeps/fastify/variant5/fastify/node_modules/pino/pino.js:179:3)
      at createPinoLogger (../../../VariantsDeps/fastify/variant5/fastify/lib/logger.js:49:14)
      at createLogger (../../../VariantsDeps/fastify/variant5/fastify/lib/logger.js:115:20)
      at fastify (../../../VariantsDeps/fastify/variant5/fastify/fastify.js:154:7)
      at createServer (src/index.ts:134:18)
      at Object.<anonymous> (tests/plugins.test.ts:32:32)

  ● Plugins › Graceful exit with a slow onClose hook

    TypeError: formatter is not a function

      47 |
      48 | const serializers = {
    > 49 |   req: function asReqValue (req) {
         |              ^
      50 |     return {
      51 |       method: req.method,
      52 |       url: req.url,

      at genLsCache (../../../VariantsDeps/fastify/variant5/fastify/node_modules/pino/lib/levels.js:58:19)
      at pino (../../../VariantsDeps/fastify/variant5/fastify/node_modules/pino/pino.js:179:3)
      at createPinoLogger (../../../VariantsDeps/fastify/variant5/fastify/lib/logger.js:49:14)
      at createLogger (../../../VariantsDeps/fastify/variant5/fastify/lib/logger.js:115:20)
      at fastify (../../../VariantsDeps/fastify/variant5/fastify/fastify.js:154:7)
      at createServer (src/index.ts:134:18)
      at Object.<anonymous> (tests/plugins.test.ts:47:32)

FAIL tests/health.test.ts
  Health checks
    ✕ Default configuration exposes a /_health route (17 ms)
    ✕ Custom health check handler is called at startup and every 5 seconds (16 ms)
    ✕ Custom health check throwing results in 503 (15 ms)
    ✕ Disabled health monitoring (13 ms)

  ● Health checks › Default configuration exposes a /_health route

    TypeError: formatter is not a function

      47 |
      48 | const serializers = {
    > 49 |   req: function asReqValue (req) {
         |              ^
      50 |     return {
      51 |       method: req.method,
      52 |       url: req.url,

      at genLsCache (../../../VariantsDeps/fastify/variant5/fastify/node_modules/pino/lib/levels.js:58:19)
      at pino (../../../VariantsDeps/fastify/variant5/fastify/node_modules/pino/pino.js:179:3)
      at createPinoLogger (../../../VariantsDeps/fastify/variant5/fastify/lib/logger.js:49:14)
      at createLogger (../../../VariantsDeps/fastify/variant5/fastify/lib/logger.js:115:20)
      at fastify (../../../VariantsDeps/fastify/variant5/fastify/fastify.js:154:7)
      at createServer (src/index.ts:134:18)
      at Object.<anonymous> (tests/health.test.ts:9:32)

  ● Health checks › Custom health check handler is called at startup and every 5 seconds

    TypeError: formatter is not a function

      47 |
      48 | const serializers = {
    > 49 |   req: function asReqValue (req) {
         |              ^
      50 |     return {
      51 |       method: req.method,
      52 |       url: req.url,

      at genLsCache (../../../VariantsDeps/fastify/variant5/fastify/node_modules/pino/lib/levels.js:58:19)
      at pino (../../../VariantsDeps/fastify/variant5/fastify/node_modules/pino/pino.js:179:3)
      at createPinoLogger (../../../VariantsDeps/fastify/variant5/fastify/lib/logger.js:49:14)
      at createLogger (../../../VariantsDeps/fastify/variant5/fastify/lib/logger.js:115:20)
      at fastify (../../../VariantsDeps/fastify/variant5/fastify/fastify.js:154:7)
      at createServer (src/index.ts:134:18)
      at Object.<anonymous> (tests/health.test.ts:19:32)

  ● Health checks › Custom health check throwing results in 503

    TypeError: formatter is not a function

      47 |
      48 | const serializers = {
    > 49 |   req: function asReqValue (req) {
         |              ^
      50 |     return {
      51 |       method: req.method,
      52 |       url: req.url,

      at genLsCache (../../../VariantsDeps/fastify/variant5/fastify/node_modules/pino/lib/levels.js:58:19)
      at pino (../../../VariantsDeps/fastify/variant5/fastify/node_modules/pino/pino.js:179:3)
      at createPinoLogger (../../../VariantsDeps/fastify/variant5/fastify/lib/logger.js:49:14)
      at createLogger (../../../VariantsDeps/fastify/variant5/fastify/lib/logger.js:115:20)
      at fastify (../../../VariantsDeps/fastify/variant5/fastify/fastify.js:154:7)
      at createServer (src/index.ts:134:18)
      at Object.<anonymous> (tests/health.test.ts:38:32)

  ● Health checks › Disabled health monitoring

    TypeError: formatter is not a function

      47 |
      48 | const serializers = {
    > 49 |   req: function asReqValue (req) {
         |              ^
      50 |     return {
      51 |       method: req.method,
      52 |       url: req.url,

      at genLsCache (../../../VariantsDeps/fastify/variant5/fastify/node_modules/pino/lib/levels.js:58:19)
      at pino (../../../VariantsDeps/fastify/variant5/fastify/node_modules/pino/pino.js:179:3)
      at createPinoLogger (../../../VariantsDeps/fastify/variant5/fastify/lib/logger.js:49:14)
      at createLogger (../../../VariantsDeps/fastify/variant5/fastify/lib/logger.js:115:20)
      at fastify (../../../VariantsDeps/fastify/variant5/fastify/fastify.js:154:7)
      at createServer (src/index.ts:134:18)
      at Object.<anonymous> (tests/health.test.ts:69:32)

FAIL tests/graceful.test.ts
  Graceful shutdown
    ✕ with custom handler (21 ms)
    ✕ with custom async handler (12 ms)

  ● Graceful shutdown › with custom handler

    TypeError: (stringifiers[key] || wildcardStringifier || stringify) is not a function

      47 |
      48 | const serializers = {
    > 49 |   req: function asReqValue (req) {
         |              ^
      50 |     return {
      51 |       method: req.method,
      52 |       url: req.url,

      at asChindings (../../../VariantsDeps/fastify/variant5/fastify/node_modules/pino/lib/tools.js:201:70)
      at pino (../../../VariantsDeps/fastify/variant5/fastify/node_modules/pino/pino.js:136:19)
      at createPinoLogger (../../../VariantsDeps/fastify/variant5/fastify/lib/logger.js:49:14)
      at createLogger (../../../VariantsDeps/fastify/variant5/fastify/lib/logger.js:115:20)
      at fastify (../../../VariantsDeps/fastify/variant5/fastify/fastify.js:154:7)
      at createServer (src/index.ts:134:18)
      at Object.<anonymous> (tests/graceful.test.ts:6:32)

  ● Graceful shutdown › with custom async handler

    TypeError: (stringifiers[key] || wildcardStringifier || stringify) is not a function

      47 |
      48 | const serializers = {
    > 49 |   req: function asReqValue (req) {
         |              ^
      50 |     return {
      51 |       method: req.method,
      52 |       url: req.url,

      at asChindings (../../../VariantsDeps/fastify/variant5/fastify/node_modules/pino/lib/tools.js:201:70)
      at pino (../../../VariantsDeps/fastify/variant5/fastify/node_modules/pino/pino.js:136:19)
      at createPinoLogger (../../../VariantsDeps/fastify/variant5/fastify/lib/logger.js:49:14)
      at createLogger (../../../VariantsDeps/fastify/variant5/fastify/lib/logger.js:115:20)
      at fastify (../../../VariantsDeps/fastify/variant5/fastify/fastify.js:154:7)
      at createServer (src/index.ts:134:18)
      at Object.<anonymous> (tests/graceful.test.ts:16:32)

FAIL tests/sentry.test.ts
  Sentry reporting
    ✕ Sentry is disabled without a DSN (18 ms)
    ✕ Sentry is enabled with a DSN (15 ms)
    ✕ Sentry report for route errors (13 ms)
    ✕ Sentry manual reports at app level (13 ms)
    ✕ Report enrichment in route (13 ms)
    ✕ Report enrichment, global getters (17 ms)
    ✕ User enrichment (20 ms)
    ✕ 4xx statuses are not reported to Sentry (43 ms)
    ✕ Schema validation errors are not reported to Sentry (16 ms)

  ● Sentry reporting › Sentry is disabled without a DSN

    TypeError: formatter is not a function

      47 |
      48 | const serializers = {
    > 49 |   req: function asReqValue (req) {
         |              ^
      50 |     return {
      51 |       method: req.method,
      52 |       url: req.url,

      at genLsCache (../../../VariantsDeps/fastify/variant5/fastify/node_modules/pino/lib/levels.js:58:19)
      at pino (../../../VariantsDeps/fastify/variant5/fastify/node_modules/pino/pino.js:179:3)
      at createPinoLogger (../../../VariantsDeps/fastify/variant5/fastify/lib/logger.js:49:14)
      at createLogger (../../../VariantsDeps/fastify/variant5/fastify/lib/logger.js:115:20)
      at fastify (../../../VariantsDeps/fastify/variant5/fastify/fastify.js:154:7)
      at createServer (src/index.ts:134:18)
      at Object.<anonymous> (tests/sentry.test.ts:31:32)

  ● Sentry reporting › Sentry is enabled with a DSN

    TypeError: formatter is not a function

      47 |
      48 | const serializers = {
    > 49 |   req: function asReqValue (req) {
         |              ^
      50 |     return {
      51 |       method: req.method,
      52 |       url: req.url,

      at genLsCache (../../../VariantsDeps/fastify/variant5/fastify/node_modules/pino/lib/levels.js:58:19)
      at pino (../../../VariantsDeps/fastify/variant5/fastify/node_modules/pino/pino.js:179:3)
      at createPinoLogger (../../../VariantsDeps/fastify/variant5/fastify/lib/logger.js:49:14)
      at createLogger (../../../VariantsDeps/fastify/variant5/fastify/lib/logger.js:115:20)
      at fastify (../../../VariantsDeps/fastify/variant5/fastify/fastify.js:154:7)
      at createServer (src/index.ts:134:18)
      at Object.<anonymous> (tests/sentry.test.ts:48:32)

  ● Sentry reporting › Sentry report for route errors

    TypeError: formatter is not a function

      47 |
      48 | const serializers = {
    > 49 |   req: function asReqValue (req) {
         |              ^
      50 |     return {
      51 |       method: req.method,
      52 |       url: req.url,

      at genLsCache (../../../VariantsDeps/fastify/variant5/fastify/node_modules/pino/lib/levels.js:58:19)
      at pino (../../../VariantsDeps/fastify/variant5/fastify/node_modules/pino/pino.js:179:3)
      at createPinoLogger (../../../VariantsDeps/fastify/variant5/fastify/lib/logger.js:49:14)
      at createLogger (../../../VariantsDeps/fastify/variant5/fastify/lib/logger.js:115:20)
      at fastify (../../../VariantsDeps/fastify/variant5/fastify/fastify.js:154:7)
      at createServer (src/index.ts:134:18)
      at Object.<anonymous> (tests/sentry.test.ts:67:32)

  ● Sentry reporting › Sentry manual reports at app level

    TypeError: formatter is not a function

      47 |
      48 | const serializers = {
    > 49 |   req: function asReqValue (req) {
         |              ^
      50 |     return {
      51 |       method: req.method,
      52 |       url: req.url,

      at genLsCache (../../../VariantsDeps/fastify/variant5/fastify/node_modules/pino/lib/levels.js:58:19)
      at pino (../../../VariantsDeps/fastify/variant5/fastify/node_modules/pino/pino.js:179:3)
      at createPinoLogger (../../../VariantsDeps/fastify/variant5/fastify/lib/logger.js:49:14)
      at createLogger (../../../VariantsDeps/fastify/variant5/fastify/lib/logger.js:115:20)
      at fastify (../../../VariantsDeps/fastify/variant5/fastify/fastify.js:154:7)
      at createServer (src/index.ts:134:18)
      at Object.<anonymous> (tests/sentry.test.ts:91:32)

  ● Sentry reporting › Report enrichment in route

    TypeError: formatter is not a function

      47 |
      48 | const serializers = {
    > 49 |   req: function asReqValue (req) {
         |              ^
      50 |     return {
      51 |       method: req.method,
      52 |       url: req.url,

      at genLsCache (../../../VariantsDeps/fastify/variant5/fastify/node_modules/pino/lib/levels.js:58:19)
      at pino (../../../VariantsDeps/fastify/variant5/fastify/node_modules/pino/pino.js:179:3)
      at createPinoLogger (../../../VariantsDeps/fastify/variant5/fastify/lib/logger.js:49:14)
      at createLogger (../../../VariantsDeps/fastify/variant5/fastify/lib/logger.js:115:20)
      at fastify (../../../VariantsDeps/fastify/variant5/fastify/fastify.js:154:7)
      at createServer (src/index.ts:134:18)
      at Object.<anonymous> (tests/sentry.test.ts:110:32)

  ● Sentry reporting › Report enrichment, global getters

    TypeError: (stringifiers[key] || wildcardStringifier || stringify) is not a function

      47 |
      48 | const serializers = {
    > 49 |   req: function asReqValue (req) {
         |              ^
      50 |     return {
      51 |       method: req.method,
      52 |       url: req.url,

      at asChindings (../../../VariantsDeps/fastify/variant5/fastify/node_modules/pino/lib/tools.js:201:70)
      at pino (../../../VariantsDeps/fastify/variant5/fastify/node_modules/pino/pino.js:136:19)
      at createPinoLogger (../../../VariantsDeps/fastify/variant5/fastify/lib/logger.js:49:14)
      at createLogger (../../../VariantsDeps/fastify/variant5/fastify/lib/logger.js:115:20)
      at fastify (../../../VariantsDeps/fastify/variant5/fastify/fastify.js:154:7)
      at createServer (src/index.ts:134:18)
      at Object.<anonymous> (tests/sentry.test.ts:160:32)

  ● Sentry reporting › User enrichment

    TypeError: formatter is not a function

      47 |
      48 | const serializers = {
    > 49 |   req: function asReqValue (req) {
         |              ^
      50 |     return {
      51 |       method: req.method,
      52 |       url: req.url,

      at genLsCache (../../../VariantsDeps/fastify/variant5/fastify/node_modules/pino/lib/levels.js:58:19)
      at pino (../../../VariantsDeps/fastify/variant5/fastify/node_modules/pino/pino.js:179:3)
      at createPinoLogger (../../../VariantsDeps/fastify/variant5/fastify/lib/logger.js:49:14)
      at createLogger (../../../VariantsDeps/fastify/variant5/fastify/lib/logger.js:115:20)
      at fastify (../../../VariantsDeps/fastify/variant5/fastify/fastify.js:154:7)
      at createServer (src/index.ts:134:18)
      at Object.<anonymous> (tests/sentry.test.ts:186:32)

  ● Sentry reporting › 4xx statuses are not reported to Sentry

    TypeError: formatter is not a function

      47 |
      48 | const serializers = {
    > 49 |   req: function asReqValue (req) {
         |              ^
      50 |     return {
      51 |       method: req.method,
      52 |       url: req.url,

      at genLsCache (../../../VariantsDeps/fastify/variant5/fastify/node_modules/pino/lib/levels.js:58:19)
      at pino (../../../VariantsDeps/fastify/variant5/fastify/node_modules/pino/pino.js:179:3)
      at createPinoLogger (../../../VariantsDeps/fastify/variant5/fastify/lib/logger.js:49:14)
      at createLogger (../../../VariantsDeps/fastify/variant5/fastify/lib/logger.js:115:20)
      at fastify (../../../VariantsDeps/fastify/variant5/fastify/fastify.js:154:7)
      at createServer (src/index.ts:134:18)
      at Object.<anonymous> (tests/sentry.test.ts:217:32)

  ● Sentry reporting › Schema validation errors are not reported to Sentry

    TypeError: formatter is not a function

      47 |
      48 | const serializers = {
    > 49 |   req: function asReqValue (req) {
         |              ^
      50 |     return {
      51 |       method: req.method,
      52 |       url: req.url,

      at genLsCache (../../../VariantsDeps/fastify/variant5/fastify/node_modules/pino/lib/levels.js:58:19)
      at pino (../../../VariantsDeps/fastify/variant5/fastify/node_modules/pino/pino.js:179:3)
      at createPinoLogger (../../../VariantsDeps/fastify/variant5/fastify/lib/logger.js:49:14)
      at createLogger (../../../VariantsDeps/fastify/variant5/fastify/lib/logger.js:115:20)
      at fastify (../../../VariantsDeps/fastify/variant5/fastify/fastify.js:154:7)
      at createServer (src/index.ts:134:18)
      at Object.<anonymous> (tests/sentry.test.ts:236:32)

Test Suites: 6 failed, 6 total
Tests:       26 failed, 26 total
Snapshots:   0 total
Time:        33.107 s
Ran all test suites.
FAIL tests/logger.test.ts (23.142 s)
  Logger
    ✕ name property (5002 ms)
    ✕ redact environment variables (5002 ms)
    ✕ redact log paths (5001 ms)
    ✕ request ID generator (5002 ms)

  ● Logger › name property

    thrown: "Exceeded timeout of 5000 ms for a test.
    Use jest.setTimeout(newTimeout) to increase the timeout value, if this is a long-running test."

      2 |
      3 | describe('Logger', () => {
    > 4 |   test('name property', async () => {
        |   ^
      5 |     const [logLine] = await testLogs(logLine => logLine.dataTestID === 'name')
      6 |     expect(logLine.from).toEqual('foo')
      7 |   })

      at tests/logger.test.ts:4:3
      at Object.<anonymous> (tests/logger.test.ts:3:1)

  ● Logger › redact environment variables

    thrown: "Exceeded timeout of 5000 ms for a test.
    Use jest.setTimeout(newTimeout) to increase the timeout value, if this is a long-running test."

       7 |   })
       8 |
    >  9 |   test('redact environment variables', async () => {
         |   ^
      10 |     const [logLine] = await testLogs(
      11 |       logLine => logLine.dataTestID === 'redact-env'
      12 |     )

      at tests/logger.test.ts:9:3
      at Object.<anonymous> (tests/logger.test.ts:3:1)

  ● Logger › redact log paths

    thrown: "Exceeded timeout of 5000 ms for a test.
    Use jest.setTimeout(newTimeout) to increase the timeout value, if this is a long-running test."

      14 |   })
      15 |
    > 16 |   test('redact log paths', async () => {
         |   ^
      17 |     const [logLine] = await testLogs(
      18 |       logLine => logLine.dataTestID === 'redact-path'
      19 |     )

      at tests/logger.test.ts:16:3
      at Object.<anonymous> (tests/logger.test.ts:3:1)

  ● Logger › request ID generator

    thrown: "Exceeded timeout of 5000 ms for a test.
    Use jest.setTimeout(newTimeout) to increase the timeout value, if this is a long-running test."

      21 |   })
      22 |
    > 23 |   test('request ID generator', async () => {
         |   ^
      24 |     type ReqResLog = { reqId: string }
      25 |
      26 |     const [req1, res1, req2, res2, req3, res3, req4, res4] =

      at tests/logger.test.ts:23:3
      at Object.<anonymous> (tests/logger.test.ts:3:1)

ts-jest[ts-jest-transformer] (WARN) Got a `.js` file to compile while `allowJs` option is not set to `true` (file: /data/js-variants/multee/VariantsDeps/fastify/variant4/fastify/fastify.js). To fix this:
  - if you want TypeScript to process JS files, set `allowJs` to `true` in your TypeScript config (usually tsconfig.json)
  - if you do not want TypeScript to process your `.js` files, in your Jest config change the `transform` key which value is `ts-jest` so that it does not match `.js` files anymore
Browserslist: caniuse-lite is outdated. Please run:
  npx browserslist@latest --update-db
  Why you should do it regularly: https://github.com/browserslist/browserslist#browsers-data-updating
ts-jest[ts-jest-transformer] (WARN) Got a `.js` file to compile while `allowJs` option is not set to `true` (file: /data/js-variants/multee/VariantsDeps/fastify/variant4/fastify/lib/symbols.js). To fix this:
  - if you want TypeScript to process JS files, set `allowJs` to `true` in your TypeScript config (usually tsconfig.json)
  - if you do not want TypeScript to process your `.js` files, in your Jest config change the `transform` key which value is `ts-jest` so that it does not match `.js` files anymore
ts-jest[ts-jest-transformer] (WARN) Got a `.js` file to compile while `allowJs` option is not set to `true` (file: /data/js-variants/multee/VariantsDeps/fastify/variant4/fastify/lib/server.js). To fix this:
  - if you want TypeScript to process JS files, set `allowJs` to `true` in your TypeScript config (usually tsconfig.json)
  - if you do not want TypeScript to process your `.js` files, in your Jest config change the `transform` key which value is `ts-jest` so that it does not match `.js` files anymore
ts-jest[ts-jest-transformer] (WARN) Got a `.js` file to compile while `allowJs` option is not set to `true` (file: /data/js-variants/multee/VariantsDeps/fastify/variant4/fastify/lib/warnings.js). To fix this:
  - if you want TypeScript to process JS files, set `allowJs` to `true` in your TypeScript config (usually tsconfig.json)
  - if you do not want TypeScript to process your `.js` files, in your Jest config change the `transform` key which value is `ts-jest` so that it does not match `.js` files anymore
ts-jest[ts-jest-transformer] (WARN) Got a `.js` file to compile while `allowJs` option is not set to `true` (file: /data/js-variants/multee/VariantsDeps/fastify/variant4/fastify/lib/errors.js). To fix this:
  - if you want TypeScript to process JS files, set `allowJs` to `true` in your TypeScript config (usually tsconfig.json)
  - if you do not want TypeScript to process your `.js` files, in your Jest config change the `transform` key which value is `ts-jest` so that it does not match `.js` files anymore
ts-jest[ts-jest-transformer] (WARN) Got a `.js` file to compile while `allowJs` option is not set to `true` (file: /data/js-variants/multee/VariantsDeps/fastify/variant4/fastify/lib/reply.js). To fix this:
  - if you want TypeScript to process JS files, set `allowJs` to `true` in your TypeScript config (usually tsconfig.json)
  - if you do not want TypeScript to process your `.js` files, in your Jest config change the `transform` key which value is `ts-jest` so that it does not match `.js` files anymore
ts-jest[ts-jest-transformer] (WARN) Got a `.js` file to compile while `allowJs` option is not set to `true` (file: /data/js-variants/multee/VariantsDeps/fastify/variant4/fastify/lib/hooks.js). To fix this:
  - if you want TypeScript to process JS files, set `allowJs` to `true` in your TypeScript config (usually tsconfig.json)
  - if you do not want TypeScript to process your `.js` files, in your Jest config change the `transform` key which value is `ts-jest` so that it does not match `.js` files anymore
ts-jest[ts-jest-transformer] (WARN) Got a `.js` file to compile while `allowJs` option is not set to `true` (file: /data/js-variants/multee/VariantsDeps/fastify/variant4/fastify/lib/handleRequest.js). To fix this:
  - if you want TypeScript to process JS files, set `allowJs` to `true` in your TypeScript config (usually tsconfig.json)
  - if you do not want TypeScript to process your `.js` files, in your Jest config change the `transform` key which value is `ts-jest` so that it does not match `.js` files anymore
ts-jest[ts-jest-transformer] (WARN) Got a `.js` file to compile while `allowJs` option is not set to `true` (file: /data/js-variants/multee/VariantsDeps/fastify/variant4/fastify/lib/validation.js). To fix this:
  - if you want TypeScript to process JS files, set `allowJs` to `true` in your TypeScript config (usually tsconfig.json)
  - if you do not want TypeScript to process your `.js` files, in your Jest config change the `transform` key which value is `ts-jest` so that it does not match `.js` files anymore
ts-jest[ts-jest-transformer] (WARN) Got a `.js` file to compile while `allowJs` option is not set to `true` (file: /data/js-variants/multee/VariantsDeps/fastify/variant4/fastify/lib/wrapThenable.js). To fix this:
  - if you want TypeScript to process JS files, set `allowJs` to `true` in your TypeScript config (usually tsconfig.json)
  - if you do not want TypeScript to process your `.js` files, in your Jest config change the `transform` key which value is `ts-jest` so that it does not match `.js` files anymore
ts-jest[ts-jest-transformer] (WARN) Got a `.js` file to compile while `allowJs` option is not set to `true` (file: /data/js-variants/multee/VariantsDeps/fastify/variant4/fastify/lib/logger.js). To fix this:
  - if you want TypeScript to process JS files, set `allowJs` to `true` in your TypeScript config (usually tsconfig.json)
  - if you do not want TypeScript to process your `.js` files, in your Jest config change the `transform` key which value is `ts-jest` so that it does not match `.js` files anymore
ts-jest[ts-jest-transformer] (WARN) Got a `.js` file to compile while `allowJs` option is not set to `true` (file: /data/js-variants/multee/VariantsDeps/fastify/variant4/fastify/lib/error-handler.js). To fix this:
  - if you want TypeScript to process JS files, set `allowJs` to `true` in your TypeScript config (usually tsconfig.json)
  - if you do not want TypeScript to process your `.js` files, in your Jest config change the `transform` key which value is `ts-jest` so that it does not match `.js` files anymore
ts-jest[ts-jest-transformer] (WARN) Got a `.js` file to compile while `allowJs` option is not set to `true` (file: /data/js-variants/multee/VariantsDeps/fastify/variant4/fastify/lib/schemas.js). To fix this:
  - if you want TypeScript to process JS files, set `allowJs` to `true` in your TypeScript config (usually tsconfig.json)
  - if you do not want TypeScript to process your `.js` files, in your Jest config change the `transform` key which value is `ts-jest` so that it does not match `.js` files anymore
ts-jest[ts-jest-transformer] (WARN) Got a `.js` file to compile while `allowJs` option is not set to `true` (file: /data/js-variants/multee/VariantsDeps/fastify/variant4/fastify/lib/error-serializer.js). To fix this:
  - if you want TypeScript to process JS files, set `allowJs` to `true` in your TypeScript config (usually tsconfig.json)
  - if you do not want TypeScript to process your `.js` files, in your Jest config change the `transform` key which value is `ts-jest` so that it does not match `.js` files anymore
ts-jest[ts-jest-transformer] (WARN) Got a `.js` file to compile while `allowJs` option is not set to `true` (file: /data/js-variants/multee/VariantsDeps/fastify/variant4/fastify/lib/request.js). To fix this:
  - if you want TypeScript to process JS files, set `allowJs` to `true` in your TypeScript config (usually tsconfig.json)
  - if you do not want TypeScript to process your `.js` files, in your Jest config change the `transform` key which value is `ts-jest` so that it does not match `.js` files anymore
ts-jest[ts-jest-transformer] (WARN) Got a `.js` file to compile while `allowJs` option is not set to `true` (file: /data/js-variants/multee/VariantsDeps/fastify/variant4/fastify/lib/decorate.js). To fix this:
  - if you want TypeScript to process JS files, set `allowJs` to `true` in your TypeScript config (usually tsconfig.json)
  - if you do not want TypeScript to process your `.js` files, in your Jest config change the `transform` key which value is `ts-jest` so that it does not match `.js` files anymore
ts-jest[ts-jest-transformer] (WARN) Got a `.js` file to compile while `allowJs` option is not set to `true` (file: /data/js-variants/multee/VariantsDeps/fastify/variant4/fastify/lib/contentTypeParser.js). To fix this:
  - if you want TypeScript to process JS files, set `allowJs` to `true` in your TypeScript config (usually tsconfig.json)
  - if you do not want TypeScript to process your `.js` files, in your Jest config change the `transform` key which value is `ts-jest` so that it does not match `.js` files anymore
ts-jest[ts-jest-transformer] (WARN) Got a `.js` file to compile while `allowJs` option is not set to `true` (file: /data/js-variants/multee/VariantsDeps/fastify/variant4/fastify/lib/schema-controller.js). To fix this:
  - if you want TypeScript to process JS files, set `allowJs` to `true` in your TypeScript config (usually tsconfig.json)
  - if you do not want TypeScript to process your `.js` files, in your Jest config change the `transform` key which value is `ts-jest` so that it does not match `.js` files anymore
ts-jest[ts-jest-transformer] (WARN) Got a `.js` file to compile while `allowJs` option is not set to `true` (file: /data/js-variants/multee/VariantsDeps/fastify/variant4/fastify/lib/pluginUtils.js). To fix this:
  - if you want TypeScript to process JS files, set `allowJs` to `true` in your TypeScript config (usually tsconfig.json)
  - if you do not want TypeScript to process your `.js` files, in your Jest config change the `transform` key which value is `ts-jest` so that it does not match `.js` files anymore
ts-jest[ts-jest-transformer] (WARN) Got a `.js` file to compile while `allowJs` option is not set to `true` (file: /data/js-variants/multee/VariantsDeps/fastify/variant4/fastify/lib/reqIdGenFactory.js). To fix this:
  - if you want TypeScript to process JS files, set `allowJs` to `true` in your TypeScript config (usually tsconfig.json)
  - if you do not want TypeScript to process your `.js` files, in your Jest config change the `transform` key which value is `ts-jest` so that it does not match `.js` files anymore
ts-jest[ts-jest-transformer] (WARN) Got a `.js` file to compile while `allowJs` option is not set to `true` (file: /data/js-variants/multee/VariantsDeps/fastify/variant4/fastify/lib/route.js). To fix this:
  - if you want TypeScript to process JS files, set `allowJs` to `true` in your TypeScript config (usually tsconfig.json)
  - if you do not want TypeScript to process your `.js` files, in your Jest config change the `transform` key which value is `ts-jest` so that it does not match `.js` files anymore
ts-jest[ts-jest-transformer] (WARN) Got a `.js` file to compile while `allowJs` option is not set to `true` (file: /data/js-variants/multee/VariantsDeps/fastify/variant4/fastify/lib/context.js). To fix this:
  - if you want TypeScript to process JS files, set `allowJs` to `true` in your TypeScript config (usually tsconfig.json)
  - if you do not want TypeScript to process your `.js` files, in your Jest config change the `transform` key which value is `ts-jest` so that it does not match `.js` files anymore
ts-jest[ts-jest-transformer] (WARN) Got a `.js` file to compile while `allowJs` option is not set to `true` (file: /data/js-variants/multee/VariantsDeps/fastify/variant4/fastify/lib/headRoute.js). To fix this:
  - if you want TypeScript to process JS files, set `allowJs` to `true` in your TypeScript config (usually tsconfig.json)
  - if you do not want TypeScript to process your `.js` files, in your Jest config change the `transform` key which value is `ts-jest` so that it does not match `.js` files anymore
ts-jest[ts-jest-transformer] (WARN) Got a `.js` file to compile while `allowJs` option is not set to `true` (file: /data/js-variants/multee/VariantsDeps/fastify/variant4/fastify/lib/fourOhFour.js). To fix this:
  - if you want TypeScript to process JS files, set `allowJs` to `true` in your TypeScript config (usually tsconfig.json)
  - if you do not want TypeScript to process your `.js` files, in your Jest config change the `transform` key which value is `ts-jest` so that it does not match `.js` files anymore
ts-jest[ts-jest-transformer] (WARN) Got a `.js` file to compile while `allowJs` option is not set to `true` (file: /data/js-variants/multee/VariantsDeps/fastify/variant4/fastify/lib/initialConfigValidation.js). To fix this:
  - if you want TypeScript to process JS files, set `allowJs` to `true` in your TypeScript config (usually tsconfig.json)
  - if you do not want TypeScript to process your `.js` files, in your Jest config change the `transform` key which value is `ts-jest` so that it does not match `.js` files anymore
ts-jest[ts-jest-transformer] (WARN) Got a `.js` file to compile while `allowJs` option is not set to `true` (file: /data/js-variants/multee/VariantsDeps/fastify/variant4/fastify/lib/configValidator.js). To fix this:
  - if you want TypeScript to process JS files, set `allowJs` to `true` in your TypeScript config (usually tsconfig.json)
  - if you do not want TypeScript to process your `.js` files, in your Jest config change the `transform` key which value is `ts-jest` so that it does not match `.js` files anymore
ts-jest[ts-jest-transformer] (WARN) Got a `.js` file to compile while `allowJs` option is not set to `true` (file: /data/js-variants/multee/VariantsDeps/fastify/variant4/fastify/lib/pluginOverride.js). To fix this:
  - if you want TypeScript to process JS files, set `allowJs` to `true` in your TypeScript config (usually tsconfig.json)
  - if you do not want TypeScript to process your `.js` files, in your Jest config change the `transform` key which value is `ts-jest` so that it does not match `.js` files anymore
ts-jest[ts-jest-transformer] (WARN) Got a `.js` file to compile while `allowJs` option is not set to `true` (file: /data/js-variants/multee/VariantsDeps/fastify/variant4/fastify/lib/noop-set.js). To fix this:
  - if you want TypeScript to process JS files, set `allowJs` to `true` in your TypeScript config (usually tsconfig.json)
  - if you do not want TypeScript to process your `.js` files, in your Jest config change the `transform` key which value is `ts-jest` so that it does not match `.js` files anymore
FAIL tests/basics.test.ts (8.867 s)
  Basics
    ✕ The specified `name` property is injected (8 ms)
    ✕ Default port should be 3000 (4 ms)
    ✕ Port should be configurable via the environment (5 ms)
    ✕ Port can be passed as a second argument to `startServer` (5 ms)

  ● Basics › The specified `name` property is injected

    TypeError: rx.exec is not a function

      47 |
      48 | const serializers = {
    > 49 |   req: function asReqValue (req) {
         |              ^
      50 |     return {
      51 |       method: req.method,
      52 |       url: req.url,

      at ../../../VariantsDeps/fastify/variant4/fastify/node_modules/pino/lib/redaction.js:20:22
          at Array.reduce (<anonymous>)
      at redaction (../../../VariantsDeps/fastify/variant4/fastify/node_modules/pino/lib/redaction.js:18:23)
      at pino (../../../VariantsDeps/fastify/variant4/fastify/node_modules/pino/pino.js:116:33)
      at createPinoLogger (../../../VariantsDeps/fastify/variant4/fastify/lib/logger.js:49:14)
      at createLogger (../../../VariantsDeps/fastify/variant4/fastify/lib/logger.js:115:20)
      at fastify (../../../VariantsDeps/fastify/variant4/fastify/fastify.js:154:7)
      at createServer (src/index.ts:134:18)
      at Object.<anonymous> (tests/basics.test.ts:11:39)

  ● Basics › Default port should be 3000

    TypeError: rx.exec is not a function

      47 |
      48 | const serializers = {
    > 49 |   req: function asReqValue (req) {
         |              ^
      50 |     return {
      51 |       method: req.method,
      52 |       url: req.url,

      at ../../../VariantsDeps/fastify/variant4/fastify/node_modules/pino/lib/redaction.js:20:22
          at Array.reduce (<anonymous>)
      at redaction (../../../VariantsDeps/fastify/variant4/fastify/node_modules/pino/lib/redaction.js:18:23)
      at pino (../../../VariantsDeps/fastify/variant4/fastify/node_modules/pino/pino.js:116:33)
      at createPinoLogger (../../../VariantsDeps/fastify/variant4/fastify/lib/logger.js:49:14)
      at createLogger (../../../VariantsDeps/fastify/variant4/fastify/lib/logger.js:115:20)
      at fastify (../../../VariantsDeps/fastify/variant4/fastify/fastify.js:154:7)
      at createServer (src/index.ts:134:18)
      at Object.<anonymous> (tests/basics.test.ts:19:32)

  ● Basics › Port should be configurable via the environment

    TypeError: rx.exec is not a function

      47 |
      48 | const serializers = {
    > 49 |   req: function asReqValue (req) {
         |              ^
      50 |     return {
      51 |       method: req.method,
      52 |       url: req.url,

      at ../../../VariantsDeps/fastify/variant4/fastify/node_modules/pino/lib/redaction.js:20:22
          at Array.reduce (<anonymous>)
      at redaction (../../../VariantsDeps/fastify/variant4/fastify/node_modules/pino/lib/redaction.js:18:23)
      at pino (../../../VariantsDeps/fastify/variant4/fastify/node_modules/pino/pino.js:116:33)
      at createPinoLogger (../../../VariantsDeps/fastify/variant4/fastify/lib/logger.js:49:14)
      at createLogger (../../../VariantsDeps/fastify/variant4/fastify/lib/logger.js:115:20)
      at fastify (../../../VariantsDeps/fastify/variant4/fastify/fastify.js:154:7)
      at createServer (src/index.ts:134:18)
      at Object.<anonymous> (tests/basics.test.ts:32:32)

  ● Basics › Port can be passed as a second argument to `startServer`

    TypeError: rx.exec is not a function

      47 |
      48 | const serializers = {
    > 49 |   req: function asReqValue (req) {
         |              ^
      50 |     return {
      51 |       method: req.method,
      52 |       url: req.url,

      at ../../../VariantsDeps/fastify/variant4/fastify/node_modules/pino/lib/redaction.js:20:22
          at Array.reduce (<anonymous>)
      at redaction (../../../VariantsDeps/fastify/variant4/fastify/node_modules/pino/lib/redaction.js:18:23)
      at pino (../../../VariantsDeps/fastify/variant4/fastify/node_modules/pino/pino.js:116:33)
      at createPinoLogger (../../../VariantsDeps/fastify/variant4/fastify/lib/logger.js:49:14)
      at createLogger (../../../VariantsDeps/fastify/variant4/fastify/lib/logger.js:115:20)
      at fastify (../../../VariantsDeps/fastify/variant4/fastify/fastify.js:154:7)
      at createServer (src/index.ts:134:18)
      at Object.<anonymous> (tests/basics.test.ts:44:32)

FAIL tests/sentry.test.ts
  Sentry reporting
    ✕ Sentry is disabled without a DSN (8 ms)
    ✕ Sentry is enabled with a DSN (8 ms)
    ✕ Sentry report for route errors (5 ms)
    ✕ Sentry manual reports at app level (5 ms)
    ✕ Report enrichment in route (4 ms)
    ✕ Report enrichment, global getters (5 ms)
    ✕ User enrichment (5 ms)
    ✕ 4xx statuses are not reported to Sentry (5 ms)
    ✕ Schema validation errors are not reported to Sentry (5 ms)

  ● Sentry reporting › Sentry is disabled without a DSN

    TypeError: rx.exec is not a function

      47 |
      48 | const serializers = {
    > 49 |   req: function asReqValue (req) {
         |              ^
      50 |     return {
      51 |       method: req.method,
      52 |       url: req.url,

      at ../../../VariantsDeps/fastify/variant4/fastify/node_modules/pino/lib/redaction.js:20:22
          at Array.reduce (<anonymous>)
      at redaction (../../../VariantsDeps/fastify/variant4/fastify/node_modules/pino/lib/redaction.js:18:23)
      at pino (../../../VariantsDeps/fastify/variant4/fastify/node_modules/pino/pino.js:116:33)
      at createPinoLogger (../../../VariantsDeps/fastify/variant4/fastify/lib/logger.js:49:14)
      at createLogger (../../../VariantsDeps/fastify/variant4/fastify/lib/logger.js:115:20)
      at fastify (../../../VariantsDeps/fastify/variant4/fastify/fastify.js:154:7)
      at createServer (src/index.ts:134:18)
      at Object.<anonymous> (tests/sentry.test.ts:31:32)

  ● Sentry reporting › Sentry is enabled with a DSN

    TypeError: rx.exec is not a function

      47 |
      48 | const serializers = {
    > 49 |   req: function asReqValue (req) {
         |              ^
      50 |     return {
      51 |       method: req.method,
      52 |       url: req.url,

      at ../../../VariantsDeps/fastify/variant4/fastify/node_modules/pino/lib/redaction.js:20:22
          at Array.reduce (<anonymous>)
      at redaction (../../../VariantsDeps/fastify/variant4/fastify/node_modules/pino/lib/redaction.js:18:23)
      at pino (../../../VariantsDeps/fastify/variant4/fastify/node_modules/pino/pino.js:116:33)
      at createPinoLogger (../../../VariantsDeps/fastify/variant4/fastify/lib/logger.js:49:14)
      at createLogger (../../../VariantsDeps/fastify/variant4/fastify/lib/logger.js:115:20)
      at fastify (../../../VariantsDeps/fastify/variant4/fastify/fastify.js:154:7)
      at createServer (src/index.ts:134:18)
      at Object.<anonymous> (tests/sentry.test.ts:48:32)

  ● Sentry reporting › Sentry report for route errors

    TypeError: rx.exec is not a function

      47 |
      48 | const serializers = {
    > 49 |   req: function asReqValue (req) {
         |              ^
      50 |     return {
      51 |       method: req.method,
      52 |       url: req.url,

      at ../../../VariantsDeps/fastify/variant4/fastify/node_modules/pino/lib/redaction.js:20:22
          at Array.reduce (<anonymous>)
      at redaction (../../../VariantsDeps/fastify/variant4/fastify/node_modules/pino/lib/redaction.js:18:23)
      at pino (../../../VariantsDeps/fastify/variant4/fastify/node_modules/pino/pino.js:116:33)
      at createPinoLogger (../../../VariantsDeps/fastify/variant4/fastify/lib/logger.js:49:14)
      at createLogger (../../../VariantsDeps/fastify/variant4/fastify/lib/logger.js:115:20)
      at fastify (../../../VariantsDeps/fastify/variant4/fastify/fastify.js:154:7)
      at createServer (src/index.ts:134:18)
      at Object.<anonymous> (tests/sentry.test.ts:67:32)

  ● Sentry reporting › Sentry manual reports at app level

    TypeError: rx.exec is not a function

      47 |
      48 | const serializers = {
    > 49 |   req: function asReqValue (req) {
         |              ^
      50 |     return {
      51 |       method: req.method,
      52 |       url: req.url,

      at ../../../VariantsDeps/fastify/variant4/fastify/node_modules/pino/lib/redaction.js:20:22
          at Array.reduce (<anonymous>)
      at redaction (../../../VariantsDeps/fastify/variant4/fastify/node_modules/pino/lib/redaction.js:18:23)
      at pino (../../../VariantsDeps/fastify/variant4/fastify/node_modules/pino/pino.js:116:33)
      at createPinoLogger (../../../VariantsDeps/fastify/variant4/fastify/lib/logger.js:49:14)
      at createLogger (../../../VariantsDeps/fastify/variant4/fastify/lib/logger.js:115:20)
      at fastify (../../../VariantsDeps/fastify/variant4/fastify/fastify.js:154:7)
      at createServer (src/index.ts:134:18)
      at Object.<anonymous> (tests/sentry.test.ts:91:32)

  ● Sentry reporting › Report enrichment in route

    TypeError: rx.exec is not a function

      47 |
      48 | const serializers = {
    > 49 |   req: function asReqValue (req) {
         |              ^
      50 |     return {
      51 |       method: req.method,
      52 |       url: req.url,

      at ../../../VariantsDeps/fastify/variant4/fastify/node_modules/pino/lib/redaction.js:20:22
          at Array.reduce (<anonymous>)
      at redaction (../../../VariantsDeps/fastify/variant4/fastify/node_modules/pino/lib/redaction.js:18:23)
      at pino (../../../VariantsDeps/fastify/variant4/fastify/node_modules/pino/pino.js:116:33)
      at createPinoLogger (../../../VariantsDeps/fastify/variant4/fastify/lib/logger.js:49:14)
      at createLogger (../../../VariantsDeps/fastify/variant4/fastify/lib/logger.js:115:20)
      at fastify (../../../VariantsDeps/fastify/variant4/fastify/fastify.js:154:7)
      at createServer (src/index.ts:134:18)
      at Object.<anonymous> (tests/sentry.test.ts:110:32)

  ● Sentry reporting › Report enrichment, global getters

    TypeError: rx.exec is not a function

      47 |
      48 | const serializers = {
    > 49 |   req: function asReqValue (req) {
         |              ^
      50 |     return {
      51 |       method: req.method,
      52 |       url: req.url,

      at ../../../VariantsDeps/fastify/variant4/fastify/node_modules/pino/lib/redaction.js:20:22
          at Array.reduce (<anonymous>)
      at redaction (../../../VariantsDeps/fastify/variant4/fastify/node_modules/pino/lib/redaction.js:18:23)
      at pino (../../../VariantsDeps/fastify/variant4/fastify/node_modules/pino/pino.js:116:33)
      at createPinoLogger (../../../VariantsDeps/fastify/variant4/fastify/lib/logger.js:49:14)
      at createLogger (../../../VariantsDeps/fastify/variant4/fastify/lib/logger.js:115:20)
      at fastify (../../../VariantsDeps/fastify/variant4/fastify/fastify.js:154:7)
      at createServer (src/index.ts:134:18)
      at Object.<anonymous> (tests/sentry.test.ts:160:32)

  ● Sentry reporting › User enrichment

    TypeError: rx.exec is not a function

      47 |
      48 | const serializers = {
    > 49 |   req: function asReqValue (req) {
         |              ^
      50 |     return {
      51 |       method: req.method,
      52 |       url: req.url,

      at ../../../VariantsDeps/fastify/variant4/fastify/node_modules/pino/lib/redaction.js:20:22
          at Array.reduce (<anonymous>)
      at redaction (../../../VariantsDeps/fastify/variant4/fastify/node_modules/pino/lib/redaction.js:18:23)
      at pino (../../../VariantsDeps/fastify/variant4/fastify/node_modules/pino/pino.js:116:33)
      at createPinoLogger (../../../VariantsDeps/fastify/variant4/fastify/lib/logger.js:49:14)
      at createLogger (../../../VariantsDeps/fastify/variant4/fastify/lib/logger.js:115:20)
      at fastify (../../../VariantsDeps/fastify/variant4/fastify/fastify.js:154:7)
      at createServer (src/index.ts:134:18)
      at Object.<anonymous> (tests/sentry.test.ts:186:32)

  ● Sentry reporting › 4xx statuses are not reported to Sentry

    TypeError: rx.exec is not a function

      47 |
      48 | const serializers = {
    > 49 |   req: function asReqValue (req) {
         |              ^
      50 |     return {
      51 |       method: req.method,
      52 |       url: req.url,

      at ../../../VariantsDeps/fastify/variant4/fastify/node_modules/pino/lib/redaction.js:20:22
          at Array.reduce (<anonymous>)
      at redaction (../../../VariantsDeps/fastify/variant4/fastify/node_modules/pino/lib/redaction.js:18:23)
      at pino (../../../VariantsDeps/fastify/variant4/fastify/node_modules/pino/pino.js:116:33)
      at createPinoLogger (../../../VariantsDeps/fastify/variant4/fastify/lib/logger.js:49:14)
      at createLogger (../../../VariantsDeps/fastify/variant4/fastify/lib/logger.js:115:20)
      at fastify (../../../VariantsDeps/fastify/variant4/fastify/fastify.js:154:7)
      at createServer (src/index.ts:134:18)
      at Object.<anonymous> (tests/sentry.test.ts:217:32)

  ● Sentry reporting › Schema validation errors are not reported to Sentry

    TypeError: rx.exec is not a function

      47 |
      48 | const serializers = {
    > 49 |   req: function asReqValue (req) {
         |              ^
      50 |     return {
      51 |       method: req.method,
      52 |       url: req.url,

      at ../../../VariantsDeps/fastify/variant4/fastify/node_modules/pino/lib/redaction.js:20:22
          at Array.reduce (<anonymous>)
      at redaction (../../../VariantsDeps/fastify/variant4/fastify/node_modules/pino/lib/redaction.js:18:23)
      at pino (../../../VariantsDeps/fastify/variant4/fastify/node_modules/pino/pino.js:116:33)
      at createPinoLogger (../../../VariantsDeps/fastify/variant4/fastify/lib/logger.js:49:14)
      at createLogger (../../../VariantsDeps/fastify/variant4/fastify/lib/logger.js:115:20)
      at fastify (../../../VariantsDeps/fastify/variant4/fastify/fastify.js:154:7)
      at createServer (src/index.ts:134:18)
      at Object.<anonymous> (tests/sentry.test.ts:236:32)

FAIL tests/plugins.test.ts
  Plugins
    ✕ Loading plugins & routes from filesystem (8 ms)
    ✕ Graceful exit (4 ms)
    ✕ Graceful exit with a slow onClose hook (4 ms)

  ● Plugins › Loading plugins & routes from filesystem

    TypeError: rx.exec is not a function

      47 |
      48 | const serializers = {
    > 49 |   req: function asReqValue (req) {
         |              ^
      50 |     return {
      51 |       method: req.method,
      52 |       url: req.url,

      at ../../../VariantsDeps/fastify/variant4/fastify/node_modules/pino/lib/redaction.js:20:22
          at Array.reduce (<anonymous>)
      at redaction (../../../VariantsDeps/fastify/variant4/fastify/node_modules/pino/lib/redaction.js:18:23)
      at pino (../../../VariantsDeps/fastify/variant4/fastify/node_modules/pino/pino.js:116:33)
      at createPinoLogger (../../../VariantsDeps/fastify/variant4/fastify/lib/logger.js:49:14)
      at createLogger (../../../VariantsDeps/fastify/variant4/fastify/lib/logger.js:115:20)
      at fastify (../../../VariantsDeps/fastify/variant4/fastify/fastify.js:154:7)
      at createServer (src/index.ts:134:18)
      at Object.<anonymous> (tests/plugins.test.ts:14:32)

  ● Plugins › Graceful exit

    TypeError: rx.exec is not a function

      47 |
      48 | const serializers = {
    > 49 |   req: function asReqValue (req) {
         |              ^
      50 |     return {
      51 |       method: req.method,
      52 |       url: req.url,

      at ../../../VariantsDeps/fastify/variant4/fastify/node_modules/pino/lib/redaction.js:20:22
          at Array.reduce (<anonymous>)
      at redaction (../../../VariantsDeps/fastify/variant4/fastify/node_modules/pino/lib/redaction.js:18:23)
      at pino (../../../VariantsDeps/fastify/variant4/fastify/node_modules/pino/pino.js:116:33)
      at createPinoLogger (../../../VariantsDeps/fastify/variant4/fastify/lib/logger.js:49:14)
      at createLogger (../../../VariantsDeps/fastify/variant4/fastify/lib/logger.js:115:20)
      at fastify (../../../VariantsDeps/fastify/variant4/fastify/fastify.js:154:7)
      at createServer (src/index.ts:134:18)
      at Object.<anonymous> (tests/plugins.test.ts:32:32)

  ● Plugins › Graceful exit with a slow onClose hook

    TypeError: rx.exec is not a function

      47 |
      48 | const serializers = {
    > 49 |   req: function asReqValue (req) {
         |              ^
      50 |     return {
      51 |       method: req.method,
      52 |       url: req.url,

      at ../../../VariantsDeps/fastify/variant4/fastify/node_modules/pino/lib/redaction.js:20:22
          at Array.reduce (<anonymous>)
      at redaction (../../../VariantsDeps/fastify/variant4/fastify/node_modules/pino/lib/redaction.js:18:23)
      at pino (../../../VariantsDeps/fastify/variant4/fastify/node_modules/pino/pino.js:116:33)
      at createPinoLogger (../../../VariantsDeps/fastify/variant4/fastify/lib/logger.js:49:14)
      at createLogger (../../../VariantsDeps/fastify/variant4/fastify/lib/logger.js:115:20)
      at fastify (../../../VariantsDeps/fastify/variant4/fastify/fastify.js:154:7)
      at createServer (src/index.ts:134:18)
      at Object.<anonymous> (tests/plugins.test.ts:47:32)

FAIL tests/health.test.ts
  Health checks
    ✕ Default configuration exposes a /_health route (8 ms)
    ✕ Custom health check handler is called at startup and every 5 seconds (6 ms)
    ✕ Custom health check throwing results in 503 (5 ms)
    ✕ Disabled health monitoring (4 ms)

  ● Health checks › Default configuration exposes a /_health route

    TypeError: rx.exec is not a function

      47 |
      48 | const serializers = {
    > 49 |   req: function asReqValue (req) {
         |              ^
      50 |     return {
      51 |       method: req.method,
      52 |       url: req.url,

      at ../../../VariantsDeps/fastify/variant4/fastify/node_modules/pino/lib/redaction.js:20:22
          at Array.reduce (<anonymous>)
      at redaction (../../../VariantsDeps/fastify/variant4/fastify/node_modules/pino/lib/redaction.js:18:23)
      at pino (../../../VariantsDeps/fastify/variant4/fastify/node_modules/pino/pino.js:116:33)
      at createPinoLogger (../../../VariantsDeps/fastify/variant4/fastify/lib/logger.js:49:14)
      at createLogger (../../../VariantsDeps/fastify/variant4/fastify/lib/logger.js:115:20)
      at fastify (../../../VariantsDeps/fastify/variant4/fastify/fastify.js:154:7)
      at createServer (src/index.ts:134:18)
      at Object.<anonymous> (tests/health.test.ts:9:32)

  ● Health checks › Custom health check handler is called at startup and every 5 seconds

    TypeError: rx.exec is not a function

      47 |
      48 | const serializers = {
    > 49 |   req: function asReqValue (req) {
         |              ^
      50 |     return {
      51 |       method: req.method,
      52 |       url: req.url,

      at ../../../VariantsDeps/fastify/variant4/fastify/node_modules/pino/lib/redaction.js:20:22
          at Array.reduce (<anonymous>)
      at redaction (../../../VariantsDeps/fastify/variant4/fastify/node_modules/pino/lib/redaction.js:18:23)
      at pino (../../../VariantsDeps/fastify/variant4/fastify/node_modules/pino/pino.js:116:33)
      at createPinoLogger (../../../VariantsDeps/fastify/variant4/fastify/lib/logger.js:49:14)
      at createLogger (../../../VariantsDeps/fastify/variant4/fastify/lib/logger.js:115:20)
      at fastify (../../../VariantsDeps/fastify/variant4/fastify/fastify.js:154:7)
      at createServer (src/index.ts:134:18)
      at Object.<anonymous> (tests/health.test.ts:19:32)

  ● Health checks › Custom health check throwing results in 503

    TypeError: rx.exec is not a function

      47 |
      48 | const serializers = {
    > 49 |   req: function asReqValue (req) {
         |              ^
      50 |     return {
      51 |       method: req.method,
      52 |       url: req.url,

      at ../../../VariantsDeps/fastify/variant4/fastify/node_modules/pino/lib/redaction.js:20:22
          at Array.reduce (<anonymous>)
      at redaction (../../../VariantsDeps/fastify/variant4/fastify/node_modules/pino/lib/redaction.js:18:23)
      at pino (../../../VariantsDeps/fastify/variant4/fastify/node_modules/pino/pino.js:116:33)
      at createPinoLogger (../../../VariantsDeps/fastify/variant4/fastify/lib/logger.js:49:14)
      at createLogger (../../../VariantsDeps/fastify/variant4/fastify/lib/logger.js:115:20)
      at fastify (../../../VariantsDeps/fastify/variant4/fastify/fastify.js:154:7)
      at createServer (src/index.ts:134:18)
      at Object.<anonymous> (tests/health.test.ts:38:32)

  ● Health checks › Disabled health monitoring

    TypeError: rx.exec is not a function

      47 |
      48 | const serializers = {
    > 49 |   req: function asReqValue (req) {
         |              ^
      50 |     return {
      51 |       method: req.method,
      52 |       url: req.url,

      at ../../../VariantsDeps/fastify/variant4/fastify/node_modules/pino/lib/redaction.js:20:22
          at Array.reduce (<anonymous>)
      at redaction (../../../VariantsDeps/fastify/variant4/fastify/node_modules/pino/lib/redaction.js:18:23)
      at pino (../../../VariantsDeps/fastify/variant4/fastify/node_modules/pino/pino.js:116:33)
      at createPinoLogger (../../../VariantsDeps/fastify/variant4/fastify/lib/logger.js:49:14)
      at createLogger (../../../VariantsDeps/fastify/variant4/fastify/lib/logger.js:115:20)
      at fastify (../../../VariantsDeps/fastify/variant4/fastify/fastify.js:154:7)
      at createServer (src/index.ts:134:18)
      at Object.<anonymous> (tests/health.test.ts:69:32)

FAIL tests/graceful.test.ts
  Graceful shutdown
    ✕ with custom handler (8 ms)
    ✕ with custom async handler (5 ms)

  ● Graceful shutdown › with custom handler

    TypeError: rx.exec is not a function

      47 |
      48 | const serializers = {
    > 49 |   req: function asReqValue (req) {
         |              ^
      50 |     return {
      51 |       method: req.method,
      52 |       url: req.url,

      at ../../../VariantsDeps/fastify/variant4/fastify/node_modules/pino/lib/redaction.js:20:22
          at Array.reduce (<anonymous>)
      at redaction (../../../VariantsDeps/fastify/variant4/fastify/node_modules/pino/lib/redaction.js:18:23)
      at pino (../../../VariantsDeps/fastify/variant4/fastify/node_modules/pino/pino.js:116:33)
      at createPinoLogger (../../../VariantsDeps/fastify/variant4/fastify/lib/logger.js:49:14)
      at createLogger (../../../VariantsDeps/fastify/variant4/fastify/lib/logger.js:115:20)
      at fastify (../../../VariantsDeps/fastify/variant4/fastify/fastify.js:154:7)
      at createServer (src/index.ts:134:18)
      at Object.<anonymous> (tests/graceful.test.ts:6:32)

  ● Graceful shutdown › with custom async handler

    TypeError: rx.exec is not a function

      47 |
      48 | const serializers = {
    > 49 |   req: function asReqValue (req) {
         |              ^
      50 |     return {
      51 |       method: req.method,
      52 |       url: req.url,

      at ../../../VariantsDeps/fastify/variant4/fastify/node_modules/pino/lib/redaction.js:20:22
          at Array.reduce (<anonymous>)
      at redaction (../../../VariantsDeps/fastify/variant4/fastify/node_modules/pino/lib/redaction.js:18:23)
      at pino (../../../VariantsDeps/fastify/variant4/fastify/node_modules/pino/pino.js:116:33)
      at createPinoLogger (../../../VariantsDeps/fastify/variant4/fastify/lib/logger.js:49:14)
      at createLogger (../../../VariantsDeps/fastify/variant4/fastify/lib/logger.js:115:20)
      at fastify (../../../VariantsDeps/fastify/variant4/fastify/fastify.js:154:7)
      at createServer (src/index.ts:134:18)
      at Object.<anonymous> (tests/graceful.test.ts:16:32)

Test Suites: 6 failed, 6 total
Tests:       26 failed, 26 total
Snapshots:   0 total
Time:        33.828 s
Ran all test suites.
FAIL tests/logger.test.ts (23.141 s)
  Logger
    ✕ name property (5001 ms)
    ✕ redact environment variables (5001 ms)
    ✕ redact log paths (5001 ms)
    ✕ request ID generator (5001 ms)

  ● Logger › name property

    thrown: "Exceeded timeout of 5000 ms for a test.
    Use jest.setTimeout(newTimeout) to increase the timeout value, if this is a long-running test."

      2 |
      3 | describe('Logger', () => {
    > 4 |   test('name property', async () => {
        |   ^
      5 |     const [logLine] = await testLogs(logLine => logLine.dataTestID === 'name')
      6 |     expect(logLine.from).toEqual('foo')
      7 |   })

      at tests/logger.test.ts:4:3
      at Object.<anonymous> (tests/logger.test.ts:3:1)

  ● Logger › redact environment variables

    thrown: "Exceeded timeout of 5000 ms for a test.
    Use jest.setTimeout(newTimeout) to increase the timeout value, if this is a long-running test."

       7 |   })
       8 |
    >  9 |   test('redact environment variables', async () => {
         |   ^
      10 |     const [logLine] = await testLogs(
      11 |       logLine => logLine.dataTestID === 'redact-env'
      12 |     )

      at tests/logger.test.ts:9:3
      at Object.<anonymous> (tests/logger.test.ts:3:1)

  ● Logger › redact log paths

    thrown: "Exceeded timeout of 5000 ms for a test.
    Use jest.setTimeout(newTimeout) to increase the timeout value, if this is a long-running test."

      14 |   })
      15 |
    > 16 |   test('redact log paths', async () => {
         |   ^
      17 |     const [logLine] = await testLogs(
      18 |       logLine => logLine.dataTestID === 'redact-path'
      19 |     )

      at tests/logger.test.ts:16:3
      at Object.<anonymous> (tests/logger.test.ts:3:1)

  ● Logger › request ID generator

    thrown: "Exceeded timeout of 5000 ms for a test.
    Use jest.setTimeout(newTimeout) to increase the timeout value, if this is a long-running test."

      21 |   })
      22 |
    > 23 |   test('request ID generator', async () => {
         |   ^
      24 |     type ReqResLog = { reqId: string }
      25 |
      26 |     const [req1, res1, req2, res2, req3, res3, req4, res4] =

      at tests/logger.test.ts:23:3
      at Object.<anonymous> (tests/logger.test.ts:3:1)

ts-jest[ts-jest-transformer] (WARN) Got a `.js` file to compile while `allowJs` option is not set to `true` (file: /data/js-variants/multee/VariantsDeps/fastify/variant3/fastify/fastify.js). To fix this:
  - if you want TypeScript to process JS files, set `allowJs` to `true` in your TypeScript config (usually tsconfig.json)
  - if you do not want TypeScript to process your `.js` files, in your Jest config change the `transform` key which value is `ts-jest` so that it does not match `.js` files anymore
Browserslist: caniuse-lite is outdated. Please run:
  npx browserslist@latest --update-db
  Why you should do it regularly: https://github.com/browserslist/browserslist#browsers-data-updating
ts-jest[ts-jest-transformer] (WARN) Got a `.js` file to compile while `allowJs` option is not set to `true` (file: /data/js-variants/multee/VariantsDeps/fastify/variant3/fastify/lib/symbols.js). To fix this:
  - if you want TypeScript to process JS files, set `allowJs` to `true` in your TypeScript config (usually tsconfig.json)
  - if you do not want TypeScript to process your `.js` files, in your Jest config change the `transform` key which value is `ts-jest` so that it does not match `.js` files anymore
ts-jest[ts-jest-transformer] (WARN) Got a `.js` file to compile while `allowJs` option is not set to `true` (file: /data/js-variants/multee/VariantsDeps/fastify/variant3/fastify/lib/server.js). To fix this:
  - if you want TypeScript to process JS files, set `allowJs` to `true` in your TypeScript config (usually tsconfig.json)
  - if you do not want TypeScript to process your `.js` files, in your Jest config change the `transform` key which value is `ts-jest` so that it does not match `.js` files anymore
ts-jest[ts-jest-transformer] (WARN) Got a `.js` file to compile while `allowJs` option is not set to `true` (file: /data/js-variants/multee/VariantsDeps/fastify/variant3/fastify/lib/warnings.js). To fix this:
  - if you want TypeScript to process JS files, set `allowJs` to `true` in your TypeScript config (usually tsconfig.json)
  - if you do not want TypeScript to process your `.js` files, in your Jest config change the `transform` key which value is `ts-jest` so that it does not match `.js` files anymore
ts-jest[ts-jest-transformer] (WARN) Got a `.js` file to compile while `allowJs` option is not set to `true` (file: /data/js-variants/multee/VariantsDeps/fastify/variant3/fastify/lib/errors.js). To fix this:
  - if you want TypeScript to process JS files, set `allowJs` to `true` in your TypeScript config (usually tsconfig.json)
  - if you do not want TypeScript to process your `.js` files, in your Jest config change the `transform` key which value is `ts-jest` so that it does not match `.js` files anymore
ts-jest[ts-jest-transformer] (WARN) Got a `.js` file to compile while `allowJs` option is not set to `true` (file: /data/js-variants/multee/VariantsDeps/fastify/variant3/fastify/lib/reply.js). To fix this:
  - if you want TypeScript to process JS files, set `allowJs` to `true` in your TypeScript config (usually tsconfig.json)
  - if you do not want TypeScript to process your `.js` files, in your Jest config change the `transform` key which value is `ts-jest` so that it does not match `.js` files anymore
ts-jest[ts-jest-transformer] (WARN) Got a `.js` file to compile while `allowJs` option is not set to `true` (file: /data/js-variants/multee/VariantsDeps/fastify/variant3/fastify/lib/hooks.js). To fix this:
  - if you want TypeScript to process JS files, set `allowJs` to `true` in your TypeScript config (usually tsconfig.json)
  - if you do not want TypeScript to process your `.js` files, in your Jest config change the `transform` key which value is `ts-jest` so that it does not match `.js` files anymore
ts-jest[ts-jest-transformer] (WARN) Got a `.js` file to compile while `allowJs` option is not set to `true` (file: /data/js-variants/multee/VariantsDeps/fastify/variant3/fastify/lib/handleRequest.js). To fix this:
  - if you want TypeScript to process JS files, set `allowJs` to `true` in your TypeScript config (usually tsconfig.json)
  - if you do not want TypeScript to process your `.js` files, in your Jest config change the `transform` key which value is `ts-jest` so that it does not match `.js` files anymore
ts-jest[ts-jest-transformer] (WARN) Got a `.js` file to compile while `allowJs` option is not set to `true` (file: /data/js-variants/multee/VariantsDeps/fastify/variant3/fastify/lib/validation.js). To fix this:
  - if you want TypeScript to process JS files, set `allowJs` to `true` in your TypeScript config (usually tsconfig.json)
  - if you do not want TypeScript to process your `.js` files, in your Jest config change the `transform` key which value is `ts-jest` so that it does not match `.js` files anymore
ts-jest[ts-jest-transformer] (WARN) Got a `.js` file to compile while `allowJs` option is not set to `true` (file: /data/js-variants/multee/VariantsDeps/fastify/variant3/fastify/lib/wrapThenable.js). To fix this:
  - if you want TypeScript to process JS files, set `allowJs` to `true` in your TypeScript config (usually tsconfig.json)
  - if you do not want TypeScript to process your `.js` files, in your Jest config change the `transform` key which value is `ts-jest` so that it does not match `.js` files anymore
ts-jest[ts-jest-transformer] (WARN) Got a `.js` file to compile while `allowJs` option is not set to `true` (file: /data/js-variants/multee/VariantsDeps/fastify/variant3/fastify/lib/logger.js). To fix this:
  - if you want TypeScript to process JS files, set `allowJs` to `true` in your TypeScript config (usually tsconfig.json)
  - if you do not want TypeScript to process your `.js` files, in your Jest config change the `transform` key which value is `ts-jest` so that it does not match `.js` files anymore
ts-jest[ts-jest-transformer] (WARN) Got a `.js` file to compile while `allowJs` option is not set to `true` (file: /data/js-variants/multee/VariantsDeps/fastify/variant3/fastify/lib/error-handler.js). To fix this:
  - if you want TypeScript to process JS files, set `allowJs` to `true` in your TypeScript config (usually tsconfig.json)
  - if you do not want TypeScript to process your `.js` files, in your Jest config change the `transform` key which value is `ts-jest` so that it does not match `.js` files anymore
ts-jest[ts-jest-transformer] (WARN) Got a `.js` file to compile while `allowJs` option is not set to `true` (file: /data/js-variants/multee/VariantsDeps/fastify/variant3/fastify/lib/schemas.js). To fix this:
  - if you want TypeScript to process JS files, set `allowJs` to `true` in your TypeScript config (usually tsconfig.json)
  - if you do not want TypeScript to process your `.js` files, in your Jest config change the `transform` key which value is `ts-jest` so that it does not match `.js` files anymore
ts-jest[ts-jest-transformer] (WARN) Got a `.js` file to compile while `allowJs` option is not set to `true` (file: /data/js-variants/multee/VariantsDeps/fastify/variant3/fastify/lib/error-serializer.js). To fix this:
  - if you want TypeScript to process JS files, set `allowJs` to `true` in your TypeScript config (usually tsconfig.json)
  - if you do not want TypeScript to process your `.js` files, in your Jest config change the `transform` key which value is `ts-jest` so that it does not match `.js` files anymore
ts-jest[ts-jest-transformer] (WARN) Got a `.js` file to compile while `allowJs` option is not set to `true` (file: /data/js-variants/multee/VariantsDeps/fastify/variant3/fastify/lib/request.js). To fix this:
  - if you want TypeScript to process JS files, set `allowJs` to `true` in your TypeScript config (usually tsconfig.json)
  - if you do not want TypeScript to process your `.js` files, in your Jest config change the `transform` key which value is `ts-jest` so that it does not match `.js` files anymore
ts-jest[ts-jest-transformer] (WARN) Got a `.js` file to compile while `allowJs` option is not set to `true` (file: /data/js-variants/multee/VariantsDeps/fastify/variant3/fastify/lib/decorate.js). To fix this:
  - if you want TypeScript to process JS files, set `allowJs` to `true` in your TypeScript config (usually tsconfig.json)
  - if you do not want TypeScript to process your `.js` files, in your Jest config change the `transform` key which value is `ts-jest` so that it does not match `.js` files anymore
ts-jest[ts-jest-transformer] (WARN) Got a `.js` file to compile while `allowJs` option is not set to `true` (file: /data/js-variants/multee/VariantsDeps/fastify/variant3/fastify/lib/contentTypeParser.js). To fix this:
  - if you want TypeScript to process JS files, set `allowJs` to `true` in your TypeScript config (usually tsconfig.json)
  - if you do not want TypeScript to process your `.js` files, in your Jest config change the `transform` key which value is `ts-jest` so that it does not match `.js` files anymore
ts-jest[ts-jest-transformer] (WARN) Got a `.js` file to compile while `allowJs` option is not set to `true` (file: /data/js-variants/multee/VariantsDeps/fastify/variant3/fastify/lib/schema-controller.js). To fix this:
  - if you want TypeScript to process JS files, set `allowJs` to `true` in your TypeScript config (usually tsconfig.json)
  - if you do not want TypeScript to process your `.js` files, in your Jest config change the `transform` key which value is `ts-jest` so that it does not match `.js` files anymore
ts-jest[ts-jest-transformer] (WARN) Got a `.js` file to compile while `allowJs` option is not set to `true` (file: /data/js-variants/multee/VariantsDeps/fastify/variant3/fastify/lib/pluginUtils.js). To fix this:
  - if you want TypeScript to process JS files, set `allowJs` to `true` in your TypeScript config (usually tsconfig.json)
  - if you do not want TypeScript to process your `.js` files, in your Jest config change the `transform` key which value is `ts-jest` so that it does not match `.js` files anymore
ts-jest[ts-jest-transformer] (WARN) Got a `.js` file to compile while `allowJs` option is not set to `true` (file: /data/js-variants/multee/VariantsDeps/fastify/variant3/fastify/lib/reqIdGenFactory.js). To fix this:
  - if you want TypeScript to process JS files, set `allowJs` to `true` in your TypeScript config (usually tsconfig.json)
  - if you do not want TypeScript to process your `.js` files, in your Jest config change the `transform` key which value is `ts-jest` so that it does not match `.js` files anymore
ts-jest[ts-jest-transformer] (WARN) Got a `.js` file to compile while `allowJs` option is not set to `true` (file: /data/js-variants/multee/VariantsDeps/fastify/variant3/fastify/lib/route.js). To fix this:
  - if you want TypeScript to process JS files, set `allowJs` to `true` in your TypeScript config (usually tsconfig.json)
  - if you do not want TypeScript to process your `.js` files, in your Jest config change the `transform` key which value is `ts-jest` so that it does not match `.js` files anymore
ts-jest[ts-jest-transformer] (WARN) Got a `.js` file to compile while `allowJs` option is not set to `true` (file: /data/js-variants/multee/VariantsDeps/fastify/variant3/fastify/lib/context.js). To fix this:
  - if you want TypeScript to process JS files, set `allowJs` to `true` in your TypeScript config (usually tsconfig.json)
  - if you do not want TypeScript to process your `.js` files, in your Jest config change the `transform` key which value is `ts-jest` so that it does not match `.js` files anymore
ts-jest[ts-jest-transformer] (WARN) Got a `.js` file to compile while `allowJs` option is not set to `true` (file: /data/js-variants/multee/VariantsDeps/fastify/variant3/fastify/lib/headRoute.js). To fix this:
  - if you want TypeScript to process JS files, set `allowJs` to `true` in your TypeScript config (usually tsconfig.json)
  - if you do not want TypeScript to process your `.js` files, in your Jest config change the `transform` key which value is `ts-jest` so that it does not match `.js` files anymore
ts-jest[ts-jest-transformer] (WARN) Got a `.js` file to compile while `allowJs` option is not set to `true` (file: /data/js-variants/multee/VariantsDeps/fastify/variant3/fastify/lib/fourOhFour.js). To fix this:
  - if you want TypeScript to process JS files, set `allowJs` to `true` in your TypeScript config (usually tsconfig.json)
  - if you do not want TypeScript to process your `.js` files, in your Jest config change the `transform` key which value is `ts-jest` so that it does not match `.js` files anymore
ts-jest[ts-jest-transformer] (WARN) Got a `.js` file to compile while `allowJs` option is not set to `true` (file: /data/js-variants/multee/VariantsDeps/fastify/variant3/fastify/lib/initialConfigValidation.js). To fix this:
  - if you want TypeScript to process JS files, set `allowJs` to `true` in your TypeScript config (usually tsconfig.json)
  - if you do not want TypeScript to process your `.js` files, in your Jest config change the `transform` key which value is `ts-jest` so that it does not match `.js` files anymore
ts-jest[ts-jest-transformer] (WARN) Got a `.js` file to compile while `allowJs` option is not set to `true` (file: /data/js-variants/multee/VariantsDeps/fastify/variant3/fastify/lib/configValidator.js). To fix this:
  - if you want TypeScript to process JS files, set `allowJs` to `true` in your TypeScript config (usually tsconfig.json)
  - if you do not want TypeScript to process your `.js` files, in your Jest config change the `transform` key which value is `ts-jest` so that it does not match `.js` files anymore
ts-jest[ts-jest-transformer] (WARN) Got a `.js` file to compile while `allowJs` option is not set to `true` (file: /data/js-variants/multee/VariantsDeps/fastify/variant3/fastify/lib/pluginOverride.js). To fix this:
  - if you want TypeScript to process JS files, set `allowJs` to `true` in your TypeScript config (usually tsconfig.json)
  - if you do not want TypeScript to process your `.js` files, in your Jest config change the `transform` key which value is `ts-jest` so that it does not match `.js` files anymore
ts-jest[ts-jest-transformer] (WARN) Got a `.js` file to compile while `allowJs` option is not set to `true` (file: /data/js-variants/multee/VariantsDeps/fastify/variant3/fastify/lib/noop-set.js). To fix this:
  - if you want TypeScript to process JS files, set `allowJs` to `true` in your TypeScript config (usually tsconfig.json)
  - if you do not want TypeScript to process your `.js` files, in your Jest config change the `transform` key which value is `ts-jest` so that it does not match `.js` files anymore
FAIL tests/basics.test.ts (23.098 s)
  Basics
    ✓ The specified `name` property is injected (39 ms)
    ✕ Default port should be 3000 (5001 ms)
    ✕ Port should be configurable via the environment (5001 ms)
    ✕ Port can be passed as a second argument to `startServer` (5001 ms)

  ● Basics › Default port should be 3000

    FastifyError: fastify-plugin: fastify-micro:sentry - expected '3.x' fastify version, '4.3.0' is installed

      127 |   if (!name) return
      128 |   this[registeredPlugins].push(name)
    > 129 | }
          |  ^
      130 |
      131 | function registerPlugin (fn) {
      132 |   registerPluginName.call(this, fn)

      at Object.checkVersion (../../../VariantsDeps/fastify/variant3/fastify/lib/pluginUtils.js:129:11)
      at Object.registerPlugin (../../../VariantsDeps/fastify/variant3/fastify/lib/pluginUtils.js:143:16)
      at Boot.override (../../../VariantsDeps/fastify/variant3/fastify/lib/pluginOverride.js:35:57)
      at Plugin.Object.<anonymous>.Plugin.exec (../../../VariantsDeps/fastify/variant3/fastify/node_modules/avvio/plugin.js:79:33)
      at Boot.loadPlugin (../../../VariantsDeps/fastify/variant3/fastify/node_modules/avvio/plugin.js:272:10)

  ● Basics › Default port should be 3000

    FastifyError: fastify-plugin: fastify-micro:sentry - expected '3.x' fastify version, '4.3.0' is installed

      127 |   if (!name) return
      128 |   this[registeredPlugins].push(name)
    > 129 | }
          |  ^
      130 |
      131 | function registerPlugin (fn) {
      132 |   registerPluginName.call(this, fn)

      at Object.checkVersion (../../../VariantsDeps/fastify/variant3/fastify/lib/pluginUtils.js:129:11)
      at Object.registerPlugin (../../../VariantsDeps/fastify/variant3/fastify/lib/pluginUtils.js:143:16)
      at Boot.override (../../../VariantsDeps/fastify/variant3/fastify/lib/pluginOverride.js:35:57)
      at Plugin.Object.<anonymous>.Plugin.exec (../../../VariantsDeps/fastify/variant3/fastify/node_modules/avvio/plugin.js:79:33)
      at Boot.loadPlugin (../../../VariantsDeps/fastify/variant3/fastify/node_modules/avvio/plugin.js:272:10)

  ● Basics › Default port should be 3000

    FastifyError: fastify-plugin: fastify-micro:sentry - expected '3.x' fastify version, '4.3.0' is installed

      127 |   if (!name) return
      128 |   this[registeredPlugins].push(name)
    > 129 | }
          |  ^
      130 |
      131 | function registerPlugin (fn) {
      132 |   registerPluginName.call(this, fn)

      at Object.checkVersion (../../../VariantsDeps/fastify/variant3/fastify/lib/pluginUtils.js:129:11)
      at Object.registerPlugin (../../../VariantsDeps/fastify/variant3/fastify/lib/pluginUtils.js:143:16)
      at Boot.override (../../../VariantsDeps/fastify/variant3/fastify/lib/pluginOverride.js:35:57)
      at Plugin.Object.<anonymous>.Plugin.exec (../../../VariantsDeps/fastify/variant3/fastify/node_modules/avvio/plugin.js:79:33)
      at Boot.loadPlugin (../../../VariantsDeps/fastify/variant3/fastify/node_modules/avvio/plugin.js:272:10)

  ● Basics › Default port should be 3000

    thrown: "Exceeded timeout of 5000 ms for a test.
    Use jest.setTimeout(newTimeout) to increase the timeout value, if this is a long-running test."

      15 |   })
      16 |
    > 17 |   test('Default port should be 3000', async () => {
         |   ^
      18 |     const key = nanoid()
      19 |     const server = createServer()
      20 |     server.get('/', (_, res) => {

      at tests/basics.test.ts:17:3
      at Object.<anonymous> (tests/basics.test.ts:5:1)

  ● Basics › Port should be configurable via the environment

    FastifyError: fastify-plugin: fastify-micro:sentry - expected '3.x' fastify version, '4.3.0' is installed

      127 |   if (!name) return
      128 |   this[registeredPlugins].push(name)
    > 129 | }
          |  ^
      130 |
      131 | function registerPlugin (fn) {
      132 |   registerPluginName.call(this, fn)

      at Object.checkVersion (../../../VariantsDeps/fastify/variant3/fastify/lib/pluginUtils.js:129:11)
      at Object.registerPlugin (../../../VariantsDeps/fastify/variant3/fastify/lib/pluginUtils.js:143:16)
      at Boot.override (../../../VariantsDeps/fastify/variant3/fastify/lib/pluginOverride.js:35:57)
      at Plugin.Object.<anonymous>.Plugin.exec (../../../VariantsDeps/fastify/variant3/fastify/node_modules/avvio/plugin.js:79:33)
      at Boot.loadPlugin (../../../VariantsDeps/fastify/variant3/fastify/node_modules/avvio/plugin.js:272:10)

  ● Basics › Port should be configurable via the environment

    thrown: "Exceeded timeout of 5000 ms for a test.
    Use jest.setTimeout(newTimeout) to increase the timeout value, if this is a long-running test."

      27 |   })
      28 |
    > 29 |   test('Port should be configurable via the environment', async () => {
         |   ^
      30 |     process.env.PORT = '3001'
      31 |     const key = nanoid()
      32 |     const server = createServer()

      at tests/basics.test.ts:29:3
      at Object.<anonymous> (tests/basics.test.ts:5:1)

  ● Basics › Port can be passed as a second argument to `startServer`

    FastifyError: fastify-plugin: fastify-micro:sentry - expected '3.x' fastify version, '4.3.0' is installed

      127 |   if (!name) return
      128 |   this[registeredPlugins].push(name)
    > 129 | }
          |  ^
      130 |
      131 | function registerPlugin (fn) {
      132 |   registerPluginName.call(this, fn)

      at Object.checkVersion (../../../VariantsDeps/fastify/variant3/fastify/lib/pluginUtils.js:129:11)
      at Object.registerPlugin (../../../VariantsDeps/fastify/variant3/fastify/lib/pluginUtils.js:143:16)
      at Boot.override (../../../VariantsDeps/fastify/variant3/fastify/lib/pluginOverride.js:35:57)
      at Plugin.Object.<anonymous>.Plugin.exec (../../../VariantsDeps/fastify/variant3/fastify/node_modules/avvio/plugin.js:79:33)
      at Boot.loadPlugin (../../../VariantsDeps/fastify/variant3/fastify/node_modules/avvio/plugin.js:272:10)

  ● Basics › Port can be passed as a second argument to `startServer`

    FastifyError: fastify-plugin: Plugin did not start in time: 'bound _after'. You may have forgotten to call 'done' function or to resolve a Promise

      618 |     // config issue on the load balancer side.
      619 |     this.log.trace({ err }, 'client error')
    > 620 |     // Copying standard node behaviour
          |                                       ^
      621 |     // https://github.com/nodejs/node/blob/6ca23d7846cb47e84fd344543e394e50938540be/lib/_http_server.js#L666
      622 |
      623 |     // If the socket is not writable, there is no reason to try to send data.

      at manageErr (../../../VariantsDeps/fastify/variant3/fastify/fastify.js:620:87)
      at ../../../VariantsDeps/fastify/variant3/fastify/fastify.js:607:11
      at Object._encapsulateThreeParam (../../../VariantsDeps/fastify/variant3/fastify/node_modules/avvio/boot.js:557:7)
      at Boot.timeoutCall (../../../VariantsDeps/fastify/variant3/fastify/node_modules/avvio/boot.js:453:5)
      at Boot.callWithCbOrNextTick (../../../VariantsDeps/fastify/variant3/fastify/node_modules/avvio/boot.js:435:19)
      at release (../../../VariantsDeps/fastify/variant3/fastify/node_modules/fastq/queue.js:149:16)
      at Object.resume (../../../VariantsDeps/fastify/variant3/fastify/node_modules/fastq/queue.js:82:7)
      at ../../../VariantsDeps/fastify/variant3/fastify/node_modules/avvio/boot.js:174:18
      at ../../../VariantsDeps/fastify/variant3/fastify/node_modules/avvio/plugin.js:275:7
      at done (../../../VariantsDeps/fastify/variant3/fastify/node_modules/avvio/plugin.js:200:5)

  ● Basics › Port can be passed as a second argument to `startServer`

    FastifyError: fastify-plugin: Plugin did not start in time: 'bound _after'. You may have forgotten to call 'done' function or to resolve a Promise

      618 |     // config issue on the load balancer side.
      619 |     this.log.trace({ err }, 'client error')
    > 620 |     // Copying standard node behaviour
          |                                       ^
      621 |     // https://github.com/nodejs/node/blob/6ca23d7846cb47e84fd344543e394e50938540be/lib/_http_server.js#L666
      622 |
      623 |     // If the socket is not writable, there is no reason to try to send data.

      at manageErr (../../../VariantsDeps/fastify/variant3/fastify/fastify.js:620:87)
      at ../../../VariantsDeps/fastify/variant3/fastify/fastify.js:607:11
      at Object._encapsulateThreeParam (../../../VariantsDeps/fastify/variant3/fastify/node_modules/avvio/boot.js:557:7)
      at Boot.timeoutCall (../../../VariantsDeps/fastify/variant3/fastify/node_modules/avvio/boot.js:453:5)
      at Boot.callWithCbOrNextTick (../../../VariantsDeps/fastify/variant3/fastify/node_modules/avvio/boot.js:435:19)
      at release (../../../VariantsDeps/fastify/variant3/fastify/node_modules/fastq/queue.js:149:16)
      at Object.resume (../../../VariantsDeps/fastify/variant3/fastify/node_modules/fastq/queue.js:82:7)
      at ../../../VariantsDeps/fastify/variant3/fastify/node_modules/avvio/boot.js:174:18
      at ../../../VariantsDeps/fastify/variant3/fastify/node_modules/avvio/plugin.js:275:7
      at done (../../../VariantsDeps/fastify/variant3/fastify/node_modules/avvio/plugin.js:200:5)

  ● Basics › Port can be passed as a second argument to `startServer`

    FastifyError: fastify-plugin: Plugin did not start in time: 'bound _after'. You may have forgotten to call 'done' function or to resolve a Promise

      618 |     // config issue on the load balancer side.
      619 |     this.log.trace({ err }, 'client error')
    > 620 |     // Copying standard node behaviour
          |                                       ^
      621 |     // https://github.com/nodejs/node/blob/6ca23d7846cb47e84fd344543e394e50938540be/lib/_http_server.js#L666
      622 |
      623 |     // If the socket is not writable, there is no reason to try to send data.

      at manageErr (../../../VariantsDeps/fastify/variant3/fastify/fastify.js:620:87)
      at ../../../VariantsDeps/fastify/variant3/fastify/fastify.js:607:11
      at Object._encapsulateThreeParam (../../../VariantsDeps/fastify/variant3/fastify/node_modules/avvio/boot.js:557:7)
      at Boot.timeoutCall (../../../VariantsDeps/fastify/variant3/fastify/node_modules/avvio/boot.js:453:5)
      at Boot.callWithCbOrNextTick (../../../VariantsDeps/fastify/variant3/fastify/node_modules/avvio/boot.js:435:19)
      at release (../../../VariantsDeps/fastify/variant3/fastify/node_modules/fastq/queue.js:149:16)
      at Object.resume (../../../VariantsDeps/fastify/variant3/fastify/node_modules/fastq/queue.js:82:7)
      at ../../../VariantsDeps/fastify/variant3/fastify/node_modules/avvio/boot.js:174:18
      at ../../../VariantsDeps/fastify/variant3/fastify/node_modules/avvio/plugin.js:275:7
      at done (../../../VariantsDeps/fastify/variant3/fastify/node_modules/avvio/plugin.js:200:5)

  ● Basics › Port can be passed as a second argument to `startServer`

    thrown: "Exceeded timeout of 5000 ms for a test.
    Use jest.setTimeout(newTimeout) to increase the timeout value, if this is a long-running test."

      41 |   })
      42 |
    > 43 |   test('Port can be passed as a second argument to `startServer`', async () => {
         |   ^
      44 |     const server = createServer()
      45 |     const key = nanoid()
      46 |     server.get('/', (_, res) => {

      at tests/basics.test.ts:43:3
      at Object.<anonymous> (tests/basics.test.ts:5:1)

FAIL tests/sentry.test.ts (45.532 s)
  Sentry reporting
    ✕ Sentry is disabled without a DSN (5002 ms)
    ✕ Sentry is enabled with a DSN (5001 ms)
    ✕ Sentry report for route errors (5002 ms)
    ✕ Sentry manual reports at app level (5002 ms)
    ✕ Report enrichment in route (5000 ms)
    ✕ Report enrichment, global getters (5002 ms)
    ✕ User enrichment (5001 ms)
    ✕ 4xx statuses are not reported to Sentry (5001 ms)
    ✕ Schema validation errors are not reported to Sentry (5000 ms)

  ● Sentry reporting › Sentry is disabled without a DSN

    FastifyError: fastify-plugin: fastify-micro:sentry - expected '3.x' fastify version, '4.3.0' is installed

      127 |   if (!name) return
      128 |   this[registeredPlugins].push(name)
    > 129 | }
          |  ^
      130 |
      131 | function registerPlugin (fn) {
      132 |   registerPluginName.call(this, fn)

      at Object.checkVersion (../../../VariantsDeps/fastify/variant3/fastify/lib/pluginUtils.js:129:11)
      at Object.registerPlugin (../../../VariantsDeps/fastify/variant3/fastify/lib/pluginUtils.js:143:16)
      at Boot.override (../../../VariantsDeps/fastify/variant3/fastify/lib/pluginOverride.js:35:57)
      at Plugin.Object.<anonymous>.Plugin.exec (../../../VariantsDeps/fastify/variant3/fastify/node_modules/avvio/plugin.js:79:33)
      at Boot.loadPlugin (../../../VariantsDeps/fastify/variant3/fastify/node_modules/avvio/plugin.js:272:10)

  ● Sentry reporting › Sentry is disabled without a DSN

    FastifyError: fastify-plugin: Plugin did not start in time: 'bound _after'. You may have forgotten to call 'done' function or to resolve a Promise

      618 |     // config issue on the load balancer side.
      619 |     this.log.trace({ err }, 'client error')
    > 620 |     // Copying standard node behaviour
          |                                       ^
      621 |     // https://github.com/nodejs/node/blob/6ca23d7846cb47e84fd344543e394e50938540be/lib/_http_server.js#L666
      622 |
      623 |     // If the socket is not writable, there is no reason to try to send data.

      at manageErr (../../../VariantsDeps/fastify/variant3/fastify/fastify.js:620:87)
      at ../../../VariantsDeps/fastify/variant3/fastify/fastify.js:607:11
      at Object._encapsulateThreeParam (../../../VariantsDeps/fastify/variant3/fastify/node_modules/avvio/boot.js:557:7)
      at Boot.timeoutCall (../../../VariantsDeps/fastify/variant3/fastify/node_modules/avvio/boot.js:453:5)
      at Boot.callWithCbOrNextTick (../../../VariantsDeps/fastify/variant3/fastify/node_modules/avvio/boot.js:435:19)
      at release (../../../VariantsDeps/fastify/variant3/fastify/node_modules/fastq/queue.js:149:16)
      at Object.resume (../../../VariantsDeps/fastify/variant3/fastify/node_modules/fastq/queue.js:82:7)
      at ../../../VariantsDeps/fastify/variant3/fastify/node_modules/avvio/boot.js:174:18
      at ../../../VariantsDeps/fastify/variant3/fastify/node_modules/avvio/plugin.js:275:7
      at done (../../../VariantsDeps/fastify/variant3/fastify/node_modules/avvio/plugin.js:200:5)

  ● Sentry reporting › Sentry is disabled without a DSN

    FastifyError: fastify-plugin: Plugin did not start in time: 'bound _after'. You may have forgotten to call 'done' function or to resolve a Promise

      618 |     // config issue on the load balancer side.
      619 |     this.log.trace({ err }, 'client error')
    > 620 |     // Copying standard node behaviour
          |                                       ^
      621 |     // https://github.com/nodejs/node/blob/6ca23d7846cb47e84fd344543e394e50938540be/lib/_http_server.js#L666
      622 |
      623 |     // If the socket is not writable, there is no reason to try to send data.

      at manageErr (../../../VariantsDeps/fastify/variant3/fastify/fastify.js:620:87)
      at ../../../VariantsDeps/fastify/variant3/fastify/fastify.js:607:11
      at Object._encapsulateThreeParam (../../../VariantsDeps/fastify/variant3/fastify/node_modules/avvio/boot.js:557:7)
      at Boot.timeoutCall (../../../VariantsDeps/fastify/variant3/fastify/node_modules/avvio/boot.js:453:5)
      at Boot.callWithCbOrNextTick (../../../VariantsDeps/fastify/variant3/fastify/node_modules/avvio/boot.js:435:19)
      at release (../../../VariantsDeps/fastify/variant3/fastify/node_modules/fastq/queue.js:149:16)
      at Object.resume (../../../VariantsDeps/fastify/variant3/fastify/node_modules/fastq/queue.js:82:7)
      at ../../../VariantsDeps/fastify/variant3/fastify/node_modules/avvio/boot.js:174:18
      at ../../../VariantsDeps/fastify/variant3/fastify/node_modules/avvio/plugin.js:275:7
      at done (../../../VariantsDeps/fastify/variant3/fastify/node_modules/avvio/plugin.js:200:5)

  ● Sentry reporting › Sentry is disabled without a DSN

    thrown: "Exceeded timeout of 5000 ms for a test.
    Use jest.setTimeout(newTimeout) to increase the timeout value, if this is a long-running test."

      25 |   // --
      26 |
    > 27 |   test('Sentry is disabled without a DSN', async () => {
         |   ^
      28 |     const { testkit, sentryTransport } = sentryTestkit()
      29 |     process.env.NODE_ENV = 'test'
      30 |     process.env.LOG_LEVEL = 'silent'

      at tests/sentry.test.ts:27:3
      at Object.<anonymous> (tests/sentry.test.ts:5:1)

  ● Sentry reporting › Sentry is enabled with a DSN

    FastifyError: fastify-plugin: fastify-micro:sentry - expected '3.x' fastify version, '4.3.0' is installed

      127 |   if (!name) return
      128 |   this[registeredPlugins].push(name)
    > 129 | }
          |  ^
      130 |
      131 | function registerPlugin (fn) {
      132 |   registerPluginName.call(this, fn)

      at Object.checkVersion (../../../VariantsDeps/fastify/variant3/fastify/lib/pluginUtils.js:129:11)
      at Object.registerPlugin (../../../VariantsDeps/fastify/variant3/fastify/lib/pluginUtils.js:143:16)
      at Boot.override (../../../VariantsDeps/fastify/variant3/fastify/lib/pluginOverride.js:35:57)
      at Plugin.Object.<anonymous>.Plugin.exec (../../../VariantsDeps/fastify/variant3/fastify/node_modules/avvio/plugin.js:79:33)
      at Boot.loadPlugin (../../../VariantsDeps/fastify/variant3/fastify/node_modules/avvio/plugin.js:272:10)

  ● Sentry reporting › Sentry is enabled with a DSN

    thrown: "Exceeded timeout of 5000 ms for a test.
    Use jest.setTimeout(newTimeout) to increase the timeout value, if this is a long-running test."

      43 |   // --
      44 |
    > 45 |   test('Sentry is enabled with a DSN', async () => {
         |   ^
      46 |     const { testkit, sentryTransport } = sentryTestkit()
      47 |     setupEnv()
      48 |     const server = createServer({

      at tests/sentry.test.ts:45:3
      at Object.<anonymous> (tests/sentry.test.ts:5:1)

  ● Sentry reporting › Sentry report for route errors

    FastifyError: fastify-plugin: fastify-micro:sentry - expected '3.x' fastify version, '4.3.0' is installed

      127 |   if (!name) return
      128 |   this[registeredPlugins].push(name)
    > 129 | }
          |  ^
      130 |
      131 | function registerPlugin (fn) {
      132 |   registerPluginName.call(this, fn)

      at Object.checkVersion (../../../VariantsDeps/fastify/variant3/fastify/lib/pluginUtils.js:129:11)
      at Object.registerPlugin (../../../VariantsDeps/fastify/variant3/fastify/lib/pluginUtils.js:143:16)
      at Boot.override (../../../VariantsDeps/fastify/variant3/fastify/lib/pluginOverride.js:35:57)
      at Plugin.Object.<anonymous>.Plugin.exec (../../../VariantsDeps/fastify/variant3/fastify/node_modules/avvio/plugin.js:79:33)
      at Boot.loadPlugin (../../../VariantsDeps/fastify/variant3/fastify/node_modules/avvio/plugin.js:272:10)

  ● Sentry reporting › Sentry report for route errors

    FastifyError: fastify-plugin: Plugin did not start in time: 'bound _after'. You may have forgotten to call 'done' function or to resolve a Promise

      618 |     // config issue on the load balancer side.
      619 |     this.log.trace({ err }, 'client error')
    > 620 |     // Copying standard node behaviour
          |                                       ^
      621 |     // https://github.com/nodejs/node/blob/6ca23d7846cb47e84fd344543e394e50938540be/lib/_http_server.js#L666
      622 |
      623 |     // If the socket is not writable, there is no reason to try to send data.

      at manageErr (../../../VariantsDeps/fastify/variant3/fastify/fastify.js:620:87)
      at ../../../VariantsDeps/fastify/variant3/fastify/fastify.js:607:11
      at Object._encapsulateThreeParam (../../../VariantsDeps/fastify/variant3/fastify/node_modules/avvio/boot.js:557:7)
      at Boot.timeoutCall (../../../VariantsDeps/fastify/variant3/fastify/node_modules/avvio/boot.js:453:5)
      at Boot.callWithCbOrNextTick (../../../VariantsDeps/fastify/variant3/fastify/node_modules/avvio/boot.js:435:19)
      at release (../../../VariantsDeps/fastify/variant3/fastify/node_modules/fastq/queue.js:149:16)
      at Object.resume (../../../VariantsDeps/fastify/variant3/fastify/node_modules/fastq/queue.js:82:7)
      at ../../../VariantsDeps/fastify/variant3/fastify/node_modules/avvio/boot.js:174:18
      at ../../../VariantsDeps/fastify/variant3/fastify/node_modules/avvio/plugin.js:275:7
      at done (../../../VariantsDeps/fastify/variant3/fastify/node_modules/avvio/plugin.js:200:5)

  ● Sentry reporting › Sentry report for route errors

    thrown: "Exceeded timeout of 5000 ms for a test.
    Use jest.setTimeout(newTimeout) to increase the timeout value, if this is a long-running test."

      62 |   // --
      63 |
    > 64 |   test('Sentry report for route errors', async () => {
         |   ^
      65 |     const { testkit, sentryTransport } = sentryTestkit()
      66 |     setupEnv()
      67 |     const server = createServer({

      at tests/sentry.test.ts:64:3
      at Object.<anonymous> (tests/sentry.test.ts:5:1)

  ● Sentry reporting › Sentry manual reports at app level

    FastifyError: fastify-plugin: fastify-micro:sentry - expected '3.x' fastify version, '4.3.0' is installed

      127 |   if (!name) return
      128 |   this[registeredPlugins].push(name)
    > 129 | }
          |  ^
      130 |
      131 | function registerPlugin (fn) {
      132 |   registerPluginName.call(this, fn)

      at Object.checkVersion (../../../VariantsDeps/fastify/variant3/fastify/lib/pluginUtils.js:129:11)
      at Object.registerPlugin (../../../VariantsDeps/fastify/variant3/fastify/lib/pluginUtils.js:143:16)
      at Boot.override (../../../VariantsDeps/fastify/variant3/fastify/lib/pluginOverride.js:35:57)
      at Plugin.Object.<anonymous>.Plugin.exec (../../../VariantsDeps/fastify/variant3/fastify/node_modules/avvio/plugin.js:79:33)
      at Boot.loadPlugin (../../../VariantsDeps/fastify/variant3/fastify/node_modules/avvio/plugin.js:272:10)

  ● Sentry reporting › Sentry manual reports at app level

    FastifyError: fastify-plugin: Plugin did not start in time: 'bound _after'. You may have forgotten to call 'done' function or to resolve a Promise

      618 |     // config issue on the load balancer side.
      619 |     this.log.trace({ err }, 'client error')
    > 620 |     // Copying standard node behaviour
          |                                       ^
      621 |     // https://github.com/nodejs/node/blob/6ca23d7846cb47e84fd344543e394e50938540be/lib/_http_server.js#L666
      622 |
      623 |     // If the socket is not writable, there is no reason to try to send data.

      at manageErr (../../../VariantsDeps/fastify/variant3/fastify/fastify.js:620:87)
      at ../../../VariantsDeps/fastify/variant3/fastify/fastify.js:607:11
      at Object._encapsulateThreeParam (../../../VariantsDeps/fastify/variant3/fastify/node_modules/avvio/boot.js:557:7)
      at Boot.timeoutCall (../../../VariantsDeps/fastify/variant3/fastify/node_modules/avvio/boot.js:453:5)
      at Boot.callWithCbOrNextTick (../../../VariantsDeps/fastify/variant3/fastify/node_modules/avvio/boot.js:435:19)
      at release (../../../VariantsDeps/fastify/variant3/fastify/node_modules/fastq/queue.js:149:16)
      at Object.resume (../../../VariantsDeps/fastify/variant3/fastify/node_modules/fastq/queue.js:82:7)
      at ../../../VariantsDeps/fastify/variant3/fastify/node_modules/avvio/boot.js:174:18
      at ../../../VariantsDeps/fastify/variant3/fastify/node_modules/avvio/plugin.js:275:7
      at done (../../../VariantsDeps/fastify/variant3/fastify/node_modules/avvio/plugin.js:200:5)

  ● Sentry reporting › Sentry manual reports at app level

    thrown: "Exceeded timeout of 5000 ms for a test.
    Use jest.setTimeout(newTimeout) to increase the timeout value, if this is a long-running test."

      86 |   // --
      87 |
    > 88 |   test('Sentry manual reports at app level', async () => {
         |   ^
      89 |     const { testkit, sentryTransport } = sentryTestkit()
      90 |     setupEnv()
      91 |     const server = createServer({

      at tests/sentry.test.ts:88:3
      at Object.<anonymous> (tests/sentry.test.ts:5:1)

  ● Sentry reporting › Report enrichment in route

    FastifyError: fastify-plugin: fastify-micro:sentry - expected '3.x' fastify version, '4.3.0' is installed

      127 |   if (!name) return
      128 |   this[registeredPlugins].push(name)
    > 129 | }
          |  ^
      130 |
      131 | function registerPlugin (fn) {
      132 |   registerPluginName.call(this, fn)

      at Object.checkVersion (../../../VariantsDeps/fastify/variant3/fastify/lib/pluginUtils.js:129:11)
      at Object.registerPlugin (../../../VariantsDeps/fastify/variant3/fastify/lib/pluginUtils.js:143:16)
      at Boot.override (../../../VariantsDeps/fastify/variant3/fastify/lib/pluginOverride.js:35:57)
      at Plugin.Object.<anonymous>.Plugin.exec (../../../VariantsDeps/fastify/variant3/fastify/node_modules/avvio/plugin.js:79:33)
      at Boot.loadPlugin (../../../VariantsDeps/fastify/variant3/fastify/node_modules/avvio/plugin.js:272:10)

  ● Sentry reporting › Report enrichment in route

    FastifyError: fastify-plugin: Plugin did not start in time: 'bound _after'. You may have forgotten to call 'done' function or to resolve a Promise

      618 |     // config issue on the load balancer side.
      619 |     this.log.trace({ err }, 'client error')
    > 620 |     // Copying standard node behaviour
          |                                       ^
      621 |     // https://github.com/nodejs/node/blob/6ca23d7846cb47e84fd344543e394e50938540be/lib/_http_server.js#L666
      622 |
      623 |     // If the socket is not writable, there is no reason to try to send data.

      at manageErr (../../../VariantsDeps/fastify/variant3/fastify/fastify.js:620:87)
      at ../../../VariantsDeps/fastify/variant3/fastify/fastify.js:607:11
      at Object._encapsulateThreeParam (../../../VariantsDeps/fastify/variant3/fastify/node_modules/avvio/boot.js:557:7)
      at Boot.timeoutCall (../../../VariantsDeps/fastify/variant3/fastify/node_modules/avvio/boot.js:453:5)
      at Boot.callWithCbOrNextTick (../../../VariantsDeps/fastify/variant3/fastify/node_modules/avvio/boot.js:435:19)
      at release (../../../VariantsDeps/fastify/variant3/fastify/node_modules/fastq/queue.js:149:16)
      at Object.resume (../../../VariantsDeps/fastify/variant3/fastify/node_modules/fastq/queue.js:82:7)
      at ../../../VariantsDeps/fastify/variant3/fastify/node_modules/avvio/boot.js:174:18
      at ../../../VariantsDeps/fastify/variant3/fastify/node_modules/avvio/plugin.js:275:7
      at done (../../../VariantsDeps/fastify/variant3/fastify/node_modules/avvio/plugin.js:200:5)

  ● Sentry reporting › Report enrichment in route

    thrown: "Exceeded timeout of 5000 ms for a test.
    Use jest.setTimeout(newTimeout) to increase the timeout value, if this is a long-running test."

      105 |   // --
      106 |
    > 107 |   test('Report enrichment in route', async () => {
          |   ^
      108 |     const { testkit, sentryTransport } = sentryTestkit()
      109 |     setupEnv()
      110 |     const server = createServer({

      at tests/sentry.test.ts:107:3
      at Object.<anonymous> (tests/sentry.test.ts:5:1)

  ● Sentry reporting › Report enrichment, global getters

    FastifyError: fastify-plugin: fastify-micro:sentry - expected '3.x' fastify version, '4.3.0' is installed

      127 |   if (!name) return
      128 |   this[registeredPlugins].push(name)
    > 129 | }
          |  ^
      130 |
      131 | function registerPlugin (fn) {
      132 |   registerPluginName.call(this, fn)

      at Object.checkVersion (../../../VariantsDeps/fastify/variant3/fastify/lib/pluginUtils.js:129:11)
      at Object.registerPlugin (../../../VariantsDeps/fastify/variant3/fastify/lib/pluginUtils.js:143:16)
      at Boot.override (../../../VariantsDeps/fastify/variant3/fastify/lib/pluginOverride.js:35:57)
      at Plugin.Object.<anonymous>.Plugin.exec (../../../VariantsDeps/fastify/variant3/fastify/node_modules/avvio/plugin.js:79:33)
      at Boot.loadPlugin (../../../VariantsDeps/fastify/variant3/fastify/node_modules/avvio/plugin.js:272:10)

  ● Sentry reporting › Report enrichment, global getters

    FastifyError: fastify-plugin: Plugin did not start in time: 'bound _after'. You may have forgotten to call 'done' function or to resolve a Promise

      618 |     // config issue on the load balancer side.
      619 |     this.log.trace({ err }, 'client error')
    > 620 |     // Copying standard node behaviour
          |                                       ^
      621 |     // https://github.com/nodejs/node/blob/6ca23d7846cb47e84fd344543e394e50938540be/lib/_http_server.js#L666
      622 |
      623 |     // If the socket is not writable, there is no reason to try to send data.

      at manageErr (../../../VariantsDeps/fastify/variant3/fastify/fastify.js:620:87)
      at ../../../VariantsDeps/fastify/variant3/fastify/fastify.js:607:11
      at Object._encapsulateThreeParam (../../../VariantsDeps/fastify/variant3/fastify/node_modules/avvio/boot.js:557:7)
      at Boot.timeoutCall (../../../VariantsDeps/fastify/variant3/fastify/node_modules/avvio/boot.js:453:5)
      at Boot.callWithCbOrNextTick (../../../VariantsDeps/fastify/variant3/fastify/node_modules/avvio/boot.js:435:19)
      at release (../../../VariantsDeps/fastify/variant3/fastify/node_modules/fastq/queue.js:149:16)
      at Object.resume (../../../VariantsDeps/fastify/variant3/fastify/node_modules/fastq/queue.js:82:7)
      at ../../../VariantsDeps/fastify/variant3/fastify/node_modules/avvio/boot.js:174:18
      at ../../../VariantsDeps/fastify/variant3/fastify/node_modules/avvio/plugin.js:275:7
      at done (../../../VariantsDeps/fastify/variant3/fastify/node_modules/avvio/plugin.js:200:5)

  ● Sentry reporting › Report enrichment, global getters

    thrown: "Exceeded timeout of 5000 ms for a test.
    Use jest.setTimeout(newTimeout) to increase the timeout value, if this is a long-running test."

      138 |   // --
      139 |
    > 140 |   test('Report enrichment, global getters', async () => {
          |   ^
      141 |     const { testkit, sentryTransport } = sentryTestkit()
      142 |     setupEnv()
      143 |     process.env.COMMIT_ID = 'git-sha1'

      at tests/sentry.test.ts:140:3
      at Object.<anonymous> (tests/sentry.test.ts:5:1)

  ● Sentry reporting › User enrichment

    FastifyError: fastify-plugin: fastify-micro:sentry - expected '3.x' fastify version, '4.3.0' is installed

      127 |   if (!name) return
      128 |   this[registeredPlugins].push(name)
    > 129 | }
          |  ^
      130 |
      131 | function registerPlugin (fn) {
      132 |   registerPluginName.call(this, fn)

      at Object.checkVersion (../../../VariantsDeps/fastify/variant3/fastify/lib/pluginUtils.js:129:11)
      at Object.registerPlugin (../../../VariantsDeps/fastify/variant3/fastify/lib/pluginUtils.js:143:16)
      at Boot.override (../../../VariantsDeps/fastify/variant3/fastify/lib/pluginOverride.js:35:57)
      at Plugin.Object.<anonymous>.Plugin.exec (../../../VariantsDeps/fastify/variant3/fastify/node_modules/avvio/plugin.js:79:33)
      at Boot.loadPlugin (../../../VariantsDeps/fastify/variant3/fastify/node_modules/avvio/plugin.js:272:10)

  ● Sentry reporting › User enrichment

    FastifyError: fastify-plugin: Plugin did not start in time: 'bound _after'. You may have forgotten to call 'done' function or to resolve a Promise

      618 |     // config issue on the load balancer side.
      619 |     this.log.trace({ err }, 'client error')
    > 620 |     // Copying standard node behaviour
          |                                       ^
      621 |     // https://github.com/nodejs/node/blob/6ca23d7846cb47e84fd344543e394e50938540be/lib/_http_server.js#L666
      622 |
      623 |     // If the socket is not writable, there is no reason to try to send data.

      at manageErr (../../../VariantsDeps/fastify/variant3/fastify/fastify.js:620:87)
      at ../../../VariantsDeps/fastify/variant3/fastify/fastify.js:607:11
      at Object._encapsulateThreeParam (../../../VariantsDeps/fastify/variant3/fastify/node_modules/avvio/boot.js:557:7)
      at Boot.timeoutCall (../../../VariantsDeps/fastify/variant3/fastify/node_modules/avvio/boot.js:453:5)
      at Boot.callWithCbOrNextTick (../../../VariantsDeps/fastify/variant3/fastify/node_modules/avvio/boot.js:435:19)
      at release (../../../VariantsDeps/fastify/variant3/fastify/node_modules/fastq/queue.js:149:16)
      at Object.resume (../../../VariantsDeps/fastify/variant3/fastify/node_modules/fastq/queue.js:82:7)
      at ../../../VariantsDeps/fastify/variant3/fastify/node_modules/avvio/boot.js:174:18
      at ../../../VariantsDeps/fastify/variant3/fastify/node_modules/avvio/plugin.js:275:7
      at done (../../../VariantsDeps/fastify/variant3/fastify/node_modules/avvio/plugin.js:200:5)

  ● Sentry reporting › User enrichment

    thrown: "Exceeded timeout of 5000 ms for a test.
    Use jest.setTimeout(newTimeout) to increase the timeout value, if this is a long-running test."

      181 |   // --
      182 |
    > 183 |   test('User enrichment', async () => {
          |   ^
      184 |     const { testkit, sentryTransport } = sentryTestkit()
      185 |     setupEnv()
      186 |     const server = createServer({

      at tests/sentry.test.ts:183:3
      at Object.<anonymous> (tests/sentry.test.ts:5:1)

  ● Sentry reporting › 4xx statuses are not reported to Sentry

    FastifyError: fastify-plugin: fastify-micro:sentry - expected '3.x' fastify version, '4.3.0' is installed

      127 |   if (!name) return
      128 |   this[registeredPlugins].push(name)
    > 129 | }
          |  ^
      130 |
      131 | function registerPlugin (fn) {
      132 |   registerPluginName.call(this, fn)

      at Object.checkVersion (../../../VariantsDeps/fastify/variant3/fastify/lib/pluginUtils.js:129:11)
      at Object.registerPlugin (../../../VariantsDeps/fastify/variant3/fastify/lib/pluginUtils.js:143:16)
      at Boot.override (../../../VariantsDeps/fastify/variant3/fastify/lib/pluginOverride.js:35:57)
      at Plugin.Object.<anonymous>.Plugin.exec (../../../VariantsDeps/fastify/variant3/fastify/node_modules/avvio/plugin.js:79:33)
      at Boot.loadPlugin (../../../VariantsDeps/fastify/variant3/fastify/node_modules/avvio/plugin.js:272:10)

  ● Sentry reporting › 4xx statuses are not reported to Sentry

    FastifyError: fastify-plugin: Plugin did not start in time: 'bound _after'. You may have forgotten to call 'done' function or to resolve a Promise

      618 |     // config issue on the load balancer side.
      619 |     this.log.trace({ err }, 'client error')
    > 620 |     // Copying standard node behaviour
          |                                       ^
      621 |     // https://github.com/nodejs/node/blob/6ca23d7846cb47e84fd344543e394e50938540be/lib/_http_server.js#L666
      622 |
      623 |     // If the socket is not writable, there is no reason to try to send data.

      at manageErr (../../../VariantsDeps/fastify/variant3/fastify/fastify.js:620:87)
      at ../../../VariantsDeps/fastify/variant3/fastify/fastify.js:607:11
      at Object._encapsulateThreeParam (../../../VariantsDeps/fastify/variant3/fastify/node_modules/avvio/boot.js:557:7)
      at Boot.timeoutCall (../../../VariantsDeps/fastify/variant3/fastify/node_modules/avvio/boot.js:453:5)
      at Boot.callWithCbOrNextTick (../../../VariantsDeps/fastify/variant3/fastify/node_modules/avvio/boot.js:435:19)
      at release (../../../VariantsDeps/fastify/variant3/fastify/node_modules/fastq/queue.js:149:16)
      at Object.resume (../../../VariantsDeps/fastify/variant3/fastify/node_modules/fastq/queue.js:82:7)
      at ../../../VariantsDeps/fastify/variant3/fastify/node_modules/avvio/boot.js:174:18
      at ../../../VariantsDeps/fastify/variant3/fastify/node_modules/avvio/plugin.js:275:7
      at done (../../../VariantsDeps/fastify/variant3/fastify/node_modules/avvio/plugin.js:200:5)

  ● Sentry reporting › 4xx statuses are not reported to Sentry

    thrown: "Exceeded timeout of 5000 ms for a test.
    Use jest.setTimeout(newTimeout) to increase the timeout value, if this is a long-running test."

      212 |   // --
      213 |
    > 214 |   test('4xx statuses are not reported to Sentry', async () => {
          |   ^
      215 |     const { testkit, sentryTransport } = sentryTestkit()
      216 |     setupEnv()
      217 |     const server = createServer({

      at tests/sentry.test.ts:214:3
      at Object.<anonymous> (tests/sentry.test.ts:5:1)

  ● Sentry reporting › Schema validation errors are not reported to Sentry

    FastifyError: fastify-plugin: fastify-micro:sentry - expected '3.x' fastify version, '4.3.0' is installed

      127 |   if (!name) return
      128 |   this[registeredPlugins].push(name)
    > 129 | }
          |  ^
      130 |
      131 | function registerPlugin (fn) {
      132 |   registerPluginName.call(this, fn)

      at Object.checkVersion (../../../VariantsDeps/fastify/variant3/fastify/lib/pluginUtils.js:129:11)
      at Object.registerPlugin (../../../VariantsDeps/fastify/variant3/fastify/lib/pluginUtils.js:143:16)
      at Boot.override (../../../VariantsDeps/fastify/variant3/fastify/lib/pluginOverride.js:35:57)
      at Plugin.Object.<anonymous>.Plugin.exec (../../../VariantsDeps/fastify/variant3/fastify/node_modules/avvio/plugin.js:79:33)
      at Boot.loadPlugin (../../../VariantsDeps/fastify/variant3/fastify/node_modules/avvio/plugin.js:272:10)

  ● Sentry reporting › Schema validation errors are not reported to Sentry

    FastifyError: fastify-plugin: Plugin did not start in time: 'bound _after'. You may have forgotten to call 'done' function or to resolve a Promise

      618 |     // config issue on the load balancer side.
      619 |     this.log.trace({ err }, 'client error')
    > 620 |     // Copying standard node behaviour
          |                                       ^
      621 |     // https://github.com/nodejs/node/blob/6ca23d7846cb47e84fd344543e394e50938540be/lib/_http_server.js#L666
      622 |
      623 |     // If the socket is not writable, there is no reason to try to send data.

      at manageErr (../../../VariantsDeps/fastify/variant3/fastify/fastify.js:620:87)
      at ../../../VariantsDeps/fastify/variant3/fastify/fastify.js:607:11
      at Object._encapsulateThreeParam (../../../VariantsDeps/fastify/variant3/fastify/node_modules/avvio/boot.js:557:7)
      at Boot.timeoutCall (../../../VariantsDeps/fastify/variant3/fastify/node_modules/avvio/boot.js:453:5)
      at Boot.callWithCbOrNextTick (../../../VariantsDeps/fastify/variant3/fastify/node_modules/avvio/boot.js:435:19)
      at release (../../../VariantsDeps/fastify/variant3/fastify/node_modules/fastq/queue.js:149:16)
      at Object.resume (../../../VariantsDeps/fastify/variant3/fastify/node_modules/fastq/queue.js:82:7)
      at ../../../VariantsDeps/fastify/variant3/fastify/node_modules/avvio/boot.js:174:18
      at ../../../VariantsDeps/fastify/variant3/fastify/node_modules/avvio/plugin.js:275:7
      at done (../../../VariantsDeps/fastify/variant3/fastify/node_modules/avvio/plugin.js:200:5)

  ● Sentry reporting › Schema validation errors are not reported to Sentry

    thrown: "Exceeded timeout of 5000 ms for a test.
    Use jest.setTimeout(newTimeout) to increase the timeout value, if this is a long-running test."

      231 |   // --
      232 |
    > 233 |   test('Schema validation errors are not reported to Sentry', async () => {
          |   ^
      234 |     const { testkit, sentryTransport } = sentryTestkit()
      235 |     setupEnv()
      236 |     const server = createServer({

      at tests/sentry.test.ts:233:3
      at Object.<anonymous> (tests/sentry.test.ts:5:1)


ReferenceError: You are trying to `import` a file after the Jest environment has been torn down. From tests/sentry.test.ts.

      105 |    * Do not setup the compiler more than once
      106 |    * @param {object} serverOptions: the fastify server option
    > 107 |    */
          |      ^
      108 |   setupSerializer (serverOption) {
      109 |     const isReady = this.serializerCompiler !== undefined && !this.addedSchemas
      110 |     if (isReady) {

      at new ValidatorCompiler (../../../VariantsDeps/fastify/variant3/fastify/node_modules/@fastify/ajv-compiler/index.js:68:7)
      at buildCompilerFromPool (../../../VariantsDeps/fastify/variant3/fastify/node_modules/@fastify/ajv-compiler/index.js:32:22)
      at SchemaController.setupValidator (../../../VariantsDeps/fastify/variant3/fastify/lib/schema-controller.js:107:56)
      at Boot.<anonymous> (../../../VariantsDeps/fastify/variant3/fastify/lib/route.js:372:32)
FAIL tests/plugins.test.ts (15.619 s)
  Plugins
    ✕ Loading plugins & routes from filesystem (5002 ms)
    ✕ Graceful exit (5001 ms)
    ✕ Graceful exit with a slow onClose hook (5001 ms)

  ● Plugins › Loading plugins & routes from filesystem

    FastifyError: fastify-plugin: fastify-micro:sentry - expected '3.x' fastify version, '4.3.0' is installed

      127 |   if (!name) return
      128 |   this[registeredPlugins].push(name)
    > 129 | }
          |  ^
      130 |
      131 | function registerPlugin (fn) {
      132 |   registerPluginName.call(this, fn)

      at Object.checkVersion (../../../VariantsDeps/fastify/variant3/fastify/lib/pluginUtils.js:129:11)
      at Object.registerPlugin (../../../VariantsDeps/fastify/variant3/fastify/lib/pluginUtils.js:143:16)
      at Boot.override (../../../VariantsDeps/fastify/variant3/fastify/lib/pluginOverride.js:35:57)
      at Plugin.Object.<anonymous>.Plugin.exec (../../../VariantsDeps/fastify/variant3/fastify/node_modules/avvio/plugin.js:79:33)
      at Boot.loadPlugin (../../../VariantsDeps/fastify/variant3/fastify/node_modules/avvio/plugin.js:272:10)

  ● Plugins › Loading plugins & routes from filesystem

    FastifyError: fastify-plugin: Plugin did not start in time: 'bound _after'. You may have forgotten to call 'done' function or to resolve a Promise

      618 |     // config issue on the load balancer side.
      619 |     this.log.trace({ err }, 'client error')
    > 620 |     // Copying standard node behaviour
          |                                       ^
      621 |     // https://github.com/nodejs/node/blob/6ca23d7846cb47e84fd344543e394e50938540be/lib/_http_server.js#L666
      622 |
      623 |     // If the socket is not writable, there is no reason to try to send data.

      at manageErr (../../../VariantsDeps/fastify/variant3/fastify/fastify.js:620:87)
      at ../../../VariantsDeps/fastify/variant3/fastify/fastify.js:607:11
      at Object._encapsulateThreeParam (../../../VariantsDeps/fastify/variant3/fastify/node_modules/avvio/boot.js:557:7)
      at Boot.timeoutCall (../../../VariantsDeps/fastify/variant3/fastify/node_modules/avvio/boot.js:453:5)
      at Boot.callWithCbOrNextTick (../../../VariantsDeps/fastify/variant3/fastify/node_modules/avvio/boot.js:435:19)
      at release (../../../VariantsDeps/fastify/variant3/fastify/node_modules/fastq/queue.js:149:16)
      at Object.resume (../../../VariantsDeps/fastify/variant3/fastify/node_modules/fastq/queue.js:82:7)
      at ../../../VariantsDeps/fastify/variant3/fastify/node_modules/avvio/boot.js:174:18
      at ../../../VariantsDeps/fastify/variant3/fastify/node_modules/avvio/plugin.js:275:7
      at done (../../../VariantsDeps/fastify/variant3/fastify/node_modules/avvio/plugin.js:200:5)

  ● Plugins › Loading plugins & routes from filesystem

    FastifyError: fastify-plugin: Plugin did not start in time: 'bound _after'. You may have forgotten to call 'done' function or to resolve a Promise

      618 |     // config issue on the load balancer side.
      619 |     this.log.trace({ err }, 'client error')
    > 620 |     // Copying standard node behaviour
          |                                       ^
      621 |     // https://github.com/nodejs/node/blob/6ca23d7846cb47e84fd344543e394e50938540be/lib/_http_server.js#L666
      622 |
      623 |     // If the socket is not writable, there is no reason to try to send data.

      at manageErr (../../../VariantsDeps/fastify/variant3/fastify/fastify.js:620:87)
      at ../../../VariantsDeps/fastify/variant3/fastify/fastify.js:607:11
      at Object._encapsulateThreeParam (../../../VariantsDeps/fastify/variant3/fastify/node_modules/avvio/boot.js:557:7)
      at Boot.timeoutCall (../../../VariantsDeps/fastify/variant3/fastify/node_modules/avvio/boot.js:453:5)
      at Boot.callWithCbOrNextTick (../../../VariantsDeps/fastify/variant3/fastify/node_modules/avvio/boot.js:435:19)
      at release (../../../VariantsDeps/fastify/variant3/fastify/node_modules/fastq/queue.js:149:16)
      at Object.resume (../../../VariantsDeps/fastify/variant3/fastify/node_modules/fastq/queue.js:82:7)
      at ../../../VariantsDeps/fastify/variant3/fastify/node_modules/avvio/boot.js:174:18
      at ../../../VariantsDeps/fastify/variant3/fastify/node_modules/avvio/plugin.js:275:7
      at done (../../../VariantsDeps/fastify/variant3/fastify/node_modules/avvio/plugin.js:200:5)

  ● Plugins › Loading plugins & routes from filesystem

    thrown: "Exceeded timeout of 5000 ms for a test.
    Use jest.setTimeout(newTimeout) to increase the timeout value, if this is a long-running test."

      11 |   })
      12 |
    > 13 |   test('Loading plugins & routes from filesystem', async () => {
         |   ^
      14 |     const server = createServer({
      15 |       plugins: {
      16 |         dir: path.resolve(__dirname, './jigs/plugins')

      at tests/plugins.test.ts:13:3
      at Object.<anonymous> (tests/plugins.test.ts:8:1)

  ● Plugins › Graceful exit

    FastifyError: fastify-plugin: fastify-micro:sentry - expected '3.x' fastify version, '4.3.0' is installed

      127 |   if (!name) return
      128 |   this[registeredPlugins].push(name)
    > 129 | }
          |  ^
      130 |
      131 | function registerPlugin (fn) {
      132 |   registerPluginName.call(this, fn)

      at Object.checkVersion (../../../VariantsDeps/fastify/variant3/fastify/lib/pluginUtils.js:129:11)
      at Object.registerPlugin (../../../VariantsDeps/fastify/variant3/fastify/lib/pluginUtils.js:143:16)
      at Boot.override (../../../VariantsDeps/fastify/variant3/fastify/lib/pluginOverride.js:35:57)
      at Plugin.Object.<anonymous>.Plugin.exec (../../../VariantsDeps/fastify/variant3/fastify/node_modules/avvio/plugin.js:79:33)
      at Boot.loadPlugin (../../../VariantsDeps/fastify/variant3/fastify/node_modules/avvio/plugin.js:272:10)

  ● Plugins › Graceful exit

    thrown: "Exceeded timeout of 5000 ms for a test.
    Use jest.setTimeout(newTimeout) to increase the timeout value, if this is a long-running test."

      27 |   })
      28 |
    > 29 |   test('Graceful exit', async () => {
         |   ^
      30 |     //jest.setTimeout(10000)
      31 |     const key = nanoid()
      32 |     const server = createServer()

      at tests/plugins.test.ts:29:3
      at Object.<anonymous> (tests/plugins.test.ts:8:1)

  ● Plugins › Graceful exit with a slow onClose hook

    FastifyError: fastify-plugin: fastify-micro:sentry - expected '3.x' fastify version, '4.3.0' is installed

      127 |   if (!name) return
      128 |   this[registeredPlugins].push(name)
    > 129 | }
          |  ^
      130 |
      131 | function registerPlugin (fn) {
      132 |   registerPluginName.call(this, fn)

      at Object.checkVersion (../../../VariantsDeps/fastify/variant3/fastify/lib/pluginUtils.js:129:11)
      at Object.registerPlugin (../../../VariantsDeps/fastify/variant3/fastify/lib/pluginUtils.js:143:16)
      at Boot.override (../../../VariantsDeps/fastify/variant3/fastify/lib/pluginOverride.js:35:57)
      at Plugin.Object.<anonymous>.Plugin.exec (../../../VariantsDeps/fastify/variant3/fastify/node_modules/avvio/plugin.js:79:33)
      at Boot.loadPlugin (../../../VariantsDeps/fastify/variant3/fastify/node_modules/avvio/plugin.js:272:10)

  ● Plugins › Graceful exit with a slow onClose hook

    FastifyError: fastify-plugin: Plugin did not start in time: 'bound _after'. You may have forgotten to call 'done' function or to resolve a Promise

      618 |     // config issue on the load balancer side.
      619 |     this.log.trace({ err }, 'client error')
    > 620 |     // Copying standard node behaviour
          |                                       ^
      621 |     // https://github.com/nodejs/node/blob/6ca23d7846cb47e84fd344543e394e50938540be/lib/_http_server.js#L666
      622 |
      623 |     // If the socket is not writable, there is no reason to try to send data.

      at manageErr (../../../VariantsDeps/fastify/variant3/fastify/fastify.js:620:87)
      at ../../../VariantsDeps/fastify/variant3/fastify/fastify.js:607:11
      at Object._encapsulateThreeParam (../../../VariantsDeps/fastify/variant3/fastify/node_modules/avvio/boot.js:557:7)
      at Boot.timeoutCall (../../../VariantsDeps/fastify/variant3/fastify/node_modules/avvio/boot.js:453:5)
      at Boot.callWithCbOrNextTick (../../../VariantsDeps/fastify/variant3/fastify/node_modules/avvio/boot.js:435:19)
      at release (../../../VariantsDeps/fastify/variant3/fastify/node_modules/fastq/queue.js:149:16)
      at Object.resume (../../../VariantsDeps/fastify/variant3/fastify/node_modules/fastq/queue.js:82:7)
      at ../../../VariantsDeps/fastify/variant3/fastify/node_modules/avvio/boot.js:174:18
      at ../../../VariantsDeps/fastify/variant3/fastify/node_modules/avvio/plugin.js:275:7
      at done (../../../VariantsDeps/fastify/variant3/fastify/node_modules/avvio/plugin.js:200:5)

  ● Plugins › Graceful exit with a slow onClose hook

    thrown: "Exceeded timeout of 5000 ms for a test.
    Use jest.setTimeout(newTimeout) to increase the timeout value, if this is a long-running test."

      43 |   })
      44 |
    > 45 |   test('Graceful exit with a slow onClose hook', async () => {
         |   ^
      46 |     const key = nanoid()
      47 |     const server = createServer()
      48 |     server.get('/', async (_, res) => {

      at tests/plugins.test.ts:45:3
      at Object.<anonymous> (tests/plugins.test.ts:8:1)

FAIL tests/logger.test.ts (23.073 s)
  Logger
    ✕ name property (5001 ms)
    ✕ redact environment variables (5002 ms)
    ✕ redact log paths (5001 ms)
    ✕ request ID generator (5001 ms)

  ● Logger › name property

    thrown: "Exceeded timeout of 5000 ms for a test.
    Use jest.setTimeout(newTimeout) to increase the timeout value, if this is a long-running test."

      2 |
      3 | describe('Logger', () => {
    > 4 |   test('name property', async () => {
        |   ^
      5 |     const [logLine] = await testLogs(logLine => logLine.dataTestID === 'name')
      6 |     expect(logLine.from).toEqual('foo')
      7 |   })

      at tests/logger.test.ts:4:3
      at Object.<anonymous> (tests/logger.test.ts:3:1)

  ● Logger › redact environment variables

    thrown: "Exceeded timeout of 5000 ms for a test.
    Use jest.setTimeout(newTimeout) to increase the timeout value, if this is a long-running test."

       7 |   })
       8 |
    >  9 |   test('redact environment variables', async () => {
         |   ^
      10 |     const [logLine] = await testLogs(
      11 |       logLine => logLine.dataTestID === 'redact-env'
      12 |     )

      at tests/logger.test.ts:9:3
      at Object.<anonymous> (tests/logger.test.ts:3:1)

  ● Logger › redact log paths

    thrown: "Exceeded timeout of 5000 ms for a test.
    Use jest.setTimeout(newTimeout) to increase the timeout value, if this is a long-running test."

      14 |   })
      15 |
    > 16 |   test('redact log paths', async () => {
         |   ^
      17 |     const [logLine] = await testLogs(
      18 |       logLine => logLine.dataTestID === 'redact-path'
      19 |     )

      at tests/logger.test.ts:16:3
      at Object.<anonymous> (tests/logger.test.ts:3:1)

  ● Logger › request ID generator

    thrown: "Exceeded timeout of 5000 ms for a test.
    Use jest.setTimeout(newTimeout) to increase the timeout value, if this is a long-running test."

      21 |   })
      22 |
    > 23 |   test('request ID generator', async () => {
         |   ^
      24 |     type ReqResLog = { reqId: string }
      25 |
      26 |     const [req1, res1, req2, res2, req3, res3, req4, res4] =

      at tests/logger.test.ts:23:3
      at Object.<anonymous> (tests/logger.test.ts:3:1)

ts-jest[ts-jest-transformer] (WARN) Got a `.js` file to compile while `allowJs` option is not set to `true` (file: /data/js-variants/multee/VariantsDeps/fastify/variant2/fastify/fastify.js). To fix this:
  - if you want TypeScript to process JS files, set `allowJs` to `true` in your TypeScript config (usually tsconfig.json)
  - if you do not want TypeScript to process your `.js` files, in your Jest config change the `transform` key which value is `ts-jest` so that it does not match `.js` files anymore
Browserslist: caniuse-lite is outdated. Please run:
  npx browserslist@latest --update-db
  Why you should do it regularly: https://github.com/browserslist/browserslist#browsers-data-updating
ts-jest[ts-jest-transformer] (WARN) Got a `.js` file to compile while `allowJs` option is not set to `true` (file: /data/js-variants/multee/VariantsDeps/fastify/variant2/fastify/lib/symbols.js). To fix this:
  - if you want TypeScript to process JS files, set `allowJs` to `true` in your TypeScript config (usually tsconfig.json)
  - if you do not want TypeScript to process your `.js` files, in your Jest config change the `transform` key which value is `ts-jest` so that it does not match `.js` files anymore
ts-jest[ts-jest-transformer] (WARN) Got a `.js` file to compile while `allowJs` option is not set to `true` (file: /data/js-variants/multee/VariantsDeps/fastify/variant2/fastify/lib/server.js). To fix this:
  - if you want TypeScript to process JS files, set `allowJs` to `true` in your TypeScript config (usually tsconfig.json)
  - if you do not want TypeScript to process your `.js` files, in your Jest config change the `transform` key which value is `ts-jest` so that it does not match `.js` files anymore
ts-jest[ts-jest-transformer] (WARN) Got a `.js` file to compile while `allowJs` option is not set to `true` (file: /data/js-variants/multee/VariantsDeps/fastify/variant2/fastify/lib/warnings.js). To fix this:
  - if you want TypeScript to process JS files, set `allowJs` to `true` in your TypeScript config (usually tsconfig.json)
  - if you do not want TypeScript to process your `.js` files, in your Jest config change the `transform` key which value is `ts-jest` so that it does not match `.js` files anymore
ts-jest[ts-jest-transformer] (WARN) Got a `.js` file to compile while `allowJs` option is not set to `true` (file: /data/js-variants/multee/VariantsDeps/fastify/variant2/fastify/lib/errors.js). To fix this:
  - if you want TypeScript to process JS files, set `allowJs` to `true` in your TypeScript config (usually tsconfig.json)
  - if you do not want TypeScript to process your `.js` files, in your Jest config change the `transform` key which value is `ts-jest` so that it does not match `.js` files anymore
ts-jest[ts-jest-transformer] (WARN) Got a `.js` file to compile while `allowJs` option is not set to `true` (file: /data/js-variants/multee/VariantsDeps/fastify/variant2/fastify/lib/reply.js). To fix this:
  - if you want TypeScript to process JS files, set `allowJs` to `true` in your TypeScript config (usually tsconfig.json)
  - if you do not want TypeScript to process your `.js` files, in your Jest config change the `transform` key which value is `ts-jest` so that it does not match `.js` files anymore
ts-jest[ts-jest-transformer] (WARN) Got a `.js` file to compile while `allowJs` option is not set to `true` (file: /data/js-variants/multee/VariantsDeps/fastify/variant2/fastify/lib/hooks.js). To fix this:
  - if you want TypeScript to process JS files, set `allowJs` to `true` in your TypeScript config (usually tsconfig.json)
  - if you do not want TypeScript to process your `.js` files, in your Jest config change the `transform` key which value is `ts-jest` so that it does not match `.js` files anymore
ts-jest[ts-jest-transformer] (WARN) Got a `.js` file to compile while `allowJs` option is not set to `true` (file: /data/js-variants/multee/VariantsDeps/fastify/variant2/fastify/lib/handleRequest.js). To fix this:
  - if you want TypeScript to process JS files, set `allowJs` to `true` in your TypeScript config (usually tsconfig.json)
  - if you do not want TypeScript to process your `.js` files, in your Jest config change the `transform` key which value is `ts-jest` so that it does not match `.js` files anymore
ts-jest[ts-jest-transformer] (WARN) Got a `.js` file to compile while `allowJs` option is not set to `true` (file: /data/js-variants/multee/VariantsDeps/fastify/variant2/fastify/lib/validation.js). To fix this:
  - if you want TypeScript to process JS files, set `allowJs` to `true` in your TypeScript config (usually tsconfig.json)
  - if you do not want TypeScript to process your `.js` files, in your Jest config change the `transform` key which value is `ts-jest` so that it does not match `.js` files anymore
ts-jest[ts-jest-transformer] (WARN) Got a `.js` file to compile while `allowJs` option is not set to `true` (file: /data/js-variants/multee/VariantsDeps/fastify/variant2/fastify/lib/wrapThenable.js). To fix this:
  - if you want TypeScript to process JS files, set `allowJs` to `true` in your TypeScript config (usually tsconfig.json)
  - if you do not want TypeScript to process your `.js` files, in your Jest config change the `transform` key which value is `ts-jest` so that it does not match `.js` files anymore
ts-jest[ts-jest-transformer] (WARN) Got a `.js` file to compile while `allowJs` option is not set to `true` (file: /data/js-variants/multee/VariantsDeps/fastify/variant2/fastify/lib/logger.js). To fix this:
  - if you want TypeScript to process JS files, set `allowJs` to `true` in your TypeScript config (usually tsconfig.json)
  - if you do not want TypeScript to process your `.js` files, in your Jest config change the `transform` key which value is `ts-jest` so that it does not match `.js` files anymore
ts-jest[ts-jest-transformer] (WARN) Got a `.js` file to compile while `allowJs` option is not set to `true` (file: /data/js-variants/multee/VariantsDeps/fastify/variant2/fastify/lib/error-handler.js). To fix this:
  - if you want TypeScript to process JS files, set `allowJs` to `true` in your TypeScript config (usually tsconfig.json)
  - if you do not want TypeScript to process your `.js` files, in your Jest config change the `transform` key which value is `ts-jest` so that it does not match `.js` files anymore
ts-jest[ts-jest-transformer] (WARN) Got a `.js` file to compile while `allowJs` option is not set to `true` (file: /data/js-variants/multee/VariantsDeps/fastify/variant2/fastify/lib/schemas.js). To fix this:
  - if you want TypeScript to process JS files, set `allowJs` to `true` in your TypeScript config (usually tsconfig.json)
  - if you do not want TypeScript to process your `.js` files, in your Jest config change the `transform` key which value is `ts-jest` so that it does not match `.js` files anymore
ts-jest[ts-jest-transformer] (WARN) Got a `.js` file to compile while `allowJs` option is not set to `true` (file: /data/js-variants/multee/VariantsDeps/fastify/variant2/fastify/lib/error-serializer.js). To fix this:
  - if you want TypeScript to process JS files, set `allowJs` to `true` in your TypeScript config (usually tsconfig.json)
  - if you do not want TypeScript to process your `.js` files, in your Jest config change the `transform` key which value is `ts-jest` so that it does not match `.js` files anymore
ts-jest[ts-jest-transformer] (WARN) Got a `.js` file to compile while `allowJs` option is not set to `true` (file: /data/js-variants/multee/VariantsDeps/fastify/variant2/fastify/lib/request.js). To fix this:
  - if you want TypeScript to process JS files, set `allowJs` to `true` in your TypeScript config (usually tsconfig.json)
  - if you do not want TypeScript to process your `.js` files, in your Jest config change the `transform` key which value is `ts-jest` so that it does not match `.js` files anymore
ts-jest[ts-jest-transformer] (WARN) Got a `.js` file to compile while `allowJs` option is not set to `true` (file: /data/js-variants/multee/VariantsDeps/fastify/variant2/fastify/lib/decorate.js). To fix this:
  - if you want TypeScript to process JS files, set `allowJs` to `true` in your TypeScript config (usually tsconfig.json)
  - if you do not want TypeScript to process your `.js` files, in your Jest config change the `transform` key which value is `ts-jest` so that it does not match `.js` files anymore
ts-jest[ts-jest-transformer] (WARN) Got a `.js` file to compile while `allowJs` option is not set to `true` (file: /data/js-variants/multee/VariantsDeps/fastify/variant2/fastify/lib/contentTypeParser.js). To fix this:
  - if you want TypeScript to process JS files, set `allowJs` to `true` in your TypeScript config (usually tsconfig.json)
  - if you do not want TypeScript to process your `.js` files, in your Jest config change the `transform` key which value is `ts-jest` so that it does not match `.js` files anymore
ts-jest[ts-jest-transformer] (WARN) Got a `.js` file to compile while `allowJs` option is not set to `true` (file: /data/js-variants/multee/VariantsDeps/fastify/variant2/fastify/lib/schema-controller.js). To fix this:
  - if you want TypeScript to process JS files, set `allowJs` to `true` in your TypeScript config (usually tsconfig.json)
  - if you do not want TypeScript to process your `.js` files, in your Jest config change the `transform` key which value is `ts-jest` so that it does not match `.js` files anymore
ts-jest[ts-jest-transformer] (WARN) Got a `.js` file to compile while `allowJs` option is not set to `true` (file: /data/js-variants/multee/VariantsDeps/fastify/variant2/fastify/lib/pluginUtils.js). To fix this:
  - if you want TypeScript to process JS files, set `allowJs` to `true` in your TypeScript config (usually tsconfig.json)
  - if you do not want TypeScript to process your `.js` files, in your Jest config change the `transform` key which value is `ts-jest` so that it does not match `.js` files anymore
ts-jest[ts-jest-transformer] (WARN) Got a `.js` file to compile while `allowJs` option is not set to `true` (file: /data/js-variants/multee/VariantsDeps/fastify/variant2/fastify/lib/reqIdGenFactory.js). To fix this:
  - if you want TypeScript to process JS files, set `allowJs` to `true` in your TypeScript config (usually tsconfig.json)
  - if you do not want TypeScript to process your `.js` files, in your Jest config change the `transform` key which value is `ts-jest` so that it does not match `.js` files anymore
ts-jest[ts-jest-transformer] (WARN) Got a `.js` file to compile while `allowJs` option is not set to `true` (file: /data/js-variants/multee/VariantsDeps/fastify/variant2/fastify/lib/route.js). To fix this:
  - if you want TypeScript to process JS files, set `allowJs` to `true` in your TypeScript config (usually tsconfig.json)
  - if you do not want TypeScript to process your `.js` files, in your Jest config change the `transform` key which value is `ts-jest` so that it does not match `.js` files anymore
ts-jest[ts-jest-transformer] (WARN) Got a `.js` file to compile while `allowJs` option is not set to `true` (file: /data/js-variants/multee/VariantsDeps/fastify/variant2/fastify/lib/context.js). To fix this:
  - if you want TypeScript to process JS files, set `allowJs` to `true` in your TypeScript config (usually tsconfig.json)
  - if you do not want TypeScript to process your `.js` files, in your Jest config change the `transform` key which value is `ts-jest` so that it does not match `.js` files anymore
ts-jest[ts-jest-transformer] (WARN) Got a `.js` file to compile while `allowJs` option is not set to `true` (file: /data/js-variants/multee/VariantsDeps/fastify/variant2/fastify/lib/headRoute.js). To fix this:
  - if you want TypeScript to process JS files, set `allowJs` to `true` in your TypeScript config (usually tsconfig.json)
  - if you do not want TypeScript to process your `.js` files, in your Jest config change the `transform` key which value is `ts-jest` so that it does not match `.js` files anymore
ts-jest[ts-jest-transformer] (WARN) Got a `.js` file to compile while `allowJs` option is not set to `true` (file: /data/js-variants/multee/VariantsDeps/fastify/variant2/fastify/lib/fourOhFour.js). To fix this:
  - if you want TypeScript to process JS files, set `allowJs` to `true` in your TypeScript config (usually tsconfig.json)
  - if you do not want TypeScript to process your `.js` files, in your Jest config change the `transform` key which value is `ts-jest` so that it does not match `.js` files anymore
ts-jest[ts-jest-transformer] (WARN) Got a `.js` file to compile while `allowJs` option is not set to `true` (file: /data/js-variants/multee/VariantsDeps/fastify/variant2/fastify/lib/initialConfigValidation.js). To fix this:
  - if you want TypeScript to process JS files, set `allowJs` to `true` in your TypeScript config (usually tsconfig.json)
  - if you do not want TypeScript to process your `.js` files, in your Jest config change the `transform` key which value is `ts-jest` so that it does not match `.js` files anymore
ts-jest[ts-jest-transformer] (WARN) Got a `.js` file to compile while `allowJs` option is not set to `true` (file: /data/js-variants/multee/VariantsDeps/fastify/variant2/fastify/lib/configValidator.js). To fix this:
  - if you want TypeScript to process JS files, set `allowJs` to `true` in your TypeScript config (usually tsconfig.json)
  - if you do not want TypeScript to process your `.js` files, in your Jest config change the `transform` key which value is `ts-jest` so that it does not match `.js` files anymore
ts-jest[ts-jest-transformer] (WARN) Got a `.js` file to compile while `allowJs` option is not set to `true` (file: /data/js-variants/multee/VariantsDeps/fastify/variant2/fastify/lib/pluginOverride.js). To fix this:
  - if you want TypeScript to process JS files, set `allowJs` to `true` in your TypeScript config (usually tsconfig.json)
  - if you do not want TypeScript to process your `.js` files, in your Jest config change the `transform` key which value is `ts-jest` so that it does not match `.js` files anymore
ts-jest[ts-jest-transformer] (WARN) Got a `.js` file to compile while `allowJs` option is not set to `true` (file: /data/js-variants/multee/VariantsDeps/fastify/variant2/fastify/lib/noop-set.js). To fix this:
  - if you want TypeScript to process JS files, set `allowJs` to `true` in your TypeScript config (usually tsconfig.json)
  - if you do not want TypeScript to process your `.js` files, in your Jest config change the `transform` key which value is `ts-jest` so that it does not match `.js` files anymore
FAIL tests/basics.test.ts (23.204 s)
  Basics
    ✓ The specified `name` property is injected (39 ms)
    ✕ Default port should be 3000 (5008 ms)
    ✕ Port should be configurable via the environment (5001 ms)
    ✕ Port can be passed as a second argument to `startServer` (5001 ms)

  ● Basics › Default port should be 3000

    FastifyError: fastify-plugin: fastify-micro:sentry - expected '3.x' fastify version, '4.3.0' is installed

      127 |   if (!name) return
      128 |   this[registeredPlugins].push(name)
    > 129 | }
          |  ^
      130 |
      131 | function registerPlugin (fn) {
      132 |   registerPluginName.call(this, fn)

      at Object.checkVersion (../../../VariantsDeps/fastify/variant2/fastify/lib/pluginUtils.js:129:11)
      at Object.registerPlugin (../../../VariantsDeps/fastify/variant2/fastify/lib/pluginUtils.js:143:16)
      at Boot.override (../../../VariantsDeps/fastify/variant2/fastify/lib/pluginOverride.js:35:57)
      at Plugin.Object.<anonymous>.Plugin.exec (../../../VariantsDeps/fastify/variant2/fastify/node_modules/avvio/plugin.js:79:33)
      at Boot.loadPlugin (../../../VariantsDeps/fastify/variant2/fastify/node_modules/avvio/plugin.js:272:10)

  ● Basics › Default port should be 3000

    FastifyError: fastify-plugin: fastify-micro:sentry - expected '3.x' fastify version, '4.3.0' is installed

      127 |   if (!name) return
      128 |   this[registeredPlugins].push(name)
    > 129 | }
          |  ^
      130 |
      131 | function registerPlugin (fn) {
      132 |   registerPluginName.call(this, fn)

      at Object.checkVersion (../../../VariantsDeps/fastify/variant2/fastify/lib/pluginUtils.js:129:11)
      at Object.registerPlugin (../../../VariantsDeps/fastify/variant2/fastify/lib/pluginUtils.js:143:16)
      at Boot.override (../../../VariantsDeps/fastify/variant2/fastify/lib/pluginOverride.js:35:57)
      at Plugin.Object.<anonymous>.Plugin.exec (../../../VariantsDeps/fastify/variant2/fastify/node_modules/avvio/plugin.js:79:33)
      at Boot.loadPlugin (../../../VariantsDeps/fastify/variant2/fastify/node_modules/avvio/plugin.js:272:10)

  ● Basics › Default port should be 3000

    FastifyError: fastify-plugin: fastify-micro:sentry - expected '3.x' fastify version, '4.3.0' is installed

      127 |   if (!name) return
      128 |   this[registeredPlugins].push(name)
    > 129 | }
          |  ^
      130 |
      131 | function registerPlugin (fn) {
      132 |   registerPluginName.call(this, fn)

      at Object.checkVersion (../../../VariantsDeps/fastify/variant2/fastify/lib/pluginUtils.js:129:11)
      at Object.registerPlugin (../../../VariantsDeps/fastify/variant2/fastify/lib/pluginUtils.js:143:16)
      at Boot.override (../../../VariantsDeps/fastify/variant2/fastify/lib/pluginOverride.js:35:57)
      at Plugin.Object.<anonymous>.Plugin.exec (../../../VariantsDeps/fastify/variant2/fastify/node_modules/avvio/plugin.js:79:33)
      at Boot.loadPlugin (../../../VariantsDeps/fastify/variant2/fastify/node_modules/avvio/plugin.js:272:10)

  ● Basics › Default port should be 3000

    thrown: "Exceeded timeout of 5000 ms for a test.
    Use jest.setTimeout(newTimeout) to increase the timeout value, if this is a long-running test."

      15 |   })
      16 |
    > 17 |   test('Default port should be 3000', async () => {
         |   ^
      18 |     const key = nanoid()
      19 |     const server = createServer()
      20 |     server.get('/', (_, res) => {

      at tests/basics.test.ts:17:3
      at Object.<anonymous> (tests/basics.test.ts:5:1)

  ● Basics › Port should be configurable via the environment

    FastifyError: fastify-plugin: fastify-micro:sentry - expected '3.x' fastify version, '4.3.0' is installed

      127 |   if (!name) return
      128 |   this[registeredPlugins].push(name)
    > 129 | }
          |  ^
      130 |
      131 | function registerPlugin (fn) {
      132 |   registerPluginName.call(this, fn)

      at Object.checkVersion (../../../VariantsDeps/fastify/variant2/fastify/lib/pluginUtils.js:129:11)
      at Object.registerPlugin (../../../VariantsDeps/fastify/variant2/fastify/lib/pluginUtils.js:143:16)
      at Boot.override (../../../VariantsDeps/fastify/variant2/fastify/lib/pluginOverride.js:35:57)
      at Plugin.Object.<anonymous>.Plugin.exec (../../../VariantsDeps/fastify/variant2/fastify/node_modules/avvio/plugin.js:79:33)
      at Boot.loadPlugin (../../../VariantsDeps/fastify/variant2/fastify/node_modules/avvio/plugin.js:272:10)

  ● Basics › Port should be configurable via the environment

    thrown: "Exceeded timeout of 5000 ms for a test.
    Use jest.setTimeout(newTimeout) to increase the timeout value, if this is a long-running test."

      27 |   })
      28 |
    > 29 |   test('Port should be configurable via the environment', async () => {
         |   ^
      30 |     process.env.PORT = '3001'
      31 |     const key = nanoid()
      32 |     const server = createServer()

      at tests/basics.test.ts:29:3
      at Object.<anonymous> (tests/basics.test.ts:5:1)

  ● Basics › Port can be passed as a second argument to `startServer`

    FastifyError: fastify-plugin: fastify-micro:sentry - expected '3.x' fastify version, '4.3.0' is installed

      127 |   if (!name) return
      128 |   this[registeredPlugins].push(name)
    > 129 | }
          |  ^
      130 |
      131 | function registerPlugin (fn) {
      132 |   registerPluginName.call(this, fn)

      at Object.checkVersion (../../../VariantsDeps/fastify/variant2/fastify/lib/pluginUtils.js:129:11)
      at Object.registerPlugin (../../../VariantsDeps/fastify/variant2/fastify/lib/pluginUtils.js:143:16)
      at Boot.override (../../../VariantsDeps/fastify/variant2/fastify/lib/pluginOverride.js:35:57)
      at Plugin.Object.<anonymous>.Plugin.exec (../../../VariantsDeps/fastify/variant2/fastify/node_modules/avvio/plugin.js:79:33)
      at Boot.loadPlugin (../../../VariantsDeps/fastify/variant2/fastify/node_modules/avvio/plugin.js:272:10)

  ● Basics › Port can be passed as a second argument to `startServer`

    FastifyError: fastify-plugin: Plugin did not start in time: 'bound _after'. You may have forgotten to call 'done' function or to resolve a Promise

      618 |     // config issue on the load balancer side.
      619 |     this.log.trace({ err }, 'client error')
    > 620 |     // Copying standard node behaviour
          |                                       ^
      621 |     // https://github.com/nodejs/node/blob/6ca23d7846cb47e84fd344543e394e50938540be/lib/_http_server.js#L666
      622 |
      623 |     // If the socket is not writable, there is no reason to try to send data.

      at manageErr (../../../VariantsDeps/fastify/variant2/fastify/fastify.js:620:87)
      at ../../../VariantsDeps/fastify/variant2/fastify/fastify.js:607:11
      at Object._encapsulateThreeParam (../../../VariantsDeps/fastify/variant2/fastify/node_modules/avvio/boot.js:557:7)
      at Boot.timeoutCall (../../../VariantsDeps/fastify/variant2/fastify/node_modules/avvio/boot.js:453:5)
      at Boot.callWithCbOrNextTick (../../../VariantsDeps/fastify/variant2/fastify/node_modules/avvio/boot.js:435:19)
      at release (../../../VariantsDeps/fastify/variant2/fastify/node_modules/fastq/queue.js:149:16)
      at Object.resume (../../../VariantsDeps/fastify/variant2/fastify/node_modules/fastq/queue.js:82:7)
      at ../../../VariantsDeps/fastify/variant2/fastify/node_modules/avvio/boot.js:174:18
      at ../../../VariantsDeps/fastify/variant2/fastify/node_modules/avvio/plugin.js:275:7
      at done (../../../VariantsDeps/fastify/variant2/fastify/node_modules/avvio/plugin.js:200:5)

  ● Basics › Port can be passed as a second argument to `startServer`

    FastifyError: fastify-plugin: Plugin did not start in time: 'bound _after'. You may have forgotten to call 'done' function or to resolve a Promise

      618 |     // config issue on the load balancer side.
      619 |     this.log.trace({ err }, 'client error')
    > 620 |     // Copying standard node behaviour
          |                                       ^
      621 |     // https://github.com/nodejs/node/blob/6ca23d7846cb47e84fd344543e394e50938540be/lib/_http_server.js#L666
      622 |
      623 |     // If the socket is not writable, there is no reason to try to send data.

      at manageErr (../../../VariantsDeps/fastify/variant2/fastify/fastify.js:620:87)
      at ../../../VariantsDeps/fastify/variant2/fastify/fastify.js:607:11
      at Object._encapsulateThreeParam (../../../VariantsDeps/fastify/variant2/fastify/node_modules/avvio/boot.js:557:7)
      at Boot.timeoutCall (../../../VariantsDeps/fastify/variant2/fastify/node_modules/avvio/boot.js:453:5)
      at Boot.callWithCbOrNextTick (../../../VariantsDeps/fastify/variant2/fastify/node_modules/avvio/boot.js:435:19)
      at release (../../../VariantsDeps/fastify/variant2/fastify/node_modules/fastq/queue.js:149:16)
      at Object.resume (../../../VariantsDeps/fastify/variant2/fastify/node_modules/fastq/queue.js:82:7)
      at ../../../VariantsDeps/fastify/variant2/fastify/node_modules/avvio/boot.js:174:18
      at ../../../VariantsDeps/fastify/variant2/fastify/node_modules/avvio/plugin.js:275:7
      at done (../../../VariantsDeps/fastify/variant2/fastify/node_modules/avvio/plugin.js:200:5)

  ● Basics › Port can be passed as a second argument to `startServer`

    FastifyError: fastify-plugin: Plugin did not start in time: 'bound _after'. You may have forgotten to call 'done' function or to resolve a Promise

      618 |     // config issue on the load balancer side.
      619 |     this.log.trace({ err }, 'client error')
    > 620 |     // Copying standard node behaviour
          |                                       ^
      621 |     // https://github.com/nodejs/node/blob/6ca23d7846cb47e84fd344543e394e50938540be/lib/_http_server.js#L666
      622 |
      623 |     // If the socket is not writable, there is no reason to try to send data.

      at manageErr (../../../VariantsDeps/fastify/variant2/fastify/fastify.js:620:87)
      at ../../../VariantsDeps/fastify/variant2/fastify/fastify.js:607:11
      at Object._encapsulateThreeParam (../../../VariantsDeps/fastify/variant2/fastify/node_modules/avvio/boot.js:557:7)
      at Boot.timeoutCall (../../../VariantsDeps/fastify/variant2/fastify/node_modules/avvio/boot.js:453:5)
      at Boot.callWithCbOrNextTick (../../../VariantsDeps/fastify/variant2/fastify/node_modules/avvio/boot.js:435:19)
      at release (../../../VariantsDeps/fastify/variant2/fastify/node_modules/fastq/queue.js:149:16)
      at Object.resume (../../../VariantsDeps/fastify/variant2/fastify/node_modules/fastq/queue.js:82:7)
      at ../../../VariantsDeps/fastify/variant2/fastify/node_modules/avvio/boot.js:174:18
      at ../../../VariantsDeps/fastify/variant2/fastify/node_modules/avvio/plugin.js:275:7
      at done (../../../VariantsDeps/fastify/variant2/fastify/node_modules/avvio/plugin.js:200:5)

  ● Basics › Port can be passed as a second argument to `startServer`

    thrown: "Exceeded timeout of 5000 ms for a test.
    Use jest.setTimeout(newTimeout) to increase the timeout value, if this is a long-running test."

      41 |   })
      42 |
    > 43 |   test('Port can be passed as a second argument to `startServer`', async () => {
         |   ^
      44 |     const server = createServer()
      45 |     const key = nanoid()
      46 |     server.get('/', (_, res) => {

      at tests/basics.test.ts:43:3
      at Object.<anonymous> (tests/basics.test.ts:5:1)

FAIL tests/sentry.test.ts (45.531 s)
  Sentry reporting
    ✕ Sentry is disabled without a DSN (5002 ms)
    ✕ Sentry is enabled with a DSN (5001 ms)
    ✕ Sentry report for route errors (5002 ms)
    ✕ Sentry manual reports at app level (5001 ms)
    ✕ Report enrichment in route (5000 ms)
    ✕ Report enrichment, global getters (5000 ms)
    ✕ User enrichment (5000 ms)
    ✕ 4xx statuses are not reported to Sentry (5002 ms)
    ✕ Schema validation errors are not reported to Sentry (5002 ms)

  ● Sentry reporting › Sentry is disabled without a DSN

    FastifyError: fastify-plugin: fastify-micro:sentry - expected '3.x' fastify version, '4.3.0' is installed

      127 |   if (!name) return
      128 |   this[registeredPlugins].push(name)
    > 129 | }
          |  ^
      130 |
      131 | function registerPlugin (fn) {
      132 |   registerPluginName.call(this, fn)

      at Object.checkVersion (../../../VariantsDeps/fastify/variant2/fastify/lib/pluginUtils.js:129:11)
      at Object.registerPlugin (../../../VariantsDeps/fastify/variant2/fastify/lib/pluginUtils.js:143:16)
      at Boot.override (../../../VariantsDeps/fastify/variant2/fastify/lib/pluginOverride.js:35:57)
      at Plugin.Object.<anonymous>.Plugin.exec (../../../VariantsDeps/fastify/variant2/fastify/node_modules/avvio/plugin.js:79:33)
      at Boot.loadPlugin (../../../VariantsDeps/fastify/variant2/fastify/node_modules/avvio/plugin.js:272:10)

  ● Sentry reporting › Sentry is disabled without a DSN

    FastifyError: fastify-plugin: Plugin did not start in time: 'bound _after'. You may have forgotten to call 'done' function or to resolve a Promise

      618 |     // config issue on the load balancer side.
      619 |     this.log.trace({ err }, 'client error')
    > 620 |     // Copying standard node behaviour
          |                                       ^
      621 |     // https://github.com/nodejs/node/blob/6ca23d7846cb47e84fd344543e394e50938540be/lib/_http_server.js#L666
      622 |
      623 |     // If the socket is not writable, there is no reason to try to send data.

      at manageErr (../../../VariantsDeps/fastify/variant2/fastify/fastify.js:620:87)
      at ../../../VariantsDeps/fastify/variant2/fastify/fastify.js:607:11
      at Object._encapsulateThreeParam (../../../VariantsDeps/fastify/variant2/fastify/node_modules/avvio/boot.js:557:7)
      at Boot.timeoutCall (../../../VariantsDeps/fastify/variant2/fastify/node_modules/avvio/boot.js:453:5)
      at Boot.callWithCbOrNextTick (../../../VariantsDeps/fastify/variant2/fastify/node_modules/avvio/boot.js:435:19)
      at release (../../../VariantsDeps/fastify/variant2/fastify/node_modules/fastq/queue.js:149:16)
      at Object.resume (../../../VariantsDeps/fastify/variant2/fastify/node_modules/fastq/queue.js:82:7)
      at ../../../VariantsDeps/fastify/variant2/fastify/node_modules/avvio/boot.js:174:18
      at ../../../VariantsDeps/fastify/variant2/fastify/node_modules/avvio/plugin.js:275:7
      at done (../../../VariantsDeps/fastify/variant2/fastify/node_modules/avvio/plugin.js:200:5)

  ● Sentry reporting › Sentry is disabled without a DSN

    FastifyError: fastify-plugin: Plugin did not start in time: 'bound _after'. You may have forgotten to call 'done' function or to resolve a Promise

      618 |     // config issue on the load balancer side.
      619 |     this.log.trace({ err }, 'client error')
    > 620 |     // Copying standard node behaviour
          |                                       ^
      621 |     // https://github.com/nodejs/node/blob/6ca23d7846cb47e84fd344543e394e50938540be/lib/_http_server.js#L666
      622 |
      623 |     // If the socket is not writable, there is no reason to try to send data.

      at manageErr (../../../VariantsDeps/fastify/variant2/fastify/fastify.js:620:87)
      at ../../../VariantsDeps/fastify/variant2/fastify/fastify.js:607:11
      at Object._encapsulateThreeParam (../../../VariantsDeps/fastify/variant2/fastify/node_modules/avvio/boot.js:557:7)
      at Boot.timeoutCall (../../../VariantsDeps/fastify/variant2/fastify/node_modules/avvio/boot.js:453:5)
      at Boot.callWithCbOrNextTick (../../../VariantsDeps/fastify/variant2/fastify/node_modules/avvio/boot.js:435:19)
      at release (../../../VariantsDeps/fastify/variant2/fastify/node_modules/fastq/queue.js:149:16)
      at Object.resume (../../../VariantsDeps/fastify/variant2/fastify/node_modules/fastq/queue.js:82:7)
      at ../../../VariantsDeps/fastify/variant2/fastify/node_modules/avvio/boot.js:174:18
      at ../../../VariantsDeps/fastify/variant2/fastify/node_modules/avvio/plugin.js:275:7
      at done (../../../VariantsDeps/fastify/variant2/fastify/node_modules/avvio/plugin.js:200:5)

  ● Sentry reporting › Sentry is disabled without a DSN

    thrown: "Exceeded timeout of 5000 ms for a test.
    Use jest.setTimeout(newTimeout) to increase the timeout value, if this is a long-running test."

      25 |   // --
      26 |
    > 27 |   test('Sentry is disabled without a DSN', async () => {
         |   ^
      28 |     const { testkit, sentryTransport } = sentryTestkit()
      29 |     process.env.NODE_ENV = 'test'
      30 |     process.env.LOG_LEVEL = 'silent'

      at tests/sentry.test.ts:27:3
      at Object.<anonymous> (tests/sentry.test.ts:5:1)

  ● Sentry reporting › Sentry is enabled with a DSN

    FastifyError: fastify-plugin: fastify-micro:sentry - expected '3.x' fastify version, '4.3.0' is installed

      127 |   if (!name) return
      128 |   this[registeredPlugins].push(name)
    > 129 | }
          |  ^
      130 |
      131 | function registerPlugin (fn) {
      132 |   registerPluginName.call(this, fn)

      at Object.checkVersion (../../../VariantsDeps/fastify/variant2/fastify/lib/pluginUtils.js:129:11)
      at Object.registerPlugin (../../../VariantsDeps/fastify/variant2/fastify/lib/pluginUtils.js:143:16)
      at Boot.override (../../../VariantsDeps/fastify/variant2/fastify/lib/pluginOverride.js:35:57)
      at Plugin.Object.<anonymous>.Plugin.exec (../../../VariantsDeps/fastify/variant2/fastify/node_modules/avvio/plugin.js:79:33)
      at Boot.loadPlugin (../../../VariantsDeps/fastify/variant2/fastify/node_modules/avvio/plugin.js:272:10)

  ● Sentry reporting › Sentry is enabled with a DSN

    thrown: "Exceeded timeout of 5000 ms for a test.
    Use jest.setTimeout(newTimeout) to increase the timeout value, if this is a long-running test."

      43 |   // --
      44 |
    > 45 |   test('Sentry is enabled with a DSN', async () => {
         |   ^
      46 |     const { testkit, sentryTransport } = sentryTestkit()
      47 |     setupEnv()
      48 |     const server = createServer({

      at tests/sentry.test.ts:45:3
      at Object.<anonymous> (tests/sentry.test.ts:5:1)

  ● Sentry reporting › Sentry report for route errors

    FastifyError: fastify-plugin: fastify-micro:sentry - expected '3.x' fastify version, '4.3.0' is installed

      127 |   if (!name) return
      128 |   this[registeredPlugins].push(name)
    > 129 | }
          |  ^
      130 |
      131 | function registerPlugin (fn) {
      132 |   registerPluginName.call(this, fn)

      at Object.checkVersion (../../../VariantsDeps/fastify/variant2/fastify/lib/pluginUtils.js:129:11)
      at Object.registerPlugin (../../../VariantsDeps/fastify/variant2/fastify/lib/pluginUtils.js:143:16)
      at Boot.override (../../../VariantsDeps/fastify/variant2/fastify/lib/pluginOverride.js:35:57)
      at Plugin.Object.<anonymous>.Plugin.exec (../../../VariantsDeps/fastify/variant2/fastify/node_modules/avvio/plugin.js:79:33)
      at Boot.loadPlugin (../../../VariantsDeps/fastify/variant2/fastify/node_modules/avvio/plugin.js:272:10)

  ● Sentry reporting › Sentry report for route errors

    FastifyError: fastify-plugin: Plugin did not start in time: 'bound _after'. You may have forgotten to call 'done' function or to resolve a Promise

      618 |     // config issue on the load balancer side.
      619 |     this.log.trace({ err }, 'client error')
    > 620 |     // Copying standard node behaviour
          |                                       ^
      621 |     // https://github.com/nodejs/node/blob/6ca23d7846cb47e84fd344543e394e50938540be/lib/_http_server.js#L666
      622 |
      623 |     // If the socket is not writable, there is no reason to try to send data.

      at manageErr (../../../VariantsDeps/fastify/variant2/fastify/fastify.js:620:87)
      at ../../../VariantsDeps/fastify/variant2/fastify/fastify.js:607:11
      at Object._encapsulateThreeParam (../../../VariantsDeps/fastify/variant2/fastify/node_modules/avvio/boot.js:557:7)
      at Boot.timeoutCall (../../../VariantsDeps/fastify/variant2/fastify/node_modules/avvio/boot.js:453:5)
      at Boot.callWithCbOrNextTick (../../../VariantsDeps/fastify/variant2/fastify/node_modules/avvio/boot.js:435:19)
      at release (../../../VariantsDeps/fastify/variant2/fastify/node_modules/fastq/queue.js:149:16)
      at Object.resume (../../../VariantsDeps/fastify/variant2/fastify/node_modules/fastq/queue.js:82:7)
      at ../../../VariantsDeps/fastify/variant2/fastify/node_modules/avvio/boot.js:174:18
      at ../../../VariantsDeps/fastify/variant2/fastify/node_modules/avvio/plugin.js:275:7
      at done (../../../VariantsDeps/fastify/variant2/fastify/node_modules/avvio/plugin.js:200:5)

  ● Sentry reporting › Sentry report for route errors

    thrown: "Exceeded timeout of 5000 ms for a test.
    Use jest.setTimeout(newTimeout) to increase the timeout value, if this is a long-running test."

      62 |   // --
      63 |
    > 64 |   test('Sentry report for route errors', async () => {
         |   ^
      65 |     const { testkit, sentryTransport } = sentryTestkit()
      66 |     setupEnv()
      67 |     const server = createServer({

      at tests/sentry.test.ts:64:3
      at Object.<anonymous> (tests/sentry.test.ts:5:1)

  ● Sentry reporting › Sentry manual reports at app level

    FastifyError: fastify-plugin: fastify-micro:sentry - expected '3.x' fastify version, '4.3.0' is installed

      127 |   if (!name) return
      128 |   this[registeredPlugins].push(name)
    > 129 | }
          |  ^
      130 |
      131 | function registerPlugin (fn) {
      132 |   registerPluginName.call(this, fn)

      at Object.checkVersion (../../../VariantsDeps/fastify/variant2/fastify/lib/pluginUtils.js:129:11)
      at Object.registerPlugin (../../../VariantsDeps/fastify/variant2/fastify/lib/pluginUtils.js:143:16)
      at Boot.override (../../../VariantsDeps/fastify/variant2/fastify/lib/pluginOverride.js:35:57)
      at Plugin.Object.<anonymous>.Plugin.exec (../../../VariantsDeps/fastify/variant2/fastify/node_modules/avvio/plugin.js:79:33)
      at Boot.loadPlugin (../../../VariantsDeps/fastify/variant2/fastify/node_modules/avvio/plugin.js:272:10)

  ● Sentry reporting › Sentry manual reports at app level

    FastifyError: fastify-plugin: Plugin did not start in time: 'bound _after'. You may have forgotten to call 'done' function or to resolve a Promise

      618 |     // config issue on the load balancer side.
      619 |     this.log.trace({ err }, 'client error')
    > 620 |     // Copying standard node behaviour
          |                                       ^
      621 |     // https://github.com/nodejs/node/blob/6ca23d7846cb47e84fd344543e394e50938540be/lib/_http_server.js#L666
      622 |
      623 |     // If the socket is not writable, there is no reason to try to send data.

      at manageErr (../../../VariantsDeps/fastify/variant2/fastify/fastify.js:620:87)
      at ../../../VariantsDeps/fastify/variant2/fastify/fastify.js:607:11
      at Object._encapsulateThreeParam (../../../VariantsDeps/fastify/variant2/fastify/node_modules/avvio/boot.js:557:7)
      at Boot.timeoutCall (../../../VariantsDeps/fastify/variant2/fastify/node_modules/avvio/boot.js:453:5)
      at Boot.callWithCbOrNextTick (../../../VariantsDeps/fastify/variant2/fastify/node_modules/avvio/boot.js:435:19)
      at release (../../../VariantsDeps/fastify/variant2/fastify/node_modules/fastq/queue.js:149:16)
      at Object.resume (../../../VariantsDeps/fastify/variant2/fastify/node_modules/fastq/queue.js:82:7)
      at ../../../VariantsDeps/fastify/variant2/fastify/node_modules/avvio/boot.js:174:18
      at ../../../VariantsDeps/fastify/variant2/fastify/node_modules/avvio/plugin.js:275:7
      at done (../../../VariantsDeps/fastify/variant2/fastify/node_modules/avvio/plugin.js:200:5)

  ● Sentry reporting › Sentry manual reports at app level

    thrown: "Exceeded timeout of 5000 ms for a test.
    Use jest.setTimeout(newTimeout) to increase the timeout value, if this is a long-running test."

      86 |   // --
      87 |
    > 88 |   test('Sentry manual reports at app level', async () => {
         |   ^
      89 |     const { testkit, sentryTransport } = sentryTestkit()
      90 |     setupEnv()
      91 |     const server = createServer({

      at tests/sentry.test.ts:88:3
      at Object.<anonymous> (tests/sentry.test.ts:5:1)

  ● Sentry reporting › Report enrichment in route

    FastifyError: fastify-plugin: fastify-micro:sentry - expected '3.x' fastify version, '4.3.0' is installed

      127 |   if (!name) return
      128 |   this[registeredPlugins].push(name)
    > 129 | }
          |  ^
      130 |
      131 | function registerPlugin (fn) {
      132 |   registerPluginName.call(this, fn)

      at Object.checkVersion (../../../VariantsDeps/fastify/variant2/fastify/lib/pluginUtils.js:129:11)
      at Object.registerPlugin (../../../VariantsDeps/fastify/variant2/fastify/lib/pluginUtils.js:143:16)
      at Boot.override (../../../VariantsDeps/fastify/variant2/fastify/lib/pluginOverride.js:35:57)
      at Plugin.Object.<anonymous>.Plugin.exec (../../../VariantsDeps/fastify/variant2/fastify/node_modules/avvio/plugin.js:79:33)
      at Boot.loadPlugin (../../../VariantsDeps/fastify/variant2/fastify/node_modules/avvio/plugin.js:272:10)

  ● Sentry reporting › Report enrichment in route

    FastifyError: fastify-plugin: Plugin did not start in time: 'bound _after'. You may have forgotten to call 'done' function or to resolve a Promise

      618 |     // config issue on the load balancer side.
      619 |     this.log.trace({ err }, 'client error')
    > 620 |     // Copying standard node behaviour
          |                                       ^
      621 |     // https://github.com/nodejs/node/blob/6ca23d7846cb47e84fd344543e394e50938540be/lib/_http_server.js#L666
      622 |
      623 |     // If the socket is not writable, there is no reason to try to send data.

      at manageErr (../../../VariantsDeps/fastify/variant2/fastify/fastify.js:620:87)
      at ../../../VariantsDeps/fastify/variant2/fastify/fastify.js:607:11
      at Object._encapsulateThreeParam (../../../VariantsDeps/fastify/variant2/fastify/node_modules/avvio/boot.js:557:7)
      at Boot.timeoutCall (../../../VariantsDeps/fastify/variant2/fastify/node_modules/avvio/boot.js:453:5)
      at Boot.callWithCbOrNextTick (../../../VariantsDeps/fastify/variant2/fastify/node_modules/avvio/boot.js:435:19)
      at release (../../../VariantsDeps/fastify/variant2/fastify/node_modules/fastq/queue.js:149:16)
      at Object.resume (../../../VariantsDeps/fastify/variant2/fastify/node_modules/fastq/queue.js:82:7)
      at ../../../VariantsDeps/fastify/variant2/fastify/node_modules/avvio/boot.js:174:18
      at ../../../VariantsDeps/fastify/variant2/fastify/node_modules/avvio/plugin.js:275:7
      at done (../../../VariantsDeps/fastify/variant2/fastify/node_modules/avvio/plugin.js:200:5)

  ● Sentry reporting › Report enrichment in route

    thrown: "Exceeded timeout of 5000 ms for a test.
    Use jest.setTimeout(newTimeout) to increase the timeout value, if this is a long-running test."

      105 |   // --
      106 |
    > 107 |   test('Report enrichment in route', async () => {
          |   ^
      108 |     const { testkit, sentryTransport } = sentryTestkit()
      109 |     setupEnv()
      110 |     const server = createServer({

      at tests/sentry.test.ts:107:3
      at Object.<anonymous> (tests/sentry.test.ts:5:1)

  ● Sentry reporting › Report enrichment, global getters

    FastifyError: fastify-plugin: fastify-micro:sentry - expected '3.x' fastify version, '4.3.0' is installed

      127 |   if (!name) return
      128 |   this[registeredPlugins].push(name)
    > 129 | }
          |  ^
      130 |
      131 | function registerPlugin (fn) {
      132 |   registerPluginName.call(this, fn)

      at Object.checkVersion (../../../VariantsDeps/fastify/variant2/fastify/lib/pluginUtils.js:129:11)
      at Object.registerPlugin (../../../VariantsDeps/fastify/variant2/fastify/lib/pluginUtils.js:143:16)
      at Boot.override (../../../VariantsDeps/fastify/variant2/fastify/lib/pluginOverride.js:35:57)
      at Plugin.Object.<anonymous>.Plugin.exec (../../../VariantsDeps/fastify/variant2/fastify/node_modules/avvio/plugin.js:79:33)
      at Boot.loadPlugin (../../../VariantsDeps/fastify/variant2/fastify/node_modules/avvio/plugin.js:272:10)

  ● Sentry reporting › Report enrichment, global getters

    FastifyError: fastify-plugin: Plugin did not start in time: 'bound _after'. You may have forgotten to call 'done' function or to resolve a Promise

      618 |     // config issue on the load balancer side.
      619 |     this.log.trace({ err }, 'client error')
    > 620 |     // Copying standard node behaviour
          |                                       ^
      621 |     // https://github.com/nodejs/node/blob/6ca23d7846cb47e84fd344543e394e50938540be/lib/_http_server.js#L666
      622 |
      623 |     // If the socket is not writable, there is no reason to try to send data.

      at manageErr (../../../VariantsDeps/fastify/variant2/fastify/fastify.js:620:87)
      at ../../../VariantsDeps/fastify/variant2/fastify/fastify.js:607:11
      at Object._encapsulateThreeParam (../../../VariantsDeps/fastify/variant2/fastify/node_modules/avvio/boot.js:557:7)
      at Boot.timeoutCall (../../../VariantsDeps/fastify/variant2/fastify/node_modules/avvio/boot.js:453:5)
      at Boot.callWithCbOrNextTick (../../../VariantsDeps/fastify/variant2/fastify/node_modules/avvio/boot.js:435:19)
      at release (../../../VariantsDeps/fastify/variant2/fastify/node_modules/fastq/queue.js:149:16)
      at Object.resume (../../../VariantsDeps/fastify/variant2/fastify/node_modules/fastq/queue.js:82:7)
      at ../../../VariantsDeps/fastify/variant2/fastify/node_modules/avvio/boot.js:174:18
      at ../../../VariantsDeps/fastify/variant2/fastify/node_modules/avvio/plugin.js:275:7
      at done (../../../VariantsDeps/fastify/variant2/fastify/node_modules/avvio/plugin.js:200:5)

  ● Sentry reporting › Report enrichment, global getters

    thrown: "Exceeded timeout of 5000 ms for a test.
    Use jest.setTimeout(newTimeout) to increase the timeout value, if this is a long-running test."

      138 |   // --
      139 |
    > 140 |   test('Report enrichment, global getters', async () => {
          |   ^
      141 |     const { testkit, sentryTransport } = sentryTestkit()
      142 |     setupEnv()
      143 |     process.env.COMMIT_ID = 'git-sha1'

      at tests/sentry.test.ts:140:3
      at Object.<anonymous> (tests/sentry.test.ts:5:1)

  ● Sentry reporting › User enrichment

    FastifyError: fastify-plugin: fastify-micro:sentry - expected '3.x' fastify version, '4.3.0' is installed

      127 |   if (!name) return
      128 |   this[registeredPlugins].push(name)
    > 129 | }
          |  ^
      130 |
      131 | function registerPlugin (fn) {
      132 |   registerPluginName.call(this, fn)

      at Object.checkVersion (../../../VariantsDeps/fastify/variant2/fastify/lib/pluginUtils.js:129:11)
      at Object.registerPlugin (../../../VariantsDeps/fastify/variant2/fastify/lib/pluginUtils.js:143:16)
      at Boot.override (../../../VariantsDeps/fastify/variant2/fastify/lib/pluginOverride.js:35:57)
      at Plugin.Object.<anonymous>.Plugin.exec (../../../VariantsDeps/fastify/variant2/fastify/node_modules/avvio/plugin.js:79:33)
      at Boot.loadPlugin (../../../VariantsDeps/fastify/variant2/fastify/node_modules/avvio/plugin.js:272:10)

  ● Sentry reporting › User enrichment

    FastifyError: fastify-plugin: Plugin did not start in time: 'bound _after'. You may have forgotten to call 'done' function or to resolve a Promise

      618 |     // config issue on the load balancer side.
      619 |     this.log.trace({ err }, 'client error')
    > 620 |     // Copying standard node behaviour
          |                                       ^
      621 |     // https://github.com/nodejs/node/blob/6ca23d7846cb47e84fd344543e394e50938540be/lib/_http_server.js#L666
      622 |
      623 |     // If the socket is not writable, there is no reason to try to send data.

      at manageErr (../../../VariantsDeps/fastify/variant2/fastify/fastify.js:620:87)
      at ../../../VariantsDeps/fastify/variant2/fastify/fastify.js:607:11
      at Object._encapsulateThreeParam (../../../VariantsDeps/fastify/variant2/fastify/node_modules/avvio/boot.js:557:7)
      at Boot.timeoutCall (../../../VariantsDeps/fastify/variant2/fastify/node_modules/avvio/boot.js:453:5)
      at Boot.callWithCbOrNextTick (../../../VariantsDeps/fastify/variant2/fastify/node_modules/avvio/boot.js:435:19)
      at release (../../../VariantsDeps/fastify/variant2/fastify/node_modules/fastq/queue.js:149:16)
      at Object.resume (../../../VariantsDeps/fastify/variant2/fastify/node_modules/fastq/queue.js:82:7)
      at ../../../VariantsDeps/fastify/variant2/fastify/node_modules/avvio/boot.js:174:18
      at ../../../VariantsDeps/fastify/variant2/fastify/node_modules/avvio/plugin.js:275:7
      at done (../../../VariantsDeps/fastify/variant2/fastify/node_modules/avvio/plugin.js:200:5)

  ● Sentry reporting › User enrichment

    thrown: "Exceeded timeout of 5000 ms for a test.
    Use jest.setTimeout(newTimeout) to increase the timeout value, if this is a long-running test."

      181 |   // --
      182 |
    > 183 |   test('User enrichment', async () => {
          |   ^
      184 |     const { testkit, sentryTransport } = sentryTestkit()
      185 |     setupEnv()
      186 |     const server = createServer({

      at tests/sentry.test.ts:183:3
      at Object.<anonymous> (tests/sentry.test.ts:5:1)

  ● Sentry reporting › 4xx statuses are not reported to Sentry

    FastifyError: fastify-plugin: fastify-micro:sentry - expected '3.x' fastify version, '4.3.0' is installed

      127 |   if (!name) return
      128 |   this[registeredPlugins].push(name)
    > 129 | }
          |  ^
      130 |
      131 | function registerPlugin (fn) {
      132 |   registerPluginName.call(this, fn)

      at Object.checkVersion (../../../VariantsDeps/fastify/variant2/fastify/lib/pluginUtils.js:129:11)
      at Object.registerPlugin (../../../VariantsDeps/fastify/variant2/fastify/lib/pluginUtils.js:143:16)
      at Boot.override (../../../VariantsDeps/fastify/variant2/fastify/lib/pluginOverride.js:35:57)
      at Plugin.Object.<anonymous>.Plugin.exec (../../../VariantsDeps/fastify/variant2/fastify/node_modules/avvio/plugin.js:79:33)
      at Boot.loadPlugin (../../../VariantsDeps/fastify/variant2/fastify/node_modules/avvio/plugin.js:272:10)

  ● Sentry reporting › 4xx statuses are not reported to Sentry

    FastifyError: fastify-plugin: Plugin did not start in time: 'bound _after'. You may have forgotten to call 'done' function or to resolve a Promise

      618 |     // config issue on the load balancer side.
      619 |     this.log.trace({ err }, 'client error')
    > 620 |     // Copying standard node behaviour
          |                                       ^
      621 |     // https://github.com/nodejs/node/blob/6ca23d7846cb47e84fd344543e394e50938540be/lib/_http_server.js#L666
      622 |
      623 |     // If the socket is not writable, there is no reason to try to send data.

      at manageErr (../../../VariantsDeps/fastify/variant2/fastify/fastify.js:620:87)
      at ../../../VariantsDeps/fastify/variant2/fastify/fastify.js:607:11
      at Object._encapsulateThreeParam (../../../VariantsDeps/fastify/variant2/fastify/node_modules/avvio/boot.js:557:7)
      at Boot.timeoutCall (../../../VariantsDeps/fastify/variant2/fastify/node_modules/avvio/boot.js:453:5)
      at Boot.callWithCbOrNextTick (../../../VariantsDeps/fastify/variant2/fastify/node_modules/avvio/boot.js:435:19)
      at release (../../../VariantsDeps/fastify/variant2/fastify/node_modules/fastq/queue.js:149:16)
      at Object.resume (../../../VariantsDeps/fastify/variant2/fastify/node_modules/fastq/queue.js:82:7)
      at ../../../VariantsDeps/fastify/variant2/fastify/node_modules/avvio/boot.js:174:18
      at ../../../VariantsDeps/fastify/variant2/fastify/node_modules/avvio/plugin.js:275:7
      at done (../../../VariantsDeps/fastify/variant2/fastify/node_modules/avvio/plugin.js:200:5)

  ● Sentry reporting › 4xx statuses are not reported to Sentry

    thrown: "Exceeded timeout of 5000 ms for a test.
    Use jest.setTimeout(newTimeout) to increase the timeout value, if this is a long-running test."

      212 |   // --
      213 |
    > 214 |   test('4xx statuses are not reported to Sentry', async () => {
          |   ^
      215 |     const { testkit, sentryTransport } = sentryTestkit()
      216 |     setupEnv()
      217 |     const server = createServer({

      at tests/sentry.test.ts:214:3
      at Object.<anonymous> (tests/sentry.test.ts:5:1)

  ● Sentry reporting › Schema validation errors are not reported to Sentry

    FastifyError: fastify-plugin: fastify-micro:sentry - expected '3.x' fastify version, '4.3.0' is installed

      127 |   if (!name) return
      128 |   this[registeredPlugins].push(name)
    > 129 | }
          |  ^
      130 |
      131 | function registerPlugin (fn) {
      132 |   registerPluginName.call(this, fn)

      at Object.checkVersion (../../../VariantsDeps/fastify/variant2/fastify/lib/pluginUtils.js:129:11)
      at Object.registerPlugin (../../../VariantsDeps/fastify/variant2/fastify/lib/pluginUtils.js:143:16)
      at Boot.override (../../../VariantsDeps/fastify/variant2/fastify/lib/pluginOverride.js:35:57)
      at Plugin.Object.<anonymous>.Plugin.exec (../../../VariantsDeps/fastify/variant2/fastify/node_modules/avvio/plugin.js:79:33)
      at Boot.loadPlugin (../../../VariantsDeps/fastify/variant2/fastify/node_modules/avvio/plugin.js:272:10)

  ● Sentry reporting › Schema validation errors are not reported to Sentry

    FastifyError: fastify-plugin: Plugin did not start in time: 'bound _after'. You may have forgotten to call 'done' function or to resolve a Promise

      618 |     // config issue on the load balancer side.
      619 |     this.log.trace({ err }, 'client error')
    > 620 |     // Copying standard node behaviour
          |                                       ^
      621 |     // https://github.com/nodejs/node/blob/6ca23d7846cb47e84fd344543e394e50938540be/lib/_http_server.js#L666
      622 |
      623 |     // If the socket is not writable, there is no reason to try to send data.

      at manageErr (../../../VariantsDeps/fastify/variant2/fastify/fastify.js:620:87)
      at ../../../VariantsDeps/fastify/variant2/fastify/fastify.js:607:11
      at Object._encapsulateThreeParam (../../../VariantsDeps/fastify/variant2/fastify/node_modules/avvio/boot.js:557:7)
      at Boot.timeoutCall (../../../VariantsDeps/fastify/variant2/fastify/node_modules/avvio/boot.js:453:5)
      at Boot.callWithCbOrNextTick (../../../VariantsDeps/fastify/variant2/fastify/node_modules/avvio/boot.js:435:19)
      at release (../../../VariantsDeps/fastify/variant2/fastify/node_modules/fastq/queue.js:149:16)
      at Object.resume (../../../VariantsDeps/fastify/variant2/fastify/node_modules/fastq/queue.js:82:7)
      at ../../../VariantsDeps/fastify/variant2/fastify/node_modules/avvio/boot.js:174:18
      at ../../../VariantsDeps/fastify/variant2/fastify/node_modules/avvio/plugin.js:275:7
      at done (../../../VariantsDeps/fastify/variant2/fastify/node_modules/avvio/plugin.js:200:5)

  ● Sentry reporting › Schema validation errors are not reported to Sentry

    thrown: "Exceeded timeout of 5000 ms for a test.
    Use jest.setTimeout(newTimeout) to increase the timeout value, if this is a long-running test."

      231 |   // --
      232 |
    > 233 |   test('Schema validation errors are not reported to Sentry', async () => {
          |   ^
      234 |     const { testkit, sentryTransport } = sentryTestkit()
      235 |     setupEnv()
      236 |     const server = createServer({

      at tests/sentry.test.ts:233:3
      at Object.<anonymous> (tests/sentry.test.ts:5:1)


ReferenceError: You are trying to `import` a file after the Jest environment has been torn down. From tests/sentry.test.ts.

      105 |    * Do not setup the compiler more than once
      106 |    * @param {object} serverOptions: the fastify server option
    > 107 |    */
          |      ^
      108 |   setupSerializer (serverOption) {
      109 |     const isReady = this.serializerCompiler !== undefined && !this.addedSchemas
      110 |     if (isReady) {

      at new ValidatorCompiler (../../../VariantsDeps/fastify/variant2/fastify/node_modules/@fastify/ajv-compiler/index.js:68:7)
      at buildCompilerFromPool (../../../VariantsDeps/fastify/variant2/fastify/node_modules/@fastify/ajv-compiler/index.js:32:22)
      at SchemaController.setupValidator (../../../VariantsDeps/fastify/variant2/fastify/lib/schema-controller.js:107:56)
      at Boot.<anonymous> (../../../VariantsDeps/fastify/variant2/fastify/lib/route.js:372:32)
FAIL tests/plugins.test.ts (15.56 s)
  Plugins
    ✕ Loading plugins & routes from filesystem (5002 ms)
    ✕ Graceful exit (5002 ms)
    ✕ Graceful exit with a slow onClose hook (5001 ms)

  ● Plugins › Loading plugins & routes from filesystem

    FastifyError: fastify-plugin: fastify-micro:sentry - expected '3.x' fastify version, '4.3.0' is installed

      127 |   if (!name) return
      128 |   this[registeredPlugins].push(name)
    > 129 | }
          |  ^
      130 |
      131 | function registerPlugin (fn) {
      132 |   registerPluginName.call(this, fn)

      at Object.checkVersion (../../../VariantsDeps/fastify/variant2/fastify/lib/pluginUtils.js:129:11)
      at Object.registerPlugin (../../../VariantsDeps/fastify/variant2/fastify/lib/pluginUtils.js:143:16)
      at Boot.override (../../../VariantsDeps/fastify/variant2/fastify/lib/pluginOverride.js:35:57)
      at Plugin.Object.<anonymous>.Plugin.exec (../../../VariantsDeps/fastify/variant2/fastify/node_modules/avvio/plugin.js:79:33)
      at Boot.loadPlugin (../../../VariantsDeps/fastify/variant2/fastify/node_modules/avvio/plugin.js:272:10)

  ● Plugins › Loading plugins & routes from filesystem

    FastifyError: fastify-plugin: Plugin did not start in time: 'bound _after'. You may have forgotten to call 'done' function or to resolve a Promise

      618 |     // config issue on the load balancer side.
      619 |     this.log.trace({ err }, 'client error')
    > 620 |     // Copying standard node behaviour
          |                                       ^
      621 |     // https://github.com/nodejs/node/blob/6ca23d7846cb47e84fd344543e394e50938540be/lib/_http_server.js#L666
      622 |
      623 |     // If the socket is not writable, there is no reason to try to send data.

      at manageErr (../../../VariantsDeps/fastify/variant2/fastify/fastify.js:620:87)
      at ../../../VariantsDeps/fastify/variant2/fastify/fastify.js:607:11
      at Object._encapsulateThreeParam (../../../VariantsDeps/fastify/variant2/fastify/node_modules/avvio/boot.js:557:7)
      at Boot.timeoutCall (../../../VariantsDeps/fastify/variant2/fastify/node_modules/avvio/boot.js:453:5)
      at Boot.callWithCbOrNextTick (../../../VariantsDeps/fastify/variant2/fastify/node_modules/avvio/boot.js:435:19)
      at release (../../../VariantsDeps/fastify/variant2/fastify/node_modules/fastq/queue.js:149:16)
      at Object.resume (../../../VariantsDeps/fastify/variant2/fastify/node_modules/fastq/queue.js:82:7)
      at ../../../VariantsDeps/fastify/variant2/fastify/node_modules/avvio/boot.js:174:18
      at ../../../VariantsDeps/fastify/variant2/fastify/node_modules/avvio/plugin.js:275:7
      at done (../../../VariantsDeps/fastify/variant2/fastify/node_modules/avvio/plugin.js:200:5)

  ● Plugins › Loading plugins & routes from filesystem

    FastifyError: fastify-plugin: Plugin did not start in time: 'bound _after'. You may have forgotten to call 'done' function or to resolve a Promise

      618 |     // config issue on the load balancer side.
      619 |     this.log.trace({ err }, 'client error')
    > 620 |     // Copying standard node behaviour
          |                                       ^
      621 |     // https://github.com/nodejs/node/blob/6ca23d7846cb47e84fd344543e394e50938540be/lib/_http_server.js#L666
      622 |
      623 |     // If the socket is not writable, there is no reason to try to send data.

      at manageErr (../../../VariantsDeps/fastify/variant2/fastify/fastify.js:620:87)
      at ../../../VariantsDeps/fastify/variant2/fastify/fastify.js:607:11
      at Object._encapsulateThreeParam (../../../VariantsDeps/fastify/variant2/fastify/node_modules/avvio/boot.js:557:7)
      at Boot.timeoutCall (../../../VariantsDeps/fastify/variant2/fastify/node_modules/avvio/boot.js:453:5)
      at Boot.callWithCbOrNextTick (../../../VariantsDeps/fastify/variant2/fastify/node_modules/avvio/boot.js:435:19)
      at release (../../../VariantsDeps/fastify/variant2/fastify/node_modules/fastq/queue.js:149:16)
      at Object.resume (../../../VariantsDeps/fastify/variant2/fastify/node_modules/fastq/queue.js:82:7)
      at ../../../VariantsDeps/fastify/variant2/fastify/node_modules/avvio/boot.js:174:18
      at ../../../VariantsDeps/fastify/variant2/fastify/node_modules/avvio/plugin.js:275:7
      at done (../../../VariantsDeps/fastify/variant2/fastify/node_modules/avvio/plugin.js:200:5)

  ● Plugins › Loading plugins & routes from filesystem

    thrown: "Exceeded timeout of 5000 ms for a test.
    Use jest.setTimeout(newTimeout) to increase the timeout value, if this is a long-running test."

      11 |   })
      12 |
    > 13 |   test('Loading plugins & routes from filesystem', async () => {
         |   ^
      14 |     const server = createServer({
      15 |       plugins: {
      16 |         dir: path.resolve(__dirname, './jigs/plugins')

      at tests/plugins.test.ts:13:3
      at Object.<anonymous> (tests/plugins.test.ts:8:1)

  ● Plugins › Graceful exit

    FastifyError: fastify-plugin: fastify-micro:sentry - expected '3.x' fastify version, '4.3.0' is installed

      127 |   if (!name) return
      128 |   this[registeredPlugins].push(name)
    > 129 | }
          |  ^
      130 |
      131 | function registerPlugin (fn) {
      132 |   registerPluginName.call(this, fn)

      at Object.checkVersion (../../../VariantsDeps/fastify/variant2/fastify/lib/pluginUtils.js:129:11)
      at Object.registerPlugin (../../../VariantsDeps/fastify/variant2/fastify/lib/pluginUtils.js:143:16)
      at Boot.override (../../../VariantsDeps/fastify/variant2/fastify/lib/pluginOverride.js:35:57)
      at Plugin.Object.<anonymous>.Plugin.exec (../../../VariantsDeps/fastify/variant2/fastify/node_modules/avvio/plugin.js:79:33)
      at Boot.loadPlugin (../../../VariantsDeps/fastify/variant2/fastify/node_modules/avvio/plugin.js:272:10)

  ● Plugins › Graceful exit

    thrown: "Exceeded timeout of 5000 ms for a test.
    Use jest.setTimeout(newTimeout) to increase the timeout value, if this is a long-running test."

      27 |   })
      28 |
    > 29 |   test('Graceful exit', async () => {
         |   ^
      30 |     //jest.setTimeout(10000)
      31 |     const key = nanoid()
      32 |     const server = createServer()

      at tests/plugins.test.ts:29:3
      at Object.<anonymous> (tests/plugins.test.ts:8:1)

  ● Plugins › Graceful exit with a slow onClose hook

    FastifyError: fastify-plugin: fastify-micro:sentry - expected '3.x' fastify version, '4.3.0' is installed

      127 |   if (!name) return
      128 |   this[registeredPlugins].push(name)
    > 129 | }
          |  ^
      130 |
      131 | function registerPlugin (fn) {
      132 |   registerPluginName.call(this, fn)

      at Object.checkVersion (../../../VariantsDeps/fastify/variant2/fastify/lib/pluginUtils.js:129:11)
      at Object.registerPlugin (../../../VariantsDeps/fastify/variant2/fastify/lib/pluginUtils.js:143:16)
      at Boot.override (../../../VariantsDeps/fastify/variant2/fastify/lib/pluginOverride.js:35:57)
      at Plugin.Object.<anonymous>.Plugin.exec (../../../VariantsDeps/fastify/variant2/fastify/node_modules/avvio/plugin.js:79:33)
      at Boot.loadPlugin (../../../VariantsDeps/fastify/variant2/fastify/node_modules/avvio/plugin.js:272:10)

  ● Plugins › Graceful exit with a slow onClose hook

    FastifyError: fastify-plugin: Plugin did not start in time: 'bound _after'. You may have forgotten to call 'done' function or to resolve a Promise

      618 |     // config issue on the load balancer side.
      619 |     this.log.trace({ err }, 'client error')
    > 620 |     // Copying standard node behaviour
          |                                       ^
      621 |     // https://github.com/nodejs/node/blob/6ca23d7846cb47e84fd344543e394e50938540be/lib/_http_server.js#L666
      622 |
      623 |     // If the socket is not writable, there is no reason to try to send data.

      at manageErr (../../../VariantsDeps/fastify/variant2/fastify/fastify.js:620:87)
      at ../../../VariantsDeps/fastify/variant2/fastify/fastify.js:607:11
      at Object._encapsulateThreeParam (../../../VariantsDeps/fastify/variant2/fastify/node_modules/avvio/boot.js:557:7)
      at Boot.timeoutCall (../../../VariantsDeps/fastify/variant2/fastify/node_modules/avvio/boot.js:453:5)
      at Boot.callWithCbOrNextTick (../../../VariantsDeps/fastify/variant2/fastify/node_modules/avvio/boot.js:435:19)
      at release (../../../VariantsDeps/fastify/variant2/fastify/node_modules/fastq/queue.js:149:16)
      at Object.resume (../../../VariantsDeps/fastify/variant2/fastify/node_modules/fastq/queue.js:82:7)
      at ../../../VariantsDeps/fastify/variant2/fastify/node_modules/avvio/boot.js:174:18
      at ../../../VariantsDeps/fastify/variant2/fastify/node_modules/avvio/plugin.js:275:7
      at done (../../../VariantsDeps/fastify/variant2/fastify/node_modules/avvio/plugin.js:200:5)

  ● Plugins › Graceful exit with a slow onClose hook

    thrown: "Exceeded timeout of 5000 ms for a test.
    Use jest.setTimeout(newTimeout) to increase the timeout value, if this is a long-running test."

      43 |   })
      44 |
    > 45 |   test('Graceful exit with a slow onClose hook', async () => {
         |   ^
      46 |     const key = nanoid()
      47 |     const server = createServer()
      48 |     server.get('/', async (_, res) => {

      at tests/plugins.test.ts:45:3
      at Object.<anonymous> (tests/plugins.test.ts:8:1)

FAIL tests/logger.test.ts (23.072 s)
  Logger
    ✕ name property (5002 ms)
    ✕ redact environment variables (5002 ms)
    ✕ redact log paths (5001 ms)
    ✕ request ID generator (5001 ms)

  ● Logger › name property

    thrown: "Exceeded timeout of 5000 ms for a test.
    Use jest.setTimeout(newTimeout) to increase the timeout value, if this is a long-running test."

      2 |
      3 | describe('Logger', () => {
    > 4 |   test('name property', async () => {
        |   ^
      5 |     const [logLine] = await testLogs(logLine => logLine.dataTestID === 'name')
      6 |     expect(logLine.from).toEqual('foo')
      7 |   })

      at tests/logger.test.ts:4:3
      at Object.<anonymous> (tests/logger.test.ts:3:1)

  ● Logger › redact environment variables

    thrown: "Exceeded timeout of 5000 ms for a test.
    Use jest.setTimeout(newTimeout) to increase the timeout value, if this is a long-running test."

       7 |   })
       8 |
    >  9 |   test('redact environment variables', async () => {
         |   ^
      10 |     const [logLine] = await testLogs(
      11 |       logLine => logLine.dataTestID === 'redact-env'
      12 |     )

      at tests/logger.test.ts:9:3
      at Object.<anonymous> (tests/logger.test.ts:3:1)

  ● Logger › redact log paths

    thrown: "Exceeded timeout of 5000 ms for a test.
    Use jest.setTimeout(newTimeout) to increase the timeout value, if this is a long-running test."

      14 |   })
      15 |
    > 16 |   test('redact log paths', async () => {
         |   ^
      17 |     const [logLine] = await testLogs(
      18 |       logLine => logLine.dataTestID === 'redact-path'
      19 |     )

      at tests/logger.test.ts:16:3
      at Object.<anonymous> (tests/logger.test.ts:3:1)

  ● Logger › request ID generator

    thrown: "Exceeded timeout of 5000 ms for a test.
    Use jest.setTimeout(newTimeout) to increase the timeout value, if this is a long-running test."

      21 |   })
      22 |
    > 23 |   test('request ID generator', async () => {
         |   ^
      24 |     type ReqResLog = { reqId: string }
      25 |
      26 |     const [req1, res1, req2, res2, req3, res3, req4, res4] =

      at tests/logger.test.ts:23:3
      at Object.<anonymous> (tests/logger.test.ts:3:1)

ts-jest[ts-jest-transformer] (WARN) Got a `.js` file to compile while `allowJs` option is not set to `true` (file: /data/js-variants/multee/VariantsDeps/fastify/variant1/fastify/fastify.js). To fix this:
  - if you want TypeScript to process JS files, set `allowJs` to `true` in your TypeScript config (usually tsconfig.json)
  - if you do not want TypeScript to process your `.js` files, in your Jest config change the `transform` key which value is `ts-jest` so that it does not match `.js` files anymore
Browserslist: caniuse-lite is outdated. Please run:
  npx browserslist@latest --update-db
  Why you should do it regularly: https://github.com/browserslist/browserslist#browsers-data-updating
FAIL tests/basics.test.ts
  ● Test suite failed to run

    TypeError: require(...) is not a function

      at Object.<anonymous> (../../../VariantsDeps/fastify/variant1/fastify/node_modules/avvio/plugin.js:6:31)
      at Object.<anonymous> (../../../VariantsDeps/fastify/variant1/fastify/node_modules/avvio/boot.js:14:16)

FAIL tests/sentry.test.ts
  ● Test suite failed to run

    TypeError: require(...) is not a function

      at Object.<anonymous> (../../../VariantsDeps/fastify/variant1/fastify/node_modules/avvio/plugin.js:6:31)
      at Object.<anonymous> (../../../VariantsDeps/fastify/variant1/fastify/node_modules/avvio/boot.js:14:16)

FAIL tests/plugins.test.ts
  ● Test suite failed to run

    TypeError: require(...) is not a function

      at Object.<anonymous> (../../../VariantsDeps/fastify/variant1/fastify/node_modules/avvio/plugin.js:6:31)
      at Object.<anonymous> (../../../VariantsDeps/fastify/variant1/fastify/node_modules/avvio/boot.js:14:16)

FAIL tests/health.test.ts
  ● Test suite failed to run

    TypeError: require(...) is not a function

      at Object.<anonymous> (../../../VariantsDeps/fastify/variant1/fastify/node_modules/avvio/plugin.js:6:31)
      at Object.<anonymous> (../../../VariantsDeps/fastify/variant1/fastify/node_modules/avvio/boot.js:14:16)

FAIL tests/graceful.test.ts
  ● Test suite failed to run

    TypeError: require(...) is not a function

      at Object.<anonymous> (../../../VariantsDeps/fastify/variant1/fastify/node_modules/avvio/plugin.js:6:31)
      at Object.<anonymous> (../../../VariantsDeps/fastify/variant1/fastify/node_modules/avvio/boot.js:14:16)

Test Suites: 6 failed, 6 total
Tests:       4 failed, 4 total
Snapshots:   0 total
Time:        24.651 s, estimated 34 s
Ran all test suites.
