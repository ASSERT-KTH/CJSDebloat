11
routing-controllers is testing ./VariantsDeps/express/variant11/express
/data/js-variants/multee
************* npm unlink module *************
************* npm unlink module done *************
************* npm unlink globally *************
************* npm unlink module done *************
************* npm link globally *************
************* npm link globally done *************
************* npm link module *************
************* npm link module done *************
************* start run test *************
ts-jest[config] (WARN) The option `tsConfig` is deprecated and will be removed in ts-jest 27, use `tsconfig` instead
PASS test/functional/action-params.spec.ts (6.577 s)
    ✓ @Req and @Res should be provided as Request and Response objects (29 ms)
    ✓ @Res writing directly to the response should work (7 ms)
    ✓ @Param should give a param from route (5 ms)
    ✓ @Param multiple params should give a proper values from route (3 ms)
    ✓ @SessionParam without middleware (36 ms)
    ✓ @Session should return a value from session (11 ms)
    ✓ @Session(param) should allow to inject empty property (4 ms)
    ✓ @QueryParams should give a proper values from request's query parameters (13 ms)
    ✓ @QueryParams should give a proper values from request's query parameters and one multiple value (7 ms)
    ✓ @QueryParams should give a proper values from request's query with validate whitelist option on (3 ms)
    ✓ @QueryParams should give a proper values from request's query parameters with nested json (5 ms)
    ✓ @QueryParams should not validate request query parameters when it's turned off in validator options (3 ms)
    ✓ @QueryParams should give a proper values from request's optional query parameters (3 ms)
    ✓ @QueryParam should give a proper values from request query parameters (2 ms)
    ✓ @QueryParam should give an array of string with only one query parameter (3 ms)
    ✓ @QueryParam should give an array of string with multiple query parameters (2 ms)
    ✓ @QueryParam should give an array of number with only one query parameter (2 ms)
    ✓ @QueryParam should give an array of number with multiple query parameters (2 ms)
    ✓ @QueryParam should give an array of date with only one query parameter (2 ms)
    ✓ @QueryParam should give an array of date with multiple query parameters (2 ms)
    ✓ @QueryParam when required params must be provided and they should not be empty (8 ms)
    ✓ @QueryParam when the type is Date then it should be parsed (2 ms)
    ✓ @QueryParam when the type is Date and it is invalid then the response should be a BadRequest error (3 ms)
    ✓ @QueryParam when parseJson flag is used query param must be converted to object (2 ms)
    ✓ @HeaderParam should give a proper values from request headers (6 ms)
    ✓ @HeaderParam when required is params must be provided and they should not be empty (2 ms)
    ✓ @HeaderParam should fail with invalid request options (2 ms)
    ✓ @HeaderParam should fail with missing required params (2 ms)
    ✓ for @HeaderParam when parseJson flag is used query param must be converted to object (2 ms)
    ✓ @CookieParam should give a proper values from request headers (2 ms)
    ✓ @CookieParam when required is params must be provided and they should not be empty (3 ms)
    ✓ @CookieParam when parseJson flag is used query param must be converted to object (2 ms)
    ✓ @Body should provide a request body (36 ms)
    ✓ @Body should fail if required body was not provided (7 ms)
    ✓ @Body should provide a json object for json-typed controllers and actions (3 ms)
    ✓ @Body should fail if required body was not provided for json-typed controllers and actions (4 ms)
    ✓ @BodyParam should provide a json object for json-typed controllers and actions (2 ms)
    ✓ @BodyParam should fail if required body was not provided for json-typed controllers and actions (18 ms)
    ✓ @Body using application/x-www-form-urlencoded should handle url encoded form data (4 ms)
    ✓ @UploadedFile using multipart/form-data should provide uploaded file with the given name (12 ms)
    ✓ @UploadedFile with @Body should return both the file and the body (6 ms)
    ✓ @UploadedFile with @BodyParam should return both the file and the body param (5 ms)
    ✓ @UploadedFile with passed uploading options (limit) should throw an error (5 ms)
    ✓ @UploadedFile when required is used files must be provided (6 ms)
    ✓ @UploadedFiles should provide uploaded files with the given name (4 ms)
    ✓ @UploadedFiles with passed uploading options (limit) should throw an error (11 ms)
    ✓ @UploadedFiles when required is used files must be provided (4 ms)

PASS test/functional/controller-methods.spec.ts
    controller methods
      ✓ get should respond with proper status code, headers and body content (21 ms)
      ✓ post respond with proper status code, headers and body content (3 ms)
      ✓ put respond with proper status code, headers and body content (2 ms)
      ✓ patch respond with proper status code, headers and body content (3 ms)
      ✓ delete respond with proper status code, headers and body content (2 ms)
      ✓ head respond with proper status code, headers and body content (2 ms)
      ✓ custom method (post) respond with proper status code, headers and body content (2 ms)
      ✓ custom method (delete) respond with proper status code, headers and body content (2 ms)
      ✓ route should work with parameter (3 ms)
      ✓ route should work with regexp parameter (3 ms)
      ✓ should respond with 404 when regexp does not match (4 ms)
      ✓ route should work with string regexp parameter (3 ms)
      ✓ should respond with 404 when regexp does not match (1 ms)
      ✓ should return result from a promise (503 ms)
      ✓ should respond with 500 if promise failed (504 ms)
      ✓ should respond with 204 No Content when null returned in action (4 ms)
      ✓ should respond with 404 Not Found text when undefined returned in action (21 ms)
      ✓ should respond with 404 Not Found JSON when undefined returned in action (14 ms)
      ✓ should respond with 200 and text/html even in json controller's method (2 ms)
      ✓ should respond with 200 and text/plain even in json controller's method (2 ms)
      ✓ should respond with 401 and text/html when UnauthorizedError throwed even in json controller's method (5 ms)
      ✓ should respond with 401 and aplication/json when UnauthorizedError is thrown in standard json controller's method (3 ms)

PASS test/functional/container.spec.ts
    using typedi container should be possible
      ✓ typedi container (71 ms)
    using custom container should be possible
      ✓ custom container (6 ms)
    using custom container with fallback should be possible
      ✓ custom container with fallback (8 ms)
    using custom container with fallback and fallback on throw error should be possible
      ✓ custom container with fallback and fallback on throw error (8 ms)

PASS test/functional/json-controller-methods.spec.ts
    json-controller methods
      ✓ get should respond with proper status code, headers and body content (21 ms)
      ✓ post respond with proper status code, headers and body content (3 ms)
      ✓ put respond with proper status code, headers and body content (2 ms)
      ✓ patch respond with proper status code, headers and body content (3 ms)
      ✓ delete respond with proper status code, headers and body content (3 ms)
      ✓ head respond with proper status code, headers and body content (4 ms)
      ✓ custom method (post) respond with proper status code, headers and body content (2 ms)
      ✓ custom method (delete) respond with proper status code, headers and body content (2 ms)
      ✓ route should work with parameter (2 ms)
      ✓ route should work with regexp parameter (3 ms)
      ✓ should respond with 404 when regexp does not match (4 ms)
      ✓ route should work with string regexp parameter (3 ms)
      ✓ should respond with 404 when regexp does not match (2 ms)
      ✓ should return result from a promise (503 ms)
      ✓ should respond with 500 if promise failed (504 ms)

PASS test/functional/other-controller-decorators.spec.ts
    other controller decorators
      ✓ should return httpCode set by @HttpCode decorator (12 ms)
      ✓ should return custom code when @OnNull (29 ms)
      ✓ should return custom error message and code when @OnUndefined is used with Error class (7 ms)
      ✓ should return custom code when @OnUndefined (12 ms)
      ✓ should return content-type in the response when @ContentType is used (2 ms)
      ✓ should return content-type in the response when @ContentType is used (2 ms)
      ✓ should return response with custom headers when @Header is used (5 ms)
      ✓ should relocate to new location when @Location is used (2 ms)

PASS test/functional/class-validator-options.spec.ts
    no options
      ✓ should not use any options if not set (61 ms)
    global options
      should merge local validation options with global validation options prioritizing local
        ✓ succeed (6 ms)
      should pass the valid param after validation
        ✓ succeed (6 ms)
        ✓ should contain param name on validation failed (16 ms)
    local options
      ✓ should apply local options (6 ms)

PASS test/functional/auth-decorator.spec.ts
    Controller responds with value when Authorization succeeds (async)
      ✓ without roles (99 ms)
      ✓ with roles (17 ms)
      ✓ async (31 ms)
    Controller responds with value when Authorization succeeds (sync)
      ✓ without roles (19 ms)
      ✓ with roles (6 ms)
      ✓ async (22 ms)
    Authorized Decorators Http Status Code
      ✓ without roles (50 ms)
      ✓ with roles (57 ms)
    Authorization checker allows to throw (async)
      ✓ custom errors (16 ms)
    Authorization checker allows to throw (sync)
      ✓ custom errors (13 ms)

PASS test/functional/express-middlewares.spec.ts
    express middlewares
      ✓ should call a global middlewares (10 ms)
      ✓ should use a custom middleware when @UseBefore or @UseAfter is used (3 ms)
      ✓ should call middleware and call it before controller action when @UseBefore is used (2 ms)
      ✓ should call middleware and call it after controller action when @UseAfter is used (3 ms)
      ✓ should call before middleware and call after middleware when @UseAfter and @UseAfter are used (2 ms)
      ✓ should handle errors in custom middlewares (18 ms)

PASS test/functional/express-error-handling.spec.ts
    express error handling
      ✓ should not call global error handler middleware if there was no errors (10 ms)
      ✓ should call global error handler middleware (21 ms)
      ✓ should call global error handler middleware (4 ms)
      ✓ should call error handler middleware if used (3 ms)
      ✓ should not execute next middleware if soft error handled specifically and stopped error bubbling (2 ms)
      ✓ should process JsonErrors by their toJSON method if it exists (3 ms)

PASS test/functional/global-options.spec.ts
    routing-controllers global options
      useClassTransformer default value
        ✓ useClassTransformer by default must be set to true (76 ms)
      when useClassTransformer is set to true
        ✓ useClassTransformer is enabled (4 ms)
      when useClassTransformer is set to false
        ✓ useClassTransformer is disabled (3 ms)
      when routePrefix is used all controller routes should be appended by it
        ✓ routePrefix is enabled (6 ms)

PASS test/unit/controller-inheritance.spec.ts
  controller inheritance
    ✓ should build empty meta for empty set (105 ms)
    ✓ should build meta if the only derivative controller is given (2 ms)
    ✓ should build meta if the only autonomous controller is given (1 ms)
    ✓ should build meta both when autonomous and derivative controllers are given (1 ms)

FAIL test/ActionParameterHandler.spec.ts
  ActionParameterHandler
    positive
      ✓ handle - should process string parameters (11 ms)
      ✓ handle - should process string parameters, returns empty if a given string is empty
      ✓ handle - should process number parameters
      ✓ handle - undefined on empty object provided
      ✓ handle - null provided (11 ms)
    negative
      ✕ handle - throws error if the parameter is required (7 ms)
      ✓ handle - throws error if the parameter is required, type file provided (1 ms)

  ● ActionParameterHandler › negative › handle - throws error if the parameter is required

    Expected value   "TypeError: Cannot read property 'uuid' of undefined"
    Received:
      "TypeError: Cannot read properties of undefined (reading 'uuid')"

    Message:
      expected 'TypeError: Cannot read properties of undefined (reading \'uuid\')' to equal 'TypeError: Cannot read property \'uuid\' of undefined'

    Difference:

    - Expected
    + Received

    - TypeError: Cannot read property 'uuid' of undefined
    + TypeError: Cannot read properties of undefined (reading 'uuid')

      152 |       }
      153 | 
    > 154 |       expect(error.toString()).to.be.eq("TypeError: Cannot read property 'uuid' of undefined");
          |                                      ^
      155 |     });
      156 | 
      157 |     it('handle - throws error if the parameter is required, type file provided', async () => {

      at Object.<anonymous> (test/ActionParameterHandler.spec.ts:154:38)

PASS test/functional/class-transformer-options.spec.ts
    should not use any options if not set
      ✓ technical wrapper (71 ms)
    should apply global options
      ✓ technical wrapper (5 ms)
    should apply local options
      ✓ technical wrapper (4 ms)

PASS test/functional/interceptors.spec.ts
    interceptor
      ✓ custom interceptor function should replace returned content (9 ms)
      ✓ custom interceptor class should replace returned content (3 ms)
      ✓ custom interceptor class used on the whole controller should replace returned content (2 ms)
      ✓ global interceptor class should replace returned content (3 ms)
      ✓ interceptors should support promises (1004 ms)

PASS test/functional/middlewares-order.spec.ts
    loaded direct from array
      ✓ should call middlewares in order defined by items order (9 ms)
    specified by priority option
      ✓ should call middlewares in order defined by priority parameter of decorator (2 ms)

PASS test/functional/load-from-directory.spec.ts
    loading all controllers from the given directories
      ✓ should load all controllers (32 ms)
    loading all express middlewares and error handlers from the given directories
      ✓ should succeed (13 ms)
      ✓ should fail (24 ms)

PASS test/functional/defaults.spec.ts
    defaults
      ✓ should return undefinedResultCode from defaults config for void function (8 ms)
      ✓ should return undefinedResultCode from defaults config for promise void function (2 ms)
      ✓ should return 400 from required paramOptions (16 ms)
      ✓ should return nullResultCode from defaults config (3 ms)
      ✓ should return status code from OnUndefined annotation (2 ms)
      ✓ should mark arg optional from QueryParam annotation (14 ms)

PASS test/functional/controller-base-routes.spec.ts
    controller > base routes functionality
      ✓ get should respond with proper status code, headers and body content (47 ms)
      ✓ get should respond with proper status code, headers and body content (4 ms)
      ✓ get should respond with proper status code, headers and body content - 2nd pass (4 ms)
      ✓ wrong route should respond with 404 error (4 ms)
      ✓ wrong route should respond with 404 error (3 ms)
      ✓ wrong route should respond with 404 error (2 ms)

PASS test/functional/controller-options.spec.ts
    controller options
      ✓ controller transform is enabled by default (19 ms)
      ✓ when controller transform is enabled (4 ms)
      ✓ when controller transform is disabled (4 ms)

PASS test/functional/action-options.spec.ts
    ✓ should use controller options when action transform options are not set (41 ms)
    ✓ should override controller options with action transformRequest option (6 ms)
    ✓ should override controller options with action transformResponse option (4 ms)

PASS test/functional/render-decorator.spec.ts
    template rendering
      ✓ should render a template and use given variables (23 ms)
      ✓ should render a template with given variables and locals variables (4 ms)

PASS test/functional/special-result-send.spec.ts
    special result value treatment
      ✓ should pipe stream to response (9 ms)
      ✓ should send raw binary data from Buffer (5 ms)
      ✓ should send raw binary data from UIntArray (2 ms)

PASS test/functional/express-custom-error-handling.spec.ts
    custom express error handling
      ✓ should not call global error handler middleware if there was no errors (9 ms)
      ✓ should call global error handler middleware (18 ms)

PASS test/functional/express-global-before-error-handling.spec.ts
    custom express global before middleware error handling
      ✓ should call global error handler middleware with CustomError (56 ms)

PASS test/functional/redirect-decorator.spec.ts
    dynamic redirect
      ✓ using template (14 ms)
      ✓ using override (5 ms)
      ✓ using original (4 ms)

PASS test/functional/error-subclasses.spec.ts
  HttpError
    ✓ should be instance of HttpError and Error (3 ms)
  BadRequestError
    ✓ should be instance of BadRequestError, HttpError and Error (1 ms)

Summary of all failing tests
FAIL test/ActionParameterHandler.spec.ts
  ● ActionParameterHandler › negative › handle - throws error if the parameter is required

    Expected value   "TypeError: Cannot read property 'uuid' of undefined"
    Received:
      "TypeError: Cannot read properties of undefined (reading 'uuid')"

    Message:
      expected 'TypeError: Cannot read properties of undefined (reading \'uuid\')' to equal 'TypeError: Cannot read property \'uuid\' of undefined'

    Difference:

    - Expected
    + Received

    - TypeError: Cannot read property 'uuid' of undefined
    + TypeError: Cannot read properties of undefined (reading 'uuid')

      152 |       }
      153 | 
    > 154 |       expect(error.toString()).to.be.eq("TypeError: Cannot read property 'uuid' of undefined");
          |                                      ^
      155 |     });
      156 | 
      157 |     it('handle - throws error if the parameter is required, type file provided', async () => {

      at Object.<anonymous> (test/ActionParameterHandler.spec.ts:154:38)


Test Suites: 1 failed, 25 passed, 26 total
Tests:       1 failed, 181 passed, 182 total
Snapshots:   0 total
Time:        23.65 s
Ran all test suites.
************* run test done *************
routing-controllers is testing ./VariantsDeps/express/variant10/express
/data/js-variants/multee
************* npm unlink module *************
************* npm unlink module done *************
************* npm unlink globally *************
************* npm unlink module done *************
************* npm link globally *************
************* npm link globally done *************
************* npm link module *************
************* npm link module done *************
************* start run test *************
ts-jest[config] (WARN) The option `tsConfig` is deprecated and will be removed in ts-jest 27, use `tsconfig` instead
FAIL test/ActionParameterHandler.spec.ts
  ActionParameterHandler
    positive
      ✓ handle - should process string parameters (31 ms)
      ✓ handle - should process string parameters, returns empty if a given string is empty (1 ms)
      ✓ handle - should process number parameters
      ✓ handle - undefined on empty object provided (1 ms)
      ✓ handle - null provided (13 ms)
    negative
      ✕ handle - throws error if the parameter is required (7 ms)
      ✓ handle - throws error if the parameter is required, type file provided (1 ms)

  ● ActionParameterHandler › negative › handle - throws error if the parameter is required

    Expected value   "TypeError: Cannot read property 'uuid' of undefined"
    Received:
      "TypeError: Cannot read properties of undefined (reading 'uuid')"

    Message:
      expected 'TypeError: Cannot read properties of undefined (reading \'uuid\')' to equal 'TypeError: Cannot read property \'uuid\' of undefined'

    Difference:

    - Expected
    + Received

    - TypeError: Cannot read property 'uuid' of undefined
    + TypeError: Cannot read properties of undefined (reading 'uuid')

      152 |       }
      153 | 
    > 154 |       expect(error.toString()).to.be.eq("TypeError: Cannot read property 'uuid' of undefined");
          |                                      ^
      155 |     });
      156 | 
      157 |     it('handle - throws error if the parameter is required, type file provided', async () => {

      at Object.<anonymous> (test/ActionParameterHandler.spec.ts:154:38)

PASS test/functional/action-params.spec.ts
    ✓ @Req and @Res should be provided as Request and Response objects (22 ms)
    ✓ @Res writing directly to the response should work (5 ms)
    ✓ @Param should give a param from route (4 ms)
    ✓ @Param multiple params should give a proper values from route (3 ms)
    ✓ @SessionParam without middleware (33 ms)
    ✓ @Session should return a value from session (12 ms)
    ✓ @Session(param) should allow to inject empty property (4 ms)
    ✓ @QueryParams should give a proper values from request's query parameters (11 ms)
    ✓ @QueryParams should give a proper values from request's query parameters and one multiple value (6 ms)
    ✓ @QueryParams should give a proper values from request's query with validate whitelist option on (4 ms)
    ✓ @QueryParams should give a proper values from request's query parameters with nested json (4 ms)
    ✓ @QueryParams should not validate request query parameters when it's turned off in validator options (2 ms)
    ✓ @QueryParams should give a proper values from request's optional query parameters (12 ms)
    ✓ @QueryParam should give a proper values from request query parameters (2 ms)
    ✓ @QueryParam should give an array of string with only one query parameter (3 ms)
    ✓ @QueryParam should give an array of string with multiple query parameters (2 ms)
    ✓ @QueryParam should give an array of number with only one query parameter (2 ms)
    ✓ @QueryParam should give an array of number with multiple query parameters (3 ms)
    ✓ @QueryParam should give an array of date with only one query parameter (2 ms)
    ✓ @QueryParam should give an array of date with multiple query parameters (2 ms)
    ✓ @QueryParam when required params must be provided and they should not be empty (8 ms)
    ✓ @QueryParam when the type is Date then it should be parsed (2 ms)
    ✓ @QueryParam when the type is Date and it is invalid then the response should be a BadRequest error (2 ms)
    ✓ @QueryParam when parseJson flag is used query param must be converted to object (2 ms)
    ✓ @HeaderParam should give a proper values from request headers (2 ms)
    ✓ @HeaderParam when required is params must be provided and they should not be empty (2 ms)
    ✓ @HeaderParam should fail with invalid request options (2 ms)
    ✓ @HeaderParam should fail with missing required params (2 ms)
    ✓ for @HeaderParam when parseJson flag is used query param must be converted to object (2 ms)
    ✓ @CookieParam should give a proper values from request headers (2 ms)
    ✓ @CookieParam when required is params must be provided and they should not be empty (4 ms)
    ✓ @CookieParam when parseJson flag is used query param must be converted to object (2 ms)
    ✓ @Body should provide a request body (12 ms)
    ✓ @Body should fail if required body was not provided (6 ms)
    ✓ @Body should provide a json object for json-typed controllers and actions (3 ms)
    ✓ @Body should fail if required body was not provided for json-typed controllers and actions (4 ms)
    ✓ @BodyParam should provide a json object for json-typed controllers and actions (2 ms)
    ✓ @BodyParam should fail if required body was not provided for json-typed controllers and actions (22 ms)
    ✓ @Body using application/x-www-form-urlencoded should handle url encoded form data (4 ms)
    ✓ @UploadedFile using multipart/form-data should provide uploaded file with the given name (12 ms)
    ✓ @UploadedFile with @Body should return both the file and the body (6 ms)
    ✓ @UploadedFile with @BodyParam should return both the file and the body param (5 ms)
    ✓ @UploadedFile with passed uploading options (limit) should throw an error (5 ms)
    ✓ @UploadedFile when required is used files must be provided (6 ms)
    ✓ @UploadedFiles should provide uploaded files with the given name (5 ms)
    ✓ @UploadedFiles with passed uploading options (limit) should throw an error (5 ms)
    ✓ @UploadedFiles when required is used files must be provided (5 ms)

PASS test/functional/controller-methods.spec.ts
    controller methods
      ✓ get should respond with proper status code, headers and body content (10 ms)
      ✓ post respond with proper status code, headers and body content (3 ms)
      ✓ put respond with proper status code, headers and body content (2 ms)
      ✓ patch respond with proper status code, headers and body content (3 ms)
      ✓ delete respond with proper status code, headers and body content (2 ms)
      ✓ head respond with proper status code, headers and body content (2 ms)
      ✓ custom method (post) respond with proper status code, headers and body content (2 ms)
      ✓ custom method (delete) respond with proper status code, headers and body content (2 ms)
      ✓ route should work with parameter (3 ms)
      ✓ route should work with regexp parameter (3 ms)
      ✓ should respond with 404 when regexp does not match (4 ms)
      ✓ route should work with string regexp parameter (3 ms)
      ✓ should respond with 404 when regexp does not match (1 ms)
      ✓ should return result from a promise (504 ms)
      ✓ should respond with 500 if promise failed (516 ms)
      ✓ should respond with 204 No Content when null returned in action (5 ms)
      ✓ should respond with 404 Not Found text when undefined returned in action (21 ms)
      ✓ should respond with 404 Not Found JSON when undefined returned in action (2 ms)
      ✓ should respond with 200 and text/html even in json controller's method (2 ms)
      ✓ should respond with 200 and text/plain even in json controller's method (2 ms)
      ✓ should respond with 401 and text/html when UnauthorizedError throwed even in json controller's method (4 ms)
      ✓ should respond with 401 and aplication/json when UnauthorizedError is thrown in standard json controller's method (3 ms)

PASS test/functional/json-controller-methods.spec.ts
    json-controller methods
      ✓ get should respond with proper status code, headers and body content (11 ms)
      ✓ post respond with proper status code, headers and body content (2 ms)
      ✓ put respond with proper status code, headers and body content (3 ms)
      ✓ patch respond with proper status code, headers and body content (2 ms)
      ✓ delete respond with proper status code, headers and body content (2 ms)
      ✓ head respond with proper status code, headers and body content (3 ms)
      ✓ custom method (post) respond with proper status code, headers and body content (2 ms)
      ✓ custom method (delete) respond with proper status code, headers and body content (2 ms)
      ✓ route should work with parameter (3 ms)
      ✓ route should work with regexp parameter (2 ms)
      ✓ should respond with 404 when regexp does not match (4 ms)
      ✓ route should work with string regexp parameter (3 ms)
      ✓ should respond with 404 when regexp does not match (2 ms)
      ✓ should return result from a promise (504 ms)
      ✓ should respond with 500 if promise failed (504 ms)

PASS test/functional/interceptors.spec.ts
    interceptor
      ✓ custom interceptor function should replace returned content (9 ms)
      ✓ custom interceptor class should replace returned content (3 ms)
      ✓ custom interceptor class used on the whole controller should replace returned content (2 ms)
      ✓ global interceptor class should replace returned content (3 ms)
      ✓ interceptors should support promises (1003 ms)

PASS test/unit/controller-inheritance.spec.ts
  controller inheritance
    ✓ should build empty meta for empty set (11 ms)
    ✓ should build meta if the only derivative controller is given (2 ms)
    ✓ should build meta if the only autonomous controller is given
    ✓ should build meta both when autonomous and derivative controllers are given

PASS test/functional/auth-decorator.spec.ts
    Controller responds with value when Authorization succeeds (async)
      ✓ without roles (59 ms)
      ✓ with roles (14 ms)
      ✓ async (24 ms)
    Controller responds with value when Authorization succeeds (sync)
      ✓ without roles (4 ms)
      ✓ with roles (3 ms)
      ✓ async (13 ms)
    Authorized Decorators Http Status Code
      ✓ without roles (25 ms)
      ✓ with roles (19 ms)
    Authorization checker allows to throw (async)
      ✓ custom errors (5 ms)
    Authorization checker allows to throw (sync)
      ✓ custom errors (3 ms)

PASS test/functional/container.spec.ts
    using typedi container should be possible
      ✓ typedi container (67 ms)
    using custom container should be possible
      ✓ custom container (6 ms)
    using custom container with fallback should be possible
      ✓ custom container with fallback (9 ms)
    using custom container with fallback and fallback on throw error should be possible
      ✓ custom container with fallback and fallback on throw error (9 ms)

PASS test/functional/render-decorator.spec.ts
    template rendering
      ✓ should render a template and use given variables (29 ms)
      ✓ should render a template with given variables and locals variables (4 ms)

PASS test/functional/load-from-directory.spec.ts
    loading all controllers from the given directories
      ✓ should load all controllers (37 ms)
    loading all express middlewares and error handlers from the given directories
      ✓ should succeed (14 ms)
      ✓ should fail (18 ms)

PASS test/functional/action-options.spec.ts
    ✓ should use controller options when action transform options are not set (154 ms)
    ✓ should override controller options with action transformRequest option (44 ms)
    ✓ should override controller options with action transformResponse option (5 ms)

PASS test/functional/other-controller-decorators.spec.ts
    other controller decorators
      ✓ should return httpCode set by @HttpCode decorator (25 ms)
      ✓ should return custom code when @OnNull (30 ms)
      ✓ should return custom error message and code when @OnUndefined is used with Error class (9 ms)
      ✓ should return custom code when @OnUndefined (8 ms)
      ✓ should return content-type in the response when @ContentType is used (2 ms)
      ✓ should return content-type in the response when @ContentType is used (2 ms)
      ✓ should return response with custom headers when @Header is used (4 ms)
      ✓ should relocate to new location when @Location is used (2 ms)

PASS test/functional/express-middlewares.spec.ts
    express middlewares
      ✓ should call a global middlewares (23 ms)
      ✓ should use a custom middleware when @UseBefore or @UseAfter is used (3 ms)
      ✓ should call middleware and call it before controller action when @UseBefore is used (2 ms)
      ✓ should call middleware and call it after controller action when @UseAfter is used (2 ms)
      ✓ should call before middleware and call after middleware when @UseAfter and @UseAfter are used (3 ms)
      ✓ should handle errors in custom middlewares (20 ms)

PASS test/functional/express-error-handling.spec.ts
    express error handling
      ✓ should not call global error handler middleware if there was no errors (22 ms)
      ✓ should call global error handler middleware (19 ms)
      ✓ should call global error handler middleware (5 ms)
      ✓ should call error handler middleware if used (3 ms)
      ✓ should not execute next middleware if soft error handled specifically and stopped error bubbling (2 ms)
      ✓ should process JsonErrors by their toJSON method if it exists (3 ms)

PASS test/functional/class-validator-options.spec.ts
    no options
      ✓ should not use any options if not set (63 ms)
    global options
      should merge local validation options with global validation options prioritizing local
        ✓ succeed (5 ms)
      should pass the valid param after validation
        ✓ succeed (4 ms)
        ✓ should contain param name on validation failed (16 ms)
    local options
      ✓ should apply local options (5 ms)

PASS test/functional/controller-base-routes.spec.ts
    controller > base routes functionality
      ✓ get should respond with proper status code, headers and body content (60 ms)
      ✓ get should respond with proper status code, headers and body content (5 ms)
      ✓ get should respond with proper status code, headers and body content - 2nd pass (3 ms)
      ✓ wrong route should respond with 404 error (4 ms)
      ✓ wrong route should respond with 404 error (3 ms)
      ✓ wrong route should respond with 404 error (2 ms)

PASS test/functional/class-transformer-options.spec.ts
    should not use any options if not set
      ✓ technical wrapper (29 ms)
    should apply global options
      ✓ technical wrapper (5 ms)
    should apply local options
      ✓ technical wrapper (4 ms)

PASS test/functional/global-options.spec.ts
    routing-controllers global options
      useClassTransformer default value
        ✓ useClassTransformer by default must be set to true (84 ms)
      when useClassTransformer is set to true
        ✓ useClassTransformer is enabled (5 ms)
      when useClassTransformer is set to false
        ✓ useClassTransformer is disabled (3 ms)
      when routePrefix is used all controller routes should be appended by it
        ✓ routePrefix is enabled (6 ms)

PASS test/functional/special-result-send.spec.ts
    special result value treatment
      ✓ should pipe stream to response (23 ms)
      ✓ should send raw binary data from Buffer (3 ms)
      ✓ should send raw binary data from UIntArray (2 ms)

PASS test/functional/defaults.spec.ts
    defaults
      ✓ should return undefinedResultCode from defaults config for void function (40 ms)
      ✓ should return undefinedResultCode from defaults config for promise void function (4 ms)
      ✓ should return 400 from required paramOptions (33 ms)
      ✓ should return nullResultCode from defaults config (3 ms)
      ✓ should return status code from OnUndefined annotation (2 ms)
      ✓ should mark arg optional from QueryParam annotation (3 ms)

PASS test/functional/controller-options.spec.ts
    controller options
      ✓ controller transform is enabled by default (32 ms)
      ✓ when controller transform is enabled (5 ms)
      ✓ when controller transform is disabled (3 ms)

PASS test/functional/express-custom-error-handling.spec.ts
    custom express error handling
      ✓ should not call global error handler middleware if there was no errors (25 ms)
      ✓ should call global error handler middleware (18 ms)

PASS test/functional/express-global-before-error-handling.spec.ts
    custom express global before middleware error handling
      ✓ should call global error handler middleware with CustomError (40 ms)

PASS test/functional/redirect-decorator.spec.ts
    dynamic redirect
      ✓ using template (28 ms)
      ✓ using override (4 ms)
      ✓ using original (5 ms)

PASS test/functional/middlewares-order.spec.ts
    loaded direct from array
      ✓ should call middlewares in order defined by items order (23 ms)
    specified by priority option
      ✓ should call middlewares in order defined by priority parameter of decorator (3 ms)

PASS test/functional/error-subclasses.spec.ts
  HttpError
    ✓ should be instance of HttpError and Error (3 ms)
  BadRequestError
    ✓ should be instance of BadRequestError, HttpError and Error (1 ms)

Summary of all failing tests
FAIL test/ActionParameterHandler.spec.ts
  ● ActionParameterHandler › negative › handle - throws error if the parameter is required

    Expected value   "TypeError: Cannot read property 'uuid' of undefined"
    Received:
      "TypeError: Cannot read properties of undefined (reading 'uuid')"

    Message:
      expected 'TypeError: Cannot read properties of undefined (reading \'uuid\')' to equal 'TypeError: Cannot read property \'uuid\' of undefined'

    Difference:

    - Expected
    + Received

    - TypeError: Cannot read property 'uuid' of undefined
    + TypeError: Cannot read properties of undefined (reading 'uuid')

      152 |       }
      153 | 
    > 154 |       expect(error.toString()).to.be.eq("TypeError: Cannot read property 'uuid' of undefined");
          |                                      ^
      155 |     });
      156 | 
      157 |     it('handle - throws error if the parameter is required, type file provided', async () => {

      at Object.<anonymous> (test/ActionParameterHandler.spec.ts:154:38)


Test Suites: 1 failed, 25 passed, 26 total
Tests:       1 failed, 181 passed, 182 total
Snapshots:   0 total
Time:        13.059 s, estimated 24 s
Ran all test suites.
************* run test done *************
routing-controllers is testing ./VariantsDeps/express/variant9/express
/data/js-variants/multee
************* npm unlink module *************
************* npm unlink module done *************
************* npm unlink globally *************
************* npm unlink module done *************
************* npm link globally *************
************* npm link globally done *************
************* npm link module *************
************* npm link module done *************
************* start run test *************
ts-jest[config] (WARN) The option `tsConfig` is deprecated and will be removed in ts-jest 27, use `tsconfig` instead
FAIL test/ActionParameterHandler.spec.ts
  ActionParameterHandler
    positive
      ✓ handle - should process string parameters (28 ms)
      ✓ handle - should process string parameters, returns empty if a given string is empty (6 ms)
      ✓ handle - should process number parameters
      ✓ handle - undefined on empty object provided
      ✓ handle - null provided (13 ms)
    negative
      ✕ handle - throws error if the parameter is required (7 ms)
      ✓ handle - throws error if the parameter is required, type file provided (1 ms)

  ● ActionParameterHandler › negative › handle - throws error if the parameter is required

    Expected value   "TypeError: Cannot read property 'uuid' of undefined"
    Received:
      "TypeError: Cannot read properties of undefined (reading 'uuid')"

    Message:
      expected 'TypeError: Cannot read properties of undefined (reading \'uuid\')' to equal 'TypeError: Cannot read property \'uuid\' of undefined'

    Difference:

    - Expected
    + Received

    - TypeError: Cannot read property 'uuid' of undefined
    + TypeError: Cannot read properties of undefined (reading 'uuid')

      152 |       }
      153 | 
    > 154 |       expect(error.toString()).to.be.eq("TypeError: Cannot read property 'uuid' of undefined");
          |                                      ^
      155 |     });
      156 | 
      157 |     it('handle - throws error if the parameter is required, type file provided', async () => {

      at Object.<anonymous> (test/ActionParameterHandler.spec.ts:154:38)

PASS test/functional/controller-methods.spec.ts
    controller methods
      ✓ get should respond with proper status code, headers and body content (20 ms)
      ✓ post respond with proper status code, headers and body content (5 ms)
      ✓ put respond with proper status code, headers and body content (3 ms)
      ✓ patch respond with proper status code, headers and body content (2 ms)
      ✓ delete respond with proper status code, headers and body content (3 ms)
      ✓ head respond with proper status code, headers and body content (2 ms)
      ✓ custom method (post) respond with proper status code, headers and body content (3 ms)
      ✓ custom method (delete) respond with proper status code, headers and body content (2 ms)
      ✓ route should work with parameter (3 ms)
      ✓ route should work with regexp parameter (2 ms)
      ✓ should respond with 404 when regexp does not match (5 ms)
      ✓ route should work with string regexp parameter (3 ms)
      ✓ should respond with 404 when regexp does not match (2 ms)
      ✓ should return result from a promise (503 ms)
      ✓ should respond with 500 if promise failed (516 ms)
      ✓ should respond with 204 No Content when null returned in action (5 ms)
      ✓ should respond with 404 Not Found text when undefined returned in action (21 ms)
      ✓ should respond with 404 Not Found JSON when undefined returned in action (3 ms)
      ✓ should respond with 200 and text/html even in json controller's method (2 ms)
      ✓ should respond with 200 and text/plain even in json controller's method (2 ms)
      ✓ should respond with 401 and text/html when UnauthorizedError throwed even in json controller's method (5 ms)
      ✓ should respond with 401 and aplication/json when UnauthorizedError is thrown in standard json controller's method (2 ms)

PASS test/functional/json-controller-methods.spec.ts
    json-controller methods
      ✓ get should respond with proper status code, headers and body content (10 ms)
      ✓ post respond with proper status code, headers and body content (3 ms)
      ✓ put respond with proper status code, headers and body content (2 ms)
      ✓ patch respond with proper status code, headers and body content (3 ms)
      ✓ delete respond with proper status code, headers and body content (2 ms)
      ✓ head respond with proper status code, headers and body content (3 ms)
      ✓ custom method (post) respond with proper status code, headers and body content (2 ms)
      ✓ custom method (delete) respond with proper status code, headers and body content (2 ms)
      ✓ route should work with parameter (3 ms)
      ✓ route should work with regexp parameter (3 ms)
      ✓ should respond with 404 when regexp does not match (4 ms)
      ✓ route should work with string regexp parameter (3 ms)
      ✓ should respond with 404 when regexp does not match (2 ms)
      ✓ should return result from a promise (504 ms)
      ✓ should respond with 500 if promise failed (504 ms)

PASS test/functional/interceptors.spec.ts
    interceptor
      ✓ custom interceptor function should replace returned content (9 ms)
      ✓ custom interceptor class should replace returned content (3 ms)
      ✓ custom interceptor class used on the whole controller should replace returned content (2 ms)
      ✓ global interceptor class should replace returned content (3 ms)
      ✓ interceptors should support promises (1003 ms)

PASS test/functional/action-params.spec.ts
    ✓ @Req and @Res should be provided as Request and Response objects (12 ms)
    ✓ @Res writing directly to the response should work (6 ms)
    ✓ @Param should give a param from route (5 ms)
    ✓ @Param multiple params should give a proper values from route (3 ms)
    ✓ @SessionParam without middleware (30 ms)
    ✓ @Session should return a value from session (14 ms)
    ✓ @Session(param) should allow to inject empty property (5 ms)
    ✓ @QueryParams should give a proper values from request's query parameters (14 ms)
    ✓ @QueryParams should give a proper values from request's query parameters and one multiple value (7 ms)
    ✓ @QueryParams should give a proper values from request's query with validate whitelist option on (20 ms)
    ✓ @QueryParams should give a proper values from request's query parameters with nested json (8 ms)
    ✓ @QueryParams should not validate request query parameters when it's turned off in validator options (2 ms)
    ✓ @QueryParams should give a proper values from request's optional query parameters (3 ms)
    ✓ @QueryParam should give a proper values from request query parameters (2 ms)
    ✓ @QueryParam should give an array of string with only one query parameter (3 ms)
    ✓ @QueryParam should give an array of string with multiple query parameters (2 ms)
    ✓ @QueryParam should give an array of number with only one query parameter (3 ms)
    ✓ @QueryParam should give an array of number with multiple query parameters (3 ms)
    ✓ @QueryParam should give an array of date with only one query parameter (2 ms)
    ✓ @QueryParam should give an array of date with multiple query parameters (2 ms)
    ✓ @QueryParam when required params must be provided and they should not be empty (7 ms)
    ✓ @QueryParam when the type is Date then it should be parsed (2 ms)
    ✓ @QueryParam when the type is Date and it is invalid then the response should be a BadRequest error (3 ms)
    ✓ @QueryParam when parseJson flag is used query param must be converted to object (2 ms)
    ✓ @HeaderParam should give a proper values from request headers (2 ms)
    ✓ @HeaderParam when required is params must be provided and they should not be empty (2 ms)
    ✓ @HeaderParam should fail with invalid request options (4 ms)
    ✓ @HeaderParam should fail with missing required params (3 ms)
    ✓ for @HeaderParam when parseJson flag is used query param must be converted to object (3 ms)
    ✓ @CookieParam should give a proper values from request headers (2 ms)
    ✓ @CookieParam when required is params must be provided and they should not be empty (4 ms)
    ✓ @CookieParam when parseJson flag is used query param must be converted to object (2 ms)
    ✓ @Body should provide a request body (12 ms)
    ✓ @Body should fail if required body was not provided (11 ms)
    ✓ @Body should provide a json object for json-typed controllers and actions (2 ms)
    ✓ @Body should fail if required body was not provided for json-typed controllers and actions (4 ms)
    ✓ @BodyParam should provide a json object for json-typed controllers and actions (3 ms)
    ✓ @BodyParam should fail if required body was not provided for json-typed controllers and actions (18 ms)
    ✓ @Body using application/x-www-form-urlencoded should handle url encoded form data (4 ms)
    ✓ @UploadedFile using multipart/form-data should provide uploaded file with the given name (12 ms)
    ✓ @UploadedFile with @Body should return both the file and the body (6 ms)
    ✓ @UploadedFile with @BodyParam should return both the file and the body param (4 ms)
    ✓ @UploadedFile with passed uploading options (limit) should throw an error (5 ms)
    ✓ @UploadedFile when required is used files must be provided (7 ms)
    ✓ @UploadedFiles should provide uploaded files with the given name (5 ms)
    ✓ @UploadedFiles with passed uploading options (limit) should throw an error (6 ms)
    ✓ @UploadedFiles when required is used files must be provided (4 ms)

PASS test/functional/action-options.spec.ts
    ✓ should use controller options when action transform options are not set (57 ms)
    ✓ should override controller options with action transformRequest option (5 ms)
    ✓ should override controller options with action transformResponse option (2 ms)

PASS test/functional/auth-decorator.spec.ts
    Controller responds with value when Authorization succeeds (async)
      ✓ without roles (60 ms)
      ✓ with roles (14 ms)
      ✓ async (25 ms)
    Controller responds with value when Authorization succeeds (sync)
      ✓ without roles (4 ms)
      ✓ with roles (4 ms)
      ✓ async (29 ms)
    Authorized Decorators Http Status Code
      ✓ without roles (21 ms)
      ✓ with roles (3 ms)
    Authorization checker allows to throw (async)
      ✓ custom errors (4 ms)
    Authorization checker allows to throw (sync)
      ✓ custom errors (4 ms)

PASS test/functional/other-controller-decorators.spec.ts
    other controller decorators
      ✓ should return httpCode set by @HttpCode decorator (29 ms)
      ✓ should return custom code when @OnNull (33 ms)
      ✓ should return custom error message and code when @OnUndefined is used with Error class (8 ms)
      ✓ should return custom code when @OnUndefined (21 ms)
      ✓ should return content-type in the response when @ContentType is used (12 ms)
      ✓ should return content-type in the response when @ContentType is used (5 ms)
      ✓ should return response with custom headers when @Header is used (3 ms)
      ✓ should relocate to new location when @Location is used (3 ms)

PASS test/functional/load-from-directory.spec.ts
    loading all controllers from the given directories
      ✓ should load all controllers (18 ms)
    loading all express middlewares and error handlers from the given directories
      ✓ should succeed (9 ms)
      ✓ should fail (16 ms)

PASS test/functional/container.spec.ts
    using typedi container should be possible
      ✓ typedi container (128 ms)
    using custom container should be possible
      ✓ custom container (8 ms)
    using custom container with fallback should be possible
      ✓ custom container with fallback (13 ms)
    using custom container with fallback and fallback on throw error should be possible
      ✓ custom container with fallback and fallback on throw error (26 ms)

PASS test/functional/defaults.spec.ts
    defaults
      ✓ should return undefinedResultCode from defaults config for void function (12 ms)
      ✓ should return undefinedResultCode from defaults config for promise void function (5 ms)
      ✓ should return 400 from required paramOptions (22 ms)
      ✓ should return nullResultCode from defaults config (31 ms)
      ✓ should return status code from OnUndefined annotation (28 ms)
      ✓ should mark arg optional from QueryParam annotation (16 ms)

PASS test/functional/express-error-handling.spec.ts
    express error handling
      ✓ should not call global error handler middleware if there was no errors (10 ms)
      ✓ should call global error handler middleware (19 ms)
      ✓ should call global error handler middleware (6 ms)
      ✓ should call error handler middleware if used (3 ms)
      ✓ should not execute next middleware if soft error handled specifically and stopped error bubbling (3 ms)
      ✓ should process JsonErrors by their toJSON method if it exists (15 ms)

PASS test/functional/render-decorator.spec.ts
    template rendering
      ✓ should render a template and use given variables (13 ms)
      ✓ should render a template with given variables and locals variables (5 ms)

PASS test/functional/global-options.spec.ts
    routing-controllers global options
      useClassTransformer default value
        ✓ useClassTransformer by default must be set to true (81 ms)
      when useClassTransformer is set to true
        ✓ useClassTransformer is enabled (4 ms)
      when useClassTransformer is set to false
        ✓ useClassTransformer is disabled (4 ms)
      when routePrefix is used all controller routes should be appended by it
        ✓ routePrefix is enabled (6 ms)

PASS test/unit/controller-inheritance.spec.ts
  controller inheritance
    ✓ should build empty meta for empty set (10 ms)
    ✓ should build meta if the only derivative controller is given (2 ms)
    ✓ should build meta if the only autonomous controller is given (1 ms)
    ✓ should build meta both when autonomous and derivative controllers are given

PASS test/functional/class-validator-options.spec.ts
    no options
      ✓ should not use any options if not set (63 ms)
    global options
      should merge local validation options with global validation options prioritizing local
        ✓ succeed (7 ms)
      should pass the valid param after validation
        ✓ succeed (10 ms)
        ✓ should contain param name on validation failed (24 ms)
    local options
      ✓ should apply local options (7 ms)

PASS test/functional/controller-options.spec.ts
    controller options
      ✓ controller transform is enabled by default (34 ms)
      ✓ when controller transform is enabled (5 ms)
      ✓ when controller transform is disabled (4 ms)

PASS test/functional/express-middlewares.spec.ts
    express middlewares
      ✓ should call a global middlewares (27 ms)
      ✓ should use a custom middleware when @UseBefore or @UseAfter is used (3 ms)
      ✓ should call middleware and call it before controller action when @UseBefore is used (2 ms)
      ✓ should call middleware and call it after controller action when @UseAfter is used (3 ms)
      ✓ should call before middleware and call after middleware when @UseAfter and @UseAfter are used (2 ms)
      ✓ should handle errors in custom middlewares (25 ms)

PASS test/functional/express-global-before-error-handling.spec.ts
    custom express global before middleware error handling
      ✓ should call global error handler middleware with CustomError (41 ms)

PASS test/functional/express-custom-error-handling.spec.ts
    custom express error handling
      ✓ should not call global error handler middleware if there was no errors (24 ms)
      ✓ should call global error handler middleware (18 ms)

PASS test/functional/class-transformer-options.spec.ts
    should not use any options if not set
      ✓ technical wrapper (36 ms)
    should apply global options
      ✓ technical wrapper (4 ms)
    should apply local options
      ✓ technical wrapper (4 ms)

PASS test/functional/redirect-decorator.spec.ts
    dynamic redirect
      ✓ using template (30 ms)
      ✓ using override (4 ms)
      ✓ using original (4 ms)

PASS test/functional/middlewares-order.spec.ts
    loaded direct from array
      ✓ should call middlewares in order defined by items order (34 ms)
    specified by priority option
      ✓ should call middlewares in order defined by priority parameter of decorator (4 ms)

PASS test/functional/controller-base-routes.spec.ts
    controller > base routes functionality
      ✓ get should respond with proper status code, headers and body content (63 ms)
      ✓ get should respond with proper status code, headers and body content (4 ms)
      ✓ get should respond with proper status code, headers and body content - 2nd pass (4 ms)
      ✓ wrong route should respond with 404 error (3 ms)
      ✓ wrong route should respond with 404 error (3 ms)
      ✓ wrong route should respond with 404 error (3 ms)

PASS test/functional/special-result-send.spec.ts
    special result value treatment
      ✓ should pipe stream to response (24 ms)
      ✓ should send raw binary data from Buffer (3 ms)
      ✓ should send raw binary data from UIntArray (3 ms)

PASS test/functional/error-subclasses.spec.ts
  HttpError
    ✓ should be instance of HttpError and Error (3 ms)
  BadRequestError
    ✓ should be instance of BadRequestError, HttpError and Error (2 ms)

Summary of all failing tests
FAIL test/ActionParameterHandler.spec.ts
  ● ActionParameterHandler › negative › handle - throws error if the parameter is required

    Expected value   "TypeError: Cannot read property 'uuid' of undefined"
    Received:
      "TypeError: Cannot read properties of undefined (reading 'uuid')"

    Message:
      expected 'TypeError: Cannot read properties of undefined (reading \'uuid\')' to equal 'TypeError: Cannot read property \'uuid\' of undefined'

    Difference:

    - Expected
    + Received

    - TypeError: Cannot read property 'uuid' of undefined
    + TypeError: Cannot read properties of undefined (reading 'uuid')

      152 |       }
      153 | 
    > 154 |       expect(error.toString()).to.be.eq("TypeError: Cannot read property 'uuid' of undefined");
          |                                      ^
      155 |     });
      156 | 
      157 |     it('handle - throws error if the parameter is required, type file provided', async () => {

      at Object.<anonymous> (test/ActionParameterHandler.spec.ts:154:38)


Test Suites: 1 failed, 25 passed, 26 total
Tests:       1 failed, 181 passed, 182 total
Snapshots:   0 total
Time:        13.224 s
Ran all test suites.
************* run test done *************
routing-controllers is testing ./VariantsDeps/express/variant8/express
/data/js-variants/multee
************* npm unlink module *************
************* npm unlink module done *************
************* npm unlink globally *************
************* npm unlink module done *************
************* npm link globally *************
************* npm link globally done *************
************* npm link module *************
************* npm link module done *************
************* start run test *************
ts-jest[config] (WARN) The option `tsConfig` is deprecated and will be removed in ts-jest 27, use `tsconfig` instead
FAIL test/ActionParameterHandler.spec.ts
  ActionParameterHandler
    positive
      ✓ handle - should process string parameters (36 ms)
      ✓ handle - should process string parameters, returns empty if a given string is empty
      ✓ handle - should process number parameters (1 ms)
      ✓ handle - undefined on empty object provided
      ✓ handle - null provided (13 ms)
    negative
      ✕ handle - throws error if the parameter is required (7 ms)
      ✓ handle - throws error if the parameter is required, type file provided (1 ms)

  ● ActionParameterHandler › negative › handle - throws error if the parameter is required

    Expected value   "TypeError: Cannot read property 'uuid' of undefined"
    Received:
      "TypeError: Cannot read properties of undefined (reading 'uuid')"

    Message:
      expected 'TypeError: Cannot read properties of undefined (reading \'uuid\')' to equal 'TypeError: Cannot read property \'uuid\' of undefined'

    Difference:

    - Expected
    + Received

    - TypeError: Cannot read property 'uuid' of undefined
    + TypeError: Cannot read properties of undefined (reading 'uuid')

      152 |       }
      153 | 
    > 154 |       expect(error.toString()).to.be.eq("TypeError: Cannot read property 'uuid' of undefined");
          |                                      ^
      155 |     });
      156 | 
      157 |     it('handle - throws error if the parameter is required, type file provided', async () => {

      at Object.<anonymous> (test/ActionParameterHandler.spec.ts:154:38)

PASS test/functional/controller-methods.spec.ts
    controller methods
      ✓ get should respond with proper status code, headers and body content (20 ms)
      ✓ post respond with proper status code, headers and body content (5 ms)
      ✓ put respond with proper status code, headers and body content (3 ms)
      ✓ patch respond with proper status code, headers and body content (3 ms)
      ✓ delete respond with proper status code, headers and body content (3 ms)
      ✓ head respond with proper status code, headers and body content (3 ms)
      ✓ custom method (post) respond with proper status code, headers and body content (2 ms)
      ✓ custom method (delete) respond with proper status code, headers and body content (3 ms)
      ✓ route should work with parameter (3 ms)
      ✓ route should work with regexp parameter (3 ms)
      ✓ should respond with 404 when regexp does not match (5 ms)
      ✓ route should work with string regexp parameter (14 ms)
      ✓ should respond with 404 when regexp does not match (3 ms)
      ✓ should return result from a promise (503 ms)
      ✓ should respond with 500 if promise failed (505 ms)
      ✓ should respond with 204 No Content when null returned in action (8 ms)
      ✓ should respond with 404 Not Found text when undefined returned in action (43 ms)
      ✓ should respond with 404 Not Found JSON when undefined returned in action (4 ms)
      ✓ should respond with 200 and text/html even in json controller's method (4 ms)
      ✓ should respond with 200 and text/plain even in json controller's method (3 ms)
      ✓ should respond with 401 and text/html when UnauthorizedError throwed even in json controller's method (8 ms)
      ✓ should respond with 401 and aplication/json when UnauthorizedError is thrown in standard json controller's method (4 ms)

PASS test/functional/json-controller-methods.spec.ts
    json-controller methods
      ✓ get should respond with proper status code, headers and body content (10 ms)
      ✓ post respond with proper status code, headers and body content (3 ms)
      ✓ put respond with proper status code, headers and body content (3 ms)
      ✓ patch respond with proper status code, headers and body content (2 ms)
      ✓ delete respond with proper status code, headers and body content (3 ms)
      ✓ head respond with proper status code, headers and body content (2 ms)
      ✓ custom method (post) respond with proper status code, headers and body content (2 ms)
      ✓ custom method (delete) respond with proper status code, headers and body content (2 ms)
      ✓ route should work with parameter (6 ms)
      ✓ route should work with regexp parameter (2 ms)
      ✓ should respond with 404 when regexp does not match (4 ms)
      ✓ route should work with string regexp parameter (3 ms)
      ✓ should respond with 404 when regexp does not match (2 ms)
      ✓ should return result from a promise (503 ms)
      ✓ should respond with 500 if promise failed (505 ms)

PASS test/functional/interceptors.spec.ts
    interceptor
      ✓ custom interceptor function should replace returned content (9 ms)
      ✓ custom interceptor class should replace returned content (3 ms)
      ✓ custom interceptor class used on the whole controller should replace returned content (3 ms)
      ✓ global interceptor class should replace returned content (3 ms)
      ✓ interceptors should support promises (1004 ms)

PASS test/functional/action-params.spec.ts
    ✓ @Req and @Res should be provided as Request and Response objects (11 ms)
    ✓ @Res writing directly to the response should work (4 ms)
    ✓ @Param should give a param from route (3 ms)
    ✓ @Param multiple params should give a proper values from route (3 ms)
    ✓ @SessionParam without middleware (23 ms)
    ✓ @Session should return a value from session (11 ms)
    ✓ @Session(param) should allow to inject empty property (3 ms)
    ✓ @QueryParams should give a proper values from request's query parameters (21 ms)
    ✓ @QueryParams should give a proper values from request's query parameters and one multiple value (6 ms)
    ✓ @QueryParams should give a proper values from request's query with validate whitelist option on (3 ms)
    ✓ @QueryParams should give a proper values from request's query parameters with nested json (5 ms)
    ✓ @QueryParams should not validate request query parameters when it's turned off in validator options (2 ms)
    ✓ @QueryParams should give a proper values from request's optional query parameters (3 ms)
    ✓ @QueryParam should give a proper values from request query parameters (2 ms)
    ✓ @QueryParam should give an array of string with only one query parameter (2 ms)
    ✓ @QueryParam should give an array of string with multiple query parameters (3 ms)
    ✓ @QueryParam should give an array of number with only one query parameter (3 ms)
    ✓ @QueryParam should give an array of number with multiple query parameters (3 ms)
    ✓ @QueryParam should give an array of date with only one query parameter (2 ms)
    ✓ @QueryParam should give an array of date with multiple query parameters (2 ms)
    ✓ @QueryParam when required params must be provided and they should not be empty (8 ms)
    ✓ @QueryParam when the type is Date then it should be parsed (1 ms)
    ✓ @QueryParam when the type is Date and it is invalid then the response should be a BadRequest error (3 ms)
    ✓ @QueryParam when parseJson flag is used query param must be converted to object (2 ms)
    ✓ @HeaderParam should give a proper values from request headers (2 ms)
    ✓ @HeaderParam when required is params must be provided and they should not be empty (2 ms)
    ✓ @HeaderParam should fail with invalid request options (3 ms)
    ✓ @HeaderParam should fail with missing required params (3 ms)
    ✓ for @HeaderParam when parseJson flag is used query param must be converted to object (3 ms)
    ✓ @CookieParam should give a proper values from request headers (3 ms)
    ✓ @CookieParam when required is params must be provided and they should not be empty (7 ms)
    ✓ @CookieParam when parseJson flag is used query param must be converted to object (2 ms)
    ✓ @Body should provide a request body (15 ms)
    ✓ @Body should fail if required body was not provided (7 ms)
    ✓ @Body should provide a json object for json-typed controllers and actions (3 ms)
    ✓ @Body should fail if required body was not provided for json-typed controllers and actions (4 ms)
    ✓ @BodyParam should provide a json object for json-typed controllers and actions (3 ms)
    ✓ @BodyParam should fail if required body was not provided for json-typed controllers and actions (17 ms)
    ✓ @Body using application/x-www-form-urlencoded should handle url encoded form data (4 ms)
    ✓ @UploadedFile using multipart/form-data should provide uploaded file with the given name (15 ms)
    ✓ @UploadedFile with @Body should return both the file and the body (6 ms)
    ✓ @UploadedFile with @BodyParam should return both the file and the body param (6 ms)
    ✓ @UploadedFile with passed uploading options (limit) should throw an error (6 ms)
    ✓ @UploadedFile when required is used files must be provided (7 ms)
    ✓ @UploadedFiles should provide uploaded files with the given name (5 ms)
    ✓ @UploadedFiles with passed uploading options (limit) should throw an error (5 ms)
    ✓ @UploadedFiles when required is used files must be provided (4 ms)

PASS test/functional/container.spec.ts
    using typedi container should be possible
      ✓ typedi container (65 ms)
    using custom container should be possible
      ✓ custom container (5 ms)
    using custom container with fallback should be possible
      ✓ custom container with fallback (8 ms)
    using custom container with fallback and fallback on throw error should be possible
      ✓ custom container with fallback and fallback on throw error (8 ms)

PASS test/functional/express-error-handling.spec.ts
    express error handling
      ✓ should not call global error handler middleware if there was no errors (10 ms)
      ✓ should call global error handler middleware (19 ms)
      ✓ should call global error handler middleware (6 ms)
      ✓ should call error handler middleware if used (4 ms)
      ✓ should not execute next middleware if soft error handled specifically and stopped error bubbling (4 ms)
      ✓ should process JsonErrors by their toJSON method if it exists (4 ms)

PASS test/functional/auth-decorator.spec.ts
    Controller responds with value when Authorization succeeds (async)
      ✓ without roles (73 ms)
      ✓ with roles (14 ms)
      ✓ async (25 ms)
    Controller responds with value when Authorization succeeds (sync)
      ✓ without roles (4 ms)
      ✓ with roles (3 ms)
      ✓ async (14 ms)
    Authorized Decorators Http Status Code
      ✓ without roles (20 ms)
      ✓ with roles (19 ms)
    Authorization checker allows to throw (async)
      ✓ custom errors (5 ms)
    Authorization checker allows to throw (sync)
      ✓ custom errors (4 ms)

PASS test/functional/other-controller-decorators.spec.ts
    other controller decorators
      ✓ should return httpCode set by @HttpCode decorator (31 ms)
      ✓ should return custom code when @OnNull (32 ms)
      ✓ should return custom error message and code when @OnUndefined is used with Error class (7 ms)
      ✓ should return custom code when @OnUndefined (9 ms)
      ✓ should return content-type in the response when @ContentType is used (2 ms)
      ✓ should return content-type in the response when @ContentType is used (2 ms)
      ✓ should return response with custom headers when @Header is used (4 ms)
      ✓ should relocate to new location when @Location is used (2 ms)

PASS test/functional/defaults.spec.ts
    defaults
      ✓ should return undefinedResultCode from defaults config for void function (23 ms)
      ✓ should return undefinedResultCode from defaults config for promise void function (2 ms)
      ✓ should return 400 from required paramOptions (14 ms)
      ✓ should return nullResultCode from defaults config (3 ms)
      ✓ should return status code from OnUndefined annotation (3 ms)
      ✓ should mark arg optional from QueryParam annotation (4 ms)

PASS test/functional/load-from-directory.spec.ts
    loading all controllers from the given directories
      ✓ should load all controllers (79 ms)
    loading all express middlewares and error handlers from the given directories
      ✓ should succeed (65 ms)
      ✓ should fail (69 ms)

PASS test/functional/action-options.spec.ts
    ✓ should use controller options when action transform options are not set (64 ms)
    ✓ should override controller options with action transformRequest option (5 ms)
    ✓ should override controller options with action transformResponse option (3 ms)

PASS test/functional/controller-options.spec.ts
    controller options
      ✓ controller transform is enabled by default (22 ms)
      ✓ when controller transform is enabled (7 ms)
      ✓ when controller transform is disabled (3 ms)

PASS test/functional/express-middlewares.spec.ts
    express middlewares
      ✓ should call a global middlewares (8 ms)
      ✓ should use a custom middleware when @UseBefore or @UseAfter is used (3 ms)
      ✓ should call middleware and call it before controller action when @UseBefore is used (2 ms)
      ✓ should call middleware and call it after controller action when @UseAfter is used (2 ms)
      ✓ should call before middleware and call after middleware when @UseAfter and @UseAfter are used (2 ms)
      ✓ should handle errors in custom middlewares (22 ms)

PASS test/functional/class-validator-options.spec.ts
    no options
      ✓ should not use any options if not set (64 ms)
    global options
      should merge local validation options with global validation options prioritizing local
        ✓ succeed (7 ms)
      should pass the valid param after validation
        ✓ succeed (6 ms)
        ✓ should contain param name on validation failed (15 ms)
    local options
      ✓ should apply local options (7 ms)

PASS test/functional/global-options.spec.ts
    routing-controllers global options
      useClassTransformer default value
        ✓ useClassTransformer by default must be set to true (82 ms)
      when useClassTransformer is set to true
        ✓ useClassTransformer is enabled (4 ms)
      when useClassTransformer is set to false
        ✓ useClassTransformer is disabled (4 ms)
      when routePrefix is used all controller routes should be appended by it
        ✓ routePrefix is enabled (6 ms)

PASS test/functional/controller-base-routes.spec.ts
    controller > base routes functionality
      ✓ get should respond with proper status code, headers and body content (63 ms)
      ✓ get should respond with proper status code, headers and body content (4 ms)
      ✓ get should respond with proper status code, headers and body content - 2nd pass (4 ms)
      ✓ wrong route should respond with 404 error (4 ms)
      ✓ wrong route should respond with 404 error (3 ms)
      ✓ wrong route should respond with 404 error (2 ms)

PASS test/functional/class-transformer-options.spec.ts
    should not use any options if not set
      ✓ technical wrapper (30 ms)
    should apply global options
      ✓ technical wrapper (6 ms)
    should apply local options
      ✓ technical wrapper (6 ms)

PASS test/unit/controller-inheritance.spec.ts
  controller inheritance
    ✓ should build empty meta for empty set (11 ms)
    ✓ should build meta if the only derivative controller is given (2 ms)
    ✓ should build meta if the only autonomous controller is given (1 ms)
    ✓ should build meta both when autonomous and derivative controllers are given

PASS test/functional/middlewares-order.spec.ts
    loaded direct from array
      ✓ should call middlewares in order defined by items order (9 ms)
    specified by priority option
      ✓ should call middlewares in order defined by priority parameter of decorator (3 ms)

PASS test/functional/express-custom-error-handling.spec.ts
    custom express error handling
      ✓ should not call global error handler middleware if there was no errors (23 ms)
      ✓ should call global error handler middleware (19 ms)

PASS test/functional/express-global-before-error-handling.spec.ts
    custom express global before middleware error handling
      ✓ should call global error handler middleware with CustomError (39 ms)

PASS test/functional/redirect-decorator.spec.ts
    dynamic redirect
      ✓ using template (28 ms)
      ✓ using override (4 ms)
      ✓ using original (4 ms)

PASS test/functional/special-result-send.spec.ts
    special result value treatment
      ✓ should pipe stream to response (24 ms)
      ✓ should send raw binary data from Buffer (3 ms)
      ✓ should send raw binary data from UIntArray (2 ms)

PASS test/functional/render-decorator.spec.ts
    template rendering
      ✓ should render a template and use given variables (30 ms)
      ✓ should render a template with given variables and locals variables (5 ms)

PASS test/functional/error-subclasses.spec.ts
  HttpError
    ✓ should be instance of HttpError and Error (3 ms)
  BadRequestError
    ✓ should be instance of BadRequestError, HttpError and Error (1 ms)

Summary of all failing tests
FAIL test/ActionParameterHandler.spec.ts
  ● ActionParameterHandler › negative › handle - throws error if the parameter is required

    Expected value   "TypeError: Cannot read property 'uuid' of undefined"
    Received:
      "TypeError: Cannot read properties of undefined (reading 'uuid')"

    Message:
      expected 'TypeError: Cannot read properties of undefined (reading \'uuid\')' to equal 'TypeError: Cannot read property \'uuid\' of undefined'

    Difference:

    - Expected
    + Received

    - TypeError: Cannot read property 'uuid' of undefined
    + TypeError: Cannot read properties of undefined (reading 'uuid')

      152 |       }
      153 | 
    > 154 |       expect(error.toString()).to.be.eq("TypeError: Cannot read property 'uuid' of undefined");
          |                                      ^
      155 |     });
      156 | 
      157 |     it('handle - throws error if the parameter is required, type file provided', async () => {

      at Object.<anonymous> (test/ActionParameterHandler.spec.ts:154:38)


Test Suites: 1 failed, 25 passed, 26 total
Tests:       1 failed, 181 passed, 182 total
Snapshots:   0 total
Time:        13.241 s, estimated 14 s
Ran all test suites.
************* run test done *************
routing-controllers is testing ./VariantsDeps/express/variant7/express
/data/js-variants/multee
************* npm unlink module *************
************* npm unlink module done *************
************* npm unlink globally *************
************* npm unlink module done *************
************* npm link globally *************
************* npm link globally done *************
************* npm link module *************
************* npm link module done *************
************* start run test *************
ts-jest[config] (WARN) The option `tsConfig` is deprecated and will be removed in ts-jest 27, use `tsconfig` instead
FAIL test/ActionParameterHandler.spec.ts
  ActionParameterHandler
    positive
      ✓ handle - should process string parameters (27 ms)
      ✓ handle - should process string parameters, returns empty if a given string is empty
      ✓ handle - should process number parameters (1 ms)
      ✓ handle - undefined on empty object provided
      ✓ handle - null provided (14 ms)
    negative
      ✕ handle - throws error if the parameter is required (8 ms)
      ✓ handle - throws error if the parameter is required, type file provided (1 ms)

  ● ActionParameterHandler › negative › handle - throws error if the parameter is required

    Expected value   "TypeError: Cannot read property 'uuid' of undefined"
    Received:
      "TypeError: Cannot read properties of undefined (reading 'uuid')"

    Message:
      expected 'TypeError: Cannot read properties of undefined (reading \'uuid\')' to equal 'TypeError: Cannot read property \'uuid\' of undefined'

    Difference:

    - Expected
    + Received

    - TypeError: Cannot read property 'uuid' of undefined
    + TypeError: Cannot read properties of undefined (reading 'uuid')

      152 |       }
      153 | 
    > 154 |       expect(error.toString()).to.be.eq("TypeError: Cannot read property 'uuid' of undefined");
          |                                      ^
      155 |     });
      156 | 
      157 |     it('handle - throws error if the parameter is required, type file provided', async () => {

      at Object.<anonymous> (test/ActionParameterHandler.spec.ts:154:38)

PASS test/functional/controller-methods.spec.ts
    controller methods
      ✓ get should respond with proper status code, headers and body content (23 ms)
      ✓ post respond with proper status code, headers and body content (5 ms)
      ✓ put respond with proper status code, headers and body content (4 ms)
      ✓ patch respond with proper status code, headers and body content (3 ms)
      ✓ delete respond with proper status code, headers and body content (3 ms)
      ✓ head respond with proper status code, headers and body content (2 ms)
      ✓ custom method (post) respond with proper status code, headers and body content (3 ms)
      ✓ custom method (delete) respond with proper status code, headers and body content (2 ms)
      ✓ route should work with parameter (4 ms)
      ✓ route should work with regexp parameter (2 ms)
      ✓ should respond with 404 when regexp does not match (4 ms)
      ✓ route should work with string regexp parameter (3 ms)
      ✓ should respond with 404 when regexp does not match (3 ms)
      ✓ should return result from a promise (505 ms)
      ✓ should respond with 500 if promise failed (505 ms)
      ✓ should respond with 204 No Content when null returned in action (5 ms)
      ✓ should respond with 404 Not Found text when undefined returned in action (21 ms)
      ✓ should respond with 404 Not Found JSON when undefined returned in action (12 ms)
      ✓ should respond with 200 and text/html even in json controller's method (2 ms)
      ✓ should respond with 200 and text/plain even in json controller's method (2 ms)
      ✓ should respond with 401 and text/html when UnauthorizedError throwed even in json controller's method (5 ms)
      ✓ should respond with 401 and aplication/json when UnauthorizedError is thrown in standard json controller's method (2 ms)

PASS test/functional/json-controller-methods.spec.ts
    json-controller methods
      ✓ get should respond with proper status code, headers and body content (26 ms)
      ✓ post respond with proper status code, headers and body content (3 ms)
      ✓ put respond with proper status code, headers and body content (3 ms)
      ✓ patch respond with proper status code, headers and body content (2 ms)
      ✓ delete respond with proper status code, headers and body content (3 ms)
      ✓ head respond with proper status code, headers and body content (2 ms)
      ✓ custom method (post) respond with proper status code, headers and body content (2 ms)
      ✓ custom method (delete) respond with proper status code, headers and body content (2 ms)
      ✓ route should work with parameter (3 ms)
      ✓ route should work with regexp parameter (3 ms)
      ✓ should respond with 404 when regexp does not match (4 ms)
      ✓ route should work with string regexp parameter (3 ms)
      ✓ should respond with 404 when regexp does not match (2 ms)
      ✓ should return result from a promise (504 ms)
      ✓ should respond with 500 if promise failed (504 ms)

PASS test/functional/interceptors.spec.ts
    interceptor
      ✓ custom interceptor function should replace returned content (22 ms)
      ✓ custom interceptor class should replace returned content (3 ms)
      ✓ custom interceptor class used on the whole controller should replace returned content (3 ms)
      ✓ global interceptor class should replace returned content (2 ms)
      ✓ interceptors should support promises (1004 ms)

PASS test/functional/action-params.spec.ts
    ✓ @Req and @Res should be provided as Request and Response objects (35 ms)
    ✓ @Res writing directly to the response should work (7 ms)
    ✓ @Param should give a param from route (5 ms)
    ✓ @Param multiple params should give a proper values from route (4 ms)
    ✓ @SessionParam without middleware (40 ms)
    ✓ @Session should return a value from session (10 ms)
    ✓ @Session(param) should allow to inject empty property (3 ms)
    ✓ @QueryParams should give a proper values from request's query parameters (9 ms)
    ✓ @QueryParams should give a proper values from request's query parameters and one multiple value (6 ms)
    ✓ @QueryParams should give a proper values from request's query with validate whitelist option on (4 ms)
    ✓ @QueryParams should give a proper values from request's query parameters with nested json (4 ms)
    ✓ @QueryParams should not validate request query parameters when it's turned off in validator options (3 ms)
    ✓ @QueryParams should give a proper values from request's optional query parameters (2 ms)
    ✓ @QueryParam should give a proper values from request query parameters (10 ms)
    ✓ @QueryParam should give an array of string with only one query parameter (2 ms)
    ✓ @QueryParam should give an array of string with multiple query parameters (3 ms)
    ✓ @QueryParam should give an array of number with only one query parameter (3 ms)
    ✓ @QueryParam should give an array of number with multiple query parameters (3 ms)
    ✓ @QueryParam should give an array of date with only one query parameter (2 ms)
    ✓ @QueryParam should give an array of date with multiple query parameters (2 ms)
    ✓ @QueryParam when required params must be provided and they should not be empty (7 ms)
    ✓ @QueryParam when the type is Date then it should be parsed (2 ms)
    ✓ @QueryParam when the type is Date and it is invalid then the response should be a BadRequest error (3 ms)
    ✓ @QueryParam when parseJson flag is used query param must be converted to object (2 ms)
    ✓ @HeaderParam should give a proper values from request headers (2 ms)
    ✓ @HeaderParam when required is params must be provided and they should not be empty (2 ms)
    ✓ @HeaderParam should fail with invalid request options (3 ms)
    ✓ @HeaderParam should fail with missing required params (2 ms)
    ✓ for @HeaderParam when parseJson flag is used query param must be converted to object (2 ms)
    ✓ @CookieParam should give a proper values from request headers (3 ms)
    ✓ @CookieParam when required is params must be provided and they should not be empty (4 ms)
    ✓ @CookieParam when parseJson flag is used query param must be converted to object (2 ms)
    ✓ @Body should provide a request body (12 ms)
    ✓ @Body should fail if required body was not provided (7 ms)
    ✓ @Body should provide a json object for json-typed controllers and actions (3 ms)
    ✓ @Body should fail if required body was not provided for json-typed controllers and actions (4 ms)
    ✓ @BodyParam should provide a json object for json-typed controllers and actions (3 ms)
    ✓ @BodyParam should fail if required body was not provided for json-typed controllers and actions (24 ms)
    ✓ @Body using application/x-www-form-urlencoded should handle url encoded form data (3 ms)
    ✓ @UploadedFile using multipart/form-data should provide uploaded file with the given name (12 ms)
    ✓ @UploadedFile with @Body should return both the file and the body (6 ms)
    ✓ @UploadedFile with @BodyParam should return both the file and the body param (5 ms)
    ✓ @UploadedFile with passed uploading options (limit) should throw an error (5 ms)
    ✓ @UploadedFile when required is used files must be provided (6 ms)
    ✓ @UploadedFiles should provide uploaded files with the given name (5 ms)
    ✓ @UploadedFiles with passed uploading options (limit) should throw an error (5 ms)
    ✓ @UploadedFiles when required is used files must be provided (4 ms)

PASS test/functional/load-from-directory.spec.ts
    loading all controllers from the given directories
      ✓ should load all controllers (34 ms)
    loading all express middlewares and error handlers from the given directories
      ✓ should succeed (14 ms)
      ✓ should fail (18 ms)

PASS test/functional/auth-decorator.spec.ts
    Controller responds with value when Authorization succeeds (async)
      ✓ without roles (73 ms)
      ✓ with roles (14 ms)
      ✓ async (25 ms)
    Controller responds with value when Authorization succeeds (sync)
      ✓ without roles (5 ms)
      ✓ with roles (4 ms)
      ✓ async (14 ms)
    Authorized Decorators Http Status Code
      ✓ without roles (22 ms)
      ✓ with roles (5 ms)
    Authorization checker allows to throw (async)
      ✓ custom errors (4 ms)
    Authorization checker allows to throw (sync)
      ✓ custom errors (3 ms)

PASS test/functional/controller-options.spec.ts
    controller options
      ✓ controller transform is enabled by default (51 ms)
      ✓ when controller transform is enabled (19 ms)
      ✓ when controller transform is disabled (4 ms)

PASS test/functional/other-controller-decorators.spec.ts
    other controller decorators
      ✓ should return httpCode set by @HttpCode decorator (29 ms)
      ✓ should return custom code when @OnNull (34 ms)
      ✓ should return custom error message and code when @OnUndefined is used with Error class (7 ms)
      ✓ should return custom code when @OnUndefined (9 ms)
      ✓ should return content-type in the response when @ContentType is used (2 ms)
      ✓ should return content-type in the response when @ContentType is used (2 ms)
      ✓ should return response with custom headers when @Header is used (5 ms)
      ✓ should relocate to new location when @Location is used (2 ms)

PASS test/functional/action-options.spec.ts
    ✓ should use controller options when action transform options are not set (33 ms)
    ✓ should override controller options with action transformRequest option (5 ms)
    ✓ should override controller options with action transformResponse option (3 ms)

PASS test/functional/express-error-handling.spec.ts
    express error handling
      ✓ should not call global error handler middleware if there was no errors (29 ms)
      ✓ should call global error handler middleware (41 ms)
      ✓ should call global error handler middleware (10 ms)
      ✓ should call error handler middleware if used (14 ms)
      ✓ should not execute next middleware if soft error handled specifically and stopped error bubbling (14 ms)
      ✓ should process JsonErrors by their toJSON method if it exists (32 ms)

PASS test/functional/middlewares-order.spec.ts
    loaded direct from array
      ✓ should call middlewares in order defined by items order (11 ms)
    specified by priority option
      ✓ should call middlewares in order defined by priority parameter of decorator (4 ms)

PASS test/functional/class-validator-options.spec.ts
    no options
      ✓ should not use any options if not set (63 ms)
    global options
      should merge local validation options with global validation options prioritizing local
        ✓ succeed (6 ms)
      should pass the valid param after validation
        ✓ succeed (7 ms)
        ✓ should contain param name on validation failed (19 ms)
    local options
      ✓ should apply local options (4 ms)

PASS test/functional/container.spec.ts
    using typedi container should be possible
      ✓ typedi container (60 ms)
    using custom container should be possible
      ✓ custom container (6 ms)
    using custom container with fallback should be possible
      ✓ custom container with fallback (8 ms)
    using custom container with fallback and fallback on throw error should be possible
      ✓ custom container with fallback and fallback on throw error (7 ms)

PASS test/unit/controller-inheritance.spec.ts
  controller inheritance
    ✓ should build empty meta for empty set (10 ms)
    ✓ should build meta if the only derivative controller is given (2 ms)
    ✓ should build meta if the only autonomous controller is given (1 ms)
    ✓ should build meta both when autonomous and derivative controllers are given (1 ms)

PASS test/functional/class-transformer-options.spec.ts
    should not use any options if not set
      ✓ technical wrapper (15 ms)
    should apply global options
      ✓ technical wrapper (5 ms)
    should apply local options
      ✓ technical wrapper (5 ms)

PASS test/functional/global-options.spec.ts
    routing-controllers global options
      useClassTransformer default value
        ✓ useClassTransformer by default must be set to true (81 ms)
      when useClassTransformer is set to true
        ✓ useClassTransformer is enabled (4 ms)
      when useClassTransformer is set to false
        ✓ useClassTransformer is disabled (4 ms)
      when routePrefix is used all controller routes should be appended by it
        ✓ routePrefix is enabled (8 ms)

PASS test/functional/express-middlewares.spec.ts
    express middlewares
      ✓ should call a global middlewares (24 ms)
      ✓ should use a custom middleware when @UseBefore or @UseAfter is used (3 ms)
      ✓ should call middleware and call it before controller action when @UseBefore is used (2 ms)
      ✓ should call middleware and call it after controller action when @UseAfter is used (2 ms)
      ✓ should call before middleware and call after middleware when @UseAfter and @UseAfter are used (3 ms)
      ✓ should handle errors in custom middlewares (23 ms)

PASS test/functional/redirect-decorator.spec.ts
    dynamic redirect
      ✓ using template (28 ms)
      ✓ using override (4 ms)
      ✓ using original (4 ms)

PASS test/functional/defaults.spec.ts
    defaults
      ✓ should return undefinedResultCode from defaults config for void function (24 ms)
      ✓ should return undefinedResultCode from defaults config for promise void function (2 ms)
      ✓ should return 400 from required paramOptions (17 ms)
      ✓ should return nullResultCode from defaults config (3 ms)
      ✓ should return status code from OnUndefined annotation (3 ms)
      ✓ should mark arg optional from QueryParam annotation (4 ms)

PASS test/functional/controller-base-routes.spec.ts
    controller > base routes functionality
      ✓ get should respond with proper status code, headers and body content (62 ms)
      ✓ get should respond with proper status code, headers and body content (4 ms)
      ✓ get should respond with proper status code, headers and body content - 2nd pass (4 ms)
      ✓ wrong route should respond with 404 error (3 ms)
      ✓ wrong route should respond with 404 error (3 ms)
      ✓ wrong route should respond with 404 error (3 ms)

PASS test/functional/express-custom-error-handling.spec.ts
    custom express error handling
      ✓ should not call global error handler middleware if there was no errors (24 ms)
      ✓ should call global error handler middleware (20 ms)

PASS test/functional/render-decorator.spec.ts
    template rendering
      ✓ should render a template and use given variables (41 ms)
      ✓ should render a template with given variables and locals variables (5 ms)

PASS test/functional/express-global-before-error-handling.spec.ts
    custom express global before middleware error handling
      ✓ should call global error handler middleware with CustomError (24 ms)

PASS test/functional/special-result-send.spec.ts
    special result value treatment
      ✓ should pipe stream to response (9 ms)
      ✓ should send raw binary data from Buffer (3 ms)
      ✓ should send raw binary data from UIntArray (2 ms)

PASS test/functional/error-subclasses.spec.ts
  HttpError
    ✓ should be instance of HttpError and Error (3 ms)
  BadRequestError
    ✓ should be instance of BadRequestError, HttpError and Error (1 ms)

Summary of all failing tests
FAIL test/ActionParameterHandler.spec.ts
  ● ActionParameterHandler › negative › handle - throws error if the parameter is required

    Expected value   "TypeError: Cannot read property 'uuid' of undefined"
    Received:
      "TypeError: Cannot read properties of undefined (reading 'uuid')"

    Message:
      expected 'TypeError: Cannot read properties of undefined (reading \'uuid\')' to equal 'TypeError: Cannot read property \'uuid\' of undefined'

    Difference:

    - Expected
    + Received

    - TypeError: Cannot read property 'uuid' of undefined
    + TypeError: Cannot read properties of undefined (reading 'uuid')

      152 |       }
      153 | 
    > 154 |       expect(error.toString()).to.be.eq("TypeError: Cannot read property 'uuid' of undefined");
          |                                      ^
      155 |     });
      156 | 
      157 |     it('handle - throws error if the parameter is required, type file provided', async () => {

      at Object.<anonymous> (test/ActionParameterHandler.spec.ts:154:38)


Test Suites: 1 failed, 25 passed, 26 total
Tests:       1 failed, 181 passed, 182 total
Snapshots:   0 total
Time:        13.076 s, estimated 14 s
Ran all test suites.
************* run test done *************
routing-controllers is testing ./VariantsDeps/express/variant6/express
/data/js-variants/multee
************* npm unlink module *************
************* npm unlink module done *************
************* npm unlink globally *************
************* npm unlink module done *************
************* npm link globally *************
************* npm link globally done *************
************* npm link module *************
************* npm link module done *************
************* start run test *************
ts-jest[config] (WARN) The option `tsConfig` is deprecated and will be removed in ts-jest 27, use `tsconfig` instead
FAIL test/ActionParameterHandler.spec.ts
  ActionParameterHandler
    positive
      ✓ handle - should process string parameters (33 ms)
      ✓ handle - should process string parameters, returns empty if a given string is empty
      ✓ handle - should process number parameters (1 ms)
      ✓ handle - undefined on empty object provided
      ✓ handle - null provided (14 ms)
    negative
      ✕ handle - throws error if the parameter is required (8 ms)
      ✓ handle - throws error if the parameter is required, type file provided (1 ms)

  ● ActionParameterHandler › negative › handle - throws error if the parameter is required

    Expected value   "TypeError: Cannot read property 'uuid' of undefined"
    Received:
      "TypeError: Cannot read properties of undefined (reading 'uuid')"

    Message:
      expected 'TypeError: Cannot read properties of undefined (reading \'uuid\')' to equal 'TypeError: Cannot read property \'uuid\' of undefined'

    Difference:

    - Expected
    + Received

    - TypeError: Cannot read property 'uuid' of undefined
    + TypeError: Cannot read properties of undefined (reading 'uuid')

      152 |       }
      153 | 
    > 154 |       expect(error.toString()).to.be.eq("TypeError: Cannot read property 'uuid' of undefined");
          |                                      ^
      155 |     });
      156 | 
      157 |     it('handle - throws error if the parameter is required, type file provided', async () => {

      at Object.<anonymous> (test/ActionParameterHandler.spec.ts:154:38)

PASS test/functional/controller-methods.spec.ts
    controller methods
      ✓ get should respond with proper status code, headers and body content (23 ms)
      ✓ post respond with proper status code, headers and body content (5 ms)
      ✓ put respond with proper status code, headers and body content (3 ms)
      ✓ patch respond with proper status code, headers and body content (3 ms)
      ✓ delete respond with proper status code, headers and body content (4 ms)
      ✓ head respond with proper status code, headers and body content (3 ms)
      ✓ custom method (post) respond with proper status code, headers and body content (3 ms)
      ✓ custom method (delete) respond with proper status code, headers and body content (5 ms)
      ✓ route should work with parameter (3 ms)
      ✓ route should work with regexp parameter (3 ms)
      ✓ should respond with 404 when regexp does not match (9 ms)
      ✓ route should work with string regexp parameter (3 ms)
      ✓ should respond with 404 when regexp does not match (3 ms)
      ✓ should return result from a promise (503 ms)
      ✓ should respond with 500 if promise failed (517 ms)
      ✓ should respond with 204 No Content when null returned in action (5 ms)
      ✓ should respond with 404 Not Found text when undefined returned in action (21 ms)
      ✓ should respond with 404 Not Found JSON when undefined returned in action (3 ms)
      ✓ should respond with 200 and text/html even in json controller's method (3 ms)
      ✓ should respond with 200 and text/plain even in json controller's method (2 ms)
      ✓ should respond with 401 and text/html when UnauthorizedError throwed even in json controller's method (4 ms)
      ✓ should respond with 401 and aplication/json when UnauthorizedError is thrown in standard json controller's method (2 ms)

PASS test/functional/json-controller-methods.spec.ts
    json-controller methods
      ✓ get should respond with proper status code, headers and body content (11 ms)
      ✓ post respond with proper status code, headers and body content (3 ms)
      ✓ put respond with proper status code, headers and body content (2 ms)
      ✓ patch respond with proper status code, headers and body content (3 ms)
      ✓ delete respond with proper status code, headers and body content (2 ms)
      ✓ head respond with proper status code, headers and body content (3 ms)
      ✓ custom method (post) respond with proper status code, headers and body content (2 ms)
      ✓ custom method (delete) respond with proper status code, headers and body content (2 ms)
      ✓ route should work with parameter (3 ms)
      ✓ route should work with regexp parameter (3 ms)
      ✓ should respond with 404 when regexp does not match (3 ms)
      ✓ route should work with string regexp parameter (6 ms)
      ✓ should respond with 404 when regexp does not match (2 ms)
      ✓ should return result from a promise (503 ms)
      ✓ should respond with 500 if promise failed (505 ms)

PASS test/functional/interceptors.spec.ts
    interceptor
      ✓ custom interceptor function should replace returned content (10 ms)
      ✓ custom interceptor class should replace returned content (3 ms)
      ✓ custom interceptor class used on the whole controller should replace returned content (2 ms)
      ✓ global interceptor class should replace returned content (3 ms)
      ✓ interceptors should support promises (1004 ms)

PASS test/functional/action-params.spec.ts
    ✓ @Req and @Res should be provided as Request and Response objects (11 ms)
    ✓ @Res writing directly to the response should work (3 ms)
    ✓ @Param should give a param from route (3 ms)
    ✓ @Param multiple params should give a proper values from route (2 ms)
    ✓ @SessionParam without middleware (23 ms)
    ✓ @Session should return a value from session (10 ms)
    ✓ @Session(param) should allow to inject empty property (3 ms)
    ✓ @QueryParams should give a proper values from request's query parameters (10 ms)
    ✓ @QueryParams should give a proper values from request's query parameters and one multiple value (6 ms)
    ✓ @QueryParams should give a proper values from request's query with validate whitelist option on (13 ms)
    ✓ @QueryParams should give a proper values from request's query parameters with nested json (4 ms)
    ✓ @QueryParams should not validate request query parameters when it's turned off in validator options (3 ms)
    ✓ @QueryParams should give a proper values from request's optional query parameters (3 ms)
    ✓ @QueryParam should give a proper values from request query parameters (2 ms)
    ✓ @QueryParam should give an array of string with only one query parameter (2 ms)
    ✓ @QueryParam should give an array of string with multiple query parameters (2 ms)
    ✓ @QueryParam should give an array of number with only one query parameter (3 ms)
    ✓ @QueryParam should give an array of number with multiple query parameters (3 ms)
    ✓ @QueryParam should give an array of date with only one query parameter (2 ms)
    ✓ @QueryParam should give an array of date with multiple query parameters (2 ms)
    ✓ @QueryParam when required params must be provided and they should not be empty (8 ms)
    ✓ @QueryParam when the type is Date then it should be parsed (2 ms)
    ✓ @QueryParam when the type is Date and it is invalid then the response should be a BadRequest error (2 ms)
    ✓ @QueryParam when parseJson flag is used query param must be converted to object (2 ms)
    ✓ @HeaderParam should give a proper values from request headers (2 ms)
    ✓ @HeaderParam when required is params must be provided and they should not be empty (2 ms)
    ✓ @HeaderParam should fail with invalid request options (5 ms)
    ✓ @HeaderParam should fail with missing required params (3 ms)
    ✓ for @HeaderParam when parseJson flag is used query param must be converted to object (2 ms)
    ✓ @CookieParam should give a proper values from request headers (2 ms)
    ✓ @CookieParam when required is params must be provided and they should not be empty (4 ms)
    ✓ @CookieParam when parseJson flag is used query param must be converted to object (2 ms)
    ✓ @Body should provide a request body (12 ms)
    ✓ @Body should fail if required body was not provided (7 ms)
    ✓ @Body should provide a json object for json-typed controllers and actions (10 ms)
    ✓ @Body should fail if required body was not provided for json-typed controllers and actions (4 ms)
    ✓ @BodyParam should provide a json object for json-typed controllers and actions (3 ms)
    ✓ @BodyParam should fail if required body was not provided for json-typed controllers and actions (18 ms)
    ✓ @Body using application/x-www-form-urlencoded should handle url encoded form data (4 ms)
    ✓ @UploadedFile using multipart/form-data should provide uploaded file with the given name (12 ms)
    ✓ @UploadedFile with @Body should return both the file and the body (7 ms)
    ✓ @UploadedFile with @BodyParam should return both the file and the body param (4 ms)
    ✓ @UploadedFile with passed uploading options (limit) should throw an error (5 ms)
    ✓ @UploadedFile when required is used files must be provided (7 ms)
    ✓ @UploadedFiles should provide uploaded files with the given name (5 ms)
    ✓ @UploadedFiles with passed uploading options (limit) should throw an error (5 ms)
    ✓ @UploadedFiles when required is used files must be provided (4 ms)

PASS test/functional/express-error-handling.spec.ts
    express error handling
      ✓ should not call global error handler middleware if there was no errors (10 ms)
      ✓ should call global error handler middleware (18 ms)
      ✓ should call global error handler middleware (6 ms)
      ✓ should call error handler middleware if used (3 ms)
      ✓ should not execute next middleware if soft error handled specifically and stopped error bubbling (2 ms)
      ✓ should process JsonErrors by their toJSON method if it exists (2 ms)

PASS test/functional/middlewares-order.spec.ts
    loaded direct from array
      ✓ should call middlewares in order defined by items order (23 ms)
    specified by priority option
      ✓ should call middlewares in order defined by priority parameter of decorator (2 ms)

PASS test/functional/auth-decorator.spec.ts
    Controller responds with value when Authorization succeeds (async)
      ✓ without roles (79 ms)
      ✓ with roles (15 ms)
      ✓ async (25 ms)
    Controller responds with value when Authorization succeeds (sync)
      ✓ without roles (4 ms)
      ✓ with roles (4 ms)
      ✓ async (15 ms)
    Authorized Decorators Http Status Code
      ✓ without roles (22 ms)
      ✓ with roles (3 ms)
    Authorization checker allows to throw (async)
      ✓ custom errors (4 ms)
    Authorization checker allows to throw (sync)
      ✓ custom errors (4 ms)

PASS test/functional/other-controller-decorators.spec.ts
    other controller decorators
      ✓ should return httpCode set by @HttpCode decorator (11 ms)
      ✓ should return custom code when @OnNull (36 ms)
      ✓ should return custom error message and code when @OnUndefined is used with Error class (7 ms)
      ✓ should return custom code when @OnUndefined (9 ms)
      ✓ should return content-type in the response when @ContentType is used (2 ms)
      ✓ should return content-type in the response when @ContentType is used (18 ms)
      ✓ should return response with custom headers when @Header is used (3 ms)
      ✓ should relocate to new location when @Location is used (3 ms)

PASS test/functional/load-from-directory.spec.ts
    loading all controllers from the given directories
      ✓ should load all controllers (36 ms)
    loading all express middlewares and error handlers from the given directories
      ✓ should succeed (14 ms)
      ✓ should fail (18 ms)

PASS test/functional/global-options.spec.ts
    routing-controllers global options
      useClassTransformer default value
        ✓ useClassTransformer by default must be set to true (139 ms)
      when useClassTransformer is set to true
        ✓ useClassTransformer is enabled (24 ms)
      when useClassTransformer is set to false
        ✓ useClassTransformer is disabled (14 ms)
      when routePrefix is used all controller routes should be appended by it
        ✓ routePrefix is enabled (186 ms)

PASS test/functional/controller-options.spec.ts
    controller options
      ✓ controller transform is enabled by default (72 ms)
      ✓ when controller transform is enabled (7 ms)
      ✓ when controller transform is disabled (5 ms)

PASS test/functional/render-decorator.spec.ts
    template rendering
      ✓ should render a template and use given variables (31 ms)
      ✓ should render a template with given variables and locals variables (4 ms)

PASS test/functional/class-validator-options.spec.ts
    no options
      ✓ should not use any options if not set (67 ms)
    global options
      should merge local validation options with global validation options prioritizing local
        ✓ succeed (6 ms)
      should pass the valid param after validation
        ✓ succeed (4 ms)
        ✓ should contain param name on validation failed (17 ms)
    local options
      ✓ should apply local options (5 ms)

PASS test/functional/express-middlewares.spec.ts
    express middlewares
      ✓ should call a global middlewares (24 ms)
      ✓ should use a custom middleware when @UseBefore or @UseAfter is used (3 ms)
      ✓ should call middleware and call it before controller action when @UseBefore is used (3 ms)
      ✓ should call middleware and call it after controller action when @UseAfter is used (2 ms)
      ✓ should call before middleware and call after middleware when @UseAfter and @UseAfter are used (2 ms)
      ✓ should handle errors in custom middlewares (22 ms)

PASS test/functional/container.spec.ts
    using typedi container should be possible
      ✓ typedi container (65 ms)
    using custom container should be possible
      ✓ custom container (6 ms)
    using custom container with fallback should be possible
      ✓ custom container with fallback (9 ms)
    using custom container with fallback and fallback on throw error should be possible
      ✓ custom container with fallback and fallback on throw error (9 ms)

PASS test/unit/controller-inheritance.spec.ts
  controller inheritance
    ✓ should build empty meta for empty set (11 ms)
    ✓ should build meta if the only derivative controller is given (2 ms)
    ✓ should build meta if the only autonomous controller is given
    ✓ should build meta both when autonomous and derivative controllers are given (1 ms)

PASS test/functional/defaults.spec.ts
    defaults
      ✓ should return undefinedResultCode from defaults config for void function (7 ms)
      ✓ should return undefinedResultCode from defaults config for promise void function (2 ms)
      ✓ should return 400 from required paramOptions (16 ms)
      ✓ should return nullResultCode from defaults config (3 ms)
      ✓ should return status code from OnUndefined annotation (2 ms)
      ✓ should mark arg optional from QueryParam annotation (4 ms)

PASS test/functional/controller-base-routes.spec.ts
    controller > base routes functionality
      ✓ get should respond with proper status code, headers and body content (73 ms)
      ✓ get should respond with proper status code, headers and body content (4 ms)
      ✓ get should respond with proper status code, headers and body content - 2nd pass (4 ms)
      ✓ wrong route should respond with 404 error (4 ms)
      ✓ wrong route should respond with 404 error (3 ms)
      ✓ wrong route should respond with 404 error (2 ms)

PASS test/functional/action-options.spec.ts
    ✓ should use controller options when action transform options are not set (36 ms)
    ✓ should override controller options with action transformRequest option (5 ms)
    ✓ should override controller options with action transformResponse option (3 ms)

PASS test/functional/class-transformer-options.spec.ts
    should not use any options if not set
      ✓ technical wrapper (32 ms)
    should apply global options
      ✓ technical wrapper (5 ms)
    should apply local options
      ✓ technical wrapper (4 ms)

PASS test/functional/express-custom-error-handling.spec.ts
    custom express error handling
      ✓ should not call global error handler middleware if there was no errors (24 ms)
      ✓ should call global error handler middleware (19 ms)

PASS test/functional/redirect-decorator.spec.ts
    dynamic redirect
      ✓ using template (28 ms)
      ✓ using override (4 ms)
      ✓ using original (3 ms)

PASS test/functional/special-result-send.spec.ts
    special result value treatment
      ✓ should pipe stream to response (23 ms)
      ✓ should send raw binary data from Buffer (3 ms)
      ✓ should send raw binary data from UIntArray (2 ms)

PASS test/functional/express-global-before-error-handling.spec.ts
    custom express global before middleware error handling
      ✓ should call global error handler middleware with CustomError (39 ms)

PASS test/functional/error-subclasses.spec.ts
  HttpError
    ✓ should be instance of HttpError and Error (3 ms)
  BadRequestError
    ✓ should be instance of BadRequestError, HttpError and Error (1 ms)

Summary of all failing tests
FAIL test/ActionParameterHandler.spec.ts
  ● ActionParameterHandler › negative › handle - throws error if the parameter is required

    Expected value   "TypeError: Cannot read property 'uuid' of undefined"
    Received:
      "TypeError: Cannot read properties of undefined (reading 'uuid')"

    Message:
      expected 'TypeError: Cannot read properties of undefined (reading \'uuid\')' to equal 'TypeError: Cannot read property \'uuid\' of undefined'

    Difference:

    - Expected
    + Received

    - TypeError: Cannot read property 'uuid' of undefined
    + TypeError: Cannot read properties of undefined (reading 'uuid')

      152 |       }
      153 | 
    > 154 |       expect(error.toString()).to.be.eq("TypeError: Cannot read property 'uuid' of undefined");
          |                                      ^
      155 |     });
      156 | 
      157 |     it('handle - throws error if the parameter is required, type file provided', async () => {

      at Object.<anonymous> (test/ActionParameterHandler.spec.ts:154:38)


Test Suites: 1 failed, 25 passed, 26 total
Tests:       1 failed, 181 passed, 182 total
Snapshots:   0 total
Time:        13.404 s
Ran all test suites.
************* run test done *************
routing-controllers is testing ./VariantsDeps/express/variant5/express
/data/js-variants/multee
************* npm unlink module *************
************* npm unlink module done *************
************* npm unlink globally *************
************* npm unlink module done *************
************* npm link globally *************
************* npm link globally done *************
************* npm link module *************
************* npm link module done *************
************* start run test *************
ts-jest[config] (WARN) The option `tsConfig` is deprecated and will be removed in ts-jest 27, use `tsconfig` instead
FAIL test/ActionParameterHandler.spec.ts
  ActionParameterHandler
    positive
      ✓ handle - should process string parameters (28 ms)
      ✓ handle - should process string parameters, returns empty if a given string is empty (1 ms)
      ✓ handle - should process number parameters
      ✓ handle - undefined on empty object provided (1 ms)
      ✓ handle - null provided (19 ms)
    negative
      ✕ handle - throws error if the parameter is required (7 ms)
      ✓ handle - throws error if the parameter is required, type file provided (1 ms)

  ● ActionParameterHandler › negative › handle - throws error if the parameter is required

    Expected value   "TypeError: Cannot read property 'uuid' of undefined"
    Received:
      "TypeError: Cannot read properties of undefined (reading 'uuid')"

    Message:
      expected 'TypeError: Cannot read properties of undefined (reading \'uuid\')' to equal 'TypeError: Cannot read property \'uuid\' of undefined'

    Difference:

    - Expected
    + Received

    - TypeError: Cannot read property 'uuid' of undefined
    + TypeError: Cannot read properties of undefined (reading 'uuid')

      152 |       }
      153 | 
    > 154 |       expect(error.toString()).to.be.eq("TypeError: Cannot read property 'uuid' of undefined");
          |                                      ^
      155 |     });
      156 | 
      157 |     it('handle - throws error if the parameter is required, type file provided', async () => {

      at Object.<anonymous> (test/ActionParameterHandler.spec.ts:154:38)

PASS test/functional/controller-methods.spec.ts
    controller methods
      ✓ get should respond with proper status code, headers and body content (20 ms)
      ✓ post respond with proper status code, headers and body content (5 ms)
      ✓ put respond with proper status code, headers and body content (3 ms)
      ✓ patch respond with proper status code, headers and body content (3 ms)
      ✓ delete respond with proper status code, headers and body content (3 ms)
      ✓ head respond with proper status code, headers and body content (2 ms)
      ✓ custom method (post) respond with proper status code, headers and body content (3 ms)
      ✓ custom method (delete) respond with proper status code, headers and body content (2 ms)
      ✓ route should work with parameter (3 ms)
      ✓ route should work with regexp parameter (2 ms)
      ✓ should respond with 404 when regexp does not match (5 ms)
      ✓ route should work with string regexp parameter (3 ms)
      ✓ should respond with 404 when regexp does not match (2 ms)
      ✓ should return result from a promise (504 ms)
      ✓ should respond with 500 if promise failed (505 ms)
      ✓ should respond with 204 No Content when null returned in action (5 ms)
      ✓ should respond with 404 Not Found text when undefined returned in action (32 ms)
      ✓ should respond with 404 Not Found JSON when undefined returned in action (3 ms)
      ✓ should respond with 200 and text/html even in json controller's method (3 ms)
      ✓ should respond with 200 and text/plain even in json controller's method (1 ms)
      ✓ should respond with 401 and text/html when UnauthorizedError throwed even in json controller's method (4 ms)
      ✓ should respond with 401 and aplication/json when UnauthorizedError is thrown in standard json controller's method (2 ms)

PASS test/functional/json-controller-methods.spec.ts
    json-controller methods
      ✓ get should respond with proper status code, headers and body content (11 ms)
      ✓ post respond with proper status code, headers and body content (3 ms)
      ✓ put respond with proper status code, headers and body content (2 ms)
      ✓ patch respond with proper status code, headers and body content (2 ms)
      ✓ delete respond with proper status code, headers and body content (3 ms)
      ✓ head respond with proper status code, headers and body content (2 ms)
      ✓ custom method (post) respond with proper status code, headers and body content (2 ms)
      ✓ custom method (delete) respond with proper status code, headers and body content (2 ms)
      ✓ route should work with parameter (2 ms)
      ✓ route should work with regexp parameter (3 ms)
      ✓ should respond with 404 when regexp does not match (4 ms)
      ✓ route should work with string regexp parameter (3 ms)
      ✓ should respond with 404 when regexp does not match (2 ms)
      ✓ should return result from a promise (504 ms)
      ✓ should respond with 500 if promise failed (505 ms)

PASS test/functional/interceptors.spec.ts
    interceptor
      ✓ custom interceptor function should replace returned content (9 ms)
      ✓ custom interceptor class should replace returned content (4 ms)
      ✓ custom interceptor class used on the whole controller should replace returned content (2 ms)
      ✓ global interceptor class should replace returned content (3 ms)
      ✓ interceptors should support promises (1004 ms)

PASS test/functional/action-params.spec.ts
    ✓ @Req and @Res should be provided as Request and Response objects (10 ms)
    ✓ @Res writing directly to the response should work (4 ms)
    ✓ @Param should give a param from route (3 ms)
    ✓ @Param multiple params should give a proper values from route (3 ms)
    ✓ @SessionParam without middleware (23 ms)
    ✓ @Session should return a value from session (10 ms)
    ✓ @Session(param) should allow to inject empty property (3 ms)
    ✓ @QueryParams should give a proper values from request's query parameters (10 ms)
    ✓ @QueryParams should give a proper values from request's query parameters and one multiple value (6 ms)
    ✓ @QueryParams should give a proper values from request's query with validate whitelist option on (3 ms)
    ✓ @QueryParams should give a proper values from request's query parameters with nested json (4 ms)
    ✓ @QueryParams should not validate request query parameters when it's turned off in validator options (12 ms)
    ✓ @QueryParams should give a proper values from request's optional query parameters (3 ms)
    ✓ @QueryParam should give a proper values from request query parameters (2 ms)
    ✓ @QueryParam should give an array of string with only one query parameter (2 ms)
    ✓ @QueryParam should give an array of string with multiple query parameters (3 ms)
    ✓ @QueryParam should give an array of number with only one query parameter (3 ms)
    ✓ @QueryParam should give an array of number with multiple query parameters (2 ms)
    ✓ @QueryParam should give an array of date with only one query parameter (2 ms)
    ✓ @QueryParam should give an array of date with multiple query parameters (2 ms)
    ✓ @QueryParam when required params must be provided and they should not be empty (8 ms)
    ✓ @QueryParam when the type is Date then it should be parsed (2 ms)
    ✓ @QueryParam when the type is Date and it is invalid then the response should be a BadRequest error (2 ms)
    ✓ @QueryParam when parseJson flag is used query param must be converted to object (2 ms)
    ✓ @HeaderParam should give a proper values from request headers (2 ms)
    ✓ @HeaderParam when required is params must be provided and they should not be empty (2 ms)
    ✓ @HeaderParam should fail with invalid request options (5 ms)
    ✓ @HeaderParam should fail with missing required params (3 ms)
    ✓ for @HeaderParam when parseJson flag is used query param must be converted to object (2 ms)
    ✓ @CookieParam should give a proper values from request headers (2 ms)
    ✓ @CookieParam when required is params must be provided and they should not be empty (3 ms)
    ✓ @CookieParam when parseJson flag is used query param must be converted to object (1 ms)
    ✓ @Body should provide a request body (12 ms)
    ✓ @Body should fail if required body was not provided (7 ms)
    ✓ @Body should provide a json object for json-typed controllers and actions (2 ms)
    ✓ @Body should fail if required body was not provided for json-typed controllers and actions (4 ms)
    ✓ @BodyParam should provide a json object for json-typed controllers and actions (3 ms)
    ✓ @BodyParam should fail if required body was not provided for json-typed controllers and actions (21 ms)
    ✓ @Body using application/x-www-form-urlencoded should handle url encoded form data (4 ms)
    ✓ @UploadedFile using multipart/form-data should provide uploaded file with the given name (12 ms)
    ✓ @UploadedFile with @Body should return both the file and the body (6 ms)
    ✓ @UploadedFile with @BodyParam should return both the file and the body param (4 ms)
    ✓ @UploadedFile with passed uploading options (limit) should throw an error (5 ms)
    ✓ @UploadedFile when required is used files must be provided (6 ms)
    ✓ @UploadedFiles should provide uploaded files with the given name (5 ms)
    ✓ @UploadedFiles with passed uploading options (limit) should throw an error (5 ms)
    ✓ @UploadedFiles when required is used files must be provided (5 ms)

PASS test/functional/global-options.spec.ts
    routing-controllers global options
      useClassTransformer default value
        ✓ useClassTransformer by default must be set to true (87 ms)
      when useClassTransformer is set to true
        ✓ useClassTransformer is enabled (4 ms)
      when useClassTransformer is set to false
        ✓ useClassTransformer is disabled (4 ms)
      when routePrefix is used all controller routes should be appended by it
        ✓ routePrefix is enabled (6 ms)

PASS test/functional/auth-decorator.spec.ts
    Controller responds with value when Authorization succeeds (async)
      ✓ without roles (75 ms)
      ✓ with roles (15 ms)
      ✓ async (24 ms)
    Controller responds with value when Authorization succeeds (sync)
      ✓ without roles (4 ms)
      ✓ with roles (3 ms)
      ✓ async (13 ms)
    Authorized Decorators Http Status Code
      ✓ without roles (20 ms)
      ✓ with roles (5 ms)
    Authorization checker allows to throw (async)
      ✓ custom errors (7 ms)
    Authorization checker allows to throw (sync)
      ✓ custom errors (8 ms)

PASS test/functional/controller-options.spec.ts
    controller options
      ✓ controller transform is enabled by default (72 ms)
      ✓ when controller transform is enabled (6 ms)
      ✓ when controller transform is disabled (3 ms)

PASS test/functional/other-controller-decorators.spec.ts
    other controller decorators
      ✓ should return httpCode set by @HttpCode decorator (27 ms)
      ✓ should return custom code when @OnNull (32 ms)
      ✓ should return custom error message and code when @OnUndefined is used with Error class (7 ms)
      ✓ should return custom code when @OnUndefined (9 ms)
      ✓ should return content-type in the response when @ContentType is used (2 ms)
      ✓ should return content-type in the response when @ContentType is used (2 ms)
      ✓ should return response with custom headers when @Header is used (3 ms)
      ✓ should relocate to new location when @Location is used (3 ms)

PASS test/functional/load-from-directory.spec.ts
    loading all controllers from the given directories
      ✓ should load all controllers (19 ms)
    loading all express middlewares and error handlers from the given directories
      ✓ should succeed (8 ms)
      ✓ should fail (17 ms)

PASS test/functional/render-decorator.spec.ts
    template rendering
      ✓ should render a template and use given variables (80 ms)
      ✓ should render a template with given variables and locals variables (34 ms)

PASS test/functional/controller-base-routes.spec.ts
    controller > base routes functionality
      ✓ get should respond with proper status code, headers and body content (63 ms)
      ✓ get should respond with proper status code, headers and body content (4 ms)
      ✓ get should respond with proper status code, headers and body content - 2nd pass (4 ms)
      ✓ wrong route should respond with 404 error (4 ms)
      ✓ wrong route should respond with 404 error (3 ms)
      ✓ wrong route should respond with 404 error (4 ms)

PASS test/functional/class-validator-options.spec.ts
    no options
      ✓ should not use any options if not set (64 ms)
    global options
      should merge local validation options with global validation options prioritizing local
        ✓ succeed (6 ms)
      should pass the valid param after validation
        ✓ succeed (4 ms)
        ✓ should contain param name on validation failed (16 ms)
    local options
      ✓ should apply local options (5 ms)

PASS test/functional/container.spec.ts
    using typedi container should be possible
      ✓ typedi container (66 ms)
    using custom container should be possible
      ✓ custom container (5 ms)
    using custom container with fallback should be possible
      ✓ custom container with fallback (8 ms)
    using custom container with fallback and fallback on throw error should be possible
      ✓ custom container with fallback and fallback on throw error (8 ms)

PASS test/functional/defaults.spec.ts
    defaults
      ✓ should return undefinedResultCode from defaults config for void function (8 ms)
      ✓ should return undefinedResultCode from defaults config for promise void function (2 ms)
      ✓ should return 400 from required paramOptions (17 ms)
      ✓ should return nullResultCode from defaults config (3 ms)
      ✓ should return status code from OnUndefined annotation (3 ms)
      ✓ should mark arg optional from QueryParam annotation (4 ms)

PASS test/unit/controller-inheritance.spec.ts
  controller inheritance
    ✓ should build empty meta for empty set (11 ms)
    ✓ should build meta if the only derivative controller is given (2 ms)
    ✓ should build meta if the only autonomous controller is given
    ✓ should build meta both when autonomous and derivative controllers are given (1 ms)

PASS test/functional/express-middlewares.spec.ts
    express middlewares
      ✓ should call a global middlewares (9 ms)
      ✓ should use a custom middleware when @UseBefore or @UseAfter is used (3 ms)
      ✓ should call middleware and call it before controller action when @UseBefore is used (3 ms)
      ✓ should call middleware and call it after controller action when @UseAfter is used (2 ms)
      ✓ should call before middleware and call after middleware when @UseAfter and @UseAfter are used (2 ms)
      ✓ should handle errors in custom middlewares (23 ms)

PASS test/functional/express-error-handling.spec.ts
    express error handling
      ✓ should not call global error handler middleware if there was no errors (10 ms)
      ✓ should call global error handler middleware (21 ms)
      ✓ should call global error handler middleware (5 ms)
      ✓ should call error handler middleware if used (3 ms)
      ✓ should not execute next middleware if soft error handled specifically and stopped error bubbling (2 ms)
      ✓ should process JsonErrors by their toJSON method if it exists (3 ms)

PASS test/functional/action-options.spec.ts
    ✓ should use controller options when action transform options are not set (20 ms)
    ✓ should override controller options with action transformRequest option (5 ms)
    ✓ should override controller options with action transformResponse option (3 ms)

PASS test/functional/class-transformer-options.spec.ts
    should not use any options if not set
      ✓ technical wrapper (17 ms)
    should apply global options
      ✓ technical wrapper (5 ms)
    should apply local options
      ✓ technical wrapper (4 ms)

PASS test/functional/express-custom-error-handling.spec.ts
    custom express error handling
      ✓ should not call global error handler middleware if there was no errors (25 ms)
      ✓ should call global error handler middleware (19 ms)

PASS test/functional/redirect-decorator.spec.ts
    dynamic redirect
      ✓ using template (49 ms)
      ✓ using override (7 ms)
      ✓ using original (6 ms)

PASS test/functional/middlewares-order.spec.ts
    loaded direct from array
      ✓ should call middlewares in order defined by items order (24 ms)
    specified by priority option
      ✓ should call middlewares in order defined by priority parameter of decorator (3 ms)

PASS test/functional/express-global-before-error-handling.spec.ts
    custom express global before middleware error handling
      ✓ should call global error handler middleware with CustomError (39 ms)

PASS test/functional/special-result-send.spec.ts
    special result value treatment
      ✓ should pipe stream to response (24 ms)
      ✓ should send raw binary data from Buffer (4 ms)
      ✓ should send raw binary data from UIntArray (2 ms)

PASS test/functional/error-subclasses.spec.ts
  HttpError
    ✓ should be instance of HttpError and Error (3 ms)
  BadRequestError
    ✓ should be instance of BadRequestError, HttpError and Error (2 ms)

Summary of all failing tests
FAIL test/ActionParameterHandler.spec.ts
  ● ActionParameterHandler › negative › handle - throws error if the parameter is required

    Expected value   "TypeError: Cannot read property 'uuid' of undefined"
    Received:
      "TypeError: Cannot read properties of undefined (reading 'uuid')"

    Message:
      expected 'TypeError: Cannot read properties of undefined (reading \'uuid\')' to equal 'TypeError: Cannot read property \'uuid\' of undefined'

    Difference:

    - Expected
    + Received

    - TypeError: Cannot read property 'uuid' of undefined
    + TypeError: Cannot read properties of undefined (reading 'uuid')

      152 |       }
      153 | 
    > 154 |       expect(error.toString()).to.be.eq("TypeError: Cannot read property 'uuid' of undefined");
          |                                      ^
      155 |     });
      156 | 
      157 |     it('handle - throws error if the parameter is required, type file provided', async () => {

      at Object.<anonymous> (test/ActionParameterHandler.spec.ts:154:38)


Test Suites: 1 failed, 25 passed, 26 total
Tests:       1 failed, 181 passed, 182 total
Snapshots:   0 total
Time:        13.131 s, estimated 14 s
Ran all test suites.
************* run test done *************
routing-controllers is testing ./VariantsDeps/express/variant4/express
/data/js-variants/multee
************* npm unlink module *************
************* npm unlink module done *************
************* npm unlink globally *************
************* npm unlink module done *************
************* npm link globally *************
************* npm link globally done *************
************* npm link module *************
************* npm link module done *************
************* start run test *************
ts-jest[config] (WARN) The option `tsConfig` is deprecated and will be removed in ts-jest 27, use `tsconfig` instead
FAIL test/ActionParameterHandler.spec.ts
  ActionParameterHandler
    positive
      ✓ handle - should process string parameters (36 ms)
      ✓ handle - should process string parameters, returns empty if a given string is empty
      ✓ handle - should process number parameters (1 ms)
      ✓ handle - undefined on empty object provided
      ✓ handle - null provided (11 ms)
    negative
      ✕ handle - throws error if the parameter is required (7 ms)
      ✓ handle - throws error if the parameter is required, type file provided (1 ms)

  ● ActionParameterHandler › negative › handle - throws error if the parameter is required

    Expected value   "TypeError: Cannot read property 'uuid' of undefined"
    Received:
      "TypeError: Cannot read properties of undefined (reading 'uuid')"

    Message:
      expected 'TypeError: Cannot read properties of undefined (reading \'uuid\')' to equal 'TypeError: Cannot read property \'uuid\' of undefined'

    Difference:

    - Expected
    + Received

    - TypeError: Cannot read property 'uuid' of undefined
    + TypeError: Cannot read properties of undefined (reading 'uuid')

      152 |       }
      153 | 
    > 154 |       expect(error.toString()).to.be.eq("TypeError: Cannot read property 'uuid' of undefined");
          |                                      ^
      155 |     });
      156 | 
      157 |     it('handle - throws error if the parameter is required, type file provided', async () => {

      at Object.<anonymous> (test/ActionParameterHandler.spec.ts:154:38)

PASS test/functional/controller-methods.spec.ts
    controller methods
      ✓ get should respond with proper status code, headers and body content (21 ms)
      ✓ post respond with proper status code, headers and body content (5 ms)
      ✓ put respond with proper status code, headers and body content (4 ms)
      ✓ patch respond with proper status code, headers and body content (3 ms)
      ✓ delete respond with proper status code, headers and body content (3 ms)
      ✓ head respond with proper status code, headers and body content (2 ms)
      ✓ custom method (post) respond with proper status code, headers and body content (2 ms)
      ✓ custom method (delete) respond with proper status code, headers and body content (3 ms)
      ✓ route should work with parameter (3 ms)
      ✓ route should work with regexp parameter (3 ms)
      ✓ should respond with 404 when regexp does not match (4 ms)
      ✓ route should work with string regexp parameter (2 ms)
      ✓ should respond with 404 when regexp does not match (2 ms)
      ✓ should return result from a promise (517 ms)
      ✓ should respond with 500 if promise failed (505 ms)
      ✓ should respond with 204 No Content when null returned in action (5 ms)
      ✓ should respond with 404 Not Found text when undefined returned in action (21 ms)
      ✓ should respond with 404 Not Found JSON when undefined returned in action (3 ms)
      ✓ should respond with 200 and text/html even in json controller's method (2 ms)
      ✓ should respond with 200 and text/plain even in json controller's method (2 ms)
      ✓ should respond with 401 and text/html when UnauthorizedError throwed even in json controller's method (5 ms)
      ✓ should respond with 401 and aplication/json when UnauthorizedError is thrown in standard json controller's method (2 ms)

PASS test/functional/json-controller-methods.spec.ts
    json-controller methods
      ✓ get should respond with proper status code, headers and body content (11 ms)
      ✓ post respond with proper status code, headers and body content (3 ms)
      ✓ put respond with proper status code, headers and body content (2 ms)
      ✓ patch respond with proper status code, headers and body content (2 ms)
      ✓ delete respond with proper status code, headers and body content (3 ms)
      ✓ head respond with proper status code, headers and body content (2 ms)
      ✓ custom method (post) respond with proper status code, headers and body content (2 ms)
      ✓ custom method (delete) respond with proper status code, headers and body content (2 ms)
      ✓ route should work with parameter (3 ms)
      ✓ route should work with regexp parameter (3 ms)
      ✓ should respond with 404 when regexp does not match (4 ms)
      ✓ route should work with string regexp parameter (3 ms)
      ✓ should respond with 404 when regexp does not match (2 ms)
      ✓ should return result from a promise (504 ms)
      ✓ should respond with 500 if promise failed (505 ms)

PASS test/functional/interceptors.spec.ts
    interceptor
      ✓ custom interceptor function should replace returned content (9 ms)
      ✓ custom interceptor class should replace returned content (3 ms)
      ✓ custom interceptor class used on the whole controller should replace returned content (3 ms)
      ✓ global interceptor class should replace returned content (2 ms)
      ✓ interceptors should support promises (1005 ms)

PASS test/functional/action-params.spec.ts
    ✓ @Req and @Res should be provided as Request and Response objects (11 ms)
    ✓ @Res writing directly to the response should work (4 ms)
    ✓ @Param should give a param from route (3 ms)
    ✓ @Param multiple params should give a proper values from route (2 ms)
    ✓ @SessionParam without middleware (23 ms)
    ✓ @Session should return a value from session (11 ms)
    ✓ @Session(param) should allow to inject empty property (3 ms)
    ✓ @QueryParams should give a proper values from request's query parameters (9 ms)
    ✓ @QueryParams should give a proper values from request's query parameters and one multiple value (16 ms)
    ✓ @QueryParams should give a proper values from request's query with validate whitelist option on (3 ms)
    ✓ @QueryParams should give a proper values from request's query parameters with nested json (5 ms)
    ✓ @QueryParams should not validate request query parameters when it's turned off in validator options (2 ms)
    ✓ @QueryParams should give a proper values from request's optional query parameters (3 ms)
    ✓ @QueryParam should give a proper values from request query parameters (2 ms)
    ✓ @QueryParam should give an array of string with only one query parameter (2 ms)
    ✓ @QueryParam should give an array of string with multiple query parameters (2 ms)
    ✓ @QueryParam should give an array of number with only one query parameter (3 ms)
    ✓ @QueryParam should give an array of number with multiple query parameters (3 ms)
    ✓ @QueryParam should give an array of date with only one query parameter (2 ms)
    ✓ @QueryParam should give an array of date with multiple query parameters (2 ms)
    ✓ @QueryParam when required params must be provided and they should not be empty (8 ms)
    ✓ @QueryParam when the type is Date then it should be parsed (2 ms)
    ✓ @QueryParam when the type is Date and it is invalid then the response should be a BadRequest error (2 ms)
    ✓ @QueryParam when parseJson flag is used query param must be converted to object (2 ms)
    ✓ @HeaderParam should give a proper values from request headers (2 ms)
    ✓ @HeaderParam when required is params must be provided and they should not be empty (1 ms)
    ✓ @HeaderParam should fail with invalid request options (2 ms)
    ✓ @HeaderParam should fail with missing required params (3 ms)
    ✓ for @HeaderParam when parseJson flag is used query param must be converted to object (3 ms)
    ✓ @CookieParam should give a proper values from request headers (3 ms)
    ✓ @CookieParam when required is params must be provided and they should not be empty (5 ms)
    ✓ @CookieParam when parseJson flag is used query param must be converted to object (2 ms)
    ✓ @Body should provide a request body (12 ms)
    ✓ @Body should fail if required body was not provided (11 ms)
    ✓ @Body should provide a json object for json-typed controllers and actions (3 ms)
    ✓ @Body should fail if required body was not provided for json-typed controllers and actions (4 ms)
    ✓ @BodyParam should provide a json object for json-typed controllers and actions (3 ms)
    ✓ @BodyParam should fail if required body was not provided for json-typed controllers and actions (17 ms)
    ✓ @Body using application/x-www-form-urlencoded should handle url encoded form data (4 ms)
    ✓ @UploadedFile using multipart/form-data should provide uploaded file with the given name (12 ms)
    ✓ @UploadedFile with @Body should return both the file and the body (6 ms)
    ✓ @UploadedFile with @BodyParam should return both the file and the body param (5 ms)
    ✓ @UploadedFile with passed uploading options (limit) should throw an error (5 ms)
    ✓ @UploadedFile when required is used files must be provided (7 ms)
    ✓ @UploadedFiles should provide uploaded files with the given name (4 ms)
    ✓ @UploadedFiles with passed uploading options (limit) should throw an error (8 ms)
    ✓ @UploadedFiles when required is used files must be provided (4 ms)

PASS test/functional/auth-decorator.spec.ts
    Controller responds with value when Authorization succeeds (async)
      ✓ without roles (95 ms)
      ✓ with roles (15 ms)
      ✓ async (24 ms)
    Controller responds with value when Authorization succeeds (sync)
      ✓ without roles (4 ms)
      ✓ with roles (4 ms)
      ✓ async (13 ms)
    Authorized Decorators Http Status Code
      ✓ without roles (23 ms)
      ✓ with roles (3 ms)
    Authorization checker allows to throw (async)
      ✓ custom errors (5 ms)
    Authorization checker allows to throw (sync)
      ✓ custom errors (3 ms)

PASS test/functional/render-decorator.spec.ts
    template rendering
      ✓ should render a template and use given variables (14 ms)
      ✓ should render a template with given variables and locals variables (4 ms)

PASS test/functional/load-from-directory.spec.ts
    loading all controllers from the given directories
      ✓ should load all controllers (26 ms)
    loading all express middlewares and error handlers from the given directories
      ✓ should succeed (14 ms)
      ✓ should fail (36 ms)

PASS test/functional/other-controller-decorators.spec.ts
    other controller decorators
      ✓ should return httpCode set by @HttpCode decorator (30 ms)
      ✓ should return custom code when @OnNull (31 ms)
      ✓ should return custom error message and code when @OnUndefined is used with Error class (7 ms)
      ✓ should return custom code when @OnUndefined (9 ms)
      ✓ should return content-type in the response when @ContentType is used (2 ms)
      ✓ should return content-type in the response when @ContentType is used (2 ms)
      ✓ should return response with custom headers when @Header is used (3 ms)
      ✓ should relocate to new location when @Location is used (2 ms)

PASS test/functional/controller-options.spec.ts
    controller options
      ✓ controller transform is enabled by default (64 ms)
      ✓ when controller transform is enabled (5 ms)
      ✓ when controller transform is disabled (4 ms)

PASS test/functional/controller-base-routes.spec.ts
    controller > base routes functionality
      ✓ get should respond with proper status code, headers and body content (85 ms)
      ✓ get should respond with proper status code, headers and body content (16 ms)
      ✓ get should respond with proper status code, headers and body content - 2nd pass (31 ms)
      ✓ wrong route should respond with 404 error (20 ms)
      ✓ wrong route should respond with 404 error (14 ms)
      ✓ wrong route should respond with 404 error (41 ms)

PASS test/unit/controller-inheritance.spec.ts
  controller inheritance
    ✓ should build empty meta for empty set (34 ms)
    ✓ should build meta if the only derivative controller is given (2 ms)
    ✓ should build meta if the only autonomous controller is given (1 ms)
    ✓ should build meta both when autonomous and derivative controllers are given

PASS test/functional/express-error-handling.spec.ts
    express error handling
      ✓ should not call global error handler middleware if there was no errors (24 ms)
      ✓ should call global error handler middleware (14 ms)
      ✓ should call global error handler middleware (5 ms)
      ✓ should call error handler middleware if used (4 ms)
      ✓ should not execute next middleware if soft error handled specifically and stopped error bubbling (4 ms)
      ✓ should process JsonErrors by their toJSON method if it exists (7 ms)

PASS test/functional/class-validator-options.spec.ts
    no options
      ✓ should not use any options if not set (62 ms)
    global options
      should merge local validation options with global validation options prioritizing local
        ✓ succeed (6 ms)
      should pass the valid param after validation
        ✓ succeed (4 ms)
        ✓ should contain param name on validation failed (16 ms)
    local options
      ✓ should apply local options (6 ms)

PASS test/functional/global-options.spec.ts
    routing-controllers global options
      useClassTransformer default value
        ✓ useClassTransformer by default must be set to true (80 ms)
      when useClassTransformer is set to true
        ✓ useClassTransformer is enabled (4 ms)
      when useClassTransformer is set to false
        ✓ useClassTransformer is disabled (4 ms)
      when routePrefix is used all controller routes should be appended by it
        ✓ routePrefix is enabled (6 ms)

PASS test/functional/redirect-decorator.spec.ts
    dynamic redirect
      ✓ using template (26 ms)
      ✓ using override (3 ms)
      ✓ using original (4 ms)

PASS test/functional/container.spec.ts
    using typedi container should be possible
      ✓ typedi container (69 ms)
    using custom container should be possible
      ✓ custom container (6 ms)
    using custom container with fallback should be possible
      ✓ custom container with fallback (9 ms)
    using custom container with fallback and fallback on throw error should be possible
      ✓ custom container with fallback and fallback on throw error (9 ms)

PASS test/functional/express-middlewares.spec.ts
    express middlewares
      ✓ should call a global middlewares (25 ms)
      ✓ should use a custom middleware when @UseBefore or @UseAfter is used (3 ms)
      ✓ should call middleware and call it before controller action when @UseBefore is used (2 ms)
      ✓ should call middleware and call it after controller action when @UseAfter is used (3 ms)
      ✓ should call before middleware and call after middleware when @UseAfter and @UseAfter are used (2 ms)
      ✓ should handle errors in custom middlewares (20 ms)

PASS test/functional/action-options.spec.ts
    ✓ should use controller options when action transform options are not set (36 ms)
    ✓ should override controller options with action transformRequest option (6 ms)
    ✓ should override controller options with action transformResponse option (2 ms)

PASS test/functional/middlewares-order.spec.ts
    loaded direct from array
      ✓ should call middlewares in order defined by items order (24 ms)
    specified by priority option
      ✓ should call middlewares in order defined by priority parameter of decorator (3 ms)

PASS test/functional/class-transformer-options.spec.ts
    should not use any options if not set
      ✓ technical wrapper (32 ms)
    should apply global options
      ✓ technical wrapper (5 ms)
    should apply local options
      ✓ technical wrapper (4 ms)

PASS test/functional/defaults.spec.ts
    defaults
      ✓ should return undefinedResultCode from defaults config for void function (22 ms)
      ✓ should return undefinedResultCode from defaults config for promise void function (2 ms)
      ✓ should return 400 from required paramOptions (16 ms)
      ✓ should return nullResultCode from defaults config (3 ms)
      ✓ should return status code from OnUndefined annotation (3 ms)
      ✓ should mark arg optional from QueryParam annotation (4 ms)

PASS test/functional/express-custom-error-handling.spec.ts
    custom express error handling
      ✓ should not call global error handler middleware if there was no errors (25 ms)
      ✓ should call global error handler middleware (20 ms)

PASS test/functional/express-global-before-error-handling.spec.ts
    custom express global before middleware error handling
      ✓ should call global error handler middleware with CustomError (39 ms)

PASS test/functional/special-result-send.spec.ts
    special result value treatment
      ✓ should pipe stream to response (23 ms)
      ✓ should send raw binary data from Buffer (4 ms)
      ✓ should send raw binary data from UIntArray (2 ms)

PASS test/functional/error-subclasses.spec.ts
  HttpError
    ✓ should be instance of HttpError and Error (3 ms)
  BadRequestError
    ✓ should be instance of BadRequestError, HttpError and Error (1 ms)

Summary of all failing tests
FAIL test/ActionParameterHandler.spec.ts
  ● ActionParameterHandler › negative › handle - throws error if the parameter is required

    Expected value   "TypeError: Cannot read property 'uuid' of undefined"
    Received:
      "TypeError: Cannot read properties of undefined (reading 'uuid')"

    Message:
      expected 'TypeError: Cannot read properties of undefined (reading \'uuid\')' to equal 'TypeError: Cannot read property \'uuid\' of undefined'

    Difference:

    - Expected
    + Received

    - TypeError: Cannot read property 'uuid' of undefined
    + TypeError: Cannot read properties of undefined (reading 'uuid')

      152 |       }
      153 | 
    > 154 |       expect(error.toString()).to.be.eq("TypeError: Cannot read property 'uuid' of undefined");
          |                                      ^
      155 |     });
      156 | 
      157 |     it('handle - throws error if the parameter is required, type file provided', async () => {

      at Object.<anonymous> (test/ActionParameterHandler.spec.ts:154:38)


Test Suites: 1 failed, 25 passed, 26 total
Tests:       1 failed, 181 passed, 182 total
Snapshots:   0 total
Time:        13.136 s
Ran all test suites.
************* run test done *************
routing-controllers is testing ./VariantsDeps/express/variant3/express
/data/js-variants/multee
************* npm unlink module *************
************* npm unlink module done *************
************* npm unlink globally *************
************* npm unlink module done *************
************* npm link globally *************
************* npm link globally done *************
************* npm link module *************
************* npm link module done *************
************* start run test *************
ts-jest[config] (WARN) The option `tsConfig` is deprecated and will be removed in ts-jest 27, use `tsconfig` instead
FAIL test/ActionParameterHandler.spec.ts
  ActionParameterHandler
    positive
      ✓ handle - should process string parameters (45 ms)
      ✓ handle - should process string parameters, returns empty if a given string is empty
      ✓ handle - should process number parameters (1 ms)
      ✓ handle - undefined on empty object provided (1 ms)
      ✓ handle - null provided (13 ms)
    negative
      ✕ handle - throws error if the parameter is required (7 ms)
      ✓ handle - throws error if the parameter is required, type file provided (1 ms)

  ● ActionParameterHandler › negative › handle - throws error if the parameter is required

    Expected value   "TypeError: Cannot read property 'uuid' of undefined"
    Received:
      "TypeError: Cannot read properties of undefined (reading 'uuid')"

    Message:
      expected 'TypeError: Cannot read properties of undefined (reading \'uuid\')' to equal 'TypeError: Cannot read property \'uuid\' of undefined'

    Difference:

    - Expected
    + Received

    - TypeError: Cannot read property 'uuid' of undefined
    + TypeError: Cannot read properties of undefined (reading 'uuid')

      152 |       }
      153 | 
    > 154 |       expect(error.toString()).to.be.eq("TypeError: Cannot read property 'uuid' of undefined");
          |                                      ^
      155 |     });
      156 | 
      157 |     it('handle - throws error if the parameter is required, type file provided', async () => {

      at Object.<anonymous> (test/ActionParameterHandler.spec.ts:154:38)

PASS test/functional/controller-methods.spec.ts
    controller methods
      ✓ get should respond with proper status code, headers and body content (21 ms)
      ✓ post respond with proper status code, headers and body content (4 ms)
      ✓ put respond with proper status code, headers and body content (3 ms)
      ✓ patch respond with proper status code, headers and body content (3 ms)
      ✓ delete respond with proper status code, headers and body content (3 ms)
      ✓ head respond with proper status code, headers and body content (2 ms)
      ✓ custom method (post) respond with proper status code, headers and body content (3 ms)
      ✓ custom method (delete) respond with proper status code, headers and body content (3 ms)
      ✓ route should work with parameter (3 ms)
      ✓ route should work with regexp parameter (3 ms)
      ✓ should respond with 404 when regexp does not match (4 ms)
      ✓ route should work with string regexp parameter (3 ms)
      ✓ should respond with 404 when regexp does not match (3 ms)
      ✓ should return result from a promise (504 ms)
      ✓ should respond with 500 if promise failed (505 ms)
      ✓ should respond with 204 No Content when null returned in action (6 ms)
      ✓ should respond with 404 Not Found text when undefined returned in action (30 ms)
      ✓ should respond with 404 Not Found JSON when undefined returned in action (4 ms)
      ✓ should respond with 200 and text/html even in json controller's method (2 ms)
      ✓ should respond with 200 and text/plain even in json controller's method (2 ms)
      ✓ should respond with 401 and text/html when UnauthorizedError throwed even in json controller's method (5 ms)
      ✓ should respond with 401 and aplication/json when UnauthorizedError is thrown in standard json controller's method (2 ms)

PASS test/functional/json-controller-methods.spec.ts
    json-controller methods
      ✓ get should respond with proper status code, headers and body content (10 ms)
      ✓ post respond with proper status code, headers and body content (2 ms)
      ✓ put respond with proper status code, headers and body content (2 ms)
      ✓ patch respond with proper status code, headers and body content (3 ms)
      ✓ delete respond with proper status code, headers and body content (2 ms)
      ✓ head respond with proper status code, headers and body content (2 ms)
      ✓ custom method (post) respond with proper status code, headers and body content (3 ms)
      ✓ custom method (delete) respond with proper status code, headers and body content (2 ms)
      ✓ route should work with parameter (3 ms)
      ✓ route should work with regexp parameter (2 ms)
      ✓ should respond with 404 when regexp does not match (4 ms)
      ✓ route should work with string regexp parameter (3 ms)
      ✓ should respond with 404 when regexp does not match (2 ms)
      ✓ should return result from a promise (504 ms)
      ✓ should respond with 500 if promise failed (504 ms)

PASS test/functional/interceptors.spec.ts
    interceptor
      ✓ custom interceptor function should replace returned content (23 ms)
      ✓ custom interceptor class should replace returned content (3 ms)
      ✓ custom interceptor class used on the whole controller should replace returned content (2 ms)
      ✓ global interceptor class should replace returned content (3 ms)
      ✓ interceptors should support promises (1004 ms)

PASS test/functional/action-params.spec.ts
    ✓ @Req and @Res should be provided as Request and Response objects (10 ms)
    ✓ @Res writing directly to the response should work (4 ms)
    ✓ @Param should give a param from route (4 ms)
    ✓ @Param multiple params should give a proper values from route (2 ms)
    ✓ @SessionParam without middleware (23 ms)
    ✓ @Session should return a value from session (11 ms)
    ✓ @Session(param) should allow to inject empty property (3 ms)
    ✓ @QueryParams should give a proper values from request's query parameters (9 ms)
    ✓ @QueryParams should give a proper values from request's query parameters and one multiple value (6 ms)
    ✓ @QueryParams should give a proper values from request's query with validate whitelist option on (3 ms)
    ✓ @QueryParams should give a proper values from request's query parameters with nested json (5 ms)
    ✓ @QueryParams should not validate request query parameters when it's turned off in validator options (12 ms)
    ✓ @QueryParams should give a proper values from request's optional query parameters (2 ms)
    ✓ @QueryParam should give a proper values from request query parameters (2 ms)
    ✓ @QueryParam should give an array of string with only one query parameter (2 ms)
    ✓ @QueryParam should give an array of string with multiple query parameters (2 ms)
    ✓ @QueryParam should give an array of number with only one query parameter (5 ms)
    ✓ @QueryParam should give an array of number with multiple query parameters (2 ms)
    ✓ @QueryParam should give an array of date with only one query parameter (2 ms)
    ✓ @QueryParam should give an array of date with multiple query parameters (2 ms)
    ✓ @QueryParam when required params must be provided and they should not be empty (8 ms)
    ✓ @QueryParam when the type is Date then it should be parsed (2 ms)
    ✓ @QueryParam when the type is Date and it is invalid then the response should be a BadRequest error (2 ms)
    ✓ @QueryParam when parseJson flag is used query param must be converted to object (2 ms)
    ✓ @HeaderParam should give a proper values from request headers (2 ms)
    ✓ @HeaderParam when required is params must be provided and they should not be empty (2 ms)
    ✓ @HeaderParam should fail with invalid request options (3 ms)
    ✓ @HeaderParam should fail with missing required params (3 ms)
    ✓ for @HeaderParam when parseJson flag is used query param must be converted to object (2 ms)
    ✓ @CookieParam should give a proper values from request headers (3 ms)
    ✓ @CookieParam when required is params must be provided and they should not be empty (4 ms)
    ✓ @CookieParam when parseJson flag is used query param must be converted to object (2 ms)
    ✓ @Body should provide a request body (12 ms)
    ✓ @Body should fail if required body was not provided (7 ms)
    ✓ @Body should provide a json object for json-typed controllers and actions (2 ms)
    ✓ @Body should fail if required body was not provided for json-typed controllers and actions (5 ms)
    ✓ @BodyParam should provide a json object for json-typed controllers and actions (3 ms)
    ✓ @BodyParam should fail if required body was not provided for json-typed controllers and actions (24 ms)
    ✓ @Body using application/x-www-form-urlencoded should handle url encoded form data (4 ms)
    ✓ @UploadedFile using multipart/form-data should provide uploaded file with the given name (12 ms)
    ✓ @UploadedFile with @Body should return both the file and the body (6 ms)
    ✓ @UploadedFile with @BodyParam should return both the file and the body param (4 ms)
    ✓ @UploadedFile with passed uploading options (limit) should throw an error (5 ms)
    ✓ @UploadedFile when required is used files must be provided (6 ms)
    ✓ @UploadedFiles should provide uploaded files with the given name (5 ms)
    ✓ @UploadedFiles with passed uploading options (limit) should throw an error (5 ms)
    ✓ @UploadedFiles when required is used files must be provided (4 ms)

PASS test/functional/controller-base-routes.spec.ts
    controller > base routes functionality
      ✓ get should respond with proper status code, headers and body content (65 ms)
      ✓ get should respond with proper status code, headers and body content (4 ms)
      ✓ get should respond with proper status code, headers and body content - 2nd pass (4 ms)
      ✓ wrong route should respond with 404 error (4 ms)
      ✓ wrong route should respond with 404 error (2 ms)
      ✓ wrong route should respond with 404 error (3 ms)

PASS test/functional/auth-decorator.spec.ts
    Controller responds with value when Authorization succeeds (async)
      ✓ without roles (74 ms)
      ✓ with roles (14 ms)
      ✓ async (25 ms)
    Controller responds with value when Authorization succeeds (sync)
      ✓ without roles (5 ms)
      ✓ with roles (3 ms)
      ✓ async (14 ms)
    Authorized Decorators Http Status Code
      ✓ without roles (25 ms)
      ✓ with roles (5 ms)
    Authorization checker allows to throw (async)
      ✓ custom errors (7 ms)
    Authorization checker allows to throw (sync)
      ✓ custom errors (6 ms)

PASS test/functional/load-from-directory.spec.ts
    loading all controllers from the given directories
      ✓ should load all controllers (19 ms)
    loading all express middlewares and error handlers from the given directories
      ✓ should succeed (14 ms)
      ✓ should fail (32 ms)

PASS test/functional/other-controller-decorators.spec.ts
    other controller decorators
      ✓ should return httpCode set by @HttpCode decorator (29 ms)
      ✓ should return custom code when @OnNull (33 ms)
      ✓ should return custom error message and code when @OnUndefined is used with Error class (8 ms)
      ✓ should return custom code when @OnUndefined (8 ms)
      ✓ should return content-type in the response when @ContentType is used (2 ms)
      ✓ should return content-type in the response when @ContentType is used (3 ms)
      ✓ should return response with custom headers when @Header is used (5 ms)
      ✓ should relocate to new location when @Location is used (2 ms)

PASS test/unit/controller-inheritance.spec.ts
  controller inheritance
    ✓ should build empty meta for empty set (14 ms)
    ✓ should build meta if the only derivative controller is given (2 ms)
    ✓ should build meta if the only autonomous controller is given
    ✓ should build meta both when autonomous and derivative controllers are given (1 ms)

PASS test/functional/express-middlewares.spec.ts
    express middlewares
      ✓ should call a global middlewares (39 ms)
      ✓ should use a custom middleware when @UseBefore or @UseAfter is used (6 ms)
      ✓ should call middleware and call it before controller action when @UseBefore is used (28 ms)
      ✓ should call middleware and call it after controller action when @UseAfter is used (10 ms)
      ✓ should call before middleware and call after middleware when @UseAfter and @UseAfter are used (12 ms)
      ✓ should handle errors in custom middlewares (83 ms)

PASS test/functional/controller-options.spec.ts
    controller options
      ✓ controller transform is enabled by default (147 ms)
      ✓ when controller transform is enabled (5 ms)
      ✓ when controller transform is disabled (3 ms)

PASS test/functional/container.spec.ts
    using typedi container should be possible
      ✓ typedi container (65 ms)
    using custom container should be possible
      ✓ custom container (7 ms)
    using custom container with fallback should be possible
      ✓ custom container with fallback (9 ms)
    using custom container with fallback and fallback on throw error should be possible
      ✓ custom container with fallback and fallback on throw error (8 ms)

PASS test/functional/express-error-handling.spec.ts
    express error handling
      ✓ should not call global error handler middleware if there was no errors (23 ms)
      ✓ should call global error handler middleware (19 ms)
      ✓ should call global error handler middleware (5 ms)
      ✓ should call error handler middleware if used (3 ms)
      ✓ should not execute next middleware if soft error handled specifically and stopped error bubbling (4 ms)
      ✓ should process JsonErrors by their toJSON method if it exists (3 ms)

PASS test/functional/class-validator-options.spec.ts
    no options
      ✓ should not use any options if not set (62 ms)
    global options
      should merge local validation options with global validation options prioritizing local
        ✓ succeed (6 ms)
      should pass the valid param after validation
        ✓ succeed (4 ms)
        ✓ should contain param name on validation failed (17 ms)
    local options
      ✓ should apply local options (7 ms)

PASS test/functional/special-result-send.spec.ts
    special result value treatment
      ✓ should pipe stream to response (20 ms)
      ✓ should send raw binary data from Buffer (3 ms)
      ✓ should send raw binary data from UIntArray (2 ms)

PASS test/functional/defaults.spec.ts
    defaults
      ✓ should return undefinedResultCode from defaults config for void function (21 ms)
      ✓ should return undefinedResultCode from defaults config for promise void function (3 ms)
      ✓ should return 400 from required paramOptions (17 ms)
      ✓ should return nullResultCode from defaults config (3 ms)
      ✓ should return status code from OnUndefined annotation (3 ms)
      ✓ should mark arg optional from QueryParam annotation (4 ms)

PASS test/functional/global-options.spec.ts
    routing-controllers global options
      useClassTransformer default value
        ✓ useClassTransformer by default must be set to true (87 ms)
      when useClassTransformer is set to true
        ✓ useClassTransformer is enabled (4 ms)
      when useClassTransformer is set to false
        ✓ useClassTransformer is disabled (4 ms)
      when routePrefix is used all controller routes should be appended by it
        ✓ routePrefix is enabled (6 ms)

PASS test/functional/action-options.spec.ts
    ✓ should use controller options when action transform options are not set (38 ms)
    ✓ should override controller options with action transformRequest option (6 ms)
    ✓ should override controller options with action transformResponse option (3 ms)

PASS test/functional/express-custom-error-handling.spec.ts
    custom express error handling
      ✓ should not call global error handler middleware if there was no errors (24 ms)
      ✓ should call global error handler middleware (18 ms)

PASS test/functional/class-transformer-options.spec.ts
    should not use any options if not set
      ✓ technical wrapper (53 ms)
    should apply global options
      ✓ technical wrapper (7 ms)
    should apply local options
      ✓ technical wrapper (5 ms)

PASS test/functional/render-decorator.spec.ts
    template rendering
      ✓ should render a template and use given variables (31 ms)
      ✓ should render a template with given variables and locals variables (4 ms)

PASS test/functional/middlewares-order.spec.ts
    loaded direct from array
      ✓ should call middlewares in order defined by items order (23 ms)
    specified by priority option
      ✓ should call middlewares in order defined by priority parameter of decorator (3 ms)

PASS test/functional/express-global-before-error-handling.spec.ts
    custom express global before middleware error handling
      ✓ should call global error handler middleware with CustomError (39 ms)

PASS test/functional/redirect-decorator.spec.ts
    dynamic redirect
      ✓ using template (27 ms)
      ✓ using override (3 ms)
      ✓ using original (6 ms)

PASS test/functional/error-subclasses.spec.ts
  HttpError
    ✓ should be instance of HttpError and Error (3 ms)
  BadRequestError
    ✓ should be instance of BadRequestError, HttpError and Error (2 ms)

Summary of all failing tests
FAIL test/ActionParameterHandler.spec.ts
  ● ActionParameterHandler › negative › handle - throws error if the parameter is required

    Expected value   "TypeError: Cannot read property 'uuid' of undefined"
    Received:
      "TypeError: Cannot read properties of undefined (reading 'uuid')"

    Message:
      expected 'TypeError: Cannot read properties of undefined (reading \'uuid\')' to equal 'TypeError: Cannot read property \'uuid\' of undefined'

    Difference:

    - Expected
    + Received

    - TypeError: Cannot read property 'uuid' of undefined
    + TypeError: Cannot read properties of undefined (reading 'uuid')

      152 |       }
      153 | 
    > 154 |       expect(error.toString()).to.be.eq("TypeError: Cannot read property 'uuid' of undefined");
          |                                      ^
      155 |     });
      156 | 
      157 |     it('handle - throws error if the parameter is required, type file provided', async () => {

      at Object.<anonymous> (test/ActionParameterHandler.spec.ts:154:38)


Test Suites: 1 failed, 25 passed, 26 total
Tests:       1 failed, 181 passed, 182 total
Snapshots:   0 total
Time:        13.34 s
Ran all test suites.
************* run test done *************
routing-controllers is testing ./VariantsDeps/express/variant2/express
/data/js-variants/multee
************* npm unlink module *************
************* npm unlink module done *************
************* npm unlink globally *************
************* npm unlink module done *************
************* npm link globally *************
************* npm link globally done *************
************* npm link module *************
************* npm link module done *************
************* start run test *************
ts-jest[config] (WARN) The option `tsConfig` is deprecated and will be removed in ts-jest 27, use `tsconfig` instead
FAIL test/ActionParameterHandler.spec.ts
  ActionParameterHandler
    positive
      ✓ handle - should process string parameters (28 ms)
      ✓ handle - should process string parameters, returns empty if a given string is empty
      ✓ handle - should process number parameters
      ✓ handle - undefined on empty object provided (1 ms)
      ✓ handle - null provided (10 ms)
    negative
      ✕ handle - throws error if the parameter is required (7 ms)
      ✓ handle - throws error if the parameter is required, type file provided (1 ms)

  ● ActionParameterHandler › negative › handle - throws error if the parameter is required

    Expected value   "TypeError: Cannot read property 'uuid' of undefined"
    Received:
      "TypeError: Cannot read properties of undefined (reading 'uuid')"

    Message:
      expected 'TypeError: Cannot read properties of undefined (reading \'uuid\')' to equal 'TypeError: Cannot read property \'uuid\' of undefined'

    Difference:

    - Expected
    + Received

    - TypeError: Cannot read property 'uuid' of undefined
    + TypeError: Cannot read properties of undefined (reading 'uuid')

      152 |       }
      153 | 
    > 154 |       expect(error.toString()).to.be.eq("TypeError: Cannot read property 'uuid' of undefined");
          |                                      ^
      155 |     });
      156 | 
      157 |     it('handle - throws error if the parameter is required, type file provided', async () => {

      at Object.<anonymous> (test/ActionParameterHandler.spec.ts:154:38)

PASS test/functional/controller-methods.spec.ts
    controller methods
      ✓ get should respond with proper status code, headers and body content (20 ms)
      ✓ post respond with proper status code, headers and body content (5 ms)
      ✓ put respond with proper status code, headers and body content (3 ms)
      ✓ patch respond with proper status code, headers and body content (3 ms)
      ✓ delete respond with proper status code, headers and body content (3 ms)
      ✓ head respond with proper status code, headers and body content (3 ms)
      ✓ custom method (post) respond with proper status code, headers and body content (3 ms)
      ✓ custom method (delete) respond with proper status code, headers and body content (2 ms)
      ✓ route should work with parameter (3 ms)
      ✓ route should work with regexp parameter (3 ms)
      ✓ should respond with 404 when regexp does not match (5 ms)
      ✓ route should work with string regexp parameter (3 ms)
      ✓ should respond with 404 when regexp does not match (2 ms)
      ✓ should return result from a promise (504 ms)
      ✓ should respond with 500 if promise failed (505 ms)
      ✓ should respond with 204 No Content when null returned in action (6 ms)
      ✓ should respond with 404 Not Found text when undefined returned in action (30 ms)
      ✓ should respond with 404 Not Found JSON when undefined returned in action (4 ms)
      ✓ should respond with 200 and text/html even in json controller's method (2 ms)
      ✓ should respond with 200 and text/plain even in json controller's method (2 ms)
      ✓ should respond with 401 and text/html when UnauthorizedError throwed even in json controller's method (4 ms)
      ✓ should respond with 401 and aplication/json when UnauthorizedError is thrown in standard json controller's method (3 ms)

PASS test/functional/json-controller-methods.spec.ts
    json-controller methods
      ✓ get should respond with proper status code, headers and body content (10 ms)
      ✓ post respond with proper status code, headers and body content (3 ms)
      ✓ put respond with proper status code, headers and body content (3 ms)
      ✓ patch respond with proper status code, headers and body content (2 ms)
      ✓ delete respond with proper status code, headers and body content (3 ms)
      ✓ head respond with proper status code, headers and body content (2 ms)
      ✓ custom method (post) respond with proper status code, headers and body content (2 ms)
      ✓ custom method (delete) respond with proper status code, headers and body content (2 ms)
      ✓ route should work with parameter (3 ms)
      ✓ route should work with regexp parameter (3 ms)
      ✓ should respond with 404 when regexp does not match (4 ms)
      ✓ route should work with string regexp parameter (3 ms)
      ✓ should respond with 404 when regexp does not match (2 ms)
      ✓ should return result from a promise (504 ms)
      ✓ should respond with 500 if promise failed (504 ms)

PASS test/functional/interceptors.spec.ts
    interceptor
      ✓ custom interceptor function should replace returned content (9 ms)
      ✓ custom interceptor class should replace returned content (3 ms)
      ✓ custom interceptor class used on the whole controller should replace returned content (3 ms)
      ✓ global interceptor class should replace returned content (2 ms)
      ✓ interceptors should support promises (1005 ms)

PASS test/functional/action-params.spec.ts
    ✓ @Req and @Res should be provided as Request and Response objects (11 ms)
    ✓ @Res writing directly to the response should work (4 ms)
    ✓ @Param should give a param from route (3 ms)
    ✓ @Param multiple params should give a proper values from route (2 ms)
    ✓ @SessionParam without middleware (23 ms)
    ✓ @Session should return a value from session (13 ms)
    ✓ @Session(param) should allow to inject empty property (3 ms)
    ✓ @QueryParams should give a proper values from request's query parameters (9 ms)
    ✓ @QueryParams should give a proper values from request's query parameters and one multiple value (5 ms)
    ✓ @QueryParams should give a proper values from request's query with validate whitelist option on (4 ms)
    ✓ @QueryParams should give a proper values from request's query parameters with nested json (4 ms)
    ✓ @QueryParams should not validate request query parameters when it's turned off in validator options (11 ms)
    ✓ @QueryParams should give a proper values from request's optional query parameters (3 ms)
    ✓ @QueryParam should give a proper values from request query parameters (2 ms)
    ✓ @QueryParam should give an array of string with only one query parameter (2 ms)
    ✓ @QueryParam should give an array of string with multiple query parameters (3 ms)
    ✓ @QueryParam should give an array of number with only one query parameter (4 ms)
    ✓ @QueryParam should give an array of number with multiple query parameters (2 ms)
    ✓ @QueryParam should give an array of date with only one query parameter (1 ms)
    ✓ @QueryParam should give an array of date with multiple query parameters (2 ms)
    ✓ @QueryParam when required params must be provided and they should not be empty (12 ms)
    ✓ @QueryParam when the type is Date then it should be parsed (3 ms)
    ✓ @QueryParam when the type is Date and it is invalid then the response should be a BadRequest error (3 ms)
    ✓ @QueryParam when parseJson flag is used query param must be converted to object (2 ms)
    ✓ @HeaderParam should give a proper values from request headers (2 ms)
    ✓ @HeaderParam when required is params must be provided and they should not be empty (2 ms)
    ✓ @HeaderParam should fail with invalid request options (3 ms)
    ✓ @HeaderParam should fail with missing required params (2 ms)
    ✓ for @HeaderParam when parseJson flag is used query param must be converted to object (2 ms)
    ✓ @CookieParam should give a proper values from request headers (3 ms)
    ✓ @CookieParam when required is params must be provided and they should not be empty (4 ms)
    ✓ @CookieParam when parseJson flag is used query param must be converted to object (2 ms)
    ✓ @Body should provide a request body (12 ms)
    ✓ @Body should fail if required body was not provided (7 ms)
    ✓ @Body should provide a json object for json-typed controllers and actions (2 ms)
    ✓ @Body should fail if required body was not provided for json-typed controllers and actions (5 ms)
    ✓ @BodyParam should provide a json object for json-typed controllers and actions (2 ms)
    ✓ @BodyParam should fail if required body was not provided for json-typed controllers and actions (22 ms)
    ✓ @Body using application/x-www-form-urlencoded should handle url encoded form data (4 ms)
    ✓ @UploadedFile using multipart/form-data should provide uploaded file with the given name (12 ms)
    ✓ @UploadedFile with @Body should return both the file and the body (6 ms)
    ✓ @UploadedFile with @BodyParam should return both the file and the body param (4 ms)
    ✓ @UploadedFile with passed uploading options (limit) should throw an error (5 ms)
    ✓ @UploadedFile when required is used files must be provided (7 ms)
    ✓ @UploadedFiles should provide uploaded files with the given name (5 ms)
    ✓ @UploadedFiles with passed uploading options (limit) should throw an error (5 ms)
    ✓ @UploadedFiles when required is used files must be provided (4 ms)

PASS test/functional/controller-options.spec.ts
    controller options
      ✓ controller transform is enabled by default (75 ms)
      ✓ when controller transform is enabled (5 ms)
      ✓ when controller transform is disabled (3 ms)

PASS test/functional/express-middlewares.spec.ts
    express middlewares
      ✓ should call a global middlewares (9 ms)
      ✓ should use a custom middleware when @UseBefore or @UseAfter is used (3 ms)
      ✓ should call middleware and call it before controller action when @UseBefore is used (3 ms)
      ✓ should call middleware and call it after controller action when @UseAfter is used (2 ms)
      ✓ should call before middleware and call after middleware when @UseAfter and @UseAfter are used (2 ms)
      ✓ should handle errors in custom middlewares (24 ms)

PASS test/functional/auth-decorator.spec.ts
    Controller responds with value when Authorization succeeds (async)
      ✓ without roles (58 ms)
      ✓ with roles (14 ms)
      ✓ async (24 ms)
    Controller responds with value when Authorization succeeds (sync)
      ✓ without roles (6 ms)
      ✓ with roles (5 ms)
      ✓ async (14 ms)
    Authorized Decorators Http Status Code
      ✓ without roles (57 ms)
      ✓ with roles (4 ms)
    Authorization checker allows to throw (async)
      ✓ custom errors (5 ms)
    Authorization checker allows to throw (sync)
      ✓ custom errors (4 ms)

PASS test/functional/other-controller-decorators.spec.ts
    other controller decorators
      ✓ should return httpCode set by @HttpCode decorator (28 ms)
      ✓ should return custom code when @OnNull (31 ms)
      ✓ should return custom error message and code when @OnUndefined is used with Error class (7 ms)
      ✓ should return custom code when @OnUndefined (8 ms)
      ✓ should return content-type in the response when @ContentType is used (2 ms)
      ✓ should return content-type in the response when @ContentType is used (3 ms)
      ✓ should return response with custom headers when @Header is used (4 ms)
      ✓ should relocate to new location when @Location is used (2 ms)

PASS test/functional/load-from-directory.spec.ts
    loading all controllers from the given directories
      ✓ should load all controllers (19 ms)
    loading all express middlewares and error handlers from the given directories
      ✓ should succeed (9 ms)
      ✓ should fail (19 ms)

PASS test/functional/render-decorator.spec.ts
    template rendering
      ✓ should render a template and use given variables (29 ms)
      ✓ should render a template with given variables and locals variables (10 ms)

PASS test/functional/class-validator-options.spec.ts
    no options
      ✓ should not use any options if not set (66 ms)
    global options
      should merge local validation options with global validation options prioritizing local
        ✓ succeed (6 ms)
      should pass the valid param after validation
        ✓ succeed (6 ms)
        ✓ should contain param name on validation failed (20 ms)
    local options
      ✓ should apply local options (7 ms)

PASS test/functional/class-transformer-options.spec.ts
    should not use any options if not set
      ✓ technical wrapper (17 ms)
    should apply global options
      ✓ technical wrapper (5 ms)
    should apply local options
      ✓ technical wrapper (4 ms)

PASS test/functional/container.spec.ts
    using typedi container should be possible
      ✓ typedi container (65 ms)
    using custom container should be possible
      ✓ custom container (5 ms)
    using custom container with fallback should be possible
      ✓ custom container with fallback (8 ms)
    using custom container with fallback and fallback on throw error should be possible
      ✓ custom container with fallback and fallback on throw error (8 ms)

PASS test/functional/global-options.spec.ts
    routing-controllers global options
      useClassTransformer default value
        ✓ useClassTransformer by default must be set to true (81 ms)
      when useClassTransformer is set to true
        ✓ useClassTransformer is enabled (4 ms)
      when useClassTransformer is set to false
        ✓ useClassTransformer is disabled (4 ms)
      when routePrefix is used all controller routes should be appended by it
        ✓ routePrefix is enabled (5 ms)

PASS test/functional/action-options.spec.ts
    ✓ should use controller options when action transform options are not set (23 ms)
    ✓ should override controller options with action transformRequest option (6 ms)
    ✓ should override controller options with action transformResponse option (8 ms)

PASS test/unit/controller-inheritance.spec.ts
  controller inheritance
    ✓ should build empty meta for empty set (12 ms)
    ✓ should build meta if the only derivative controller is given (2 ms)
    ✓ should build meta if the only autonomous controller is given
    ✓ should build meta both when autonomous and derivative controllers are given (1 ms)

PASS test/functional/express-error-handling.spec.ts
    express error handling
      ✓ should not call global error handler middleware if there was no errors (10 ms)
      ✓ should call global error handler middleware (19 ms)
      ✓ should call global error handler middleware (5 ms)
      ✓ should call error handler middleware if used (3 ms)
      ✓ should not execute next middleware if soft error handled specifically and stopped error bubbling (3 ms)
      ✓ should process JsonErrors by their toJSON method if it exists (2 ms)

PASS test/functional/defaults.spec.ts
    defaults
      ✓ should return undefinedResultCode from defaults config for void function (8 ms)
      ✓ should return undefinedResultCode from defaults config for promise void function (3 ms)
      ✓ should return 400 from required paramOptions (16 ms)
      ✓ should return nullResultCode from defaults config (3 ms)
      ✓ should return status code from OnUndefined annotation (3 ms)
      ✓ should mark arg optional from QueryParam annotation (4 ms)

PASS test/functional/express-custom-error-handling.spec.ts
    custom express error handling
      ✓ should not call global error handler middleware if there was no errors (9 ms)
      ✓ should call global error handler middleware (18 ms)

PASS test/functional/controller-base-routes.spec.ts
    controller > base routes functionality
      ✓ get should respond with proper status code, headers and body content (62 ms)
      ✓ get should respond with proper status code, headers and body content (4 ms)
      ✓ get should respond with proper status code, headers and body content - 2nd pass (4 ms)
      ✓ wrong route should respond with 404 error (3 ms)
      ✓ wrong route should respond with 404 error (2 ms)
      ✓ wrong route should respond with 404 error (3 ms)

PASS test/functional/middlewares-order.spec.ts
    loaded direct from array
      ✓ should call middlewares in order defined by items order (25 ms)
    specified by priority option
      ✓ should call middlewares in order defined by priority parameter of decorator (2 ms)

PASS test/functional/express-global-before-error-handling.spec.ts
    custom express global before middleware error handling
      ✓ should call global error handler middleware with CustomError (39 ms)

PASS test/functional/redirect-decorator.spec.ts
    dynamic redirect
      ✓ using template (29 ms)
      ✓ using override (4 ms)
      ✓ using original (4 ms)

PASS test/functional/special-result-send.spec.ts
    special result value treatment
      ✓ should pipe stream to response (24 ms)
      ✓ should send raw binary data from Buffer (4 ms)
      ✓ should send raw binary data from UIntArray (3 ms)

PASS test/functional/error-subclasses.spec.ts
  HttpError
    ✓ should be instance of HttpError and Error (4 ms)
  BadRequestError
    ✓ should be instance of BadRequestError, HttpError and Error (1 ms)

Summary of all failing tests
FAIL test/ActionParameterHandler.spec.ts
  ● ActionParameterHandler › negative › handle - throws error if the parameter is required

    Expected value   "TypeError: Cannot read property 'uuid' of undefined"
    Received:
      "TypeError: Cannot read properties of undefined (reading 'uuid')"

    Message:
      expected 'TypeError: Cannot read properties of undefined (reading \'uuid\')' to equal 'TypeError: Cannot read property \'uuid\' of undefined'

    Difference:

    - Expected
    + Received

    - TypeError: Cannot read property 'uuid' of undefined
    + TypeError: Cannot read properties of undefined (reading 'uuid')

      152 |       }
      153 | 
    > 154 |       expect(error.toString()).to.be.eq("TypeError: Cannot read property 'uuid' of undefined");
          |                                      ^
      155 |     });
      156 | 
      157 |     it('handle - throws error if the parameter is required, type file provided', async () => {

      at Object.<anonymous> (test/ActionParameterHandler.spec.ts:154:38)


Test Suites: 1 failed, 25 passed, 26 total
Tests:       1 failed, 181 passed, 182 total
Snapshots:   0 total
Time:        13.21 s, estimated 14 s
Ran all test suites.
************* run test done *************
routing-controllers is testing ./VariantsDeps/express/variant1/express
/data/js-variants/multee
************* npm unlink module *************
************* npm unlink module done *************
************* npm unlink globally *************
************* npm unlink module done *************
************* npm link globally *************
************* npm link globally done *************
************* npm link module *************
************* npm link module done *************
************* start run test *************
ts-jest[config] (WARN) The option `tsConfig` is deprecated and will be removed in ts-jest 27, use `tsconfig` instead
FAIL test/ActionParameterHandler.spec.ts
  ActionParameterHandler
    positive
      ✓ handle - should process string parameters (42 ms)
      ✓ handle - should process string parameters, returns empty if a given string is empty (1 ms)
      ✓ handle - should process number parameters (1 ms)
      ✓ handle - undefined on empty object provided
      ✓ handle - null provided (25 ms)
    negative
      ✕ handle - throws error if the parameter is required (8 ms)
      ✓ handle - throws error if the parameter is required, type file provided (1 ms)

  ● ActionParameterHandler › negative › handle - throws error if the parameter is required

    Expected value   "TypeError: Cannot read property 'uuid' of undefined"
    Received:
      "TypeError: Cannot read properties of undefined (reading 'uuid')"

    Message:
      expected 'TypeError: Cannot read properties of undefined (reading \'uuid\')' to equal 'TypeError: Cannot read property \'uuid\' of undefined'

    Difference:

    - Expected
    + Received

    - TypeError: Cannot read property 'uuid' of undefined
    + TypeError: Cannot read properties of undefined (reading 'uuid')

      152 |       }
      153 | 
    > 154 |       expect(error.toString()).to.be.eq("TypeError: Cannot read property 'uuid' of undefined");
          |                                      ^
      155 |     });
      156 | 
      157 |     it('handle - throws error if the parameter is required, type file provided', async () => {

      at Object.<anonymous> (test/ActionParameterHandler.spec.ts:154:38)

PASS test/functional/controller-methods.spec.ts
    controller methods
      ✓ get should respond with proper status code, headers and body content (21 ms)
      ✓ post respond with proper status code, headers and body content (5 ms)
      ✓ put respond with proper status code, headers and body content (3 ms)
      ✓ patch respond with proper status code, headers and body content (3 ms)
      ✓ delete respond with proper status code, headers and body content (3 ms)
      ✓ head respond with proper status code, headers and body content (3 ms)
      ✓ custom method (post) respond with proper status code, headers and body content (2 ms)
      ✓ custom method (delete) respond with proper status code, headers and body content (3 ms)
      ✓ route should work with parameter (3 ms)
      ✓ route should work with regexp parameter (3 ms)
      ✓ should respond with 404 when regexp does not match (7 ms)
      ✓ route should work with string regexp parameter (2 ms)
      ✓ should respond with 404 when regexp does not match (2 ms)
      ✓ should return result from a promise (504 ms)
      ✓ should respond with 500 if promise failed (505 ms)
      ✓ should respond with 204 No Content when null returned in action (16 ms)
      ✓ should respond with 404 Not Found text when undefined returned in action (21 ms)
      ✓ should respond with 404 Not Found JSON when undefined returned in action (3 ms)
      ✓ should respond with 200 and text/html even in json controller's method (3 ms)
      ✓ should respond with 200 and text/plain even in json controller's method (2 ms)
      ✓ should respond with 401 and text/html when UnauthorizedError throwed even in json controller's method (4 ms)
      ✓ should respond with 401 and aplication/json when UnauthorizedError is thrown in standard json controller's method (2 ms)

PASS test/functional/json-controller-methods.spec.ts
    json-controller methods
      ✓ get should respond with proper status code, headers and body content (11 ms)
      ✓ post respond with proper status code, headers and body content (3 ms)
      ✓ put respond with proper status code, headers and body content (2 ms)
      ✓ patch respond with proper status code, headers and body content (3 ms)
      ✓ delete respond with proper status code, headers and body content (2 ms)
      ✓ head respond with proper status code, headers and body content (2 ms)
      ✓ custom method (post) respond with proper status code, headers and body content (2 ms)
      ✓ custom method (delete) respond with proper status code, headers and body content (2 ms)
      ✓ route should work with parameter (2 ms)
      ✓ route should work with regexp parameter (2 ms)
      ✓ should respond with 404 when regexp does not match (4 ms)
      ✓ route should work with string regexp parameter (3 ms)
      ✓ should respond with 404 when regexp does not match (2 ms)
      ✓ should return result from a promise (504 ms)
      ✓ should respond with 500 if promise failed (505 ms)

PASS test/functional/interceptors.spec.ts
    interceptor
      ✓ custom interceptor function should replace returned content (9 ms)
      ✓ custom interceptor class should replace returned content (4 ms)
      ✓ custom interceptor class used on the whole controller should replace returned content (2 ms)
      ✓ global interceptor class should replace returned content (2 ms)
      ✓ interceptors should support promises (1005 ms)

PASS test/functional/action-params.spec.ts
    ✓ @Req and @Res should be provided as Request and Response objects (10 ms)
    ✓ @Res writing directly to the response should work (4 ms)
    ✓ @Param should give a param from route (3 ms)
    ✓ @Param multiple params should give a proper values from route (3 ms)
    ✓ @SessionParam without middleware (23 ms)
    ✓ @Session should return a value from session (11 ms)
    ✓ @Session(param) should allow to inject empty property (3 ms)
    ✓ @QueryParams should give a proper values from request's query parameters (10 ms)
    ✓ @QueryParams should give a proper values from request's query parameters and one multiple value (6 ms)
    ✓ @QueryParams should give a proper values from request's query with validate whitelist option on (13 ms)
    ✓ @QueryParams should give a proper values from request's query parameters with nested json (4 ms)
    ✓ @QueryParams should not validate request query parameters when it's turned off in validator options (3 ms)
    ✓ @QueryParams should give a proper values from request's optional query parameters (3 ms)
    ✓ @QueryParam should give a proper values from request query parameters (2 ms)
    ✓ @QueryParam should give an array of string with only one query parameter (2 ms)
    ✓ @QueryParam should give an array of string with multiple query parameters (3 ms)
    ✓ @QueryParam should give an array of number with only one query parameter (3 ms)
    ✓ @QueryParam should give an array of number with multiple query parameters (2 ms)
    ✓ @QueryParam should give an array of date with only one query parameter (2 ms)
    ✓ @QueryParam should give an array of date with multiple query parameters (2 ms)
    ✓ @QueryParam when required params must be provided and they should not be empty (8 ms)
    ✓ @QueryParam when the type is Date then it should be parsed (2 ms)
    ✓ @QueryParam when the type is Date and it is invalid then the response should be a BadRequest error (2 ms)
    ✓ @QueryParam when parseJson flag is used query param must be converted to object (2 ms)
    ✓ @HeaderParam should give a proper values from request headers (2 ms)
    ✓ @HeaderParam when required is params must be provided and they should not be empty (2 ms)
    ✓ @HeaderParam should fail with invalid request options (3 ms)
    ✓ @HeaderParam should fail with missing required params (3 ms)
    ✓ for @HeaderParam when parseJson flag is used query param must be converted to object (2 ms)
    ✓ @CookieParam should give a proper values from request headers (3 ms)
    ✓ @CookieParam when required is params must be provided and they should not be empty (4 ms)
    ✓ @CookieParam when parseJson flag is used query param must be converted to object (1 ms)
    ✓ @Body should provide a request body (12 ms)
    ✓ @Body should fail if required body was not provided (10 ms)
    ✓ @Body should provide a json object for json-typed controllers and actions (3 ms)
    ✓ @Body should fail if required body was not provided for json-typed controllers and actions (5 ms)
    ✓ @BodyParam should provide a json object for json-typed controllers and actions (2 ms)
    ✓ @BodyParam should fail if required body was not provided for json-typed controllers and actions (17 ms)
    ✓ @Body using application/x-www-form-urlencoded should handle url encoded form data (4 ms)
    ✓ @UploadedFile using multipart/form-data should provide uploaded file with the given name (12 ms)
    ✓ @UploadedFile with @Body should return both the file and the body (6 ms)
    ✓ @UploadedFile with @BodyParam should return both the file and the body param (4 ms)
    ✓ @UploadedFile with passed uploading options (limit) should throw an error (5 ms)
    ✓ @UploadedFile when required is used files must be provided (7 ms)
    ✓ @UploadedFiles should provide uploaded files with the given name (4 ms)
    ✓ @UploadedFiles with passed uploading options (limit) should throw an error (6 ms)
    ✓ @UploadedFiles when required is used files must be provided (4 ms)

PASS test/functional/class-validator-options.spec.ts
    no options
      ✓ should not use any options if not set (67 ms)
    global options
      should merge local validation options with global validation options prioritizing local
        ✓ succeed (6 ms)
      should pass the valid param after validation
        ✓ succeed (4 ms)
        ✓ should contain param name on validation failed (17 ms)
    local options
      ✓ should apply local options (5 ms)

PASS test/functional/auth-decorator.spec.ts
    Controller responds with value when Authorization succeeds (async)
      ✓ without roles (78 ms)
      ✓ with roles (14 ms)
      ✓ async (25 ms)
    Controller responds with value when Authorization succeeds (sync)
      ✓ without roles (4 ms)
      ✓ with roles (4 ms)
      ✓ async (13 ms)
    Authorized Decorators Http Status Code
      ✓ without roles (20 ms)
      ✓ with roles (4 ms)
    Authorization checker allows to throw (async)
      ✓ custom errors (5 ms)
    Authorization checker allows to throw (sync)
      ✓ custom errors (3 ms)

PASS test/functional/controller-options.spec.ts
    controller options
      ✓ controller transform is enabled by default (72 ms)
      ✓ when controller transform is enabled (6 ms)
      ✓ when controller transform is disabled (3 ms)

PASS test/functional/load-from-directory.spec.ts
    loading all controllers from the given directories
      ✓ should load all controllers (35 ms)
    loading all express middlewares and error handlers from the given directories
      ✓ should succeed (8 ms)
      ✓ should fail (16 ms)

PASS test/functional/other-controller-decorators.spec.ts
    other controller decorators
      ✓ should return httpCode set by @HttpCode decorator (12 ms)
      ✓ should return custom code when @OnNull (30 ms)
      ✓ should return custom error message and code when @OnUndefined is used with Error class (7 ms)
      ✓ should return custom code when @OnUndefined (9 ms)
      ✓ should return content-type in the response when @ContentType is used (2 ms)
      ✓ should return content-type in the response when @ContentType is used (2 ms)
      ✓ should return response with custom headers when @Header is used (6 ms)
      ✓ should relocate to new location when @Location is used (15 ms)

PASS test/functional/express-error-handling.spec.ts
    express error handling
      ✓ should not call global error handler middleware if there was no errors (15 ms)
      ✓ should call global error handler middleware (63 ms)
      ✓ should call global error handler middleware (16 ms)
      ✓ should call error handler middleware if used (22 ms)
      ✓ should not execute next middleware if soft error handled specifically and stopped error bubbling (6 ms)
      ✓ should process JsonErrors by their toJSON method if it exists (15 ms)

PASS test/functional/express-middlewares.spec.ts
    express middlewares
      ✓ should call a global middlewares (21 ms)
      ✓ should use a custom middleware when @UseBefore or @UseAfter is used (4 ms)
      ✓ should call middleware and call it before controller action when @UseBefore is used (3 ms)
      ✓ should call middleware and call it after controller action when @UseAfter is used (3 ms)
      ✓ should call before middleware and call after middleware when @UseAfter and @UseAfter are used (3 ms)
      ✓ should handle errors in custom middlewares (24 ms)

PASS test/functional/container.spec.ts
    using typedi container should be possible
      ✓ typedi container (65 ms)
    using custom container should be possible
      ✓ custom container (6 ms)
    using custom container with fallback should be possible
      ✓ custom container with fallback (9 ms)
    using custom container with fallback and fallback on throw error should be possible
      ✓ custom container with fallback and fallback on throw error (7 ms)

PASS test/functional/defaults.spec.ts
    defaults
      ✓ should return undefinedResultCode from defaults config for void function (7 ms)
      ✓ should return undefinedResultCode from defaults config for promise void function (3 ms)
      ✓ should return 400 from required paramOptions (16 ms)
      ✓ should return nullResultCode from defaults config (3 ms)
      ✓ should return status code from OnUndefined annotation (3 ms)
      ✓ should mark arg optional from QueryParam annotation (4 ms)

PASS test/unit/controller-inheritance.spec.ts
  controller inheritance
    ✓ should build empty meta for empty set (11 ms)
    ✓ should build meta if the only derivative controller is given (2 ms)
    ✓ should build meta if the only autonomous controller is given
    ✓ should build meta both when autonomous and derivative controllers are given (1 ms)

PASS test/functional/render-decorator.spec.ts
    template rendering
      ✓ should render a template and use given variables (13 ms)
      ✓ should render a template with given variables and locals variables (5 ms)

PASS test/functional/special-result-send.spec.ts
    special result value treatment
      ✓ should pipe stream to response (25 ms)
      ✓ should send raw binary data from Buffer (3 ms)
      ✓ should send raw binary data from UIntArray (2 ms)

PASS test/functional/global-options.spec.ts
    routing-controllers global options
      useClassTransformer default value
        ✓ useClassTransformer by default must be set to true (86 ms)
      when useClassTransformer is set to true
        ✓ useClassTransformer is enabled (5 ms)
      when useClassTransformer is set to false
        ✓ useClassTransformer is disabled (4 ms)
      when routePrefix is used all controller routes should be appended by it
        ✓ routePrefix is enabled (6 ms)

PASS test/functional/action-options.spec.ts
    ✓ should use controller options when action transform options are not set (35 ms)
    ✓ should override controller options with action transformRequest option (5 ms)
    ✓ should override controller options with action transformResponse option (3 ms)

PASS test/functional/class-transformer-options.spec.ts
    should not use any options if not set
      ✓ technical wrapper (33 ms)
    should apply global options
      ✓ technical wrapper (5 ms)
    should apply local options
      ✓ technical wrapper (5 ms)

PASS test/functional/controller-base-routes.spec.ts
    controller > base routes functionality
      ✓ get should respond with proper status code, headers and body content (65 ms)
      ✓ get should respond with proper status code, headers and body content (6 ms)
      ✓ get should respond with proper status code, headers and body content - 2nd pass (5 ms)
      ✓ wrong route should respond with 404 error (7 ms)
      ✓ wrong route should respond with 404 error (4 ms)
      ✓ wrong route should respond with 404 error (4 ms)

PASS test/functional/express-global-before-error-handling.spec.ts
    custom express global before middleware error handling
      ✓ should call global error handler middleware with CustomError (37 ms)

PASS test/functional/express-custom-error-handling.spec.ts
    custom express error handling
      ✓ should not call global error handler middleware if there was no errors (24 ms)
      ✓ should call global error handler middleware (18 ms)

PASS test/functional/redirect-decorator.spec.ts
    dynamic redirect
      ✓ using template (29 ms)
      ✓ using override (4 ms)
      ✓ using original (4 ms)

PASS test/functional/middlewares-order.spec.ts
    loaded direct from array
      ✓ should call middlewares in order defined by items order (24 ms)
    specified by priority option
      ✓ should call middlewares in order defined by priority parameter of decorator (3 ms)

PASS test/functional/error-subclasses.spec.ts
  HttpError
    ✓ should be instance of HttpError and Error (3 ms)
  BadRequestError
    ✓ should be instance of BadRequestError, HttpError and Error (1 ms)

Summary of all failing tests
FAIL test/ActionParameterHandler.spec.ts
  ● ActionParameterHandler › negative › handle - throws error if the parameter is required

    Expected value   "TypeError: Cannot read property 'uuid' of undefined"
    Received:
      "TypeError: Cannot read properties of undefined (reading 'uuid')"

    Message:
      expected 'TypeError: Cannot read properties of undefined (reading \'uuid\')' to equal 'TypeError: Cannot read property \'uuid\' of undefined'

    Difference:

    - Expected
    + Received

    - TypeError: Cannot read property 'uuid' of undefined
    + TypeError: Cannot read properties of undefined (reading 'uuid')

      152 |       }
      153 | 
    > 154 |       expect(error.toString()).to.be.eq("TypeError: Cannot read property 'uuid' of undefined");
          |                                      ^
      155 |     });
      156 | 
      157 |     it('handle - throws error if the parameter is required, type file provided', async () => {

      at Object.<anonymous> (test/ActionParameterHandler.spec.ts:154:38)


Test Suites: 1 failed, 25 passed, 26 total
Tests:       1 failed, 181 passed, 182 total
Snapshots:   0 total
Time:        13.073 s, estimated 14 s
Ran all test suites.
************* run test done *************
17
routing-controllers is testing ./Variants/express/variant17/express
************* npm unlink module *************
************* npm unlink module done *************
************* npm unlink globally *************
************* npm unlink globally done *************
************* npm link globally *************
************* npm link globally done *************
************* npm link module *************
************* npm link module done *************
************* start run test *************
ts-jest[config] (WARN) The option `tsConfig` is deprecated and will be removed in ts-jest 27, use `tsconfig` instead
FAIL test/ActionParameterHandler.spec.ts
  ActionParameterHandler
    positive
      ✓ handle - should process string parameters (29 ms)
      ✓ handle - should process string parameters, returns empty if a given string is empty
      ✓ handle - should process number parameters (1 ms)
      ✓ handle - undefined on empty object provided
      ✓ handle - null provided (14 ms)
    negative
      ✕ handle - throws error if the parameter is required (7 ms)
      ✓ handle - throws error if the parameter is required, type file provided (1 ms)

  ● ActionParameterHandler › negative › handle - throws error if the parameter is required

    Expected value   "TypeError: Cannot read property 'uuid' of undefined"
    Received:
      "TypeError: Cannot read properties of undefined (reading 'uuid')"

    Message:
      expected 'TypeError: Cannot read properties of undefined (reading \'uuid\')' to equal 'TypeError: Cannot read property \'uuid\' of undefined'

    Difference:

    - Expected
    + Received

    - TypeError: Cannot read property 'uuid' of undefined
    + TypeError: Cannot read properties of undefined (reading 'uuid')

      152 |       }
      153 | 
    > 154 |       expect(error.toString()).to.be.eq("TypeError: Cannot read property 'uuid' of undefined");
          |                                      ^
      155 |     });
      156 | 
      157 |     it('handle - throws error if the parameter is required, type file provided', async () => {

      at Object.<anonymous> (test/ActionParameterHandler.spec.ts:154:38)

PASS test/functional/controller-methods.spec.ts
    controller methods
      ✓ get should respond with proper status code, headers and body content (20 ms)
      ✓ post respond with proper status code, headers and body content (6 ms)
      ✓ put respond with proper status code, headers and body content (3 ms)
      ✓ patch respond with proper status code, headers and body content (3 ms)
      ✓ delete respond with proper status code, headers and body content (3 ms)
      ✓ head respond with proper status code, headers and body content (3 ms)
      ✓ custom method (post) respond with proper status code, headers and body content (2 ms)
      ✓ custom method (delete) respond with proper status code, headers and body content (3 ms)
      ✓ route should work with parameter (3 ms)
      ✓ route should work with regexp parameter (3 ms)
      ✓ should respond with 404 when regexp does not match (7 ms)
      ✓ route should work with string regexp parameter (2 ms)
      ✓ should respond with 404 when regexp does not match (3 ms)
      ✓ should return result from a promise (503 ms)
      ✓ should respond with 500 if promise failed (505 ms)
      ✓ should respond with 204 No Content when null returned in action (5 ms)
      ✓ should respond with 404 Not Found text when undefined returned in action (22 ms)
      ✓ should respond with 404 Not Found JSON when undefined returned in action (13 ms)
      ✓ should respond with 200 and text/html even in json controller's method (2 ms)
      ✓ should respond with 200 and text/plain even in json controller's method (1 ms)
      ✓ should respond with 401 and text/html when UnauthorizedError throwed even in json controller's method (4 ms)
      ✓ should respond with 401 and aplication/json when UnauthorizedError is thrown in standard json controller's method (3 ms)

PASS test/functional/json-controller-methods.spec.ts
    json-controller methods
      ✓ get should respond with proper status code, headers and body content (10 ms)
      ✓ post respond with proper status code, headers and body content (3 ms)
      ✓ put respond with proper status code, headers and body content (2 ms)
      ✓ patch respond with proper status code, headers and body content (3 ms)
      ✓ delete respond with proper status code, headers and body content (2 ms)
      ✓ head respond with proper status code, headers and body content (3 ms)
      ✓ custom method (post) respond with proper status code, headers and body content (2 ms)
      ✓ custom method (delete) respond with proper status code, headers and body content (2 ms)
      ✓ route should work with parameter (3 ms)
      ✓ route should work with regexp parameter (3 ms)
      ✓ should respond with 404 when regexp does not match (4 ms)
      ✓ route should work with string regexp parameter (3 ms)
      ✓ should respond with 404 when regexp does not match (1 ms)
      ✓ should return result from a promise (503 ms)
      ✓ should respond with 500 if promise failed (504 ms)

PASS test/functional/interceptors.spec.ts
    interceptor
      ✓ custom interceptor function should replace returned content (23 ms)
      ✓ custom interceptor class should replace returned content (3 ms)
      ✓ custom interceptor class used on the whole controller should replace returned content (2 ms)
      ✓ global interceptor class should replace returned content (3 ms)
      ✓ interceptors should support promises (1004 ms)

PASS test/functional/action-params.spec.ts
    ✓ @Req and @Res should be provided as Request and Response objects (11 ms)
    ✓ @Res writing directly to the response should work (4 ms)
    ✓ @Param should give a param from route (4 ms)
    ✓ @Param multiple params should give a proper values from route (2 ms)
    ✓ @SessionParam without middleware (23 ms)
    ✓ @Session should return a value from session (11 ms)
    ✓ @Session(param) should allow to inject empty property (3 ms)
    ✓ @QueryParams should give a proper values from request's query parameters (9 ms)
    ✓ @QueryParams should give a proper values from request's query parameters and one multiple value (6 ms)
    ✓ @QueryParams should give a proper values from request's query with validate whitelist option on (4 ms)
    ✓ @QueryParams should give a proper values from request's query parameters with nested json (7 ms)
    ✓ @QueryParams should not validate request query parameters when it's turned off in validator options (12 ms)
    ✓ @QueryParams should give a proper values from request's optional query parameters (3 ms)
    ✓ @QueryParam should give a proper values from request query parameters (3 ms)
    ✓ @QueryParam should give an array of string with only one query parameter (2 ms)
    ✓ @QueryParam should give an array of string with multiple query parameters (2 ms)
    ✓ @QueryParam should give an array of number with only one query parameter (3 ms)
    ✓ @QueryParam should give an array of number with multiple query parameters (3 ms)
    ✓ @QueryParam should give an array of date with only one query parameter (2 ms)
    ✓ @QueryParam should give an array of date with multiple query parameters (2 ms)
    ✓ @QueryParam when required params must be provided and they should not be empty (8 ms)
    ✓ @QueryParam when the type is Date then it should be parsed (2 ms)
    ✓ @QueryParam when the type is Date and it is invalid then the response should be a BadRequest error (3 ms)
    ✓ @QueryParam when parseJson flag is used query param must be converted to object (2 ms)
    ✓ @HeaderParam should give a proper values from request headers (2 ms)
    ✓ @HeaderParam when required is params must be provided and they should not be empty (2 ms)
    ✓ @HeaderParam should fail with invalid request options (5 ms)
    ✓ @HeaderParam should fail with missing required params (3 ms)
    ✓ for @HeaderParam when parseJson flag is used query param must be converted to object (2 ms)
    ✓ @CookieParam should give a proper values from request headers (2 ms)
    ✓ @CookieParam when required is params must be provided and they should not be empty (4 ms)
    ✓ @CookieParam when parseJson flag is used query param must be converted to object (2 ms)
    ✓ @Body should provide a request body (12 ms)
    ✓ @Body should fail if required body was not provided (6 ms)
    ✓ @Body should provide a json object for json-typed controllers and actions (3 ms)
    ✓ @Body should fail if required body was not provided for json-typed controllers and actions (4 ms)
    ✓ @BodyParam should provide a json object for json-typed controllers and actions (3 ms)
    ✓ @BodyParam should fail if required body was not provided for json-typed controllers and actions (22 ms)
    ✓ @Body using application/x-www-form-urlencoded should handle url encoded form data (4 ms)
    ✓ @UploadedFile using multipart/form-data should provide uploaded file with the given name (12 ms)
    ✓ @UploadedFile with @Body should return both the file and the body (6 ms)
    ✓ @UploadedFile with @BodyParam should return both the file and the body param (5 ms)
    ✓ @UploadedFile with passed uploading options (limit) should throw an error (5 ms)
    ✓ @UploadedFile when required is used files must be provided (7 ms)
    ✓ @UploadedFiles should provide uploaded files with the given name (4 ms)
    ✓ @UploadedFiles with passed uploading options (limit) should throw an error (6 ms)
    ✓ @UploadedFiles when required is used files must be provided (4 ms)

PASS test/functional/express-error-handling.spec.ts
    express error handling
      ✓ should not call global error handler middleware if there was no errors (24 ms)
      ✓ should call global error handler middleware (23 ms)
      ✓ should call global error handler middleware (4 ms)
      ✓ should call error handler middleware if used (3 ms)
      ✓ should not execute next middleware if soft error handled specifically and stopped error bubbling (2 ms)
      ✓ should process JsonErrors by their toJSON method if it exists (3 ms)

PASS test/functional/load-from-directory.spec.ts
    loading all controllers from the given directories
      ✓ should load all controllers (19 ms)
    loading all express middlewares and error handlers from the given directories
      ✓ should succeed (15 ms)
      ✓ should fail (21 ms)

PASS test/functional/auth-decorator.spec.ts
    Controller responds with value when Authorization succeeds (async)
      ✓ without roles (73 ms)
      ✓ with roles (14 ms)
      ✓ async (25 ms)
    Controller responds with value when Authorization succeeds (sync)
      ✓ without roles (5 ms)
      ✓ with roles (3 ms)
      ✓ async (14 ms)
    Authorized Decorators Http Status Code
      ✓ without roles (21 ms)
      ✓ with roles (17 ms)
    Authorization checker allows to throw (async)
      ✓ custom errors (5 ms)
    Authorization checker allows to throw (sync)
      ✓ custom errors (4 ms)

PASS test/functional/express-middlewares.spec.ts
    express middlewares
      ✓ should call a global middlewares (25 ms)
      ✓ should use a custom middleware when @UseBefore or @UseAfter is used (3 ms)
      ✓ should call middleware and call it before controller action when @UseBefore is used (3 ms)
      ✓ should call middleware and call it after controller action when @UseAfter is used (2 ms)
      ✓ should call before middleware and call after middleware when @UseAfter and @UseAfter are used (3 ms)
      ✓ should handle errors in custom middlewares (23 ms)

PASS test/functional/other-controller-decorators.spec.ts
    other controller decorators
      ✓ should return httpCode set by @HttpCode decorator (26 ms)
      ✓ should return custom code when @OnNull (46 ms)
      ✓ should return custom error message and code when @OnUndefined is used with Error class (7 ms)
      ✓ should return custom code when @OnUndefined (12 ms)
      ✓ should return content-type in the response when @ContentType is used (3 ms)
      ✓ should return content-type in the response when @ContentType is used (2 ms)
      ✓ should return response with custom headers when @Header is used (3 ms)
      ✓ should relocate to new location when @Location is used (3 ms)

PASS test/functional/controller-options.spec.ts
    controller options
      ✓ controller transform is enabled by default (201 ms)
      ✓ when controller transform is enabled (10 ms)
      ✓ when controller transform is disabled (5 ms)

PASS test/unit/controller-inheritance.spec.ts
  controller inheritance
    ✓ should build empty meta for empty set (44 ms)
    ✓ should build meta if the only derivative controller is given (3 ms)
    ✓ should build meta if the only autonomous controller is given (2 ms)
    ✓ should build meta both when autonomous and derivative controllers are given (1 ms)

PASS test/functional/container.spec.ts
    using typedi container should be possible
      ✓ typedi container (68 ms)
    using custom container should be possible
      ✓ custom container (6 ms)
    using custom container with fallback should be possible
      ✓ custom container with fallback (7 ms)
    using custom container with fallback and fallback on throw error should be possible
      ✓ custom container with fallback and fallback on throw error (7 ms)

PASS test/functional/class-validator-options.spec.ts
    no options
      ✓ should not use any options if not set (70 ms)
    global options
      should merge local validation options with global validation options prioritizing local
        ✓ succeed (7 ms)
      should pass the valid param after validation
        ✓ succeed (4 ms)
        ✓ should contain param name on validation failed (18 ms)
    local options
      ✓ should apply local options (4 ms)

PASS test/functional/global-options.spec.ts
    routing-controllers global options
      useClassTransformer default value
        ✓ useClassTransformer by default must be set to true (79 ms)
      when useClassTransformer is set to true
        ✓ useClassTransformer is enabled (4 ms)
      when useClassTransformer is set to false
        ✓ useClassTransformer is disabled (4 ms)
      when routePrefix is used all controller routes should be appended by it
        ✓ routePrefix is enabled (6 ms)

PASS test/functional/action-options.spec.ts
    ✓ should use controller options when action transform options are not set (30 ms)
    ✓ should override controller options with action transformRequest option (5 ms)
    ✓ should override controller options with action transformResponse option (3 ms)

PASS test/functional/controller-base-routes.spec.ts
    controller > base routes functionality
      ✓ get should respond with proper status code, headers and body content (103 ms)
      ✓ get should respond with proper status code, headers and body content (4 ms)
      ✓ get should respond with proper status code, headers and body content - 2nd pass (3 ms)
      ✓ wrong route should respond with 404 error (4 ms)
      ✓ wrong route should respond with 404 error (3 ms)
      ✓ wrong route should respond with 404 error (2 ms)

PASS test/functional/defaults.spec.ts
    defaults
      ✓ should return undefinedResultCode from defaults config for void function (25 ms)
      ✓ should return undefinedResultCode from defaults config for promise void function (2 ms)
      ✓ should return 400 from required paramOptions (17 ms)
      ✓ should return nullResultCode from defaults config (3 ms)
      ✓ should return status code from OnUndefined annotation (2 ms)
      ✓ should mark arg optional from QueryParam annotation (5 ms)

PASS test/functional/class-transformer-options.spec.ts
    should not use any options if not set
      ✓ technical wrapper (29 ms)
    should apply global options
      ✓ technical wrapper (6 ms)
    should apply local options
      ✓ technical wrapper (7 ms)

PASS test/functional/express-global-before-error-handling.spec.ts
    custom express global before middleware error handling
      ✓ should call global error handler middleware with CustomError (41 ms)

PASS test/functional/express-custom-error-handling.spec.ts
    custom express error handling
      ✓ should not call global error handler middleware if there was no errors (97 ms)
      ✓ should call global error handler middleware (22 ms)

PASS test/functional/redirect-decorator.spec.ts
    dynamic redirect
      ✓ using template (29 ms)
      ✓ using override (4 ms)
      ✓ using original (3 ms)

PASS test/functional/render-decorator.spec.ts
    template rendering
      ✓ should render a template and use given variables (29 ms)
      ✓ should render a template with given variables and locals variables (4 ms)

PASS test/functional/middlewares-order.spec.ts
    loaded direct from array
      ✓ should call middlewares in order defined by items order (22 ms)
    specified by priority option
      ✓ should call middlewares in order defined by priority parameter of decorator (3 ms)

PASS test/functional/special-result-send.spec.ts
    special result value treatment
      ✓ should pipe stream to response (24 ms)
      ✓ should send raw binary data from Buffer (4 ms)
      ✓ should send raw binary data from UIntArray (2 ms)

PASS test/functional/error-subclasses.spec.ts
  HttpError
    ✓ should be instance of HttpError and Error (6 ms)
  BadRequestError
    ✓ should be instance of BadRequestError, HttpError and Error (3 ms)

Summary of all failing tests
FAIL test/ActionParameterHandler.spec.ts
  ● ActionParameterHandler › negative › handle - throws error if the parameter is required

    Expected value   "TypeError: Cannot read property 'uuid' of undefined"
    Received:
      "TypeError: Cannot read properties of undefined (reading 'uuid')"

    Message:
      expected 'TypeError: Cannot read properties of undefined (reading \'uuid\')' to equal 'TypeError: Cannot read property \'uuid\' of undefined'

    Difference:

    - Expected
    + Received

    - TypeError: Cannot read property 'uuid' of undefined
    + TypeError: Cannot read properties of undefined (reading 'uuid')

      152 |       }
      153 | 
    > 154 |       expect(error.toString()).to.be.eq("TypeError: Cannot read property 'uuid' of undefined");
          |                                      ^
      155 |     });
      156 | 
      157 |     it('handle - throws error if the parameter is required, type file provided', async () => {

      at Object.<anonymous> (test/ActionParameterHandler.spec.ts:154:38)


Test Suites: 1 failed, 25 passed, 26 total
Tests:       1 failed, 181 passed, 182 total
Snapshots:   0 total
Time:        13.284 s
Ran all test suites.
************* run test done *************
routing-controllers is testing ./Variants/express/variant16/express
************* npm unlink module *************
************* npm unlink module done *************
************* npm unlink globally *************
************* npm unlink globally done *************
************* npm link globally *************
************* npm link globally done *************
************* npm link module *************
************* npm link module done *************
************* start run test *************
ts-jest[config] (WARN) The option `tsConfig` is deprecated and will be removed in ts-jest 27, use `tsconfig` instead
FAIL test/ActionParameterHandler.spec.ts
  ActionParameterHandler
    positive
      ✓ handle - should process string parameters (29 ms)
      ✓ handle - should process string parameters, returns empty if a given string is empty (1 ms)
      ✓ handle - should process number parameters
      ✓ handle - undefined on empty object provided
      ✓ handle - null provided (10 ms)
    negative
      ✕ handle - throws error if the parameter is required (7 ms)
      ✓ handle - throws error if the parameter is required, type file provided (1 ms)

  ● ActionParameterHandler › negative › handle - throws error if the parameter is required

    Expected value   "TypeError: Cannot read property 'uuid' of undefined"
    Received:
      "TypeError: Cannot read properties of undefined (reading 'uuid')"

    Message:
      expected 'TypeError: Cannot read properties of undefined (reading \'uuid\')' to equal 'TypeError: Cannot read property \'uuid\' of undefined'

    Difference:

    - Expected
    + Received

    - TypeError: Cannot read property 'uuid' of undefined
    + TypeError: Cannot read properties of undefined (reading 'uuid')

      152 |       }
      153 | 
    > 154 |       expect(error.toString()).to.be.eq("TypeError: Cannot read property 'uuid' of undefined");
          |                                      ^
      155 |     });
      156 | 
      157 |     it('handle - throws error if the parameter is required, type file provided', async () => {

      at Object.<anonymous> (test/ActionParameterHandler.spec.ts:154:38)

PASS test/functional/controller-methods.spec.ts
    controller methods
      ✓ get should respond with proper status code, headers and body content (20 ms)
      ✓ post respond with proper status code, headers and body content (4 ms)
      ✓ put respond with proper status code, headers and body content (3 ms)
      ✓ patch respond with proper status code, headers and body content (3 ms)
      ✓ delete respond with proper status code, headers and body content (3 ms)
      ✓ head respond with proper status code, headers and body content (2 ms)
      ✓ custom method (post) respond with proper status code, headers and body content (3 ms)
      ✓ custom method (delete) respond with proper status code, headers and body content (2 ms)
      ✓ route should work with parameter (4 ms)
      ✓ route should work with regexp parameter (2 ms)
      ✓ should respond with 404 when regexp does not match (8 ms)
      ✓ route should work with string regexp parameter (2 ms)
      ✓ should respond with 404 when regexp does not match (3 ms)
      ✓ should return result from a promise (504 ms)
      ✓ should respond with 500 if promise failed (504 ms)
      ✓ should respond with 204 No Content when null returned in action (5 ms)
      ✓ should respond with 404 Not Found text when undefined returned in action (30 ms)
      ✓ should respond with 404 Not Found JSON when undefined returned in action (3 ms)
      ✓ should respond with 200 and text/html even in json controller's method (3 ms)
      ✓ should respond with 200 and text/plain even in json controller's method (1 ms)
      ✓ should respond with 401 and text/html when UnauthorizedError throwed even in json controller's method (5 ms)
      ✓ should respond with 401 and aplication/json when UnauthorizedError is thrown in standard json controller's method (2 ms)

PASS test/functional/json-controller-methods.spec.ts
    json-controller methods
      ✓ get should respond with proper status code, headers and body content (11 ms)
      ✓ post respond with proper status code, headers and body content (3 ms)
      ✓ put respond with proper status code, headers and body content (2 ms)
      ✓ patch respond with proper status code, headers and body content (2 ms)
      ✓ delete respond with proper status code, headers and body content (3 ms)
      ✓ head respond with proper status code, headers and body content (2 ms)
      ✓ custom method (post) respond with proper status code, headers and body content (2 ms)
      ✓ custom method (delete) respond with proper status code, headers and body content (2 ms)
      ✓ route should work with parameter (2 ms)
      ✓ route should work with regexp parameter (3 ms)
      ✓ should respond with 404 when regexp does not match (4 ms)
      ✓ route should work with string regexp parameter (3 ms)
      ✓ should respond with 404 when regexp does not match (2 ms)
      ✓ should return result from a promise (504 ms)
      ✓ should respond with 500 if promise failed (504 ms)

PASS test/functional/interceptors.spec.ts
    interceptor
      ✓ custom interceptor function should replace returned content (22 ms)
      ✓ custom interceptor class should replace returned content (3 ms)
      ✓ custom interceptor class used on the whole controller should replace returned content (2 ms)
      ✓ global interceptor class should replace returned content (3 ms)
      ✓ interceptors should support promises (1004 ms)

PASS test/functional/action-params.spec.ts
    ✓ @Req and @Res should be provided as Request and Response objects (10 ms)
    ✓ @Res writing directly to the response should work (4 ms)
    ✓ @Param should give a param from route (4 ms)
    ✓ @Param multiple params should give a proper values from route (2 ms)
    ✓ @SessionParam without middleware (23 ms)
    ✓ @Session should return a value from session (11 ms)
    ✓ @Session(param) should allow to inject empty property (3 ms)
    ✓ @QueryParams should give a proper values from request's query parameters (9 ms)
    ✓ @QueryParams should give a proper values from request's query parameters and one multiple value (7 ms)
    ✓ @QueryParams should give a proper values from request's query with validate whitelist option on (3 ms)
    ✓ @QueryParams should give a proper values from request's query parameters with nested json (5 ms)
    ✓ @QueryParams should not validate request query parameters when it's turned off in validator options (12 ms)
    ✓ @QueryParams should give a proper values from request's optional query parameters (3 ms)
    ✓ @QueryParam should give a proper values from request query parameters (2 ms)
    ✓ @QueryParam should give an array of string with only one query parameter (2 ms)
    ✓ @QueryParam should give an array of string with multiple query parameters (3 ms)
    ✓ @QueryParam should give an array of number with only one query parameter (3 ms)
    ✓ @QueryParam should give an array of number with multiple query parameters (2 ms)
    ✓ @QueryParam should give an array of date with only one query parameter (2 ms)
    ✓ @QueryParam should give an array of date with multiple query parameters (2 ms)
    ✓ @QueryParam when required params must be provided and they should not be empty (8 ms)
    ✓ @QueryParam when the type is Date then it should be parsed (2 ms)
    ✓ @QueryParam when the type is Date and it is invalid then the response should be a BadRequest error (3 ms)
    ✓ @QueryParam when parseJson flag is used query param must be converted to object (1 ms)
    ✓ @HeaderParam should give a proper values from request headers (2 ms)
    ✓ @HeaderParam when required is params must be provided and they should not be empty (1 ms)
    ✓ @HeaderParam should fail with invalid request options (5 ms)
    ✓ @HeaderParam should fail with missing required params (3 ms)
    ✓ for @HeaderParam when parseJson flag is used query param must be converted to object (2 ms)
    ✓ @CookieParam should give a proper values from request headers (3 ms)
    ✓ @CookieParam when required is params must be provided and they should not be empty (3 ms)
    ✓ @CookieParam when parseJson flag is used query param must be converted to object (2 ms)
    ✓ @Body should provide a request body (12 ms)
    ✓ @Body should fail if required body was not provided (7 ms)
    ✓ @Body should provide a json object for json-typed controllers and actions (3 ms)
    ✓ @Body should fail if required body was not provided for json-typed controllers and actions (4 ms)
    ✓ @BodyParam should provide a json object for json-typed controllers and actions (2 ms)
    ✓ @BodyParam should fail if required body was not provided for json-typed controllers and actions (22 ms)
    ✓ @Body using application/x-www-form-urlencoded should handle url encoded form data (4 ms)
    ✓ @UploadedFile using multipart/form-data should provide uploaded file with the given name (12 ms)
    ✓ @UploadedFile with @Body should return both the file and the body (6 ms)
    ✓ @UploadedFile with @BodyParam should return both the file and the body param (5 ms)
    ✓ @UploadedFile with passed uploading options (limit) should throw an error (5 ms)
    ✓ @UploadedFile when required is used files must be provided (6 ms)
    ✓ @UploadedFiles should provide uploaded files with the given name (5 ms)
    ✓ @UploadedFiles with passed uploading options (limit) should throw an error (5 ms)
    ✓ @UploadedFiles when required is used files must be provided (5 ms)

PASS test/functional/controller-options.spec.ts
    controller options
      ✓ controller transform is enabled by default (58 ms)
      ✓ when controller transform is enabled (6 ms)
      ✓ when controller transform is disabled (3 ms)

PASS test/functional/auth-decorator.spec.ts
    Controller responds with value when Authorization succeeds (async)
      ✓ without roles (63 ms)
      ✓ with roles (15 ms)
      ✓ async (24 ms)
    Controller responds with value when Authorization succeeds (sync)
      ✓ without roles (4 ms)
      ✓ with roles (4 ms)
      ✓ async (14 ms)
    Authorized Decorators Http Status Code
      ✓ without roles (37 ms)
      ✓ with roles (4 ms)
    Authorization checker allows to throw (async)
      ✓ custom errors (4 ms)
    Authorization checker allows to throw (sync)
      ✓ custom errors (4 ms)

PASS test/functional/load-from-directory.spec.ts
    loading all controllers from the given directories
      ✓ should load all controllers (35 ms)
    loading all express middlewares and error handlers from the given directories
      ✓ should succeed (8 ms)
      ✓ should fail (16 ms)

PASS test/functional/express-custom-error-handling.spec.ts
    custom express error handling
      ✓ should not call global error handler middleware if there was no errors (23 ms)
      ✓ should call global error handler middleware (20 ms)

PASS test/functional/other-controller-decorators.spec.ts
    other controller decorators
      ✓ should return httpCode set by @HttpCode decorator (27 ms)
      ✓ should return custom code when @OnNull (33 ms)
      ✓ should return custom error message and code when @OnUndefined is used with Error class (7 ms)
      ✓ should return custom code when @OnUndefined (8 ms)
      ✓ should return content-type in the response when @ContentType is used (2 ms)
      ✓ should return content-type in the response when @ContentType is used (2 ms)
      ✓ should return response with custom headers when @Header is used (4 ms)
      ✓ should relocate to new location when @Location is used (2 ms)

PASS test/functional/class-transformer-options.spec.ts
    should not use any options if not set
      ✓ technical wrapper (23 ms)
    should apply global options
      ✓ technical wrapper (9 ms)
    should apply local options
      ✓ technical wrapper (9 ms)

PASS test/functional/controller-base-routes.spec.ts
    controller > base routes functionality
      ✓ get should respond with proper status code, headers and body content (61 ms)
      ✓ get should respond with proper status code, headers and body content (4 ms)
      ✓ get should respond with proper status code, headers and body content - 2nd pass (4 ms)
      ✓ wrong route should respond with 404 error (4 ms)
      ✓ wrong route should respond with 404 error (3 ms)
      ✓ wrong route should respond with 404 error (2 ms)

PASS test/unit/controller-inheritance.spec.ts
  controller inheritance
    ✓ should build empty meta for empty set (10 ms)
    ✓ should build meta if the only derivative controller is given (2 ms)
    ✓ should build meta if the only autonomous controller is given (1 ms)
    ✓ should build meta both when autonomous and derivative controllers are given (1 ms)

PASS test/functional/express-middlewares.spec.ts
    express middlewares
      ✓ should call a global middlewares (8 ms)
      ✓ should use a custom middleware when @UseBefore or @UseAfter is used (4 ms)
      ✓ should call middleware and call it before controller action when @UseBefore is used (4 ms)
      ✓ should call middleware and call it after controller action when @UseAfter is used (2 ms)
      ✓ should call before middleware and call after middleware when @UseAfter and @UseAfter are used (3 ms)
      ✓ should handle errors in custom middlewares (26 ms)

PASS test/functional/container.spec.ts
    using typedi container should be possible
      ✓ typedi container (62 ms)
    using custom container should be possible
      ✓ custom container (6 ms)
    using custom container with fallback should be possible
      ✓ custom container with fallback (7 ms)
    using custom container with fallback and fallback on throw error should be possible
      ✓ custom container with fallback and fallback on throw error (7 ms)

PASS test/functional/class-validator-options.spec.ts
    no options
      ✓ should not use any options if not set (63 ms)
    global options
      should merge local validation options with global validation options prioritizing local
        ✓ succeed (5 ms)
      should pass the valid param after validation
        ✓ succeed (4 ms)
        ✓ should contain param name on validation failed (17 ms)
    local options
      ✓ should apply local options (5 ms)

PASS test/functional/express-error-handling.spec.ts
    express error handling
      ✓ should not call global error handler middleware if there was no errors (11 ms)
      ✓ should call global error handler middleware (17 ms)
      ✓ should call global error handler middleware (5 ms)
      ✓ should call error handler middleware if used (3 ms)
      ✓ should not execute next middleware if soft error handled specifically and stopped error bubbling (4 ms)
      ✓ should process JsonErrors by their toJSON method if it exists (4 ms)

PASS test/functional/defaults.spec.ts
    defaults
      ✓ should return undefinedResultCode from defaults config for void function (8 ms)
      ✓ should return undefinedResultCode from defaults config for promise void function (3 ms)
      ✓ should return 400 from required paramOptions (17 ms)
      ✓ should return nullResultCode from defaults config (3 ms)
      ✓ should return status code from OnUndefined annotation (3 ms)
      ✓ should mark arg optional from QueryParam annotation (4 ms)

PASS test/functional/global-options.spec.ts
    routing-controllers global options
      useClassTransformer default value
        ✓ useClassTransformer by default must be set to true (89 ms)
      when useClassTransformer is set to true
        ✓ useClassTransformer is enabled (5 ms)
      when useClassTransformer is set to false
        ✓ useClassTransformer is disabled (3 ms)
      when routePrefix is used all controller routes should be appended by it
        ✓ routePrefix is enabled (6 ms)

PASS test/functional/render-decorator.spec.ts
    template rendering
      ✓ should render a template and use given variables (17 ms)
      ✓ should render a template with given variables and locals variables (5 ms)

PASS test/functional/action-options.spec.ts
    ✓ should use controller options when action transform options are not set (32 ms)
    ✓ should override controller options with action transformRequest option (4 ms)
    ✓ should override controller options with action transformResponse option (3 ms)

PASS test/functional/redirect-decorator.spec.ts
    dynamic redirect
      ✓ using template (38 ms)
      ✓ using override (6 ms)
      ✓ using original (5 ms)

PASS test/functional/express-global-before-error-handling.spec.ts
    custom express global before middleware error handling
      ✓ should call global error handler middleware with CustomError (39 ms)

PASS test/functional/middlewares-order.spec.ts
    loaded direct from array
      ✓ should call middlewares in order defined by items order (24 ms)
    specified by priority option
      ✓ should call middlewares in order defined by priority parameter of decorator (3 ms)

PASS test/functional/special-result-send.spec.ts
    special result value treatment
      ✓ should pipe stream to response (22 ms)
      ✓ should send raw binary data from Buffer (3 ms)
      ✓ should send raw binary data from UIntArray (3 ms)

PASS test/functional/error-subclasses.spec.ts
  HttpError
    ✓ should be instance of HttpError and Error (3 ms)
  BadRequestError
    ✓ should be instance of BadRequestError, HttpError and Error (2 ms)

Summary of all failing tests
FAIL test/ActionParameterHandler.spec.ts
  ● ActionParameterHandler › negative › handle - throws error if the parameter is required

    Expected value   "TypeError: Cannot read property 'uuid' of undefined"
    Received:
      "TypeError: Cannot read properties of undefined (reading 'uuid')"

    Message:
      expected 'TypeError: Cannot read properties of undefined (reading \'uuid\')' to equal 'TypeError: Cannot read property \'uuid\' of undefined'

    Difference:

    - Expected
    + Received

    - TypeError: Cannot read property 'uuid' of undefined
    + TypeError: Cannot read properties of undefined (reading 'uuid')

      152 |       }
      153 | 
    > 154 |       expect(error.toString()).to.be.eq("TypeError: Cannot read property 'uuid' of undefined");
          |                                      ^
      155 |     });
      156 | 
      157 |     it('handle - throws error if the parameter is required, type file provided', async () => {

      at Object.<anonymous> (test/ActionParameterHandler.spec.ts:154:38)


Test Suites: 1 failed, 25 passed, 26 total
Tests:       1 failed, 181 passed, 182 total
Snapshots:   0 total
Time:        13.075 s, estimated 14 s
Ran all test suites.
************* run test done *************
routing-controllers is testing ./Variants/express/variant15/express
************* npm unlink module *************
************* npm unlink module done *************
************* npm unlink globally *************
************* npm unlink globally done *************
************* npm link globally *************
************* npm link globally done *************
************* npm link module *************
************* npm link module done *************
************* start run test *************
ts-jest[config] (WARN) The option `tsConfig` is deprecated and will be removed in ts-jest 27, use `tsconfig` instead
FAIL test/ActionParameterHandler.spec.ts
  ActionParameterHandler
    positive
      ✓ handle - should process string parameters (31 ms)
      ✓ handle - should process string parameters, returns empty if a given string is empty
      ✓ handle - should process number parameters (1 ms)
      ✓ handle - undefined on empty object provided
      ✓ handle - null provided (10 ms)
    negative
      ✕ handle - throws error if the parameter is required (7 ms)
      ✓ handle - throws error if the parameter is required, type file provided (1 ms)

  ● ActionParameterHandler › negative › handle - throws error if the parameter is required

    Expected value   "TypeError: Cannot read property 'uuid' of undefined"
    Received:
      "TypeError: Cannot read properties of undefined (reading 'uuid')"

    Message:
      expected 'TypeError: Cannot read properties of undefined (reading \'uuid\')' to equal 'TypeError: Cannot read property \'uuid\' of undefined'

    Difference:

    - Expected
    + Received

    - TypeError: Cannot read property 'uuid' of undefined
    + TypeError: Cannot read properties of undefined (reading 'uuid')

      152 |       }
      153 | 
    > 154 |       expect(error.toString()).to.be.eq("TypeError: Cannot read property 'uuid' of undefined");
          |                                      ^
      155 |     });
      156 | 
      157 |     it('handle - throws error if the parameter is required, type file provided', async () => {

      at Object.<anonymous> (test/ActionParameterHandler.spec.ts:154:38)

PASS test/functional/controller-methods.spec.ts
    controller methods
      ✓ get should respond with proper status code, headers and body content (20 ms)
      ✓ post respond with proper status code, headers and body content (5 ms)
      ✓ put respond with proper status code, headers and body content (4 ms)
      ✓ patch respond with proper status code, headers and body content (3 ms)
      ✓ delete respond with proper status code, headers and body content (3 ms)
      ✓ head respond with proper status code, headers and body content (2 ms)
      ✓ custom method (post) respond with proper status code, headers and body content (3 ms)
      ✓ custom method (delete) respond with proper status code, headers and body content (2 ms)
      ✓ route should work with parameter (3 ms)
      ✓ route should work with regexp parameter (3 ms)
      ✓ should respond with 404 when regexp does not match (7 ms)
      ✓ route should work with string regexp parameter (2 ms)
      ✓ should respond with 404 when regexp does not match (2 ms)
      ✓ should return result from a promise (505 ms)
      ✓ should respond with 500 if promise failed (505 ms)
      ✓ should respond with 204 No Content when null returned in action (16 ms)
      ✓ should respond with 404 Not Found text when undefined returned in action (21 ms)
      ✓ should respond with 404 Not Found JSON when undefined returned in action (3 ms)
      ✓ should respond with 200 and text/html even in json controller's method (2 ms)
      ✓ should respond with 200 and text/plain even in json controller's method (2 ms)
      ✓ should respond with 401 and text/html when UnauthorizedError throwed even in json controller's method (4 ms)
      ✓ should respond with 401 and aplication/json when UnauthorizedError is thrown in standard json controller's method (3 ms)

PASS test/functional/json-controller-methods.spec.ts
    json-controller methods
      ✓ get should respond with proper status code, headers and body content (11 ms)
      ✓ post respond with proper status code, headers and body content (3 ms)
      ✓ put respond with proper status code, headers and body content (2 ms)
      ✓ patch respond with proper status code, headers and body content (3 ms)
      ✓ delete respond with proper status code, headers and body content (2 ms)
      ✓ head respond with proper status code, headers and body content (3 ms)
      ✓ custom method (post) respond with proper status code, headers and body content (2 ms)
      ✓ custom method (delete) respond with proper status code, headers and body content (2 ms)
      ✓ route should work with parameter (3 ms)
      ✓ route should work with regexp parameter (3 ms)
      ✓ should respond with 404 when regexp does not match (4 ms)
      ✓ route should work with string regexp parameter (3 ms)
      ✓ should respond with 404 when regexp does not match (2 ms)
      ✓ should return result from a promise (504 ms)
      ✓ should respond with 500 if promise failed (504 ms)

PASS test/functional/interceptors.spec.ts
    interceptor
      ✓ custom interceptor function should replace returned content (9 ms)
      ✓ custom interceptor class should replace returned content (3 ms)
      ✓ custom interceptor class used on the whole controller should replace returned content (3 ms)
      ✓ global interceptor class should replace returned content (2 ms)
      ✓ interceptors should support promises (1003 ms)

PASS test/functional/action-params.spec.ts
    ✓ @Req and @Res should be provided as Request and Response objects (10 ms)
    ✓ @Res writing directly to the response should work (3 ms)
    ✓ @Param should give a param from route (4 ms)
    ✓ @Param multiple params should give a proper values from route (2 ms)
    ✓ @SessionParam without middleware (23 ms)
    ✓ @Session should return a value from session (11 ms)
    ✓ @Session(param) should allow to inject empty property (3 ms)
    ✓ @QueryParams should give a proper values from request's query parameters (10 ms)
    ✓ @QueryParams should give a proper values from request's query parameters and one multiple value (6 ms)
    ✓ @QueryParams should give a proper values from request's query with validate whitelist option on (3 ms)
    ✓ @QueryParams should give a proper values from request's query parameters with nested json (18 ms)
    ✓ @QueryParams should not validate request query parameters when it's turned off in validator options (3 ms)
    ✓ @QueryParams should give a proper values from request's optional query parameters (3 ms)
    ✓ @QueryParam should give a proper values from request query parameters (2 ms)
    ✓ @QueryParam should give an array of string with only one query parameter (2 ms)
    ✓ @QueryParam should give an array of string with multiple query parameters (2 ms)
    ✓ @QueryParam should give an array of number with only one query parameter (3 ms)
    ✓ @QueryParam should give an array of number with multiple query parameters (4 ms)
    ✓ @QueryParam should give an array of date with only one query parameter (2 ms)
    ✓ @QueryParam should give an array of date with multiple query parameters (2 ms)
    ✓ @QueryParam when required params must be provided and they should not be empty (7 ms)
    ✓ @QueryParam when the type is Date then it should be parsed (1 ms)
    ✓ @QueryParam when the type is Date and it is invalid then the response should be a BadRequest error (3 ms)
    ✓ @QueryParam when parseJson flag is used query param must be converted to object (2 ms)
    ✓ @HeaderParam should give a proper values from request headers (2 ms)
    ✓ @HeaderParam when required is params must be provided and they should not be empty (2 ms)
    ✓ @HeaderParam should fail with invalid request options (2 ms)
    ✓ @HeaderParam should fail with missing required params (4 ms)
    ✓ for @HeaderParam when parseJson flag is used query param must be converted to object (3 ms)
    ✓ @CookieParam should give a proper values from request headers (3 ms)
    ✓ @CookieParam when required is params must be provided and they should not be empty (3 ms)
    ✓ @CookieParam when parseJson flag is used query param must be converted to object (2 ms)
    ✓ @Body should provide a request body (13 ms)
    ✓ @Body should fail if required body was not provided (6 ms)
    ✓ @Body should provide a json object for json-typed controllers and actions (3 ms)
    ✓ @Body should fail if required body was not provided for json-typed controllers and actions (8 ms)
    ✓ @BodyParam should provide a json object for json-typed controllers and actions (3 ms)
    ✓ @BodyParam should fail if required body was not provided for json-typed controllers and actions (17 ms)
    ✓ @Body using application/x-www-form-urlencoded should handle url encoded form data (4 ms)
    ✓ @UploadedFile using multipart/form-data should provide uploaded file with the given name (12 ms)
    ✓ @UploadedFile with @Body should return both the file and the body (6 ms)
    ✓ @UploadedFile with @BodyParam should return both the file and the body param (4 ms)
    ✓ @UploadedFile with passed uploading options (limit) should throw an error (5 ms)
    ✓ @UploadedFile when required is used files must be provided (7 ms)
    ✓ @UploadedFiles should provide uploaded files with the given name (4 ms)
    ✓ @UploadedFiles with passed uploading options (limit) should throw an error (5 ms)
    ✓ @UploadedFiles when required is used files must be provided (4 ms)

PASS test/functional/auth-decorator.spec.ts
    Controller responds with value when Authorization succeeds (async)
      ✓ without roles (74 ms)
      ✓ with roles (14 ms)
      ✓ async (25 ms)
    Controller responds with value when Authorization succeeds (sync)
      ✓ without roles (5 ms)
      ✓ with roles (3 ms)
      ✓ async (14 ms)
    Authorized Decorators Http Status Code
      ✓ without roles (21 ms)
      ✓ with roles (4 ms)
    Authorization checker allows to throw (async)
      ✓ custom errors (5 ms)
    Authorization checker allows to throw (sync)
      ✓ custom errors (4 ms)

PASS test/functional/controller-base-routes.spec.ts
    controller > base routes functionality
      ✓ get should respond with proper status code, headers and body content (74 ms)
      ✓ get should respond with proper status code, headers and body content (4 ms)
      ✓ get should respond with proper status code, headers and body content - 2nd pass (12 ms)
      ✓ wrong route should respond with 404 error (6 ms)
      ✓ wrong route should respond with 404 error (4 ms)
      ✓ wrong route should respond with 404 error (4 ms)

PASS test/functional/other-controller-decorators.spec.ts
    other controller decorators
      ✓ should return httpCode set by @HttpCode decorator (12 ms)
      ✓ should return custom code when @OnNull (35 ms)
      ✓ should return custom error message and code when @OnUndefined is used with Error class (8 ms)
      ✓ should return custom code when @OnUndefined (10 ms)
      ✓ should return content-type in the response when @ContentType is used (2 ms)
      ✓ should return content-type in the response when @ContentType is used (2 ms)
      ✓ should return response with custom headers when @Header is used (15 ms)
      ✓ should relocate to new location when @Location is used (2 ms)

PASS test/functional/redirect-decorator.spec.ts
    dynamic redirect
      ✓ using template (14 ms)
      ✓ using override (4 ms)
      ✓ using original (4 ms)

PASS test/functional/load-from-directory.spec.ts
    loading all controllers from the given directories
      ✓ should load all controllers (19 ms)
    loading all express middlewares and error handlers from the given directories
      ✓ should succeed (28 ms)
      ✓ should fail (24 ms)

PASS test/functional/controller-options.spec.ts
    controller options
      ✓ controller transform is enabled by default (195 ms)
      ✓ when controller transform is enabled (9 ms)
      ✓ when controller transform is disabled (6 ms)

PASS test/functional/class-validator-options.spec.ts
    no options
      ✓ should not use any options if not set (69 ms)
    global options
      should merge local validation options with global validation options prioritizing local
        ✓ succeed (6 ms)
      should pass the valid param after validation
        ✓ succeed (5 ms)
        ✓ should contain param name on validation failed (15 ms)
    local options
      ✓ should apply local options (6 ms)

PASS test/functional/global-options.spec.ts
    routing-controllers global options
      useClassTransformer default value
        ✓ useClassTransformer by default must be set to true (81 ms)
      when useClassTransformer is set to true
        ✓ useClassTransformer is enabled (4 ms)
      when useClassTransformer is set to false
        ✓ useClassTransformer is disabled (4 ms)
      when routePrefix is used all controller routes should be appended by it
        ✓ routePrefix is enabled (6 ms)

PASS test/functional/defaults.spec.ts
    defaults
      ✓ should return undefinedResultCode from defaults config for void function (21 ms)
      ✓ should return undefinedResultCode from defaults config for promise void function (2 ms)
      ✓ should return 400 from required paramOptions (17 ms)
      ✓ should return nullResultCode from defaults config (3 ms)
      ✓ should return status code from OnUndefined annotation (3 ms)
      ✓ should mark arg optional from QueryParam annotation (3 ms)

PASS test/functional/class-transformer-options.spec.ts
    should not use any options if not set
      ✓ technical wrapper (25 ms)
    should apply global options
      ✓ technical wrapper (5 ms)
    should apply local options
      ✓ technical wrapper (4 ms)

PASS test/unit/controller-inheritance.spec.ts
  controller inheritance
    ✓ should build empty meta for empty set (11 ms)
    ✓ should build meta if the only derivative controller is given (1 ms)
    ✓ should build meta if the only autonomous controller is given (1 ms)
    ✓ should build meta both when autonomous and derivative controllers are given (1 ms)

PASS test/functional/express-middlewares.spec.ts
    express middlewares
      ✓ should call a global middlewares (9 ms)
      ✓ should use a custom middleware when @UseBefore or @UseAfter is used (3 ms)
      ✓ should call middleware and call it before controller action when @UseBefore is used (3 ms)
      ✓ should call middleware and call it after controller action when @UseAfter is used (2 ms)
      ✓ should call before middleware and call after middleware when @UseAfter and @UseAfter are used (3 ms)
      ✓ should handle errors in custom middlewares (20 ms)

PASS test/functional/container.spec.ts
    using typedi container should be possible
      ✓ typedi container (65 ms)
    using custom container should be possible
      ✓ custom container (5 ms)
    using custom container with fallback should be possible
      ✓ custom container with fallback (10 ms)
    using custom container with fallback and fallback on throw error should be possible
      ✓ custom container with fallback and fallback on throw error (10 ms)

PASS test/functional/express-error-handling.spec.ts
    express error handling
      ✓ should not call global error handler middleware if there was no errors (12 ms)
      ✓ should call global error handler middleware (18 ms)
      ✓ should call global error handler middleware (21 ms)
      ✓ should call error handler middleware if used (5 ms)
      ✓ should not execute next middleware if soft error handled specifically and stopped error bubbling (6 ms)
      ✓ should process JsonErrors by their toJSON method if it exists (4 ms)

PASS test/functional/action-options.spec.ts
    ✓ should use controller options when action transform options are not set (18 ms)
    ✓ should override controller options with action transformRequest option (5 ms)
    ✓ should override controller options with action transformResponse option (2 ms)

PASS test/functional/express-custom-error-handling.spec.ts
    custom express error handling
      ✓ should not call global error handler middleware if there was no errors (25 ms)
      ✓ should call global error handler middleware (18 ms)

PASS test/functional/render-decorator.spec.ts
    template rendering
      ✓ should render a template and use given variables (28 ms)
      ✓ should render a template with given variables and locals variables (5 ms)

PASS test/functional/express-global-before-error-handling.spec.ts
    custom express global before middleware error handling
      ✓ should call global error handler middleware with CustomError (37 ms)

PASS test/functional/middlewares-order.spec.ts
    loaded direct from array
      ✓ should call middlewares in order defined by items order (27 ms)
    specified by priority option
      ✓ should call middlewares in order defined by priority parameter of decorator (3 ms)

PASS test/functional/special-result-send.spec.ts
    special result value treatment
      ✓ should pipe stream to response (25 ms)
      ✓ should send raw binary data from Buffer (5 ms)
      ✓ should send raw binary data from UIntArray (3 ms)

PASS test/functional/error-subclasses.spec.ts
  HttpError
    ✓ should be instance of HttpError and Error (3 ms)
  BadRequestError
    ✓ should be instance of BadRequestError, HttpError and Error (1 ms)

Summary of all failing tests
FAIL test/ActionParameterHandler.spec.ts
  ● ActionParameterHandler › negative › handle - throws error if the parameter is required

    Expected value   "TypeError: Cannot read property 'uuid' of undefined"
    Received:
      "TypeError: Cannot read properties of undefined (reading 'uuid')"

    Message:
      expected 'TypeError: Cannot read properties of undefined (reading \'uuid\')' to equal 'TypeError: Cannot read property \'uuid\' of undefined'

    Difference:

    - Expected
    + Received

    - TypeError: Cannot read property 'uuid' of undefined
    + TypeError: Cannot read properties of undefined (reading 'uuid')

      152 |       }
      153 | 
    > 154 |       expect(error.toString()).to.be.eq("TypeError: Cannot read property 'uuid' of undefined");
          |                                      ^
      155 |     });
      156 | 
      157 |     it('handle - throws error if the parameter is required, type file provided', async () => {

      at Object.<anonymous> (test/ActionParameterHandler.spec.ts:154:38)


Test Suites: 1 failed, 25 passed, 26 total
Tests:       1 failed, 181 passed, 182 total
Snapshots:   0 total
Time:        13.127 s
Ran all test suites.
************* run test done *************
routing-controllers is testing ./Variants/express/variant14/express
************* npm unlink module *************
************* npm unlink module done *************
************* npm unlink globally *************
************* npm unlink globally done *************
************* npm link globally *************
************* npm link globally done *************
************* npm link module *************
************* npm link module done *************
************* start run test *************
ts-jest[config] (WARN) The option `tsConfig` is deprecated and will be removed in ts-jest 27, use `tsconfig` instead
FAIL test/ActionParameterHandler.spec.ts
  ActionParameterHandler
    positive
      ✓ handle - should process string parameters (33 ms)
      ✓ handle - should process string parameters, returns empty if a given string is empty (1 ms)
      ✓ handle - should process number parameters
      ✓ handle - undefined on empty object provided (1 ms)
      ✓ handle - null provided (10 ms)
    negative
      ✕ handle - throws error if the parameter is required (8 ms)
      ✓ handle - throws error if the parameter is required, type file provided (1 ms)

  ● ActionParameterHandler › negative › handle - throws error if the parameter is required

    Expected value   "TypeError: Cannot read property 'uuid' of undefined"
    Received:
      "TypeError: Cannot read properties of undefined (reading 'uuid')"

    Message:
      expected 'TypeError: Cannot read properties of undefined (reading \'uuid\')' to equal 'TypeError: Cannot read property \'uuid\' of undefined'

    Difference:

    - Expected
    + Received

    - TypeError: Cannot read property 'uuid' of undefined
    + TypeError: Cannot read properties of undefined (reading 'uuid')

      152 |       }
      153 | 
    > 154 |       expect(error.toString()).to.be.eq("TypeError: Cannot read property 'uuid' of undefined");
          |                                      ^
      155 |     });
      156 | 
      157 |     it('handle - throws error if the parameter is required, type file provided', async () => {

      at Object.<anonymous> (test/ActionParameterHandler.spec.ts:154:38)

PASS test/functional/controller-methods.spec.ts
    controller methods
      ✓ get should respond with proper status code, headers and body content (26 ms)
      ✓ post respond with proper status code, headers and body content (8 ms)
      ✓ put respond with proper status code, headers and body content (5 ms)
      ✓ patch respond with proper status code, headers and body content (4 ms)
      ✓ delete respond with proper status code, headers and body content (5 ms)
      ✓ head respond with proper status code, headers and body content (4 ms)
      ✓ custom method (post) respond with proper status code, headers and body content (4 ms)
      ✓ custom method (delete) respond with proper status code, headers and body content (4 ms)
      ✓ route should work with parameter (4 ms)
      ✓ route should work with regexp parameter (10 ms)
      ✓ should respond with 404 when regexp does not match (6 ms)
      ✓ route should work with string regexp parameter (5 ms)
      ✓ should respond with 404 when regexp does not match (3 ms)
      ✓ should return result from a promise (519 ms)
      ✓ should respond with 500 if promise failed (504 ms)
      ✓ should respond with 204 No Content when null returned in action (6 ms)
      ✓ should respond with 404 Not Found text when undefined returned in action (21 ms)
      ✓ should respond with 404 Not Found JSON when undefined returned in action (3 ms)
      ✓ should respond with 200 and text/html even in json controller's method (2 ms)
      ✓ should respond with 200 and text/plain even in json controller's method (2 ms)
      ✓ should respond with 401 and text/html when UnauthorizedError throwed even in json controller's method (5 ms)
      ✓ should respond with 401 and aplication/json when UnauthorizedError is thrown in standard json controller's method (2 ms)

PASS test/functional/json-controller-methods.spec.ts
    json-controller methods
      ✓ get should respond with proper status code, headers and body content (10 ms)
      ✓ post respond with proper status code, headers and body content (3 ms)
      ✓ put respond with proper status code, headers and body content (3 ms)
      ✓ patch respond with proper status code, headers and body content (2 ms)
      ✓ delete respond with proper status code, headers and body content (2 ms)
      ✓ head respond with proper status code, headers and body content (3 ms)
      ✓ custom method (post) respond with proper status code, headers and body content (2 ms)
      ✓ custom method (delete) respond with proper status code, headers and body content (2 ms)
      ✓ route should work with parameter (3 ms)
      ✓ route should work with regexp parameter (3 ms)
      ✓ should respond with 404 when regexp does not match (3 ms)
      ✓ route should work with string regexp parameter (3 ms)
      ✓ should respond with 404 when regexp does not match (2 ms)
      ✓ should return result from a promise (504 ms)
      ✓ should respond with 500 if promise failed (504 ms)

PASS test/functional/interceptors.spec.ts
    interceptor
      ✓ custom interceptor function should replace returned content (10 ms)
      ✓ custom interceptor class should replace returned content (3 ms)
      ✓ custom interceptor class used on the whole controller should replace returned content (2 ms)
      ✓ global interceptor class should replace returned content (2 ms)
      ✓ interceptors should support promises (1005 ms)

PASS test/functional/action-params.spec.ts
    ✓ @Req and @Res should be provided as Request and Response objects (10 ms)
    ✓ @Res writing directly to the response should work (4 ms)
    ✓ @Param should give a param from route (4 ms)
    ✓ @Param multiple params should give a proper values from route (2 ms)
    ✓ @SessionParam without middleware (23 ms)
    ✓ @Session should return a value from session (10 ms)
    ✓ @Session(param) should allow to inject empty property (3 ms)
    ✓ @QueryParams should give a proper values from request's query parameters (10 ms)
    ✓ @QueryParams should give a proper values from request's query parameters and one multiple value (17 ms)
    ✓ @QueryParams should give a proper values from request's query with validate whitelist option on (4 ms)
    ✓ @QueryParams should give a proper values from request's query parameters with nested json (4 ms)
    ✓ @QueryParams should not validate request query parameters when it's turned off in validator options (2 ms)
    ✓ @QueryParams should give a proper values from request's optional query parameters (3 ms)
    ✓ @QueryParam should give a proper values from request query parameters (2 ms)
    ✓ @QueryParam should give an array of string with only one query parameter (2 ms)
    ✓ @QueryParam should give an array of string with multiple query parameters (3 ms)
    ✓ @QueryParam should give an array of number with only one query parameter (2 ms)
    ✓ @QueryParam should give an array of number with multiple query parameters (3 ms)
    ✓ @QueryParam should give an array of date with only one query parameter (2 ms)
    ✓ @QueryParam should give an array of date with multiple query parameters (2 ms)
    ✓ @QueryParam when required params must be provided and they should not be empty (8 ms)
    ✓ @QueryParam when the type is Date then it should be parsed (2 ms)
    ✓ @QueryParam when the type is Date and it is invalid then the response should be a BadRequest error (2 ms)
    ✓ @QueryParam when parseJson flag is used query param must be converted to object (2 ms)
    ✓ @HeaderParam should give a proper values from request headers (2 ms)
    ✓ @HeaderParam when required is params must be provided and they should not be empty (2 ms)
    ✓ @HeaderParam should fail with invalid request options (3 ms)
    ✓ @HeaderParam should fail with missing required params (2 ms)
    ✓ for @HeaderParam when parseJson flag is used query param must be converted to object (3 ms)
    ✓ @CookieParam should give a proper values from request headers (3 ms)
    ✓ @CookieParam when required is params must be provided and they should not be empty (3 ms)
    ✓ @CookieParam when parseJson flag is used query param must be converted to object (1 ms)
    ✓ @Body should provide a request body (12 ms)
    ✓ @Body should fail if required body was not provided (11 ms)
    ✓ @Body should provide a json object for json-typed controllers and actions (3 ms)
    ✓ @Body should fail if required body was not provided for json-typed controllers and actions (5 ms)
    ✓ @BodyParam should provide a json object for json-typed controllers and actions (2 ms)
    ✓ @BodyParam should fail if required body was not provided for json-typed controllers and actions (18 ms)
    ✓ @Body using application/x-www-form-urlencoded should handle url encoded form data (3 ms)
    ✓ @UploadedFile using multipart/form-data should provide uploaded file with the given name (13 ms)
    ✓ @UploadedFile with @Body should return both the file and the body (6 ms)
    ✓ @UploadedFile with @BodyParam should return both the file and the body param (5 ms)
    ✓ @UploadedFile with passed uploading options (limit) should throw an error (5 ms)
    ✓ @UploadedFile when required is used files must be provided (6 ms)
    ✓ @UploadedFiles should provide uploaded files with the given name (5 ms)
    ✓ @UploadedFiles with passed uploading options (limit) should throw an error (6 ms)
    ✓ @UploadedFiles when required is used files must be provided (4 ms)

PASS test/functional/controller-options.spec.ts
    controller options
      ✓ controller transform is enabled by default (58 ms)
      ✓ when controller transform is enabled (18 ms)
      ✓ when controller transform is disabled (5 ms)

PASS test/functional/auth-decorator.spec.ts
    Controller responds with value when Authorization succeeds (async)
      ✓ without roles (77 ms)
      ✓ with roles (15 ms)
      ✓ async (25 ms)
    Controller responds with value when Authorization succeeds (sync)
      ✓ without roles (5 ms)
      ✓ with roles (5 ms)
      ✓ async (14 ms)
    Authorized Decorators Http Status Code
      ✓ without roles (21 ms)
      ✓ with roles (4 ms)
    Authorization checker allows to throw (async)
      ✓ custom errors (5 ms)
    Authorization checker allows to throw (sync)
      ✓ custom errors (5 ms)

PASS test/functional/global-options.spec.ts
    routing-controllers global options
      useClassTransformer default value
        ✓ useClassTransformer by default must be set to true (85 ms)
      when useClassTransformer is set to true
        ✓ useClassTransformer is enabled (5 ms)
      when useClassTransformer is set to false
        ✓ useClassTransformer is disabled (3 ms)
      when routePrefix is used all controller routes should be appended by it
        ✓ routePrefix is enabled (6 ms)

PASS test/functional/other-controller-decorators.spec.ts
    other controller decorators
      ✓ should return httpCode set by @HttpCode decorator (12 ms)
      ✓ should return custom code when @OnNull (37 ms)
      ✓ should return custom error message and code when @OnUndefined is used with Error class (7 ms)
      ✓ should return custom code when @OnUndefined (8 ms)
      ✓ should return content-type in the response when @ContentType is used (2 ms)
      ✓ should return content-type in the response when @ContentType is used (3 ms)
      ✓ should return response with custom headers when @Header is used (3 ms)
      ✓ should relocate to new location when @Location is used (2 ms)

PASS test/functional/load-from-directory.spec.ts
    loading all controllers from the given directories
      ✓ should load all controllers (19 ms)
    loading all express middlewares and error handlers from the given directories
      ✓ should succeed (23 ms)
      ✓ should fail (17 ms)

PASS test/functional/class-validator-options.spec.ts
    no options
      ✓ should not use any options if not set (86 ms)
    global options
      should merge local validation options with global validation options prioritizing local
        ✓ succeed (34 ms)
      should pass the valid param after validation
        ✓ succeed (13 ms)
        ✓ should contain param name on validation failed (48 ms)
    local options
      ✓ should apply local options (27 ms)

PASS test/functional/express-error-handling.spec.ts
    express error handling
      ✓ should not call global error handler middleware if there was no errors (23 ms)
      ✓ should call global error handler middleware (22 ms)
      ✓ should call global error handler middleware (4 ms)
      ✓ should call error handler middleware if used (5 ms)
      ✓ should not execute next middleware if soft error handled specifically and stopped error bubbling (3 ms)
      ✓ should process JsonErrors by their toJSON method if it exists (3 ms)

PASS test/functional/container.spec.ts
    using typedi container should be possible
      ✓ typedi container (64 ms)
    using custom container should be possible
      ✓ custom container (6 ms)
    using custom container with fallback should be possible
      ✓ custom container with fallback (8 ms)
    using custom container with fallback and fallback on throw error should be possible
      ✓ custom container with fallback and fallback on throw error (8 ms)

PASS test/functional/controller-base-routes.spec.ts
    controller > base routes functionality
      ✓ get should respond with proper status code, headers and body content (65 ms)
      ✓ get should respond with proper status code, headers and body content (4 ms)
      ✓ get should respond with proper status code, headers and body content - 2nd pass (3 ms)
      ✓ wrong route should respond with 404 error (4 ms)
      ✓ wrong route should respond with 404 error (3 ms)
      ✓ wrong route should respond with 404 error (3 ms)

PASS test/functional/express-middlewares.spec.ts
    express middlewares
      ✓ should call a global middlewares (9 ms)
      ✓ should use a custom middleware when @UseBefore or @UseAfter is used (3 ms)
      ✓ should call middleware and call it before controller action when @UseBefore is used (2 ms)
      ✓ should call middleware and call it after controller action when @UseAfter is used (3 ms)
      ✓ should call before middleware and call after middleware when @UseAfter and @UseAfter are used (2 ms)
      ✓ should handle errors in custom middlewares (23 ms)

PASS test/functional/action-options.spec.ts
    ✓ should use controller options when action transform options are not set (21 ms)
    ✓ should override controller options with action transformRequest option (6 ms)
    ✓ should override controller options with action transformResponse option (3 ms)

PASS test/unit/controller-inheritance.spec.ts
  controller inheritance
    ✓ should build empty meta for empty set (11 ms)
    ✓ should build meta if the only derivative controller is given (2 ms)
    ✓ should build meta if the only autonomous controller is given (1 ms)
    ✓ should build meta both when autonomous and derivative controllers are given

PASS test/functional/defaults.spec.ts
    defaults
      ✓ should return undefinedResultCode from defaults config for void function (8 ms)
      ✓ should return undefinedResultCode from defaults config for promise void function (3 ms)
      ✓ should return 400 from required paramOptions (16 ms)
      ✓ should return nullResultCode from defaults config (4 ms)
      ✓ should return status code from OnUndefined annotation (3 ms)
      ✓ should mark arg optional from QueryParam annotation (4 ms)

PASS test/functional/express-custom-error-handling.spec.ts
    custom express error handling
      ✓ should not call global error handler middleware if there was no errors (10 ms)
      ✓ should call global error handler middleware (22 ms)

PASS test/functional/express-global-before-error-handling.spec.ts
    custom express global before middleware error handling
      ✓ should call global error handler middleware with CustomError (37 ms)

PASS test/functional/render-decorator.spec.ts
    template rendering
      ✓ should render a template and use given variables (30 ms)
      ✓ should render a template with given variables and locals variables (5 ms)

PASS test/functional/redirect-decorator.spec.ts
    dynamic redirect
      ✓ using template (49 ms)
      ✓ using override (6 ms)
      ✓ using original (6 ms)

PASS test/functional/special-result-send.spec.ts
    special result value treatment
      ✓ should pipe stream to response (24 ms)
      ✓ should send raw binary data from Buffer (3 ms)
      ✓ should send raw binary data from UIntArray (2 ms)

PASS test/functional/middlewares-order.spec.ts
    loaded direct from array
      ✓ should call middlewares in order defined by items order (24 ms)
    specified by priority option
      ✓ should call middlewares in order defined by priority parameter of decorator (3 ms)

PASS test/functional/class-transformer-options.spec.ts
    should not use any options if not set
      ✓ technical wrapper (29 ms)
    should apply global options
      ✓ technical wrapper (6 ms)
    should apply local options
      ✓ technical wrapper (6 ms)

PASS test/functional/error-subclasses.spec.ts
  HttpError
    ✓ should be instance of HttpError and Error (3 ms)
  BadRequestError
    ✓ should be instance of BadRequestError, HttpError and Error (1 ms)

Summary of all failing tests
FAIL test/ActionParameterHandler.spec.ts
  ● ActionParameterHandler › negative › handle - throws error if the parameter is required

    Expected value   "TypeError: Cannot read property 'uuid' of undefined"
    Received:
      "TypeError: Cannot read properties of undefined (reading 'uuid')"

    Message:
      expected 'TypeError: Cannot read properties of undefined (reading \'uuid\')' to equal 'TypeError: Cannot read property \'uuid\' of undefined'

    Difference:

    - Expected
    + Received

    - TypeError: Cannot read property 'uuid' of undefined
    + TypeError: Cannot read properties of undefined (reading 'uuid')

      152 |       }
      153 | 
    > 154 |       expect(error.toString()).to.be.eq("TypeError: Cannot read property 'uuid' of undefined");
          |                                      ^
      155 |     });
      156 | 
      157 |     it('handle - throws error if the parameter is required, type file provided', async () => {

      at Object.<anonymous> (test/ActionParameterHandler.spec.ts:154:38)


Test Suites: 1 failed, 25 passed, 26 total
Tests:       1 failed, 181 passed, 182 total
Snapshots:   0 total
Time:        13.284 s
Ran all test suites.
************* run test done *************
routing-controllers is testing ./Variants/express/variant13/express
************* npm unlink module *************
************* npm unlink module done *************
************* npm unlink globally *************
************* npm unlink globally done *************
************* npm link globally *************
************* npm link globally done *************
************* npm link module *************
************* npm link module done *************
************* start run test *************
ts-jest[config] (WARN) The option `tsConfig` is deprecated and will be removed in ts-jest 27, use `tsconfig` instead
FAIL test/ActionParameterHandler.spec.ts
  ActionParameterHandler
    positive
      ✓ handle - should process string parameters (31 ms)
      ✓ handle - should process string parameters, returns empty if a given string is empty
      ✓ handle - should process number parameters (1 ms)
      ✓ handle - undefined on empty object provided
      ✓ handle - null provided (10 ms)
    negative
      ✕ handle - throws error if the parameter is required (7 ms)
      ✓ handle - throws error if the parameter is required, type file provided (1 ms)

  ● ActionParameterHandler › negative › handle - throws error if the parameter is required

    Expected value   "TypeError: Cannot read property 'uuid' of undefined"
    Received:
      "TypeError: Cannot read properties of undefined (reading 'uuid')"

    Message:
      expected 'TypeError: Cannot read properties of undefined (reading \'uuid\')' to equal 'TypeError: Cannot read property \'uuid\' of undefined'

    Difference:

    - Expected
    + Received

    - TypeError: Cannot read property 'uuid' of undefined
    + TypeError: Cannot read properties of undefined (reading 'uuid')

      152 |       }
      153 | 
    > 154 |       expect(error.toString()).to.be.eq("TypeError: Cannot read property 'uuid' of undefined");
          |                                      ^
      155 |     });
      156 | 
      157 |     it('handle - throws error if the parameter is required, type file provided', async () => {

      at Object.<anonymous> (test/ActionParameterHandler.spec.ts:154:38)

PASS test/functional/controller-methods.spec.ts
    controller methods
      ✓ get should respond with proper status code, headers and body content (21 ms)
      ✓ post respond with proper status code, headers and body content (5 ms)
      ✓ put respond with proper status code, headers and body content (3 ms)
      ✓ patch respond with proper status code, headers and body content (3 ms)
      ✓ delete respond with proper status code, headers and body content (3 ms)
      ✓ head respond with proper status code, headers and body content (3 ms)
      ✓ custom method (post) respond with proper status code, headers and body content (3 ms)
      ✓ custom method (delete) respond with proper status code, headers and body content (2 ms)
      ✓ route should work with parameter (3 ms)
      ✓ route should work with regexp parameter (3 ms)
      ✓ should respond with 404 when regexp does not match (5 ms)
      ✓ route should work with string regexp parameter (3 ms)
      ✓ should respond with 404 when regexp does not match (2 ms)
      ✓ should return result from a promise (503 ms)
      ✓ should respond with 500 if promise failed (504 ms)
      ✓ should respond with 204 No Content when null returned in action (5 ms)
      ✓ should respond with 404 Not Found text when undefined returned in action (25 ms)
      ✓ should respond with 404 Not Found JSON when undefined returned in action (13 ms)
      ✓ should respond with 200 and text/html even in json controller's method (2 ms)
      ✓ should respond with 200 and text/plain even in json controller's method (2 ms)
      ✓ should respond with 401 and text/html when UnauthorizedError throwed even in json controller's method (5 ms)
      ✓ should respond with 401 and aplication/json when UnauthorizedError is thrown in standard json controller's method (2 ms)

PASS test/functional/json-controller-methods.spec.ts
    json-controller methods
      ✓ get should respond with proper status code, headers and body content (27 ms)
      ✓ post respond with proper status code, headers and body content (3 ms)
      ✓ put respond with proper status code, headers and body content (2 ms)
      ✓ patch respond with proper status code, headers and body content (3 ms)
      ✓ delete respond with proper status code, headers and body content (2 ms)
      ✓ head respond with proper status code, headers and body content (3 ms)
      ✓ custom method (post) respond with proper status code, headers and body content (2 ms)
      ✓ custom method (delete) respond with proper status code, headers and body content (2 ms)
      ✓ route should work with parameter (3 ms)
      ✓ route should work with regexp parameter (2 ms)
      ✓ should respond with 404 when regexp does not match (4 ms)
      ✓ route should work with string regexp parameter (3 ms)
      ✓ should respond with 404 when regexp does not match (2 ms)
      ✓ should return result from a promise (504 ms)
      ✓ should respond with 500 if promise failed (504 ms)

PASS test/functional/interceptors.spec.ts
    interceptor
      ✓ custom interceptor function should replace returned content (22 ms)
      ✓ custom interceptor class should replace returned content (3 ms)
      ✓ custom interceptor class used on the whole controller should replace returned content (2 ms)
      ✓ global interceptor class should replace returned content (2 ms)
      ✓ interceptors should support promises (1003 ms)

PASS test/functional/action-params.spec.ts
    ✓ @Req and @Res should be provided as Request and Response objects (21 ms)
    ✓ @Res writing directly to the response should work (4 ms)
    ✓ @Param should give a param from route (3 ms)
    ✓ @Param multiple params should give a proper values from route (2 ms)
    ✓ @SessionParam without middleware (23 ms)
    ✓ @Session should return a value from session (11 ms)
    ✓ @Session(param) should allow to inject empty property (3 ms)
    ✓ @QueryParams should give a proper values from request's query parameters (10 ms)
    ✓ @QueryParams should give a proper values from request's query parameters and one multiple value (6 ms)
    ✓ @QueryParams should give a proper values from request's query with validate whitelist option on (3 ms)
    ✓ @QueryParams should give a proper values from request's query parameters with nested json (5 ms)
    ✓ @QueryParams should not validate request query parameters when it's turned off in validator options (3 ms)
    ✓ @QueryParams should give a proper values from request's optional query parameters (3 ms)
    ✓ @QueryParam should give a proper values from request query parameters (9 ms)
    ✓ @QueryParam should give an array of string with only one query parameter (2 ms)
    ✓ @QueryParam should give an array of string with multiple query parameters (3 ms)
    ✓ @QueryParam should give an array of number with only one query parameter (3 ms)
    ✓ @QueryParam should give an array of number with multiple query parameters (2 ms)
    ✓ @QueryParam should give an array of date with only one query parameter (2 ms)
    ✓ @QueryParam should give an array of date with multiple query parameters (2 ms)
    ✓ @QueryParam when required params must be provided and they should not be empty (8 ms)
    ✓ @QueryParam when the type is Date then it should be parsed (2 ms)
    ✓ @QueryParam when the type is Date and it is invalid then the response should be a BadRequest error (2 ms)
    ✓ @QueryParam when parseJson flag is used query param must be converted to object (2 ms)
    ✓ @HeaderParam should give a proper values from request headers (2 ms)
    ✓ @HeaderParam when required is params must be provided and they should not be empty (2 ms)
    ✓ @HeaderParam should fail with invalid request options (3 ms)
    ✓ @HeaderParam should fail with missing required params (3 ms)
    ✓ for @HeaderParam when parseJson flag is used query param must be converted to object (2 ms)
    ✓ @CookieParam should give a proper values from request headers (3 ms)
    ✓ @CookieParam when required is params must be provided and they should not be empty (4 ms)
    ✓ @CookieParam when parseJson flag is used query param must be converted to object (2 ms)
    ✓ @Body should provide a request body (12 ms)
    ✓ @Body should fail if required body was not provided (6 ms)
    ✓ @Body should provide a json object for json-typed controllers and actions (3 ms)
    ✓ @Body should fail if required body was not provided for json-typed controllers and actions (5 ms)
    ✓ @BodyParam should provide a json object for json-typed controllers and actions (2 ms)
    ✓ @BodyParam should fail if required body was not provided for json-typed controllers and actions (22 ms)
    ✓ @Body using application/x-www-form-urlencoded should handle url encoded form data (4 ms)
    ✓ @UploadedFile using multipart/form-data should provide uploaded file with the given name (12 ms)
    ✓ @UploadedFile with @Body should return both the file and the body (9 ms)
    ✓ @UploadedFile with @BodyParam should return both the file and the body param (4 ms)
    ✓ @UploadedFile with passed uploading options (limit) should throw an error (5 ms)
    ✓ @UploadedFile when required is used files must be provided (7 ms)
    ✓ @UploadedFiles should provide uploaded files with the given name (5 ms)
    ✓ @UploadedFiles with passed uploading options (limit) should throw an error (5 ms)
    ✓ @UploadedFiles when required is used files must be provided (4 ms)

PASS test/functional/class-validator-options.spec.ts
    no options
      ✓ should not use any options if not set (63 ms)
    global options
      should merge local validation options with global validation options prioritizing local
        ✓ succeed (6 ms)
      should pass the valid param after validation
        ✓ succeed (5 ms)
        ✓ should contain param name on validation failed (17 ms)
    local options
      ✓ should apply local options (6 ms)

PASS test/functional/auth-decorator.spec.ts
    Controller responds with value when Authorization succeeds (async)
      ✓ without roles (72 ms)
      ✓ with roles (15 ms)
      ✓ async (25 ms)
    Controller responds with value when Authorization succeeds (sync)
      ✓ without roles (4 ms)
      ✓ with roles (4 ms)
      ✓ async (13 ms)
    Authorized Decorators Http Status Code
      ✓ without roles (23 ms)
      ✓ with roles (4 ms)
    Authorization checker allows to throw (async)
      ✓ custom errors (5 ms)
    Authorization checker allows to throw (sync)
      ✓ custom errors (3 ms)

PASS test/functional/load-from-directory.spec.ts
    loading all controllers from the given directories
      ✓ should load all controllers (19 ms)
    loading all express middlewares and error handlers from the given directories
      ✓ should succeed (14 ms)
      ✓ should fail (30 ms)

PASS test/functional/express-error-handling.spec.ts
    express error handling
      ✓ should not call global error handler middleware if there was no errors (9 ms)
      ✓ should call global error handler middleware (23 ms)
      ✓ should call global error handler middleware (4 ms)
      ✓ should call error handler middleware if used (3 ms)
      ✓ should not execute next middleware if soft error handled specifically and stopped error bubbling (3 ms)
      ✓ should process JsonErrors by their toJSON method if it exists (3 ms)

PASS test/functional/controller-options.spec.ts
    controller options
      ✓ controller transform is enabled by default (76 ms)
      ✓ when controller transform is enabled (5 ms)
      ✓ when controller transform is disabled (4 ms)

PASS test/functional/express-custom-error-handling.spec.ts
    custom express error handling
      ✓ should not call global error handler middleware if there was no errors (9 ms)
      ✓ should call global error handler middleware (36 ms)

PASS test/functional/other-controller-decorators.spec.ts
    other controller decorators
      ✓ should return httpCode set by @HttpCode decorator (44 ms)
      ✓ should return custom code when @OnNull (103 ms)
      ✓ should return custom error message and code when @OnUndefined is used with Error class (153 ms)
      ✓ should return custom code when @OnUndefined (23 ms)
      ✓ should return content-type in the response when @ContentType is used (10 ms)
      ✓ should return content-type in the response when @ContentType is used (4 ms)
      ✓ should return response with custom headers when @Header is used (3 ms)
      ✓ should relocate to new location when @Location is used (3 ms)

PASS test/functional/action-options.spec.ts
    ✓ should use controller options when action transform options are not set (35 ms)
    ✓ should override controller options with action transformRequest option (5 ms)
    ✓ should override controller options with action transformResponse option (3 ms)

PASS test/functional/global-options.spec.ts
    routing-controllers global options
      useClassTransformer default value
        ✓ useClassTransformer by default must be set to true (80 ms)
      when useClassTransformer is set to true
        ✓ useClassTransformer is enabled (5 ms)
      when useClassTransformer is set to false
        ✓ useClassTransformer is disabled (4 ms)
      when routePrefix is used all controller routes should be appended by it
        ✓ routePrefix is enabled (6 ms)

PASS test/functional/container.spec.ts
    using typedi container should be possible
      ✓ typedi container (60 ms)
    using custom container should be possible
      ✓ custom container (5 ms)
    using custom container with fallback should be possible
      ✓ custom container with fallback (7 ms)
    using custom container with fallback and fallback on throw error should be possible
      ✓ custom container with fallback and fallback on throw error (7 ms)

PASS test/functional/redirect-decorator.spec.ts
    dynamic redirect
      ✓ using template (29 ms)
      ✓ using override (4 ms)
      ✓ using original (4 ms)

PASS test/functional/defaults.spec.ts
    defaults
      ✓ should return undefinedResultCode from defaults config for void function (22 ms)
      ✓ should return undefinedResultCode from defaults config for promise void function (2 ms)
      ✓ should return 400 from required paramOptions (16 ms)
      ✓ should return nullResultCode from defaults config (3 ms)
      ✓ should return status code from OnUndefined annotation (2 ms)
      ✓ should mark arg optional from QueryParam annotation (4 ms)

PASS test/functional/express-middlewares.spec.ts
    express middlewares
      ✓ should call a global middlewares (26 ms)
      ✓ should use a custom middleware when @UseBefore or @UseAfter is used (3 ms)
      ✓ should call middleware and call it before controller action when @UseBefore is used (2 ms)
      ✓ should call middleware and call it after controller action when @UseAfter is used (3 ms)
      ✓ should call before middleware and call after middleware when @UseAfter and @UseAfter are used (2 ms)
      ✓ should handle errors in custom middlewares (22 ms)

PASS test/unit/controller-inheritance.spec.ts
  controller inheritance
    ✓ should build empty meta for empty set (11 ms)
    ✓ should build meta if the only derivative controller is given (2 ms)
    ✓ should build meta if the only autonomous controller is given
    ✓ should build meta both when autonomous and derivative controllers are given (1 ms)

PASS test/functional/special-result-send.spec.ts
    special result value treatment
      ✓ should pipe stream to response (27 ms)
      ✓ should send raw binary data from Buffer (3 ms)
      ✓ should send raw binary data from UIntArray (2 ms)

PASS test/functional/render-decorator.spec.ts
    template rendering
      ✓ should render a template and use given variables (28 ms)
      ✓ should render a template with given variables and locals variables (5 ms)

PASS test/functional/class-transformer-options.spec.ts
    should not use any options if not set
      ✓ technical wrapper (33 ms)
    should apply global options
      ✓ technical wrapper (4 ms)
    should apply local options
      ✓ technical wrapper (4 ms)

PASS test/functional/middlewares-order.spec.ts
    loaded direct from array
      ✓ should call middlewares in order defined by items order (25 ms)
    specified by priority option
      ✓ should call middlewares in order defined by priority parameter of decorator (3 ms)

PASS test/functional/controller-base-routes.spec.ts
    controller > base routes functionality
      ✓ get should respond with proper status code, headers and body content (44 ms)
      ✓ get should respond with proper status code, headers and body content (19 ms)
      ✓ get should respond with proper status code, headers and body content - 2nd pass (5 ms)
      ✓ wrong route should respond with 404 error (4 ms)
      ✓ wrong route should respond with 404 error (2 ms)
      ✓ wrong route should respond with 404 error (3 ms)

PASS test/functional/express-global-before-error-handling.spec.ts
    custom express global before middleware error handling
      ✓ should call global error handler middleware with CustomError (25 ms)

PASS test/functional/error-subclasses.spec.ts
  HttpError
    ✓ should be instance of HttpError and Error (3 ms)
  BadRequestError
    ✓ should be instance of BadRequestError, HttpError and Error (1 ms)

Summary of all failing tests
FAIL test/ActionParameterHandler.spec.ts
  ● ActionParameterHandler › negative › handle - throws error if the parameter is required

    Expected value   "TypeError: Cannot read property 'uuid' of undefined"
    Received:
      "TypeError: Cannot read properties of undefined (reading 'uuid')"

    Message:
      expected 'TypeError: Cannot read properties of undefined (reading \'uuid\')' to equal 'TypeError: Cannot read property \'uuid\' of undefined'

    Difference:

    - Expected
    + Received

    - TypeError: Cannot read property 'uuid' of undefined
    + TypeError: Cannot read properties of undefined (reading 'uuid')

      152 |       }
      153 | 
    > 154 |       expect(error.toString()).to.be.eq("TypeError: Cannot read property 'uuid' of undefined");
          |                                      ^
      155 |     });
      156 | 
      157 |     it('handle - throws error if the parameter is required, type file provided', async () => {

      at Object.<anonymous> (test/ActionParameterHandler.spec.ts:154:38)


Test Suites: 1 failed, 25 passed, 26 total
Tests:       1 failed, 181 passed, 182 total
Snapshots:   0 total
Time:        13.206 s, estimated 14 s
Ran all test suites.
************* run test done *************
routing-controllers is testing ./Variants/express/variant12/express
************* npm unlink module *************
************* npm unlink module done *************
************* npm unlink globally *************
************* npm unlink globally done *************
************* npm link globally *************
************* npm link globally done *************
************* npm link module *************
************* npm link module done *************
************* start run test *************
ts-jest[config] (WARN) The option `tsConfig` is deprecated and will be removed in ts-jest 27, use `tsconfig` instead
FAIL test/ActionParameterHandler.spec.ts
  ActionParameterHandler
    positive
      ✓ handle - should process string parameters (38 ms)
      ✓ handle - should process string parameters, returns empty if a given string is empty
      ✓ handle - should process number parameters (1 ms)
      ✓ handle - undefined on empty object provided
      ✓ handle - null provided (28 ms)
    negative
      ✕ handle - throws error if the parameter is required (16 ms)
      ✓ handle - throws error if the parameter is required, type file provided (1 ms)

  ● ActionParameterHandler › negative › handle - throws error if the parameter is required

    Expected value   "TypeError: Cannot read property 'uuid' of undefined"
    Received:
      "TypeError: Cannot read properties of undefined (reading 'uuid')"

    Message:
      expected 'TypeError: Cannot read properties of undefined (reading \'uuid\')' to equal 'TypeError: Cannot read property \'uuid\' of undefined'

    Difference:

    - Expected
    + Received

    - TypeError: Cannot read property 'uuid' of undefined
    + TypeError: Cannot read properties of undefined (reading 'uuid')

      152 |       }
      153 | 
    > 154 |       expect(error.toString()).to.be.eq("TypeError: Cannot read property 'uuid' of undefined");
          |                                      ^
      155 |     });
      156 | 
      157 |     it('handle - throws error if the parameter is required, type file provided', async () => {

      at Object.<anonymous> (test/ActionParameterHandler.spec.ts:154:38)

PASS test/functional/controller-methods.spec.ts
    controller methods
      ✓ get should respond with proper status code, headers and body content (20 ms)
      ✓ post respond with proper status code, headers and body content (5 ms)
      ✓ put respond with proper status code, headers and body content (3 ms)
      ✓ patch respond with proper status code, headers and body content (3 ms)
      ✓ delete respond with proper status code, headers and body content (3 ms)
      ✓ head respond with proper status code, headers and body content (3 ms)
      ✓ custom method (post) respond with proper status code, headers and body content (2 ms)
      ✓ custom method (delete) respond with proper status code, headers and body content (3 ms)
      ✓ route should work with parameter (3 ms)
      ✓ route should work with regexp parameter (3 ms)
      ✓ should respond with 404 when regexp does not match (5 ms)
      ✓ route should work with string regexp parameter (3 ms)
      ✓ should respond with 404 when regexp does not match (13 ms)
      ✓ should return result from a promise (504 ms)
      ✓ should respond with 500 if promise failed (504 ms)
      ✓ should respond with 204 No Content when null returned in action (6 ms)
      ✓ should respond with 404 Not Found text when undefined returned in action (21 ms)
      ✓ should respond with 404 Not Found JSON when undefined returned in action (3 ms)
      ✓ should respond with 200 and text/html even in json controller's method (2 ms)
      ✓ should respond with 200 and text/plain even in json controller's method (2 ms)
      ✓ should respond with 401 and text/html when UnauthorizedError throwed even in json controller's method (4 ms)
      ✓ should respond with 401 and aplication/json when UnauthorizedError is thrown in standard json controller's method (3 ms)

PASS test/functional/json-controller-methods.spec.ts
    json-controller methods
      ✓ get should respond with proper status code, headers and body content (10 ms)
      ✓ post respond with proper status code, headers and body content (3 ms)
      ✓ put respond with proper status code, headers and body content (2 ms)
      ✓ patch respond with proper status code, headers and body content (3 ms)
      ✓ delete respond with proper status code, headers and body content (2 ms)
      ✓ head respond with proper status code, headers and body content (2 ms)
      ✓ custom method (post) respond with proper status code, headers and body content (3 ms)
      ✓ custom method (delete) respond with proper status code, headers and body content (2 ms)
      ✓ route should work with parameter (2 ms)
      ✓ route should work with regexp parameter (3 ms)
      ✓ should respond with 404 when regexp does not match (5 ms)
      ✓ route should work with string regexp parameter (2 ms)
      ✓ should respond with 404 when regexp does not match (2 ms)
      ✓ should return result from a promise (504 ms)
      ✓ should respond with 500 if promise failed (505 ms)

PASS test/functional/interceptors.spec.ts
    interceptor
      ✓ custom interceptor function should replace returned content (10 ms)
      ✓ custom interceptor class should replace returned content (3 ms)
      ✓ custom interceptor class used on the whole controller should replace returned content (2 ms)
      ✓ global interceptor class should replace returned content (3 ms)
      ✓ interceptors should support promises (1004 ms)

PASS test/functional/action-params.spec.ts
    ✓ @Req and @Res should be provided as Request and Response objects (11 ms)
    ✓ @Res writing directly to the response should work (4 ms)
    ✓ @Param should give a param from route (3 ms)
    ✓ @Param multiple params should give a proper values from route (3 ms)
    ✓ @SessionParam without middleware (22 ms)
    ✓ @Session should return a value from session (12 ms)
    ✓ @Session(param) should allow to inject empty property (3 ms)
    ✓ @QueryParams should give a proper values from request's query parameters (9 ms)
    ✓ @QueryParams should give a proper values from request's query parameters and one multiple value (16 ms)
    ✓ @QueryParams should give a proper values from request's query with validate whitelist option on (4 ms)
    ✓ @QueryParams should give a proper values from request's query parameters with nested json (5 ms)
    ✓ @QueryParams should not validate request query parameters when it's turned off in validator options (3 ms)
    ✓ @QueryParams should give a proper values from request's optional query parameters (2 ms)
    ✓ @QueryParam should give a proper values from request query parameters (3 ms)
    ✓ @QueryParam should give an array of string with only one query parameter (2 ms)
    ✓ @QueryParam should give an array of string with multiple query parameters (2 ms)
    ✓ @QueryParam should give an array of number with only one query parameter (5 ms)
    ✓ @QueryParam should give an array of number with multiple query parameters (2 ms)
    ✓ @QueryParam should give an array of date with only one query parameter (2 ms)
    ✓ @QueryParam should give an array of date with multiple query parameters (2 ms)
    ✓ @QueryParam when required params must be provided and they should not be empty (8 ms)
    ✓ @QueryParam when the type is Date then it should be parsed (2 ms)
    ✓ @QueryParam when the type is Date and it is invalid then the response should be a BadRequest error (2 ms)
    ✓ @QueryParam when parseJson flag is used query param must be converted to object (2 ms)
    ✓ @HeaderParam should give a proper values from request headers (2 ms)
    ✓ @HeaderParam when required is params must be provided and they should not be empty (2 ms)
    ✓ @HeaderParam should fail with invalid request options (5 ms)
    ✓ @HeaderParam should fail with missing required params (3 ms)
    ✓ for @HeaderParam when parseJson flag is used query param must be converted to object (2 ms)
    ✓ @CookieParam should give a proper values from request headers (2 ms)
    ✓ @CookieParam when required is params must be provided and they should not be empty (4 ms)
    ✓ @CookieParam when parseJson flag is used query param must be converted to object (2 ms)
    ✓ @Body should provide a request body (12 ms)
    ✓ @Body should fail if required body was not provided (11 ms)
    ✓ @Body should provide a json object for json-typed controllers and actions (3 ms)
    ✓ @Body should fail if required body was not provided for json-typed controllers and actions (4 ms)
    ✓ @BodyParam should provide a json object for json-typed controllers and actions (3 ms)
    ✓ @BodyParam should fail if required body was not provided for json-typed controllers and actions (17 ms)
    ✓ @Body using application/x-www-form-urlencoded should handle url encoded form data (4 ms)
    ✓ @UploadedFile using multipart/form-data should provide uploaded file with the given name (12 ms)
    ✓ @UploadedFile with @Body should return both the file and the body (7 ms)
    ✓ @UploadedFile with @BodyParam should return both the file and the body param (4 ms)
    ✓ @UploadedFile with passed uploading options (limit) should throw an error (6 ms)
    ✓ @UploadedFile when required is used files must be provided (6 ms)
    ✓ @UploadedFiles should provide uploaded files with the given name (5 ms)
    ✓ @UploadedFiles with passed uploading options (limit) should throw an error (5 ms)
    ✓ @UploadedFiles when required is used files must be provided (5 ms)

PASS test/functional/other-controller-decorators.spec.ts
    other controller decorators
      ✓ should return httpCode set by @HttpCode decorator (12 ms)
      ✓ should return custom code when @OnNull (33 ms)
      ✓ should return custom error message and code when @OnUndefined is used with Error class (7 ms)
      ✓ should return custom code when @OnUndefined (10 ms)
      ✓ should return content-type in the response when @ContentType is used (3 ms)
      ✓ should return content-type in the response when @ContentType is used (10 ms)
      ✓ should return response with custom headers when @Header is used (3 ms)
      ✓ should relocate to new location when @Location is used (2 ms)

PASS test/functional/auth-decorator.spec.ts
    Controller responds with value when Authorization succeeds (async)
      ✓ without roles (62 ms)
      ✓ with roles (15 ms)
      ✓ async (24 ms)
    Controller responds with value when Authorization succeeds (sync)
      ✓ without roles (4 ms)
      ✓ with roles (4 ms)
      ✓ async (14 ms)
    Authorized Decorators Http Status Code
      ✓ without roles (35 ms)
      ✓ with roles (4 ms)
    Authorization checker allows to throw (async)
      ✓ custom errors (5 ms)
    Authorization checker allows to throw (sync)
      ✓ custom errors (3 ms)

PASS test/unit/controller-inheritance.spec.ts
  controller inheritance
    ✓ should build empty meta for empty set (11 ms)
    ✓ should build meta if the only derivative controller is given (2 ms)
    ✓ should build meta if the only autonomous controller is given (3 ms)
    ✓ should build meta both when autonomous and derivative controllers are given (1 ms)

PASS test/functional/load-from-directory.spec.ts
    loading all controllers from the given directories
      ✓ should load all controllers (19 ms)
    loading all express middlewares and error handlers from the given directories
      ✓ should succeed (15 ms)
      ✓ should fail (18 ms)

PASS test/functional/controller-options.spec.ts
    controller options
      ✓ controller transform is enabled by default (54 ms)
      ✓ when controller transform is enabled (18 ms)
      ✓ when controller transform is disabled (5 ms)

PASS test/functional/class-validator-options.spec.ts
    no options
      ✓ should not use any options if not set (100 ms)
    global options
      should merge local validation options with global validation options prioritizing local
        ✓ succeed (19 ms)
      should pass the valid param after validation
        ✓ succeed (9 ms)
        ✓ should contain param name on validation failed (20 ms)
    local options
      ✓ should apply local options (24 ms)

PASS test/functional/express-middlewares.spec.ts
    express middlewares
      ✓ should call a global middlewares (10 ms)
      ✓ should use a custom middleware when @UseBefore or @UseAfter is used (3 ms)
      ✓ should call middleware and call it before controller action when @UseBefore is used (3 ms)
      ✓ should call middleware and call it after controller action when @UseAfter is used (2 ms)
      ✓ should call before middleware and call after middleware when @UseAfter and @UseAfter are used (3 ms)
      ✓ should handle errors in custom middlewares (38 ms)

PASS test/functional/express-error-handling.spec.ts
    express error handling
      ✓ should not call global error handler middleware if there was no errors (12 ms)
      ✓ should call global error handler middleware (19 ms)
      ✓ should call global error handler middleware (9 ms)
      ✓ should call error handler middleware if used (4 ms)
      ✓ should not execute next middleware if soft error handled specifically and stopped error bubbling (18 ms)
      ✓ should process JsonErrors by their toJSON method if it exists (4 ms)

PASS test/functional/container.spec.ts
    using typedi container should be possible
      ✓ typedi container (95 ms)
    using custom container should be possible
      ✓ custom container (7 ms)
    using custom container with fallback should be possible
      ✓ custom container with fallback (8 ms)
    using custom container with fallback and fallback on throw error should be possible
      ✓ custom container with fallback and fallback on throw error (8 ms)

PASS test/functional/action-options.spec.ts
    ✓ should use controller options when action transform options are not set (33 ms)
    ✓ should override controller options with action transformRequest option (6 ms)
    ✓ should override controller options with action transformResponse option (3 ms)

PASS test/functional/global-options.spec.ts
    routing-controllers global options
      useClassTransformer default value
        ✓ useClassTransformer by default must be set to true (88 ms)
      when useClassTransformer is set to true
        ✓ useClassTransformer is enabled (7 ms)
      when useClassTransformer is set to false
        ✓ useClassTransformer is disabled (5 ms)
      when routePrefix is used all controller routes should be appended by it
        ✓ routePrefix is enabled (7 ms)

PASS test/functional/express-custom-error-handling.spec.ts
    custom express error handling
      ✓ should not call global error handler middleware if there was no errors (35 ms)
      ✓ should call global error handler middleware (18 ms)

PASS test/functional/defaults.spec.ts
    defaults
      ✓ should return undefinedResultCode from defaults config for void function (24 ms)
      ✓ should return undefinedResultCode from defaults config for promise void function (2 ms)
      ✓ should return 400 from required paramOptions (16 ms)
      ✓ should return nullResultCode from defaults config (3 ms)
      ✓ should return status code from OnUndefined annotation (3 ms)
      ✓ should mark arg optional from QueryParam annotation (4 ms)

PASS test/functional/class-transformer-options.spec.ts
    should not use any options if not set
      ✓ technical wrapper (30 ms)
    should apply global options
      ✓ technical wrapper (5 ms)
    should apply local options
      ✓ technical wrapper (7 ms)

PASS test/functional/render-decorator.spec.ts
    template rendering
      ✓ should render a template and use given variables (30 ms)
      ✓ should render a template with given variables and locals variables (5 ms)

PASS test/functional/controller-base-routes.spec.ts
    controller > base routes functionality
      ✓ get should respond with proper status code, headers and body content (62 ms)
      ✓ get should respond with proper status code, headers and body content (5 ms)
      ✓ get should respond with proper status code, headers and body content - 2nd pass (3 ms)
      ✓ wrong route should respond with 404 error (4 ms)
      ✓ wrong route should respond with 404 error (3 ms)
      ✓ wrong route should respond with 404 error (3 ms)

PASS test/functional/special-result-send.spec.ts
    special result value treatment
      ✓ should pipe stream to response (23 ms)
      ✓ should send raw binary data from Buffer (3 ms)
      ✓ should send raw binary data from UIntArray (3 ms)

PASS test/functional/middlewares-order.spec.ts
    loaded direct from array
      ✓ should call middlewares in order defined by items order (25 ms)
    specified by priority option
      ✓ should call middlewares in order defined by priority parameter of decorator (3 ms)

PASS test/functional/redirect-decorator.spec.ts
    dynamic redirect
      ✓ using template (29 ms)
      ✓ using override (4 ms)
      ✓ using original (5 ms)

PASS test/functional/express-global-before-error-handling.spec.ts
    custom express global before middleware error handling
      ✓ should call global error handler middleware with CustomError (42 ms)

PASS test/functional/error-subclasses.spec.ts
  HttpError
    ✓ should be instance of HttpError and Error (3 ms)
  BadRequestError
    ✓ should be instance of BadRequestError, HttpError and Error (2 ms)

Summary of all failing tests
FAIL test/ActionParameterHandler.spec.ts
  ● ActionParameterHandler › negative › handle - throws error if the parameter is required

    Expected value   "TypeError: Cannot read property 'uuid' of undefined"
    Received:
      "TypeError: Cannot read properties of undefined (reading 'uuid')"

    Message:
      expected 'TypeError: Cannot read properties of undefined (reading \'uuid\')' to equal 'TypeError: Cannot read property \'uuid\' of undefined'

    Difference:

    - Expected
    + Received

    - TypeError: Cannot read property 'uuid' of undefined
    + TypeError: Cannot read properties of undefined (reading 'uuid')

      152 |       }
      153 | 
    > 154 |       expect(error.toString()).to.be.eq("TypeError: Cannot read property 'uuid' of undefined");
          |                                      ^
      155 |     });
      156 | 
      157 |     it('handle - throws error if the parameter is required, type file provided', async () => {

      at Object.<anonymous> (test/ActionParameterHandler.spec.ts:154:38)


Test Suites: 1 failed, 25 passed, 26 total
Tests:       1 failed, 181 passed, 182 total
Snapshots:   0 total
Time:        13.327 s, estimated 14 s
Ran all test suites.
************* run test done *************
routing-controllers is testing ./Variants/express/variant11/express
************* npm unlink module *************
************* npm unlink module done *************
************* npm unlink globally *************
************* npm unlink globally done *************
************* npm link globally *************
************* npm link globally done *************
************* npm link module *************
************* npm link module done *************
************* start run test *************
ts-jest[config] (WARN) The option `tsConfig` is deprecated and will be removed in ts-jest 27, use `tsconfig` instead
FAIL test/ActionParameterHandler.spec.ts
  ActionParameterHandler
    positive
      ✓ handle - should process string parameters (28 ms)
      ✓ handle - should process string parameters, returns empty if a given string is empty (1 ms)
      ✓ handle - should process number parameters
      ✓ handle - undefined on empty object provided (1 ms)
      ✓ handle - null provided (14 ms)
    negative
      ✕ handle - throws error if the parameter is required (7 ms)
      ✓ handle - throws error if the parameter is required, type file provided

  ● ActionParameterHandler › negative › handle - throws error if the parameter is required

    Expected value   "TypeError: Cannot read property 'uuid' of undefined"
    Received:
      "TypeError: Cannot read properties of undefined (reading 'uuid')"

    Message:
      expected 'TypeError: Cannot read properties of undefined (reading \'uuid\')' to equal 'TypeError: Cannot read property \'uuid\' of undefined'

    Difference:

    - Expected
    + Received

    - TypeError: Cannot read property 'uuid' of undefined
    + TypeError: Cannot read properties of undefined (reading 'uuid')

      152 |       }
      153 | 
    > 154 |       expect(error.toString()).to.be.eq("TypeError: Cannot read property 'uuid' of undefined");
          |                                      ^
      155 |     });
      156 | 
      157 |     it('handle - throws error if the parameter is required, type file provided', async () => {

      at Object.<anonymous> (test/ActionParameterHandler.spec.ts:154:38)

PASS test/functional/controller-methods.spec.ts
    controller methods
      ✓ get should respond with proper status code, headers and body content (21 ms)
      ✓ post respond with proper status code, headers and body content (5 ms)
      ✓ put respond with proper status code, headers and body content (3 ms)
      ✓ patch respond with proper status code, headers and body content (3 ms)
      ✓ delete respond with proper status code, headers and body content (3 ms)
      ✓ head respond with proper status code, headers and body content (3 ms)
      ✓ custom method (post) respond with proper status code, headers and body content (3 ms)
      ✓ custom method (delete) respond with proper status code, headers and body content (2 ms)
      ✓ route should work with parameter (3 ms)
      ✓ route should work with regexp parameter (3 ms)
      ✓ should respond with 404 when regexp does not match (7 ms)
      ✓ route should work with string regexp parameter (2 ms)
      ✓ should respond with 404 when regexp does not match (2 ms)
      ✓ should return result from a promise (503 ms)
      ✓ should respond with 500 if promise failed (505 ms)
      ✓ should respond with 204 No Content when null returned in action (5 ms)
      ✓ should respond with 404 Not Found text when undefined returned in action (32 ms)
      ✓ should respond with 404 Not Found JSON when undefined returned in action (3 ms)
      ✓ should respond with 200 and text/html even in json controller's method (2 ms)
      ✓ should respond with 200 and text/plain even in json controller's method (2 ms)
      ✓ should respond with 401 and text/html when UnauthorizedError throwed even in json controller's method (5 ms)
      ✓ should respond with 401 and aplication/json when UnauthorizedError is thrown in standard json controller's method (2 ms)

PASS test/functional/json-controller-methods.spec.ts
    json-controller methods
      ✓ get should respond with proper status code, headers and body content (10 ms)
      ✓ post respond with proper status code, headers and body content (2 ms)
      ✓ put respond with proper status code, headers and body content (3 ms)
      ✓ patch respond with proper status code, headers and body content (3 ms)
      ✓ delete respond with proper status code, headers and body content (2 ms)
      ✓ head respond with proper status code, headers and body content (2 ms)
      ✓ custom method (post) respond with proper status code, headers and body content (3 ms)
      ✓ custom method (delete) respond with proper status code, headers and body content (2 ms)
      ✓ route should work with parameter (2 ms)
      ✓ route should work with regexp parameter (3 ms)
      ✓ should respond with 404 when regexp does not match (4 ms)
      ✓ route should work with string regexp parameter (6 ms)
      ✓ should respond with 404 when regexp does not match (2 ms)
      ✓ should return result from a promise (503 ms)
      ✓ should respond with 500 if promise failed (505 ms)

PASS test/functional/interceptors.spec.ts
    interceptor
      ✓ custom interceptor function should replace returned content (23 ms)
      ✓ custom interceptor class should replace returned content (3 ms)
      ✓ custom interceptor class used on the whole controller should replace returned content (2 ms)
      ✓ global interceptor class should replace returned content (3 ms)
      ✓ interceptors should support promises (1004 ms)

PASS test/functional/action-params.spec.ts
    ✓ @Req and @Res should be provided as Request and Response objects (10 ms)
    ✓ @Res writing directly to the response should work (4 ms)
    ✓ @Param should give a param from route (3 ms)
    ✓ @Param multiple params should give a proper values from route (3 ms)
    ✓ @SessionParam without middleware (22 ms)
    ✓ @Session should return a value from session (10 ms)
    ✓ @Session(param) should allow to inject empty property (3 ms)
    ✓ @QueryParams should give a proper values from request's query parameters (10 ms)
    ✓ @QueryParams should give a proper values from request's query parameters and one multiple value (6 ms)
    ✓ @QueryParams should give a proper values from request's query with validate whitelist option on (3 ms)
    ✓ @QueryParams should give a proper values from request's query parameters with nested json (4 ms)
    ✓ @QueryParams should not validate request query parameters when it's turned off in validator options (3 ms)
    ✓ @QueryParams should give a proper values from request's optional query parameters (12 ms)
    ✓ @QueryParam should give a proper values from request query parameters (2 ms)
    ✓ @QueryParam should give an array of string with only one query parameter (2 ms)
    ✓ @QueryParam should give an array of string with multiple query parameters (3 ms)
    ✓ @QueryParam should give an array of number with only one query parameter (3 ms)
    ✓ @QueryParam should give an array of number with multiple query parameters (3 ms)
    ✓ @QueryParam should give an array of date with only one query parameter (2 ms)
    ✓ @QueryParam should give an array of date with multiple query parameters (2 ms)
    ✓ @QueryParam when required params must be provided and they should not be empty (7 ms)
    ✓ @QueryParam when the type is Date then it should be parsed (2 ms)
    ✓ @QueryParam when the type is Date and it is invalid then the response should be a BadRequest error (3 ms)
    ✓ @QueryParam when parseJson flag is used query param must be converted to object (2 ms)
    ✓ @HeaderParam should give a proper values from request headers (2 ms)
    ✓ @HeaderParam when required is params must be provided and they should not be empty (2 ms)
    ✓ @HeaderParam should fail with invalid request options (2 ms)
    ✓ @HeaderParam should fail with missing required params (5 ms)
    ✓ for @HeaderParam when parseJson flag is used query param must be converted to object (2 ms)
    ✓ @CookieParam should give a proper values from request headers (3 ms)
    ✓ @CookieParam when required is params must be provided and they should not be empty (3 ms)
    ✓ @CookieParam when parseJson flag is used query param must be converted to object (2 ms)
    ✓ @Body should provide a request body (13 ms)
    ✓ @Body should fail if required body was not provided (6 ms)
    ✓ @Body should provide a json object for json-typed controllers and actions (3 ms)
    ✓ @Body should fail if required body was not provided for json-typed controllers and actions (4 ms)
    ✓ @BodyParam should provide a json object for json-typed controllers and actions (6 ms)
    ✓ @BodyParam should fail if required body was not provided for json-typed controllers and actions (36 ms)
    ✓ @Body using application/x-www-form-urlencoded should handle url encoded form data (6 ms)
    ✓ @UploadedFile using multipart/form-data should provide uploaded file with the given name (20 ms)
    ✓ @UploadedFile with @Body should return both the file and the body (9 ms)
    ✓ @UploadedFile with @BodyParam should return both the file and the body param (9 ms)
    ✓ @UploadedFile with passed uploading options (limit) should throw an error (6 ms)
    ✓ @UploadedFile when required is used files must be provided (7 ms)
    ✓ @UploadedFiles should provide uploaded files with the given name (5 ms)
    ✓ @UploadedFiles with passed uploading options (limit) should throw an error (5 ms)
    ✓ @UploadedFiles when required is used files must be provided (4 ms)

PASS test/functional/express-middlewares.spec.ts
    express middlewares
      ✓ should call a global middlewares (24 ms)
      ✓ should use a custom middleware when @UseBefore or @UseAfter is used (3 ms)
      ✓ should call middleware and call it before controller action when @UseBefore is used (3 ms)
      ✓ should call middleware and call it after controller action when @UseAfter is used (2 ms)
      ✓ should call before middleware and call after middleware when @UseAfter and @UseAfter are used (3 ms)
      ✓ should handle errors in custom middlewares (22 ms)

PASS test/functional/load-from-directory.spec.ts
    loading all controllers from the given directories
      ✓ should load all controllers (19 ms)
    loading all express middlewares and error handlers from the given directories
      ✓ should succeed (14 ms)
      ✓ should fail (22 ms)

PASS test/functional/class-validator-options.spec.ts
    no options
      ✓ should not use any options if not set (64 ms)
    global options
      should merge local validation options with global validation options prioritizing local
        ✓ succeed (5 ms)
      should pass the valid param after validation
        ✓ succeed (4 ms)
        ✓ should contain param name on validation failed (20 ms)
    local options
      ✓ should apply local options (5 ms)

PASS test/functional/auth-decorator.spec.ts
    Controller responds with value when Authorization succeeds (async)
      ✓ without roles (76 ms)
      ✓ with roles (14 ms)
      ✓ async (25 ms)
    Controller responds with value when Authorization succeeds (sync)
      ✓ without roles (4 ms)
      ✓ with roles (3 ms)
      ✓ async (17 ms)
    Authorized Decorators Http Status Code
      ✓ without roles (20 ms)
      ✓ with roles (18 ms)
    Authorization checker allows to throw (async)
      ✓ custom errors (5 ms)
    Authorization checker allows to throw (sync)
      ✓ custom errors (4 ms)

PASS test/functional/controller-options.spec.ts
    controller options
      ✓ controller transform is enabled by default (67 ms)
      ✓ when controller transform is enabled (6 ms)
      ✓ when controller transform is disabled (3 ms)

PASS test/functional/other-controller-decorators.spec.ts
    other controller decorators
      ✓ should return httpCode set by @HttpCode decorator (45 ms)
      ✓ should return custom code when @OnNull (85 ms)
      ✓ should return custom error message and code when @OnUndefined is used with Error class (56 ms)
      ✓ should return custom code when @OnUndefined (81 ms)
      ✓ should return content-type in the response when @ContentType is used (4 ms)
      ✓ should return content-type in the response when @ContentType is used (2 ms)
      ✓ should return response with custom headers when @Header is used (4 ms)
      ✓ should relocate to new location when @Location is used (2 ms)

PASS test/functional/container.spec.ts
    using typedi container should be possible
      ✓ typedi container (73 ms)
    using custom container should be possible
      ✓ custom container (7 ms)
    using custom container with fallback should be possible
      ✓ custom container with fallback (8 ms)
    using custom container with fallback and fallback on throw error should be possible
      ✓ custom container with fallback and fallback on throw error (8 ms)

PASS test/functional/controller-base-routes.spec.ts
    controller > base routes functionality
      ✓ get should respond with proper status code, headers and body content (61 ms)
      ✓ get should respond with proper status code, headers and body content (4 ms)
      ✓ get should respond with proper status code, headers and body content - 2nd pass (3 ms)
      ✓ wrong route should respond with 404 error (4 ms)
      ✓ wrong route should respond with 404 error (3 ms)
      ✓ wrong route should respond with 404 error (2 ms)

PASS test/functional/global-options.spec.ts
    routing-controllers global options
      useClassTransformer default value
        ✓ useClassTransformer by default must be set to true (86 ms)
      when useClassTransformer is set to true
        ✓ useClassTransformer is enabled (4 ms)
      when useClassTransformer is set to false
        ✓ useClassTransformer is disabled (4 ms)
      when routePrefix is used all controller routes should be appended by it
        ✓ routePrefix is enabled (6 ms)

PASS test/functional/express-error-handling.spec.ts
    express error handling
      ✓ should not call global error handler middleware if there was no errors (24 ms)
      ✓ should call global error handler middleware (25 ms)
      ✓ should call global error handler middleware (3 ms)
      ✓ should call error handler middleware if used (2 ms)
      ✓ should not execute next middleware if soft error handled specifically and stopped error bubbling (3 ms)
      ✓ should process JsonErrors by their toJSON method if it exists (2 ms)

PASS test/functional/defaults.spec.ts
    defaults
      ✓ should return undefinedResultCode from defaults config for void function (22 ms)
      ✓ should return undefinedResultCode from defaults config for promise void function (2 ms)
      ✓ should return 400 from required paramOptions (16 ms)
      ✓ should return nullResultCode from defaults config (3 ms)
      ✓ should return status code from OnUndefined annotation (3 ms)
      ✓ should mark arg optional from QueryParam annotation (4 ms)

PASS test/functional/express-custom-error-handling.spec.ts
    custom express error handling
      ✓ should not call global error handler middleware if there was no errors (25 ms)
      ✓ should call global error handler middleware (18 ms)

PASS test/unit/controller-inheritance.spec.ts
  controller inheritance
    ✓ should build empty meta for empty set (10 ms)
    ✓ should build meta if the only derivative controller is given (2 ms)
    ✓ should build meta if the only autonomous controller is given (1 ms)
    ✓ should build meta both when autonomous and derivative controllers are given (1 ms)

PASS test/functional/class-transformer-options.spec.ts
    should not use any options if not set
      ✓ technical wrapper (15 ms)
    should apply global options
      ✓ technical wrapper (4 ms)
    should apply local options
      ✓ technical wrapper (4 ms)

PASS test/functional/action-options.spec.ts
    ✓ should use controller options when action transform options are not set (19 ms)
    ✓ should override controller options with action transformRequest option (5 ms)
    ✓ should override controller options with action transformResponse option (3 ms)

PASS test/functional/render-decorator.spec.ts
    template rendering
      ✓ should render a template and use given variables (31 ms)
      ✓ should render a template with given variables and locals variables (5 ms)

PASS test/functional/redirect-decorator.spec.ts
    dynamic redirect
      ✓ using template (27 ms)
      ✓ using override (4 ms)
      ✓ using original (3 ms)

PASS test/functional/middlewares-order.spec.ts
    loaded direct from array
      ✓ should call middlewares in order defined by items order (23 ms)
    specified by priority option
      ✓ should call middlewares in order defined by priority parameter of decorator (2 ms)

PASS test/functional/express-global-before-error-handling.spec.ts
    custom express global before middleware error handling
      ✓ should call global error handler middleware with CustomError (39 ms)

PASS test/functional/special-result-send.spec.ts
    special result value treatment
      ✓ should pipe stream to response (10 ms)
      ✓ should send raw binary data from Buffer (3 ms)
      ✓ should send raw binary data from UIntArray (19 ms)

PASS test/functional/error-subclasses.spec.ts
  HttpError
    ✓ should be instance of HttpError and Error (4 ms)
  BadRequestError
    ✓ should be instance of BadRequestError, HttpError and Error (1 ms)

Summary of all failing tests
FAIL test/ActionParameterHandler.spec.ts
  ● ActionParameterHandler › negative › handle - throws error if the parameter is required

    Expected value   "TypeError: Cannot read property 'uuid' of undefined"
    Received:
      "TypeError: Cannot read properties of undefined (reading 'uuid')"

    Message:
      expected 'TypeError: Cannot read properties of undefined (reading \'uuid\')' to equal 'TypeError: Cannot read property \'uuid\' of undefined'

    Difference:

    - Expected
    + Received

    - TypeError: Cannot read property 'uuid' of undefined
    + TypeError: Cannot read properties of undefined (reading 'uuid')

      152 |       }
      153 | 
    > 154 |       expect(error.toString()).to.be.eq("TypeError: Cannot read property 'uuid' of undefined");
          |                                      ^
      155 |     });
      156 | 
      157 |     it('handle - throws error if the parameter is required, type file provided', async () => {

      at Object.<anonymous> (test/ActionParameterHandler.spec.ts:154:38)


Test Suites: 1 failed, 25 passed, 26 total
Tests:       1 failed, 181 passed, 182 total
Snapshots:   0 total
Time:        13.246 s, estimated 14 s
Ran all test suites.
************* run test done *************
routing-controllers is testing ./Variants/express/variant10/express
************* npm unlink module *************
************* npm unlink module done *************
************* npm unlink globally *************
************* npm unlink globally done *************
************* npm link globally *************
************* npm link globally done *************
************* npm link module *************
************* npm link module done *************
************* start run test *************
ts-jest[config] (WARN) The option `tsConfig` is deprecated and will be removed in ts-jest 27, use `tsconfig` instead
FAIL test/ActionParameterHandler.spec.ts
  ActionParameterHandler
    positive
      ✓ handle - should process string parameters (34 ms)
      ✓ handle - should process string parameters, returns empty if a given string is empty
      ✓ handle - should process number parameters (1 ms)
      ✓ handle - undefined on empty object provided
      ✓ handle - null provided (13 ms)
    negative
      ✕ handle - throws error if the parameter is required (8 ms)
      ✓ handle - throws error if the parameter is required, type file provided (1 ms)

  ● ActionParameterHandler › negative › handle - throws error if the parameter is required

    Expected value   "TypeError: Cannot read property 'uuid' of undefined"
    Received:
      "TypeError: Cannot read properties of undefined (reading 'uuid')"

    Message:
      expected 'TypeError: Cannot read properties of undefined (reading \'uuid\')' to equal 'TypeError: Cannot read property \'uuid\' of undefined'

    Difference:

    - Expected
    + Received

    - TypeError: Cannot read property 'uuid' of undefined
    + TypeError: Cannot read properties of undefined (reading 'uuid')

      152 |       }
      153 | 
    > 154 |       expect(error.toString()).to.be.eq("TypeError: Cannot read property 'uuid' of undefined");
          |                                      ^
      155 |     });
      156 | 
      157 |     it('handle - throws error if the parameter is required, type file provided', async () => {

      at Object.<anonymous> (test/ActionParameterHandler.spec.ts:154:38)

PASS test/functional/controller-methods.spec.ts
    controller methods
      ✓ get should respond with proper status code, headers and body content (22 ms)
      ✓ post respond with proper status code, headers and body content (5 ms)
      ✓ put respond with proper status code, headers and body content (3 ms)
      ✓ patch respond with proper status code, headers and body content (3 ms)
      ✓ delete respond with proper status code, headers and body content (4 ms)
      ✓ head respond with proper status code, headers and body content (2 ms)
      ✓ custom method (post) respond with proper status code, headers and body content (3 ms)
      ✓ custom method (delete) respond with proper status code, headers and body content (2 ms)
      ✓ route should work with parameter (3 ms)
      ✓ route should work with regexp parameter (3 ms)
      ✓ should respond with 404 when regexp does not match (5 ms)
      ✓ route should work with string regexp parameter (3 ms)
      ✓ should respond with 404 when regexp does not match (2 ms)
      ✓ should return result from a promise (505 ms)
      ✓ should respond with 500 if promise failed (504 ms)
      ✓ should respond with 204 No Content when null returned in action (16 ms)
      ✓ should respond with 404 Not Found text when undefined returned in action (21 ms)
      ✓ should respond with 404 Not Found JSON when undefined returned in action (3 ms)
      ✓ should respond with 200 and text/html even in json controller's method (2 ms)
      ✓ should respond with 200 and text/plain even in json controller's method (1 ms)
      ✓ should respond with 401 and text/html when UnauthorizedError throwed even in json controller's method (5 ms)
      ✓ should respond with 401 and aplication/json when UnauthorizedError is thrown in standard json controller's method (2 ms)

PASS test/functional/json-controller-methods.spec.ts
    json-controller methods
      ✓ get should respond with proper status code, headers and body content (10 ms)
      ✓ post respond with proper status code, headers and body content (3 ms)
      ✓ put respond with proper status code, headers and body content (3 ms)
      ✓ patch respond with proper status code, headers and body content (2 ms)
      ✓ delete respond with proper status code, headers and body content (3 ms)
      ✓ head respond with proper status code, headers and body content (2 ms)
      ✓ custom method (post) respond with proper status code, headers and body content (2 ms)
      ✓ custom method (delete) respond with proper status code, headers and body content (2 ms)
      ✓ route should work with parameter (3 ms)
      ✓ route should work with regexp parameter (3 ms)
      ✓ should respond with 404 when regexp does not match (4 ms)
      ✓ route should work with string regexp parameter (3 ms)
      ✓ should respond with 404 when regexp does not match (2 ms)
      ✓ should return result from a promise (504 ms)
      ✓ should respond with 500 if promise failed (504 ms)

PASS test/functional/interceptors.spec.ts
    interceptor
      ✓ custom interceptor function should replace returned content (9 ms)
      ✓ custom interceptor class should replace returned content (3 ms)
      ✓ custom interceptor class used on the whole controller should replace returned content (2 ms)
      ✓ global interceptor class should replace returned content (2 ms)
      ✓ interceptors should support promises (1005 ms)

PASS test/functional/action-params.spec.ts
    ✓ @Req and @Res should be provided as Request and Response objects (11 ms)
    ✓ @Res writing directly to the response should work (4 ms)
    ✓ @Param should give a param from route (3 ms)
    ✓ @Param multiple params should give a proper values from route (3 ms)
    ✓ @SessionParam without middleware (22 ms)
    ✓ @Session should return a value from session (11 ms)
    ✓ @Session(param) should allow to inject empty property (3 ms)
    ✓ @QueryParams should give a proper values from request's query parameters (10 ms)
    ✓ @QueryParams should give a proper values from request's query parameters and one multiple value (6 ms)
    ✓ @QueryParams should give a proper values from request's query with validate whitelist option on (13 ms)
    ✓ @QueryParams should give a proper values from request's query parameters with nested json (5 ms)
    ✓ @QueryParams should not validate request query parameters when it's turned off in validator options (3 ms)
    ✓ @QueryParams should give a proper values from request's optional query parameters (2 ms)
    ✓ @QueryParam should give a proper values from request query parameters (3 ms)
    ✓ @QueryParam should give an array of string with only one query parameter (2 ms)
    ✓ @QueryParam should give an array of string with multiple query parameters (2 ms)
    ✓ @QueryParam should give an array of number with only one query parameter (3 ms)
    ✓ @QueryParam should give an array of number with multiple query parameters (3 ms)
    ✓ @QueryParam should give an array of date with only one query parameter (2 ms)
    ✓ @QueryParam should give an array of date with multiple query parameters (2 ms)
    ✓ @QueryParam when required params must be provided and they should not be empty (7 ms)
    ✓ @QueryParam when the type is Date then it should be parsed (2 ms)
    ✓ @QueryParam when the type is Date and it is invalid then the response should be a BadRequest error (2 ms)
    ✓ @QueryParam when parseJson flag is used query param must be converted to object (1 ms)
    ✓ @HeaderParam should give a proper values from request headers (2 ms)
    ✓ @HeaderParam when required is params must be provided and they should not be empty (2 ms)
    ✓ @HeaderParam should fail with invalid request options (3 ms)
    ✓ @HeaderParam should fail with missing required params (3 ms)
    ✓ for @HeaderParam when parseJson flag is used query param must be converted to object (2 ms)
    ✓ @CookieParam should give a proper values from request headers (4 ms)
    ✓ @CookieParam when required is params must be provided and they should not be empty (3 ms)
    ✓ @CookieParam when parseJson flag is used query param must be converted to object (2 ms)
    ✓ @Body should provide a request body (12 ms)
    ✓ @Body should fail if required body was not provided (6 ms)
    ✓ @Body should provide a json object for json-typed controllers and actions (3 ms)
    ✓ @Body should fail if required body was not provided for json-typed controllers and actions (8 ms)
    ✓ @BodyParam should provide a json object for json-typed controllers and actions (3 ms)
    ✓ @BodyParam should fail if required body was not provided for json-typed controllers and actions (17 ms)
    ✓ @Body using application/x-www-form-urlencoded should handle url encoded form data (4 ms)
    ✓ @UploadedFile using multipart/form-data should provide uploaded file with the given name (12 ms)
    ✓ @UploadedFile with @Body should return both the file and the body (6 ms)
    ✓ @UploadedFile with @BodyParam should return both the file and the body param (4 ms)
    ✓ @UploadedFile with passed uploading options (limit) should throw an error (5 ms)
    ✓ @UploadedFile when required is used files must be provided (7 ms)
    ✓ @UploadedFiles should provide uploaded files with the given name (5 ms)
    ✓ @UploadedFiles with passed uploading options (limit) should throw an error (5 ms)
    ✓ @UploadedFiles when required is used files must be provided (4 ms)

PASS test/functional/other-controller-decorators.spec.ts
    other controller decorators
      ✓ should return httpCode set by @HttpCode decorator (12 ms)
      ✓ should return custom code when @OnNull (32 ms)
      ✓ should return custom error message and code when @OnUndefined is used with Error class (7 ms)
      ✓ should return custom code when @OnUndefined (10 ms)
      ✓ should return content-type in the response when @ContentType is used (3 ms)
      ✓ should return content-type in the response when @ContentType is used (10 ms)
      ✓ should return response with custom headers when @Header is used (4 ms)
      ✓ should relocate to new location when @Location is used (3 ms)

PASS test/functional/auth-decorator.spec.ts
    Controller responds with value when Authorization succeeds (async)
      ✓ without roles (60 ms)
      ✓ with roles (14 ms)
      ✓ async (25 ms)
    Controller responds with value when Authorization succeeds (sync)
      ✓ without roles (4 ms)
      ✓ with roles (4 ms)
      ✓ async (13 ms)
    Authorized Decorators Http Status Code
      ✓ without roles (34 ms)
      ✓ with roles (4 ms)
    Authorization checker allows to throw (async)
      ✓ custom errors (5 ms)
    Authorization checker allows to throw (sync)
      ✓ custom errors (3 ms)

PASS test/functional/load-from-directory.spec.ts
    loading all controllers from the given directories
      ✓ should load all controllers (34 ms)
    loading all express middlewares and error handlers from the given directories
      ✓ should succeed (15 ms)
      ✓ should fail (17 ms)

PASS test/unit/controller-inheritance.spec.ts
  controller inheritance
    ✓ should build empty meta for empty set (11 ms)
    ✓ should build meta if the only derivative controller is given (2 ms)
    ✓ should build meta if the only autonomous controller is given
    ✓ should build meta both when autonomous and derivative controllers are given

PASS test/functional/class-validator-options.spec.ts
    no options
      ✓ should not use any options if not set (64 ms)
    global options
      should merge local validation options with global validation options prioritizing local
        ✓ succeed (5 ms)
      should pass the valid param after validation
        ✓ succeed (5 ms)
        ✓ should contain param name on validation failed (16 ms)
    local options
      ✓ should apply local options (5 ms)

PASS test/functional/container.spec.ts
    using typedi container should be possible
      ✓ typedi container (97 ms)
    using custom container should be possible
      ✓ custom container (23 ms)
    using custom container with fallback should be possible
      ✓ custom container with fallback (36 ms)
    using custom container with fallback and fallback on throw error should be possible
      ✓ custom container with fallback and fallback on throw error (41 ms)

PASS test/functional/controller-options.spec.ts
    controller options
      ✓ controller transform is enabled by default (67 ms)
      ✓ when controller transform is enabled (18 ms)
      ✓ when controller transform is disabled (3 ms)

PASS test/functional/express-global-before-error-handling.spec.ts
    custom express global before middleware error handling
      ✓ should call global error handler middleware with CustomError (36 ms)

PASS test/functional/express-custom-error-handling.spec.ts
    custom express error handling
      ✓ should not call global error handler middleware if there was no errors (10 ms)
      ✓ should call global error handler middleware (19 ms)

PASS test/functional/express-middlewares.spec.ts
    express middlewares
      ✓ should call a global middlewares (8 ms)
      ✓ should use a custom middleware when @UseBefore or @UseAfter is used (3 ms)
      ✓ should call middleware and call it before controller action when @UseBefore is used (3 ms)
      ✓ should call middleware and call it after controller action when @UseAfter is used (2 ms)
      ✓ should call before middleware and call after middleware when @UseAfter and @UseAfter are used (2 ms)
      ✓ should handle errors in custom middlewares (36 ms)

PASS test/functional/global-options.spec.ts
    routing-controllers global options
      useClassTransformer default value
        ✓ useClassTransformer by default must be set to true (77 ms)
      when useClassTransformer is set to true
        ✓ useClassTransformer is enabled (4 ms)
      when useClassTransformer is set to false
        ✓ useClassTransformer is disabled (4 ms)
      when routePrefix is used all controller routes should be appended by it
        ✓ routePrefix is enabled (6 ms)

PASS test/functional/express-error-handling.spec.ts
    express error handling
      ✓ should not call global error handler middleware if there was no errors (26 ms)
      ✓ should call global error handler middleware (22 ms)
      ✓ should call global error handler middleware (5 ms)
      ✓ should call error handler middleware if used (4 ms)
      ✓ should not execute next middleware if soft error handled specifically and stopped error bubbling (2 ms)
      ✓ should process JsonErrors by their toJSON method if it exists (3 ms)

PASS test/functional/action-options.spec.ts
    ✓ should use controller options when action transform options are not set (35 ms)
    ✓ should override controller options with action transformRequest option (5 ms)
    ✓ should override controller options with action transformResponse option (2 ms)

PASS test/functional/defaults.spec.ts
    defaults
      ✓ should return undefinedResultCode from defaults config for void function (23 ms)
      ✓ should return undefinedResultCode from defaults config for promise void function (2 ms)
      ✓ should return 400 from required paramOptions (16 ms)
      ✓ should return nullResultCode from defaults config (3 ms)
      ✓ should return status code from OnUndefined annotation (2 ms)
      ✓ should mark arg optional from QueryParam annotation (4 ms)

PASS test/functional/class-transformer-options.spec.ts
    should not use any options if not set
      ✓ technical wrapper (32 ms)
    should apply global options
      ✓ technical wrapper (5 ms)
    should apply local options
      ✓ technical wrapper (5 ms)

PASS test/functional/render-decorator.spec.ts
    template rendering
      ✓ should render a template and use given variables (31 ms)
      ✓ should render a template with given variables and locals variables (5 ms)

PASS test/functional/redirect-decorator.spec.ts
    dynamic redirect
      ✓ using template (29 ms)
      ✓ using override (4 ms)
      ✓ using original (3 ms)

PASS test/functional/middlewares-order.spec.ts
    loaded direct from array
      ✓ should call middlewares in order defined by items order (25 ms)
    specified by priority option
      ✓ should call middlewares in order defined by priority parameter of decorator (3 ms)

PASS test/functional/controller-base-routes.spec.ts
    controller > base routes functionality
      ✓ get should respond with proper status code, headers and body content (61 ms)
      ✓ get should respond with proper status code, headers and body content (4 ms)
      ✓ get should respond with proper status code, headers and body content - 2nd pass (3 ms)
      ✓ wrong route should respond with 404 error (4 ms)
      ✓ wrong route should respond with 404 error (3 ms)
      ✓ wrong route should respond with 404 error (2 ms)

PASS test/functional/special-result-send.spec.ts
    special result value treatment
      ✓ should pipe stream to response (22 ms)
      ✓ should send raw binary data from Buffer (3 ms)
      ✓ should send raw binary data from UIntArray (3 ms)

PASS test/functional/error-subclasses.spec.ts
  HttpError
    ✓ should be instance of HttpError and Error (4 ms)
  BadRequestError
    ✓ should be instance of BadRequestError, HttpError and Error (1 ms)

Summary of all failing tests
FAIL test/ActionParameterHandler.spec.ts
  ● ActionParameterHandler › negative › handle - throws error if the parameter is required

    Expected value   "TypeError: Cannot read property 'uuid' of undefined"
    Received:
      "TypeError: Cannot read properties of undefined (reading 'uuid')"

    Message:
      expected 'TypeError: Cannot read properties of undefined (reading \'uuid\')' to equal 'TypeError: Cannot read property \'uuid\' of undefined'

    Difference:

    - Expected
    + Received

    - TypeError: Cannot read property 'uuid' of undefined
    + TypeError: Cannot read properties of undefined (reading 'uuid')

      152 |       }
      153 | 
    > 154 |       expect(error.toString()).to.be.eq("TypeError: Cannot read property 'uuid' of undefined");
          |                                      ^
      155 |     });
      156 | 
      157 |     it('handle - throws error if the parameter is required, type file provided', async () => {

      at Object.<anonymous> (test/ActionParameterHandler.spec.ts:154:38)


Test Suites: 1 failed, 25 passed, 26 total
Tests:       1 failed, 181 passed, 182 total
Snapshots:   0 total
Time:        13.141 s, estimated 14 s
Ran all test suites.
************* run test done *************
routing-controllers is testing ./Variants/express/variant9/express
************* npm unlink module *************
************* npm unlink module done *************
************* npm unlink globally *************
************* npm unlink globally done *************
************* npm link globally *************
************* npm link globally done *************
************* npm link module *************
************* npm link module done *************
************* start run test *************
ts-jest[config] (WARN) The option `tsConfig` is deprecated and will be removed in ts-jest 27, use `tsconfig` instead
FAIL test/ActionParameterHandler.spec.ts
  ActionParameterHandler
    positive
      ✓ handle - should process string parameters (29 ms)
      ✓ handle - should process string parameters, returns empty if a given string is empty (1 ms)
      ✓ handle - should process number parameters
      ✓ handle - undefined on empty object provided
      ✓ handle - null provided (16 ms)
    negative
      ✕ handle - throws error if the parameter is required (8 ms)
      ✓ handle - throws error if the parameter is required, type file provided (1 ms)

  ● ActionParameterHandler › negative › handle - throws error if the parameter is required

    Expected value   "TypeError: Cannot read property 'uuid' of undefined"
    Received:
      "TypeError: Cannot read properties of undefined (reading 'uuid')"

    Message:
      expected 'TypeError: Cannot read properties of undefined (reading \'uuid\')' to equal 'TypeError: Cannot read property \'uuid\' of undefined'

    Difference:

    - Expected
    + Received

    - TypeError: Cannot read property 'uuid' of undefined
    + TypeError: Cannot read properties of undefined (reading 'uuid')

      152 |       }
      153 | 
    > 154 |       expect(error.toString()).to.be.eq("TypeError: Cannot read property 'uuid' of undefined");
          |                                      ^
      155 |     });
      156 | 
      157 |     it('handle - throws error if the parameter is required, type file provided', async () => {

      at Object.<anonymous> (test/ActionParameterHandler.spec.ts:154:38)

PASS test/functional/controller-methods.spec.ts
    controller methods
      ✓ get should respond with proper status code, headers and body content (23 ms)
      ✓ post respond with proper status code, headers and body content (6 ms)
      ✓ put respond with proper status code, headers and body content (3 ms)
      ✓ patch respond with proper status code, headers and body content (4 ms)
      ✓ delete respond with proper status code, headers and body content (4 ms)
      ✓ head respond with proper status code, headers and body content (4 ms)
      ✓ custom method (post) respond with proper status code, headers and body content (2 ms)
      ✓ custom method (delete) respond with proper status code, headers and body content (3 ms)
      ✓ route should work with parameter (3 ms)
      ✓ route should work with regexp parameter (3 ms)
      ✓ should respond with 404 when regexp does not match (5 ms)
      ✓ route should work with string regexp parameter (3 ms)
      ✓ should respond with 404 when regexp does not match (2 ms)
      ✓ should return result from a promise (503 ms)
      ✓ should respond with 500 if promise failed (505 ms)
      ✓ should respond with 204 No Content when null returned in action (16 ms)
      ✓ should respond with 404 Not Found text when undefined returned in action (21 ms)
      ✓ should respond with 404 Not Found JSON when undefined returned in action (3 ms)
      ✓ should respond with 200 and text/html even in json controller's method (2 ms)
      ✓ should respond with 200 and text/plain even in json controller's method (2 ms)
      ✓ should respond with 401 and text/html when UnauthorizedError throwed even in json controller's method (5 ms)
      ✓ should respond with 401 and aplication/json when UnauthorizedError is thrown in standard json controller's method (3 ms)

PASS test/functional/json-controller-methods.spec.ts
    json-controller methods
      ✓ get should respond with proper status code, headers and body content (11 ms)
      ✓ post respond with proper status code, headers and body content (2 ms)
      ✓ put respond with proper status code, headers and body content (3 ms)
      ✓ patch respond with proper status code, headers and body content (2 ms)
      ✓ delete respond with proper status code, headers and body content (3 ms)
      ✓ head respond with proper status code, headers and body content (2 ms)
      ✓ custom method (post) respond with proper status code, headers and body content (2 ms)
      ✓ custom method (delete) respond with proper status code, headers and body content (2 ms)
      ✓ route should work with parameter (3 ms)
      ✓ route should work with regexp parameter (3 ms)
      ✓ should respond with 404 when regexp does not match (4 ms)
      ✓ route should work with string regexp parameter (3 ms)
      ✓ should respond with 404 when regexp does not match (2 ms)
      ✓ should return result from a promise (503 ms)
      ✓ should respond with 500 if promise failed (505 ms)

PASS test/functional/interceptors.spec.ts
    interceptor
      ✓ custom interceptor function should replace returned content (9 ms)
      ✓ custom interceptor class should replace returned content (3 ms)
      ✓ custom interceptor class used on the whole controller should replace returned content (3 ms)
      ✓ global interceptor class should replace returned content (2 ms)
      ✓ interceptors should support promises (1005 ms)

PASS test/functional/action-params.spec.ts
    ✓ @Req and @Res should be provided as Request and Response objects (10 ms)
    ✓ @Res writing directly to the response should work (4 ms)
    ✓ @Param should give a param from route (4 ms)
    ✓ @Param multiple params should give a proper values from route (2 ms)
    ✓ @SessionParam without middleware (23 ms)
    ✓ @Session should return a value from session (10 ms)
    ✓ @Session(param) should allow to inject empty property (3 ms)
    ✓ @QueryParams should give a proper values from request's query parameters (10 ms)
    ✓ @QueryParams should give a proper values from request's query parameters and one multiple value (6 ms)
    ✓ @QueryParams should give a proper values from request's query with validate whitelist option on (12 ms)
    ✓ @QueryParams should give a proper values from request's query parameters with nested json (5 ms)
    ✓ @QueryParams should not validate request query parameters when it's turned off in validator options (2 ms)
    ✓ @QueryParams should give a proper values from request's optional query parameters (3 ms)
    ✓ @QueryParam should give a proper values from request query parameters (3 ms)
    ✓ @QueryParam should give an array of string with only one query parameter (2 ms)
    ✓ @QueryParam should give an array of string with multiple query parameters (2 ms)
    ✓ @QueryParam should give an array of number with only one query parameter (2 ms)
    ✓ @QueryParam should give an array of number with multiple query parameters (3 ms)
    ✓ @QueryParam should give an array of date with only one query parameter (3 ms)
    ✓ @QueryParam should give an array of date with multiple query parameters (2 ms)
    ✓ @QueryParam when required params must be provided and they should not be empty (8 ms)
    ✓ @QueryParam when the type is Date then it should be parsed (2 ms)
    ✓ @QueryParam when the type is Date and it is invalid then the response should be a BadRequest error (2 ms)
    ✓ @QueryParam when parseJson flag is used query param must be converted to object (2 ms)
    ✓ @HeaderParam should give a proper values from request headers (2 ms)
    ✓ @HeaderParam when required is params must be provided and they should not be empty (2 ms)
    ✓ @HeaderParam should fail with invalid request options (2 ms)
    ✓ @HeaderParam should fail with missing required params (3 ms)
    ✓ for @HeaderParam when parseJson flag is used query param must be converted to object (3 ms)
    ✓ @CookieParam should give a proper values from request headers (3 ms)
    ✓ @CookieParam when required is params must be provided and they should not be empty (4 ms)
    ✓ @CookieParam when parseJson flag is used query param must be converted to object (2 ms)
    ✓ @Body should provide a request body (13 ms)
    ✓ @Body should fail if required body was not provided (11 ms)
    ✓ @Body should provide a json object for json-typed controllers and actions (3 ms)
    ✓ @Body should fail if required body was not provided for json-typed controllers and actions (5 ms)
    ✓ @BodyParam should provide a json object for json-typed controllers and actions (2 ms)
    ✓ @BodyParam should fail if required body was not provided for json-typed controllers and actions (17 ms)
    ✓ @Body using application/x-www-form-urlencoded should handle url encoded form data (4 ms)
    ✓ @UploadedFile using multipart/form-data should provide uploaded file with the given name (12 ms)
    ✓ @UploadedFile with @Body should return both the file and the body (6 ms)
    ✓ @UploadedFile with @BodyParam should return both the file and the body param (4 ms)
    ✓ @UploadedFile with passed uploading options (limit) should throw an error (5 ms)
    ✓ @UploadedFile when required is used files must be provided (7 ms)
    ✓ @UploadedFiles should provide uploaded files with the given name (5 ms)
    ✓ @UploadedFiles with passed uploading options (limit) should throw an error (5 ms)
    ✓ @UploadedFiles when required is used files must be provided (4 ms)

PASS test/functional/load-from-directory.spec.ts
    loading all controllers from the given directories
      ✓ should load all controllers (20 ms)
    loading all express middlewares and error handlers from the given directories
      ✓ should succeed (14 ms)
      ✓ should fail (22 ms)

PASS test/functional/container.spec.ts
    using typedi container should be possible
      ✓ typedi container (53 ms)
    using custom container should be possible
      ✓ custom container (6 ms)
    using custom container with fallback should be possible
      ✓ custom container with fallback (10 ms)
    using custom container with fallback and fallback on throw error should be possible
      ✓ custom container with fallback and fallback on throw error (12 ms)

PASS test/functional/controller-options.spec.ts
    controller options
      ✓ controller transform is enabled by default (65 ms)
      ✓ when controller transform is enabled (5 ms)
      ✓ when controller transform is disabled (24 ms)

PASS test/functional/auth-decorator.spec.ts
    Controller responds with value when Authorization succeeds (async)
      ✓ without roles (77 ms)
      ✓ with roles (14 ms)
      ✓ async (25 ms)
    Controller responds with value when Authorization succeeds (sync)
      ✓ without roles (4 ms)
      ✓ with roles (3 ms)
      ✓ async (13 ms)
    Authorized Decorators Http Status Code
      ✓ without roles (21 ms)
      ✓ with roles (6 ms)
    Authorization checker allows to throw (async)
      ✓ custom errors (8 ms)
    Authorization checker allows to throw (sync)
      ✓ custom errors (4 ms)

PASS test/functional/other-controller-decorators.spec.ts
    other controller decorators
      ✓ should return httpCode set by @HttpCode decorator (12 ms)
      ✓ should return custom code when @OnNull (31 ms)
      ✓ should return custom error message and code when @OnUndefined is used with Error class (7 ms)
      ✓ should return custom code when @OnUndefined (8 ms)
      ✓ should return content-type in the response when @ContentType is used (2 ms)
      ✓ should return content-type in the response when @ContentType is used (2 ms)
      ✓ should return response with custom headers when @Header is used (3 ms)
      ✓ should relocate to new location when @Location is used (2 ms)

PASS test/functional/render-decorator.spec.ts
    template rendering
      ✓ should render a template and use given variables (52 ms)
      ✓ should render a template with given variables and locals variables (40 ms)

PASS test/functional/express-middlewares.spec.ts
    express middlewares
      ✓ should call a global middlewares (12 ms)
      ✓ should use a custom middleware when @UseBefore or @UseAfter is used (3 ms)
      ✓ should call middleware and call it before controller action when @UseBefore is used (2 ms)
      ✓ should call middleware and call it after controller action when @UseAfter is used (3 ms)
      ✓ should call before middleware and call after middleware when @UseAfter and @UseAfter are used (2 ms)
      ✓ should handle errors in custom middlewares (20 ms)

PASS test/functional/class-validator-options.spec.ts
    no options
      ✓ should not use any options if not set (64 ms)
    global options
      should merge local validation options with global validation options prioritizing local
        ✓ succeed (5 ms)
      should pass the valid param after validation
        ✓ succeed (5 ms)
        ✓ should contain param name on validation failed (15 ms)
    local options
      ✓ should apply local options (9 ms)

PASS test/functional/express-error-handling.spec.ts
    express error handling
      ✓ should not call global error handler middleware if there was no errors (9 ms)
      ✓ should call global error handler middleware (20 ms)
      ✓ should call global error handler middleware (4 ms)
      ✓ should call error handler middleware if used (3 ms)
      ✓ should not execute next middleware if soft error handled specifically and stopped error bubbling (3 ms)
      ✓ should process JsonErrors by their toJSON method if it exists (3 ms)

PASS test/unit/controller-inheritance.spec.ts
  controller inheritance
    ✓ should build empty meta for empty set (11 ms)
    ✓ should build meta if the only derivative controller is given (2 ms)
    ✓ should build meta if the only autonomous controller is given
    ✓ should build meta both when autonomous and derivative controllers are given (1 ms)

PASS test/functional/action-options.spec.ts
    ✓ should use controller options when action transform options are not set (37 ms)
    ✓ should override controller options with action transformRequest option (5 ms)
    ✓ should override controller options with action transformResponse option (3 ms)

PASS test/functional/express-custom-error-handling.spec.ts
    custom express error handling
      ✓ should not call global error handler middleware if there was no errors (27 ms)
      ✓ should call global error handler middleware (19 ms)

PASS test/functional/class-transformer-options.spec.ts
    should not use any options if not set
      ✓ technical wrapper (33 ms)
    should apply global options
      ✓ technical wrapper (5 ms)
    should apply local options
      ✓ technical wrapper (6 ms)

PASS test/functional/defaults.spec.ts
    defaults
      ✓ should return undefinedResultCode from defaults config for void function (25 ms)
      ✓ should return undefinedResultCode from defaults config for promise void function (2 ms)
      ✓ should return 400 from required paramOptions (17 ms)
      ✓ should return nullResultCode from defaults config (3 ms)
      ✓ should return status code from OnUndefined annotation (3 ms)
      ✓ should mark arg optional from QueryParam annotation (4 ms)

PASS test/functional/global-options.spec.ts
    routing-controllers global options
      useClassTransformer default value
        ✓ useClassTransformer by default must be set to true (83 ms)
      when useClassTransformer is set to true
        ✓ useClassTransformer is enabled (4 ms)
      when useClassTransformer is set to false
        ✓ useClassTransformer is disabled (3 ms)
      when routePrefix is used all controller routes should be appended by it
        ✓ routePrefix is enabled (6 ms)

PASS test/functional/express-global-before-error-handling.spec.ts
    custom express global before middleware error handling
      ✓ should call global error handler middleware with CustomError (38 ms)

PASS test/functional/controller-base-routes.spec.ts
    controller > base routes functionality
      ✓ get should respond with proper status code, headers and body content (63 ms)
      ✓ get should respond with proper status code, headers and body content (5 ms)
      ✓ get should respond with proper status code, headers and body content - 2nd pass (3 ms)
      ✓ wrong route should respond with 404 error (4 ms)
      ✓ wrong route should respond with 404 error (3 ms)
      ✓ wrong route should respond with 404 error (2 ms)

PASS test/functional/redirect-decorator.spec.ts
    dynamic redirect
      ✓ using template (29 ms)
      ✓ using override (4 ms)
      ✓ using original (4 ms)

PASS test/functional/middlewares-order.spec.ts
    loaded direct from array
      ✓ should call middlewares in order defined by items order (24 ms)
    specified by priority option
      ✓ should call middlewares in order defined by priority parameter of decorator (2 ms)

PASS test/functional/special-result-send.spec.ts
    special result value treatment
      ✓ should pipe stream to response (8 ms)
      ✓ should send raw binary data from Buffer (4 ms)
      ✓ should send raw binary data from UIntArray (17 ms)

PASS test/functional/error-subclasses.spec.ts
  HttpError
    ✓ should be instance of HttpError and Error (3 ms)
  BadRequestError
    ✓ should be instance of BadRequestError, HttpError and Error (2 ms)

Summary of all failing tests
FAIL test/ActionParameterHandler.spec.ts
  ● ActionParameterHandler › negative › handle - throws error if the parameter is required

    Expected value   "TypeError: Cannot read property 'uuid' of undefined"
    Received:
      "TypeError: Cannot read properties of undefined (reading 'uuid')"

    Message:
      expected 'TypeError: Cannot read properties of undefined (reading \'uuid\')' to equal 'TypeError: Cannot read property \'uuid\' of undefined'

    Difference:

    - Expected
    + Received

    - TypeError: Cannot read property 'uuid' of undefined
    + TypeError: Cannot read properties of undefined (reading 'uuid')

      152 |       }
      153 | 
    > 154 |       expect(error.toString()).to.be.eq("TypeError: Cannot read property 'uuid' of undefined");
          |                                      ^
      155 |     });
      156 | 
      157 |     it('handle - throws error if the parameter is required, type file provided', async () => {

      at Object.<anonymous> (test/ActionParameterHandler.spec.ts:154:38)


Test Suites: 1 failed, 25 passed, 26 total
Tests:       1 failed, 181 passed, 182 total
Snapshots:   0 total
Time:        13.328 s
Ran all test suites.
************* run test done *************
routing-controllers is testing ./Variants/express/variant8/express
************* npm unlink module *************
************* npm unlink module done *************
************* npm unlink globally *************
************* npm unlink globally done *************
************* npm link globally *************
************* npm link globally done *************
************* npm link module *************
************* npm link module done *************
************* start run test *************
ts-jest[config] (WARN) The option `tsConfig` is deprecated and will be removed in ts-jest 27, use `tsconfig` instead
FAIL test/ActionParameterHandler.spec.ts
  ActionParameterHandler
    positive
      ✓ handle - should process string parameters (34 ms)
      ✓ handle - should process string parameters, returns empty if a given string is empty
      ✓ handle - should process number parameters (1 ms)
      ✓ handle - undefined on empty object provided
      ✓ handle - null provided (12 ms)
    negative
      ✕ handle - throws error if the parameter is required (8 ms)
      ✓ handle - throws error if the parameter is required, type file provided (1 ms)

  ● ActionParameterHandler › negative › handle - throws error if the parameter is required

    Expected value   "TypeError: Cannot read property 'uuid' of undefined"
    Received:
      "TypeError: Cannot read properties of undefined (reading 'uuid')"

    Message:
      expected 'TypeError: Cannot read properties of undefined (reading \'uuid\')' to equal 'TypeError: Cannot read property \'uuid\' of undefined'

    Difference:

    - Expected
    + Received

    - TypeError: Cannot read property 'uuid' of undefined
    + TypeError: Cannot read properties of undefined (reading 'uuid')

      152 |       }
      153 | 
    > 154 |       expect(error.toString()).to.be.eq("TypeError: Cannot read property 'uuid' of undefined");
          |                                      ^
      155 |     });
      156 | 
      157 |     it('handle - throws error if the parameter is required, type file provided', async () => {

      at Object.<anonymous> (test/ActionParameterHandler.spec.ts:154:38)

PASS test/functional/controller-methods.spec.ts
    controller methods
      ✓ get should respond with proper status code, headers and body content (21 ms)
      ✓ post respond with proper status code, headers and body content (5 ms)
      ✓ put respond with proper status code, headers and body content (3 ms)
      ✓ patch respond with proper status code, headers and body content (3 ms)
      ✓ delete respond with proper status code, headers and body content (3 ms)
      ✓ head respond with proper status code, headers and body content (3 ms)
      ✓ custom method (post) respond with proper status code, headers and body content (2 ms)
      ✓ custom method (delete) respond with proper status code, headers and body content (3 ms)
      ✓ route should work with parameter (3 ms)
      ✓ route should work with regexp parameter (3 ms)
      ✓ should respond with 404 when regexp does not match (4 ms)
      ✓ route should work with string regexp parameter (3 ms)
      ✓ should respond with 404 when regexp does not match (3 ms)
      ✓ should return result from a promise (504 ms)
      ✓ should respond with 500 if promise failed (505 ms)
      ✓ should respond with 204 No Content when null returned in action (16 ms)
      ✓ should respond with 404 Not Found text when undefined returned in action (21 ms)
      ✓ should respond with 404 Not Found JSON when undefined returned in action (3 ms)
      ✓ should respond with 200 and text/html even in json controller's method (2 ms)
      ✓ should respond with 200 and text/plain even in json controller's method (2 ms)
      ✓ should respond with 401 and text/html when UnauthorizedError throwed even in json controller's method (4 ms)
      ✓ should respond with 401 and aplication/json when UnauthorizedError is thrown in standard json controller's method (3 ms)

PASS test/functional/json-controller-methods.spec.ts
    json-controller methods
      ✓ get should respond with proper status code, headers and body content (10 ms)
      ✓ post respond with proper status code, headers and body content (3 ms)
      ✓ put respond with proper status code, headers and body content (2 ms)
      ✓ patch respond with proper status code, headers and body content (3 ms)
      ✓ delete respond with proper status code, headers and body content (2 ms)
      ✓ head respond with proper status code, headers and body content (2 ms)
      ✓ custom method (post) respond with proper status code, headers and body content (2 ms)
      ✓ custom method (delete) respond with proper status code, headers and body content (2 ms)
      ✓ route should work with parameter (3 ms)
      ✓ route should work with regexp parameter (2 ms)
      ✓ should respond with 404 when regexp does not match (4 ms)
      ✓ route should work with string regexp parameter (3 ms)
      ✓ should respond with 404 when regexp does not match (2 ms)
      ✓ should return result from a promise (504 ms)
      ✓ should respond with 500 if promise failed (505 ms)

PASS test/functional/interceptors.spec.ts
    interceptor
      ✓ custom interceptor function should replace returned content (9 ms)
      ✓ custom interceptor class should replace returned content (3 ms)
      ✓ custom interceptor class used on the whole controller should replace returned content (3 ms)
      ✓ global interceptor class should replace returned content (2 ms)
      ✓ interceptors should support promises (1005 ms)

PASS test/functional/action-params.spec.ts
    ✓ @Req and @Res should be provided as Request and Response objects (10 ms)
    ✓ @Res writing directly to the response should work (4 ms)
    ✓ @Param should give a param from route (3 ms)
    ✓ @Param multiple params should give a proper values from route (3 ms)
    ✓ @SessionParam without middleware (22 ms)
    ✓ @Session should return a value from session (11 ms)
    ✓ @Session(param) should allow to inject empty property (3 ms)
    ✓ @QueryParams should give a proper values from request's query parameters (9 ms)
    ✓ @QueryParams should give a proper values from request's query parameters and one multiple value (6 ms)
    ✓ @QueryParams should give a proper values from request's query with validate whitelist option on (14 ms)
    ✓ @QueryParams should give a proper values from request's query parameters with nested json (5 ms)
    ✓ @QueryParams should not validate request query parameters when it's turned off in validator options (3 ms)
    ✓ @QueryParams should give a proper values from request's optional query parameters (2 ms)
    ✓ @QueryParam should give a proper values from request query parameters (3 ms)
    ✓ @QueryParam should give an array of string with only one query parameter (2 ms)
    ✓ @QueryParam should give an array of string with multiple query parameters (2 ms)
    ✓ @QueryParam should give an array of number with only one query parameter (3 ms)
    ✓ @QueryParam should give an array of number with multiple query parameters (3 ms)
    ✓ @QueryParam should give an array of date with only one query parameter (2 ms)
    ✓ @QueryParam should give an array of date with multiple query parameters (2 ms)
    ✓ @QueryParam when required params must be provided and they should not be empty (7 ms)
    ✓ @QueryParam when the type is Date then it should be parsed (2 ms)
    ✓ @QueryParam when the type is Date and it is invalid then the response should be a BadRequest error (3 ms)
    ✓ @QueryParam when parseJson flag is used query param must be converted to object (2 ms)
    ✓ @HeaderParam should give a proper values from request headers (2 ms)
    ✓ @HeaderParam when required is params must be provided and they should not be empty (2 ms)
    ✓ @HeaderParam should fail with invalid request options (4 ms)
    ✓ @HeaderParam should fail with missing required params (3 ms)
    ✓ for @HeaderParam when parseJson flag is used query param must be converted to object (3 ms)
    ✓ @CookieParam should give a proper values from request headers (2 ms)
    ✓ @CookieParam when required is params must be provided and they should not be empty (3 ms)
    ✓ @CookieParam when parseJson flag is used query param must be converted to object (2 ms)
    ✓ @Body should provide a request body (12 ms)
    ✓ @Body should fail if required body was not provided (14 ms)
    ✓ @Body should provide a json object for json-typed controllers and actions (3 ms)
    ✓ @Body should fail if required body was not provided for json-typed controllers and actions (4 ms)
    ✓ @BodyParam should provide a json object for json-typed controllers and actions (3 ms)
    ✓ @BodyParam should fail if required body was not provided for json-typed controllers and actions (17 ms)
    ✓ @Body using application/x-www-form-urlencoded should handle url encoded form data (4 ms)
    ✓ @UploadedFile using multipart/form-data should provide uploaded file with the given name (12 ms)
    ✓ @UploadedFile with @Body should return both the file and the body (6 ms)
    ✓ @UploadedFile with @BodyParam should return both the file and the body param (4 ms)
    ✓ @UploadedFile with passed uploading options (limit) should throw an error (5 ms)
    ✓ @UploadedFile when required is used files must be provided (7 ms)
    ✓ @UploadedFiles should provide uploaded files with the given name (5 ms)
    ✓ @UploadedFiles with passed uploading options (limit) should throw an error (5 ms)
    ✓ @UploadedFiles when required is used files must be provided (4 ms)

PASS test/functional/express-middlewares.spec.ts
    express middlewares
      ✓ should call a global middlewares (9 ms)
      ✓ should use a custom middleware when @UseBefore or @UseAfter is used (3 ms)
      ✓ should call middleware and call it before controller action when @UseBefore is used (2 ms)
      ✓ should call middleware and call it after controller action when @UseAfter is used (3 ms)
      ✓ should call before middleware and call after middleware when @UseAfter and @UseAfter are used (2 ms)
      ✓ should handle errors in custom middlewares (20 ms)

PASS test/functional/load-from-directory.spec.ts
    loading all controllers from the given directories
      ✓ should load all controllers (19 ms)
    loading all express middlewares and error handlers from the given directories
      ✓ should succeed (13 ms)
      ✓ should fail (21 ms)

PASS test/functional/auth-decorator.spec.ts
    Controller responds with value when Authorization succeeds (async)
      ✓ without roles (59 ms)
      ✓ with roles (14 ms)
      ✓ async (25 ms)
    Controller responds with value when Authorization succeeds (sync)
      ✓ without roles (5 ms)
      ✓ with roles (4 ms)
      ✓ async (13 ms)
    Authorized Decorators Http Status Code
      ✓ without roles (35 ms)
      ✓ with roles (5 ms)
    Authorization checker allows to throw (async)
      ✓ custom errors (4 ms)
    Authorization checker allows to throw (sync)
      ✓ custom errors (3 ms)

PASS test/functional/class-transformer-options.spec.ts
    should not use any options if not set
      ✓ technical wrapper (84 ms)
    should apply global options
      ✓ technical wrapper (5 ms)
    should apply local options
      ✓ technical wrapper (5 ms)

PASS test/functional/controller-options.spec.ts
    controller options
      ✓ controller transform is enabled by default (19 ms)
      ✓ when controller transform is enabled (5 ms)
      ✓ when controller transform is disabled (3 ms)

PASS test/functional/render-decorator.spec.ts
    template rendering
      ✓ should render a template and use given variables (26 ms)
      ✓ should render a template with given variables and locals variables (8 ms)

PASS test/functional/other-controller-decorators.spec.ts
    other controller decorators
      ✓ should return httpCode set by @HttpCode decorator (24 ms)
      ✓ should return custom code when @OnNull (31 ms)
      ✓ should return custom error message and code when @OnUndefined is used with Error class (7 ms)
      ✓ should return custom code when @OnUndefined (20 ms)
      ✓ should return content-type in the response when @ContentType is used (2 ms)
      ✓ should return content-type in the response when @ContentType is used (2 ms)
      ✓ should return response with custom headers when @Header is used (3 ms)
      ✓ should relocate to new location when @Location is used (3 ms)

PASS test/functional/class-validator-options.spec.ts
    no options
      ✓ should not use any options if not set (66 ms)
    global options
      should merge local validation options with global validation options prioritizing local
        ✓ succeed (7 ms)
      should pass the valid param after validation
        ✓ succeed (6 ms)
        ✓ should contain param name on validation failed (19 ms)
    local options
      ✓ should apply local options (5 ms)

PASS test/functional/container.spec.ts
    using typedi container should be possible
      ✓ typedi container (64 ms)
    using custom container should be possible
      ✓ custom container (6 ms)
    using custom container with fallback should be possible
      ✓ custom container with fallback (8 ms)
    using custom container with fallback and fallback on throw error should be possible
      ✓ custom container with fallback and fallback on throw error (8 ms)

PASS test/functional/global-options.spec.ts
    routing-controllers global options
      useClassTransformer default value
        ✓ useClassTransformer by default must be set to true (113 ms)
      when useClassTransformer is set to true
        ✓ useClassTransformer is enabled (4 ms)
      when useClassTransformer is set to false
        ✓ useClassTransformer is disabled (4 ms)
      when routePrefix is used all controller routes should be appended by it
        ✓ routePrefix is enabled (6 ms)

PASS test/functional/special-result-send.spec.ts
    special result value treatment
      ✓ should pipe stream to response (23 ms)
      ✓ should send raw binary data from Buffer (3 ms)
      ✓ should send raw binary data from UIntArray (2 ms)

PASS test/functional/express-error-handling.spec.ts
    express error handling
      ✓ should not call global error handler middleware if there was no errors (25 ms)
      ✓ should call global error handler middleware (18 ms)
      ✓ should call global error handler middleware (4 ms)
      ✓ should call error handler middleware if used (3 ms)
      ✓ should not execute next middleware if soft error handled specifically and stopped error bubbling (3 ms)
      ✓ should process JsonErrors by their toJSON method if it exists (2 ms)

PASS test/functional/action-options.spec.ts
    ✓ should use controller options when action transform options are not set (38 ms)
    ✓ should override controller options with action transformRequest option (7 ms)
    ✓ should override controller options with action transformResponse option (3 ms)

PASS test/unit/controller-inheritance.spec.ts
  controller inheritance
    ✓ should build empty meta for empty set (10 ms)
    ✓ should build meta if the only derivative controller is given (1 ms)
    ✓ should build meta if the only autonomous controller is given (1 ms)
    ✓ should build meta both when autonomous and derivative controllers are given (1 ms)

PASS test/functional/defaults.spec.ts
    defaults
      ✓ should return undefinedResultCode from defaults config for void function (8 ms)
      ✓ should return undefinedResultCode from defaults config for promise void function (2 ms)
      ✓ should return 400 from required paramOptions (17 ms)
      ✓ should return nullResultCode from defaults config (3 ms)
      ✓ should return status code from OnUndefined annotation (3 ms)
      ✓ should mark arg optional from QueryParam annotation (4 ms)

PASS test/functional/express-custom-error-handling.spec.ts
    custom express error handling
      ✓ should not call global error handler middleware if there was no errors (23 ms)
      ✓ should call global error handler middleware (19 ms)

PASS test/functional/redirect-decorator.spec.ts
    dynamic redirect
      ✓ using template (29 ms)
      ✓ using override (4 ms)
      ✓ using original (4 ms)

PASS test/functional/controller-base-routes.spec.ts
    controller > base routes functionality
      ✓ get should respond with proper status code, headers and body content (61 ms)
      ✓ get should respond with proper status code, headers and body content (4 ms)
      ✓ get should respond with proper status code, headers and body content - 2nd pass (4 ms)
      ✓ wrong route should respond with 404 error (4 ms)
      ✓ wrong route should respond with 404 error (3 ms)
      ✓ wrong route should respond with 404 error (3 ms)

PASS test/functional/express-global-before-error-handling.spec.ts
    custom express global before middleware error handling
      ✓ should call global error handler middleware with CustomError (38 ms)

PASS test/functional/middlewares-order.spec.ts
    loaded direct from array
      ✓ should call middlewares in order defined by items order (24 ms)
    specified by priority option
      ✓ should call middlewares in order defined by priority parameter of decorator (3 ms)

PASS test/functional/error-subclasses.spec.ts
  HttpError
    ✓ should be instance of HttpError and Error (4 ms)
  BadRequestError
    ✓ should be instance of BadRequestError, HttpError and Error (1 ms)

Summary of all failing tests
FAIL test/ActionParameterHandler.spec.ts
  ● ActionParameterHandler › negative › handle - throws error if the parameter is required

    Expected value   "TypeError: Cannot read property 'uuid' of undefined"
    Received:
      "TypeError: Cannot read properties of undefined (reading 'uuid')"

    Message:
      expected 'TypeError: Cannot read properties of undefined (reading \'uuid\')' to equal 'TypeError: Cannot read property \'uuid\' of undefined'

    Difference:

    - Expected
    + Received

    - TypeError: Cannot read property 'uuid' of undefined
    + TypeError: Cannot read properties of undefined (reading 'uuid')

      152 |       }
      153 | 
    > 154 |       expect(error.toString()).to.be.eq("TypeError: Cannot read property 'uuid' of undefined");
          |                                      ^
      155 |     });
      156 | 
      157 |     it('handle - throws error if the parameter is required, type file provided', async () => {

      at Object.<anonymous> (test/ActionParameterHandler.spec.ts:154:38)


Test Suites: 1 failed, 25 passed, 26 total
Tests:       1 failed, 181 passed, 182 total
Snapshots:   0 total
Time:        13.13 s, estimated 14 s
Ran all test suites.
************* run test done *************
routing-controllers is testing ./Variants/express/variant7/express
************* npm unlink module *************
************* npm unlink module done *************
************* npm unlink globally *************
************* npm unlink globally done *************
************* npm link globally *************
************* npm link globally done *************
************* npm link module *************
************* npm link module done *************
************* start run test *************
ts-jest[config] (WARN) The option `tsConfig` is deprecated and will be removed in ts-jest 27, use `tsconfig` instead
FAIL test/ActionParameterHandler.spec.ts
  ActionParameterHandler
    positive
      ✓ handle - should process string parameters (30 ms)
      ✓ handle - should process string parameters, returns empty if a given string is empty (1 ms)
      ✓ handle - should process number parameters
      ✓ handle - undefined on empty object provided (1 ms)
      ✓ handle - null provided (13 ms)
    negative
      ✕ handle - throws error if the parameter is required (7 ms)
      ✓ handle - throws error if the parameter is required, type file provided (1 ms)

  ● ActionParameterHandler › negative › handle - throws error if the parameter is required

    Expected value   "TypeError: Cannot read property 'uuid' of undefined"
    Received:
      "TypeError: Cannot read properties of undefined (reading 'uuid')"

    Message:
      expected 'TypeError: Cannot read properties of undefined (reading \'uuid\')' to equal 'TypeError: Cannot read property \'uuid\' of undefined'

    Difference:

    - Expected
    + Received

    - TypeError: Cannot read property 'uuid' of undefined
    + TypeError: Cannot read properties of undefined (reading 'uuid')

      152 |       }
      153 | 
    > 154 |       expect(error.toString()).to.be.eq("TypeError: Cannot read property 'uuid' of undefined");
          |                                      ^
      155 |     });
      156 | 
      157 |     it('handle - throws error if the parameter is required, type file provided', async () => {

      at Object.<anonymous> (test/ActionParameterHandler.spec.ts:154:38)

PASS test/functional/controller-methods.spec.ts
    controller methods
      ✓ get should respond with proper status code, headers and body content (21 ms)
      ✓ post respond with proper status code, headers and body content (5 ms)
      ✓ put respond with proper status code, headers and body content (3 ms)
      ✓ patch respond with proper status code, headers and body content (3 ms)
      ✓ delete respond with proper status code, headers and body content (3 ms)
      ✓ head respond with proper status code, headers and body content (2 ms)
      ✓ custom method (post) respond with proper status code, headers and body content (3 ms)
      ✓ custom method (delete) respond with proper status code, headers and body content (2 ms)
      ✓ route should work with parameter (4 ms)
      ✓ route should work with regexp parameter (3 ms)
      ✓ should respond with 404 when regexp does not match (5 ms)
      ✓ route should work with string regexp parameter (3 ms)
      ✓ should respond with 404 when regexp does not match (2 ms)
      ✓ should return result from a promise (505 ms)
      ✓ should respond with 500 if promise failed (504 ms)
      ✓ should respond with 204 No Content when null returned in action (6 ms)
      ✓ should respond with 404 Not Found text when undefined returned in action (20 ms)
      ✓ should respond with 404 Not Found JSON when undefined returned in action (14 ms)
      ✓ should respond with 200 and text/html even in json controller's method (3 ms)
      ✓ should respond with 200 and text/plain even in json controller's method (3 ms)
      ✓ should respond with 401 and text/html when UnauthorizedError throwed even in json controller's method (5 ms)
      ✓ should respond with 401 and aplication/json when UnauthorizedError is thrown in standard json controller's method (2 ms)

PASS test/functional/json-controller-methods.spec.ts
    json-controller methods
      ✓ get should respond with proper status code, headers and body content (10 ms)
      ✓ post respond with proper status code, headers and body content (3 ms)
      ✓ put respond with proper status code, headers and body content (2 ms)
      ✓ patch respond with proper status code, headers and body content (2 ms)
      ✓ delete respond with proper status code, headers and body content (2 ms)
      ✓ head respond with proper status code, headers and body content (2 ms)
      ✓ custom method (post) respond with proper status code, headers and body content (3 ms)
      ✓ custom method (delete) respond with proper status code, headers and body content (2 ms)
      ✓ route should work with parameter (2 ms)
      ✓ route should work with regexp parameter (3 ms)
      ✓ should respond with 404 when regexp does not match (4 ms)
      ✓ route should work with string regexp parameter (3 ms)
      ✓ should respond with 404 when regexp does not match (2 ms)
      ✓ should return result from a promise (504 ms)
      ✓ should respond with 500 if promise failed (505 ms)

PASS test/functional/interceptors.spec.ts
    interceptor
      ✓ custom interceptor function should replace returned content (23 ms)
      ✓ custom interceptor class should replace returned content (3 ms)
      ✓ custom interceptor class used on the whole controller should replace returned content (2 ms)
      ✓ global interceptor class should replace returned content (2 ms)
      ✓ interceptors should support promises (1003 ms)

PASS test/functional/action-params.spec.ts
    ✓ @Req and @Res should be provided as Request and Response objects (11 ms)
    ✓ @Res writing directly to the response should work (4 ms)
    ✓ @Param should give a param from route (3 ms)
    ✓ @Param multiple params should give a proper values from route (2 ms)
    ✓ @SessionParam without middleware (23 ms)
    ✓ @Session should return a value from session (11 ms)
    ✓ @Session(param) should allow to inject empty property (3 ms)
    ✓ @QueryParams should give a proper values from request's query parameters (12 ms)
    ✓ @QueryParams should give a proper values from request's query parameters and one multiple value (6 ms)
    ✓ @QueryParams should give a proper values from request's query with validate whitelist option on (3 ms)
    ✓ @QueryParams should give a proper values from request's query parameters with nested json (5 ms)
    ✓ @QueryParams should not validate request query parameters when it's turned off in validator options (12 ms)
    ✓ @QueryParams should give a proper values from request's optional query parameters (3 ms)
    ✓ @QueryParam should give a proper values from request query parameters (2 ms)
    ✓ @QueryParam should give an array of string with only one query parameter (2 ms)
    ✓ @QueryParam should give an array of string with multiple query parameters (2 ms)
    ✓ @QueryParam should give an array of number with only one query parameter (3 ms)
    ✓ @QueryParam should give an array of number with multiple query parameters (3 ms)
    ✓ @QueryParam should give an array of date with only one query parameter (2 ms)
    ✓ @QueryParam should give an array of date with multiple query parameters (2 ms)
    ✓ @QueryParam when required params must be provided and they should not be empty (8 ms)
    ✓ @QueryParam when the type is Date then it should be parsed (2 ms)
    ✓ @QueryParam when the type is Date and it is invalid then the response should be a BadRequest error (2 ms)
    ✓ @QueryParam when parseJson flag is used query param must be converted to object (2 ms)
    ✓ @HeaderParam should give a proper values from request headers (2 ms)
    ✓ @HeaderParam when required is params must be provided and they should not be empty (2 ms)
    ✓ @HeaderParam should fail with invalid request options (2 ms)
    ✓ @HeaderParam should fail with missing required params (2 ms)
    ✓ for @HeaderParam when parseJson flag is used query param must be converted to object (7 ms)
    ✓ @CookieParam should give a proper values from request headers (3 ms)
    ✓ @CookieParam when required is params must be provided and they should not be empty (3 ms)
    ✓ @CookieParam when parseJson flag is used query param must be converted to object (2 ms)
    ✓ @Body should provide a request body (12 ms)
    ✓ @Body should fail if required body was not provided (7 ms)
    ✓ @Body should provide a json object for json-typed controllers and actions (2 ms)
    ✓ @Body should fail if required body was not provided for json-typed controllers and actions (4 ms)
    ✓ @BodyParam should provide a json object for json-typed controllers and actions (2 ms)
    ✓ @BodyParam should fail if required body was not provided for json-typed controllers and actions (23 ms)
    ✓ @Body using application/x-www-form-urlencoded should handle url encoded form data (4 ms)
    ✓ @UploadedFile using multipart/form-data should provide uploaded file with the given name (12 ms)
    ✓ @UploadedFile with @Body should return both the file and the body (6 ms)
    ✓ @UploadedFile with @BodyParam should return both the file and the body param (4 ms)
    ✓ @UploadedFile with passed uploading options (limit) should throw an error (5 ms)
    ✓ @UploadedFile when required is used files must be provided (7 ms)
    ✓ @UploadedFiles should provide uploaded files with the given name (5 ms)
    ✓ @UploadedFiles with passed uploading options (limit) should throw an error (5 ms)
    ✓ @UploadedFiles when required is used files must be provided (4 ms)

PASS test/functional/other-controller-decorators.spec.ts
    other controller decorators
      ✓ should return httpCode set by @HttpCode decorator (12 ms)
      ✓ should return custom code when @OnNull (33 ms)
      ✓ should return custom error message and code when @OnUndefined is used with Error class (10 ms)
      ✓ should return custom code when @OnUndefined (20 ms)
      ✓ should return content-type in the response when @ContentType is used (3 ms)
      ✓ should return content-type in the response when @ContentType is used (3 ms)
      ✓ should return response with custom headers when @Header is used (8 ms)
      ✓ should relocate to new location when @Location is used (4 ms)

PASS test/functional/auth-decorator.spec.ts
    Controller responds with value when Authorization succeeds (async)
      ✓ without roles (73 ms)
      ✓ with roles (14 ms)
      ✓ async (25 ms)
    Controller responds with value when Authorization succeeds (sync)
      ✓ without roles (4 ms)
      ✓ with roles (4 ms)
      ✓ async (13 ms)
    Authorized Decorators Http Status Code
      ✓ without roles (21 ms)
      ✓ with roles (3 ms)
    Authorization checker allows to throw (async)
      ✓ custom errors (25 ms)
    Authorization checker allows to throw (sync)
      ✓ custom errors (4 ms)

PASS test/functional/global-options.spec.ts
    routing-controllers global options
      useClassTransformer default value
        ✓ useClassTransformer by default must be set to true (85 ms)
      when useClassTransformer is set to true
        ✓ useClassTransformer is enabled (5 ms)
      when useClassTransformer is set to false
        ✓ useClassTransformer is disabled (3 ms)
      when routePrefix is used all controller routes should be appended by it
        ✓ routePrefix is enabled (7 ms)

PASS test/unit/controller-inheritance.spec.ts
  controller inheritance
    ✓ should build empty meta for empty set (11 ms)
    ✓ should build meta if the only derivative controller is given (1 ms)
    ✓ should build meta if the only autonomous controller is given (1 ms)
    ✓ should build meta both when autonomous and derivative controllers are given (1 ms)

PASS test/functional/load-from-directory.spec.ts
    loading all controllers from the given directories
      ✓ should load all controllers (18 ms)
    loading all express middlewares and error handlers from the given directories
      ✓ should succeed (14 ms)
      ✓ should fail (21 ms)

PASS test/functional/class-transformer-options.spec.ts
    should not use any options if not set
      ✓ technical wrapper (205 ms)
    should apply global options
      ✓ technical wrapper (5 ms)
    should apply local options
      ✓ technical wrapper (7 ms)

PASS test/functional/action-options.spec.ts
    ✓ should use controller options when action transform options are not set (34 ms)
    ✓ should override controller options with action transformRequest option (5 ms)
    ✓ should override controller options with action transformResponse option (3 ms)

PASS test/functional/class-validator-options.spec.ts
    no options
      ✓ should not use any options if not set (65 ms)
    global options
      should merge local validation options with global validation options prioritizing local
        ✓ succeed (6 ms)
      should pass the valid param after validation
        ✓ succeed (5 ms)
        ✓ should contain param name on validation failed (20 ms)
    local options
      ✓ should apply local options (7 ms)

PASS test/functional/redirect-decorator.spec.ts
    dynamic redirect
      ✓ using template (29 ms)
      ✓ using override (4 ms)
      ✓ using original (4 ms)

PASS test/functional/controller-options.spec.ts
    controller options
      ✓ controller transform is enabled by default (30 ms)
      ✓ when controller transform is enabled (6 ms)
      ✓ when controller transform is disabled (3 ms)

PASS test/functional/express-middlewares.spec.ts
    express middlewares
      ✓ should call a global middlewares (27 ms)
      ✓ should use a custom middleware when @UseBefore or @UseAfter is used (3 ms)
      ✓ should call middleware and call it before controller action when @UseBefore is used (3 ms)
      ✓ should call middleware and call it after controller action when @UseAfter is used (2 ms)
      ✓ should call before middleware and call after middleware when @UseAfter and @UseAfter are used (3 ms)
      ✓ should handle errors in custom middlewares (25 ms)

PASS test/functional/render-decorator.spec.ts
    template rendering
      ✓ should render a template and use given variables (28 ms)
      ✓ should render a template with given variables and locals variables (5 ms)

PASS test/functional/container.spec.ts
    using typedi container should be possible
      ✓ typedi container (67 ms)
    using custom container should be possible
      ✓ custom container (6 ms)
    using custom container with fallback should be possible
      ✓ custom container with fallback (9 ms)
    using custom container with fallback and fallback on throw error should be possible
      ✓ custom container with fallback and fallback on throw error (9 ms)

PASS test/functional/defaults.spec.ts
    defaults
      ✓ should return undefinedResultCode from defaults config for void function (23 ms)
      ✓ should return undefinedResultCode from defaults config for promise void function (2 ms)
      ✓ should return 400 from required paramOptions (16 ms)
      ✓ should return nullResultCode from defaults config (3 ms)
      ✓ should return status code from OnUndefined annotation (3 ms)
      ✓ should mark arg optional from QueryParam annotation (4 ms)

PASS test/functional/express-error-handling.spec.ts
    express error handling
      ✓ should not call global error handler middleware if there was no errors (25 ms)
      ✓ should call global error handler middleware (22 ms)
      ✓ should call global error handler middleware (3 ms)
      ✓ should call error handler middleware if used (3 ms)
      ✓ should not execute next middleware if soft error handled specifically and stopped error bubbling (3 ms)
      ✓ should process JsonErrors by their toJSON method if it exists (2 ms)

PASS test/functional/controller-base-routes.spec.ts
    controller > base routes functionality
      ✓ get should respond with proper status code, headers and body content (61 ms)
      ✓ get should respond with proper status code, headers and body content (5 ms)
      ✓ get should respond with proper status code, headers and body content - 2nd pass (3 ms)
      ✓ wrong route should respond with 404 error (5 ms)
      ✓ wrong route should respond with 404 error (2 ms)
      ✓ wrong route should respond with 404 error (3 ms)

PASS test/functional/express-custom-error-handling.spec.ts
    custom express error handling
      ✓ should not call global error handler middleware if there was no errors (25 ms)
      ✓ should call global error handler middleware (19 ms)

PASS test/functional/middlewares-order.spec.ts
    loaded direct from array
      ✓ should call middlewares in order defined by items order (24 ms)
    specified by priority option
      ✓ should call middlewares in order defined by priority parameter of decorator (3 ms)

PASS test/functional/express-global-before-error-handling.spec.ts
    custom express global before middleware error handling
      ✓ should call global error handler middleware with CustomError (37 ms)

PASS test/functional/special-result-send.spec.ts
    special result value treatment
      ✓ should pipe stream to response (25 ms)
      ✓ should send raw binary data from Buffer (3 ms)
      ✓ should send raw binary data from UIntArray (2 ms)

PASS test/functional/error-subclasses.spec.ts
  HttpError
    ✓ should be instance of HttpError and Error (6 ms)
  BadRequestError
    ✓ should be instance of BadRequestError, HttpError and Error (1 ms)

Summary of all failing tests
FAIL test/ActionParameterHandler.spec.ts
  ● ActionParameterHandler › negative › handle - throws error if the parameter is required

    Expected value   "TypeError: Cannot read property 'uuid' of undefined"
    Received:
      "TypeError: Cannot read properties of undefined (reading 'uuid')"

    Message:
      expected 'TypeError: Cannot read properties of undefined (reading \'uuid\')' to equal 'TypeError: Cannot read property \'uuid\' of undefined'

    Difference:

    - Expected
    + Received

    - TypeError: Cannot read property 'uuid' of undefined
    + TypeError: Cannot read properties of undefined (reading 'uuid')

      152 |       }
      153 | 
    > 154 |       expect(error.toString()).to.be.eq("TypeError: Cannot read property 'uuid' of undefined");
          |                                      ^
      155 |     });
      156 | 
      157 |     it('handle - throws error if the parameter is required, type file provided', async () => {

      at Object.<anonymous> (test/ActionParameterHandler.spec.ts:154:38)


Test Suites: 1 failed, 25 passed, 26 total
Tests:       1 failed, 181 passed, 182 total
Snapshots:   0 total
Time:        13.197 s
Ran all test suites.
************* run test done *************
routing-controllers is testing ./Variants/express/variant6/express
************* npm unlink module *************
************* npm unlink module done *************
************* npm unlink globally *************
************* npm unlink globally done *************
************* npm link globally *************
************* npm link globally done *************
************* npm link module *************
************* npm link module done *************
************* start run test *************
ts-jest[config] (WARN) The option `tsConfig` is deprecated and will be removed in ts-jest 27, use `tsconfig` instead
FAIL test/ActionParameterHandler.spec.ts
  ActionParameterHandler
    positive
      ✓ handle - should process string parameters (33 ms)
      ✓ handle - should process string parameters, returns empty if a given string is empty (1 ms)
      ✓ handle - should process number parameters
      ✓ handle - undefined on empty object provided
      ✓ handle - null provided (14 ms)
    negative
      ✕ handle - throws error if the parameter is required (7 ms)
      ✓ handle - throws error if the parameter is required, type file provided (1 ms)

  ● ActionParameterHandler › negative › handle - throws error if the parameter is required

    Expected value   "TypeError: Cannot read property 'uuid' of undefined"
    Received:
      "TypeError: Cannot read properties of undefined (reading 'uuid')"

    Message:
      expected 'TypeError: Cannot read properties of undefined (reading \'uuid\')' to equal 'TypeError: Cannot read property \'uuid\' of undefined'

    Difference:

    - Expected
    + Received

    - TypeError: Cannot read property 'uuid' of undefined
    + TypeError: Cannot read properties of undefined (reading 'uuid')

      152 |       }
      153 | 
    > 154 |       expect(error.toString()).to.be.eq("TypeError: Cannot read property 'uuid' of undefined");
          |                                      ^
      155 |     });
      156 | 
      157 |     it('handle - throws error if the parameter is required, type file provided', async () => {

      at Object.<anonymous> (test/ActionParameterHandler.spec.ts:154:38)

PASS test/functional/controller-methods.spec.ts
    controller methods
      ✓ get should respond with proper status code, headers and body content (20 ms)
      ✓ post respond with proper status code, headers and body content (5 ms)
      ✓ put respond with proper status code, headers and body content (3 ms)
      ✓ patch respond with proper status code, headers and body content (3 ms)
      ✓ delete respond with proper status code, headers and body content (3 ms)
      ✓ head respond with proper status code, headers and body content (3 ms)
      ✓ custom method (post) respond with proper status code, headers and body content (2 ms)
      ✓ custom method (delete) respond with proper status code, headers and body content (3 ms)
      ✓ route should work with parameter (3 ms)
      ✓ route should work with regexp parameter (3 ms)
      ✓ should respond with 404 when regexp does not match (5 ms)
      ✓ route should work with string regexp parameter (3 ms)
      ✓ should respond with 404 when regexp does not match (2 ms)
      ✓ should return result from a promise (514 ms)
      ✓ should respond with 500 if promise failed (504 ms)
      ✓ should respond with 204 No Content when null returned in action (6 ms)
      ✓ should respond with 404 Not Found text when undefined returned in action (20 ms)
      ✓ should respond with 404 Not Found JSON when undefined returned in action (3 ms)
      ✓ should respond with 200 and text/html even in json controller's method (2 ms)
      ✓ should respond with 200 and text/plain even in json controller's method (2 ms)
      ✓ should respond with 401 and text/html when UnauthorizedError throwed even in json controller's method (4 ms)
      ✓ should respond with 401 and aplication/json when UnauthorizedError is thrown in standard json controller's method (2 ms)

PASS test/functional/json-controller-methods.spec.ts
    json-controller methods
      ✓ get should respond with proper status code, headers and body content (10 ms)
      ✓ post respond with proper status code, headers and body content (3 ms)
      ✓ put respond with proper status code, headers and body content (2 ms)
      ✓ patch respond with proper status code, headers and body content (2 ms)
      ✓ delete respond with proper status code, headers and body content (2 ms)
      ✓ head respond with proper status code, headers and body content (3 ms)
      ✓ custom method (post) respond with proper status code, headers and body content (2 ms)
      ✓ custom method (delete) respond with proper status code, headers and body content (2 ms)
      ✓ route should work with parameter (3 ms)
      ✓ route should work with regexp parameter (3 ms)
      ✓ should respond with 404 when regexp does not match (3 ms)
      ✓ route should work with string regexp parameter (3 ms)
      ✓ should respond with 404 when regexp does not match (1 ms)
      ✓ should return result from a promise (505 ms)
      ✓ should respond with 500 if promise failed (505 ms)

PASS test/functional/interceptors.spec.ts
    interceptor
      ✓ custom interceptor function should replace returned content (9 ms)
      ✓ custom interceptor class should replace returned content (3 ms)
      ✓ custom interceptor class used on the whole controller should replace returned content (3 ms)
      ✓ global interceptor class should replace returned content (2 ms)
      ✓ interceptors should support promises (1005 ms)

PASS test/functional/action-params.spec.ts
    ✓ @Req and @Res should be provided as Request and Response objects (10 ms)
    ✓ @Res writing directly to the response should work (4 ms)
    ✓ @Param should give a param from route (3 ms)
    ✓ @Param multiple params should give a proper values from route (3 ms)
    ✓ @SessionParam without middleware (23 ms)
    ✓ @Session should return a value from session (10 ms)
    ✓ @Session(param) should allow to inject empty property (3 ms)
    ✓ @QueryParams should give a proper values from request's query parameters (10 ms)
    ✓ @QueryParams should give a proper values from request's query parameters and one multiple value (6 ms)
    ✓ @QueryParams should give a proper values from request's query with validate whitelist option on (14 ms)
    ✓ @QueryParams should give a proper values from request's query parameters with nested json (4 ms)
    ✓ @QueryParams should not validate request query parameters when it's turned off in validator options (3 ms)
    ✓ @QueryParams should give a proper values from request's optional query parameters (2 ms)
    ✓ @QueryParam should give a proper values from request query parameters (3 ms)
    ✓ @QueryParam should give an array of string with only one query parameter (2 ms)
    ✓ @QueryParam should give an array of string with multiple query parameters (2 ms)
    ✓ @QueryParam should give an array of number with only one query parameter (3 ms)
    ✓ @QueryParam should give an array of number with multiple query parameters (3 ms)
    ✓ @QueryParam should give an array of date with only one query parameter (2 ms)
    ✓ @QueryParam should give an array of date with multiple query parameters (2 ms)
    ✓ @QueryParam when required params must be provided and they should not be empty (7 ms)
    ✓ @QueryParam when the type is Date then it should be parsed (2 ms)
    ✓ @QueryParam when the type is Date and it is invalid then the response should be a BadRequest error (3 ms)
    ✓ @QueryParam when parseJson flag is used query param must be converted to object (1 ms)
    ✓ @HeaderParam should give a proper values from request headers (2 ms)
    ✓ @HeaderParam when required is params must be provided and they should not be empty (2 ms)
    ✓ @HeaderParam should fail with invalid request options (3 ms)
    ✓ @HeaderParam should fail with missing required params (3 ms)
    ✓ for @HeaderParam when parseJson flag is used query param must be converted to object (2 ms)
    ✓ @CookieParam should give a proper values from request headers (3 ms)
    ✓ @CookieParam when required is params must be provided and they should not be empty (3 ms)
    ✓ @CookieParam when parseJson flag is used query param must be converted to object (2 ms)
    ✓ @Body should provide a request body (12 ms)
    ✓ @Body should fail if required body was not provided (11 ms)
    ✓ @Body should provide a json object for json-typed controllers and actions (2 ms)
    ✓ @Body should fail if required body was not provided for json-typed controllers and actions (5 ms)
    ✓ @BodyParam should provide a json object for json-typed controllers and actions (2 ms)
    ✓ @BodyParam should fail if required body was not provided for json-typed controllers and actions (18 ms)
    ✓ @Body using application/x-www-form-urlencoded should handle url encoded form data (4 ms)
    ✓ @UploadedFile using multipart/form-data should provide uploaded file with the given name (12 ms)
    ✓ @UploadedFile with @Body should return both the file and the body (6 ms)
    ✓ @UploadedFile with @BodyParam should return both the file and the body param (5 ms)
    ✓ @UploadedFile with passed uploading options (limit) should throw an error (5 ms)
    ✓ @UploadedFile when required is used files must be provided (6 ms)
    ✓ @UploadedFiles should provide uploaded files with the given name (5 ms)
    ✓ @UploadedFiles with passed uploading options (limit) should throw an error (5 ms)
    ✓ @UploadedFiles when required is used files must be provided (4 ms)

PASS test/functional/class-transformer-options.spec.ts
    should not use any options if not set
      ✓ technical wrapper (59 ms)
    should apply global options
      ✓ technical wrapper (5 ms)
    should apply local options
      ✓ technical wrapper (4 ms)

PASS test/functional/auth-decorator.spec.ts
    Controller responds with value when Authorization succeeds (async)
      ✓ without roles (61 ms)
      ✓ with roles (14 ms)
      ✓ async (24 ms)
    Controller responds with value when Authorization succeeds (sync)
      ✓ without roles (5 ms)
      ✓ with roles (5 ms)
      ✓ async (14 ms)
    Authorized Decorators Http Status Code
      ✓ without roles (37 ms)
      ✓ with roles (5 ms)
    Authorization checker allows to throw (async)
      ✓ custom errors (7 ms)
    Authorization checker allows to throw (sync)
      ✓ custom errors (5 ms)

PASS test/functional/action-options.spec.ts
    ✓ should use controller options when action transform options are not set (35 ms)
    ✓ should override controller options with action transformRequest option (5 ms)
    ✓ should override controller options with action transformResponse option (2 ms)

PASS test/functional/other-controller-decorators.spec.ts
    other controller decorators
      ✓ should return httpCode set by @HttpCode decorator (26 ms)
      ✓ should return custom code when @OnNull (29 ms)
      ✓ should return custom error message and code when @OnUndefined is used with Error class (8 ms)
      ✓ should return custom code when @OnUndefined (8 ms)
      ✓ should return content-type in the response when @ContentType is used (2 ms)
      ✓ should return content-type in the response when @ContentType is used (2 ms)
      ✓ should return response with custom headers when @Header is used (6 ms)
      ✓ should relocate to new location when @Location is used (1 ms)

PASS test/functional/load-from-directory.spec.ts
    loading all controllers from the given directories
      ✓ should load all controllers (19 ms)
    loading all express middlewares and error handlers from the given directories
      ✓ should succeed (9 ms)
      ✓ should fail (17 ms)

PASS test/functional/defaults.spec.ts
    defaults
      ✓ should return undefinedResultCode from defaults config for void function (24 ms)
      ✓ should return undefinedResultCode from defaults config for promise void function (5 ms)
      ✓ should return 400 from required paramOptions (58 ms)
      ✓ should return nullResultCode from defaults config (4 ms)
      ✓ should return status code from OnUndefined annotation (14 ms)
      ✓ should mark arg optional from QueryParam annotation (7 ms)

PASS test/functional/container.spec.ts
    using typedi container should be possible
      ✓ typedi container (71 ms)
    using custom container should be possible
      ✓ custom container (7 ms)
    using custom container with fallback should be possible
      ✓ custom container with fallback (13 ms)
    using custom container with fallback and fallback on throw error should be possible
      ✓ custom container with fallback and fallback on throw error (24 ms)

PASS test/functional/class-validator-options.spec.ts
    no options
      ✓ should not use any options if not set (51 ms)
    global options
      should merge local validation options with global validation options prioritizing local
        ✓ succeed (20 ms)
      should pass the valid param after validation
        ✓ succeed (5 ms)
        ✓ should contain param name on validation failed (16 ms)
    local options
      ✓ should apply local options (6 ms)

PASS test/functional/express-error-handling.spec.ts
    express error handling
      ✓ should not call global error handler middleware if there was no errors (24 ms)
      ✓ should call global error handler middleware (20 ms)
      ✓ should call global error handler middleware (4 ms)
      ✓ should call error handler middleware if used (3 ms)
      ✓ should not execute next middleware if soft error handled specifically and stopped error bubbling (2 ms)
      ✓ should process JsonErrors by their toJSON method if it exists (3 ms)

PASS test/functional/express-middlewares.spec.ts
    express middlewares
      ✓ should call a global middlewares (24 ms)
      ✓ should use a custom middleware when @UseBefore or @UseAfter is used (2 ms)
      ✓ should call middleware and call it before controller action when @UseBefore is used (3 ms)
      ✓ should call middleware and call it after controller action when @UseAfter is used (4 ms)
      ✓ should call before middleware and call after middleware when @UseAfter and @UseAfter are used (3 ms)
      ✓ should handle errors in custom middlewares (22 ms)

PASS test/functional/global-options.spec.ts
    routing-controllers global options
      useClassTransformer default value
        ✓ useClassTransformer by default must be set to true (84 ms)
      when useClassTransformer is set to true
        ✓ useClassTransformer is enabled (4 ms)
      when useClassTransformer is set to false
        ✓ useClassTransformer is disabled (4 ms)
      when routePrefix is used all controller routes should be appended by it
        ✓ routePrefix is enabled (6 ms)

PASS test/unit/controller-inheritance.spec.ts
  controller inheritance
    ✓ should build empty meta for empty set (10 ms)
    ✓ should build meta if the only derivative controller is given (2 ms)
    ✓ should build meta if the only autonomous controller is given (1 ms)
    ✓ should build meta both when autonomous and derivative controllers are given

PASS test/functional/express-custom-error-handling.spec.ts
    custom express error handling
      ✓ should not call global error handler middleware if there was no errors (10 ms)
      ✓ should call global error handler middleware (19 ms)

PASS test/functional/controller-options.spec.ts
    controller options
      ✓ controller transform is enabled by default (37 ms)
      ✓ when controller transform is enabled (6 ms)
      ✓ when controller transform is disabled (3 ms)

PASS test/functional/render-decorator.spec.ts
    template rendering
      ✓ should render a template and use given variables (28 ms)
      ✓ should render a template with given variables and locals variables (4 ms)

PASS test/functional/controller-base-routes.spec.ts
    controller > base routes functionality
      ✓ get should respond with proper status code, headers and body content (61 ms)
      ✓ get should respond with proper status code, headers and body content (5 ms)
      ✓ get should respond with proper status code, headers and body content - 2nd pass (3 ms)
      ✓ wrong route should respond with 404 error (4 ms)
      ✓ wrong route should respond with 404 error (3 ms)
      ✓ wrong route should respond with 404 error (2 ms)

PASS test/functional/middlewares-order.spec.ts
    loaded direct from array
      ✓ should call middlewares in order defined by items order (32 ms)
    specified by priority option
      ✓ should call middlewares in order defined by priority parameter of decorator (4 ms)

PASS test/functional/express-global-before-error-handling.spec.ts
    custom express global before middleware error handling
      ✓ should call global error handler middleware with CustomError (38 ms)

PASS test/functional/redirect-decorator.spec.ts
    dynamic redirect
      ✓ using template (30 ms)
      ✓ using override (4 ms)
      ✓ using original (4 ms)

PASS test/functional/special-result-send.spec.ts
    special result value treatment
      ✓ should pipe stream to response (23 ms)
      ✓ should send raw binary data from Buffer (4 ms)
      ✓ should send raw binary data from UIntArray (3 ms)

PASS test/functional/error-subclasses.spec.ts
  HttpError
    ✓ should be instance of HttpError and Error (3 ms)
  BadRequestError
    ✓ should be instance of BadRequestError, HttpError and Error (1 ms)

Summary of all failing tests
FAIL test/ActionParameterHandler.spec.ts
  ● ActionParameterHandler › negative › handle - throws error if the parameter is required

    Expected value   "TypeError: Cannot read property 'uuid' of undefined"
    Received:
      "TypeError: Cannot read properties of undefined (reading 'uuid')"

    Message:
      expected 'TypeError: Cannot read properties of undefined (reading \'uuid\')' to equal 'TypeError: Cannot read property \'uuid\' of undefined'

    Difference:

    - Expected
    + Received

    - TypeError: Cannot read property 'uuid' of undefined
    + TypeError: Cannot read properties of undefined (reading 'uuid')

      152 |       }
      153 | 
    > 154 |       expect(error.toString()).to.be.eq("TypeError: Cannot read property 'uuid' of undefined");
          |                                      ^
      155 |     });
      156 | 
      157 |     it('handle - throws error if the parameter is required, type file provided', async () => {

      at Object.<anonymous> (test/ActionParameterHandler.spec.ts:154:38)


Test Suites: 1 failed, 25 passed, 26 total
Tests:       1 failed, 181 passed, 182 total
Snapshots:   0 total
Time:        13.267 s, estimated 14 s
Ran all test suites.
************* run test done *************
routing-controllers is testing ./Variants/express/variant5/express
************* npm unlink module *************
************* npm unlink module done *************
************* npm unlink globally *************
************* npm unlink globally done *************
************* npm link globally *************
************* npm link globally done *************
************* npm link module *************
************* npm link module done *************
************* start run test *************
ts-jest[config] (WARN) The option `tsConfig` is deprecated and will be removed in ts-jest 27, use `tsconfig` instead
FAIL test/ActionParameterHandler.spec.ts
  ActionParameterHandler
    positive
      ✓ handle - should process string parameters (37 ms)
      ✓ handle - should process string parameters, returns empty if a given string is empty (1 ms)
      ✓ handle - should process number parameters
      ✓ handle - undefined on empty object provided (1 ms)
      ✓ handle - null provided (10 ms)
    negative
      ✕ handle - throws error if the parameter is required (7 ms)
      ✓ handle - throws error if the parameter is required, type file provided (1 ms)

  ● ActionParameterHandler › negative › handle - throws error if the parameter is required

    Expected value   "TypeError: Cannot read property 'uuid' of undefined"
    Received:
      "TypeError: Cannot read properties of undefined (reading 'uuid')"

    Message:
      expected 'TypeError: Cannot read properties of undefined (reading \'uuid\')' to equal 'TypeError: Cannot read property \'uuid\' of undefined'

    Difference:

    - Expected
    + Received

    - TypeError: Cannot read property 'uuid' of undefined
    + TypeError: Cannot read properties of undefined (reading 'uuid')

      152 |       }
      153 | 
    > 154 |       expect(error.toString()).to.be.eq("TypeError: Cannot read property 'uuid' of undefined");
          |                                      ^
      155 |     });
      156 | 
      157 |     it('handle - throws error if the parameter is required, type file provided', async () => {

      at Object.<anonymous> (test/ActionParameterHandler.spec.ts:154:38)

PASS test/functional/controller-methods.spec.ts
    controller methods
      ✓ get should respond with proper status code, headers and body content (20 ms)
      ✓ post respond with proper status code, headers and body content (5 ms)
      ✓ put respond with proper status code, headers and body content (3 ms)
      ✓ patch respond with proper status code, headers and body content (3 ms)
      ✓ delete respond with proper status code, headers and body content (4 ms)
      ✓ head respond with proper status code, headers and body content (2 ms)
      ✓ custom method (post) respond with proper status code, headers and body content (3 ms)
      ✓ custom method (delete) respond with proper status code, headers and body content (2 ms)
      ✓ route should work with parameter (3 ms)
      ✓ route should work with regexp parameter (3 ms)
      ✓ should respond with 404 when regexp does not match (6 ms)
      ✓ route should work with string regexp parameter (3 ms)
      ✓ should respond with 404 when regexp does not match (2 ms)
      ✓ should return result from a promise (503 ms)
      ✓ should respond with 500 if promise failed (505 ms)
      ✓ should respond with 204 No Content when null returned in action (5 ms)
      ✓ should respond with 404 Not Found text when undefined returned in action (37 ms)
      ✓ should respond with 404 Not Found JSON when undefined returned in action (4 ms)
      ✓ should respond with 200 and text/html even in json controller's method (2 ms)
      ✓ should respond with 200 and text/plain even in json controller's method (2 ms)
      ✓ should respond with 401 and text/html when UnauthorizedError throwed even in json controller's method (5 ms)
      ✓ should respond with 401 and aplication/json when UnauthorizedError is thrown in standard json controller's method (2 ms)

PASS test/functional/json-controller-methods.spec.ts
    json-controller methods
      ✓ get should respond with proper status code, headers and body content (11 ms)
      ✓ post respond with proper status code, headers and body content (3 ms)
      ✓ put respond with proper status code, headers and body content (2 ms)
      ✓ patch respond with proper status code, headers and body content (2 ms)
      ✓ delete respond with proper status code, headers and body content (2 ms)
      ✓ head respond with proper status code, headers and body content (2 ms)
      ✓ custom method (post) respond with proper status code, headers and body content (3 ms)
      ✓ custom method (delete) respond with proper status code, headers and body content (2 ms)
      ✓ route should work with parameter (2 ms)
      ✓ route should work with regexp parameter (3 ms)
      ✓ should respond with 404 when regexp does not match (4 ms)
      ✓ route should work with string regexp parameter (3 ms)
      ✓ should respond with 404 when regexp does not match (2 ms)
      ✓ should return result from a promise (504 ms)
      ✓ should respond with 500 if promise failed (504 ms)

PASS test/functional/interceptors.spec.ts
    interceptor
      ✓ custom interceptor function should replace returned content (9 ms)
      ✓ custom interceptor class should replace returned content (3 ms)
      ✓ custom interceptor class used on the whole controller should replace returned content (3 ms)
      ✓ global interceptor class should replace returned content (2 ms)
      ✓ interceptors should support promises (1004 ms)

PASS test/functional/action-params.spec.ts
    ✓ @Req and @Res should be provided as Request and Response objects (11 ms)
    ✓ @Res writing directly to the response should work (4 ms)
    ✓ @Param should give a param from route (3 ms)
    ✓ @Param multiple params should give a proper values from route (3 ms)
    ✓ @SessionParam without middleware (23 ms)
    ✓ @Session should return a value from session (10 ms)
    ✓ @Session(param) should allow to inject empty property (3 ms)
    ✓ @QueryParams should give a proper values from request's query parameters (10 ms)
    ✓ @QueryParams should give a proper values from request's query parameters and one multiple value (6 ms)
    ✓ @QueryParams should give a proper values from request's query with validate whitelist option on (3 ms)
    ✓ @QueryParams should give a proper values from request's query parameters with nested json (5 ms)
    ✓ @QueryParams should not validate request query parameters when it's turned off in validator options (11 ms)
    ✓ @QueryParams should give a proper values from request's optional query parameters (3 ms)
    ✓ @QueryParam should give a proper values from request query parameters (3 ms)
    ✓ @QueryParam should give an array of string with only one query parameter (2 ms)
    ✓ @QueryParam should give an array of string with multiple query parameters (2 ms)
    ✓ @QueryParam should give an array of number with only one query parameter (3 ms)
    ✓ @QueryParam should give an array of number with multiple query parameters (3 ms)
    ✓ @QueryParam should give an array of date with only one query parameter (2 ms)
    ✓ @QueryParam should give an array of date with multiple query parameters (2 ms)
    ✓ @QueryParam when required params must be provided and they should not be empty (8 ms)
    ✓ @QueryParam when the type is Date then it should be parsed (1 ms)
    ✓ @QueryParam when the type is Date and it is invalid then the response should be a BadRequest error (3 ms)
    ✓ @QueryParam when parseJson flag is used query param must be converted to object (2 ms)
    ✓ @HeaderParam should give a proper values from request headers (2 ms)
    ✓ @HeaderParam when required is params must be provided and they should not be empty (2 ms)
    ✓ @HeaderParam should fail with invalid request options (2 ms)
    ✓ @HeaderParam should fail with missing required params (3 ms)
    ✓ for @HeaderParam when parseJson flag is used query param must be converted to object (3 ms)
    ✓ @CookieParam should give a proper values from request headers (3 ms)
    ✓ @CookieParam when required is params must be provided and they should not be empty (4 ms)
    ✓ @CookieParam when parseJson flag is used query param must be converted to object (2 ms)
    ✓ @Body should provide a request body (12 ms)
    ✓ @Body should fail if required body was not provided (7 ms)
    ✓ @Body should provide a json object for json-typed controllers and actions (2 ms)
    ✓ @Body should fail if required body was not provided for json-typed controllers and actions (5 ms)
    ✓ @BodyParam should provide a json object for json-typed controllers and actions (2 ms)
    ✓ @BodyParam should fail if required body was not provided for json-typed controllers and actions (21 ms)
    ✓ @Body using application/x-www-form-urlencoded should handle url encoded form data (4 ms)
    ✓ @UploadedFile using multipart/form-data should provide uploaded file with the given name (12 ms)
    ✓ @UploadedFile with @Body should return both the file and the body (6 ms)
    ✓ @UploadedFile with @BodyParam should return both the file and the body param (4 ms)
    ✓ @UploadedFile with passed uploading options (limit) should throw an error (5 ms)
    ✓ @UploadedFile when required is used files must be provided (7 ms)
    ✓ @UploadedFiles should provide uploaded files with the given name (5 ms)
    ✓ @UploadedFiles with passed uploading options (limit) should throw an error (5 ms)
    ✓ @UploadedFiles when required is used files must be provided (4 ms)

PASS test/functional/container.spec.ts
    using typedi container should be possible
      ✓ typedi container (66 ms)
    using custom container should be possible
      ✓ custom container (6 ms)
    using custom container with fallback should be possible
      ✓ custom container with fallback (8 ms)
    using custom container with fallback and fallback on throw error should be possible
      ✓ custom container with fallback and fallback on throw error (8 ms)

PASS test/functional/auth-decorator.spec.ts
    Controller responds with value when Authorization succeeds (async)
      ✓ without roles (73 ms)
      ✓ with roles (15 ms)
      ✓ async (25 ms)
    Controller responds with value when Authorization succeeds (sync)
      ✓ without roles (5 ms)
      ✓ with roles (3 ms)
      ✓ async (14 ms)
    Authorized Decorators Http Status Code
      ✓ without roles (20 ms)
      ✓ with roles (4 ms)
    Authorization checker allows to throw (async)
      ✓ custom errors (5 ms)
    Authorization checker allows to throw (sync)
      ✓ custom errors (4 ms)

PASS test/functional/load-from-directory.spec.ts
    loading all controllers from the given directories
      ✓ should load all controllers (20 ms)
    loading all express middlewares and error handlers from the given directories
      ✓ should succeed (14 ms)
      ✓ should fail (32 ms)

PASS test/functional/defaults.spec.ts
    defaults
      ✓ should return undefinedResultCode from defaults config for void function (23 ms)
      ✓ should return undefinedResultCode from defaults config for promise void function (3 ms)
      ✓ should return 400 from required paramOptions (16 ms)
      ✓ should return nullResultCode from defaults config (4 ms)
      ✓ should return status code from OnUndefined annotation (2 ms)
      ✓ should mark arg optional from QueryParam annotation (4 ms)

PASS test/functional/global-options.spec.ts
    routing-controllers global options
      useClassTransformer default value
        ✓ useClassTransformer by default must be set to true (93 ms)
      when useClassTransformer is set to true
        ✓ useClassTransformer is enabled (4 ms)
      when useClassTransformer is set to false
        ✓ useClassTransformer is disabled (3 ms)
      when routePrefix is used all controller routes should be appended by it
        ✓ routePrefix is enabled (7 ms)

PASS test/functional/other-controller-decorators.spec.ts
    other controller decorators
      ✓ should return httpCode set by @HttpCode decorator (88 ms)
      ✓ should return custom code when @OnNull (119 ms)
      ✓ should return custom error message and code when @OnUndefined is used with Error class (19 ms)
      ✓ should return custom code when @OnUndefined (13 ms)
      ✓ should return content-type in the response when @ContentType is used (3 ms)
      ✓ should return content-type in the response when @ContentType is used (2 ms)
      ✓ should return response with custom headers when @Header is used (4 ms)
      ✓ should relocate to new location when @Location is used (2 ms)

PASS test/functional/class-transformer-options.spec.ts
    should not use any options if not set
      ✓ technical wrapper (62 ms)
    should apply global options
      ✓ technical wrapper (6 ms)
    should apply local options
      ✓ technical wrapper (5 ms)

PASS test/functional/class-validator-options.spec.ts
    no options
      ✓ should not use any options if not set (73 ms)
    global options
      should merge local validation options with global validation options prioritizing local
        ✓ succeed (6 ms)
      should pass the valid param after validation
        ✓ succeed (5 ms)
        ✓ should contain param name on validation failed (16 ms)
    local options
      ✓ should apply local options (5 ms)

PASS test/functional/controller-options.spec.ts
    controller options
      ✓ controller transform is enabled by default (19 ms)
      ✓ when controller transform is enabled (5 ms)
      ✓ when controller transform is disabled (3 ms)

PASS test/unit/controller-inheritance.spec.ts
  controller inheritance
    ✓ should build empty meta for empty set (11 ms)
    ✓ should build meta if the only derivative controller is given (2 ms)
    ✓ should build meta if the only autonomous controller is given (1 ms)
    ✓ should build meta both when autonomous and derivative controllers are given

PASS test/functional/express-middlewares.spec.ts
    express middlewares
      ✓ should call a global middlewares (9 ms)
      ✓ should use a custom middleware when @UseBefore or @UseAfter is used (2 ms)
      ✓ should call middleware and call it before controller action when @UseBefore is used (3 ms)
      ✓ should call middleware and call it after controller action when @UseAfter is used (3 ms)
      ✓ should call before middleware and call after middleware when @UseAfter and @UseAfter are used (3 ms)
      ✓ should handle errors in custom middlewares (27 ms)

PASS test/functional/express-error-handling.spec.ts
    express error handling
      ✓ should not call global error handler middleware if there was no errors (9 ms)
      ✓ should call global error handler middleware (21 ms)
      ✓ should call global error handler middleware (4 ms)
      ✓ should call error handler middleware if used (3 ms)
      ✓ should not execute next middleware if soft error handled specifically and stopped error bubbling (2 ms)
      ✓ should process JsonErrors by their toJSON method if it exists (2 ms)

PASS test/functional/express-global-before-error-handling.spec.ts
    custom express global before middleware error handling
      ✓ should call global error handler middleware with CustomError (24 ms)

PASS test/functional/middlewares-order.spec.ts
    loaded direct from array
      ✓ should call middlewares in order defined by items order (46 ms)
    specified by priority option
      ✓ should call middlewares in order defined by priority parameter of decorator (6 ms)

PASS test/functional/action-options.spec.ts
    ✓ should use controller options when action transform options are not set (35 ms)
    ✓ should override controller options with action transformRequest option (5 ms)
    ✓ should override controller options with action transformResponse option (3 ms)

PASS test/functional/controller-base-routes.spec.ts
    controller > base routes functionality
      ✓ get should respond with proper status code, headers and body content (62 ms)
      ✓ get should respond with proper status code, headers and body content (4 ms)
      ✓ get should respond with proper status code, headers and body content - 2nd pass (4 ms)
      ✓ wrong route should respond with 404 error (4 ms)
      ✓ wrong route should respond with 404 error (3 ms)
      ✓ wrong route should respond with 404 error (2 ms)

PASS test/functional/render-decorator.spec.ts
    template rendering
      ✓ should render a template and use given variables (28 ms)
      ✓ should render a template with given variables and locals variables (5 ms)

PASS test/functional/express-custom-error-handling.spec.ts
    custom express error handling
      ✓ should not call global error handler middleware if there was no errors (24 ms)
      ✓ should call global error handler middleware (18 ms)

PASS test/functional/redirect-decorator.spec.ts
    dynamic redirect
      ✓ using template (30 ms)
      ✓ using override (5 ms)
      ✓ using original (3 ms)

PASS test/functional/special-result-send.spec.ts
    special result value treatment
      ✓ should pipe stream to response (24 ms)
      ✓ should send raw binary data from Buffer (4 ms)
      ✓ should send raw binary data from UIntArray (3 ms)

PASS test/functional/error-subclasses.spec.ts
  HttpError
    ✓ should be instance of HttpError and Error (4 ms)
  BadRequestError
    ✓ should be instance of BadRequestError, HttpError and Error (1 ms)

Summary of all failing tests
FAIL test/ActionParameterHandler.spec.ts
  ● ActionParameterHandler › negative › handle - throws error if the parameter is required

    Expected value   "TypeError: Cannot read property 'uuid' of undefined"
    Received:
      "TypeError: Cannot read properties of undefined (reading 'uuid')"

    Message:
      expected 'TypeError: Cannot read properties of undefined (reading \'uuid\')' to equal 'TypeError: Cannot read property \'uuid\' of undefined'

    Difference:

    - Expected
    + Received

    - TypeError: Cannot read property 'uuid' of undefined
    + TypeError: Cannot read properties of undefined (reading 'uuid')

      152 |       }
      153 | 
    > 154 |       expect(error.toString()).to.be.eq("TypeError: Cannot read property 'uuid' of undefined");
          |                                      ^
      155 |     });
      156 | 
      157 |     it('handle - throws error if the parameter is required, type file provided', async () => {

      at Object.<anonymous> (test/ActionParameterHandler.spec.ts:154:38)


Test Suites: 1 failed, 25 passed, 26 total
Tests:       1 failed, 181 passed, 182 total
Snapshots:   0 total
Time:        13.356 s, estimated 14 s
Ran all test suites.
************* run test done *************
routing-controllers is testing ./Variants/express/variant4/express
************* npm unlink module *************
************* npm unlink module done *************
************* npm unlink globally *************
************* npm unlink globally done *************
************* npm link globally *************
************* npm link globally done *************
************* npm link module *************
************* npm link module done *************
************* start run test *************
ts-jest[config] (WARN) The option `tsConfig` is deprecated and will be removed in ts-jest 27, use `tsconfig` instead
FAIL test/ActionParameterHandler.spec.ts
  ActionParameterHandler
    positive
      ✓ handle - should process string parameters (29 ms)
      ✓ handle - should process string parameters, returns empty if a given string is empty
      ✓ handle - should process number parameters (1 ms)
      ✓ handle - undefined on empty object provided
      ✓ handle - null provided (14 ms)
    negative
      ✕ handle - throws error if the parameter is required (8 ms)
      ✓ handle - throws error if the parameter is required, type file provided (1 ms)

  ● ActionParameterHandler › negative › handle - throws error if the parameter is required

    Expected value   "TypeError: Cannot read property 'uuid' of undefined"
    Received:
      "TypeError: Cannot read properties of undefined (reading 'uuid')"

    Message:
      expected 'TypeError: Cannot read properties of undefined (reading \'uuid\')' to equal 'TypeError: Cannot read property \'uuid\' of undefined'

    Difference:

    - Expected
    + Received

    - TypeError: Cannot read property 'uuid' of undefined
    + TypeError: Cannot read properties of undefined (reading 'uuid')

      152 |       }
      153 | 
    > 154 |       expect(error.toString()).to.be.eq("TypeError: Cannot read property 'uuid' of undefined");
          |                                      ^
      155 |     });
      156 | 
      157 |     it('handle - throws error if the parameter is required, type file provided', async () => {

      at Object.<anonymous> (test/ActionParameterHandler.spec.ts:154:38)

PASS test/functional/controller-methods.spec.ts
    controller methods
      ✓ get should respond with proper status code, headers and body content (31 ms)
      ✓ post respond with proper status code, headers and body content (30 ms)
      ✓ put respond with proper status code, headers and body content (13 ms)
      ✓ patch respond with proper status code, headers and body content (5 ms)
      ✓ delete respond with proper status code, headers and body content (13 ms)
      ✓ head respond with proper status code, headers and body content (4 ms)
      ✓ custom method (post) respond with proper status code, headers and body content (4 ms)
      ✓ custom method (delete) respond with proper status code, headers and body content (3 ms)
      ✓ route should work with parameter (5 ms)
      ✓ route should work with regexp parameter (11 ms)
      ✓ should respond with 404 when regexp does not match (4 ms)
      ✓ route should work with string regexp parameter (3 ms)
      ✓ should respond with 404 when regexp does not match (2 ms)
      ✓ should return result from a promise (504 ms)
      ✓ should respond with 500 if promise failed (505 ms)
      ✓ should respond with 204 No Content when null returned in action (6 ms)
      ✓ should respond with 404 Not Found text when undefined returned in action (21 ms)
      ✓ should respond with 404 Not Found JSON when undefined returned in action (3 ms)
      ✓ should respond with 200 and text/html even in json controller's method (11 ms)
      ✓ should respond with 200 and text/plain even in json controller's method (2 ms)
      ✓ should respond with 401 and text/html when UnauthorizedError throwed even in json controller's method (4 ms)
      ✓ should respond with 401 and aplication/json when UnauthorizedError is thrown in standard json controller's method (3 ms)

PASS test/functional/json-controller-methods.spec.ts
    json-controller methods
      ✓ get should respond with proper status code, headers and body content (10 ms)
      ✓ post respond with proper status code, headers and body content (3 ms)
      ✓ put respond with proper status code, headers and body content (2 ms)
      ✓ patch respond with proper status code, headers and body content (3 ms)
      ✓ delete respond with proper status code, headers and body content (3 ms)
      ✓ head respond with proper status code, headers and body content (2 ms)
      ✓ custom method (post) respond with proper status code, headers and body content (2 ms)
      ✓ custom method (delete) respond with proper status code, headers and body content (3 ms)
      ✓ route should work with parameter (3 ms)
      ✓ route should work with regexp parameter (3 ms)
      ✓ should respond with 404 when regexp does not match (3 ms)
      ✓ route should work with string regexp parameter (4 ms)
      ✓ should respond with 404 when regexp does not match (1 ms)
      ✓ should return result from a promise (504 ms)
      ✓ should respond with 500 if promise failed (505 ms)

PASS test/functional/interceptors.spec.ts
    interceptor
      ✓ custom interceptor function should replace returned content (24 ms)
      ✓ custom interceptor class should replace returned content (4 ms)
      ✓ custom interceptor class used on the whole controller should replace returned content (2 ms)
      ✓ global interceptor class should replace returned content (3 ms)
      ✓ interceptors should support promises (1004 ms)

PASS test/functional/action-params.spec.ts
    ✓ @Req and @Res should be provided as Request and Response objects (11 ms)
    ✓ @Res writing directly to the response should work (4 ms)
    ✓ @Param should give a param from route (3 ms)
    ✓ @Param multiple params should give a proper values from route (3 ms)
    ✓ @SessionParam without middleware (23 ms)
    ✓ @Session should return a value from session (11 ms)
    ✓ @Session(param) should allow to inject empty property (3 ms)
    ✓ @QueryParams should give a proper values from request's query parameters (9 ms)
    ✓ @QueryParams should give a proper values from request's query parameters and one multiple value (7 ms)
    ✓ @QueryParams should give a proper values from request's query with validate whitelist option on (3 ms)
    ✓ @QueryParams should give a proper values from request's query parameters with nested json (5 ms)
    ✓ @QueryParams should not validate request query parameters when it's turned off in validator options (2 ms)
    ✓ @QueryParams should give a proper values from request's optional query parameters (3 ms)
    ✓ @QueryParam should give a proper values from request query parameters (11 ms)
    ✓ @QueryParam should give an array of string with only one query parameter (2 ms)
    ✓ @QueryParam should give an array of string with multiple query parameters (2 ms)
    ✓ @QueryParam should give an array of number with only one query parameter (3 ms)
    ✓ @QueryParam should give an array of number with multiple query parameters (3 ms)
    ✓ @QueryParam should give an array of date with only one query parameter (3 ms)
    ✓ @QueryParam should give an array of date with multiple query parameters (1 ms)
    ✓ @QueryParam when required params must be provided and they should not be empty (7 ms)
    ✓ @QueryParam when the type is Date then it should be parsed (2 ms)
    ✓ @QueryParam when the type is Date and it is invalid then the response should be a BadRequest error (2 ms)
    ✓ @QueryParam when parseJson flag is used query param must be converted to object (2 ms)
    ✓ @HeaderParam should give a proper values from request headers (2 ms)
    ✓ @HeaderParam when required is params must be provided and they should not be empty (2 ms)
    ✓ @HeaderParam should fail with invalid request options (2 ms)
    ✓ @HeaderParam should fail with missing required params (5 ms)
    ✓ for @HeaderParam when parseJson flag is used query param must be converted to object (3 ms)
    ✓ @CookieParam should give a proper values from request headers (3 ms)
    ✓ @CookieParam when required is params must be provided and they should not be empty (3 ms)
    ✓ @CookieParam when parseJson flag is used query param must be converted to object (2 ms)
    ✓ @Body should provide a request body (12 ms)
    ✓ @Body should fail if required body was not provided (7 ms)
    ✓ @Body should provide a json object for json-typed controllers and actions (3 ms)
    ✓ @Body should fail if required body was not provided for json-typed controllers and actions (4 ms)
    ✓ @BodyParam should provide a json object for json-typed controllers and actions (2 ms)
    ✓ @BodyParam should fail if required body was not provided for json-typed controllers and actions (22 ms)
    ✓ @Body using application/x-www-form-urlencoded should handle url encoded form data (4 ms)
    ✓ @UploadedFile using multipart/form-data should provide uploaded file with the given name (12 ms)
    ✓ @UploadedFile with @Body should return both the file and the body (6 ms)
    ✓ @UploadedFile with @BodyParam should return both the file and the body param (5 ms)
    ✓ @UploadedFile with passed uploading options (limit) should throw an error (5 ms)
    ✓ @UploadedFile when required is used files must be provided (6 ms)
    ✓ @UploadedFiles should provide uploaded files with the given name (5 ms)
    ✓ @UploadedFiles with passed uploading options (limit) should throw an error (5 ms)
    ✓ @UploadedFiles when required is used files must be provided (5 ms)

PASS test/functional/other-controller-decorators.spec.ts
    other controller decorators
      ✓ should return httpCode set by @HttpCode decorator (29 ms)
      ✓ should return custom code when @OnNull (31 ms)
      ✓ should return custom error message and code when @OnUndefined is used with Error class (8 ms)
      ✓ should return custom code when @OnUndefined (10 ms)
      ✓ should return content-type in the response when @ContentType is used (3 ms)
      ✓ should return content-type in the response when @ContentType is used (3 ms)
      ✓ should return response with custom headers when @Header is used (7 ms)
      ✓ should relocate to new location when @Location is used (3 ms)

PASS test/functional/load-from-directory.spec.ts
    loading all controllers from the given directories
      ✓ should load all controllers (19 ms)
    loading all express middlewares and error handlers from the given directories
      ✓ should succeed (14 ms)
      ✓ should fail (31 ms)

PASS test/functional/auth-decorator.spec.ts
    Controller responds with value when Authorization succeeds (async)
      ✓ without roles (88 ms)
      ✓ with roles (19 ms)
      ✓ async (25 ms)
    Controller responds with value when Authorization succeeds (sync)
      ✓ without roles (4 ms)
      ✓ with roles (3 ms)
      ✓ async (14 ms)
    Authorized Decorators Http Status Code
      ✓ without roles (20 ms)
      ✓ with roles (4 ms)
    Authorization checker allows to throw (async)
      ✓ custom errors (4 ms)
    Authorization checker allows to throw (sync)
      ✓ custom errors (4 ms)

PASS test/functional/action-options.spec.ts
    ✓ should use controller options when action transform options are not set (67 ms)
    ✓ should override controller options with action transformRequest option (5 ms)
    ✓ should override controller options with action transformResponse option (3 ms)

PASS test/functional/class-validator-options.spec.ts
    no options
      ✓ should not use any options if not set (136 ms)
    global options
      should merge local validation options with global validation options prioritizing local
        ✓ succeed (7 ms)
      should pass the valid param after validation
        ✓ succeed (5 ms)
        ✓ should contain param name on validation failed (16 ms)
    local options
      ✓ should apply local options (6 ms)

PASS test/functional/class-transformer-options.spec.ts
    should not use any options if not set
      ✓ technical wrapper (23 ms)
    should apply global options
      ✓ technical wrapper (10 ms)
    should apply local options
      ✓ technical wrapper (10 ms)

PASS test/functional/middlewares-order.spec.ts
    loaded direct from array
      ✓ should call middlewares in order defined by items order (23 ms)
    specified by priority option
      ✓ should call middlewares in order defined by priority parameter of decorator (2 ms)

PASS test/functional/global-options.spec.ts
    routing-controllers global options
      useClassTransformer default value
        ✓ useClassTransformer by default must be set to true (82 ms)
      when useClassTransformer is set to true
        ✓ useClassTransformer is enabled (6 ms)
      when useClassTransformer is set to false
        ✓ useClassTransformer is disabled (8 ms)
      when routePrefix is used all controller routes should be appended by it
        ✓ routePrefix is enabled (7 ms)

PASS test/functional/container.spec.ts
    using typedi container should be possible
      ✓ typedi container (67 ms)
    using custom container should be possible
      ✓ custom container (6 ms)
    using custom container with fallback should be possible
      ✓ custom container with fallback (8 ms)
    using custom container with fallback and fallback on throw error should be possible
      ✓ custom container with fallback and fallback on throw error (8 ms)

PASS test/functional/express-middlewares.spec.ts
    express middlewares
      ✓ should call a global middlewares (9 ms)
      ✓ should use a custom middleware when @UseBefore or @UseAfter is used (3 ms)
      ✓ should call middleware and call it before controller action when @UseBefore is used (2 ms)
      ✓ should call middleware and call it after controller action when @UseAfter is used (2 ms)
      ✓ should call before middleware and call after middleware when @UseAfter and @UseAfter are used (3 ms)
      ✓ should handle errors in custom middlewares (23 ms)

PASS test/functional/express-error-handling.spec.ts
    express error handling
      ✓ should not call global error handler middleware if there was no errors (10 ms)
      ✓ should call global error handler middleware (17 ms)
      ✓ should call global error handler middleware (4 ms)
      ✓ should call error handler middleware if used (3 ms)
      ✓ should not execute next middleware if soft error handled specifically and stopped error bubbling (3 ms)
      ✓ should process JsonErrors by their toJSON method if it exists (4 ms)

PASS test/functional/defaults.spec.ts
    defaults
      ✓ should return undefinedResultCode from defaults config for void function (8 ms)
      ✓ should return undefinedResultCode from defaults config for promise void function (3 ms)
      ✓ should return 400 from required paramOptions (16 ms)
      ✓ should return nullResultCode from defaults config (4 ms)
      ✓ should return status code from OnUndefined annotation (3 ms)
      ✓ should mark arg optional from QueryParam annotation (4 ms)

PASS test/functional/controller-options.spec.ts
    controller options
      ✓ controller transform is enabled by default (37 ms)
      ✓ when controller transform is enabled (6 ms)
      ✓ when controller transform is disabled (4 ms)

PASS test/unit/controller-inheritance.spec.ts
  controller inheritance
    ✓ should build empty meta for empty set (11 ms)
    ✓ should build meta if the only derivative controller is given (2 ms)
    ✓ should build meta if the only autonomous controller is given
    ✓ should build meta both when autonomous and derivative controllers are given (1 ms)

PASS test/functional/express-custom-error-handling.spec.ts
    custom express error handling
      ✓ should not call global error handler middleware if there was no errors (9 ms)
      ✓ should call global error handler middleware (18 ms)

PASS test/functional/express-global-before-error-handling.spec.ts
    custom express global before middleware error handling
      ✓ should call global error handler middleware with CustomError (41 ms)

PASS test/functional/render-decorator.spec.ts
    template rendering
      ✓ should render a template and use given variables (30 ms)
      ✓ should render a template with given variables and locals variables (4 ms)

PASS test/functional/controller-base-routes.spec.ts
    controller > base routes functionality
      ✓ get should respond with proper status code, headers and body content (65 ms)
      ✓ get should respond with proper status code, headers and body content (4 ms)
      ✓ get should respond with proper status code, headers and body content - 2nd pass (4 ms)
      ✓ wrong route should respond with 404 error (4 ms)
      ✓ wrong route should respond with 404 error (3 ms)
      ✓ wrong route should respond with 404 error (2 ms)

PASS test/functional/redirect-decorator.spec.ts
    dynamic redirect
      ✓ using template (28 ms)
      ✓ using override (4 ms)
      ✓ using original (7 ms)

PASS test/functional/special-result-send.spec.ts
    special result value treatment
      ✓ should pipe stream to response (23 ms)
      ✓ should send raw binary data from Buffer (4 ms)
      ✓ should send raw binary data from UIntArray (3 ms)

PASS test/functional/error-subclasses.spec.ts
  HttpError
    ✓ should be instance of HttpError and Error (3 ms)
  BadRequestError
    ✓ should be instance of BadRequestError, HttpError and Error (1 ms)

Summary of all failing tests
FAIL test/ActionParameterHandler.spec.ts
  ● ActionParameterHandler › negative › handle - throws error if the parameter is required

    Expected value   "TypeError: Cannot read property 'uuid' of undefined"
    Received:
      "TypeError: Cannot read properties of undefined (reading 'uuid')"

    Message:
      expected 'TypeError: Cannot read properties of undefined (reading \'uuid\')' to equal 'TypeError: Cannot read property \'uuid\' of undefined'

    Difference:

    - Expected
    + Received

    - TypeError: Cannot read property 'uuid' of undefined
    + TypeError: Cannot read properties of undefined (reading 'uuid')

      152 |       }
      153 | 
    > 154 |       expect(error.toString()).to.be.eq("TypeError: Cannot read property 'uuid' of undefined");
          |                                      ^
      155 |     });
      156 | 
      157 |     it('handle - throws error if the parameter is required, type file provided', async () => {

      at Object.<anonymous> (test/ActionParameterHandler.spec.ts:154:38)


Test Suites: 1 failed, 25 passed, 26 total
Tests:       1 failed, 181 passed, 182 total
Snapshots:   0 total
Time:        13.381 s, estimated 14 s
Ran all test suites.
************* run test done *************
routing-controllers is testing ./Variants/express/variant3/express
************* npm unlink module *************
************* npm unlink module done *************
************* npm unlink globally *************
************* npm unlink globally done *************
************* npm link globally *************
************* npm link globally done *************
************* npm link module *************
************* npm link module done *************
************* start run test *************
ts-jest[config] (WARN) The option `tsConfig` is deprecated and will be removed in ts-jest 27, use `tsconfig` instead
FAIL test/ActionParameterHandler.spec.ts
  ActionParameterHandler
    positive
      ✓ handle - should process string parameters (28 ms)
      ✓ handle - should process string parameters, returns empty if a given string is empty (6 ms)
      ✓ handle - should process number parameters
      ✓ handle - undefined on empty object provided (1 ms)
      ✓ handle - null provided (10 ms)
    negative
      ✕ handle - throws error if the parameter is required (7 ms)
      ✓ handle - throws error if the parameter is required, type file provided (1 ms)

  ● ActionParameterHandler › negative › handle - throws error if the parameter is required

    Expected value   "TypeError: Cannot read property 'uuid' of undefined"
    Received:
      "TypeError: Cannot read properties of undefined (reading 'uuid')"

    Message:
      expected 'TypeError: Cannot read properties of undefined (reading \'uuid\')' to equal 'TypeError: Cannot read property \'uuid\' of undefined'

    Difference:

    - Expected
    + Received

    - TypeError: Cannot read property 'uuid' of undefined
    + TypeError: Cannot read properties of undefined (reading 'uuid')

      152 |       }
      153 | 
    > 154 |       expect(error.toString()).to.be.eq("TypeError: Cannot read property 'uuid' of undefined");
          |                                      ^
      155 |     });
      156 | 
      157 |     it('handle - throws error if the parameter is required, type file provided', async () => {

      at Object.<anonymous> (test/ActionParameterHandler.spec.ts:154:38)

PASS test/functional/controller-methods.spec.ts
    controller methods
      ✓ get should respond with proper status code, headers and body content (20 ms)
      ✓ post respond with proper status code, headers and body content (5 ms)
      ✓ put respond with proper status code, headers and body content (4 ms)
      ✓ patch respond with proper status code, headers and body content (3 ms)
      ✓ delete respond with proper status code, headers and body content (3 ms)
      ✓ head respond with proper status code, headers and body content (3 ms)
      ✓ custom method (post) respond with proper status code, headers and body content (2 ms)
      ✓ custom method (delete) respond with proper status code, headers and body content (3 ms)
      ✓ route should work with parameter (3 ms)
      ✓ route should work with regexp parameter (3 ms)
      ✓ should respond with 404 when regexp does not match (5 ms)
      ✓ route should work with string regexp parameter (3 ms)
      ✓ should respond with 404 when regexp does not match (2 ms)
      ✓ should return result from a promise (503 ms)
      ✓ should respond with 500 if promise failed (504 ms)
      ✓ should respond with 204 No Content when null returned in action (17 ms)
      ✓ should respond with 404 Not Found text when undefined returned in action (22 ms)
      ✓ should respond with 404 Not Found JSON when undefined returned in action (3 ms)
      ✓ should respond with 200 and text/html even in json controller's method (4 ms)
      ✓ should respond with 200 and text/plain even in json controller's method (3 ms)
      ✓ should respond with 401 and text/html when UnauthorizedError throwed even in json controller's method (7 ms)
      ✓ should respond with 401 and aplication/json when UnauthorizedError is thrown in standard json controller's method (3 ms)

PASS test/functional/json-controller-methods.spec.ts
    json-controller methods
      ✓ get should respond with proper status code, headers and body content (11 ms)
      ✓ post respond with proper status code, headers and body content (3 ms)
      ✓ put respond with proper status code, headers and body content (2 ms)
      ✓ patch respond with proper status code, headers and body content (3 ms)
      ✓ delete respond with proper status code, headers and body content (2 ms)
      ✓ head respond with proper status code, headers and body content (3 ms)
      ✓ custom method (post) respond with proper status code, headers and body content (2 ms)
      ✓ custom method (delete) respond with proper status code, headers and body content (2 ms)
      ✓ route should work with parameter (3 ms)
      ✓ route should work with regexp parameter (3 ms)
      ✓ should respond with 404 when regexp does not match (3 ms)
      ✓ route should work with string regexp parameter (4 ms)
      ✓ should respond with 404 when regexp does not match (2 ms)
      ✓ should return result from a promise (504 ms)
      ✓ should respond with 500 if promise failed (505 ms)

PASS test/functional/interceptors.spec.ts
    interceptor
      ✓ custom interceptor function should replace returned content (9 ms)
      ✓ custom interceptor class should replace returned content (3 ms)
      ✓ custom interceptor class used on the whole controller should replace returned content (2 ms)
      ✓ global interceptor class should replace returned content (2 ms)
      ✓ interceptors should support promises (1004 ms)

PASS test/functional/action-params.spec.ts
    ✓ @Req and @Res should be provided as Request and Response objects (13 ms)
    ✓ @Res writing directly to the response should work (4 ms)
    ✓ @Param should give a param from route (3 ms)
    ✓ @Param multiple params should give a proper values from route (3 ms)
    ✓ @SessionParam without middleware (23 ms)
    ✓ @Session should return a value from session (10 ms)
    ✓ @Session(param) should allow to inject empty property (3 ms)
    ✓ @QueryParams should give a proper values from request's query parameters (9 ms)
    ✓ @QueryParams should give a proper values from request's query parameters and one multiple value (6 ms)
    ✓ @QueryParams should give a proper values from request's query with validate whitelist option on (13 ms)
    ✓ @QueryParams should give a proper values from request's query parameters with nested json (4 ms)
    ✓ @QueryParams should not validate request query parameters when it's turned off in validator options (3 ms)
    ✓ @QueryParams should give a proper values from request's optional query parameters (3 ms)
    ✓ @QueryParam should give a proper values from request query parameters (2 ms)
    ✓ @QueryParam should give an array of string with only one query parameter (2 ms)
    ✓ @QueryParam should give an array of string with multiple query parameters (2 ms)
    ✓ @QueryParam should give an array of number with only one query parameter (3 ms)
    ✓ @QueryParam should give an array of number with multiple query parameters (3 ms)
    ✓ @QueryParam should give an array of date with only one query parameter (3 ms)
    ✓ @QueryParam should give an array of date with multiple query parameters (2 ms)
    ✓ @QueryParam when required params must be provided and they should not be empty (8 ms)
    ✓ @QueryParam when the type is Date then it should be parsed (2 ms)
    ✓ @QueryParam when the type is Date and it is invalid then the response should be a BadRequest error (3 ms)
    ✓ @QueryParam when parseJson flag is used query param must be converted to object (2 ms)
    ✓ @HeaderParam should give a proper values from request headers (2 ms)
    ✓ @HeaderParam when required is params must be provided and they should not be empty (2 ms)
    ✓ @HeaderParam should fail with invalid request options (2 ms)
    ✓ @HeaderParam should fail with missing required params (3 ms)
    ✓ for @HeaderParam when parseJson flag is used query param must be converted to object (2 ms)
    ✓ @CookieParam should give a proper values from request headers (4 ms)
    ✓ @CookieParam when required is params must be provided and they should not be empty (4 ms)
    ✓ @CookieParam when parseJson flag is used query param must be converted to object (2 ms)
    ✓ @Body should provide a request body (12 ms)
    ✓ @Body should fail if required body was not provided (11 ms)
    ✓ @Body should provide a json object for json-typed controllers and actions (3 ms)
    ✓ @Body should fail if required body was not provided for json-typed controllers and actions (5 ms)
    ✓ @BodyParam should provide a json object for json-typed controllers and actions (2 ms)
    ✓ @BodyParam should fail if required body was not provided for json-typed controllers and actions (18 ms)
    ✓ @Body using application/x-www-form-urlencoded should handle url encoded form data (4 ms)
    ✓ @UploadedFile using multipart/form-data should provide uploaded file with the given name (12 ms)
    ✓ @UploadedFile with @Body should return both the file and the body (6 ms)
    ✓ @UploadedFile with @BodyParam should return both the file and the body param (5 ms)
    ✓ @UploadedFile with passed uploading options (limit) should throw an error (5 ms)
    ✓ @UploadedFile when required is used files must be provided (6 ms)
    ✓ @UploadedFiles should provide uploaded files with the given name (5 ms)
    ✓ @UploadedFiles with passed uploading options (limit) should throw an error (6 ms)
    ✓ @UploadedFiles when required is used files must be provided (4 ms)

PASS test/functional/middlewares-order.spec.ts
    loaded direct from array
      ✓ should call middlewares in order defined by items order (23 ms)
    specified by priority option
      ✓ should call middlewares in order defined by priority parameter of decorator (3 ms)

PASS test/functional/class-validator-options.spec.ts
    no options
      ✓ should not use any options if not set (65 ms)
    global options
      should merge local validation options with global validation options prioritizing local
        ✓ succeed (6 ms)
      should pass the valid param after validation
        ✓ succeed (4 ms)
        ✓ should contain param name on validation failed (18 ms)
    local options
      ✓ should apply local options (6 ms)

PASS test/functional/auth-decorator.spec.ts
    Controller responds with value when Authorization succeeds (async)
      ✓ without roles (83 ms)
      ✓ with roles (15 ms)
      ✓ async (24 ms)
    Controller responds with value when Authorization succeeds (sync)
      ✓ without roles (4 ms)
      ✓ with roles (4 ms)
      ✓ async (14 ms)
    Authorized Decorators Http Status Code
      ✓ without roles (22 ms)
      ✓ with roles (4 ms)
    Authorization checker allows to throw (async)
      ✓ custom errors (5 ms)
    Authorization checker allows to throw (sync)
      ✓ custom errors (3 ms)

PASS test/functional/controller-base-routes.spec.ts
    controller > base routes functionality
      ✓ get should respond with proper status code, headers and body content (64 ms)
      ✓ get should respond with proper status code, headers and body content (4 ms)
      ✓ get should respond with proper status code, headers and body content - 2nd pass (3 ms)
      ✓ wrong route should respond with 404 error (4 ms)
      ✓ wrong route should respond with 404 error (3 ms)
      ✓ wrong route should respond with 404 error (3 ms)

PASS test/functional/load-from-directory.spec.ts
    loading all controllers from the given directories
      ✓ should load all controllers (19 ms)
    loading all express middlewares and error handlers from the given directories
      ✓ should succeed (14 ms)
      ✓ should fail (18 ms)

PASS test/functional/other-controller-decorators.spec.ts
    other controller decorators
      ✓ should return httpCode set by @HttpCode decorator (11 ms)
      ✓ should return custom code when @OnNull (49 ms)
      ✓ should return custom error message and code when @OnUndefined is used with Error class (16 ms)
      ✓ should return custom code when @OnUndefined (35 ms)
      ✓ should return content-type in the response when @ContentType is used (5 ms)
      ✓ should return content-type in the response when @ContentType is used (12 ms)
      ✓ should return response with custom headers when @Header is used (9 ms)
      ✓ should relocate to new location when @Location is used (13 ms)

PASS test/functional/express-error-handling.spec.ts
    express error handling
      ✓ should not call global error handler middleware if there was no errors (10 ms)
      ✓ should call global error handler middleware (23 ms)
      ✓ should call global error handler middleware (7 ms)
      ✓ should call error handler middleware if used (4 ms)
      ✓ should not execute next middleware if soft error handled specifically and stopped error bubbling (17 ms)
      ✓ should process JsonErrors by their toJSON method if it exists (4 ms)

PASS test/functional/action-options.spec.ts
    ✓ should use controller options when action transform options are not set (126 ms)
    ✓ should override controller options with action transformRequest option (14 ms)
    ✓ should override controller options with action transformResponse option (5 ms)

PASS test/functional/global-options.spec.ts
    routing-controllers global options
      useClassTransformer default value
        ✓ useClassTransformer by default must be set to true (84 ms)
      when useClassTransformer is set to true
        ✓ useClassTransformer is enabled (4 ms)
      when useClassTransformer is set to false
        ✓ useClassTransformer is disabled (4 ms)
      when routePrefix is used all controller routes should be appended by it
        ✓ routePrefix is enabled (6 ms)

PASS test/functional/container.spec.ts
    using typedi container should be possible
      ✓ typedi container (68 ms)
    using custom container should be possible
      ✓ custom container (6 ms)
    using custom container with fallback should be possible
      ✓ custom container with fallback (8 ms)
    using custom container with fallback and fallback on throw error should be possible
      ✓ custom container with fallback and fallback on throw error (8 ms)

PASS test/functional/class-transformer-options.spec.ts
    should not use any options if not set
      ✓ technical wrapper (33 ms)
    should apply global options
      ✓ technical wrapper (5 ms)
    should apply local options
      ✓ technical wrapper (5 ms)

PASS test/functional/express-middlewares.spec.ts
    express middlewares
      ✓ should call a global middlewares (26 ms)
      ✓ should use a custom middleware when @UseBefore or @UseAfter is used (2 ms)
      ✓ should call middleware and call it before controller action when @UseBefore is used (3 ms)
      ✓ should call middleware and call it after controller action when @UseAfter is used (2 ms)
      ✓ should call before middleware and call after middleware when @UseAfter and @UseAfter are used (3 ms)
      ✓ should handle errors in custom middlewares (22 ms)

PASS test/functional/defaults.spec.ts
    defaults
      ✓ should return undefinedResultCode from defaults config for void function (22 ms)
      ✓ should return undefinedResultCode from defaults config for promise void function (3 ms)
      ✓ should return 400 from required paramOptions (16 ms)
      ✓ should return nullResultCode from defaults config (4 ms)
      ✓ should return status code from OnUndefined annotation (3 ms)
      ✓ should mark arg optional from QueryParam annotation (4 ms)

PASS test/functional/controller-options.spec.ts
    controller options
      ✓ controller transform is enabled by default (38 ms)
      ✓ when controller transform is enabled (6 ms)
      ✓ when controller transform is disabled (4 ms)

PASS test/functional/render-decorator.spec.ts
    template rendering
      ✓ should render a template and use given variables (31 ms)
      ✓ should render a template with given variables and locals variables (4 ms)

PASS test/unit/controller-inheritance.spec.ts
  controller inheritance
    ✓ should build empty meta for empty set (11 ms)
    ✓ should build meta if the only derivative controller is given (1 ms)
    ✓ should build meta if the only autonomous controller is given
    ✓ should build meta both when autonomous and derivative controllers are given (1 ms)

PASS test/functional/express-custom-error-handling.spec.ts
    custom express error handling
      ✓ should not call global error handler middleware if there was no errors (38 ms)
      ✓ should call global error handler middleware (19 ms)

PASS test/functional/express-global-before-error-handling.spec.ts
    custom express global before middleware error handling
      ✓ should call global error handler middleware with CustomError (38 ms)

PASS test/functional/redirect-decorator.spec.ts
    dynamic redirect
      ✓ using template (36 ms)
      ✓ using override (4 ms)
      ✓ using original (4 ms)

PASS test/functional/special-result-send.spec.ts
    special result value treatment
      ✓ should pipe stream to response (24 ms)
      ✓ should send raw binary data from Buffer (3 ms)
      ✓ should send raw binary data from UIntArray (3 ms)

PASS test/functional/error-subclasses.spec.ts
  HttpError
    ✓ should be instance of HttpError and Error (4 ms)
  BadRequestError
    ✓ should be instance of BadRequestError, HttpError and Error (1 ms)

Summary of all failing tests
FAIL test/ActionParameterHandler.spec.ts
  ● ActionParameterHandler › negative › handle - throws error if the parameter is required

    Expected value   "TypeError: Cannot read property 'uuid' of undefined"
    Received:
      "TypeError: Cannot read properties of undefined (reading 'uuid')"

    Message:
      expected 'TypeError: Cannot read properties of undefined (reading \'uuid\')' to equal 'TypeError: Cannot read property \'uuid\' of undefined'

    Difference:

    - Expected
    + Received

    - TypeError: Cannot read property 'uuid' of undefined
    + TypeError: Cannot read properties of undefined (reading 'uuid')

      152 |       }
      153 | 
    > 154 |       expect(error.toString()).to.be.eq("TypeError: Cannot read property 'uuid' of undefined");
          |                                      ^
      155 |     });
      156 | 
      157 |     it('handle - throws error if the parameter is required, type file provided', async () => {

      at Object.<anonymous> (test/ActionParameterHandler.spec.ts:154:38)


Test Suites: 1 failed, 25 passed, 26 total
Tests:       1 failed, 181 passed, 182 total
Snapshots:   0 total
Time:        13.385 s, estimated 14 s
Ran all test suites.
************* run test done *************
routing-controllers is testing ./Variants/express/variant2/express
************* npm unlink module *************
************* npm unlink module done *************
************* npm unlink globally *************
************* npm unlink globally done *************
************* npm link globally *************
************* npm link globally done *************
************* npm link module *************
************* npm link module done *************
************* start run test *************
ts-jest[config] (WARN) The option `tsConfig` is deprecated and will be removed in ts-jest 27, use `tsconfig` instead
FAIL test/ActionParameterHandler.spec.ts
  ActionParameterHandler
    positive
      ✓ handle - should process string parameters (33 ms)
      ✓ handle - should process string parameters, returns empty if a given string is empty (1 ms)
      ✓ handle - should process number parameters
      ✓ handle - undefined on empty object provided (1 ms)
      ✓ handle - null provided (13 ms)
    negative
      ✕ handle - throws error if the parameter is required (7 ms)
      ✓ handle - throws error if the parameter is required, type file provided (1 ms)

  ● ActionParameterHandler › negative › handle - throws error if the parameter is required

    Expected value   "TypeError: Cannot read property 'uuid' of undefined"
    Received:
      "TypeError: Cannot read properties of undefined (reading 'uuid')"

    Message:
      expected 'TypeError: Cannot read properties of undefined (reading \'uuid\')' to equal 'TypeError: Cannot read property \'uuid\' of undefined'

    Difference:

    - Expected
    + Received

    - TypeError: Cannot read property 'uuid' of undefined
    + TypeError: Cannot read properties of undefined (reading 'uuid')

      152 |       }
      153 | 
    > 154 |       expect(error.toString()).to.be.eq("TypeError: Cannot read property 'uuid' of undefined");
          |                                      ^
      155 |     });
      156 | 
      157 |     it('handle - throws error if the parameter is required, type file provided', async () => {

      at Object.<anonymous> (test/ActionParameterHandler.spec.ts:154:38)

PASS test/functional/controller-methods.spec.ts
    controller methods
      ✓ get should respond with proper status code, headers and body content (20 ms)
      ✓ post respond with proper status code, headers and body content (5 ms)
      ✓ put respond with proper status code, headers and body content (4 ms)
      ✓ patch respond with proper status code, headers and body content (3 ms)
      ✓ delete respond with proper status code, headers and body content (3 ms)
      ✓ head respond with proper status code, headers and body content (5 ms)
      ✓ custom method (post) respond with proper status code, headers and body content (3 ms)
      ✓ custom method (delete) respond with proper status code, headers and body content (3 ms)
      ✓ route should work with parameter (3 ms)
      ✓ route should work with regexp parameter (3 ms)
      ✓ should respond with 404 when regexp does not match (5 ms)
      ✓ route should work with string regexp parameter (3 ms)
      ✓ should respond with 404 when regexp does not match (2 ms)
      ✓ should return result from a promise (516 ms)
      ✓ should respond with 500 if promise failed (505 ms)
      ✓ should respond with 204 No Content when null returned in action (5 ms)
      ✓ should respond with 404 Not Found text when undefined returned in action (21 ms)
      ✓ should respond with 404 Not Found JSON when undefined returned in action (3 ms)
      ✓ should respond with 200 and text/html even in json controller's method (2 ms)
      ✓ should respond with 200 and text/plain even in json controller's method (2 ms)
      ✓ should respond with 401 and text/html when UnauthorizedError throwed even in json controller's method (5 ms)
      ✓ should respond with 401 and aplication/json when UnauthorizedError is thrown in standard json controller's method (2 ms)

PASS test/functional/json-controller-methods.spec.ts
    json-controller methods
      ✓ get should respond with proper status code, headers and body content (10 ms)
      ✓ post respond with proper status code, headers and body content (3 ms)
      ✓ put respond with proper status code, headers and body content (2 ms)
      ✓ patch respond with proper status code, headers and body content (3 ms)
      ✓ delete respond with proper status code, headers and body content (2 ms)
      ✓ head respond with proper status code, headers and body content (3 ms)
      ✓ custom method (post) respond with proper status code, headers and body content (2 ms)
      ✓ custom method (delete) respond with proper status code, headers and body content (2 ms)
      ✓ route should work with parameter (3 ms)
      ✓ route should work with regexp parameter (3 ms)
      ✓ should respond with 404 when regexp does not match (4 ms)
      ✓ route should work with string regexp parameter (3 ms)
      ✓ should respond with 404 when regexp does not match (2 ms)
      ✓ should return result from a promise (503 ms)
      ✓ should respond with 500 if promise failed (503 ms)

PASS test/functional/interceptors.spec.ts
    interceptor
      ✓ custom interceptor function should replace returned content (10 ms)
      ✓ custom interceptor class should replace returned content (3 ms)
      ✓ custom interceptor class used on the whole controller should replace returned content (2 ms)
      ✓ global interceptor class should replace returned content (3 ms)
      ✓ interceptors should support promises (1004 ms)

PASS test/functional/action-params.spec.ts
    ✓ @Req and @Res should be provided as Request and Response objects (10 ms)
    ✓ @Res writing directly to the response should work (4 ms)
    ✓ @Param should give a param from route (3 ms)
    ✓ @Param multiple params should give a proper values from route (3 ms)
    ✓ @SessionParam without middleware (23 ms)
    ✓ @Session should return a value from session (13 ms)
    ✓ @Session(param) should allow to inject empty property (4 ms)
    ✓ @QueryParams should give a proper values from request's query parameters (13 ms)
    ✓ @QueryParams should give a proper values from request's query parameters and one multiple value (25 ms)
    ✓ @QueryParams should give a proper values from request's query with validate whitelist option on (6 ms)
    ✓ @QueryParams should give a proper values from request's query parameters with nested json (8 ms)
    ✓ @QueryParams should not validate request query parameters when it's turned off in validator options (4 ms)
    ✓ @QueryParams should give a proper values from request's optional query parameters (3 ms)
    ✓ @QueryParam should give a proper values from request query parameters (3 ms)
    ✓ @QueryParam should give an array of string with only one query parameter (4 ms)
    ✓ @QueryParam should give an array of string with multiple query parameters (8 ms)
    ✓ @QueryParam should give an array of number with only one query parameter (5 ms)
    ✓ @QueryParam should give an array of number with multiple query parameters (2 ms)
    ✓ @QueryParam should give an array of date with only one query parameter (2 ms)
    ✓ @QueryParam should give an array of date with multiple query parameters (2 ms)
    ✓ @QueryParam when required params must be provided and they should not be empty (8 ms)
    ✓ @QueryParam when the type is Date then it should be parsed (2 ms)
    ✓ @QueryParam when the type is Date and it is invalid then the response should be a BadRequest error (2 ms)
    ✓ @QueryParam when parseJson flag is used query param must be converted to object (2 ms)
    ✓ @HeaderParam should give a proper values from request headers (2 ms)
    ✓ @HeaderParam when required is params must be provided and they should not be empty (2 ms)
    ✓ @HeaderParam should fail with invalid request options (5 ms)
    ✓ @HeaderParam should fail with missing required params (3 ms)
    ✓ for @HeaderParam when parseJson flag is used query param must be converted to object (2 ms)
    ✓ @CookieParam should give a proper values from request headers (2 ms)
    ✓ @CookieParam when required is params must be provided and they should not be empty (4 ms)
    ✓ @CookieParam when parseJson flag is used query param must be converted to object (2 ms)
    ✓ @Body should provide a request body (16 ms)
    ✓ @Body should fail if required body was not provided (7 ms)
    ✓ @Body should provide a json object for json-typed controllers and actions (2 ms)
    ✓ @Body should fail if required body was not provided for json-typed controllers and actions (4 ms)
    ✓ @BodyParam should provide a json object for json-typed controllers and actions (3 ms)
    ✓ @BodyParam should fail if required body was not provided for json-typed controllers and actions (20 ms)
    ✓ @Body using application/x-www-form-urlencoded should handle url encoded form data (4 ms)
    ✓ @UploadedFile using multipart/form-data should provide uploaded file with the given name (12 ms)
    ✓ @UploadedFile with @Body should return both the file and the body (6 ms)
    ✓ @UploadedFile with @BodyParam should return both the file and the body param (4 ms)
    ✓ @UploadedFile with passed uploading options (limit) should throw an error (5 ms)
    ✓ @UploadedFile when required is used files must be provided (7 ms)
    ✓ @UploadedFiles should provide uploaded files with the given name (5 ms)
    ✓ @UploadedFiles with passed uploading options (limit) should throw an error (5 ms)
    ✓ @UploadedFiles when required is used files must be provided (4 ms)

PASS test/functional/express-error-handling.spec.ts
    express error handling
      ✓ should not call global error handler middleware if there was no errors (9 ms)
      ✓ should call global error handler middleware (21 ms)
      ✓ should call global error handler middleware (4 ms)
      ✓ should call error handler middleware if used (3 ms)
      ✓ should not execute next middleware if soft error handled specifically and stopped error bubbling (2 ms)
      ✓ should process JsonErrors by their toJSON method if it exists (3 ms)

PASS test/functional/other-controller-decorators.spec.ts
    other controller decorators
      ✓ should return httpCode set by @HttpCode decorator (12 ms)
      ✓ should return custom code when @OnNull (33 ms)
      ✓ should return custom error message and code when @OnUndefined is used with Error class (10 ms)
      ✓ should return custom code when @OnUndefined (12 ms)
      ✓ should return content-type in the response when @ContentType is used (2 ms)
      ✓ should return content-type in the response when @ContentType is used (17 ms)
      ✓ should return response with custom headers when @Header is used (3 ms)
      ✓ should relocate to new location when @Location is used (3 ms)

PASS test/functional/auth-decorator.spec.ts
    Controller responds with value when Authorization succeeds (async)
      ✓ without roles (79 ms)
      ✓ with roles (14 ms)
      ✓ async (25 ms)
    Controller responds with value when Authorization succeeds (sync)
      ✓ without roles (4 ms)
      ✓ with roles (3 ms)
      ✓ async (14 ms)
    Authorized Decorators Http Status Code
      ✓ without roles (20 ms)
      ✓ with roles (5 ms)
    Authorization checker allows to throw (async)
      ✓ custom errors (4 ms)
    Authorization checker allows to throw (sync)
      ✓ custom errors (3 ms)

PASS test/functional/action-options.spec.ts
    ✓ should use controller options when action transform options are not set (76 ms)
    ✓ should override controller options with action transformRequest option (6 ms)
    ✓ should override controller options with action transformResponse option (3 ms)

PASS test/functional/load-from-directory.spec.ts
    loading all controllers from the given directories
      ✓ should load all controllers (19 ms)
    loading all express middlewares and error handlers from the given directories
      ✓ should succeed (22 ms)
      ✓ should fail (30 ms)

PASS test/functional/redirect-decorator.spec.ts
    dynamic redirect
      ✓ using template (50 ms)
      ✓ using override (16 ms)
      ✓ using original (18 ms)

PASS test/functional/global-options.spec.ts
    routing-controllers global options
      useClassTransformer default value
        ✓ useClassTransformer by default must be set to true (86 ms)
      when useClassTransformer is set to true
        ✓ useClassTransformer is enabled (5 ms)
      when useClassTransformer is set to false
        ✓ useClassTransformer is disabled (4 ms)
      when routePrefix is used all controller routes should be appended by it
        ✓ routePrefix is enabled (9 ms)

PASS test/functional/render-decorator.spec.ts
    template rendering
      ✓ should render a template and use given variables (13 ms)
      ✓ should render a template with given variables and locals variables (4 ms)

PASS test/functional/express-custom-error-handling.spec.ts
    custom express error handling
      ✓ should not call global error handler middleware if there was no errors (23 ms)
      ✓ should call global error handler middleware (18 ms)

PASS test/functional/class-validator-options.spec.ts
    no options
      ✓ should not use any options if not set (64 ms)
    global options
      should merge local validation options with global validation options prioritizing local
        ✓ succeed (6 ms)
      should pass the valid param after validation
        ✓ succeed (4 ms)
        ✓ should contain param name on validation failed (21 ms)
    local options
      ✓ should apply local options (4 ms)

PASS test/functional/express-middlewares.spec.ts
    express middlewares
      ✓ should call a global middlewares (21 ms)
      ✓ should use a custom middleware when @UseBefore or @UseAfter is used (3 ms)
      ✓ should call middleware and call it before controller action when @UseBefore is used (2 ms)
      ✓ should call middleware and call it after controller action when @UseAfter is used (3 ms)
      ✓ should call before middleware and call after middleware when @UseAfter and @UseAfter are used (2 ms)
      ✓ should handle errors in custom middlewares (23 ms)

PASS test/functional/container.spec.ts
    using typedi container should be possible
      ✓ typedi container (65 ms)
    using custom container should be possible
      ✓ custom container (6 ms)
    using custom container with fallback should be possible
      ✓ custom container with fallback (8 ms)
    using custom container with fallback and fallback on throw error should be possible
      ✓ custom container with fallback and fallback on throw error (9 ms)

PASS test/unit/controller-inheritance.spec.ts
  controller inheritance
    ✓ should build empty meta for empty set (11 ms)
    ✓ should build meta if the only derivative controller is given (2 ms)
    ✓ should build meta if the only autonomous controller is given (1 ms)
    ✓ should build meta both when autonomous and derivative controllers are given

PASS test/functional/controller-options.spec.ts
    controller options
      ✓ controller transform is enabled by default (19 ms)
      ✓ when controller transform is enabled (5 ms)
      ✓ when controller transform is disabled (4 ms)

PASS test/functional/defaults.spec.ts
    defaults
      ✓ should return undefinedResultCode from defaults config for void function (8 ms)
      ✓ should return undefinedResultCode from defaults config for promise void function (2 ms)
      ✓ should return 400 from required paramOptions (16 ms)
      ✓ should return nullResultCode from defaults config (4 ms)
      ✓ should return status code from OnUndefined annotation (3 ms)
      ✓ should mark arg optional from QueryParam annotation (3 ms)

PASS test/functional/express-global-before-error-handling.spec.ts
    custom express global before middleware error handling
      ✓ should call global error handler middleware with CustomError (49 ms)

PASS test/functional/class-transformer-options.spec.ts
    should not use any options if not set
      ✓ technical wrapper (33 ms)
    should apply global options
      ✓ technical wrapper (4 ms)
    should apply local options
      ✓ technical wrapper (4 ms)

PASS test/functional/controller-base-routes.spec.ts
    controller > base routes functionality
      ✓ get should respond with proper status code, headers and body content (127 ms)
      ✓ get should respond with proper status code, headers and body content (6 ms)
      ✓ get should respond with proper status code, headers and body content - 2nd pass (6 ms)
      ✓ wrong route should respond with 404 error (6 ms)
      ✓ wrong route should respond with 404 error (3 ms)
      ✓ wrong route should respond with 404 error (2 ms)

PASS test/functional/special-result-send.spec.ts
    special result value treatment
      ✓ should pipe stream to response (23 ms)
      ✓ should send raw binary data from Buffer (2 ms)
      ✓ should send raw binary data from UIntArray (2 ms)

PASS test/functional/middlewares-order.spec.ts
    loaded direct from array
      ✓ should call middlewares in order defined by items order (23 ms)
    specified by priority option
      ✓ should call middlewares in order defined by priority parameter of decorator (3 ms)

PASS test/functional/error-subclasses.spec.ts
  HttpError
    ✓ should be instance of HttpError and Error (4 ms)
  BadRequestError
    ✓ should be instance of BadRequestError, HttpError and Error (1 ms)

Summary of all failing tests
FAIL test/ActionParameterHandler.spec.ts
  ● ActionParameterHandler › negative › handle - throws error if the parameter is required

    Expected value   "TypeError: Cannot read property 'uuid' of undefined"
    Received:
      "TypeError: Cannot read properties of undefined (reading 'uuid')"

    Message:
      expected 'TypeError: Cannot read properties of undefined (reading \'uuid\')' to equal 'TypeError: Cannot read property \'uuid\' of undefined'

    Difference:

    - Expected
    + Received

    - TypeError: Cannot read property 'uuid' of undefined
    + TypeError: Cannot read properties of undefined (reading 'uuid')

      152 |       }
      153 | 
    > 154 |       expect(error.toString()).to.be.eq("TypeError: Cannot read property 'uuid' of undefined");
          |                                      ^
      155 |     });
      156 | 
      157 |     it('handle - throws error if the parameter is required, type file provided', async () => {

      at Object.<anonymous> (test/ActionParameterHandler.spec.ts:154:38)


Test Suites: 1 failed, 25 passed, 26 total
Tests:       1 failed, 181 passed, 182 total
Snapshots:   0 total
Time:        13.215 s, estimated 14 s
Ran all test suites.
************* run test done *************
routing-controllers is testing ./Variants/express/variant1/express
************* npm unlink module *************
************* npm unlink module done *************
************* npm unlink globally *************
************* npm unlink globally done *************
************* npm link globally *************
************* npm link globally done *************
************* npm link module *************
************* npm link module done *************
************* start run test *************
ts-jest[config] (WARN) The option `tsConfig` is deprecated and will be removed in ts-jest 27, use `tsconfig` instead
FAIL test/ActionParameterHandler.spec.ts
  ActionParameterHandler
    positive
      ✓ handle - should process string parameters (34 ms)
      ✓ handle - should process string parameters, returns empty if a given string is empty (1 ms)
      ✓ handle - should process number parameters
      ✓ handle - undefined on empty object provided
      ✓ handle - null provided (14 ms)
    negative
      ✕ handle - throws error if the parameter is required (7 ms)
      ✓ handle - throws error if the parameter is required, type file provided (1 ms)

  ● ActionParameterHandler › negative › handle - throws error if the parameter is required

    Expected value   "TypeError: Cannot read property 'uuid' of undefined"
    Received:
      "TypeError: Cannot read properties of undefined (reading 'uuid')"

    Message:
      expected 'TypeError: Cannot read properties of undefined (reading \'uuid\')' to equal 'TypeError: Cannot read property \'uuid\' of undefined'

    Difference:

    - Expected
    + Received

    - TypeError: Cannot read property 'uuid' of undefined
    + TypeError: Cannot read properties of undefined (reading 'uuid')

      152 |       }
      153 | 
    > 154 |       expect(error.toString()).to.be.eq("TypeError: Cannot read property 'uuid' of undefined");
          |                                      ^
      155 |     });
      156 | 
      157 |     it('handle - throws error if the parameter is required, type file provided', async () => {

      at Object.<anonymous> (test/ActionParameterHandler.spec.ts:154:38)

PASS test/functional/controller-methods.spec.ts
    controller methods
      ✓ get should respond with proper status code, headers and body content (21 ms)
      ✓ post respond with proper status code, headers and body content (5 ms)
      ✓ put respond with proper status code, headers and body content (3 ms)
      ✓ patch respond with proper status code, headers and body content (4 ms)
      ✓ delete respond with proper status code, headers and body content (3 ms)
      ✓ head respond with proper status code, headers and body content (3 ms)
      ✓ custom method (post) respond with proper status code, headers and body content (2 ms)
      ✓ custom method (delete) respond with proper status code, headers and body content (3 ms)
      ✓ route should work with parameter (3 ms)
      ✓ route should work with regexp parameter (3 ms)
      ✓ should respond with 404 when regexp does not match (5 ms)
      ✓ route should work with string regexp parameter (3 ms)
      ✓ should respond with 404 when regexp does not match (2 ms)
      ✓ should return result from a promise (503 ms)
      ✓ should respond with 500 if promise failed (504 ms)
      ✓ should respond with 204 No Content when null returned in action (17 ms)
      ✓ should respond with 404 Not Found text when undefined returned in action (21 ms)
      ✓ should respond with 404 Not Found JSON when undefined returned in action (3 ms)
      ✓ should respond with 200 and text/html even in json controller's method (2 ms)
      ✓ should respond with 200 and text/plain even in json controller's method (2 ms)
      ✓ should respond with 401 and text/html when UnauthorizedError throwed even in json controller's method (5 ms)
      ✓ should respond with 401 and aplication/json when UnauthorizedError is thrown in standard json controller's method (2 ms)

PASS test/functional/json-controller-methods.spec.ts
    json-controller methods
      ✓ get should respond with proper status code, headers and body content (11 ms)
      ✓ post respond with proper status code, headers and body content (3 ms)
      ✓ put respond with proper status code, headers and body content (2 ms)
      ✓ patch respond with proper status code, headers and body content (3 ms)
      ✓ delete respond with proper status code, headers and body content (2 ms)
      ✓ head respond with proper status code, headers and body content (3 ms)
      ✓ custom method (post) respond with proper status code, headers and body content (2 ms)
      ✓ custom method (delete) respond with proper status code, headers and body content (2 ms)
      ✓ route should work with parameter (3 ms)
      ✓ route should work with regexp parameter (2 ms)
      ✓ should respond with 404 when regexp does not match (4 ms)
      ✓ route should work with string regexp parameter (3 ms)
      ✓ should respond with 404 when regexp does not match (2 ms)
      ✓ should return result from a promise (504 ms)
      ✓ should respond with 500 if promise failed (504 ms)

PASS test/functional/interceptors.spec.ts
    interceptor
      ✓ custom interceptor function should replace returned content (10 ms)
      ✓ custom interceptor class should replace returned content (3 ms)
      ✓ custom interceptor class used on the whole controller should replace returned content (3 ms)
      ✓ global interceptor class should replace returned content (2 ms)
      ✓ interceptors should support promises (1005 ms)

PASS test/functional/action-params.spec.ts
    ✓ @Req and @Res should be provided as Request and Response objects (13 ms)
    ✓ @Res writing directly to the response should work (5 ms)
    ✓ @Param should give a param from route (3 ms)
    ✓ @Param multiple params should give a proper values from route (2 ms)
    ✓ @SessionParam without middleware (23 ms)
    ✓ @Session should return a value from session (11 ms)
    ✓ @Session(param) should allow to inject empty property (4 ms)
    ✓ @QueryParams should give a proper values from request's query parameters (9 ms)
    ✓ @QueryParams should give a proper values from request's query parameters and one multiple value (6 ms)
    ✓ @QueryParams should give a proper values from request's query with validate whitelist option on (14 ms)
    ✓ @QueryParams should give a proper values from request's query parameters with nested json (4 ms)
    ✓ @QueryParams should not validate request query parameters when it's turned off in validator options (3 ms)
    ✓ @QueryParams should give a proper values from request's optional query parameters (3 ms)
    ✓ @QueryParam should give a proper values from request query parameters (2 ms)
    ✓ @QueryParam should give an array of string with only one query parameter (2 ms)
    ✓ @QueryParam should give an array of string with multiple query parameters (2 ms)
    ✓ @QueryParam should give an array of number with only one query parameter (2 ms)
    ✓ @QueryParam should give an array of number with multiple query parameters (3 ms)
    ✓ @QueryParam should give an array of date with only one query parameter (2 ms)
    ✓ @QueryParam should give an array of date with multiple query parameters (2 ms)
    ✓ @QueryParam when required params must be provided and they should not be empty (8 ms)
    ✓ @QueryParam when the type is Date then it should be parsed (2 ms)
    ✓ @QueryParam when the type is Date and it is invalid then the response should be a BadRequest error (2 ms)
    ✓ @QueryParam when parseJson flag is used query param must be converted to object (2 ms)
    ✓ @HeaderParam should give a proper values from request headers (2 ms)
    ✓ @HeaderParam when required is params must be provided and they should not be empty (2 ms)
    ✓ @HeaderParam should fail with invalid request options (5 ms)
    ✓ @HeaderParam should fail with missing required params (3 ms)
    ✓ for @HeaderParam when parseJson flag is used query param must be converted to object (2 ms)
    ✓ @CookieParam should give a proper values from request headers (2 ms)
    ✓ @CookieParam when required is params must be provided and they should not be empty (4 ms)
    ✓ @CookieParam when parseJson flag is used query param must be converted to object (2 ms)
    ✓ @Body should provide a request body (12 ms)
    ✓ @Body should fail if required body was not provided (11 ms)
    ✓ @Body should provide a json object for json-typed controllers and actions (3 ms)
    ✓ @Body should fail if required body was not provided for json-typed controllers and actions (4 ms)
    ✓ @BodyParam should provide a json object for json-typed controllers and actions (3 ms)
    ✓ @BodyParam should fail if required body was not provided for json-typed controllers and actions (18 ms)
    ✓ @Body using application/x-www-form-urlencoded should handle url encoded form data (4 ms)
    ✓ @UploadedFile using multipart/form-data should provide uploaded file with the given name (13 ms)
    ✓ @UploadedFile with @Body should return both the file and the body (7 ms)
    ✓ @UploadedFile with @BodyParam should return both the file and the body param (4 ms)
    ✓ @UploadedFile with passed uploading options (limit) should throw an error (5 ms)
    ✓ @UploadedFile when required is used files must be provided (7 ms)
    ✓ @UploadedFiles should provide uploaded files with the given name (4 ms)
    ✓ @UploadedFiles with passed uploading options (limit) should throw an error (5 ms)
    ✓ @UploadedFiles when required is used files must be provided (5 ms)

PASS test/functional/global-options.spec.ts
    routing-controllers global options
      useClassTransformer default value
        ✓ useClassTransformer by default must be set to true (87 ms)
      when useClassTransformer is set to true
        ✓ useClassTransformer is enabled (5 ms)
      when useClassTransformer is set to false
        ✓ useClassTransformer is disabled (4 ms)
      when routePrefix is used all controller routes should be appended by it
        ✓ routePrefix is enabled (6 ms)

PASS test/functional/load-from-directory.spec.ts
    loading all controllers from the given directories
      ✓ should load all controllers (20 ms)
    loading all express middlewares and error handlers from the given directories
      ✓ should succeed (14 ms)
      ✓ should fail (32 ms)

PASS test/functional/auth-decorator.spec.ts
    Controller responds with value when Authorization succeeds (async)
      ✓ without roles (87 ms)
      ✓ with roles (15 ms)
      ✓ async (34 ms)
    Controller responds with value when Authorization succeeds (sync)
      ✓ without roles (5 ms)
      ✓ with roles (3 ms)
      ✓ async (13 ms)
    Authorized Decorators Http Status Code
      ✓ without roles (19 ms)
      ✓ with roles (4 ms)
    Authorization checker allows to throw (async)
      ✓ custom errors (5 ms)
    Authorization checker allows to throw (sync)
      ✓ custom errors (4 ms)

PASS test/functional/other-controller-decorators.spec.ts
    other controller decorators
      ✓ should return httpCode set by @HttpCode decorator (12 ms)
      ✓ should return custom code when @OnNull (30 ms)
      ✓ should return custom error message and code when @OnUndefined is used with Error class (8 ms)
      ✓ should return custom code when @OnUndefined (8 ms)
      ✓ should return content-type in the response when @ContentType is used (2 ms)
      ✓ should return content-type in the response when @ContentType is used (2 ms)
      ✓ should return response with custom headers when @Header is used (3 ms)
      ✓ should relocate to new location when @Location is used (2 ms)

PASS test/functional/controller-base-routes.spec.ts
    controller > base routes functionality
      ✓ get should respond with proper status code, headers and body content (66 ms)
      ✓ get should respond with proper status code, headers and body content (4 ms)
      ✓ get should respond with proper status code, headers and body content - 2nd pass (4 ms)
      ✓ wrong route should respond with 404 error (4 ms)
      ✓ wrong route should respond with 404 error (2 ms)
      ✓ wrong route should respond with 404 error (2 ms)

PASS test/functional/redirect-decorator.spec.ts
    dynamic redirect
      ✓ using template (36 ms)
      ✓ using override (7 ms)
      ✓ using original (7 ms)

PASS test/functional/action-options.spec.ts
    ✓ should use controller options when action transform options are not set (81 ms)
    ✓ should override controller options with action transformRequest option (5 ms)
    ✓ should override controller options with action transformResponse option (3 ms)

PASS test/functional/container.spec.ts
    using typedi container should be possible
      ✓ typedi container (75 ms)
    using custom container should be possible
      ✓ custom container (9 ms)
    using custom container with fallback should be possible
      ✓ custom container with fallback (19 ms)
    using custom container with fallback and fallback on throw error should be possible
      ✓ custom container with fallback and fallback on throw error (13 ms)

PASS test/unit/controller-inheritance.spec.ts
  controller inheritance
    ✓ should build empty meta for empty set (11 ms)
    ✓ should build meta if the only derivative controller is given (2 ms)
    ✓ should build meta if the only autonomous controller is given (1 ms)
    ✓ should build meta both when autonomous and derivative controllers are given

PASS test/functional/class-validator-options.spec.ts
    no options
      ✓ should not use any options if not set (72 ms)
    global options
      should merge local validation options with global validation options prioritizing local
        ✓ succeed (6 ms)
      should pass the valid param after validation
        ✓ succeed (5 ms)
        ✓ should contain param name on validation failed (15 ms)
    local options
      ✓ should apply local options (7 ms)

PASS test/functional/express-error-handling.spec.ts
    express error handling
      ✓ should not call global error handler middleware if there was no errors (10 ms)
      ✓ should call global error handler middleware (20 ms)
      ✓ should call global error handler middleware (5 ms)
      ✓ should call error handler middleware if used (3 ms)
      ✓ should not execute next middleware if soft error handled specifically and stopped error bubbling (3 ms)
      ✓ should process JsonErrors by their toJSON method if it exists (3 ms)

PASS test/functional/defaults.spec.ts
    defaults
      ✓ should return undefinedResultCode from defaults config for void function (23 ms)
      ✓ should return undefinedResultCode from defaults config for promise void function (3 ms)
      ✓ should return 400 from required paramOptions (16 ms)
      ✓ should return nullResultCode from defaults config (3 ms)
      ✓ should return status code from OnUndefined annotation (2 ms)
      ✓ should mark arg optional from QueryParam annotation (4 ms)

PASS test/functional/controller-options.spec.ts
    controller options
      ✓ controller transform is enabled by default (34 ms)
      ✓ when controller transform is enabled (5 ms)
      ✓ when controller transform is disabled (3 ms)

PASS test/functional/express-middlewares.spec.ts
    express middlewares
      ✓ should call a global middlewares (25 ms)
      ✓ should use a custom middleware when @UseBefore or @UseAfter is used (3 ms)
      ✓ should call middleware and call it before controller action when @UseBefore is used (2 ms)
      ✓ should call middleware and call it after controller action when @UseAfter is used (3 ms)
      ✓ should call before middleware and call after middleware when @UseAfter and @UseAfter are used (2 ms)
      ✓ should handle errors in custom middlewares (23 ms)

PASS test/functional/express-global-before-error-handling.spec.ts
    custom express global before middleware error handling
      ✓ should call global error handler middleware with CustomError (40 ms)

PASS test/functional/class-transformer-options.spec.ts
    should not use any options if not set
      ✓ technical wrapper (33 ms)
    should apply global options
      ✓ technical wrapper (5 ms)
    should apply local options
      ✓ technical wrapper (5 ms)

PASS test/functional/render-decorator.spec.ts
    template rendering
      ✓ should render a template and use given variables (38 ms)
      ✓ should render a template with given variables and locals variables (4 ms)

PASS test/functional/express-custom-error-handling.spec.ts
    custom express error handling
      ✓ should not call global error handler middleware if there was no errors (24 ms)
      ✓ should call global error handler middleware (21 ms)

PASS test/functional/middlewares-order.spec.ts
    loaded direct from array
      ✓ should call middlewares in order defined by items order (24 ms)
    specified by priority option
      ✓ should call middlewares in order defined by priority parameter of decorator (3 ms)

PASS test/functional/special-result-send.spec.ts
    special result value treatment
      ✓ should pipe stream to response (23 ms)
      ✓ should send raw binary data from Buffer (4 ms)
      ✓ should send raw binary data from UIntArray (3 ms)

PASS test/functional/error-subclasses.spec.ts
  HttpError
    ✓ should be instance of HttpError and Error (4 ms)
  BadRequestError
    ✓ should be instance of BadRequestError, HttpError and Error (1 ms)

Summary of all failing tests
FAIL test/ActionParameterHandler.spec.ts
  ● ActionParameterHandler › negative › handle - throws error if the parameter is required

    Expected value   "TypeError: Cannot read property 'uuid' of undefined"
    Received:
      "TypeError: Cannot read properties of undefined (reading 'uuid')"

    Message:
      expected 'TypeError: Cannot read properties of undefined (reading \'uuid\')' to equal 'TypeError: Cannot read property \'uuid\' of undefined'

    Difference:

    - Expected
    + Received

    - TypeError: Cannot read property 'uuid' of undefined
    + TypeError: Cannot read properties of undefined (reading 'uuid')

      152 |       }
      153 | 
    > 154 |       expect(error.toString()).to.be.eq("TypeError: Cannot read property 'uuid' of undefined");
          |                                      ^
      155 |     });
      156 | 
      157 |     it('handle - throws error if the parameter is required, type file provided', async () => {

      at Object.<anonymous> (test/ActionParameterHandler.spec.ts:154:38)


Test Suites: 1 failed, 25 passed, 26 total
Tests:       1 failed, 181 passed, 182 total
Snapshots:   0 total
Time:        13.355 s, estimated 14 s
Ran all test suites.
************* run test done *************
