11
ts-jest[config] (WARN) The option `tsConfig` is deprecated and will be removed in ts-jest 27, use `tsconfig` instead
FAIL test/ActionParameterHandler.spec.ts
  ActionParameterHandler
    positive
      ✓ handle - should process string parameters (27 ms)
      ✓ handle - should process string parameters, returns empty if a given string is empty
      ✓ handle - should process number parameters (1 ms)
      ✓ handle - undefined on empty object provided (4 ms)
      ✓ handle - null provided (10 ms)
    negative
      ✕ handle - throws error if the parameter is required (7 ms)
      ✓ handle - throws error if the parameter is required, type file provided (1 ms)

  ● ActionParameterHandler › negative › handle - throws error if the parameter is required

    Expected value   "TypeError: Cannot read property 'uuid' of undefined"
    Received:
      "TypeError: Cannot read properties of undefined (reading 'uuid')"

    Message:
      expected 'TypeError: Cannot read properties of undefined (reading \'uuid\')' to equal 'TypeError: Cannot read property \'uuid\' of undefined'

    Difference:

    - Expected
    + Received

    - TypeError: Cannot read property 'uuid' of undefined
    + TypeError: Cannot read properties of undefined (reading 'uuid')

      152 |       }
      153 | 
    > 154 |       expect(error.toString()).to.be.eq("TypeError: Cannot read property 'uuid' of undefined");
          |                                      ^
      155 |     });
      156 | 
      157 |     it('handle - throws error if the parameter is required, type file provided', async () => {

      at Object.<anonymous> (test/ActionParameterHandler.spec.ts:154:38)

PASS test/functional/controller-methods.spec.ts
    controller methods
      ✓ get should respond with proper status code, headers and body content (19 ms)
      ✓ post respond with proper status code, headers and body content (5 ms)
      ✓ put respond with proper status code, headers and body content (3 ms)
      ✓ patch respond with proper status code, headers and body content (3 ms)
      ✓ delete respond with proper status code, headers and body content (3 ms)
      ✓ head respond with proper status code, headers and body content (2 ms)
      ✓ custom method (post) respond with proper status code, headers and body content (3 ms)
      ✓ custom method (delete) respond with proper status code, headers and body content (2 ms)
      ✓ route should work with parameter (3 ms)
      ✓ route should work with regexp parameter (2 ms)
      ✓ should respond with 404 when regexp does not match (5 ms)
      ✓ route should work with string regexp parameter (3 ms)
      ✓ should respond with 404 when regexp does not match (2 ms)
      ✓ should return result from a promise (503 ms)
      ✓ should respond with 500 if promise failed (504 ms)
      ✓ should respond with 204 No Content when null returned in action (5 ms)
      ✓ should respond with 404 Not Found text when undefined returned in action (30 ms)
      ✓ should respond with 404 Not Found JSON when undefined returned in action (3 ms)
      ✓ should respond with 200 and text/html even in json controller's method (2 ms)
      ✓ should respond with 200 and text/plain even in json controller's method (2 ms)
      ✓ should respond with 401 and text/html when UnauthorizedError throwed even in json controller's method (4 ms)
      ✓ should respond with 401 and aplication/json when UnauthorizedError is thrown in standard json controller's method (3 ms)

PASS test/functional/interceptors.spec.ts
    interceptor
      ✓ custom interceptor function should replace returned content (25 ms)
      ✓ custom interceptor class should replace returned content (3 ms)
      ✓ custom interceptor class used on the whole controller should replace returned content (2 ms)
      ✓ global interceptor class should replace returned content (2 ms)
      ✓ interceptors should support promises (1005 ms)

PASS test/functional/json-controller-methods.spec.ts
    json-controller methods
      ✓ get should respond with proper status code, headers and body content (26 ms)
      ✓ post respond with proper status code, headers and body content (3 ms)
      ✓ put respond with proper status code, headers and body content (3 ms)
      ✓ patch respond with proper status code, headers and body content (2 ms)
      ✓ delete respond with proper status code, headers and body content (3 ms)
      ✓ head respond with proper status code, headers and body content (2 ms)
      ✓ custom method (post) respond with proper status code, headers and body content (3 ms)
      ✓ custom method (delete) respond with proper status code, headers and body content (2 ms)
      ✓ route should work with parameter (3 ms)
      ✓ route should work with regexp parameter (3 ms)
      ✓ should respond with 404 when regexp does not match (4 ms)
      ✓ route should work with string regexp parameter (3 ms)
      ✓ should respond with 404 when regexp does not match (2 ms)
      ✓ should return result from a promise (503 ms)
      ✓ should respond with 500 if promise failed (503 ms)

PASS test/functional/action-params.spec.ts
    ✓ @Req and @Res should be provided as Request and Response objects (10 ms)
    ✓ @Res writing directly to the response should work (3 ms)
    ✓ @Param should give a param from route (3 ms)
    ✓ @Param multiple params should give a proper values from route (3 ms)
    ✓ @SessionParam without middleware (21 ms)
    ✓ @Session should return a value from session (10 ms)
    ✓ @Session(param) should allow to inject empty property (3 ms)
    ✓ @QueryParams should give a proper values from request's query parameters (9 ms)
    ✓ @QueryParams should give a proper values from request's query parameters and one multiple value (15 ms)
    ✓ @QueryParams should give a proper values from request's query with validate whitelist option on (3 ms)
    ✓ @QueryParams should give a proper values from request's query parameters with nested json (4 ms)
    ✓ @QueryParams should not validate request query parameters when it's turned off in validator options (2 ms)
    ✓ @QueryParams should give a proper values from request's optional query parameters (3 ms)
    ✓ @QueryParam should give a proper values from request query parameters (2 ms)
    ✓ @QueryParam should give an array of string with only one query parameter (2 ms)
    ✓ @QueryParam should give an array of string with multiple query parameters (2 ms)
    ✓ @QueryParam should give an array of number with only one query parameter (3 ms)
    ✓ @QueryParam should give an array of number with multiple query parameters (3 ms)
    ✓ @QueryParam should give an array of date with only one query parameter (2 ms)
    ✓ @QueryParam should give an array of date with multiple query parameters (2 ms)
    ✓ @QueryParam when required params must be provided and they should not be empty (7 ms)
    ✓ @QueryParam when the type is Date then it should be parsed (2 ms)
    ✓ @QueryParam when the type is Date and it is invalid then the response should be a BadRequest error (2 ms)
    ✓ @QueryParam when parseJson flag is used query param must be converted to object (2 ms)
    ✓ @HeaderParam should give a proper values from request headers (2 ms)
    ✓ @HeaderParam when required is params must be provided and they should not be empty (2 ms)
    ✓ @HeaderParam should fail with invalid request options (3 ms)
    ✓ @HeaderParam should fail with missing required params (2 ms)
    ✓ for @HeaderParam when parseJson flag is used query param must be converted to object (3 ms)
    ✓ @CookieParam should give a proper values from request headers (3 ms)
    ✓ @CookieParam when required is params must be provided and they should not be empty (4 ms)
    ✓ @CookieParam when parseJson flag is used query param must be converted to object (2 ms)
    ✓ @Body should provide a request body (12 ms)
    ✓ @Body should fail if required body was not provided (9 ms)
    ✓ @Body should provide a json object for json-typed controllers and actions (3 ms)
    ✓ @Body should fail if required body was not provided for json-typed controllers and actions (4 ms)
    ✓ @BodyParam should provide a json object for json-typed controllers and actions (2 ms)
    ✓ @BodyParam should fail if required body was not provided for json-typed controllers and actions (18 ms)
    ✓ @Body using application/x-www-form-urlencoded should handle url encoded form data (4 ms)
    ✓ @UploadedFile using multipart/form-data should provide uploaded file with the given name (11 ms)
    ✓ @UploadedFile with @Body should return both the file and the body (6 ms)
    ✓ @UploadedFile with @BodyParam should return both the file and the body param (4 ms)
    ✓ @UploadedFile with passed uploading options (limit) should throw an error (5 ms)
    ✓ @UploadedFile when required is used files must be provided (6 ms)
    ✓ @UploadedFiles should provide uploaded files with the given name (5 ms)
    ✓ @UploadedFiles with passed uploading options (limit) should throw an error (5 ms)
    ✓ @UploadedFiles when required is used files must be provided (4 ms)

PASS test/functional/container.spec.ts
    using typedi container should be possible
      ✓ typedi container (56 ms)
    using custom container should be possible
      ✓ custom container (6 ms)
    using custom container with fallback should be possible
      ✓ custom container with fallback (7 ms)
    using custom container with fallback and fallback on throw error should be possible
      ✓ custom container with fallback and fallback on throw error (7 ms)

PASS test/functional/other-controller-decorators.spec.ts
    other controller decorators
      ✓ should return httpCode set by @HttpCode decorator (11 ms)
      ✓ should return custom code when @OnNull (34 ms)
      ✓ should return custom error message and code when @OnUndefined is used with Error class (9 ms)
      ✓ should return custom code when @OnUndefined (10 ms)
      ✓ should return content-type in the response when @ContentType is used (2 ms)
      ✓ should return content-type in the response when @ContentType is used (2 ms)
      ✓ should return response with custom headers when @Header is used (3 ms)
      ✓ should relocate to new location when @Location is used (15 ms)

PASS test/functional/auth-decorator.spec.ts
    Controller responds with value when Authorization succeeds (async)
      ✓ without roles (67 ms)
      ✓ with roles (14 ms)
      ✓ async (24 ms)
    Controller responds with value when Authorization succeeds (sync)
      ✓ without roles (4 ms)
      ✓ with roles (4 ms)
      ✓ async (13 ms)
    Authorized Decorators Http Status Code
      ✓ without roles (19 ms)
      ✓ with roles (4 ms)
    Authorization checker allows to throw (async)
      ✓ custom errors (4 ms)
    Authorization checker allows to throw (sync)
      ✓ custom errors (3 ms)

PASS test/functional/action-options.spec.ts
    ✓ should use controller options when action transform options are not set (89 ms)
    ✓ should override controller options with action transformRequest option (5 ms)
    ✓ should override controller options with action transformResponse option (2 ms)

PASS test/functional/load-from-directory.spec.ts
    loading all controllers from the given directories
      ✓ should load all controllers (22 ms)
    loading all express middlewares and error handlers from the given directories
      ✓ should succeed (7 ms)
      ✓ should fail (29 ms)

PASS test/unit/controller-inheritance.spec.ts
  controller inheritance
    ✓ should build empty meta for empty set (26 ms)
    ✓ should build meta if the only derivative controller is given (2 ms)
    ✓ should build meta if the only autonomous controller is given
    ✓ should build meta both when autonomous and derivative controllers are given (1 ms)

PASS test/functional/global-options.spec.ts
    routing-controllers global options
      useClassTransformer default value
        ✓ useClassTransformer by default must be set to true (76 ms)
      when useClassTransformer is set to true
        ✓ useClassTransformer is enabled (4 ms)
      when useClassTransformer is set to false
        ✓ useClassTransformer is disabled (4 ms)
      when routePrefix is used all controller routes should be appended by it
        ✓ routePrefix is enabled (8 ms)

PASS test/functional/controller-options.spec.ts
    controller options
      ✓ controller transform is enabled by default (18 ms)
      ✓ when controller transform is enabled (4 ms)
      ✓ when controller transform is disabled (4 ms)

PASS test/functional/express-middlewares.spec.ts
    express middlewares
      ✓ should call a global middlewares (9 ms)
      ✓ should use a custom middleware when @UseBefore or @UseAfter is used (2 ms)
      ✓ should call middleware and call it before controller action when @UseBefore is used (2 ms)
      ✓ should call middleware and call it after controller action when @UseAfter is used (3 ms)
      ✓ should call before middleware and call after middleware when @UseAfter and @UseAfter are used (2 ms)
      ✓ should handle errors in custom middlewares (23 ms)

PASS test/functional/class-validator-options.spec.ts
    no options
      ✓ should not use any options if not set (52 ms)
    global options
      should merge local validation options with global validation options prioritizing local
        ✓ succeed (5 ms)
      should pass the valid param after validation
        ✓ succeed (4 ms)
        ✓ should contain param name on validation failed (14 ms)
    local options
      ✓ should apply local options (5 ms)

PASS test/functional/express-error-handling.spec.ts
    express error handling
      ✓ should not call global error handler middleware if there was no errors (20 ms)
      ✓ should call global error handler middleware (19 ms)
      ✓ should call global error handler middleware (4 ms)
      ✓ should call error handler middleware if used (7 ms)
      ✓ should not execute next middleware if soft error handled specifically and stopped error bubbling (3 ms)
      ✓ should process JsonErrors by their toJSON method if it exists (2 ms)

PASS test/functional/express-global-before-error-handling.spec.ts
    custom express global before middleware error handling
      ✓ should call global error handler middleware with CustomError (34 ms)

PASS test/functional/defaults.spec.ts
    defaults
      ✓ should return undefinedResultCode from defaults config for void function (19 ms)
      ✓ should return undefinedResultCode from defaults config for promise void function (3 ms)
      ✓ should return 400 from required paramOptions (13 ms)
      ✓ should return nullResultCode from defaults config (2 ms)
      ✓ should return status code from OnUndefined annotation (3 ms)
      ✓ should mark arg optional from QueryParam annotation (4 ms)

PASS test/functional/render-decorator.spec.ts
    template rendering
      ✓ should render a template and use given variables (26 ms)
      ✓ should render a template with given variables and locals variables (4 ms)

PASS test/functional/class-transformer-options.spec.ts
    should not use any options if not set
      ✓ technical wrapper (28 ms)
    should apply global options
      ✓ technical wrapper (4 ms)
    should apply local options
      ✓ technical wrapper (4 ms)

PASS test/functional/express-custom-error-handling.spec.ts
    custom express error handling
      ✓ should not call global error handler middleware if there was no errors (22 ms)
      ✓ should call global error handler middleware (18 ms)

PASS test/functional/controller-base-routes.spec.ts
    controller > base routes functionality
      ✓ get should respond with proper status code, headers and body content (52 ms)
      ✓ get should respond with proper status code, headers and body content (4 ms)
      ✓ get should respond with proper status code, headers and body content - 2nd pass (3 ms)
      ✓ wrong route should respond with 404 error (4 ms)
      ✓ wrong route should respond with 404 error (3 ms)
      ✓ wrong route should respond with 404 error (2 ms)

PASS test/functional/special-result-send.spec.ts
    special result value treatment
      ✓ should pipe stream to response (21 ms)
      ✓ should send raw binary data from Buffer (2 ms)
      ✓ should send raw binary data from UIntArray (2 ms)

PASS test/functional/redirect-decorator.spec.ts
    dynamic redirect
      ✓ using template (24 ms)
      ✓ using override (5 ms)
      ✓ using original (5 ms)

PASS test/functional/middlewares-order.spec.ts
    loaded direct from array
      ✓ should call middlewares in order defined by items order (8 ms)
    specified by priority option
      ✓ should call middlewares in order defined by priority parameter of decorator (2 ms)

PASS test/functional/error-subclasses.spec.ts
  HttpError
    ✓ should be instance of HttpError and Error (3 ms)
  BadRequestError
    ✓ should be instance of BadRequestError, HttpError and Error (1 ms)

Summary of all failing tests
FAIL test/ActionParameterHandler.spec.ts
  ● ActionParameterHandler › negative › handle - throws error if the parameter is required

    Expected value   "TypeError: Cannot read property 'uuid' of undefined"
    Received:
      "TypeError: Cannot read properties of undefined (reading 'uuid')"

    Message:
      expected 'TypeError: Cannot read properties of undefined (reading \'uuid\')' to equal 'TypeError: Cannot read property \'uuid\' of undefined'

    Difference:

    - Expected
    + Received

    - TypeError: Cannot read property 'uuid' of undefined
    + TypeError: Cannot read properties of undefined (reading 'uuid')

      152 |       }
      153 | 
    > 154 |       expect(error.toString()).to.be.eq("TypeError: Cannot read property 'uuid' of undefined");
          |                                      ^
      155 |     });
      156 | 
      157 |     it('handle - throws error if the parameter is required, type file provided', async () => {

      at Object.<anonymous> (test/ActionParameterHandler.spec.ts:154:38)


Test Suites: 1 failed, 25 passed, 26 total
Tests:       1 failed, 181 passed, 182 total
Snapshots:   0 total
Time:        12.431 s, estimated 13 s
Ran all test suites.
ts-jest[config] (WARN) The option `tsConfig` is deprecated and will be removed in ts-jest 27, use `tsconfig` instead
FAIL test/ActionParameterHandler.spec.ts
  ActionParameterHandler
    positive
      ✓ handle - should process string parameters (27 ms)
      ✓ handle - should process string parameters, returns empty if a given string is empty (1 ms)
      ✓ handle - should process number parameters
      ✓ handle - undefined on empty object provided (1 ms)
      ✓ handle - null provided (14 ms)
    negative
      ✕ handle - throws error if the parameter is required (6 ms)
      ✓ handle - throws error if the parameter is required, type file provided (1 ms)

  ● ActionParameterHandler › negative › handle - throws error if the parameter is required

    Expected value   "TypeError: Cannot read property 'uuid' of undefined"
    Received:
      "TypeError: Cannot read properties of undefined (reading 'uuid')"

    Message:
      expected 'TypeError: Cannot read properties of undefined (reading \'uuid\')' to equal 'TypeError: Cannot read property \'uuid\' of undefined'

    Difference:

    - Expected
    + Received

    - TypeError: Cannot read property 'uuid' of undefined
    + TypeError: Cannot read properties of undefined (reading 'uuid')

      152 |       }
      153 | 
    > 154 |       expect(error.toString()).to.be.eq("TypeError: Cannot read property 'uuid' of undefined");
          |                                      ^
      155 |     });
      156 | 
      157 |     it('handle - throws error if the parameter is required, type file provided', async () => {

      at Object.<anonymous> (test/ActionParameterHandler.spec.ts:154:38)

PASS test/functional/controller-methods.spec.ts
    controller methods
      ✓ get should respond with proper status code, headers and body content (19 ms)
      ✓ post respond with proper status code, headers and body content (5 ms)
      ✓ put respond with proper status code, headers and body content (3 ms)
      ✓ patch respond with proper status code, headers and body content (3 ms)
      ✓ delete respond with proper status code, headers and body content (3 ms)
      ✓ head respond with proper status code, headers and body content (2 ms)
      ✓ custom method (post) respond with proper status code, headers and body content (3 ms)
      ✓ custom method (delete) respond with proper status code, headers and body content (2 ms)
      ✓ route should work with parameter (3 ms)
      ✓ route should work with regexp parameter (2 ms)
      ✓ should respond with 404 when regexp does not match (5 ms)
      ✓ route should work with string regexp parameter (3 ms)
      ✓ should respond with 404 when regexp does not match (2 ms)
      ✓ should return result from a promise (503 ms)
      ✓ should respond with 500 if promise failed (504 ms)
      ✓ should respond with 204 No Content when null returned in action (5 ms)
      ✓ should respond with 404 Not Found text when undefined returned in action (21 ms)
      ✓ should respond with 404 Not Found JSON when undefined returned in action (12 ms)
      ✓ should respond with 200 and text/html even in json controller's method (2 ms)
      ✓ should respond with 200 and text/plain even in json controller's method (2 ms)
      ✓ should respond with 401 and text/html when UnauthorizedError throwed even in json controller's method (4 ms)
      ✓ should respond with 401 and aplication/json when UnauthorizedError is thrown in standard json controller's method (2 ms)

PASS test/functional/json-controller-methods.spec.ts
    json-controller methods
      ✓ get should respond with proper status code, headers and body content (25 ms)
      ✓ post respond with proper status code, headers and body content (3 ms)
      ✓ put respond with proper status code, headers and body content (2 ms)
      ✓ patch respond with proper status code, headers and body content (2 ms)
      ✓ delete respond with proper status code, headers and body content (3 ms)
      ✓ head respond with proper status code, headers and body content (2 ms)
      ✓ custom method (post) respond with proper status code, headers and body content (2 ms)
      ✓ custom method (delete) respond with proper status code, headers and body content (2 ms)
      ✓ route should work with parameter (3 ms)
      ✓ route should work with regexp parameter (3 ms)
      ✓ should respond with 404 when regexp does not match (3 ms)
      ✓ route should work with string regexp parameter (3 ms)
      ✓ should respond with 404 when regexp does not match (2 ms)
      ✓ should return result from a promise (504 ms)
      ✓ should respond with 500 if promise failed (503 ms)

PASS test/functional/interceptors.spec.ts
    interceptor
      ✓ custom interceptor function should replace returned content (19 ms)
      ✓ custom interceptor class should replace returned content (3 ms)
      ✓ custom interceptor class used on the whole controller should replace returned content (2 ms)
      ✓ global interceptor class should replace returned content (3 ms)
      ✓ interceptors should support promises (1003 ms)

FAIL test/functional/action-params.spec.ts
    ✕ encountered a declaration exception (2 ms)

  ●  › encountered a declaration exception

    TypeError: hasOwn is not a function

      at getBaseIntrinsic (../../../VariantsDeps/body-parser/variant10/body-parser/node_modules/get-intrinsic/index.js:229:6)
      at GetIntrinsic (../../../VariantsDeps/body-parser/variant10/body-parser/node_modules/get-intrinsic/index.js:267:18)
      at Object.<anonymous> (../../../VariantsDeps/body-parser/variant10/body-parser/node_modules/call-bind/index.js:6:14)
      at Object.<anonymous> (../../../VariantsDeps/body-parser/variant10/body-parser/node_modules/call-bind/callBound.js:5:16)

PASS test/functional/global-options.spec.ts
    routing-controllers global options
      useClassTransformer default value
        ✓ useClassTransformer by default must be set to true (93 ms)
      when useClassTransformer is set to true
        ✓ useClassTransformer is enabled (4 ms)
      when useClassTransformer is set to false
        ✓ useClassTransformer is disabled (3 ms)
      when routePrefix is used all controller routes should be appended by it
        ✓ routePrefix is enabled (6 ms)

PASS test/functional/load-from-directory.spec.ts
    loading all controllers from the given directories
      ✓ should load all controllers (31 ms)
    loading all express middlewares and error handlers from the given directories
      ✓ should succeed (12 ms)
      ✓ should fail (16 ms)

PASS test/functional/auth-decorator.spec.ts
    Controller responds with value when Authorization succeeds (async)
      ✓ without roles (64 ms)
      ✓ with roles (13 ms)
      ✓ async (24 ms)
    Controller responds with value when Authorization succeeds (sync)
      ✓ without roles (4 ms)
      ✓ with roles (5 ms)
      ✓ async (14 ms)
    Authorized Decorators Http Status Code
      ✓ without roles (18 ms)
      ✓ with roles (4 ms)
    Authorization checker allows to throw (async)
      ✓ custom errors (4 ms)
    Authorization checker allows to throw (sync)
      ✓ custom errors (3 ms)

PASS test/functional/other-controller-decorators.spec.ts
    other controller decorators
      ✓ should return httpCode set by @HttpCode decorator (11 ms)
      ✓ should return custom code when @OnNull (32 ms)
      ✓ should return custom error message and code when @OnUndefined is used with Error class (9 ms)
      ✓ should return custom code when @OnUndefined (22 ms)
      ✓ should return content-type in the response when @ContentType is used (2 ms)
      ✓ should return content-type in the response when @ContentType is used (2 ms)
      ✓ should return response with custom headers when @Header is used (6 ms)
      ✓ should relocate to new location when @Location is used (1 ms)

PASS test/functional/action-options.spec.ts
    ✓ should use controller options when action transform options are not set (82 ms)
    ✓ should override controller options with action transformRequest option (5 ms)
    ✓ should override controller options with action transformResponse option (3 ms)

PASS test/unit/controller-inheritance.spec.ts
  controller inheritance
    ✓ should build empty meta for empty set (10 ms)
    ✓ should build meta if the only derivative controller is given (2 ms)
    ✓ should build meta if the only autonomous controller is given (1 ms)
    ✓ should build meta both when autonomous and derivative controllers are given

PASS test/functional/express-global-before-error-handling.spec.ts
    custom express global before middleware error handling
      ✓ should call global error handler middleware with CustomError (153 ms)

PASS test/functional/container.spec.ts
    using typedi container should be possible
      ✓ typedi container (44 ms)
    using custom container should be possible
      ✓ custom container (5 ms)
    using custom container with fallback should be possible
      ✓ custom container with fallback (19 ms)
    using custom container with fallback and fallback on throw error should be possible
      ✓ custom container with fallback and fallback on throw error (8 ms)

PASS test/functional/class-validator-options.spec.ts
    no options
      ✓ should not use any options if not set (50 ms)
    global options
      should merge local validation options with global validation options prioritizing local
        ✓ succeed (5 ms)
      should pass the valid param after validation
        ✓ succeed (4 ms)
        ✓ should contain param name on validation failed (14 ms)
    local options
      ✓ should apply local options (6 ms)

PASS test/functional/express-middlewares.spec.ts
    express middlewares
      ✓ should call a global middlewares (18 ms)
      ✓ should use a custom middleware when @UseBefore or @UseAfter is used (3 ms)
      ✓ should call middleware and call it before controller action when @UseBefore is used (2 ms)
      ✓ should call middleware and call it after controller action when @UseAfter is used (2 ms)
      ✓ should call before middleware and call after middleware when @UseAfter and @UseAfter are used (3 ms)
      ✓ should handle errors in custom middlewares (21 ms)

PASS test/functional/express-error-handling.spec.ts
    express error handling
      ✓ should not call global error handler middleware if there was no errors (18 ms)
      ✓ should call global error handler middleware (17 ms)
      ✓ should call global error handler middleware (5 ms)
      ✓ should call error handler middleware if used (3 ms)
      ✓ should not execute next middleware if soft error handled specifically and stopped error bubbling (3 ms)
      ✓ should process JsonErrors by their toJSON method if it exists (2 ms)

PASS test/functional/defaults.spec.ts
    defaults
      ✓ should return undefinedResultCode from defaults config for void function (18 ms)
      ✓ should return undefinedResultCode from defaults config for promise void function (2 ms)
      ✓ should return 400 from required paramOptions (15 ms)
      ✓ should return nullResultCode from defaults config (3 ms)
      ✓ should return status code from OnUndefined annotation (2 ms)
      ✓ should mark arg optional from QueryParam annotation (4 ms)

PASS test/functional/controller-options.spec.ts
    controller options
      ✓ controller transform is enabled by default (30 ms)
      ✓ when controller transform is enabled (5 ms)
      ✓ when controller transform is disabled (3 ms)

PASS test/functional/redirect-decorator.spec.ts
    dynamic redirect
      ✓ using template (28 ms)
      ✓ using override (3 ms)
      ✓ using original (3 ms)

PASS test/functional/class-transformer-options.spec.ts
    should not use any options if not set
      ✓ technical wrapper (27 ms)
    should apply global options
      ✓ technical wrapper (4 ms)
    should apply local options
      ✓ technical wrapper (4 ms)

PASS test/functional/express-custom-error-handling.spec.ts
    custom express error handling
      ✓ should not call global error handler middleware if there was no errors (23 ms)
      ✓ should call global error handler middleware (17 ms)

PASS test/functional/render-decorator.spec.ts
    template rendering
      ✓ should render a template and use given variables (26 ms)
      ✓ should render a template with given variables and locals variables (4 ms)

PASS test/functional/controller-base-routes.spec.ts
    controller > base routes functionality
      ✓ get should respond with proper status code, headers and body content (51 ms)
      ✓ get should respond with proper status code, headers and body content (4 ms)
      ✓ get should respond with proper status code, headers and body content - 2nd pass (3 ms)
      ✓ wrong route should respond with 404 error (4 ms)
      ✓ wrong route should respond with 404 error (2 ms)
      ✓ wrong route should respond with 404 error (3 ms)

PASS test/functional/middlewares-order.spec.ts
    loaded direct from array
      ✓ should call middlewares in order defined by items order (21 ms)
    specified by priority option
      ✓ should call middlewares in order defined by priority parameter of decorator (2 ms)

PASS test/functional/special-result-send.spec.ts
    special result value treatment
      ✓ should pipe stream to response (11 ms)
      ✓ should send raw binary data from Buffer (3 ms)
      ✓ should send raw binary data from UIntArray (15 ms)

PASS test/functional/error-subclasses.spec.ts
  HttpError
    ✓ should be instance of HttpError and Error (3 ms)
  BadRequestError
    ✓ should be instance of BadRequestError, HttpError and Error (2 ms)

Summary of all failing tests
FAIL test/ActionParameterHandler.spec.ts
  ● ActionParameterHandler › negative › handle - throws error if the parameter is required

    Expected value   "TypeError: Cannot read property 'uuid' of undefined"
    Received:
      "TypeError: Cannot read properties of undefined (reading 'uuid')"

    Message:
      expected 'TypeError: Cannot read properties of undefined (reading \'uuid\')' to equal 'TypeError: Cannot read property \'uuid\' of undefined'

    Difference:

    - Expected
    + Received

    - TypeError: Cannot read property 'uuid' of undefined
    + TypeError: Cannot read properties of undefined (reading 'uuid')

      152 |       }
      153 | 
    > 154 |       expect(error.toString()).to.be.eq("TypeError: Cannot read property 'uuid' of undefined");
          |                                      ^
      155 |     });
      156 | 
      157 |     it('handle - throws error if the parameter is required, type file provided', async () => {

      at Object.<anonymous> (test/ActionParameterHandler.spec.ts:154:38)

FAIL test/functional/action-params.spec.ts
  ●  › encountered a declaration exception

    TypeError: hasOwn is not a function

      at getBaseIntrinsic (../../../VariantsDeps/body-parser/variant10/body-parser/node_modules/get-intrinsic/index.js:229:6)
      at GetIntrinsic (../../../VariantsDeps/body-parser/variant10/body-parser/node_modules/get-intrinsic/index.js:267:18)
      at Object.<anonymous> (../../../VariantsDeps/body-parser/variant10/body-parser/node_modules/call-bind/index.js:6:14)
      at Object.<anonymous> (../../../VariantsDeps/body-parser/variant10/body-parser/node_modules/call-bind/callBound.js:5:16)


Test Suites: 2 failed, 24 passed, 26 total
Tests:       2 failed, 134 passed, 136 total
Snapshots:   0 total
Time:        12.031 s, estimated 13 s
Ran all test suites.
ts-jest[config] (WARN) The option `tsConfig` is deprecated and will be removed in ts-jest 27, use `tsconfig` instead
FAIL test/ActionParameterHandler.spec.ts
  ActionParameterHandler
    positive
      ✓ handle - should process string parameters (31 ms)
      ✓ handle - should process string parameters, returns empty if a given string is empty (1 ms)
      ✓ handle - should process number parameters
      ✓ handle - undefined on empty object provided
      ✓ handle - null provided (12 ms)
    negative
      ✕ handle - throws error if the parameter is required (7 ms)
      ✓ handle - throws error if the parameter is required, type file provided (1 ms)

  ● ActionParameterHandler › negative › handle - throws error if the parameter is required

    Expected value   "TypeError: Cannot read property 'uuid' of undefined"
    Received:
      "TypeError: Cannot read properties of undefined (reading 'uuid')"

    Message:
      expected 'TypeError: Cannot read properties of undefined (reading \'uuid\')' to equal 'TypeError: Cannot read property \'uuid\' of undefined'

    Difference:

    - Expected
    + Received

    - TypeError: Cannot read property 'uuid' of undefined
    + TypeError: Cannot read properties of undefined (reading 'uuid')

      152 |       }
      153 | 
    > 154 |       expect(error.toString()).to.be.eq("TypeError: Cannot read property 'uuid' of undefined");
          |                                      ^
      155 |     });
      156 | 
      157 |     it('handle - throws error if the parameter is required, type file provided', async () => {

      at Object.<anonymous> (test/ActionParameterHandler.spec.ts:154:38)

FAIL test/functional/action-params.spec.ts
    ✕ encountered a declaration exception (2 ms)

  ●  › encountered a declaration exception

    TypeError: bind.call is not a function

      at Object.<anonymous> (../../../VariantsDeps/body-parser/variant9/body-parser/node_modules/has/src/index.js:5:23)
      at Object.<anonymous> (../../../VariantsDeps/body-parser/variant9/body-parser/node_modules/get-intrinsic/index.js:200:14)

PASS test/functional/controller-methods.spec.ts
    controller methods
      ✓ get should respond with proper status code, headers and body content (19 ms)
      ✓ post respond with proper status code, headers and body content (5 ms)
      ✓ put respond with proper status code, headers and body content (3 ms)
      ✓ patch respond with proper status code, headers and body content (2 ms)
      ✓ delete respond with proper status code, headers and body content (3 ms)
      ✓ head respond with proper status code, headers and body content (3 ms)
      ✓ custom method (post) respond with proper status code, headers and body content (3 ms)
      ✓ custom method (delete) respond with proper status code, headers and body content (2 ms)
      ✓ route should work with parameter (3 ms)
      ✓ route should work with regexp parameter (3 ms)
      ✓ should respond with 404 when regexp does not match (6 ms)
      ✓ route should work with string regexp parameter (3 ms)
      ✓ should respond with 404 when regexp does not match (2 ms)
      ✓ should return result from a promise (503 ms)
      ✓ should respond with 500 if promise failed (505 ms)
      ✓ should respond with 204 No Content when null returned in action (5 ms)
      ✓ should respond with 404 Not Found text when undefined returned in action (20 ms)
      ✓ should respond with 404 Not Found JSON when undefined returned in action (3 ms)
      ✓ should respond with 200 and text/html even in json controller's method (2 ms)
      ✓ should respond with 200 and text/plain even in json controller's method (2 ms)
      ✓ should respond with 401 and text/html when UnauthorizedError throwed even in json controller's method (13 ms)
      ✓ should respond with 401 and aplication/json when UnauthorizedError is thrown in standard json controller's method (2 ms)

PASS test/functional/json-controller-methods.spec.ts
    json-controller methods
      ✓ get should respond with proper status code, headers and body content (24 ms)
      ✓ post respond with proper status code, headers and body content (3 ms)
      ✓ put respond with proper status code, headers and body content (2 ms)
      ✓ patch respond with proper status code, headers and body content (3 ms)
      ✓ delete respond with proper status code, headers and body content (2 ms)
      ✓ head respond with proper status code, headers and body content (2 ms)
      ✓ custom method (post) respond with proper status code, headers and body content (2 ms)
      ✓ custom method (delete) respond with proper status code, headers and body content (2 ms)
      ✓ route should work with parameter (3 ms)
      ✓ route should work with regexp parameter (3 ms)
      ✓ should respond with 404 when regexp does not match (3 ms)
      ✓ route should work with string regexp parameter (3 ms)
      ✓ should respond with 404 when regexp does not match (2 ms)
      ✓ should return result from a promise (503 ms)
      ✓ should respond with 500 if promise failed (505 ms)

PASS test/functional/interceptors.spec.ts
    interceptor
      ✓ custom interceptor function should replace returned content (20 ms)
      ✓ custom interceptor class should replace returned content (3 ms)
      ✓ custom interceptor class used on the whole controller should replace returned content (2 ms)
      ✓ global interceptor class should replace returned content (3 ms)
      ✓ interceptors should support promises (1003 ms)

PASS test/functional/express-global-before-error-handling.spec.ts
    custom express global before middleware error handling
      ✓ should call global error handler middleware with CustomError (38 ms)

PASS test/functional/auth-decorator.spec.ts
    Controller responds with value when Authorization succeeds (async)
      ✓ without roles (63 ms)
      ✓ with roles (15 ms)
      ✓ async (25 ms)
    Controller responds with value when Authorization succeeds (sync)
      ✓ without roles (5 ms)
      ✓ with roles (5 ms)
      ✓ async (14 ms)
    Authorized Decorators Http Status Code
      ✓ without roles (17 ms)
      ✓ with roles (4 ms)
    Authorization checker allows to throw (async)
      ✓ custom errors (7 ms)
    Authorization checker allows to throw (sync)
      ✓ custom errors (5 ms)

PASS test/functional/other-controller-decorators.spec.ts
    other controller decorators
      ✓ should return httpCode set by @HttpCode decorator (11 ms)
      ✓ should return custom code when @OnNull (32 ms)
      ✓ should return custom error message and code when @OnUndefined is used with Error class (6 ms)
      ✓ should return custom code when @OnUndefined (10 ms)
      ✓ should return content-type in the response when @ContentType is used (2 ms)
      ✓ should return content-type in the response when @ContentType is used (3 ms)
      ✓ should return response with custom headers when @Header is used (4 ms)
      ✓ should relocate to new location when @Location is used (18 ms)

PASS test/functional/load-from-directory.spec.ts
    loading all controllers from the given directories
      ✓ should load all controllers (31 ms)
    loading all express middlewares and error handlers from the given directories
      ✓ should succeed (10 ms)
      ✓ should fail (16 ms)

PASS test/functional/global-options.spec.ts
    routing-controllers global options
      useClassTransformer default value
        ✓ useClassTransformer by default must be set to true (76 ms)
      when useClassTransformer is set to true
        ✓ useClassTransformer is enabled (3 ms)
      when useClassTransformer is set to false
        ✓ useClassTransformer is disabled (4 ms)
      when routePrefix is used all controller routes should be appended by it
        ✓ routePrefix is enabled (5 ms)

PASS test/functional/action-options.spec.ts
    ✓ should use controller options when action transform options are not set (60 ms)
    ✓ should override controller options with action transformRequest option (4 ms)
    ✓ should override controller options with action transformResponse option (3 ms)

PASS test/unit/controller-inheritance.spec.ts
  controller inheritance
    ✓ should build empty meta for empty set (10 ms)
    ✓ should build meta if the only derivative controller is given (2 ms)
    ✓ should build meta if the only autonomous controller is given
    ✓ should build meta both when autonomous and derivative controllers are given (1 ms)

PASS test/functional/container.spec.ts
    using typedi container should be possible
      ✓ typedi container (61 ms)
    using custom container should be possible
      ✓ custom container (6 ms)
    using custom container with fallback should be possible
      ✓ custom container with fallback (7 ms)
    using custom container with fallback and fallback on throw error should be possible
      ✓ custom container with fallback and fallback on throw error (7 ms)

PASS test/functional/redirect-decorator.spec.ts
    dynamic redirect
      ✓ using template (25 ms)
      ✓ using override (4 ms)
      ✓ using original (3 ms)

PASS test/functional/class-validator-options.spec.ts
    no options
      ✓ should not use any options if not set (53 ms)
    global options
      should merge local validation options with global validation options prioritizing local
        ✓ succeed (5 ms)
      should pass the valid param after validation
        ✓ succeed (4 ms)
        ✓ should contain param name on validation failed (14 ms)
    local options
      ✓ should apply local options (6 ms)

PASS test/functional/express-error-handling.spec.ts
    express error handling
      ✓ should not call global error handler middleware if there was no errors (20 ms)
      ✓ should call global error handler middleware (17 ms)
      ✓ should call global error handler middleware (4 ms)
      ✓ should call error handler middleware if used (2 ms)
      ✓ should not execute next middleware if soft error handled specifically and stopped error bubbling (3 ms)
      ✓ should process JsonErrors by their toJSON method if it exists (2 ms)

PASS test/functional/class-transformer-options.spec.ts
    should not use any options if not set
      ✓ technical wrapper (26 ms)
    should apply global options
      ✓ technical wrapper (4 ms)
    should apply local options
      ✓ technical wrapper (4 ms)

PASS test/functional/express-middlewares.spec.ts
    express middlewares
      ✓ should call a global middlewares (20 ms)
      ✓ should use a custom middleware when @UseBefore or @UseAfter is used (3 ms)
      ✓ should call middleware and call it before controller action when @UseBefore is used (2 ms)
      ✓ should call middleware and call it after controller action when @UseAfter is used (2 ms)
      ✓ should call before middleware and call after middleware when @UseAfter and @UseAfter are used (3 ms)
      ✓ should handle errors in custom middlewares (22 ms)

PASS test/functional/express-custom-error-handling.spec.ts
    custom express error handling
      ✓ should not call global error handler middleware if there was no errors (21 ms)
      ✓ should call global error handler middleware (18 ms)

PASS test/functional/controller-options.spec.ts
    controller options
      ✓ controller transform is enabled by default (32 ms)
      ✓ when controller transform is enabled (4 ms)
      ✓ when controller transform is disabled (4 ms)

PASS test/functional/defaults.spec.ts
    defaults
      ✓ should return undefinedResultCode from defaults config for void function (20 ms)
      ✓ should return undefinedResultCode from defaults config for promise void function (2 ms)
      ✓ should return 400 from required paramOptions (15 ms)
      ✓ should return nullResultCode from defaults config (3 ms)
      ✓ should return status code from OnUndefined annotation (2 ms)
      ✓ should mark arg optional from QueryParam annotation (4 ms)

PASS test/functional/render-decorator.spec.ts
    template rendering
      ✓ should render a template and use given variables (28 ms)
      ✓ should render a template with given variables and locals variables (4 ms)

PASS test/functional/controller-base-routes.spec.ts
    controller > base routes functionality
      ✓ get should respond with proper status code, headers and body content (59 ms)
      ✓ get should respond with proper status code, headers and body content (3 ms)
      ✓ get should respond with proper status code, headers and body content - 2nd pass (4 ms)
      ✓ wrong route should respond with 404 error (3 ms)
      ✓ wrong route should respond with 404 error (3 ms)
      ✓ wrong route should respond with 404 error (2 ms)

PASS test/functional/special-result-send.spec.ts
    special result value treatment
      ✓ should pipe stream to response (22 ms)
      ✓ should send raw binary data from Buffer (2 ms)
      ✓ should send raw binary data from UIntArray (2 ms)

PASS test/functional/middlewares-order.spec.ts
    loaded direct from array
      ✓ should call middlewares in order defined by items order (22 ms)
    specified by priority option
      ✓ should call middlewares in order defined by priority parameter of decorator (3 ms)

PASS test/functional/error-subclasses.spec.ts
  HttpError
    ✓ should be instance of HttpError and Error (4 ms)
  BadRequestError
    ✓ should be instance of BadRequestError, HttpError and Error (1 ms)

Summary of all failing tests
FAIL test/ActionParameterHandler.spec.ts
  ● ActionParameterHandler › negative › handle - throws error if the parameter is required

    Expected value   "TypeError: Cannot read property 'uuid' of undefined"
    Received:
      "TypeError: Cannot read properties of undefined (reading 'uuid')"

    Message:
      expected 'TypeError: Cannot read properties of undefined (reading \'uuid\')' to equal 'TypeError: Cannot read property \'uuid\' of undefined'

    Difference:

    - Expected
    + Received

    - TypeError: Cannot read property 'uuid' of undefined
    + TypeError: Cannot read properties of undefined (reading 'uuid')

      152 |       }
      153 | 
    > 154 |       expect(error.toString()).to.be.eq("TypeError: Cannot read property 'uuid' of undefined");
          |                                      ^
      155 |     });
      156 | 
      157 |     it('handle - throws error if the parameter is required, type file provided', async () => {

      at Object.<anonymous> (test/ActionParameterHandler.spec.ts:154:38)

FAIL test/functional/action-params.spec.ts
  ●  › encountered a declaration exception

    TypeError: bind.call is not a function

      at Object.<anonymous> (../../../VariantsDeps/body-parser/variant9/body-parser/node_modules/has/src/index.js:5:23)
      at Object.<anonymous> (../../../VariantsDeps/body-parser/variant9/body-parser/node_modules/get-intrinsic/index.js:200:14)


Test Suites: 2 failed, 24 passed, 26 total
Tests:       2 failed, 134 passed, 136 total
Snapshots:   0 total
Time:        12.189 s
Ran all test suites.
ts-jest[config] (WARN) The option `tsConfig` is deprecated and will be removed in ts-jest 27, use `tsconfig` instead
FAIL test/ActionParameterHandler.spec.ts
  ActionParameterHandler
    positive
      ✓ handle - should process string parameters (30 ms)
      ✓ handle - should process string parameters, returns empty if a given string is empty
      ✓ handle - should process number parameters (1 ms)
      ✓ handle - undefined on empty object provided
      ✓ handle - null provided (12 ms)
    negative
      ✕ handle - throws error if the parameter is required (7 ms)
      ✓ handle - throws error if the parameter is required, type file provided (1 ms)

  ● ActionParameterHandler › negative › handle - throws error if the parameter is required

    Expected value   "TypeError: Cannot read property 'uuid' of undefined"
    Received:
      "TypeError: Cannot read properties of undefined (reading 'uuid')"

    Message:
      expected 'TypeError: Cannot read properties of undefined (reading \'uuid\')' to equal 'TypeError: Cannot read property \'uuid\' of undefined'

    Difference:

    - Expected
    + Received

    - TypeError: Cannot read property 'uuid' of undefined
    + TypeError: Cannot read properties of undefined (reading 'uuid')

      152 |       }
      153 | 
    > 154 |       expect(error.toString()).to.be.eq("TypeError: Cannot read property 'uuid' of undefined");
          |                                      ^
      155 |     });
      156 | 
      157 |     it('handle - throws error if the parameter is required, type file provided', async () => {

      at Object.<anonymous> (test/ActionParameterHandler.spec.ts:154:38)

FAIL test/functional/action-params.spec.ts
    ✓ @Req and @Res should be provided as Request and Response objects (20 ms)
    ✓ @Res writing directly to the response should work (6 ms)
    ✓ @Param should give a param from route (3 ms)
    ✓ @Param multiple params should give a proper values from route (4 ms)
    ✓ @SessionParam without middleware (22 ms)
    ✓ @Session should return a value from session (11 ms)
    ✓ @Session(param) should allow to inject empty property (3 ms)
    ✓ @QueryParams should give a proper values from request's query parameters (9 ms)
    ✓ @QueryParams should give a proper values from request's query parameters and one multiple value (6 ms)
    ✓ @QueryParams should give a proper values from request's query with validate whitelist option on (3 ms)
    ✓ @QueryParams should give a proper values from request's query parameters with nested json (4 ms)
    ✓ @QueryParams should not validate request query parameters when it's turned off in validator options (3 ms)
    ✓ @QueryParams should give a proper values from request's optional query parameters (3 ms)
    ✓ @QueryParam should give a proper values from request query parameters (10 ms)
    ✓ @QueryParam should give an array of string with only one query parameter (3 ms)
    ✓ @QueryParam should give an array of string with multiple query parameters (2 ms)
    ✓ @QueryParam should give an array of number with only one query parameter (2 ms)
    ✓ @QueryParam should give an array of number with multiple query parameters (2 ms)
    ✓ @QueryParam should give an array of date with only one query parameter (2 ms)
    ✓ @QueryParam should give an array of date with multiple query parameters (2 ms)
    ✓ @QueryParam when required params must be provided and they should not be empty (8 ms)
    ✓ @QueryParam when the type is Date then it should be parsed (2 ms)
    ✓ @QueryParam when the type is Date and it is invalid then the response should be a BadRequest error (2 ms)
    ✓ @QueryParam when parseJson flag is used query param must be converted to object (2 ms)
    ✓ @HeaderParam should give a proper values from request headers (2 ms)
    ✓ @HeaderParam when required is params must be provided and they should not be empty (2 ms)
    ✓ @HeaderParam should fail with invalid request options (2 ms)
    ✓ @HeaderParam should fail with missing required params (2 ms)
    ✓ for @HeaderParam when parseJson flag is used query param must be converted to object (2 ms)
    ✓ @CookieParam should give a proper values from request headers (2 ms)
    ✓ @CookieParam when required is params must be provided and they should not be empty (4 ms)
    ✓ @CookieParam when parseJson flag is used query param must be converted to object (2 ms)
    ✓ @Body should provide a request body (12 ms)
    ✓ @Body should fail if required body was not provided (6 ms)
    ✓ @Body should provide a json object for json-typed controllers and actions (3 ms)
    ✓ @Body should fail if required body was not provided for json-typed controllers and actions (4 ms)
    ✓ @BodyParam should provide a json object for json-typed controllers and actions (2 ms)
    ✓ @BodyParam should fail if required body was not provided for json-typed controllers and actions (17 ms)
    ✕ @Body using application/x-www-form-urlencoded should handle url encoded form data (9 ms)
    ✓ @UploadedFile using multipart/form-data should provide uploaded file with the given name (12 ms)
    ✓ @UploadedFile with @Body should return both the file and the body (6 ms)
    ✓ @UploadedFile with @BodyParam should return both the file and the body param (4 ms)
    ✓ @UploadedFile with passed uploading options (limit) should throw an error (4 ms)
    ✓ @UploadedFile when required is used files must be provided (7 ms)
    ✓ @UploadedFiles should provide uploaded files with the given name (4 ms)
    ✓ @UploadedFiles with passed uploading options (limit) should throw an error (6 ms)
    ✓ @UploadedFiles when required is used files must be provided (4 ms)

  ●  › @Body using application/x-www-form-urlencoded should handle url encoded form data

    Request failed with status code 400

      at createError (node_modules/axios/lib/core/createError.js:16:15)
      at settle (node_modules/axios/lib/core/settle.js:17:12)
      at IncomingMessage.handleStreamEnd (node_modules/axios/lib/adapters/http.js:260:11)
      at IncomingMessage.emit (node:events:539:35)
      at endReadableNT (node:internal/streams/readable:1344:12)
      at processTicksAndRejections (node:internal/process/task_queues:82:21)

  ●  › @Body using application/x-www-form-urlencoded should handle url encoded form data

    expect.assertions(3)

    Expected three assertions to be called but received zero assertion calls.

      1005 | 
      1006 |   it('@Body using application/x-www-form-urlencoded should handle url encoded form data', async () => {
    > 1007 |     expect.assertions(3);
           |            ^
      1008 |     const response = await axios.post(
      1009 |       '/form-data-body',
      1010 |       qs.stringify({

      at Object.<anonymous> (test/functional/action-params.spec.ts:1007:12)
      at processTicksAndRejections (node:internal/process/task_queues:95:5)

PASS test/functional/controller-methods.spec.ts
    controller methods
      ✓ get should respond with proper status code, headers and body content (8 ms)
      ✓ post respond with proper status code, headers and body content (3 ms)
      ✓ put respond with proper status code, headers and body content (2 ms)
      ✓ patch respond with proper status code, headers and body content (3 ms)
      ✓ delete respond with proper status code, headers and body content (2 ms)
      ✓ head respond with proper status code, headers and body content (2 ms)
      ✓ custom method (post) respond with proper status code, headers and body content (2 ms)
      ✓ custom method (delete) respond with proper status code, headers and body content (2 ms)
      ✓ route should work with parameter (3 ms)
      ✓ route should work with regexp parameter (2 ms)
      ✓ should respond with 404 when regexp does not match (7 ms)
      ✓ route should work with string regexp parameter (2 ms)
      ✓ should respond with 404 when regexp does not match (1 ms)
      ✓ should return result from a promise (504 ms)
      ✓ should respond with 500 if promise failed (503 ms)
      ✓ should respond with 204 No Content when null returned in action (14 ms)
      ✓ should respond with 404 Not Found text when undefined returned in action (20 ms)
      ✓ should respond with 404 Not Found JSON when undefined returned in action (2 ms)
      ✓ should respond with 200 and text/html even in json controller's method (2 ms)
      ✓ should respond with 200 and text/plain even in json controller's method (2 ms)
      ✓ should respond with 401 and text/html when UnauthorizedError throwed even in json controller's method (4 ms)
      ✓ should respond with 401 and aplication/json when UnauthorizedError is thrown in standard json controller's method (4 ms)

PASS test/functional/json-controller-methods.spec.ts
    json-controller methods
      ✓ get should respond with proper status code, headers and body content (10 ms)
      ✓ post respond with proper status code, headers and body content (2 ms)
      ✓ put respond with proper status code, headers and body content (2 ms)
      ✓ patch respond with proper status code, headers and body content (3 ms)
      ✓ delete respond with proper status code, headers and body content (2 ms)
      ✓ head respond with proper status code, headers and body content (2 ms)
      ✓ custom method (post) respond with proper status code, headers and body content (2 ms)
      ✓ custom method (delete) respond with proper status code, headers and body content (2 ms)
      ✓ route should work with parameter (3 ms)
      ✓ route should work with regexp parameter (2 ms)
      ✓ should respond with 404 when regexp does not match (7 ms)
      ✓ route should work with string regexp parameter (2 ms)
      ✓ should respond with 404 when regexp does not match (2 ms)
      ✓ should return result from a promise (503 ms)
      ✓ should respond with 500 if promise failed (504 ms)

PASS test/functional/interceptors.spec.ts
    interceptor
      ✓ custom interceptor function should replace returned content (9 ms)
      ✓ custom interceptor class should replace returned content (2 ms)
      ✓ custom interceptor class used on the whole controller should replace returned content (2 ms)
      ✓ global interceptor class should replace returned content (3 ms)
      ✓ interceptors should support promises (1003 ms)

PASS test/functional/express-error-handling.spec.ts
    express error handling
      ✓ should not call global error handler middleware if there was no errors (20 ms)
      ✓ should call global error handler middleware (18 ms)
      ✓ should call global error handler middleware (5 ms)
      ✓ should call error handler middleware if used (2 ms)
      ✓ should not execute next middleware if soft error handled specifically and stopped error bubbling (3 ms)
      ✓ should process JsonErrors by their toJSON method if it exists (2 ms)

PASS test/functional/container.spec.ts
    using typedi container should be possible
      ✓ typedi container (56 ms)
    using custom container should be possible
      ✓ custom container (5 ms)
    using custom container with fallback should be possible
      ✓ custom container with fallback (7 ms)
    using custom container with fallback and fallback on throw error should be possible
      ✓ custom container with fallback and fallback on throw error (7 ms)

PASS test/functional/auth-decorator.spec.ts
    Controller responds with value when Authorization succeeds (async)
      ✓ without roles (65 ms)
      ✓ with roles (14 ms)
      ✓ async (27 ms)
    Controller responds with value when Authorization succeeds (sync)
      ✓ without roles (5 ms)
      ✓ with roles (5 ms)
      ✓ async (14 ms)
    Authorized Decorators Http Status Code
      ✓ without roles (15 ms)
      ✓ with roles (12 ms)
    Authorization checker allows to throw (async)
      ✓ custom errors (6 ms)
    Authorization checker allows to throw (sync)
      ✓ custom errors (5 ms)

PASS test/functional/other-controller-decorators.spec.ts
    other controller decorators
      ✓ should return httpCode set by @HttpCode decorator (11 ms)
      ✓ should return custom code when @OnNull (28 ms)
      ✓ should return custom error message and code when @OnUndefined is used with Error class (7 ms)
      ✓ should return custom code when @OnUndefined (23 ms)
      ✓ should return content-type in the response when @ContentType is used (3 ms)
      ✓ should return content-type in the response when @ContentType is used (17 ms)
      ✓ should return response with custom headers when @Header is used (3 ms)
      ✓ should relocate to new location when @Location is used (3 ms)

PASS test/functional/load-from-directory.spec.ts
    loading all controllers from the given directories
      ✓ should load all controllers (32 ms)
    loading all express middlewares and error handlers from the given directories
      ✓ should succeed (12 ms)
      ✓ should fail (16 ms)

PASS test/functional/action-options.spec.ts
    ✓ should use controller options when action transform options are not set (189 ms)
    ✓ should override controller options with action transformRequest option (5 ms)
    ✓ should override controller options with action transformResponse option (3 ms)

PASS test/functional/defaults.spec.ts
    defaults
      ✓ should return undefinedResultCode from defaults config for void function (8 ms)
      ✓ should return undefinedResultCode from defaults config for promise void function (2 ms)
      ✓ should return 400 from required paramOptions (17 ms)
      ✓ should return nullResultCode from defaults config (3 ms)
      ✓ should return status code from OnUndefined annotation (3 ms)
      ✓ should mark arg optional from QueryParam annotation (21 ms)

PASS test/functional/class-validator-options.spec.ts
    no options
      ✓ should not use any options if not set (41 ms)
    global options
      should merge local validation options with global validation options prioritizing local
        ✓ succeed (16 ms)
      should pass the valid param after validation
        ✓ succeed (4 ms)
        ✓ should contain param name on validation failed (16 ms)
    local options
      ✓ should apply local options (4 ms)

PASS test/unit/controller-inheritance.spec.ts
  controller inheritance
    ✓ should build empty meta for empty set (16 ms)
    ✓ should build meta if the only derivative controller is given (3 ms)
    ✓ should build meta if the only autonomous controller is given (1 ms)
    ✓ should build meta both when autonomous and derivative controllers are given (1 ms)

PASS test/functional/redirect-decorator.spec.ts
    dynamic redirect
      ✓ using template (25 ms)
      ✓ using override (4 ms)
      ✓ using original (3 ms)

PASS test/functional/global-options.spec.ts
    routing-controllers global options
      useClassTransformer default value
        ✓ useClassTransformer by default must be set to true (70 ms)
      when useClassTransformer is set to true
        ✓ useClassTransformer is enabled (4 ms)
      when useClassTransformer is set to false
        ✓ useClassTransformer is disabled (3 ms)
      when routePrefix is used all controller routes should be appended by it
        ✓ routePrefix is enabled (6 ms)

PASS test/functional/express-middlewares.spec.ts
    express middlewares
      ✓ should call a global middlewares (22 ms)
      ✓ should use a custom middleware when @UseBefore or @UseAfter is used (2 ms)
      ✓ should call middleware and call it before controller action when @UseBefore is used (2 ms)
      ✓ should call middleware and call it after controller action when @UseAfter is used (2 ms)
      ✓ should call before middleware and call after middleware when @UseAfter and @UseAfter are used (2 ms)
      ✓ should handle errors in custom middlewares (21 ms)

PASS test/functional/controller-options.spec.ts
    controller options
      ✓ controller transform is enabled by default (32 ms)
      ✓ when controller transform is enabled (5 ms)
      ✓ when controller transform is disabled (5 ms)

PASS test/functional/controller-base-routes.spec.ts
    controller > base routes functionality
      ✓ get should respond with proper status code, headers and body content (52 ms)
      ✓ get should respond with proper status code, headers and body content (3 ms)
      ✓ get should respond with proper status code, headers and body content - 2nd pass (3 ms)
      ✓ wrong route should respond with 404 error (3 ms)
      ✓ wrong route should respond with 404 error (3 ms)
      ✓ wrong route should respond with 404 error (2 ms)

PASS test/functional/render-decorator.spec.ts
    template rendering
      ✓ should render a template and use given variables (27 ms)
      ✓ should render a template with given variables and locals variables (4 ms)

PASS test/functional/express-global-before-error-handling.spec.ts
    custom express global before middleware error handling
      ✓ should call global error handler middleware with CustomError (36 ms)

PASS test/functional/express-custom-error-handling.spec.ts
    custom express error handling
      ✓ should not call global error handler middleware if there was no errors (22 ms)
      ✓ should call global error handler middleware (17 ms)

PASS test/functional/middlewares-order.spec.ts
    loaded direct from array
      ✓ should call middlewares in order defined by items order (22 ms)
    specified by priority option
      ✓ should call middlewares in order defined by priority parameter of decorator (3 ms)

PASS test/functional/class-transformer-options.spec.ts
    should not use any options if not set
      ✓ technical wrapper (27 ms)
    should apply global options
      ✓ technical wrapper (4 ms)
    should apply local options
      ✓ technical wrapper (6 ms)

PASS test/functional/special-result-send.spec.ts
    special result value treatment
      ✓ should pipe stream to response (21 ms)
      ✓ should send raw binary data from Buffer (3 ms)
      ✓ should send raw binary data from UIntArray (2 ms)

PASS test/functional/error-subclasses.spec.ts
  HttpError
    ✓ should be instance of HttpError and Error (3 ms)
  BadRequestError
    ✓ should be instance of BadRequestError, HttpError and Error (1 ms)

Summary of all failing tests
FAIL test/ActionParameterHandler.spec.ts
  ● ActionParameterHandler › negative › handle - throws error if the parameter is required

    Expected value   "TypeError: Cannot read property 'uuid' of undefined"
    Received:
      "TypeError: Cannot read properties of undefined (reading 'uuid')"

    Message:
      expected 'TypeError: Cannot read properties of undefined (reading \'uuid\')' to equal 'TypeError: Cannot read property \'uuid\' of undefined'

    Difference:

    - Expected
    + Received

    - TypeError: Cannot read property 'uuid' of undefined
    + TypeError: Cannot read properties of undefined (reading 'uuid')

      152 |       }
      153 | 
    > 154 |       expect(error.toString()).to.be.eq("TypeError: Cannot read property 'uuid' of undefined");
          |                                      ^
      155 |     });
      156 | 
      157 |     it('handle - throws error if the parameter is required, type file provided', async () => {

      at Object.<anonymous> (test/ActionParameterHandler.spec.ts:154:38)

FAIL test/functional/action-params.spec.ts
  ●  › @Body using application/x-www-form-urlencoded should handle url encoded form data

    Request failed with status code 400

      at createError (node_modules/axios/lib/core/createError.js:16:15)
      at settle (node_modules/axios/lib/core/settle.js:17:12)
      at IncomingMessage.handleStreamEnd (node_modules/axios/lib/adapters/http.js:260:11)
      at IncomingMessage.emit (node:events:539:35)
      at endReadableNT (node:internal/streams/readable:1344:12)
      at processTicksAndRejections (node:internal/process/task_queues:82:21)

  ●  › @Body using application/x-www-form-urlencoded should handle url encoded form data

    expect.assertions(3)

    Expected three assertions to be called but received zero assertion calls.

      1005 | 
      1006 |   it('@Body using application/x-www-form-urlencoded should handle url encoded form data', async () => {
    > 1007 |     expect.assertions(3);
           |            ^
      1008 |     const response = await axios.post(
      1009 |       '/form-data-body',
      1010 |       qs.stringify({

      at Object.<anonymous> (test/functional/action-params.spec.ts:1007:12)
      at processTicksAndRejections (node:internal/process/task_queues:95:5)


Test Suites: 2 failed, 24 passed, 26 total
Tests:       2 failed, 180 passed, 182 total
Snapshots:   0 total
Time:        12.467 s, estimated 13 s
Ran all test suites.
ts-jest[config] (WARN) The option `tsConfig` is deprecated and will be removed in ts-jest 27, use `tsconfig` instead
FAIL test/ActionParameterHandler.spec.ts
  ActionParameterHandler
    positive
      ✓ handle - should process string parameters (30 ms)
      ✓ handle - should process string parameters, returns empty if a given string is empty (1 ms)
      ✓ handle - should process number parameters
      ✓ handle - undefined on empty object provided (1 ms)
      ✓ handle - null provided (13 ms)
    negative
      ✕ handle - throws error if the parameter is required (7 ms)
      ✓ handle - throws error if the parameter is required, type file provided (1 ms)

  ● ActionParameterHandler › negative › handle - throws error if the parameter is required

    Expected value   "TypeError: Cannot read property 'uuid' of undefined"
    Received:
      "TypeError: Cannot read properties of undefined (reading 'uuid')"

    Message:
      expected 'TypeError: Cannot read properties of undefined (reading \'uuid\')' to equal 'TypeError: Cannot read property \'uuid\' of undefined'

    Difference:

    - Expected
    + Received

    - TypeError: Cannot read property 'uuid' of undefined
    + TypeError: Cannot read properties of undefined (reading 'uuid')

      152 |       }
      153 | 
    > 154 |       expect(error.toString()).to.be.eq("TypeError: Cannot read property 'uuid' of undefined");
          |                                      ^
      155 |     });
      156 | 
      157 |     it('handle - throws error if the parameter is required, type file provided', async () => {

      at Object.<anonymous> (test/ActionParameterHandler.spec.ts:154:38)

PASS test/functional/action-params.spec.ts
    ✓ @Req and @Res should be provided as Request and Response objects (21 ms)
    ✓ @Res writing directly to the response should work (5 ms)
    ✓ @Param should give a param from route (4 ms)
    ✓ @Param multiple params should give a proper values from route (3 ms)
    ✓ @SessionParam without middleware (26 ms)
    ✓ @Session should return a value from session (9 ms)
    ✓ @Session(param) should allow to inject empty property (4 ms)
    ✓ @QueryParams should give a proper values from request's query parameters (9 ms)
    ✓ @QueryParams should give a proper values from request's query parameters and one multiple value (6 ms)
    ✓ @QueryParams should give a proper values from request's query with validate whitelist option on (4 ms)
    ✓ @QueryParams should give a proper values from request's query parameters with nested json (4 ms)
    ✓ @QueryParams should not validate request query parameters when it's turned off in validator options (11 ms)
    ✓ @QueryParams should give a proper values from request's optional query parameters (3 ms)
    ✓ @QueryParam should give a proper values from request query parameters (3 ms)
    ✓ @QueryParam should give an array of string with only one query parameter (2 ms)
    ✓ @QueryParam should give an array of string with multiple query parameters (2 ms)
    ✓ @QueryParam should give an array of number with only one query parameter (2 ms)
    ✓ @QueryParam should give an array of number with multiple query parameters (3 ms)
    ✓ @QueryParam should give an array of date with only one query parameter (2 ms)
    ✓ @QueryParam should give an array of date with multiple query parameters (2 ms)
    ✓ @QueryParam when required params must be provided and they should not be empty (7 ms)
    ✓ @QueryParam when the type is Date then it should be parsed (2 ms)
    ✓ @QueryParam when the type is Date and it is invalid then the response should be a BadRequest error (2 ms)
    ✓ @QueryParam when parseJson flag is used query param must be converted to object (2 ms)
    ✓ @HeaderParam should give a proper values from request headers (2 ms)
    ✓ @HeaderParam when required is params must be provided and they should not be empty (2 ms)
    ✓ @HeaderParam should fail with invalid request options (2 ms)
    ✓ @HeaderParam should fail with missing required params (2 ms)
    ✓ for @HeaderParam when parseJson flag is used query param must be converted to object (2 ms)
    ✓ @CookieParam should give a proper values from request headers (2 ms)
    ✓ @CookieParam when required is params must be provided and they should not be empty (4 ms)
    ✓ @CookieParam when parseJson flag is used query param must be converted to object (2 ms)
    ✓ @Body should provide a request body (12 ms)
    ✓ @Body should fail if required body was not provided (6 ms)
    ✓ @Body should provide a json object for json-typed controllers and actions (3 ms)
    ✓ @Body should fail if required body was not provided for json-typed controllers and actions (4 ms)
    ✓ @BodyParam should provide a json object for json-typed controllers and actions (2 ms)
    ✓ @BodyParam should fail if required body was not provided for json-typed controllers and actions (22 ms)
    ✓ @Body using application/x-www-form-urlencoded should handle url encoded form data (4 ms)
    ✓ @UploadedFile using multipart/form-data should provide uploaded file with the given name (12 ms)
    ✓ @UploadedFile with @Body should return both the file and the body (6 ms)
    ✓ @UploadedFile with @BodyParam should return both the file and the body param (4 ms)
    ✓ @UploadedFile with passed uploading options (limit) should throw an error (5 ms)
    ✓ @UploadedFile when required is used files must be provided (6 ms)
    ✓ @UploadedFiles should provide uploaded files with the given name (5 ms)
    ✓ @UploadedFiles with passed uploading options (limit) should throw an error (5 ms)
    ✓ @UploadedFiles when required is used files must be provided (4 ms)

PASS test/functional/controller-methods.spec.ts
    controller methods
      ✓ get should respond with proper status code, headers and body content (9 ms)
      ✓ post respond with proper status code, headers and body content (3 ms)
      ✓ put respond with proper status code, headers and body content (3 ms)
      ✓ patch respond with proper status code, headers and body content (2 ms)
      ✓ delete respond with proper status code, headers and body content (2 ms)
      ✓ head respond with proper status code, headers and body content (2 ms)
      ✓ custom method (post) respond with proper status code, headers and body content (2 ms)
      ✓ custom method (delete) respond with proper status code, headers and body content (2 ms)
      ✓ route should work with parameter (4 ms)
      ✓ route should work with regexp parameter (2 ms)
      ✓ should respond with 404 when regexp does not match (4 ms)
      ✓ route should work with string regexp parameter (3 ms)
      ✓ should respond with 404 when regexp does not match (12 ms)
      ✓ should return result from a promise (502 ms)
      ✓ should respond with 500 if promise failed (504 ms)
      ✓ should respond with 204 No Content when null returned in action (5 ms)
      ✓ should respond with 404 Not Found text when undefined returned in action (21 ms)
      ✓ should respond with 404 Not Found JSON when undefined returned in action (3 ms)
      ✓ should respond with 200 and text/html even in json controller's method (3 ms)
      ✓ should respond with 200 and text/plain even in json controller's method (2 ms)
      ✓ should respond with 401 and text/html when UnauthorizedError throwed even in json controller's method (5 ms)
      ✓ should respond with 401 and aplication/json when UnauthorizedError is thrown in standard json controller's method (3 ms)

PASS test/functional/json-controller-methods.spec.ts
    json-controller methods
      ✓ get should respond with proper status code, headers and body content (10 ms)
      ✓ post respond with proper status code, headers and body content (3 ms)
      ✓ put respond with proper status code, headers and body content (2 ms)
      ✓ patch respond with proper status code, headers and body content (2 ms)
      ✓ delete respond with proper status code, headers and body content (2 ms)
      ✓ head respond with proper status code, headers and body content (3 ms)
      ✓ custom method (post) respond with proper status code, headers and body content (2 ms)
      ✓ custom method (delete) respond with proper status code, headers and body content (2 ms)
      ✓ route should work with parameter (3 ms)
      ✓ route should work with regexp parameter (2 ms)
      ✓ should respond with 404 when regexp does not match (4 ms)
      ✓ route should work with string regexp parameter (3 ms)
      ✓ should respond with 404 when regexp does not match (2 ms)
      ✓ should return result from a promise (503 ms)
      ✓ should respond with 500 if promise failed (503 ms)

PASS test/functional/interceptors.spec.ts
    interceptor
      ✓ custom interceptor function should replace returned content (8 ms)
      ✓ custom interceptor class should replace returned content (3 ms)
      ✓ custom interceptor class used on the whole controller should replace returned content (2 ms)
      ✓ global interceptor class should replace returned content (2 ms)
      ✓ interceptors should support promises (1003 ms)

PASS test/functional/action-options.spec.ts
    ✓ should use controller options when action transform options are not set (67 ms)
    ✓ should override controller options with action transformRequest option (5 ms)
    ✓ should override controller options with action transformResponse option (2 ms)

PASS test/functional/auth-decorator.spec.ts
    Controller responds with value when Authorization succeeds (async)
      ✓ without roles (51 ms)
      ✓ with roles (14 ms)
      ✓ async (23 ms)
    Controller responds with value when Authorization succeeds (sync)
      ✓ without roles (4 ms)
      ✓ with roles (3 ms)
      ✓ async (14 ms)
    Authorized Decorators Http Status Code
      ✓ without roles (34 ms)
      ✓ with roles (3 ms)
    Authorization checker allows to throw (async)
      ✓ custom errors (4 ms)
    Authorization checker allows to throw (sync)
      ✓ custom errors (3 ms)

PASS test/functional/other-controller-decorators.spec.ts
    other controller decorators
      ✓ should return httpCode set by @HttpCode decorator (26 ms)
      ✓ should return custom code when @OnNull (31 ms)
      ✓ should return custom error message and code when @OnUndefined is used with Error class (7 ms)
      ✓ should return custom code when @OnUndefined (10 ms)
      ✓ should return content-type in the response when @ContentType is used (1 ms)
      ✓ should return content-type in the response when @ContentType is used (3 ms)
      ✓ should return response with custom headers when @Header is used (3 ms)
      ✓ should relocate to new location when @Location is used (2 ms)

PASS test/functional/load-from-directory.spec.ts
    loading all controllers from the given directories
      ✓ should load all controllers (17 ms)
    loading all express middlewares and error handlers from the given directories
      ✓ should succeed (8 ms)
      ✓ should fail (15 ms)

PASS test/unit/controller-inheritance.spec.ts
  controller inheritance
    ✓ should build empty meta for empty set (10 ms)
    ✓ should build meta if the only derivative controller is given (2 ms)
    ✓ should build meta if the only autonomous controller is given
    ✓ should build meta both when autonomous and derivative controllers are given (1 ms)

PASS test/functional/defaults.spec.ts
    defaults
      ✓ should return undefinedResultCode from defaults config for void function (18 ms)
      ✓ should return undefinedResultCode from defaults config for promise void function (12 ms)
      ✓ should return 400 from required paramOptions (39 ms)
      ✓ should return nullResultCode from defaults config (4 ms)
      ✓ should return status code from OnUndefined annotation (29 ms)
      ✓ should mark arg optional from QueryParam annotation (15 ms)

PASS test/functional/express-custom-error-handling.spec.ts
    custom express error handling
      ✓ should not call global error handler middleware if there was no errors (10 ms)
      ✓ should call global error handler middleware (30 ms)

PASS test/functional/express-error-handling.spec.ts
    express error handling
      ✓ should not call global error handler middleware if there was no errors (19 ms)
      ✓ should call global error handler middleware (16 ms)
      ✓ should call global error handler middleware (5 ms)
      ✓ should call error handler middleware if used (3 ms)
      ✓ should not execute next middleware if soft error handled specifically and stopped error bubbling (2 ms)
      ✓ should process JsonErrors by their toJSON method if it exists (3 ms)

PASS test/functional/container.spec.ts
    using typedi container should be possible
      ✓ typedi container (53 ms)
    using custom container should be possible
      ✓ custom container (5 ms)
    using custom container with fallback should be possible
      ✓ custom container with fallback (7 ms)
    using custom container with fallback and fallback on throw error should be possible
      ✓ custom container with fallback and fallback on throw error (7 ms)

PASS test/functional/express-middlewares.spec.ts
    express middlewares
      ✓ should call a global middlewares (29 ms)
      ✓ should use a custom middleware when @UseBefore or @UseAfter is used (6 ms)
      ✓ should call middleware and call it before controller action when @UseBefore is used (2 ms)
      ✓ should call middleware and call it after controller action when @UseAfter is used (3 ms)
      ✓ should call before middleware and call after middleware when @UseAfter and @UseAfter are used (2 ms)
      ✓ should handle errors in custom middlewares (21 ms)

PASS test/functional/class-validator-options.spec.ts
    no options
      ✓ should not use any options if not set (51 ms)
    global options
      should merge local validation options with global validation options prioritizing local
        ✓ succeed (5 ms)
      should pass the valid param after validation
        ✓ succeed (4 ms)
        ✓ should contain param name on validation failed (15 ms)
    local options
      ✓ should apply local options (6 ms)

PASS test/functional/controller-options.spec.ts
    controller options
      ✓ controller transform is enabled by default (30 ms)
      ✓ when controller transform is enabled (4 ms)
      ✓ when controller transform is disabled (3 ms)

PASS test/functional/class-transformer-options.spec.ts
    should not use any options if not set
      ✓ technical wrapper (27 ms)
    should apply global options
      ✓ technical wrapper (5 ms)
    should apply local options
      ✓ technical wrapper (6 ms)

PASS test/functional/global-options.spec.ts
    routing-controllers global options
      useClassTransformer default value
        ✓ useClassTransformer by default must be set to true (69 ms)
      when useClassTransformer is set to true
        ✓ useClassTransformer is enabled (4 ms)
      when useClassTransformer is set to false
        ✓ useClassTransformer is disabled (3 ms)
      when routePrefix is used all controller routes should be appended by it
        ✓ routePrefix is enabled (6 ms)

PASS test/functional/render-decorator.spec.ts
    template rendering
      ✓ should render a template and use given variables (25 ms)
      ✓ should render a template with given variables and locals variables (4 ms)

PASS test/functional/controller-base-routes.spec.ts
    controller > base routes functionality
      ✓ get should respond with proper status code, headers and body content (53 ms)
      ✓ get should respond with proper status code, headers and body content (3 ms)
      ✓ get should respond with proper status code, headers and body content - 2nd pass (4 ms)
      ✓ wrong route should respond with 404 error (3 ms)
      ✓ wrong route should respond with 404 error (3 ms)
      ✓ wrong route should respond with 404 error (2 ms)

PASS test/functional/express-global-before-error-handling.spec.ts
    custom express global before middleware error handling
      ✓ should call global error handler middleware with CustomError (35 ms)

PASS test/functional/special-result-send.spec.ts
    special result value treatment
      ✓ should pipe stream to response (20 ms)
      ✓ should send raw binary data from Buffer (2 ms)
      ✓ should send raw binary data from UIntArray (2 ms)

PASS test/functional/middlewares-order.spec.ts
    loaded direct from array
      ✓ should call middlewares in order defined by items order (8 ms)
    specified by priority option
      ✓ should call middlewares in order defined by priority parameter of decorator (3 ms)

PASS test/functional/redirect-decorator.spec.ts
    dynamic redirect
      ✓ using template (14 ms)
      ✓ using override (5 ms)
      ✓ using original (4 ms)

PASS test/functional/error-subclasses.spec.ts
  HttpError
    ✓ should be instance of HttpError and Error (3 ms)
  BadRequestError
    ✓ should be instance of BadRequestError, HttpError and Error (2 ms)

Summary of all failing tests
FAIL test/ActionParameterHandler.spec.ts
  ● ActionParameterHandler › negative › handle - throws error if the parameter is required

    Expected value   "TypeError: Cannot read property 'uuid' of undefined"
    Received:
      "TypeError: Cannot read properties of undefined (reading 'uuid')"

    Message:
      expected 'TypeError: Cannot read properties of undefined (reading \'uuid\')' to equal 'TypeError: Cannot read property \'uuid\' of undefined'

    Difference:

    - Expected
    + Received

    - TypeError: Cannot read property 'uuid' of undefined
    + TypeError: Cannot read properties of undefined (reading 'uuid')

      152 |       }
      153 | 
    > 154 |       expect(error.toString()).to.be.eq("TypeError: Cannot read property 'uuid' of undefined");
          |                                      ^
      155 |     });
      156 | 
      157 |     it('handle - throws error if the parameter is required, type file provided', async () => {

      at Object.<anonymous> (test/ActionParameterHandler.spec.ts:154:38)


Test Suites: 1 failed, 25 passed, 26 total
Tests:       1 failed, 181 passed, 182 total
Snapshots:   0 total
Time:        12.514 s, estimated 13 s
Ran all test suites.
ts-jest[config] (WARN) The option `tsConfig` is deprecated and will be removed in ts-jest 27, use `tsconfig` instead
FAIL test/ActionParameterHandler.spec.ts
  ActionParameterHandler
    positive
      ✓ handle - should process string parameters (30 ms)
      ✓ handle - should process string parameters, returns empty if a given string is empty
      ✓ handle - should process number parameters (1 ms)
      ✓ handle - undefined on empty object provided
      ✓ handle - null provided (12 ms)
    negative
      ✕ handle - throws error if the parameter is required (6 ms)
      ✓ handle - throws error if the parameter is required, type file provided

  ● ActionParameterHandler › negative › handle - throws error if the parameter is required

    Expected value   "TypeError: Cannot read property 'uuid' of undefined"
    Received:
      "TypeError: Cannot read properties of undefined (reading 'uuid')"

    Message:
      expected 'TypeError: Cannot read properties of undefined (reading \'uuid\')' to equal 'TypeError: Cannot read property \'uuid\' of undefined'

    Difference:

    - Expected
    + Received

    - TypeError: Cannot read property 'uuid' of undefined
    + TypeError: Cannot read properties of undefined (reading 'uuid')

      152 |       }
      153 | 
    > 154 |       expect(error.toString()).to.be.eq("TypeError: Cannot read property 'uuid' of undefined");
          |                                      ^
      155 |     });
      156 | 
      157 |     it('handle - throws error if the parameter is required, type file provided', async () => {

      at Object.<anonymous> (test/ActionParameterHandler.spec.ts:154:38)

PASS test/functional/controller-methods.spec.ts
    controller methods
      ✓ get should respond with proper status code, headers and body content (19 ms)
      ✓ post respond with proper status code, headers and body content (5 ms)
      ✓ put respond with proper status code, headers and body content (2 ms)
      ✓ patch respond with proper status code, headers and body content (2 ms)
      ✓ delete respond with proper status code, headers and body content (3 ms)
      ✓ head respond with proper status code, headers and body content (3 ms)
      ✓ custom method (post) respond with proper status code, headers and body content (3 ms)
      ✓ custom method (delete) respond with proper status code, headers and body content (2 ms)
      ✓ route should work with parameter (3 ms)
      ✓ route should work with regexp parameter (3 ms)
      ✓ should respond with 404 when regexp does not match (4 ms)
      ✓ route should work with string regexp parameter (3 ms)
      ✓ should respond with 404 when regexp does not match (2 ms)
      ✓ should return result from a promise (504 ms)
      ✓ should respond with 500 if promise failed (504 ms)
      ✓ should respond with 204 No Content when null returned in action (14 ms)
      ✓ should respond with 404 Not Found text when undefined returned in action (20 ms)
      ✓ should respond with 404 Not Found JSON when undefined returned in action (2 ms)
      ✓ should respond with 200 and text/html even in json controller's method (2 ms)
      ✓ should respond with 200 and text/plain even in json controller's method (2 ms)
      ✓ should respond with 401 and text/html when UnauthorizedError throwed even in json controller's method (4 ms)
      ✓ should respond with 401 and aplication/json when UnauthorizedError is thrown in standard json controller's method (3 ms)

PASS test/functional/json-controller-methods.spec.ts
    json-controller methods
      ✓ get should respond with proper status code, headers and body content (9 ms)
      ✓ post respond with proper status code, headers and body content (3 ms)
      ✓ put respond with proper status code, headers and body content (2 ms)
      ✓ patch respond with proper status code, headers and body content (2 ms)
      ✓ delete respond with proper status code, headers and body content (3 ms)
      ✓ head respond with proper status code, headers and body content (2 ms)
      ✓ custom method (post) respond with proper status code, headers and body content (2 ms)
      ✓ custom method (delete) respond with proper status code, headers and body content (2 ms)
      ✓ route should work with parameter (3 ms)
      ✓ route should work with regexp parameter (3 ms)
      ✓ should respond with 404 when regexp does not match (3 ms)
      ✓ route should work with string regexp parameter (3 ms)
      ✓ should respond with 404 when regexp does not match (2 ms)
      ✓ should return result from a promise (504 ms)
      ✓ should respond with 500 if promise failed (503 ms)

PASS test/functional/interceptors.spec.ts
    interceptor
      ✓ custom interceptor function should replace returned content (9 ms)
      ✓ custom interceptor class should replace returned content (2 ms)
      ✓ custom interceptor class used on the whole controller should replace returned content (2 ms)
      ✓ global interceptor class should replace returned content (2 ms)
      ✓ interceptors should support promises (1004 ms)

FAIL test/functional/action-params.spec.ts
    ✓ @Req and @Res should be provided as Request and Response objects (10 ms)
    ✓ @Res writing directly to the response should work (4 ms)
    ✓ @Param should give a param from route (3 ms)
    ✓ @Param multiple params should give a proper values from route (2 ms)
    ✓ @SessionParam without middleware (22 ms)
    ✓ @Session should return a value from session (10 ms)
    ✓ @Session(param) should allow to inject empty property (2 ms)
    ✓ @QueryParams should give a proper values from request's query parameters (9 ms)
    ✓ @QueryParams should give a proper values from request's query parameters and one multiple value (5 ms)
    ✓ @QueryParams should give a proper values from request's query with validate whitelist option on (13 ms)
    ✓ @QueryParams should give a proper values from request's query parameters with nested json (4 ms)
    ✓ @QueryParams should not validate request query parameters when it's turned off in validator options (2 ms)
    ✓ @QueryParams should give a proper values from request's optional query parameters (3 ms)
    ✓ @QueryParam should give a proper values from request query parameters (2 ms)
    ✓ @QueryParam should give an array of string with only one query parameter (2 ms)
    ✓ @QueryParam should give an array of string with multiple query parameters (3 ms)
    ✓ @QueryParam should give an array of number with only one query parameter (2 ms)
    ✓ @QueryParam should give an array of number with multiple query parameters (2 ms)
    ✓ @QueryParam should give an array of date with only one query parameter (2 ms)
    ✓ @QueryParam should give an array of date with multiple query parameters (2 ms)
    ✓ @QueryParam when required params must be provided and they should not be empty (7 ms)
    ✓ @QueryParam when the type is Date then it should be parsed (2 ms)
    ✓ @QueryParam when the type is Date and it is invalid then the response should be a BadRequest error (2 ms)
    ✓ @QueryParam when parseJson flag is used query param must be converted to object (2 ms)
    ✓ @HeaderParam should give a proper values from request headers (2 ms)
    ✓ @HeaderParam when required is params must be provided and they should not be empty (2 ms)
    ✓ @HeaderParam should fail with invalid request options (3 ms)
    ✓ @HeaderParam should fail with missing required params (3 ms)
    ✓ for @HeaderParam when parseJson flag is used query param must be converted to object (2 ms)
    ✓ @CookieParam should give a proper values from request headers (3 ms)
    ✓ @CookieParam when required is params must be provided and they should not be empty (3 ms)
    ✓ @CookieParam when parseJson flag is used query param must be converted to object (2 ms)
    ✕ @Body should provide a request body (8 ms)
    ✕ @Body should fail if required body was not provided (2 ms)
    ✕ @Body should provide a json object for json-typed controllers and actions (2 ms)
    ✕ @Body should fail if required body was not provided for json-typed controllers and actions (3 ms)
    ✕ @BodyParam should provide a json object for json-typed controllers and actions (2 ms)
    ✕ @BodyParam should fail if required body was not provided for json-typed controllers and actions (3 ms)
    ✕ @Body using application/x-www-form-urlencoded should handle url encoded form data (3 ms)
    ✓ @UploadedFile using multipart/form-data should provide uploaded file with the given name (16 ms)
    ✓ @UploadedFile with @Body should return both the file and the body (6 ms)
    ✓ @UploadedFile with @BodyParam should return both the file and the body param (4 ms)
    ✓ @UploadedFile with passed uploading options (limit) should throw an error (5 ms)
    ✓ @UploadedFile when required is used files must be provided (7 ms)
    ✓ @UploadedFiles should provide uploaded files with the given name (5 ms)
    ✓ @UploadedFiles with passed uploading options (limit) should throw an error (5 ms)
    ✓ @UploadedFiles when required is used files must be provided (4 ms)

  ●  › @Body should provide a request body

    Request failed with status code 415

      at createError (node_modules/axios/lib/core/createError.js:16:15)
      at settle (node_modules/axios/lib/core/settle.js:17:12)
      at IncomingMessage.handleStreamEnd (node_modules/axios/lib/adapters/http.js:260:11)
      at IncomingMessage.emit (node:events:539:35)
      at endReadableNT (node:internal/streams/readable:1344:12)
      at processTicksAndRejections (node:internal/process/task_queues:82:21)

  ●  › @Body should provide a request body

    expect.assertions(3)

    Expected three assertions to be called but received zero assertion calls.

      892 | 
      893 |   it('@Body should provide a request body', async () => {
    > 894 |     expect.assertions(3);
          |            ^
      895 |     const response = await axios.post('/questions', 'hello', {
      896 |       headers: {
      897 |         'Content-type': 'text/plain',

      at Object.<anonymous> (test/functional/action-params.spec.ts:894:12)
      at processTicksAndRejections (node:internal/process/task_queues:95:5)

  ●  › @Body should fail if required body was not provided

    Request failed with status code 415

      at createError (node_modules/axios/lib/core/createError.js:16:15)
      at settle (node_modules/axios/lib/core/settle.js:17:12)
      at IncomingMessage.handleStreamEnd (node_modules/axios/lib/adapters/http.js:260:11)
      at IncomingMessage.emit (node:events:539:35)
      at endReadableNT (node:internal/streams/readable:1344:12)
      at processTicksAndRejections (node:internal/process/task_queues:82:21)

  ●  › @Body should fail if required body was not provided

    expect.assertions(5)

    Expected five assertions to be called but received zero assertion calls.

      904 | 
      905 |   it('@Body should fail if required body was not provided', async () => {
    > 906 |     expect.assertions(5);
          |            ^
      907 |     let response = await axios.post('/questions-with-required', '0', {
      908 |       headers: {
      909 |         'Content-type': 'text/plain',

      at Object.<anonymous> (test/functional/action-params.spec.ts:906:12)
      at processTicksAndRejections (node:internal/process/task_queues:95:5)

  ●  › @Body should provide a json object for json-typed controllers and actions

    Request failed with status code 415

      at createError (node_modules/axios/lib/core/createError.js:16:15)
      at settle (node_modules/axios/lib/core/settle.js:17:12)
      at IncomingMessage.handleStreamEnd (node_modules/axios/lib/adapters/http.js:260:11)
      at IncomingMessage.emit (node:events:539:35)
      at endReadableNT (node:internal/streams/readable:1344:12)
      at processTicksAndRejections (node:internal/process/task_queues:82:21)

  ●  › @Body should provide a json object for json-typed controllers and actions

    expect.assertions(4)

    Expected four assertions to be called but received zero assertion calls.

      936 | 
      937 |   it('@Body should provide a json object for json-typed controllers and actions', async () => {
    > 938 |     expect.assertions(4);
          |            ^
      939 |     const response = await axios.post('/posts', { hello: 'world' });
      940 |     expect(body).toEqual({ hello: 'world' });
      941 |     expect(response.status).toEqual(HttpStatusCodes.OK);

      at Object.<anonymous> (test/functional/action-params.spec.ts:938:12)
      at processTicksAndRejections (node:internal/process/task_queues:95:5)

  ●  › @Body should fail if required body was not provided for json-typed controllers and actions

    Request failed with status code 415

      at createError (node_modules/axios/lib/core/createError.js:16:15)
      at settle (node_modules/axios/lib/core/settle.js:17:12)
      at IncomingMessage.handleStreamEnd (node_modules/axios/lib/adapters/http.js:260:11)
      at IncomingMessage.emit (node:events:539:35)
      at endReadableNT (node:internal/streams/readable:1344:12)
      at processTicksAndRejections (node:internal/process/task_queues:82:21)

  ●  › @Body should fail if required body was not provided for json-typed controllers and actions

    expect.assertions(2)

    Expected two assertions to be called but received zero assertion calls.

      945 | 
      946 |   it('@Body should fail if required body was not provided for json-typed controllers and actions', async () => {
    > 947 |     expect.assertions(2);
          |            ^
      948 |     let response = await axios.post('posts-with-required', { hello: '' });
      949 |     expect(response.status).toEqual(HttpStatusCodes.OK);
      950 | 

      at Object.<anonymous> (test/functional/action-params.spec.ts:947:12)
      at processTicksAndRejections (node:internal/process/task_queues:95:5)

  ●  › @BodyParam should provide a json object for json-typed controllers and actions

    Request failed with status code 415

      at createError (node_modules/axios/lib/core/createError.js:16:15)
      at settle (node_modules/axios/lib/core/settle.js:17:12)
      at IncomingMessage.handleStreamEnd (node_modules/axios/lib/adapters/http.js:260:11)
      at IncomingMessage.emit (node:events:539:35)
      at endReadableNT (node:internal/streams/readable:1344:12)
      at processTicksAndRejections (node:internal/process/task_queues:82:21)

  ●  › @BodyParam should provide a json object for json-typed controllers and actions

    expect.assertions(4)

    Expected four assertions to be called but received zero assertion calls.

      957 | 
      958 |   it('@BodyParam should provide a json object for json-typed controllers and actions', async () => {
    > 959 |     expect.assertions(4);
          |            ^
      960 |     const response = await axios.post('/users', { name: 'johny', age: 27, isActive: true });
      961 |     expect(response.status).toEqual(HttpStatusCodes.NO_CONTENT);
      962 |     expect(bodyParamName).toEqual('johny');

      at Object.<anonymous> (test/functional/action-params.spec.ts:959:12)
      at processTicksAndRejections (node:internal/process/task_queues:95:5)

  ●  › @BodyParam should fail if required body was not provided for json-typed controllers and actions

    Request failed with status code 415

      at createError (node_modules/axios/lib/core/createError.js:16:15)
      at settle (node_modules/axios/lib/core/settle.js:17:12)
      at IncomingMessage.handleStreamEnd (node_modules/axios/lib/adapters/http.js:260:11)
      at IncomingMessage.emit (node:events:539:35)
      at endReadableNT (node:internal/streams/readable:1344:12)
      at processTicksAndRejections (node:internal/process/task_queues:82:21)

  ●  › @BodyParam should fail if required body was not provided for json-typed controllers and actions

    expect.assertions(8)

    Expected eight assertions to be called but received zero assertion calls.

      966 | 
      967 |   it('@BodyParam should fail if required body was not provided for json-typed controllers and actions', async () => {
    > 968 |     expect.assertions(8);
          |            ^
      969 |     let response = await axios.post('/users-with-required', { name: 'johny', age: 27, isActive: true });
      970 |     expect(response.status).toEqual(HttpStatusCodes.NO_CONTENT);
      971 | 

      at Object.<anonymous> (test/functional/action-params.spec.ts:968:12)
      at processTicksAndRejections (node:internal/process/task_queues:95:5)

  ●  › @Body using application/x-www-form-urlencoded should handle url encoded form data

    Request failed with status code 415

      at createError (node_modules/axios/lib/core/createError.js:16:15)
      at settle (node_modules/axios/lib/core/settle.js:17:12)
      at IncomingMessage.handleStreamEnd (node_modules/axios/lib/adapters/http.js:260:11)
      at IncomingMessage.emit (node:events:539:35)
      at endReadableNT (node:internal/streams/readable:1344:12)
      at processTicksAndRejections (node:internal/process/task_queues:82:21)

  ●  › @Body using application/x-www-form-urlencoded should handle url encoded form data

    expect.assertions(3)

    Expected three assertions to be called but received zero assertion calls.

      1005 | 
      1006 |   it('@Body using application/x-www-form-urlencoded should handle url encoded form data', async () => {
    > 1007 |     expect.assertions(3);
           |            ^
      1008 |     const response = await axios.post(
      1009 |       '/form-data-body',
      1010 |       qs.stringify({

      at Object.<anonymous> (test/functional/action-params.spec.ts:1007:12)
      at processTicksAndRejections (node:internal/process/task_queues:95:5)

PASS test/functional/auth-decorator.spec.ts
    Controller responds with value when Authorization succeeds (async)
      ✓ without roles (65 ms)
      ✓ with roles (14 ms)
      ✓ async (24 ms)
    Controller responds with value when Authorization succeeds (sync)
      ✓ without roles (4 ms)
      ✓ with roles (4 ms)
      ✓ async (13 ms)
    Authorized Decorators Http Status Code
      ✓ without roles (21 ms)
      ✓ with roles (4 ms)
    Authorization checker allows to throw (async)
      ✓ custom errors (4 ms)
    Authorization checker allows to throw (sync)
      ✓ custom errors (3 ms)

PASS test/functional/load-from-directory.spec.ts
    loading all controllers from the given directories
      ✓ should load all controllers (17 ms)
    loading all express middlewares and error handlers from the given directories
      ✓ should succeed (12 ms)
      ✓ should fail (29 ms)

PASS test/functional/defaults.spec.ts
    defaults
      ✓ should return undefinedResultCode from defaults config for void function (25 ms)
      ✓ should return undefinedResultCode from defaults config for promise void function (3 ms)
      ✓ should return 400 from required paramOptions (15 ms)
      ✓ should return nullResultCode from defaults config (3 ms)
      ✓ should return status code from OnUndefined annotation (3 ms)
      ✓ should mark arg optional from QueryParam annotation (4 ms)

PASS test/functional/express-custom-error-handling.spec.ts
    custom express error handling
      ✓ should not call global error handler middleware if there was no errors (23 ms)
      ✓ should call global error handler middleware (41 ms)

PASS test/functional/other-controller-decorators.spec.ts
    other controller decorators
      ✓ should return httpCode set by @HttpCode decorator (25 ms)
      ✓ should return custom code when @OnNull (30 ms)
      ✓ should return custom error message and code when @OnUndefined is used with Error class (6 ms)
      ✓ should return custom code when @OnUndefined (9 ms)
      ✓ should return content-type in the response when @ContentType is used (2 ms)
      ✓ should return content-type in the response when @ContentType is used (2 ms)
      ✓ should return response with custom headers when @Header is used (3 ms)
      ✓ should relocate to new location when @Location is used (3 ms)

FAIL test/functional/action-options.spec.ts
    ✕ should use controller options when action transform options are not set (16 ms)
    ✕ should override controller options with action transformRequest option (6 ms)
    ✕ should override controller options with action transformResponse option (4 ms)

  ●  › should use controller options when action transform options are not set

    Request failed with status code 415

      at createError (node_modules/axios/lib/core/createError.js:16:15)
      at settle (node_modules/axios/lib/core/settle.js:17:12)
      at IncomingMessage.handleStreamEnd (node_modules/axios/lib/adapters/http.js:260:11)
      at IncomingMessage.emit (node:events:539:35)
      at endReadableNT (node:internal/streams/readable:1344:12)
      at processTicksAndRejections (node:internal/process/task_queues:82:21)

  ●  › should use controller options when action transform options are not set

    expect.assertions(4)

    Expected four assertions to be called but received zero assertion calls.

      63 | 
      64 |   it('should use controller options when action transform options are not set', async () => {
    > 65 |     expect.assertions(4);
         |            ^
      66 |     const response = await axios.post('/default', user);
      67 |     expect(initializedUser).toBeInstanceOf(UserModel);
      68 |     expect(initializedUser.lastName).toBeUndefined();

      at Object.<anonymous> (test/functional/action-options.spec.ts:65:12)
      at processTicksAndRejections (node:internal/process/task_queues:95:5)

  ●  › should override controller options with action transformRequest option

    Request failed with status code 415

      at createError (node_modules/axios/lib/core/createError.js:16:15)
      at settle (node_modules/axios/lib/core/settle.js:17:12)
      at IncomingMessage.handleStreamEnd (node_modules/axios/lib/adapters/http.js:260:11)
      at IncomingMessage.emit (node:events:539:35)
      at endReadableNT (node:internal/streams/readable:1344:12)
      at processTicksAndRejections (node:internal/process/task_queues:82:21)

  ●  › should override controller options with action transformRequest option

    expect.assertions(4)

    Expected four assertions to be called but received zero assertion calls.

      72 | 
      73 |   it('should override controller options with action transformRequest option', async () => {
    > 74 |     expect.assertions(4);
         |            ^
      75 |     const response = await axios.post('/transformRequestOnly', user);
      76 |     expect(initializedUser).toBeInstanceOf(UserModel);
      77 |     expect(initializedUser.lastName).toBeUndefined();

      at Object.<anonymous> (test/functional/action-options.spec.ts:74:12)
      at processTicksAndRejections (node:internal/process/task_queues:95:5)

  ●  › should override controller options with action transformResponse option

    Request failed with status code 415

      at createError (node_modules/axios/lib/core/createError.js:16:15)
      at settle (node_modules/axios/lib/core/settle.js:17:12)
      at IncomingMessage.handleStreamEnd (node_modules/axios/lib/adapters/http.js:260:11)
      at IncomingMessage.emit (node:events:539:35)
      at endReadableNT (node:internal/streams/readable:1344:12)
      at processTicksAndRejections (node:internal/process/task_queues:82:21)

  ●  › should override controller options with action transformResponse option

    expect.assertions(4)

    Expected four assertions to be called but received zero assertion calls.

      81 | 
      82 |   it('should override controller options with action transformResponse option', async () => {
    > 83 |     expect.assertions(4);
         |            ^
      84 |     const response = await axios.post('/transformResponseOnly', user);
      85 |     expect(initializedUser).not.toBeInstanceOf(UserModel);
      86 |     expect(initializedUser.lastName).not.toBeUndefined();

      at Object.<anonymous> (test/functional/action-options.spec.ts:83:12)
      at processTicksAndRejections (node:internal/process/task_queues:95:5)

PASS test/functional/express-middlewares.spec.ts
    express middlewares
      ✓ should call a global middlewares (20 ms)
      ✓ should use a custom middleware when @UseBefore or @UseAfter is used (3 ms)
      ✓ should call middleware and call it before controller action when @UseBefore is used (2 ms)
      ✓ should call middleware and call it after controller action when @UseAfter is used (2 ms)
      ✓ should call before middleware and call after middleware when @UseAfter and @UseAfter are used (3 ms)
      ✓ should handle errors in custom middlewares (18 ms)

PASS test/unit/controller-inheritance.spec.ts
  controller inheritance
    ✓ should build empty meta for empty set (10 ms)
    ✓ should build meta if the only derivative controller is given (2 ms)
    ✓ should build meta if the only autonomous controller is given (1 ms)
    ✓ should build meta both when autonomous and derivative controllers are given

PASS test/functional/class-validator-options.spec.ts
    no options
      ✓ should not use any options if not set (40 ms)
    global options
      should merge local validation options with global validation options prioritizing local
        ✓ succeed (4 ms)
      should pass the valid param after validation
        ✓ succeed (15 ms)
        ✓ should contain param name on validation failed (17 ms)
    local options
      ✓ should apply local options (6 ms)

FAIL test/functional/global-options.spec.ts
    routing-controllers global options
      useClassTransformer default value
        ✕ useClassTransformer by default must be set to true (65 ms)
      when useClassTransformer is set to true
        ✕ useClassTransformer is enabled (4 ms)
      when useClassTransformer is set to false
        ✕ useClassTransformer is disabled (3 ms)
      when routePrefix is used all controller routes should be appended by it
        ✕ routePrefix is enabled (3 ms)

  ●  › routing-controllers global options › useClassTransformer default value › useClassTransformer by default must be set to true

    Request failed with status code 415

      at createError (node_modules/axios/lib/core/createError.js:16:15)
      at settle (node_modules/axios/lib/core/settle.js:17:12)
      at IncomingMessage.handleStreamEnd (node_modules/axios/lib/adapters/http.js:260:11)
      at IncomingMessage.emit (node:events:539:35)
      at endReadableNT (node:internal/streams/readable:1344:12)
      at processTicksAndRejections (node:internal/process/task_queues:82:21)

  ●  › routing-controllers global options › useClassTransformer default value › useClassTransformer by default must be set to true

    expect.assertions(2)

    Expected two assertions to be called but received zero assertion calls.

      56 | 
      57 |       it('useClassTransformer by default must be set to true', async () => {
    > 58 |         expect.assertions(2);
         |                ^
      59 |         const response = await axios.post('/users', user);
      60 |         expect(initializedUser).toBeInstanceOf(User);
      61 |         expect(response.status).toEqual(HttpStatusCodes.OK);

      at Object.<anonymous> (test/functional/global-options.spec.ts:58:16)
      at processTicksAndRejections (node:internal/process/task_queues:95:5)

  ●  › routing-controllers global options › when useClassTransformer is set to true › useClassTransformer is enabled

    Request failed with status code 415

      at createError (node_modules/axios/lib/core/createError.js:16:15)
      at settle (node_modules/axios/lib/core/settle.js:17:12)
      at IncomingMessage.handleStreamEnd (node_modules/axios/lib/adapters/http.js:260:11)
      at IncomingMessage.emit (node:events:539:35)
      at endReadableNT (node:internal/streams/readable:1344:12)
      at processTicksAndRejections (node:internal/process/task_queues:82:21)

  ●  › routing-controllers global options › when useClassTransformer is set to true › useClassTransformer is enabled

    expect.assertions(2)

    Expected two assertions to be called but received zero assertion calls.

      92 | 
      93 |       it('useClassTransformer is enabled', async () => {
    > 94 |         expect.assertions(2);
         |                ^
      95 |         const response = await axios.post('/users', user);
      96 |         expect(initializedUser).toBeInstanceOf(User);
      97 |         expect(response.status).toEqual(HttpStatusCodes.OK);

      at Object.<anonymous> (test/functional/global-options.spec.ts:94:16)
      at processTicksAndRejections (node:internal/process/task_queues:95:5)

  ●  › routing-controllers global options › when useClassTransformer is set to false › useClassTransformer is disabled

    Request failed with status code 415

      at createError (node_modules/axios/lib/core/createError.js:16:15)
      at settle (node_modules/axios/lib/core/settle.js:17:12)
      at IncomingMessage.handleStreamEnd (node_modules/axios/lib/adapters/http.js:260:11)
      at IncomingMessage.emit (node:events:539:35)
      at endReadableNT (node:internal/streams/readable:1344:12)
      at processTicksAndRejections (node:internal/process/task_queues:82:21)

  ●  › routing-controllers global options › when useClassTransformer is set to false › useClassTransformer is disabled

    expect.assertions(2)

    Expected two assertions to be called but received zero assertion calls.

      128 | 
      129 |       it('useClassTransformer is disabled', async () => {
    > 130 |         expect.assertions(2);
          |                ^
      131 |         const response = await axios.post('/users', user);
      132 |         expect(initializedUser).not.toBeInstanceOf(User);
      133 |         expect(response.status).toEqual(HttpStatusCodes.OK);

      at Object.<anonymous> (test/functional/global-options.spec.ts:130:16)
      at processTicksAndRejections (node:internal/process/task_queues:95:5)

  ●  › routing-controllers global options › when routePrefix is used all controller routes should be appended by it › routePrefix is enabled

    Request failed with status code 415

      at createError (node_modules/axios/lib/core/createError.js:16:15)
      at settle (node_modules/axios/lib/core/settle.js:17:12)
      at IncomingMessage.handleStreamEnd (node_modules/axios/lib/adapters/http.js:260:11)
      at IncomingMessage.emit (node:events:539:35)
      at endReadableNT (node:internal/streams/readable:1344:12)
      at processTicksAndRejections (node:internal/process/task_queues:82:21)

  ●  › routing-controllers global options › when routePrefix is used all controller routes should be appended by it › routePrefix is enabled

    expect.assertions(4)

    Expected four assertions to be called but received zero assertion calls.

      164 | 
      165 |       it('routePrefix is enabled', async () => {
    > 166 |         expect.assertions(4);
          |                ^
      167 |         let response = await axios.post('/api/users', user);
      168 |         expect(initializedUser).toBeInstanceOf(User);
      169 |         expect(response.status).toEqual(HttpStatusCodes.OK);

      at Object.<anonymous> (test/functional/global-options.spec.ts:166:16)
      at processTicksAndRejections (node:internal/process/task_queues:95:5)

PASS test/functional/express-error-handling.spec.ts
    express error handling
      ✓ should not call global error handler middleware if there was no errors (37 ms)
      ✓ should call global error handler middleware (20 ms)
      ✓ should call global error handler middleware (4 ms)
      ✓ should call error handler middleware if used (2 ms)
      ✓ should not execute next middleware if soft error handled specifically and stopped error bubbling (3 ms)
      ✓ should process JsonErrors by their toJSON method if it exists (2 ms)

PASS test/functional/container.spec.ts
    using typedi container should be possible
      ✓ typedi container (53 ms)
    using custom container should be possible
      ✓ custom container (5 ms)
    using custom container with fallback should be possible
      ✓ custom container with fallback (7 ms)
    using custom container with fallback and fallback on throw error should be possible
      ✓ custom container with fallback and fallback on throw error (7 ms)

PASS test/functional/special-result-send.spec.ts
    special result value treatment
      ✓ should pipe stream to response (22 ms)
      ✓ should send raw binary data from Buffer (3 ms)
      ✓ should send raw binary data from UIntArray (2 ms)

PASS test/functional/class-transformer-options.spec.ts
    should not use any options if not set
      ✓ technical wrapper (60 ms)
    should apply global options
      ✓ technical wrapper (4 ms)
    should apply local options
      ✓ technical wrapper (4 ms)

FAIL test/functional/controller-options.spec.ts
    controller options
      ✕ controller transform is enabled by default (15 ms)
      ✕ when controller transform is enabled (5 ms)
      ✕ when controller transform is disabled (3 ms)

  ●  › controller options › controller transform is enabled by default

    expect.assertions(4)

    Expected four assertions to be called but received zero assertion calls.

      71 | 
      72 |     it('controller transform is enabled by default', async () => {
    > 73 |       expect.assertions(4);
         |              ^
      74 |       try {
      75 |         const response = await axios.post('/default', user);
      76 |         expect(initializedUser).toBeInstanceOf(UserModel);

      at Object.<anonymous> (test/functional/controller-options.spec.ts:73:14)
      at processTicksAndRejections (node:internal/process/task_queues:95:5)

  ●  › controller options › when controller transform is enabled

    expect.assertions(4)

    Expected four assertions to be called but received zero assertion calls.

      84 | 
      85 |     it('when controller transform is enabled', async () => {
    > 86 |       expect.assertions(4);
         |              ^
      87 |       try {
      88 |         const response = await axios.post('/transform', user);
      89 |         expect(initializedUser).toBeInstanceOf(UserModel);

      at Object.<anonymous> (test/functional/controller-options.spec.ts:86:14)
      at processTicksAndRejections (node:internal/process/task_queues:95:5)

  ●  › controller options › when controller transform is disabled

    expect.assertions(4)

    Expected four assertions to be called but received zero assertion calls.

       97 | 
       98 |     it('when controller transform is disabled', async () => {
    >  99 |       expect.assertions(4);
          |              ^
      100 |       try {
      101 |         const response = await axios.post('/noTransform', user);
      102 |         expect(initializedUser).toMatchObject(user);

      at Object.<anonymous> (test/functional/controller-options.spec.ts:99:14)
      at processTicksAndRejections (node:internal/process/task_queues:95:5)

PASS test/functional/controller-base-routes.spec.ts
    controller > base routes functionality
      ✓ get should respond with proper status code, headers and body content (52 ms)
      ✓ get should respond with proper status code, headers and body content (3 ms)
      ✓ get should respond with proper status code, headers and body content - 2nd pass (4 ms)
      ✓ wrong route should respond with 404 error (4 ms)
      ✓ wrong route should respond with 404 error (2 ms)
      ✓ wrong route should respond with 404 error (2 ms)

PASS test/functional/render-decorator.spec.ts
    template rendering
      ✓ should render a template and use given variables (25 ms)
      ✓ should render a template with given variables and locals variables (4 ms)

PASS test/functional/redirect-decorator.spec.ts
    dynamic redirect
      ✓ using template (27 ms)
      ✓ using override (4 ms)
      ✓ using original (4 ms)

PASS test/functional/express-global-before-error-handling.spec.ts
    custom express global before middleware error handling
      ✓ should call global error handler middleware with CustomError (36 ms)

PASS test/functional/middlewares-order.spec.ts
    loaded direct from array
      ✓ should call middlewares in order defined by items order (22 ms)
    specified by priority option
      ✓ should call middlewares in order defined by priority parameter of decorator (3 ms)

PASS test/functional/error-subclasses.spec.ts
  HttpError
    ✓ should be instance of HttpError and Error (3 ms)
  BadRequestError
    ✓ should be instance of BadRequestError, HttpError and Error (1 ms)

Summary of all failing tests
FAIL test/ActionParameterHandler.spec.ts
  ● ActionParameterHandler › negative › handle - throws error if the parameter is required

    Expected value   "TypeError: Cannot read property 'uuid' of undefined"
    Received:
      "TypeError: Cannot read properties of undefined (reading 'uuid')"

    Message:
      expected 'TypeError: Cannot read properties of undefined (reading \'uuid\')' to equal 'TypeError: Cannot read property \'uuid\' of undefined'

    Difference:

    - Expected
    + Received

    - TypeError: Cannot read property 'uuid' of undefined
    + TypeError: Cannot read properties of undefined (reading 'uuid')

      152 |       }
      153 | 
    > 154 |       expect(error.toString()).to.be.eq("TypeError: Cannot read property 'uuid' of undefined");
          |                                      ^
      155 |     });
      156 | 
      157 |     it('handle - throws error if the parameter is required, type file provided', async () => {

      at Object.<anonymous> (test/ActionParameterHandler.spec.ts:154:38)

FAIL test/functional/action-params.spec.ts
  ●  › @Body should provide a request body

    Request failed with status code 415

      at createError (node_modules/axios/lib/core/createError.js:16:15)
      at settle (node_modules/axios/lib/core/settle.js:17:12)
      at IncomingMessage.handleStreamEnd (node_modules/axios/lib/adapters/http.js:260:11)
      at IncomingMessage.emit (node:events:539:35)
      at endReadableNT (node:internal/streams/readable:1344:12)
      at processTicksAndRejections (node:internal/process/task_queues:82:21)

  ●  › @Body should provide a request body

    expect.assertions(3)

    Expected three assertions to be called but received zero assertion calls.

      892 | 
      893 |   it('@Body should provide a request body', async () => {
    > 894 |     expect.assertions(3);
          |            ^
      895 |     const response = await axios.post('/questions', 'hello', {
      896 |       headers: {
      897 |         'Content-type': 'text/plain',

      at Object.<anonymous> (test/functional/action-params.spec.ts:894:12)
      at processTicksAndRejections (node:internal/process/task_queues:95:5)

  ●  › @Body should fail if required body was not provided

    Request failed with status code 415

      at createError (node_modules/axios/lib/core/createError.js:16:15)
      at settle (node_modules/axios/lib/core/settle.js:17:12)
      at IncomingMessage.handleStreamEnd (node_modules/axios/lib/adapters/http.js:260:11)
      at IncomingMessage.emit (node:events:539:35)
      at endReadableNT (node:internal/streams/readable:1344:12)
      at processTicksAndRejections (node:internal/process/task_queues:82:21)

  ●  › @Body should fail if required body was not provided

    expect.assertions(5)

    Expected five assertions to be called but received zero assertion calls.

      904 | 
      905 |   it('@Body should fail if required body was not provided', async () => {
    > 906 |     expect.assertions(5);
          |            ^
      907 |     let response = await axios.post('/questions-with-required', '0', {
      908 |       headers: {
      909 |         'Content-type': 'text/plain',

      at Object.<anonymous> (test/functional/action-params.spec.ts:906:12)
      at processTicksAndRejections (node:internal/process/task_queues:95:5)

  ●  › @Body should provide a json object for json-typed controllers and actions

    Request failed with status code 415

      at createError (node_modules/axios/lib/core/createError.js:16:15)
      at settle (node_modules/axios/lib/core/settle.js:17:12)
      at IncomingMessage.handleStreamEnd (node_modules/axios/lib/adapters/http.js:260:11)
      at IncomingMessage.emit (node:events:539:35)
      at endReadableNT (node:internal/streams/readable:1344:12)
      at processTicksAndRejections (node:internal/process/task_queues:82:21)

  ●  › @Body should provide a json object for json-typed controllers and actions

    expect.assertions(4)

    Expected four assertions to be called but received zero assertion calls.

      936 | 
      937 |   it('@Body should provide a json object for json-typed controllers and actions', async () => {
    > 938 |     expect.assertions(4);
          |            ^
      939 |     const response = await axios.post('/posts', { hello: 'world' });
      940 |     expect(body).toEqual({ hello: 'world' });
      941 |     expect(response.status).toEqual(HttpStatusCodes.OK);

      at Object.<anonymous> (test/functional/action-params.spec.ts:938:12)
      at processTicksAndRejections (node:internal/process/task_queues:95:5)

  ●  › @Body should fail if required body was not provided for json-typed controllers and actions

    Request failed with status code 415

      at createError (node_modules/axios/lib/core/createError.js:16:15)
      at settle (node_modules/axios/lib/core/settle.js:17:12)
      at IncomingMessage.handleStreamEnd (node_modules/axios/lib/adapters/http.js:260:11)
      at IncomingMessage.emit (node:events:539:35)
      at endReadableNT (node:internal/streams/readable:1344:12)
      at processTicksAndRejections (node:internal/process/task_queues:82:21)

  ●  › @Body should fail if required body was not provided for json-typed controllers and actions

    expect.assertions(2)

    Expected two assertions to be called but received zero assertion calls.

      945 | 
      946 |   it('@Body should fail if required body was not provided for json-typed controllers and actions', async () => {
    > 947 |     expect.assertions(2);
          |            ^
      948 |     let response = await axios.post('posts-with-required', { hello: '' });
      949 |     expect(response.status).toEqual(HttpStatusCodes.OK);
      950 | 

      at Object.<anonymous> (test/functional/action-params.spec.ts:947:12)
      at processTicksAndRejections (node:internal/process/task_queues:95:5)

  ●  › @BodyParam should provide a json object for json-typed controllers and actions

    Request failed with status code 415

      at createError (node_modules/axios/lib/core/createError.js:16:15)
      at settle (node_modules/axios/lib/core/settle.js:17:12)
      at IncomingMessage.handleStreamEnd (node_modules/axios/lib/adapters/http.js:260:11)
      at IncomingMessage.emit (node:events:539:35)
      at endReadableNT (node:internal/streams/readable:1344:12)
      at processTicksAndRejections (node:internal/process/task_queues:82:21)

  ●  › @BodyParam should provide a json object for json-typed controllers and actions

    expect.assertions(4)

    Expected four assertions to be called but received zero assertion calls.

      957 | 
      958 |   it('@BodyParam should provide a json object for json-typed controllers and actions', async () => {
    > 959 |     expect.assertions(4);
          |            ^
      960 |     const response = await axios.post('/users', { name: 'johny', age: 27, isActive: true });
      961 |     expect(response.status).toEqual(HttpStatusCodes.NO_CONTENT);
      962 |     expect(bodyParamName).toEqual('johny');

      at Object.<anonymous> (test/functional/action-params.spec.ts:959:12)
      at processTicksAndRejections (node:internal/process/task_queues:95:5)

  ●  › @BodyParam should fail if required body was not provided for json-typed controllers and actions

    Request failed with status code 415

      at createError (node_modules/axios/lib/core/createError.js:16:15)
      at settle (node_modules/axios/lib/core/settle.js:17:12)
      at IncomingMessage.handleStreamEnd (node_modules/axios/lib/adapters/http.js:260:11)
      at IncomingMessage.emit (node:events:539:35)
      at endReadableNT (node:internal/streams/readable:1344:12)
      at processTicksAndRejections (node:internal/process/task_queues:82:21)

  ●  › @BodyParam should fail if required body was not provided for json-typed controllers and actions

    expect.assertions(8)

    Expected eight assertions to be called but received zero assertion calls.

      966 | 
      967 |   it('@BodyParam should fail if required body was not provided for json-typed controllers and actions', async () => {
    > 968 |     expect.assertions(8);
          |            ^
      969 |     let response = await axios.post('/users-with-required', { name: 'johny', age: 27, isActive: true });
      970 |     expect(response.status).toEqual(HttpStatusCodes.NO_CONTENT);
      971 | 

      at Object.<anonymous> (test/functional/action-params.spec.ts:968:12)
      at processTicksAndRejections (node:internal/process/task_queues:95:5)

  ●  › @Body using application/x-www-form-urlencoded should handle url encoded form data

    Request failed with status code 415

      at createError (node_modules/axios/lib/core/createError.js:16:15)
      at settle (node_modules/axios/lib/core/settle.js:17:12)
      at IncomingMessage.handleStreamEnd (node_modules/axios/lib/adapters/http.js:260:11)
      at IncomingMessage.emit (node:events:539:35)
      at endReadableNT (node:internal/streams/readable:1344:12)
      at processTicksAndRejections (node:internal/process/task_queues:82:21)

  ●  › @Body using application/x-www-form-urlencoded should handle url encoded form data

    expect.assertions(3)

    Expected three assertions to be called but received zero assertion calls.

      1005 | 
      1006 |   it('@Body using application/x-www-form-urlencoded should handle url encoded form data', async () => {
    > 1007 |     expect.assertions(3);
           |            ^
      1008 |     const response = await axios.post(
      1009 |       '/form-data-body',
      1010 |       qs.stringify({

      at Object.<anonymous> (test/functional/action-params.spec.ts:1007:12)
      at processTicksAndRejections (node:internal/process/task_queues:95:5)

FAIL test/functional/action-options.spec.ts
  ●  › should use controller options when action transform options are not set

    Request failed with status code 415

      at createError (node_modules/axios/lib/core/createError.js:16:15)
      at settle (node_modules/axios/lib/core/settle.js:17:12)
      at IncomingMessage.handleStreamEnd (node_modules/axios/lib/adapters/http.js:260:11)
      at IncomingMessage.emit (node:events:539:35)
      at endReadableNT (node:internal/streams/readable:1344:12)
      at processTicksAndRejections (node:internal/process/task_queues:82:21)

  ●  › should use controller options when action transform options are not set

    expect.assertions(4)

    Expected four assertions to be called but received zero assertion calls.

      63 | 
      64 |   it('should use controller options when action transform options are not set', async () => {
    > 65 |     expect.assertions(4);
         |            ^
      66 |     const response = await axios.post('/default', user);
      67 |     expect(initializedUser).toBeInstanceOf(UserModel);
      68 |     expect(initializedUser.lastName).toBeUndefined();

      at Object.<anonymous> (test/functional/action-options.spec.ts:65:12)
      at processTicksAndRejections (node:internal/process/task_queues:95:5)

  ●  › should override controller options with action transformRequest option

    Request failed with status code 415

      at createError (node_modules/axios/lib/core/createError.js:16:15)
      at settle (node_modules/axios/lib/core/settle.js:17:12)
      at IncomingMessage.handleStreamEnd (node_modules/axios/lib/adapters/http.js:260:11)
      at IncomingMessage.emit (node:events:539:35)
      at endReadableNT (node:internal/streams/readable:1344:12)
      at processTicksAndRejections (node:internal/process/task_queues:82:21)

  ●  › should override controller options with action transformRequest option

    expect.assertions(4)

    Expected four assertions to be called but received zero assertion calls.

      72 | 
      73 |   it('should override controller options with action transformRequest option', async () => {
    > 74 |     expect.assertions(4);
         |            ^
      75 |     const response = await axios.post('/transformRequestOnly', user);
      76 |     expect(initializedUser).toBeInstanceOf(UserModel);
      77 |     expect(initializedUser.lastName).toBeUndefined();

      at Object.<anonymous> (test/functional/action-options.spec.ts:74:12)
      at processTicksAndRejections (node:internal/process/task_queues:95:5)

  ●  › should override controller options with action transformResponse option

    Request failed with status code 415

      at createError (node_modules/axios/lib/core/createError.js:16:15)
      at settle (node_modules/axios/lib/core/settle.js:17:12)
      at IncomingMessage.handleStreamEnd (node_modules/axios/lib/adapters/http.js:260:11)
      at IncomingMessage.emit (node:events:539:35)
      at endReadableNT (node:internal/streams/readable:1344:12)
      at processTicksAndRejections (node:internal/process/task_queues:82:21)

  ●  › should override controller options with action transformResponse option

    expect.assertions(4)

    Expected four assertions to be called but received zero assertion calls.

      81 | 
      82 |   it('should override controller options with action transformResponse option', async () => {
    > 83 |     expect.assertions(4);
         |            ^
      84 |     const response = await axios.post('/transformResponseOnly', user);
      85 |     expect(initializedUser).not.toBeInstanceOf(UserModel);
      86 |     expect(initializedUser.lastName).not.toBeUndefined();

      at Object.<anonymous> (test/functional/action-options.spec.ts:83:12)
      at processTicksAndRejections (node:internal/process/task_queues:95:5)

FAIL test/functional/global-options.spec.ts
  ●  › routing-controllers global options › useClassTransformer default value › useClassTransformer by default must be set to true

    Request failed with status code 415

      at createError (node_modules/axios/lib/core/createError.js:16:15)
      at settle (node_modules/axios/lib/core/settle.js:17:12)
      at IncomingMessage.handleStreamEnd (node_modules/axios/lib/adapters/http.js:260:11)
      at IncomingMessage.emit (node:events:539:35)
      at endReadableNT (node:internal/streams/readable:1344:12)
      at processTicksAndRejections (node:internal/process/task_queues:82:21)

  ●  › routing-controllers global options › useClassTransformer default value › useClassTransformer by default must be set to true

    expect.assertions(2)

    Expected two assertions to be called but received zero assertion calls.

      56 | 
      57 |       it('useClassTransformer by default must be set to true', async () => {
    > 58 |         expect.assertions(2);
         |                ^
      59 |         const response = await axios.post('/users', user);
      60 |         expect(initializedUser).toBeInstanceOf(User);
      61 |         expect(response.status).toEqual(HttpStatusCodes.OK);

      at Object.<anonymous> (test/functional/global-options.spec.ts:58:16)
      at processTicksAndRejections (node:internal/process/task_queues:95:5)

  ●  › routing-controllers global options › when useClassTransformer is set to true › useClassTransformer is enabled

    Request failed with status code 415

      at createError (node_modules/axios/lib/core/createError.js:16:15)
      at settle (node_modules/axios/lib/core/settle.js:17:12)
      at IncomingMessage.handleStreamEnd (node_modules/axios/lib/adapters/http.js:260:11)
      at IncomingMessage.emit (node:events:539:35)
      at endReadableNT (node:internal/streams/readable:1344:12)
      at processTicksAndRejections (node:internal/process/task_queues:82:21)

  ●  › routing-controllers global options › when useClassTransformer is set to true › useClassTransformer is enabled

    expect.assertions(2)

    Expected two assertions to be called but received zero assertion calls.

      92 | 
      93 |       it('useClassTransformer is enabled', async () => {
    > 94 |         expect.assertions(2);
         |                ^
      95 |         const response = await axios.post('/users', user);
      96 |         expect(initializedUser).toBeInstanceOf(User);
      97 |         expect(response.status).toEqual(HttpStatusCodes.OK);

      at Object.<anonymous> (test/functional/global-options.spec.ts:94:16)
      at processTicksAndRejections (node:internal/process/task_queues:95:5)

  ●  › routing-controllers global options › when useClassTransformer is set to false › useClassTransformer is disabled

    Request failed with status code 415

      at createError (node_modules/axios/lib/core/createError.js:16:15)
      at settle (node_modules/axios/lib/core/settle.js:17:12)
      at IncomingMessage.handleStreamEnd (node_modules/axios/lib/adapters/http.js:260:11)
      at IncomingMessage.emit (node:events:539:35)
      at endReadableNT (node:internal/streams/readable:1344:12)
      at processTicksAndRejections (node:internal/process/task_queues:82:21)

  ●  › routing-controllers global options › when useClassTransformer is set to false › useClassTransformer is disabled

    expect.assertions(2)

    Expected two assertions to be called but received zero assertion calls.

      128 | 
      129 |       it('useClassTransformer is disabled', async () => {
    > 130 |         expect.assertions(2);
          |                ^
      131 |         const response = await axios.post('/users', user);
      132 |         expect(initializedUser).not.toBeInstanceOf(User);
      133 |         expect(response.status).toEqual(HttpStatusCodes.OK);

      at Object.<anonymous> (test/functional/global-options.spec.ts:130:16)
      at processTicksAndRejections (node:internal/process/task_queues:95:5)

  ●  › routing-controllers global options › when routePrefix is used all controller routes should be appended by it › routePrefix is enabled

    Request failed with status code 415

      at createError (node_modules/axios/lib/core/createError.js:16:15)
      at settle (node_modules/axios/lib/core/settle.js:17:12)
      at IncomingMessage.handleStreamEnd (node_modules/axios/lib/adapters/http.js:260:11)
      at IncomingMessage.emit (node:events:539:35)
      at endReadableNT (node:internal/streams/readable:1344:12)
      at processTicksAndRejections (node:internal/process/task_queues:82:21)

  ●  › routing-controllers global options › when routePrefix is used all controller routes should be appended by it › routePrefix is enabled

    expect.assertions(4)

    Expected four assertions to be called but received zero assertion calls.

      164 | 
      165 |       it('routePrefix is enabled', async () => {
    > 166 |         expect.assertions(4);
          |                ^
      167 |         let response = await axios.post('/api/users', user);
      168 |         expect(initializedUser).toBeInstanceOf(User);
      169 |         expect(response.status).toEqual(HttpStatusCodes.OK);

      at Object.<anonymous> (test/functional/global-options.spec.ts:166:16)
      at processTicksAndRejections (node:internal/process/task_queues:95:5)

FAIL test/functional/controller-options.spec.ts
  ●  › controller options › controller transform is enabled by default

    expect.assertions(4)

    Expected four assertions to be called but received zero assertion calls.

      71 | 
      72 |     it('controller transform is enabled by default', async () => {
    > 73 |       expect.assertions(4);
         |              ^
      74 |       try {
      75 |         const response = await axios.post('/default', user);
      76 |         expect(initializedUser).toBeInstanceOf(UserModel);

      at Object.<anonymous> (test/functional/controller-options.spec.ts:73:14)
      at processTicksAndRejections (node:internal/process/task_queues:95:5)

  ●  › controller options › when controller transform is enabled

    expect.assertions(4)

    Expected four assertions to be called but received zero assertion calls.

      84 | 
      85 |     it('when controller transform is enabled', async () => {
    > 86 |       expect.assertions(4);
         |              ^
      87 |       try {
      88 |         const response = await axios.post('/transform', user);
      89 |         expect(initializedUser).toBeInstanceOf(UserModel);

      at Object.<anonymous> (test/functional/controller-options.spec.ts:86:14)
      at processTicksAndRejections (node:internal/process/task_queues:95:5)

  ●  › controller options › when controller transform is disabled

    expect.assertions(4)

    Expected four assertions to be called but received zero assertion calls.

       97 | 
       98 |     it('when controller transform is disabled', async () => {
    >  99 |       expect.assertions(4);
          |              ^
      100 |       try {
      101 |         const response = await axios.post('/noTransform', user);
      102 |         expect(initializedUser).toMatchObject(user);

      at Object.<anonymous> (test/functional/controller-options.spec.ts:99:14)
      at processTicksAndRejections (node:internal/process/task_queues:95:5)


Test Suites: 5 failed, 21 passed, 26 total
Tests:       18 failed, 164 passed, 182 total
Snapshots:   0 total
Time:        12.61 s, estimated 13 s
Ran all test suites.
ts-jest[config] (WARN) The option `tsConfig` is deprecated and will be removed in ts-jest 27, use `tsconfig` instead
FAIL test/ActionParameterHandler.spec.ts
  ActionParameterHandler
    positive
      ✓ handle - should process string parameters (31 ms)
      ✓ handle - should process string parameters, returns empty if a given string is empty
      ✓ handle - should process number parameters (1 ms)
      ✓ handle - undefined on empty object provided
      ✓ handle - null provided (13 ms)
    negative
      ✕ handle - throws error if the parameter is required (7 ms)
      ✓ handle - throws error if the parameter is required, type file provided (1 ms)

  ● ActionParameterHandler › negative › handle - throws error if the parameter is required

    Expected value   "TypeError: Cannot read property 'uuid' of undefined"
    Received:
      "TypeError: Cannot read properties of undefined (reading 'uuid')"

    Message:
      expected 'TypeError: Cannot read properties of undefined (reading \'uuid\')' to equal 'TypeError: Cannot read property \'uuid\' of undefined'

    Difference:

    - Expected
    + Received

    - TypeError: Cannot read property 'uuid' of undefined
    + TypeError: Cannot read properties of undefined (reading 'uuid')

      152 |       }
      153 | 
    > 154 |       expect(error.toString()).to.be.eq("TypeError: Cannot read property 'uuid' of undefined");
          |                                      ^
      155 |     });
      156 | 
      157 |     it('handle - throws error if the parameter is required, type file provided', async () => {

      at Object.<anonymous> (test/ActionParameterHandler.spec.ts:154:38)

PASS test/functional/action-params.spec.ts
    ✓ @Req and @Res should be provided as Request and Response objects (21 ms)
    ✓ @Res writing directly to the response should work (5 ms)
    ✓ @Param should give a param from route (4 ms)
    ✓ @Param multiple params should give a proper values from route (3 ms)
    ✓ @SessionParam without middleware (24 ms)
    ✓ @Session should return a value from session (10 ms)
    ✓ @Session(param) should allow to inject empty property (4 ms)
    ✓ @QueryParams should give a proper values from request's query parameters (9 ms)
    ✓ @QueryParams should give a proper values from request's query parameters and one multiple value (15 ms)
    ✓ @QueryParams should give a proper values from request's query with validate whitelist option on (4 ms)
    ✓ @QueryParams should give a proper values from request's query parameters with nested json (4 ms)
    ✓ @QueryParams should not validate request query parameters when it's turned off in validator options (3 ms)
    ✓ @QueryParams should give a proper values from request's optional query parameters (3 ms)
    ✓ @QueryParam should give a proper values from request query parameters (2 ms)
    ✓ @QueryParam should give an array of string with only one query parameter (3 ms)
    ✓ @QueryParam should give an array of string with multiple query parameters (2 ms)
    ✓ @QueryParam should give an array of number with only one query parameter (2 ms)
    ✓ @QueryParam should give an array of number with multiple query parameters (2 ms)
    ✓ @QueryParam should give an array of date with only one query parameter (2 ms)
    ✓ @QueryParam should give an array of date with multiple query parameters (2 ms)
    ✓ @QueryParam when required params must be provided and they should not be empty (8 ms)
    ✓ @QueryParam when the type is Date then it should be parsed (2 ms)
    ✓ @QueryParam when the type is Date and it is invalid then the response should be a BadRequest error (3 ms)
    ✓ @QueryParam when parseJson flag is used query param must be converted to object (2 ms)
    ✓ @HeaderParam should give a proper values from request headers (2 ms)
    ✓ @HeaderParam when required is params must be provided and they should not be empty (2 ms)
    ✓ @HeaderParam should fail with invalid request options (2 ms)
    ✓ @HeaderParam should fail with missing required params (2 ms)
    ✓ for @HeaderParam when parseJson flag is used query param must be converted to object (2 ms)
    ✓ @CookieParam should give a proper values from request headers (2 ms)
    ✓ @CookieParam when required is params must be provided and they should not be empty (4 ms)
    ✓ @CookieParam when parseJson flag is used query param must be converted to object (2 ms)
    ✓ @Body should provide a request body (15 ms)
    ✓ @Body should fail if required body was not provided (6 ms)
    ✓ @Body should provide a json object for json-typed controllers and actions (3 ms)
    ✓ @Body should fail if required body was not provided for json-typed controllers and actions (4 ms)
    ✓ @BodyParam should provide a json object for json-typed controllers and actions (2 ms)
    ✓ @BodyParam should fail if required body was not provided for json-typed controllers and actions (18 ms)
    ✓ @Body using application/x-www-form-urlencoded should handle url encoded form data (3 ms)
    ✓ @UploadedFile using multipart/form-data should provide uploaded file with the given name (12 ms)
    ✓ @UploadedFile with @Body should return both the file and the body (6 ms)
    ✓ @UploadedFile with @BodyParam should return both the file and the body param (4 ms)
    ✓ @UploadedFile with passed uploading options (limit) should throw an error (5 ms)
    ✓ @UploadedFile when required is used files must be provided (6 ms)
    ✓ @UploadedFiles should provide uploaded files with the given name (5 ms)
    ✓ @UploadedFiles with passed uploading options (limit) should throw an error (5 ms)
    ✓ @UploadedFiles when required is used files must be provided (4 ms)

PASS test/functional/action-options.spec.ts
    ✓ should use controller options when action transform options are not set (53 ms)
    ✓ should override controller options with action transformRequest option (17 ms)
    ✓ should override controller options with action transformResponse option (2 ms)

PASS test/functional/controller-options.spec.ts
    controller options
      ✓ controller transform is enabled by default (32 ms)
      ✓ when controller transform is enabled (5 ms)
      ✓ when controller transform is disabled (3 ms)

PASS test/functional/global-options.spec.ts
    routing-controllers global options
      useClassTransformer default value
        ✓ useClassTransformer by default must be set to true (73 ms)
      when useClassTransformer is set to true
        ✓ useClassTransformer is enabled (4 ms)
      when useClassTransformer is set to false
        ✓ useClassTransformer is disabled (4 ms)
      when routePrefix is used all controller routes should be appended by it
        ✓ routePrefix is enabled (6 ms)

PASS test/functional/controller-methods.spec.ts
    controller methods
      ✓ get should respond with proper status code, headers and body content (9 ms)
      ✓ post respond with proper status code, headers and body content (2 ms)
      ✓ put respond with proper status code, headers and body content (3 ms)
      ✓ patch respond with proper status code, headers and body content (2 ms)
      ✓ delete respond with proper status code, headers and body content (2 ms)
      ✓ head respond with proper status code, headers and body content (2 ms)
      ✓ custom method (post) respond with proper status code, headers and body content (2 ms)
      ✓ custom method (delete) respond with proper status code, headers and body content (2 ms)
      ✓ route should work with parameter (3 ms)
      ✓ route should work with regexp parameter (2 ms)
      ✓ should respond with 404 when regexp does not match (4 ms)
      ✓ route should work with string regexp parameter (3 ms)
      ✓ should respond with 404 when regexp does not match (2 ms)
      ✓ should return result from a promise (503 ms)
      ✓ should respond with 500 if promise failed (504 ms)
      ✓ should respond with 204 No Content when null returned in action (15 ms)
      ✓ should respond with 404 Not Found text when undefined returned in action (20 ms)
      ✓ should respond with 404 Not Found JSON when undefined returned in action (2 ms)
      ✓ should respond with 200 and text/html even in json controller's method (2 ms)
      ✓ should respond with 200 and text/plain even in json controller's method (2 ms)
      ✓ should respond with 401 and text/html when UnauthorizedError throwed even in json controller's method (4 ms)
      ✓ should respond with 401 and aplication/json when UnauthorizedError is thrown in standard json controller's method (2 ms)

PASS test/functional/json-controller-methods.spec.ts
    json-controller methods
      ✓ get should respond with proper status code, headers and body content (10 ms)
      ✓ post respond with proper status code, headers and body content (2 ms)
      ✓ put respond with proper status code, headers and body content (3 ms)
      ✓ patch respond with proper status code, headers and body content (4 ms)
      ✓ delete respond with proper status code, headers and body content (3 ms)
      ✓ head respond with proper status code, headers and body content (2 ms)
      ✓ custom method (post) respond with proper status code, headers and body content (2 ms)
      ✓ custom method (delete) respond with proper status code, headers and body content (2 ms)
      ✓ route should work with parameter (2 ms)
      ✓ route should work with regexp parameter (2 ms)
      ✓ should respond with 404 when regexp does not match (4 ms)
      ✓ route should work with string regexp parameter (2 ms)
      ✓ should respond with 404 when regexp does not match (1 ms)
      ✓ should return result from a promise (504 ms)
      ✓ should respond with 500 if promise failed (503 ms)

PASS test/functional/interceptors.spec.ts
    interceptor
      ✓ custom interceptor function should replace returned content (22 ms)
      ✓ custom interceptor class should replace returned content (2 ms)
      ✓ custom interceptor class used on the whole controller should replace returned content (3 ms)
      ✓ global interceptor class should replace returned content (2 ms)
      ✓ interceptors should support promises (1003 ms)

PASS test/functional/express-middlewares.spec.ts
    express middlewares
      ✓ should call a global middlewares (20 ms)
      ✓ should use a custom middleware when @UseBefore or @UseAfter is used (2 ms)
      ✓ should call middleware and call it before controller action when @UseBefore is used (2 ms)
      ✓ should call middleware and call it after controller action when @UseAfter is used (3 ms)
      ✓ should call before middleware and call after middleware when @UseAfter and @UseAfter are used (2 ms)
      ✓ should handle errors in custom middlewares (25 ms)

PASS test/functional/other-controller-decorators.spec.ts
    other controller decorators
      ✓ should return httpCode set by @HttpCode decorator (10 ms)
      ✓ should return custom code when @OnNull (30 ms)
      ✓ should return custom error message and code when @OnUndefined is used with Error class (8 ms)
      ✓ should return custom code when @OnUndefined (8 ms)
      ✓ should return content-type in the response when @ContentType is used (2 ms)
      ✓ should return content-type in the response when @ContentType is used (2 ms)
      ✓ should return response with custom headers when @Header is used (3 ms)
      ✓ should relocate to new location when @Location is used (2 ms)

PASS test/functional/auth-decorator.spec.ts
    Controller responds with value when Authorization succeeds (async)
      ✓ without roles (71 ms)
      ✓ with roles (44 ms)
      ✓ async (54 ms)
    Controller responds with value when Authorization succeeds (sync)
      ✓ without roles (18 ms)
      ✓ with roles (11 ms)
      ✓ async (44 ms)
    Authorized Decorators Http Status Code
      ✓ without roles (38 ms)
      ✓ with roles (4 ms)
    Authorization checker allows to throw (async)
      ✓ custom errors (4 ms)
    Authorization checker allows to throw (sync)
      ✓ custom errors (3 ms)

PASS test/functional/load-from-directory.spec.ts
    loading all controllers from the given directories
      ✓ should load all controllers (30 ms)
    loading all express middlewares and error handlers from the given directories
      ✓ should succeed (8 ms)
      ✓ should fail (15 ms)

PASS test/functional/express-error-handling.spec.ts
    express error handling
      ✓ should not call global error handler middleware if there was no errors (21 ms)
      ✓ should call global error handler middleware (15 ms)
      ✓ should call global error handler middleware (5 ms)
      ✓ should call error handler middleware if used (3 ms)
      ✓ should not execute next middleware if soft error handled specifically and stopped error bubbling (2 ms)
      ✓ should process JsonErrors by their toJSON method if it exists (3 ms)

PASS test/functional/class-transformer-options.spec.ts
    should not use any options if not set
      ✓ technical wrapper (26 ms)
    should apply global options
      ✓ technical wrapper (5 ms)
    should apply local options
      ✓ technical wrapper (5 ms)

PASS test/functional/express-custom-error-handling.spec.ts
    custom express error handling
      ✓ should not call global error handler middleware if there was no errors (21 ms)
      ✓ should call global error handler middleware (17 ms)

PASS test/functional/express-global-before-error-handling.spec.ts
    custom express global before middleware error handling
      ✓ should call global error handler middleware with CustomError (35 ms)

PASS test/functional/defaults.spec.ts
    defaults
      ✓ should return undefinedResultCode from defaults config for void function (33 ms)
      ✓ should return undefinedResultCode from defaults config for promise void function (3 ms)
      ✓ should return 400 from required paramOptions (32 ms)
      ✓ should return nullResultCode from defaults config (13 ms)
      ✓ should return status code from OnUndefined annotation (2 ms)
      ✓ should mark arg optional from QueryParam annotation (15 ms)

PASS test/unit/controller-inheritance.spec.ts
  controller inheritance
    ✓ should build empty meta for empty set (10 ms)
    ✓ should build meta if the only derivative controller is given (2 ms)
    ✓ should build meta if the only autonomous controller is given (1 ms)
    ✓ should build meta both when autonomous and derivative controllers are given

PASS test/functional/container.spec.ts
    using typedi container should be possible
      ✓ typedi container (57 ms)
    using custom container should be possible
      ✓ custom container (5 ms)
    using custom container with fallback should be possible
      ✓ custom container with fallback (7 ms)
    using custom container with fallback and fallback on throw error should be possible
      ✓ custom container with fallback and fallback on throw error (7 ms)

PASS test/functional/class-validator-options.spec.ts
    no options
      ✓ should not use any options if not set (56 ms)
    global options
      should merge local validation options with global validation options prioritizing local
        ✓ succeed (5 ms)
      should pass the valid param after validation
        ✓ succeed (4 ms)
        ✓ should contain param name on validation failed (16 ms)
    local options
      ✓ should apply local options (5 ms)

PASS test/functional/render-decorator.spec.ts
    template rendering
      ✓ should render a template and use given variables (27 ms)
      ✓ should render a template with given variables and locals variables (4 ms)

PASS test/functional/controller-base-routes.spec.ts
    controller > base routes functionality
      ✓ get should respond with proper status code, headers and body content (58 ms)
      ✓ get should respond with proper status code, headers and body content (4 ms)
      ✓ get should respond with proper status code, headers and body content - 2nd pass (3 ms)
      ✓ wrong route should respond with 404 error (4 ms)
      ✓ wrong route should respond with 404 error (3 ms)
      ✓ wrong route should respond with 404 error (2 ms)

PASS test/functional/special-result-send.spec.ts
    special result value treatment
      ✓ should pipe stream to response (21 ms)
      ✓ should send raw binary data from Buffer (3 ms)
      ✓ should send raw binary data from UIntArray (2 ms)

PASS test/functional/redirect-decorator.spec.ts
    dynamic redirect
      ✓ using template (28 ms)
      ✓ using override (3 ms)
      ✓ using original (5 ms)

PASS test/functional/middlewares-order.spec.ts
    loaded direct from array
      ✓ should call middlewares in order defined by items order (8 ms)
    specified by priority option
      ✓ should call middlewares in order defined by priority parameter of decorator (16 ms)

PASS test/functional/error-subclasses.spec.ts
  HttpError
    ✓ should be instance of HttpError and Error (3 ms)
  BadRequestError
    ✓ should be instance of BadRequestError, HttpError and Error (2 ms)

Summary of all failing tests
FAIL test/ActionParameterHandler.spec.ts
  ● ActionParameterHandler › negative › handle - throws error if the parameter is required

    Expected value   "TypeError: Cannot read property 'uuid' of undefined"
    Received:
      "TypeError: Cannot read properties of undefined (reading 'uuid')"

    Message:
      expected 'TypeError: Cannot read properties of undefined (reading \'uuid\')' to equal 'TypeError: Cannot read property \'uuid\' of undefined'

    Difference:

    - Expected
    + Received

    - TypeError: Cannot read property 'uuid' of undefined
    + TypeError: Cannot read properties of undefined (reading 'uuid')

      152 |       }
      153 | 
    > 154 |       expect(error.toString()).to.be.eq("TypeError: Cannot read property 'uuid' of undefined");
          |                                      ^
      155 |     });
      156 | 
      157 |     it('handle - throws error if the parameter is required, type file provided', async () => {

      at Object.<anonymous> (test/ActionParameterHandler.spec.ts:154:38)


Test Suites: 1 failed, 25 passed, 26 total
Tests:       1 failed, 181 passed, 182 total
Snapshots:   0 total
Time:        12.512 s, estimated 13 s
Ran all test suites.
ts-jest[config] (WARN) The option `tsConfig` is deprecated and will be removed in ts-jest 27, use `tsconfig` instead
FAIL test/ActionParameterHandler.spec.ts
  ActionParameterHandler
    positive
      ✓ handle - should process string parameters (27 ms)
      ✓ handle - should process string parameters, returns empty if a given string is empty
      ✓ handle - should process number parameters (1 ms)
      ✓ handle - undefined on empty object provided
      ✓ handle - null provided (17 ms)
    negative
      ✕ handle - throws error if the parameter is required (7 ms)
      ✓ handle - throws error if the parameter is required, type file provided (1 ms)

  ● ActionParameterHandler › negative › handle - throws error if the parameter is required

    Expected value   "TypeError: Cannot read property 'uuid' of undefined"
    Received:
      "TypeError: Cannot read properties of undefined (reading 'uuid')"

    Message:
      expected 'TypeError: Cannot read properties of undefined (reading \'uuid\')' to equal 'TypeError: Cannot read property \'uuid\' of undefined'

    Difference:

    - Expected
    + Received

    - TypeError: Cannot read property 'uuid' of undefined
    + TypeError: Cannot read properties of undefined (reading 'uuid')

      152 |       }
      153 | 
    > 154 |       expect(error.toString()).to.be.eq("TypeError: Cannot read property 'uuid' of undefined");
          |                                      ^
      155 |     });
      156 | 
      157 |     it('handle - throws error if the parameter is required, type file provided', async () => {

      at Object.<anonymous> (test/ActionParameterHandler.spec.ts:154:38)

PASS test/functional/controller-methods.spec.ts
    controller methods
      ✓ get should respond with proper status code, headers and body content (20 ms)
      ✓ post respond with proper status code, headers and body content (4 ms)
      ✓ put respond with proper status code, headers and body content (2 ms)
      ✓ patch respond with proper status code, headers and body content (3 ms)
      ✓ delete respond with proper status code, headers and body content (3 ms)
      ✓ head respond with proper status code, headers and body content (3 ms)
      ✓ custom method (post) respond with proper status code, headers and body content (2 ms)
      ✓ custom method (delete) respond with proper status code, headers and body content (3 ms)
      ✓ route should work with parameter (3 ms)
      ✓ route should work with regexp parameter (3 ms)
      ✓ should respond with 404 when regexp does not match (4 ms)
      ✓ route should work with string regexp parameter (3 ms)
      ✓ should respond with 404 when regexp does not match (2 ms)
      ✓ should return result from a promise (504 ms)
      ✓ should respond with 500 if promise failed (503 ms)
      ✓ should respond with 204 No Content when null returned in action (6 ms)
      ✓ should respond with 404 Not Found text when undefined returned in action (20 ms)
      ✓ should respond with 404 Not Found JSON when undefined returned in action (13 ms)
      ✓ should respond with 200 and text/html even in json controller's method (1 ms)
      ✓ should respond with 200 and text/plain even in json controller's method (2 ms)
      ✓ should respond with 401 and text/html when UnauthorizedError throwed even in json controller's method (5 ms)
      ✓ should respond with 401 and aplication/json when UnauthorizedError is thrown in standard json controller's method (2 ms)

PASS test/functional/json-controller-methods.spec.ts
    json-controller methods
      ✓ get should respond with proper status code, headers and body content (10 ms)
      ✓ post respond with proper status code, headers and body content (2 ms)
      ✓ put respond with proper status code, headers and body content (3 ms)
      ✓ patch respond with proper status code, headers and body content (2 ms)
      ✓ delete respond with proper status code, headers and body content (2 ms)
      ✓ head respond with proper status code, headers and body content (3 ms)
      ✓ custom method (post) respond with proper status code, headers and body content (2 ms)
      ✓ custom method (delete) respond with proper status code, headers and body content (2 ms)
      ✓ route should work with parameter (3 ms)
      ✓ route should work with regexp parameter (2 ms)
      ✓ should respond with 404 when regexp does not match (5 ms)
      ✓ route should work with string regexp parameter (2 ms)
      ✓ should respond with 404 when regexp does not match (2 ms)
      ✓ should return result from a promise (504 ms)
      ✓ should respond with 500 if promise failed (504 ms)

PASS test/functional/interceptors.spec.ts
    interceptor
      ✓ custom interceptor function should replace returned content (20 ms)
      ✓ custom interceptor class should replace returned content (2 ms)
      ✓ custom interceptor class used on the whole controller should replace returned content (3 ms)
      ✓ global interceptor class should replace returned content (2 ms)
      ✓ interceptors should support promises (1004 ms)

PASS test/functional/action-params.spec.ts
    ✓ @Req and @Res should be provided as Request and Response objects (10 ms)
    ✓ @Res writing directly to the response should work (4 ms)
    ✓ @Param should give a param from route (3 ms)
    ✓ @Param multiple params should give a proper values from route (2 ms)
    ✓ @SessionParam without middleware (22 ms)
    ✓ @Session should return a value from session (10 ms)
    ✓ @Session(param) should allow to inject empty property (2 ms)
    ✓ @QueryParams should give a proper values from request's query parameters (9 ms)
    ✓ @QueryParams should give a proper values from request's query parameters and one multiple value (6 ms)
    ✓ @QueryParams should give a proper values from request's query with validate whitelist option on (3 ms)
    ✓ @QueryParams should give a proper values from request's query parameters with nested json (12 ms)
    ✓ @QueryParams should not validate request query parameters when it's turned off in validator options (2 ms)
    ✓ @QueryParams should give a proper values from request's optional query parameters (3 ms)
    ✓ @QueryParam should give a proper values from request query parameters (2 ms)
    ✓ @QueryParam should give an array of string with only one query parameter (2 ms)
    ✓ @QueryParam should give an array of string with multiple query parameters (3 ms)
    ✓ @QueryParam should give an array of number with only one query parameter (3 ms)
    ✓ @QueryParam should give an array of number with multiple query parameters (2 ms)
    ✓ @QueryParam should give an array of date with only one query parameter (1 ms)
    ✓ @QueryParam should give an array of date with multiple query parameters (2 ms)
    ✓ @QueryParam when required params must be provided and they should not be empty (7 ms)
    ✓ @QueryParam when the type is Date then it should be parsed (2 ms)
    ✓ @QueryParam when the type is Date and it is invalid then the response should be a BadRequest error (2 ms)
    ✓ @QueryParam when parseJson flag is used query param must be converted to object (2 ms)
    ✓ @HeaderParam should give a proper values from request headers (2 ms)
    ✓ @HeaderParam when required is params must be provided and they should not be empty (2 ms)
    ✓ @HeaderParam should fail with invalid request options (3 ms)
    ✓ @HeaderParam should fail with missing required params (3 ms)
    ✓ for @HeaderParam when parseJson flag is used query param must be converted to object (2 ms)
    ✓ @CookieParam should give a proper values from request headers (2 ms)
    ✓ @CookieParam when required is params must be provided and they should not be empty (4 ms)
    ✓ @CookieParam when parseJson flag is used query param must be converted to object (2 ms)
    ✓ @Body should provide a request body (11 ms)
    ✓ @Body should fail if required body was not provided (5 ms)
    ✓ @Body should provide a json object for json-typed controllers and actions (2 ms)
    ✓ @Body should fail if required body was not provided for json-typed controllers and actions (8 ms)
    ✓ @BodyParam should provide a json object for json-typed controllers and actions (2 ms)
    ✓ @BodyParam should fail if required body was not provided for json-typed controllers and actions (19 ms)
    ✓ @Body using application/x-www-form-urlencoded should handle url encoded form data (7 ms)
    ✓ @UploadedFile using multipart/form-data should provide uploaded file with the given name (21 ms)
    ✓ @UploadedFile with @Body should return both the file and the body (9 ms)
    ✓ @UploadedFile with @BodyParam should return both the file and the body param (20 ms)
    ✓ @UploadedFile with passed uploading options (limit) should throw an error (16 ms)
    ✓ @UploadedFile when required is used files must be provided (36 ms)
    ✓ @UploadedFiles should provide uploaded files with the given name (24 ms)
    ✓ @UploadedFiles with passed uploading options (limit) should throw an error (18 ms)
    ✓ @UploadedFiles when required is used files must be provided (6 ms)

PASS test/functional/auth-decorator.spec.ts
    Controller responds with value when Authorization succeeds (async)
      ✓ without roles (65 ms)
      ✓ with roles (13 ms)
      ✓ async (24 ms)
    Controller responds with value when Authorization succeeds (sync)
      ✓ without roles (3 ms)
      ✓ with roles (3 ms)
      ✓ async (13 ms)
    Authorized Decorators Http Status Code
      ✓ without roles (20 ms)
      ✓ with roles (3 ms)
    Authorization checker allows to throw (async)
      ✓ custom errors (5 ms)
    Authorization checker allows to throw (sync)
      ✓ custom errors (3 ms)

PASS test/functional/other-controller-decorators.spec.ts
    other controller decorators
      ✓ should return httpCode set by @HttpCode decorator (11 ms)
      ✓ should return custom code when @OnNull (37 ms)
      ✓ should return custom error message and code when @OnUndefined is used with Error class (7 ms)
      ✓ should return custom code when @OnUndefined (20 ms)
      ✓ should return content-type in the response when @ContentType is used (2 ms)
      ✓ should return content-type in the response when @ContentType is used (3 ms)
      ✓ should return response with custom headers when @Header is used (3 ms)
      ✓ should relocate to new location when @Location is used (2 ms)

PASS test/functional/action-options.spec.ts
    ✓ should use controller options when action transform options are not set (68 ms)
    ✓ should override controller options with action transformRequest option (5 ms)
    ✓ should override controller options with action transformResponse option (3 ms)

PASS test/functional/defaults.spec.ts
    defaults
      ✓ should return undefinedResultCode from defaults config for void function (7 ms)
      ✓ should return undefinedResultCode from defaults config for promise void function (2 ms)
      ✓ should return 400 from required paramOptions (15 ms)
      ✓ should return nullResultCode from defaults config (3 ms)
      ✓ should return status code from OnUndefined annotation (3 ms)
      ✓ should mark arg optional from QueryParam annotation (4 ms)

PASS test/functional/load-from-directory.spec.ts
    loading all controllers from the given directories
      ✓ should load all controllers (17 ms)
    loading all express middlewares and error handlers from the given directories
      ✓ should succeed (7 ms)
      ✓ should fail (17 ms)

PASS test/unit/controller-inheritance.spec.ts
  controller inheritance
    ✓ should build empty meta for empty set (10 ms)
    ✓ should build meta if the only derivative controller is given (2 ms)
    ✓ should build meta if the only autonomous controller is given
    ✓ should build meta both when autonomous and derivative controllers are given (1 ms)

PASS test/functional/controller-options.spec.ts
    controller options
      ✓ controller transform is enabled by default (32 ms)
      ✓ when controller transform is enabled (5 ms)
      ✓ when controller transform is disabled (3 ms)

PASS test/functional/container.spec.ts
    using typedi container should be possible
      ✓ typedi container (56 ms)
    using custom container should be possible
      ✓ custom container (6 ms)
    using custom container with fallback should be possible
      ✓ custom container with fallback (9 ms)
    using custom container with fallback and fallback on throw error should be possible
      ✓ custom container with fallback and fallback on throw error (7 ms)

PASS test/functional/express-middlewares.spec.ts
    express middlewares
      ✓ should call a global middlewares (8 ms)
      ✓ should use a custom middleware when @UseBefore or @UseAfter is used (2 ms)
      ✓ should call middleware and call it before controller action when @UseBefore is used (3 ms)
      ✓ should call middleware and call it after controller action when @UseAfter is used (2 ms)
      ✓ should call before middleware and call after middleware when @UseAfter and @UseAfter are used (2 ms)
      ✓ should handle errors in custom middlewares (22 ms)

PASS test/functional/global-options.spec.ts
    routing-controllers global options
      useClassTransformer default value
        ✓ useClassTransformer by default must be set to true (70 ms)
      when useClassTransformer is set to true
        ✓ useClassTransformer is enabled (4 ms)
      when useClassTransformer is set to false
        ✓ useClassTransformer is disabled (3 ms)
      when routePrefix is used all controller routes should be appended by it
        ✓ routePrefix is enabled (7 ms)

PASS test/functional/class-validator-options.spec.ts
    no options
      ✓ should not use any options if not set (56 ms)
    global options
      should merge local validation options with global validation options prioritizing local
        ✓ succeed (5 ms)
      should pass the valid param after validation
        ✓ succeed (3 ms)
        ✓ should contain param name on validation failed (15 ms)
    local options
      ✓ should apply local options (5 ms)

PASS test/functional/middlewares-order.spec.ts
    loaded direct from array
      ✓ should call middlewares in order defined by items order (22 ms)
    specified by priority option
      ✓ should call middlewares in order defined by priority parameter of decorator (3 ms)

PASS test/functional/express-error-handling.spec.ts
    express error handling
      ✓ should not call global error handler middleware if there was no errors (21 ms)
      ✓ should call global error handler middleware (21 ms)
      ✓ should call global error handler middleware (3 ms)
      ✓ should call error handler middleware if used (3 ms)
      ✓ should not execute next middleware if soft error handled specifically and stopped error bubbling (2 ms)
      ✓ should process JsonErrors by their toJSON method if it exists (4 ms)

PASS test/functional/controller-base-routes.spec.ts
    controller > base routes functionality
      ✓ get should respond with proper status code, headers and body content (52 ms)
      ✓ get should respond with proper status code, headers and body content (4 ms)
      ✓ get should respond with proper status code, headers and body content - 2nd pass (3 ms)
      ✓ wrong route should respond with 404 error (4 ms)
      ✓ wrong route should respond with 404 error (3 ms)
      ✓ wrong route should respond with 404 error (2 ms)

PASS test/functional/render-decorator.spec.ts
    template rendering
      ✓ should render a template and use given variables (30 ms)
      ✓ should render a template with given variables and locals variables (4 ms)

PASS test/functional/redirect-decorator.spec.ts
    dynamic redirect
      ✓ using template (27 ms)
      ✓ using override (4 ms)
      ✓ using original (3 ms)

PASS test/functional/class-transformer-options.spec.ts
    should not use any options if not set
      ✓ technical wrapper (27 ms)
    should apply global options
      ✓ technical wrapper (4 ms)
    should apply local options
      ✓ technical wrapper (4 ms)

PASS test/functional/express-global-before-error-handling.spec.ts
    custom express global before middleware error handling
      ✓ should call global error handler middleware with CustomError (35 ms)

PASS test/functional/express-custom-error-handling.spec.ts
    custom express error handling
      ✓ should not call global error handler middleware if there was no errors (22 ms)
      ✓ should call global error handler middleware (17 ms)

PASS test/functional/special-result-send.spec.ts
    special result value treatment
      ✓ should pipe stream to response (22 ms)
      ✓ should send raw binary data from Buffer (3 ms)
      ✓ should send raw binary data from UIntArray (2 ms)

PASS test/functional/error-subclasses.spec.ts
  HttpError
    ✓ should be instance of HttpError and Error (3 ms)
  BadRequestError
    ✓ should be instance of BadRequestError, HttpError and Error (2 ms)

Summary of all failing tests
FAIL test/ActionParameterHandler.spec.ts
  ● ActionParameterHandler › negative › handle - throws error if the parameter is required

    Expected value   "TypeError: Cannot read property 'uuid' of undefined"
    Received:
      "TypeError: Cannot read properties of undefined (reading 'uuid')"

    Message:
      expected 'TypeError: Cannot read properties of undefined (reading \'uuid\')' to equal 'TypeError: Cannot read property \'uuid\' of undefined'

    Difference:

    - Expected
    + Received

    - TypeError: Cannot read property 'uuid' of undefined
    + TypeError: Cannot read properties of undefined (reading 'uuid')

      152 |       }
      153 | 
    > 154 |       expect(error.toString()).to.be.eq("TypeError: Cannot read property 'uuid' of undefined");
          |                                      ^
      155 |     });
      156 | 
      157 |     it('handle - throws error if the parameter is required, type file provided', async () => {

      at Object.<anonymous> (test/ActionParameterHandler.spec.ts:154:38)


Test Suites: 1 failed, 25 passed, 26 total
Tests:       1 failed, 181 passed, 182 total
Snapshots:   0 total
Time:        12.491 s, estimated 13 s
Ran all test suites.
ts-jest[config] (WARN) The option `tsConfig` is deprecated and will be removed in ts-jest 27, use `tsconfig` instead
FAIL test/ActionParameterHandler.spec.ts
  ActionParameterHandler
    positive
      ✓ handle - should process string parameters (28 ms)
      ✓ handle - should process string parameters, returns empty if a given string is empty
      ✓ handle - should process number parameters
      ✓ handle - undefined on empty object provided
      ✓ handle - null provided (16 ms)
    negative
      ✕ handle - throws error if the parameter is required (8 ms)
      ✓ handle - throws error if the parameter is required, type file provided (1 ms)

  ● ActionParameterHandler › negative › handle - throws error if the parameter is required

    Expected value   "TypeError: Cannot read property 'uuid' of undefined"
    Received:
      "TypeError: Cannot read properties of undefined (reading 'uuid')"

    Message:
      expected 'TypeError: Cannot read properties of undefined (reading \'uuid\')' to equal 'TypeError: Cannot read property \'uuid\' of undefined'

    Difference:

    - Expected
    + Received

    - TypeError: Cannot read property 'uuid' of undefined
    + TypeError: Cannot read properties of undefined (reading 'uuid')

      152 |       }
      153 | 
    > 154 |       expect(error.toString()).to.be.eq("TypeError: Cannot read property 'uuid' of undefined");
          |                                      ^
      155 |     });
      156 | 
      157 |     it('handle - throws error if the parameter is required, type file provided', async () => {

      at Object.<anonymous> (test/ActionParameterHandler.spec.ts:154:38)

PASS test/functional/controller-methods.spec.ts
    controller methods
      ✓ get should respond with proper status code, headers and body content (19 ms)
      ✓ post respond with proper status code, headers and body content (5 ms)
      ✓ put respond with proper status code, headers and body content (3 ms)
      ✓ patch respond with proper status code, headers and body content (3 ms)
      ✓ delete respond with proper status code, headers and body content (3 ms)
      ✓ head respond with proper status code, headers and body content (2 ms)
      ✓ custom method (post) respond with proper status code, headers and body content (3 ms)
      ✓ custom method (delete) respond with proper status code, headers and body content (2 ms)
      ✓ route should work with parameter (3 ms)
      ✓ route should work with regexp parameter (2 ms)
      ✓ should respond with 404 when regexp does not match (5 ms)
      ✓ route should work with string regexp parameter (3 ms)
      ✓ should respond with 404 when regexp does not match (2 ms)
      ✓ should return result from a promise (503 ms)
      ✓ should respond with 500 if promise failed (504 ms)
      ✓ should respond with 204 No Content when null returned in action (5 ms)
      ✓ should respond with 404 Not Found text when undefined returned in action (31 ms)
      ✓ should respond with 404 Not Found JSON when undefined returned in action (2 ms)
      ✓ should respond with 200 and text/html even in json controller's method (2 ms)
      ✓ should respond with 200 and text/plain even in json controller's method (2 ms)
      ✓ should respond with 401 and text/html when UnauthorizedError throwed even in json controller's method (4 ms)
      ✓ should respond with 401 and aplication/json when UnauthorizedError is thrown in standard json controller's method (3 ms)

PASS test/functional/json-controller-methods.spec.ts
    json-controller methods
      ✓ get should respond with proper status code, headers and body content (25 ms)
      ✓ post respond with proper status code, headers and body content (3 ms)
      ✓ put respond with proper status code, headers and body content (2 ms)
      ✓ patch respond with proper status code, headers and body content (2 ms)
      ✓ delete respond with proper status code, headers and body content (2 ms)
      ✓ head respond with proper status code, headers and body content (3 ms)
      ✓ custom method (post) respond with proper status code, headers and body content (2 ms)
      ✓ custom method (delete) respond with proper status code, headers and body content (2 ms)
      ✓ route should work with parameter (3 ms)
      ✓ route should work with regexp parameter (2 ms)
      ✓ should respond with 404 when regexp does not match (4 ms)
      ✓ route should work with string regexp parameter (3 ms)
      ✓ should respond with 404 when regexp does not match (2 ms)
      ✓ should return result from a promise (504 ms)
      ✓ should respond with 500 if promise failed (504 ms)

PASS test/functional/interceptors.spec.ts
    interceptor
      ✓ custom interceptor function should replace returned content (21 ms)
      ✓ custom interceptor class should replace returned content (3 ms)
      ✓ custom interceptor class used on the whole controller should replace returned content (2 ms)
      ✓ global interceptor class should replace returned content (3 ms)
      ✓ interceptors should support promises (1003 ms)

FAIL test/functional/action-params.spec.ts
    ✕ encountered a declaration exception (2 ms)

  ●  › encountered a declaration exception

    TypeError: require(...) is not a function

      16 | var contentType = require('content-type')
      17 | var createError = require('http-errors')
    > 18 | var debug = require('debug')('body-parser:urlencoded')
         |                             ^
      19 | var deprecate = require('depd')('body-parser')
      20 | var read = require('../read')
      21 | var typeis = require('type-is')

      at Object.<anonymous> (../../../VariantsDeps/body-parser/variant3/body-parser/lib/types/urlencoded.js:18:29)
      at loadParser (../../../VariantsDeps/body-parser/variant3/body-parser/index.js:151:16)
      at Function.get [as urlencoded] (../../../VariantsDeps/body-parser/variant3/body-parser/index.js:123:12)
      at Suite.<anonymous> (test/functional/action-params.spec.ts:60:44)

FAIL test/functional/controller-options.spec.ts
    controller options
      ✕ controller transform is enabled by default (27 ms)
      ✕ when controller transform is enabled (3 ms)
      ✕ when controller transform is disabled (3 ms)

  ●  › controller options › controller transform is enabled by default

    TypeError: require(...) is not a function

      16 | var contentType = require('content-type')
      17 | var createError = require('http-errors')
    > 18 | var debug = require('debug')('body-parser:json')
         |                             ^
      19 | var read = require('../read')
      20 | var typeis = require('type-is')
      21 | 

      at Object.<anonymous> (../../../VariantsDeps/body-parser/variant3/body-parser/lib/types/json.js:18:29)
      at loadParser (../../../VariantsDeps/body-parser/variant3/body-parser/index.js:142:16)
      at Function.get [as json] (../../../VariantsDeps/body-parser/variant3/body-parser/index.js:123:12)
      at ExpressDriver.registerAction (src/driver/express/ExpressDriver.ts:104:54)
      at src/RoutingControllers.ts:81:21
          at Array.forEach (<anonymous>)

  ●  › controller options › controller transform is enabled by default

    expect.assertions(4)

    Expected four assertions to be called but received zero assertion calls.

      71 | 
      72 |     it('controller transform is enabled by default', async () => {
    > 73 |       expect.assertions(4);
         |              ^
      74 |       try {
      75 |         const response = await axios.post('/default', user);
      76 |         expect(initializedUser).toBeInstanceOf(UserModel);

      at Object.<anonymous> (test/functional/controller-options.spec.ts:73:14)

  ●  › controller options › when controller transform is enabled

    TypeError: require(...) is not a function

      16 | var contentType = require('content-type')
      17 | var createError = require('http-errors')
    > 18 | var debug = require('debug')('body-parser:json')
         |                             ^
      19 | var read = require('../read')
      20 | var typeis = require('type-is')
      21 | 

      at Object.<anonymous> (../../../VariantsDeps/body-parser/variant3/body-parser/lib/types/json.js:18:29)
      at loadParser (../../../VariantsDeps/body-parser/variant3/body-parser/index.js:142:16)
      at Function.get [as json] (../../../VariantsDeps/body-parser/variant3/body-parser/index.js:123:12)
      at ExpressDriver.registerAction (src/driver/express/ExpressDriver.ts:104:54)
      at src/RoutingControllers.ts:81:21
          at Array.forEach (<anonymous>)

  ●  › controller options › when controller transform is enabled

    expect.assertions(4)

    Expected four assertions to be called but received zero assertion calls.

      84 | 
      85 |     it('when controller transform is enabled', async () => {
    > 86 |       expect.assertions(4);
         |              ^
      87 |       try {
      88 |         const response = await axios.post('/transform', user);
      89 |         expect(initializedUser).toBeInstanceOf(UserModel);

      at Object.<anonymous> (test/functional/controller-options.spec.ts:86:14)
      at processTicksAndRejections (node:internal/process/task_queues:95:5)

  ●  › controller options › when controller transform is disabled

    TypeError: require(...) is not a function

      16 | var contentType = require('content-type')
      17 | var createError = require('http-errors')
    > 18 | var debug = require('debug')('body-parser:json')
         |                             ^
      19 | var read = require('../read')
      20 | var typeis = require('type-is')
      21 | 

      at Object.<anonymous> (../../../VariantsDeps/body-parser/variant3/body-parser/lib/types/json.js:18:29)
      at loadParser (../../../VariantsDeps/body-parser/variant3/body-parser/index.js:142:16)
      at Function.get [as json] (../../../VariantsDeps/body-parser/variant3/body-parser/index.js:123:12)
      at ExpressDriver.registerAction (src/driver/express/ExpressDriver.ts:104:54)
      at src/RoutingControllers.ts:81:21
          at Array.forEach (<anonymous>)

  ●  › controller options › when controller transform is disabled

    expect.assertions(4)

    Expected four assertions to be called but received zero assertion calls.

       97 | 
       98 |     it('when controller transform is disabled', async () => {
    >  99 |       expect.assertions(4);
          |              ^
      100 |       try {
      101 |         const response = await axios.post('/noTransform', user);
      102 |         expect(initializedUser).toMatchObject(user);

      at Object.<anonymous> (test/functional/controller-options.spec.ts:99:14)
      at processTicksAndRejections (node:internal/process/task_queues:95:5)

PASS test/functional/auth-decorator.spec.ts
    Controller responds with value when Authorization succeeds (async)
      ✓ without roles (68 ms)
      ✓ with roles (14 ms)
      ✓ async (24 ms)
    Controller responds with value when Authorization succeeds (sync)
      ✓ without roles (4 ms)
      ✓ with roles (3 ms)
      ✓ async (13 ms)
    Authorized Decorators Http Status Code
      ✓ without roles (18 ms)
      ✓ with roles (4 ms)
    Authorization checker allows to throw (async)
      ✓ custom errors (4 ms)
    Authorization checker allows to throw (sync)
      ✓ custom errors (4 ms)

PASS test/functional/other-controller-decorators.spec.ts
    other controller decorators
      ✓ should return httpCode set by @HttpCode decorator (11 ms)
      ✓ should return custom code when @OnNull (41 ms)
      ✓ should return custom error message and code when @OnUndefined is used with Error class (7 ms)
      ✓ should return custom code when @OnUndefined (10 ms)
      ✓ should return content-type in the response when @ContentType is used (3 ms)
      ✓ should return content-type in the response when @ContentType is used (3 ms)
      ✓ should return response with custom headers when @Header is used (9 ms)
      ✓ should relocate to new location when @Location is used (2 ms)

PASS test/functional/load-from-directory.spec.ts
    loading all controllers from the given directories
      ✓ should load all controllers (17 ms)
    loading all express middlewares and error handlers from the given directories
      ✓ should succeed (23 ms)
      ✓ should fail (16 ms)

FAIL test/functional/action-options.spec.ts
    ✕ should use controller options when action transform options are not set (19 ms)
    ✕ should override controller options with action transformRequest option (2 ms)
    ✕ should override controller options with action transformResponse option (1 ms)

  ●  › should use controller options when action transform options are not set

    TypeError: require(...) is not a function

      16 | var contentType = require('content-type')
      17 | var createError = require('http-errors')
    > 18 | var debug = require('debug')('body-parser:json')
         |                             ^
      19 | var read = require('../read')
      20 | var typeis = require('type-is')
      21 | 

      at Object.<anonymous> (../../../VariantsDeps/body-parser/variant3/body-parser/lib/types/json.js:18:29)
      at loadParser (../../../VariantsDeps/body-parser/variant3/body-parser/index.js:142:16)
      at Function.get [as json] (../../../VariantsDeps/body-parser/variant3/body-parser/index.js:123:12)
      at ExpressDriver.registerAction (src/driver/express/ExpressDriver.ts:104:54)
      at src/RoutingControllers.ts:81:21
          at Array.forEach (<anonymous>)

  ●  › should use controller options when action transform options are not set

    connect ECONNREFUSED 127.0.0.1:3001

      at TCPConnectWrap.afterConnect [as oncomplete] (node:net:1229:16)

  ●  › should use controller options when action transform options are not set

    expect.assertions(4)

    Expected four assertions to be called but received zero assertion calls.

      63 | 
      64 |   it('should use controller options when action transform options are not set', async () => {
    > 65 |     expect.assertions(4);
         |            ^
      66 |     const response = await axios.post('/default', user);
      67 |     expect(initializedUser).toBeInstanceOf(UserModel);
      68 |     expect(initializedUser.lastName).toBeUndefined();

      at Object.<anonymous> (test/functional/action-options.spec.ts:65:12)

  ●  › should override controller options with action transformRequest option

    TypeError: require(...) is not a function

      16 | var contentType = require('content-type')
      17 | var createError = require('http-errors')
    > 18 | var debug = require('debug')('body-parser:json')
         |                             ^
      19 | var read = require('../read')
      20 | var typeis = require('type-is')
      21 | 

      at Object.<anonymous> (../../../VariantsDeps/body-parser/variant3/body-parser/lib/types/json.js:18:29)
      at loadParser (../../../VariantsDeps/body-parser/variant3/body-parser/index.js:142:16)
      at Function.get [as json] (../../../VariantsDeps/body-parser/variant3/body-parser/index.js:123:12)
      at ExpressDriver.registerAction (src/driver/express/ExpressDriver.ts:104:54)
      at src/RoutingControllers.ts:81:21
          at Array.forEach (<anonymous>)

  ●  › should override controller options with action transformRequest option

    connect ECONNREFUSED 127.0.0.1:3001

      at TCPConnectWrap.afterConnect [as oncomplete] (node:net:1229:16)

  ●  › should override controller options with action transformRequest option

    expect.assertions(4)

    Expected four assertions to be called but received zero assertion calls.

      72 | 
      73 |   it('should override controller options with action transformRequest option', async () => {
    > 74 |     expect.assertions(4);
         |            ^
      75 |     const response = await axios.post('/transformRequestOnly', user);
      76 |     expect(initializedUser).toBeInstanceOf(UserModel);
      77 |     expect(initializedUser.lastName).toBeUndefined();

      at Object.<anonymous> (test/functional/action-options.spec.ts:74:12)
      at processTicksAndRejections (node:internal/process/task_queues:95:5)

  ●  › should override controller options with action transformResponse option

    TypeError: require(...) is not a function

      16 | var contentType = require('content-type')
      17 | var createError = require('http-errors')
    > 18 | var debug = require('debug')('body-parser:json')
         |                             ^
      19 | var read = require('../read')
      20 | var typeis = require('type-is')
      21 | 

      at Object.<anonymous> (../../../VariantsDeps/body-parser/variant3/body-parser/lib/types/json.js:18:29)
      at loadParser (../../../VariantsDeps/body-parser/variant3/body-parser/index.js:142:16)
      at Function.get [as json] (../../../VariantsDeps/body-parser/variant3/body-parser/index.js:123:12)
      at ExpressDriver.registerAction (src/driver/express/ExpressDriver.ts:104:54)
      at src/RoutingControllers.ts:81:21
          at Array.forEach (<anonymous>)

  ●  › should override controller options with action transformResponse option

    connect ECONNREFUSED 127.0.0.1:3001

      at TCPConnectWrap.afterConnect [as oncomplete] (node:net:1229:16)

  ●  › should override controller options with action transformResponse option

    expect.assertions(4)

    Expected four assertions to be called but received zero assertion calls.

      81 | 
      82 |   it('should override controller options with action transformResponse option', async () => {
    > 83 |     expect.assertions(4);
         |            ^
      84 |     const response = await axios.post('/transformResponseOnly', user);
      85 |     expect(initializedUser).not.toBeInstanceOf(UserModel);
      86 |     expect(initializedUser.lastName).not.toBeUndefined();

      at Object.<anonymous> (test/functional/action-options.spec.ts:83:12)
      at processTicksAndRejections (node:internal/process/task_queues:95:5)

PASS test/functional/container.spec.ts
    using typedi container should be possible
      ✓ typedi container (56 ms)
    using custom container should be possible
      ✓ custom container (6 ms)
    using custom container with fallback should be possible
      ✓ custom container with fallback (7 ms)
    using custom container with fallback and fallback on throw error should be possible
      ✓ custom container with fallback and fallback on throw error (7 ms)

PASS test/unit/controller-inheritance.spec.ts
  controller inheritance
    ✓ should build empty meta for empty set (10 ms)
    ✓ should build meta if the only derivative controller is given (1 ms)
    ✓ should build meta if the only autonomous controller is given (1 ms)
    ✓ should build meta both when autonomous and derivative controllers are given (1 ms)

PASS test/functional/defaults.spec.ts
    defaults
      ✓ should return undefinedResultCode from defaults config for void function (8 ms)
      ✓ should return undefinedResultCode from defaults config for promise void function (2 ms)
      ✓ should return 400 from required paramOptions (18 ms)
      ✓ should return nullResultCode from defaults config (3 ms)
      ✓ should return status code from OnUndefined annotation (3 ms)
      ✓ should mark arg optional from QueryParam annotation (4 ms)

PASS test/functional/controller-base-routes.spec.ts
    controller > base routes functionality
      ✓ get should respond with proper status code, headers and body content (45 ms)
      ✓ get should respond with proper status code, headers and body content (4 ms)
      ✓ get should respond with proper status code, headers and body content - 2nd pass (3 ms)
      ✓ wrong route should respond with 404 error (14 ms)
      ✓ wrong route should respond with 404 error (4 ms)
      ✓ wrong route should respond with 404 error (3 ms)

PASS test/functional/express-error-handling.spec.ts
    express error handling
      ✓ should not call global error handler middleware if there was no errors (19 ms)
      ✓ should call global error handler middleware (19 ms)
      ✓ should call global error handler middleware (3 ms)
      ✓ should call error handler middleware if used (3 ms)
      ✓ should not execute next middleware if soft error handled specifically and stopped error bubbling (2 ms)
      ✓ should process JsonErrors by their toJSON method if it exists (3 ms)

PASS test/functional/class-validator-options.spec.ts
    no options
      ✓ should not use any options if not set (51 ms)
    global options
      should merge local validation options with global validation options prioritizing local
        ✓ succeed (5 ms)
      should pass the valid param after validation
        ✓ succeed (4 ms)
        ✓ should contain param name on validation failed (15 ms)
    local options
      ✓ should apply local options (5 ms)

PASS test/functional/express-middlewares.spec.ts
    express middlewares
      ✓ should call a global middlewares (18 ms)
      ✓ should use a custom middleware when @UseBefore or @UseAfter is used (2 ms)
      ✓ should call middleware and call it before controller action when @UseBefore is used (2 ms)
      ✓ should call middleware and call it after controller action when @UseAfter is used (3 ms)
      ✓ should call before middleware and call after middleware when @UseAfter and @UseAfter are used (2 ms)
      ✓ should handle errors in custom middlewares (22 ms)

FAIL test/functional/global-options.spec.ts
    routing-controllers global options
      useClassTransformer default value
        ✕ useClassTransformer by default must be set to true (70 ms)
      when useClassTransformer is set to true
        ✕ useClassTransformer is enabled (4 ms)
      when useClassTransformer is set to false
        ✕ useClassTransformer is disabled (3 ms)
      when routePrefix is used all controller routes should be appended by it
        ✕ routePrefix is enabled (2 ms)

  ●  › routing-controllers global options › useClassTransformer default value › useClassTransformer by default must be set to true

    TypeError: require(...) is not a function

      16 | var contentType = require('content-type')
      17 | var createError = require('http-errors')
    > 18 | var debug = require('debug')('body-parser:json')
         |                             ^
      19 | var read = require('../read')
      20 | var typeis = require('type-is')
      21 | 

      at Object.<anonymous> (../../../VariantsDeps/body-parser/variant3/body-parser/lib/types/json.js:18:29)
      at loadParser (../../../VariantsDeps/body-parser/variant3/body-parser/index.js:142:16)
      at Function.get [as json] (../../../VariantsDeps/body-parser/variant3/body-parser/index.js:123:12)
      at ExpressDriver.registerAction (src/driver/express/ExpressDriver.ts:104:54)
      at src/RoutingControllers.ts:81:21
          at Array.forEach (<anonymous>)

  ●  › routing-controllers global options › useClassTransformer default value › useClassTransformer by default must be set to true

    connect ECONNREFUSED 127.0.0.1:3001

      at TCPConnectWrap.afterConnect [as oncomplete] (node:net:1229:16)

  ●  › routing-controllers global options › useClassTransformer default value › useClassTransformer by default must be set to true

    TypeError: Cannot read properties of undefined (reading 'close')

      52 | 
      53 |       afterEach((done: DoneCallback) => {
    > 54 |         expressServer.close(done);
         |                       ^
      55 |       });
      56 | 
      57 |       it('useClassTransformer by default must be set to true', async () => {

      at Object.<anonymous> (test/functional/global-options.spec.ts:54:23)
      at processTicksAndRejections (node:internal/process/task_queues:95:5)

  ●  › routing-controllers global options › useClassTransformer default value › useClassTransformer by default must be set to true

    expect.assertions(2)

    Expected two assertions to be called but received zero assertion calls.

      56 | 
      57 |       it('useClassTransformer by default must be set to true', async () => {
    > 58 |         expect.assertions(2);
         |                ^
      59 |         const response = await axios.post('/users', user);
      60 |         expect(initializedUser).toBeInstanceOf(User);
      61 |         expect(response.status).toEqual(HttpStatusCodes.OK);

      at Object.<anonymous> (test/functional/global-options.spec.ts:58:16)

  ●  › routing-controllers global options › when useClassTransformer is set to true › useClassTransformer is enabled

    TypeError: this.loadBodyParser(...).json is not a function

      102 |     if (actionMetadata.isBodyUsed) {
      103 |       if (actionMetadata.isJsonTyped) {
    > 104 |         defaultMiddlewares.push(this.loadBodyParser().json(actionMetadata.bodyExtraOptions));
          |                                                       ^
      105 |       } else {
      106 |         defaultMiddlewares.push(this.loadBodyParser().text(actionMetadata.bodyExtraOptions));
      107 |       }

      at ExpressDriver.registerAction (src/driver/express/ExpressDriver.ts:104:55)
      at src/RoutingControllers.ts:81:21
          at Array.forEach (<anonymous>)
      at src/RoutingControllers.ts:75:26
          at Array.forEach (<anonymous>)
      at RoutingControllers.registerControllers (src/RoutingControllers.ts:74:17)
      at createExecutor (src/index.ts:219:6)
      at createServer (src/index.ts:148:3)
      at Object.createExpressServer (src/index.ts:125:10)
      at Object.<anonymous> (test/functional/global-options.spec.ts:82:25)

  ●  › routing-controllers global options › when useClassTransformer is set to true › useClassTransformer is enabled

    connect ECONNREFUSED 127.0.0.1:3001

      at TCPConnectWrap.afterConnect [as oncomplete] (node:net:1229:16)

  ●  › routing-controllers global options › when useClassTransformer is set to true › useClassTransformer is enabled

    TypeError: Cannot read properties of undefined (reading 'close')

      88 | 
      89 |       afterEach((done: DoneCallback) => {
    > 90 |         expressServer.close(done);
         |                       ^
      91 |       });
      92 | 
      93 |       it('useClassTransformer is enabled', async () => {

      at Object.<anonymous> (test/functional/global-options.spec.ts:90:23)
      at processTicksAndRejections (node:internal/process/task_queues:95:5)

  ●  › routing-controllers global options › when useClassTransformer is set to true › useClassTransformer is enabled

    expect.assertions(2)

    Expected two assertions to be called but received zero assertion calls.

      92 | 
      93 |       it('useClassTransformer is enabled', async () => {
    > 94 |         expect.assertions(2);
         |                ^
      95 |         const response = await axios.post('/users', user);
      96 |         expect(initializedUser).toBeInstanceOf(User);
      97 |         expect(response.status).toEqual(HttpStatusCodes.OK);

      at Object.<anonymous> (test/functional/global-options.spec.ts:94:16)
      at processTicksAndRejections (node:internal/process/task_queues:95:5)

  ●  › routing-controllers global options › when useClassTransformer is set to false › useClassTransformer is disabled

    TypeError: this.loadBodyParser(...).json is not a function

      102 |     if (actionMetadata.isBodyUsed) {
      103 |       if (actionMetadata.isJsonTyped) {
    > 104 |         defaultMiddlewares.push(this.loadBodyParser().json(actionMetadata.bodyExtraOptions));
          |                                                       ^
      105 |       } else {
      106 |         defaultMiddlewares.push(this.loadBodyParser().text(actionMetadata.bodyExtraOptions));
      107 |       }

      at ExpressDriver.registerAction (src/driver/express/ExpressDriver.ts:104:55)
      at src/RoutingControllers.ts:81:21
          at Array.forEach (<anonymous>)
      at src/RoutingControllers.ts:75:26
          at Array.forEach (<anonymous>)
      at RoutingControllers.registerControllers (src/RoutingControllers.ts:74:17)
      at createExecutor (src/index.ts:219:6)
      at createServer (src/index.ts:148:3)
      at Object.createExpressServer (src/index.ts:125:10)
      at Object.<anonymous> (test/functional/global-options.spec.ts:118:25)

  ●  › routing-controllers global options › when useClassTransformer is set to false › useClassTransformer is disabled

    connect ECONNREFUSED 127.0.0.1:3001

      at TCPConnectWrap.afterConnect [as oncomplete] (node:net:1229:16)

  ●  › routing-controllers global options › when useClassTransformer is set to false › useClassTransformer is disabled

    TypeError: Cannot read properties of undefined (reading 'close')

      124 | 
      125 |       afterEach((done: DoneCallback) => {
    > 126 |         expressServer.close(done);
          |                       ^
      127 |       });
      128 | 
      129 |       it('useClassTransformer is disabled', async () => {

      at Object.<anonymous> (test/functional/global-options.spec.ts:126:23)
      at processTicksAndRejections (node:internal/process/task_queues:95:5)

  ●  › routing-controllers global options › when useClassTransformer is set to false › useClassTransformer is disabled

    expect.assertions(2)

    Expected two assertions to be called but received zero assertion calls.

      128 | 
      129 |       it('useClassTransformer is disabled', async () => {
    > 130 |         expect.assertions(2);
          |                ^
      131 |         const response = await axios.post('/users', user);
      132 |         expect(initializedUser).not.toBeInstanceOf(User);
      133 |         expect(response.status).toEqual(HttpStatusCodes.OK);

      at Object.<anonymous> (test/functional/global-options.spec.ts:130:16)
      at processTicksAndRejections (node:internal/process/task_queues:95:5)

  ●  › routing-controllers global options › when routePrefix is used all controller routes should be appended by it › routePrefix is enabled

    TypeError: this.loadBodyParser(...).json is not a function

      102 |     if (actionMetadata.isBodyUsed) {
      103 |       if (actionMetadata.isJsonTyped) {
    > 104 |         defaultMiddlewares.push(this.loadBodyParser().json(actionMetadata.bodyExtraOptions));
          |                                                       ^
      105 |       } else {
      106 |         defaultMiddlewares.push(this.loadBodyParser().text(actionMetadata.bodyExtraOptions));
      107 |       }

      at ExpressDriver.registerAction (src/driver/express/ExpressDriver.ts:104:55)
      at src/RoutingControllers.ts:81:21
          at Array.forEach (<anonymous>)
      at src/RoutingControllers.ts:75:26
          at Array.forEach (<anonymous>)
      at RoutingControllers.registerControllers (src/RoutingControllers.ts:74:17)
      at createExecutor (src/index.ts:219:6)
      at createServer (src/index.ts:148:3)
      at Object.createExpressServer (src/index.ts:125:10)
      at Object.<anonymous> (test/functional/global-options.spec.ts:154:25)

  ●  › routing-controllers global options › when routePrefix is used all controller routes should be appended by it › routePrefix is enabled

    connect ECONNREFUSED 127.0.0.1:3001

      at TCPConnectWrap.afterConnect [as oncomplete] (node:net:1229:16)

  ●  › routing-controllers global options › when routePrefix is used all controller routes should be appended by it › routePrefix is enabled

    TypeError: Cannot read properties of undefined (reading 'close')

      160 | 
      161 |       afterEach((done: DoneCallback) => {
    > 162 |         expressServer.close(done);
          |                       ^
      163 |       });
      164 | 
      165 |       it('routePrefix is enabled', async () => {

      at Object.<anonymous> (test/functional/global-options.spec.ts:162:23)
      at processTicksAndRejections (node:internal/process/task_queues:95:5)

  ●  › routing-controllers global options › when routePrefix is used all controller routes should be appended by it › routePrefix is enabled

    expect.assertions(4)

    Expected four assertions to be called but received zero assertion calls.

      164 | 
      165 |       it('routePrefix is enabled', async () => {
    > 166 |         expect.assertions(4);
          |                ^
      167 |         let response = await axios.post('/api/users', user);
      168 |         expect(initializedUser).toBeInstanceOf(User);
      169 |         expect(response.status).toEqual(HttpStatusCodes.OK);

      at Object.<anonymous> (test/functional/global-options.spec.ts:166:16)
      at processTicksAndRejections (node:internal/process/task_queues:95:5)

PASS test/functional/render-decorator.spec.ts
    template rendering
      ✓ should render a template and use given variables (13 ms)
      ✓ should render a template with given variables and locals variables (4 ms)

PASS test/functional/express-custom-error-handling.spec.ts
    custom express error handling
      ✓ should not call global error handler middleware if there was no errors (20 ms)
      ✓ should call global error handler middleware (17 ms)

PASS test/functional/class-transformer-options.spec.ts
    should not use any options if not set
      ✓ technical wrapper (57 ms)
    should apply global options
      ✓ technical wrapper (4 ms)
    should apply local options
      ✓ technical wrapper (4 ms)

PASS test/functional/redirect-decorator.spec.ts
    dynamic redirect
      ✓ using template (14 ms)
      ✓ using override (5 ms)
      ✓ using original (5 ms)

PASS test/functional/middlewares-order.spec.ts
    loaded direct from array
      ✓ should call middlewares in order defined by items order (20 ms)
    specified by priority option
      ✓ should call middlewares in order defined by priority parameter of decorator (3 ms)

PASS test/functional/express-global-before-error-handling.spec.ts
    custom express global before middleware error handling
      ✓ should call global error handler middleware with CustomError (34 ms)

PASS test/functional/special-result-send.spec.ts
    special result value treatment
      ✓ should pipe stream to response (22 ms)
      ✓ should send raw binary data from Buffer (3 ms)
      ✓ should send raw binary data from UIntArray (2 ms)

PASS test/functional/error-subclasses.spec.ts
  HttpError
    ✓ should be instance of HttpError and Error (3 ms)
  BadRequestError
    ✓ should be instance of BadRequestError, HttpError and Error (1 ms)

Summary of all failing tests
FAIL test/ActionParameterHandler.spec.ts
  ● ActionParameterHandler › negative › handle - throws error if the parameter is required

    Expected value   "TypeError: Cannot read property 'uuid' of undefined"
    Received:
      "TypeError: Cannot read properties of undefined (reading 'uuid')"

    Message:
      expected 'TypeError: Cannot read properties of undefined (reading \'uuid\')' to equal 'TypeError: Cannot read property \'uuid\' of undefined'

    Difference:

    - Expected
    + Received

    - TypeError: Cannot read property 'uuid' of undefined
    + TypeError: Cannot read properties of undefined (reading 'uuid')

      152 |       }
      153 | 
    > 154 |       expect(error.toString()).to.be.eq("TypeError: Cannot read property 'uuid' of undefined");
          |                                      ^
      155 |     });
      156 | 
      157 |     it('handle - throws error if the parameter is required, type file provided', async () => {

      at Object.<anonymous> (test/ActionParameterHandler.spec.ts:154:38)

FAIL test/functional/action-params.spec.ts
  ●  › encountered a declaration exception

    TypeError: require(...) is not a function

      16 | var contentType = require('content-type')
      17 | var createError = require('http-errors')
    > 18 | var debug = require('debug')('body-parser:urlencoded')
         |                             ^
      19 | var deprecate = require('depd')('body-parser')
      20 | var read = require('../read')
      21 | var typeis = require('type-is')

      at Object.<anonymous> (../../../VariantsDeps/body-parser/variant3/body-parser/lib/types/urlencoded.js:18:29)
      at loadParser (../../../VariantsDeps/body-parser/variant3/body-parser/index.js:151:16)
      at Function.get [as urlencoded] (../../../VariantsDeps/body-parser/variant3/body-parser/index.js:123:12)
      at Suite.<anonymous> (test/functional/action-params.spec.ts:60:44)

FAIL test/functional/controller-options.spec.ts
  ●  › controller options › controller transform is enabled by default

    TypeError: require(...) is not a function

      16 | var contentType = require('content-type')
      17 | var createError = require('http-errors')
    > 18 | var debug = require('debug')('body-parser:json')
         |                             ^
      19 | var read = require('../read')
      20 | var typeis = require('type-is')
      21 | 

      at Object.<anonymous> (../../../VariantsDeps/body-parser/variant3/body-parser/lib/types/json.js:18:29)
      at loadParser (../../../VariantsDeps/body-parser/variant3/body-parser/index.js:142:16)
      at Function.get [as json] (../../../VariantsDeps/body-parser/variant3/body-parser/index.js:123:12)
      at ExpressDriver.registerAction (src/driver/express/ExpressDriver.ts:104:54)
      at src/RoutingControllers.ts:81:21
          at Array.forEach (<anonymous>)

  ●  › controller options › controller transform is enabled by default

    expect.assertions(4)

    Expected four assertions to be called but received zero assertion calls.

      71 | 
      72 |     it('controller transform is enabled by default', async () => {
    > 73 |       expect.assertions(4);
         |              ^
      74 |       try {
      75 |         const response = await axios.post('/default', user);
      76 |         expect(initializedUser).toBeInstanceOf(UserModel);

      at Object.<anonymous> (test/functional/controller-options.spec.ts:73:14)

  ●  › controller options › when controller transform is enabled

    TypeError: require(...) is not a function

      16 | var contentType = require('content-type')
      17 | var createError = require('http-errors')
    > 18 | var debug = require('debug')('body-parser:json')
         |                             ^
      19 | var read = require('../read')
      20 | var typeis = require('type-is')
      21 | 

      at Object.<anonymous> (../../../VariantsDeps/body-parser/variant3/body-parser/lib/types/json.js:18:29)
      at loadParser (../../../VariantsDeps/body-parser/variant3/body-parser/index.js:142:16)
      at Function.get [as json] (../../../VariantsDeps/body-parser/variant3/body-parser/index.js:123:12)
      at ExpressDriver.registerAction (src/driver/express/ExpressDriver.ts:104:54)
      at src/RoutingControllers.ts:81:21
          at Array.forEach (<anonymous>)

  ●  › controller options › when controller transform is enabled

    expect.assertions(4)

    Expected four assertions to be called but received zero assertion calls.

      84 | 
      85 |     it('when controller transform is enabled', async () => {
    > 86 |       expect.assertions(4);
         |              ^
      87 |       try {
      88 |         const response = await axios.post('/transform', user);
      89 |         expect(initializedUser).toBeInstanceOf(UserModel);

      at Object.<anonymous> (test/functional/controller-options.spec.ts:86:14)
      at processTicksAndRejections (node:internal/process/task_queues:95:5)

  ●  › controller options › when controller transform is disabled

    TypeError: require(...) is not a function

      16 | var contentType = require('content-type')
      17 | var createError = require('http-errors')
    > 18 | var debug = require('debug')('body-parser:json')
         |                             ^
      19 | var read = require('../read')
      20 | var typeis = require('type-is')
      21 | 

      at Object.<anonymous> (../../../VariantsDeps/body-parser/variant3/body-parser/lib/types/json.js:18:29)
      at loadParser (../../../VariantsDeps/body-parser/variant3/body-parser/index.js:142:16)
      at Function.get [as json] (../../../VariantsDeps/body-parser/variant3/body-parser/index.js:123:12)
      at ExpressDriver.registerAction (src/driver/express/ExpressDriver.ts:104:54)
      at src/RoutingControllers.ts:81:21
          at Array.forEach (<anonymous>)

  ●  › controller options › when controller transform is disabled

    expect.assertions(4)

    Expected four assertions to be called but received zero assertion calls.

       97 | 
       98 |     it('when controller transform is disabled', async () => {
    >  99 |       expect.assertions(4);
          |              ^
      100 |       try {
      101 |         const response = await axios.post('/noTransform', user);
      102 |         expect(initializedUser).toMatchObject(user);

      at Object.<anonymous> (test/functional/controller-options.spec.ts:99:14)
      at processTicksAndRejections (node:internal/process/task_queues:95:5)

FAIL test/functional/action-options.spec.ts
  ●  › should use controller options when action transform options are not set

    TypeError: require(...) is not a function

      16 | var contentType = require('content-type')
      17 | var createError = require('http-errors')
    > 18 | var debug = require('debug')('body-parser:json')
         |                             ^
      19 | var read = require('../read')
      20 | var typeis = require('type-is')
      21 | 

      at Object.<anonymous> (../../../VariantsDeps/body-parser/variant3/body-parser/lib/types/json.js:18:29)
      at loadParser (../../../VariantsDeps/body-parser/variant3/body-parser/index.js:142:16)
      at Function.get [as json] (../../../VariantsDeps/body-parser/variant3/body-parser/index.js:123:12)
      at ExpressDriver.registerAction (src/driver/express/ExpressDriver.ts:104:54)
      at src/RoutingControllers.ts:81:21
          at Array.forEach (<anonymous>)

  ●  › should use controller options when action transform options are not set

    connect ECONNREFUSED 127.0.0.1:3001

      at TCPConnectWrap.afterConnect [as oncomplete] (node:net:1229:16)

  ●  › should use controller options when action transform options are not set

    expect.assertions(4)

    Expected four assertions to be called but received zero assertion calls.

      63 | 
      64 |   it('should use controller options when action transform options are not set', async () => {
    > 65 |     expect.assertions(4);
         |            ^
      66 |     const response = await axios.post('/default', user);
      67 |     expect(initializedUser).toBeInstanceOf(UserModel);
      68 |     expect(initializedUser.lastName).toBeUndefined();

      at Object.<anonymous> (test/functional/action-options.spec.ts:65:12)

  ●  › should override controller options with action transformRequest option

    TypeError: require(...) is not a function

      16 | var contentType = require('content-type')
      17 | var createError = require('http-errors')
    > 18 | var debug = require('debug')('body-parser:json')
         |                             ^
      19 | var read = require('../read')
      20 | var typeis = require('type-is')
      21 | 

      at Object.<anonymous> (../../../VariantsDeps/body-parser/variant3/body-parser/lib/types/json.js:18:29)
      at loadParser (../../../VariantsDeps/body-parser/variant3/body-parser/index.js:142:16)
      at Function.get [as json] (../../../VariantsDeps/body-parser/variant3/body-parser/index.js:123:12)
      at ExpressDriver.registerAction (src/driver/express/ExpressDriver.ts:104:54)
      at src/RoutingControllers.ts:81:21
          at Array.forEach (<anonymous>)

  ●  › should override controller options with action transformRequest option

    connect ECONNREFUSED 127.0.0.1:3001

      at TCPConnectWrap.afterConnect [as oncomplete] (node:net:1229:16)

  ●  › should override controller options with action transformRequest option

    expect.assertions(4)

    Expected four assertions to be called but received zero assertion calls.

      72 | 
      73 |   it('should override controller options with action transformRequest option', async () => {
    > 74 |     expect.assertions(4);
         |            ^
      75 |     const response = await axios.post('/transformRequestOnly', user);
      76 |     expect(initializedUser).toBeInstanceOf(UserModel);
      77 |     expect(initializedUser.lastName).toBeUndefined();

      at Object.<anonymous> (test/functional/action-options.spec.ts:74:12)
      at processTicksAndRejections (node:internal/process/task_queues:95:5)

  ●  › should override controller options with action transformResponse option

    TypeError: require(...) is not a function

      16 | var contentType = require('content-type')
      17 | var createError = require('http-errors')
    > 18 | var debug = require('debug')('body-parser:json')
         |                             ^
      19 | var read = require('../read')
      20 | var typeis = require('type-is')
      21 | 

      at Object.<anonymous> (../../../VariantsDeps/body-parser/variant3/body-parser/lib/types/json.js:18:29)
      at loadParser (../../../VariantsDeps/body-parser/variant3/body-parser/index.js:142:16)
      at Function.get [as json] (../../../VariantsDeps/body-parser/variant3/body-parser/index.js:123:12)
      at ExpressDriver.registerAction (src/driver/express/ExpressDriver.ts:104:54)
      at src/RoutingControllers.ts:81:21
          at Array.forEach (<anonymous>)

  ●  › should override controller options with action transformResponse option

    connect ECONNREFUSED 127.0.0.1:3001

      at TCPConnectWrap.afterConnect [as oncomplete] (node:net:1229:16)

  ●  › should override controller options with action transformResponse option

    expect.assertions(4)

    Expected four assertions to be called but received zero assertion calls.

      81 | 
      82 |   it('should override controller options with action transformResponse option', async () => {
    > 83 |     expect.assertions(4);
         |            ^
      84 |     const response = await axios.post('/transformResponseOnly', user);
      85 |     expect(initializedUser).not.toBeInstanceOf(UserModel);
      86 |     expect(initializedUser.lastName).not.toBeUndefined();

      at Object.<anonymous> (test/functional/action-options.spec.ts:83:12)
      at processTicksAndRejections (node:internal/process/task_queues:95:5)

FAIL test/functional/global-options.spec.ts
  ●  › routing-controllers global options › useClassTransformer default value › useClassTransformer by default must be set to true

    TypeError: require(...) is not a function

      16 | var contentType = require('content-type')
      17 | var createError = require('http-errors')
    > 18 | var debug = require('debug')('body-parser:json')
         |                             ^
      19 | var read = require('../read')
      20 | var typeis = require('type-is')
      21 | 

      at Object.<anonymous> (../../../VariantsDeps/body-parser/variant3/body-parser/lib/types/json.js:18:29)
      at loadParser (../../../VariantsDeps/body-parser/variant3/body-parser/index.js:142:16)
      at Function.get [as json] (../../../VariantsDeps/body-parser/variant3/body-parser/index.js:123:12)
      at ExpressDriver.registerAction (src/driver/express/ExpressDriver.ts:104:54)
      at src/RoutingControllers.ts:81:21
          at Array.forEach (<anonymous>)

  ●  › routing-controllers global options › useClassTransformer default value › useClassTransformer by default must be set to true

    connect ECONNREFUSED 127.0.0.1:3001

      at TCPConnectWrap.afterConnect [as oncomplete] (node:net:1229:16)

  ●  › routing-controllers global options › useClassTransformer default value › useClassTransformer by default must be set to true

    TypeError: Cannot read properties of undefined (reading 'close')

      52 | 
      53 |       afterEach((done: DoneCallback) => {
    > 54 |         expressServer.close(done);
         |                       ^
      55 |       });
      56 | 
      57 |       it('useClassTransformer by default must be set to true', async () => {

      at Object.<anonymous> (test/functional/global-options.spec.ts:54:23)
      at processTicksAndRejections (node:internal/process/task_queues:95:5)

  ●  › routing-controllers global options › useClassTransformer default value › useClassTransformer by default must be set to true

    expect.assertions(2)

    Expected two assertions to be called but received zero assertion calls.

      56 | 
      57 |       it('useClassTransformer by default must be set to true', async () => {
    > 58 |         expect.assertions(2);
         |                ^
      59 |         const response = await axios.post('/users', user);
      60 |         expect(initializedUser).toBeInstanceOf(User);
      61 |         expect(response.status).toEqual(HttpStatusCodes.OK);

      at Object.<anonymous> (test/functional/global-options.spec.ts:58:16)

  ●  › routing-controllers global options › when useClassTransformer is set to true › useClassTransformer is enabled

    TypeError: this.loadBodyParser(...).json is not a function

      102 |     if (actionMetadata.isBodyUsed) {
      103 |       if (actionMetadata.isJsonTyped) {
    > 104 |         defaultMiddlewares.push(this.loadBodyParser().json(actionMetadata.bodyExtraOptions));
          |                                                       ^
      105 |       } else {
      106 |         defaultMiddlewares.push(this.loadBodyParser().text(actionMetadata.bodyExtraOptions));
      107 |       }

      at ExpressDriver.registerAction (src/driver/express/ExpressDriver.ts:104:55)
      at src/RoutingControllers.ts:81:21
          at Array.forEach (<anonymous>)
      at src/RoutingControllers.ts:75:26
          at Array.forEach (<anonymous>)
      at RoutingControllers.registerControllers (src/RoutingControllers.ts:74:17)
      at createExecutor (src/index.ts:219:6)
      at createServer (src/index.ts:148:3)
      at Object.createExpressServer (src/index.ts:125:10)
      at Object.<anonymous> (test/functional/global-options.spec.ts:82:25)

  ●  › routing-controllers global options › when useClassTransformer is set to true › useClassTransformer is enabled

    connect ECONNREFUSED 127.0.0.1:3001

      at TCPConnectWrap.afterConnect [as oncomplete] (node:net:1229:16)

  ●  › routing-controllers global options › when useClassTransformer is set to true › useClassTransformer is enabled

    TypeError: Cannot read properties of undefined (reading 'close')

      88 | 
      89 |       afterEach((done: DoneCallback) => {
    > 90 |         expressServer.close(done);
         |                       ^
      91 |       });
      92 | 
      93 |       it('useClassTransformer is enabled', async () => {

      at Object.<anonymous> (test/functional/global-options.spec.ts:90:23)
      at processTicksAndRejections (node:internal/process/task_queues:95:5)

  ●  › routing-controllers global options › when useClassTransformer is set to true › useClassTransformer is enabled

    expect.assertions(2)

    Expected two assertions to be called but received zero assertion calls.

      92 | 
      93 |       it('useClassTransformer is enabled', async () => {
    > 94 |         expect.assertions(2);
         |                ^
      95 |         const response = await axios.post('/users', user);
      96 |         expect(initializedUser).toBeInstanceOf(User);
      97 |         expect(response.status).toEqual(HttpStatusCodes.OK);

      at Object.<anonymous> (test/functional/global-options.spec.ts:94:16)
      at processTicksAndRejections (node:internal/process/task_queues:95:5)

  ●  › routing-controllers global options › when useClassTransformer is set to false › useClassTransformer is disabled

    TypeError: this.loadBodyParser(...).json is not a function

      102 |     if (actionMetadata.isBodyUsed) {
      103 |       if (actionMetadata.isJsonTyped) {
    > 104 |         defaultMiddlewares.push(this.loadBodyParser().json(actionMetadata.bodyExtraOptions));
          |                                                       ^
      105 |       } else {
      106 |         defaultMiddlewares.push(this.loadBodyParser().text(actionMetadata.bodyExtraOptions));
      107 |       }

      at ExpressDriver.registerAction (src/driver/express/ExpressDriver.ts:104:55)
      at src/RoutingControllers.ts:81:21
          at Array.forEach (<anonymous>)
      at src/RoutingControllers.ts:75:26
          at Array.forEach (<anonymous>)
      at RoutingControllers.registerControllers (src/RoutingControllers.ts:74:17)
      at createExecutor (src/index.ts:219:6)
      at createServer (src/index.ts:148:3)
      at Object.createExpressServer (src/index.ts:125:10)
      at Object.<anonymous> (test/functional/global-options.spec.ts:118:25)

  ●  › routing-controllers global options › when useClassTransformer is set to false › useClassTransformer is disabled

    connect ECONNREFUSED 127.0.0.1:3001

      at TCPConnectWrap.afterConnect [as oncomplete] (node:net:1229:16)

  ●  › routing-controllers global options › when useClassTransformer is set to false › useClassTransformer is disabled

    TypeError: Cannot read properties of undefined (reading 'close')

      124 | 
      125 |       afterEach((done: DoneCallback) => {
    > 126 |         expressServer.close(done);
          |                       ^
      127 |       });
      128 | 
      129 |       it('useClassTransformer is disabled', async () => {

      at Object.<anonymous> (test/functional/global-options.spec.ts:126:23)
      at processTicksAndRejections (node:internal/process/task_queues:95:5)

  ●  › routing-controllers global options › when useClassTransformer is set to false › useClassTransformer is disabled

    expect.assertions(2)

    Expected two assertions to be called but received zero assertion calls.

      128 | 
      129 |       it('useClassTransformer is disabled', async () => {
    > 130 |         expect.assertions(2);
          |                ^
      131 |         const response = await axios.post('/users', user);
      132 |         expect(initializedUser).not.toBeInstanceOf(User);
      133 |         expect(response.status).toEqual(HttpStatusCodes.OK);

      at Object.<anonymous> (test/functional/global-options.spec.ts:130:16)
      at processTicksAndRejections (node:internal/process/task_queues:95:5)

  ●  › routing-controllers global options › when routePrefix is used all controller routes should be appended by it › routePrefix is enabled

    TypeError: this.loadBodyParser(...).json is not a function

      102 |     if (actionMetadata.isBodyUsed) {
      103 |       if (actionMetadata.isJsonTyped) {
    > 104 |         defaultMiddlewares.push(this.loadBodyParser().json(actionMetadata.bodyExtraOptions));
          |                                                       ^
      105 |       } else {
      106 |         defaultMiddlewares.push(this.loadBodyParser().text(actionMetadata.bodyExtraOptions));
      107 |       }

      at ExpressDriver.registerAction (src/driver/express/ExpressDriver.ts:104:55)
      at src/RoutingControllers.ts:81:21
          at Array.forEach (<anonymous>)
      at src/RoutingControllers.ts:75:26
          at Array.forEach (<anonymous>)
      at RoutingControllers.registerControllers (src/RoutingControllers.ts:74:17)
      at createExecutor (src/index.ts:219:6)
      at createServer (src/index.ts:148:3)
      at Object.createExpressServer (src/index.ts:125:10)
      at Object.<anonymous> (test/functional/global-options.spec.ts:154:25)

  ●  › routing-controllers global options › when routePrefix is used all controller routes should be appended by it › routePrefix is enabled

    connect ECONNREFUSED 127.0.0.1:3001

      at TCPConnectWrap.afterConnect [as oncomplete] (node:net:1229:16)

  ●  › routing-controllers global options › when routePrefix is used all controller routes should be appended by it › routePrefix is enabled

    TypeError: Cannot read properties of undefined (reading 'close')

      160 | 
      161 |       afterEach((done: DoneCallback) => {
    > 162 |         expressServer.close(done);
          |                       ^
      163 |       });
      164 | 
      165 |       it('routePrefix is enabled', async () => {

      at Object.<anonymous> (test/functional/global-options.spec.ts:162:23)
      at processTicksAndRejections (node:internal/process/task_queues:95:5)

  ●  › routing-controllers global options › when routePrefix is used all controller routes should be appended by it › routePrefix is enabled

    expect.assertions(4)

    Expected four assertions to be called but received zero assertion calls.

      164 | 
      165 |       it('routePrefix is enabled', async () => {
    > 166 |         expect.assertions(4);
          |                ^
      167 |         let response = await axios.post('/api/users', user);
      168 |         expect(initializedUser).toBeInstanceOf(User);
      169 |         expect(response.status).toEqual(HttpStatusCodes.OK);

      at Object.<anonymous> (test/functional/global-options.spec.ts:166:16)
      at processTicksAndRejections (node:internal/process/task_queues:95:5)


Test Suites: 5 failed, 21 passed, 26 total
Tests:       12 failed, 124 passed, 136 total
Snapshots:   0 total
Time:        12.083 s, estimated 13 s
Ran all test suites.
ts-jest[config] (WARN) The option `tsConfig` is deprecated and will be removed in ts-jest 27, use `tsconfig` instead
FAIL test/ActionParameterHandler.spec.ts
  ActionParameterHandler
    positive
      ✓ handle - should process string parameters (27 ms)
      ✓ handle - should process string parameters, returns empty if a given string is empty (1 ms)
      ✓ handle - should process number parameters
      ✓ handle - undefined on empty object provided (1 ms)
      ✓ handle - null provided (17 ms)
    negative
      ✕ handle - throws error if the parameter is required (7 ms)
      ✓ handle - throws error if the parameter is required, type file provided (1 ms)

  ● ActionParameterHandler › negative › handle - throws error if the parameter is required

    Expected value   "TypeError: Cannot read property 'uuid' of undefined"
    Received:
      "TypeError: Cannot read properties of undefined (reading 'uuid')"

    Message:
      expected 'TypeError: Cannot read properties of undefined (reading \'uuid\')' to equal 'TypeError: Cannot read property \'uuid\' of undefined'

    Difference:

    - Expected
    + Received

    - TypeError: Cannot read property 'uuid' of undefined
    + TypeError: Cannot read properties of undefined (reading 'uuid')

      152 |       }
      153 | 
    > 154 |       expect(error.toString()).to.be.eq("TypeError: Cannot read property 'uuid' of undefined");
          |                                      ^
      155 |     });
      156 | 
      157 |     it('handle - throws error if the parameter is required, type file provided', async () => {

      at Object.<anonymous> (test/ActionParameterHandler.spec.ts:154:38)

FAIL test/functional/action-params.spec.ts
    ✕ encountered a declaration exception (2 ms)

  ●  › encountered a declaration exception

    TypeError: inherits is not a function

      15 | var bytes = require('bytes')
      16 | var contentType = require('content-type')
    > 17 | var createError = require('http-errors')
         |                   ^
      18 | var debug = require('debug')('body-parser:urlencoded')
      19 | var deprecate = require('depd')('body-parser')
      20 | var read = require('../read')

      at createHttpErrorConstructor (../../../VariantsDeps/body-parser/variant2/body-parser/node_modules/http-errors/index.js:117:3)
      at Object.<anonymous> (../../../VariantsDeps/body-parser/variant2/body-parser/node_modules/http-errors/index.js:27:28)
      at Object.<anonymous> (../../../VariantsDeps/body-parser/variant2/body-parser/lib/types/urlencoded.js:17:19)

FAIL test/functional/controller-options.spec.ts
    controller options
      ✕ controller transform is enabled by default (19 ms)
      ✕ when controller transform is enabled (4 ms)
      ✕ when controller transform is disabled (3 ms)

  ●  › controller options › controller transform is enabled by default

    TypeError: inherits is not a function

      15 | var bytes = require('bytes')
      16 | var contentType = require('content-type')
    > 17 | var createError = require('http-errors')
         |                   ^
      18 | var debug = require('debug')('body-parser:json')
      19 | var read = require('../read')
      20 | var typeis = require('type-is')

      at createHttpErrorConstructor (../../../VariantsDeps/body-parser/variant2/body-parser/node_modules/http-errors/index.js:117:3)
      at Object.<anonymous> (../../../VariantsDeps/body-parser/variant2/body-parser/node_modules/http-errors/index.js:27:28)
      at Object.<anonymous> (../../../VariantsDeps/body-parser/variant2/body-parser/lib/types/json.js:17:19)

  ●  › controller options › controller transform is enabled by default

    expect.assertions(4)

    Expected four assertions to be called but received zero assertion calls.

      71 | 
      72 |     it('controller transform is enabled by default', async () => {
    > 73 |       expect.assertions(4);
         |              ^
      74 |       try {
      75 |         const response = await axios.post('/default', user);
      76 |         expect(initializedUser).toBeInstanceOf(UserModel);

      at Object.<anonymous> (test/functional/controller-options.spec.ts:73:14)

  ●  › controller options › when controller transform is enabled

    TypeError: inherits is not a function

      15 | var bytes = require('bytes')
      16 | var contentType = require('content-type')
    > 17 | var createError = require('http-errors')
         |                   ^
      18 | var debug = require('debug')('body-parser:json')
      19 | var read = require('../read')
      20 | var typeis = require('type-is')

      at createHttpErrorConstructor (../../../VariantsDeps/body-parser/variant2/body-parser/node_modules/http-errors/index.js:117:3)
      at Object.<anonymous> (../../../VariantsDeps/body-parser/variant2/body-parser/node_modules/http-errors/index.js:27:28)
      at Object.<anonymous> (../../../VariantsDeps/body-parser/variant2/body-parser/lib/types/json.js:17:19)

  ●  › controller options › when controller transform is enabled

    expect.assertions(4)

    Expected four assertions to be called but received zero assertion calls.

      84 | 
      85 |     it('when controller transform is enabled', async () => {
    > 86 |       expect.assertions(4);
         |              ^
      87 |       try {
      88 |         const response = await axios.post('/transform', user);
      89 |         expect(initializedUser).toBeInstanceOf(UserModel);

      at Object.<anonymous> (test/functional/controller-options.spec.ts:86:14)
      at processTicksAndRejections (node:internal/process/task_queues:95:5)

  ●  › controller options › when controller transform is disabled

    TypeError: inherits is not a function

      15 | var bytes = require('bytes')
      16 | var contentType = require('content-type')
    > 17 | var createError = require('http-errors')
         |                   ^
      18 | var debug = require('debug')('body-parser:json')
      19 | var read = require('../read')
      20 | var typeis = require('type-is')

      at createHttpErrorConstructor (../../../VariantsDeps/body-parser/variant2/body-parser/node_modules/http-errors/index.js:117:3)
      at Object.<anonymous> (../../../VariantsDeps/body-parser/variant2/body-parser/node_modules/http-errors/index.js:27:28)
      at Object.<anonymous> (../../../VariantsDeps/body-parser/variant2/body-parser/lib/types/json.js:17:19)

  ●  › controller options › when controller transform is disabled

    expect.assertions(4)

    Expected four assertions to be called but received zero assertion calls.

       97 | 
       98 |     it('when controller transform is disabled', async () => {
    >  99 |       expect.assertions(4);
          |              ^
      100 |       try {
      101 |         const response = await axios.post('/noTransform', user);
      102 |         expect(initializedUser).toMatchObject(user);

      at Object.<anonymous> (test/functional/controller-options.spec.ts:99:14)
      at processTicksAndRejections (node:internal/process/task_queues:95:5)

FAIL test/functional/global-options.spec.ts
    routing-controllers global options
      useClassTransformer default value
        ✕ useClassTransformer by default must be set to true (53 ms)
      when useClassTransformer is set to true
        ✕ useClassTransformer is enabled (24 ms)
      when useClassTransformer is set to false
        ✕ useClassTransformer is disabled (3 ms)
      when routePrefix is used all controller routes should be appended by it
        ✕ routePrefix is enabled (3 ms)

  ●  › routing-controllers global options › useClassTransformer default value › useClassTransformer by default must be set to true

    TypeError: inherits is not a function

      15 | var bytes = require('bytes')
      16 | var contentType = require('content-type')
    > 17 | var createError = require('http-errors')
         |                   ^
      18 | var debug = require('debug')('body-parser:json')
      19 | var read = require('../read')
      20 | var typeis = require('type-is')

      at createHttpErrorConstructor (../../../VariantsDeps/body-parser/variant2/body-parser/node_modules/http-errors/index.js:117:3)
      at Object.<anonymous> (../../../VariantsDeps/body-parser/variant2/body-parser/node_modules/http-errors/index.js:27:28)
      at Object.<anonymous> (../../../VariantsDeps/body-parser/variant2/body-parser/lib/types/json.js:17:19)

  ●  › routing-controllers global options › useClassTransformer default value › useClassTransformer by default must be set to true

    connect ECONNREFUSED 127.0.0.1:3001

      at TCPConnectWrap.afterConnect [as oncomplete] (node:net:1229:16)

  ●  › routing-controllers global options › useClassTransformer default value › useClassTransformer by default must be set to true

    TypeError: Cannot read properties of undefined (reading 'close')

      52 | 
      53 |       afterEach((done: DoneCallback) => {
    > 54 |         expressServer.close(done);
         |                       ^
      55 |       });
      56 | 
      57 |       it('useClassTransformer by default must be set to true', async () => {

      at Object.<anonymous> (test/functional/global-options.spec.ts:54:23)
      at processTicksAndRejections (node:internal/process/task_queues:95:5)

  ●  › routing-controllers global options › useClassTransformer default value › useClassTransformer by default must be set to true

    expect.assertions(2)

    Expected two assertions to be called but received zero assertion calls.

      56 | 
      57 |       it('useClassTransformer by default must be set to true', async () => {
    > 58 |         expect.assertions(2);
         |                ^
      59 |         const response = await axios.post('/users', user);
      60 |         expect(initializedUser).toBeInstanceOf(User);
      61 |         expect(response.status).toEqual(HttpStatusCodes.OK);

      at Object.<anonymous> (test/functional/global-options.spec.ts:58:16)

  ●  › routing-controllers global options › when useClassTransformer is set to true › useClassTransformer is enabled

    TypeError: this.loadBodyParser(...).json is not a function

      102 |     if (actionMetadata.isBodyUsed) {
      103 |       if (actionMetadata.isJsonTyped) {
    > 104 |         defaultMiddlewares.push(this.loadBodyParser().json(actionMetadata.bodyExtraOptions));
          |                                                       ^
      105 |       } else {
      106 |         defaultMiddlewares.push(this.loadBodyParser().text(actionMetadata.bodyExtraOptions));
      107 |       }

      at ExpressDriver.registerAction (src/driver/express/ExpressDriver.ts:104:55)
      at src/RoutingControllers.ts:81:21
          at Array.forEach (<anonymous>)
      at src/RoutingControllers.ts:75:26
          at Array.forEach (<anonymous>)
      at RoutingControllers.registerControllers (src/RoutingControllers.ts:74:17)
      at createExecutor (src/index.ts:219:6)
      at createServer (src/index.ts:148:3)
      at Object.createExpressServer (src/index.ts:125:10)
      at Object.<anonymous> (test/functional/global-options.spec.ts:82:25)

  ●  › routing-controllers global options › when useClassTransformer is set to true › useClassTransformer is enabled

    connect ECONNREFUSED 127.0.0.1:3001

      at TCPConnectWrap.afterConnect [as oncomplete] (node:net:1229:16)

  ●  › routing-controllers global options › when useClassTransformer is set to true › useClassTransformer is enabled

    TypeError: Cannot read properties of undefined (reading 'close')

      88 | 
      89 |       afterEach((done: DoneCallback) => {
    > 90 |         expressServer.close(done);
         |                       ^
      91 |       });
      92 | 
      93 |       it('useClassTransformer is enabled', async () => {

      at Object.<anonymous> (test/functional/global-options.spec.ts:90:23)
      at processTicksAndRejections (node:internal/process/task_queues:95:5)

  ●  › routing-controllers global options › when useClassTransformer is set to true › useClassTransformer is enabled

    expect.assertions(2)

    Expected two assertions to be called but received zero assertion calls.

      92 | 
      93 |       it('useClassTransformer is enabled', async () => {
    > 94 |         expect.assertions(2);
         |                ^
      95 |         const response = await axios.post('/users', user);
      96 |         expect(initializedUser).toBeInstanceOf(User);
      97 |         expect(response.status).toEqual(HttpStatusCodes.OK);

      at Object.<anonymous> (test/functional/global-options.spec.ts:94:16)
      at processTicksAndRejections (node:internal/process/task_queues:95:5)

  ●  › routing-controllers global options › when useClassTransformer is set to false › useClassTransformer is disabled

    TypeError: this.loadBodyParser(...).json is not a function

      102 |     if (actionMetadata.isBodyUsed) {
      103 |       if (actionMetadata.isJsonTyped) {
    > 104 |         defaultMiddlewares.push(this.loadBodyParser().json(actionMetadata.bodyExtraOptions));
          |                                                       ^
      105 |       } else {
      106 |         defaultMiddlewares.push(this.loadBodyParser().text(actionMetadata.bodyExtraOptions));
      107 |       }

      at ExpressDriver.registerAction (src/driver/express/ExpressDriver.ts:104:55)
      at src/RoutingControllers.ts:81:21
          at Array.forEach (<anonymous>)
      at src/RoutingControllers.ts:75:26
          at Array.forEach (<anonymous>)
      at RoutingControllers.registerControllers (src/RoutingControllers.ts:74:17)
      at createExecutor (src/index.ts:219:6)
      at createServer (src/index.ts:148:3)
      at Object.createExpressServer (src/index.ts:125:10)
      at Object.<anonymous> (test/functional/global-options.spec.ts:118:25)

  ●  › routing-controllers global options › when useClassTransformer is set to false › useClassTransformer is disabled

    connect ECONNREFUSED 127.0.0.1:3001

      at TCPConnectWrap.afterConnect [as oncomplete] (node:net:1229:16)

  ●  › routing-controllers global options › when useClassTransformer is set to false › useClassTransformer is disabled

    TypeError: Cannot read properties of undefined (reading 'close')

      124 | 
      125 |       afterEach((done: DoneCallback) => {
    > 126 |         expressServer.close(done);
          |                       ^
      127 |       });
      128 | 
      129 |       it('useClassTransformer is disabled', async () => {

      at Object.<anonymous> (test/functional/global-options.spec.ts:126:23)
      at processTicksAndRejections (node:internal/process/task_queues:95:5)

  ●  › routing-controllers global options › when useClassTransformer is set to false › useClassTransformer is disabled

    expect.assertions(2)

    Expected two assertions to be called but received zero assertion calls.

      128 | 
      129 |       it('useClassTransformer is disabled', async () => {
    > 130 |         expect.assertions(2);
          |                ^
      131 |         const response = await axios.post('/users', user);
      132 |         expect(initializedUser).not.toBeInstanceOf(User);
      133 |         expect(response.status).toEqual(HttpStatusCodes.OK);

      at Object.<anonymous> (test/functional/global-options.spec.ts:130:16)
      at processTicksAndRejections (node:internal/process/task_queues:95:5)

  ●  › routing-controllers global options › when routePrefix is used all controller routes should be appended by it › routePrefix is enabled

    TypeError: this.loadBodyParser(...).json is not a function

      102 |     if (actionMetadata.isBodyUsed) {
      103 |       if (actionMetadata.isJsonTyped) {
    > 104 |         defaultMiddlewares.push(this.loadBodyParser().json(actionMetadata.bodyExtraOptions));
          |                                                       ^
      105 |       } else {
      106 |         defaultMiddlewares.push(this.loadBodyParser().text(actionMetadata.bodyExtraOptions));
      107 |       }

      at ExpressDriver.registerAction (src/driver/express/ExpressDriver.ts:104:55)
      at src/RoutingControllers.ts:81:21
          at Array.forEach (<anonymous>)
      at src/RoutingControllers.ts:75:26
          at Array.forEach (<anonymous>)
      at RoutingControllers.registerControllers (src/RoutingControllers.ts:74:17)
      at createExecutor (src/index.ts:219:6)
      at createServer (src/index.ts:148:3)
      at Object.createExpressServer (src/index.ts:125:10)
      at Object.<anonymous> (test/functional/global-options.spec.ts:154:25)

  ●  › routing-controllers global options › when routePrefix is used all controller routes should be appended by it › routePrefix is enabled

    connect ECONNREFUSED 127.0.0.1:3001

      at TCPConnectWrap.afterConnect [as oncomplete] (node:net:1229:16)

  ●  › routing-controllers global options › when routePrefix is used all controller routes should be appended by it › routePrefix is enabled

    TypeError: Cannot read properties of undefined (reading 'close')

      160 | 
      161 |       afterEach((done: DoneCallback) => {
    > 162 |         expressServer.close(done);
          |                       ^
      163 |       });
      164 | 
      165 |       it('routePrefix is enabled', async () => {

      at Object.<anonymous> (test/functional/global-options.spec.ts:162:23)
      at processTicksAndRejections (node:internal/process/task_queues:95:5)

  ●  › routing-controllers global options › when routePrefix is used all controller routes should be appended by it › routePrefix is enabled

    expect.assertions(4)

    Expected four assertions to be called but received zero assertion calls.

      164 | 
      165 |       it('routePrefix is enabled', async () => {
    > 166 |         expect.assertions(4);
          |                ^
      167 |         let response = await axios.post('/api/users', user);
      168 |         expect(initializedUser).toBeInstanceOf(User);
      169 |         expect(response.status).toEqual(HttpStatusCodes.OK);

      at Object.<anonymous> (test/functional/global-options.spec.ts:166:16)
      at processTicksAndRejections (node:internal/process/task_queues:95:5)

FAIL test/functional/action-options.spec.ts
    ✕ should use controller options when action transform options are not set (5 ms)
    ✕ should override controller options with action transformRequest option (2 ms)
    ✕ should override controller options with action transformResponse option (1 ms)

  ●  › should use controller options when action transform options are not set

    TypeError: inherits is not a function

      15 | var bytes = require('bytes')
      16 | var contentType = require('content-type')
    > 17 | var createError = require('http-errors')
         |                   ^
      18 | var debug = require('debug')('body-parser:json')
      19 | var read = require('../read')
      20 | var typeis = require('type-is')

      at createHttpErrorConstructor (../../../VariantsDeps/body-parser/variant2/body-parser/node_modules/http-errors/index.js:117:3)
      at Object.<anonymous> (../../../VariantsDeps/body-parser/variant2/body-parser/node_modules/http-errors/index.js:27:28)
      at Object.<anonymous> (../../../VariantsDeps/body-parser/variant2/body-parser/lib/types/json.js:17:19)

  ●  › should use controller options when action transform options are not set

    connect ECONNREFUSED 127.0.0.1:3001

      at TCPConnectWrap.afterConnect [as oncomplete] (node:net:1229:16)

  ●  › should use controller options when action transform options are not set

    expect.assertions(4)

    Expected four assertions to be called but received zero assertion calls.

      63 | 
      64 |   it('should use controller options when action transform options are not set', async () => {
    > 65 |     expect.assertions(4);
         |            ^
      66 |     const response = await axios.post('/default', user);
      67 |     expect(initializedUser).toBeInstanceOf(UserModel);
      68 |     expect(initializedUser.lastName).toBeUndefined();

      at Object.<anonymous> (test/functional/action-options.spec.ts:65:12)

  ●  › should override controller options with action transformRequest option

    TypeError: inherits is not a function

      15 | var bytes = require('bytes')
      16 | var contentType = require('content-type')
    > 17 | var createError = require('http-errors')
         |                   ^
      18 | var debug = require('debug')('body-parser:json')
      19 | var read = require('../read')
      20 | var typeis = require('type-is')

      at createHttpErrorConstructor (../../../VariantsDeps/body-parser/variant2/body-parser/node_modules/http-errors/index.js:117:3)
      at Object.<anonymous> (../../../VariantsDeps/body-parser/variant2/body-parser/node_modules/http-errors/index.js:27:28)
      at Object.<anonymous> (../../../VariantsDeps/body-parser/variant2/body-parser/lib/types/json.js:17:19)

  ●  › should override controller options with action transformRequest option

    connect ECONNREFUSED 127.0.0.1:3001

      at TCPConnectWrap.afterConnect [as oncomplete] (node:net:1229:16)

  ●  › should override controller options with action transformRequest option

    expect.assertions(4)

    Expected four assertions to be called but received zero assertion calls.

      72 | 
      73 |   it('should override controller options with action transformRequest option', async () => {
    > 74 |     expect.assertions(4);
         |            ^
      75 |     const response = await axios.post('/transformRequestOnly', user);
      76 |     expect(initializedUser).toBeInstanceOf(UserModel);
      77 |     expect(initializedUser.lastName).toBeUndefined();

      at Object.<anonymous> (test/functional/action-options.spec.ts:74:12)
      at processTicksAndRejections (node:internal/process/task_queues:95:5)

  ●  › should override controller options with action transformResponse option

    TypeError: inherits is not a function

      15 | var bytes = require('bytes')
      16 | var contentType = require('content-type')
    > 17 | var createError = require('http-errors')
         |                   ^
      18 | var debug = require('debug')('body-parser:json')
      19 | var read = require('../read')
      20 | var typeis = require('type-is')

      at createHttpErrorConstructor (../../../VariantsDeps/body-parser/variant2/body-parser/node_modules/http-errors/index.js:117:3)
      at Object.<anonymous> (../../../VariantsDeps/body-parser/variant2/body-parser/node_modules/http-errors/index.js:27:28)
      at Object.<anonymous> (../../../VariantsDeps/body-parser/variant2/body-parser/lib/types/json.js:17:19)

  ●  › should override controller options with action transformResponse option

    connect ECONNREFUSED 127.0.0.1:3001

      at TCPConnectWrap.afterConnect [as oncomplete] (node:net:1229:16)

  ●  › should override controller options with action transformResponse option

    expect.assertions(4)

    Expected four assertions to be called but received zero assertion calls.

      81 | 
      82 |   it('should override controller options with action transformResponse option', async () => {
    > 83 |     expect.assertions(4);
         |            ^
      84 |     const response = await axios.post('/transformResponseOnly', user);
      85 |     expect(initializedUser).not.toBeInstanceOf(UserModel);
      86 |     expect(initializedUser.lastName).not.toBeUndefined();

      at Object.<anonymous> (test/functional/action-options.spec.ts:83:12)
      at processTicksAndRejections (node:internal/process/task_queues:95:5)

PASS test/functional/controller-methods.spec.ts
    controller methods
      ✓ get should respond with proper status code, headers and body content (13 ms)
      ✓ post respond with proper status code, headers and body content (3 ms)
      ✓ put respond with proper status code, headers and body content (2 ms)
      ✓ patch respond with proper status code, headers and body content (3 ms)
      ✓ delete respond with proper status code, headers and body content (3 ms)
      ✓ head respond with proper status code, headers and body content (14 ms)
      ✓ custom method (post) respond with proper status code, headers and body content (3 ms)
      ✓ custom method (delete) respond with proper status code, headers and body content (2 ms)
      ✓ route should work with parameter (3 ms)
      ✓ route should work with regexp parameter (3 ms)
      ✓ should respond with 404 when regexp does not match (7 ms)
      ✓ route should work with string regexp parameter (2 ms)
      ✓ should respond with 404 when regexp does not match (2 ms)
      ✓ should return result from a promise (503 ms)
      ✓ should respond with 500 if promise failed (504 ms)
      ✓ should respond with 204 No Content when null returned in action (4 ms)
      ✓ should respond with 404 Not Found text when undefined returned in action (20 ms)
      ✓ should respond with 404 Not Found JSON when undefined returned in action (2 ms)
      ✓ should respond with 200 and text/html even in json controller's method (2 ms)
      ✓ should respond with 200 and text/plain even in json controller's method (2 ms)
      ✓ should respond with 401 and text/html when UnauthorizedError throwed even in json controller's method (4 ms)
      ✓ should respond with 401 and aplication/json when UnauthorizedError is thrown in standard json controller's method (3 ms)

PASS test/functional/json-controller-methods.spec.ts
    json-controller methods
      ✓ get should respond with proper status code, headers and body content (9 ms)
      ✓ post respond with proper status code, headers and body content (2 ms)
      ✓ put respond with proper status code, headers and body content (2 ms)
      ✓ patch respond with proper status code, headers and body content (3 ms)
      ✓ delete respond with proper status code, headers and body content (2 ms)
      ✓ head respond with proper status code, headers and body content (2 ms)
      ✓ custom method (post) respond with proper status code, headers and body content (3 ms)
      ✓ custom method (delete) respond with proper status code, headers and body content (2 ms)
      ✓ route should work with parameter (2 ms)
      ✓ route should work with regexp parameter (2 ms)
      ✓ should respond with 404 when regexp does not match (4 ms)
      ✓ route should work with string regexp parameter (3 ms)
      ✓ should respond with 404 when regexp does not match (2 ms)
      ✓ should return result from a promise (503 ms)
      ✓ should respond with 500 if promise failed (516 ms)

PASS test/functional/interceptors.spec.ts
    interceptor
      ✓ custom interceptor function should replace returned content (8 ms)
      ✓ custom interceptor class should replace returned content (3 ms)
      ✓ custom interceptor class used on the whole controller should replace returned content (2 ms)
      ✓ global interceptor class should replace returned content (3 ms)
      ✓ interceptors should support promises (1018 ms)

PASS test/functional/defaults.spec.ts
    defaults
      ✓ should return undefinedResultCode from defaults config for void function (8 ms)
      ✓ should return undefinedResultCode from defaults config for promise void function (2 ms)
      ✓ should return 400 from required paramOptions (15 ms)
      ✓ should return nullResultCode from defaults config (15 ms)
      ✓ should return status code from OnUndefined annotation (3 ms)
      ✓ should mark arg optional from QueryParam annotation (4 ms)

PASS test/functional/auth-decorator.spec.ts
    Controller responds with value when Authorization succeeds (async)
      ✓ without roles (66 ms)
      ✓ with roles (14 ms)
      ✓ async (25 ms)
    Controller responds with value when Authorization succeeds (sync)
      ✓ without roles (4 ms)
      ✓ with roles (3 ms)
      ✓ async (13 ms)
    Authorized Decorators Http Status Code
      ✓ without roles (19 ms)
      ✓ with roles (5 ms)
    Authorization checker allows to throw (async)
      ✓ custom errors (7 ms)
    Authorization checker allows to throw (sync)
      ✓ custom errors (5 ms)

PASS test/functional/other-controller-decorators.spec.ts
    other controller decorators
      ✓ should return httpCode set by @HttpCode decorator (11 ms)
      ✓ should return custom code when @OnNull (28 ms)
      ✓ should return custom error message and code when @OnUndefined is used with Error class (7 ms)
      ✓ should return custom code when @OnUndefined (8 ms)
      ✓ should return content-type in the response when @ContentType is used (2 ms)
      ✓ should return content-type in the response when @ContentType is used (3 ms)
      ✓ should return response with custom headers when @Header is used (5 ms)
      ✓ should relocate to new location when @Location is used (2 ms)

PASS test/functional/load-from-directory.spec.ts
    loading all controllers from the given directories
      ✓ should load all controllers (57 ms)
    loading all express middlewares and error handlers from the given directories
      ✓ should succeed (32 ms)
      ✓ should fail (68 ms)

PASS test/functional/redirect-decorator.spec.ts
    dynamic redirect
      ✓ using template (15 ms)
      ✓ using override (3 ms)
      ✓ using original (4 ms)

PASS test/functional/express-error-handling.spec.ts
    express error handling
      ✓ should not call global error handler middleware if there was no errors (9 ms)
      ✓ should call global error handler middleware (19 ms)
      ✓ should call global error handler middleware (5 ms)
      ✓ should call error handler middleware if used (3 ms)
      ✓ should not execute next middleware if soft error handled specifically and stopped error bubbling (3 ms)
      ✓ should process JsonErrors by their toJSON method if it exists (2 ms)

PASS test/functional/class-transformer-options.spec.ts
    should not use any options if not set
      ✓ technical wrapper (47 ms)
    should apply global options
      ✓ technical wrapper (6 ms)
    should apply local options
      ✓ technical wrapper (19 ms)

PASS test/functional/container.spec.ts
    using typedi container should be possible
      ✓ typedi container (53 ms)
    using custom container should be possible
      ✓ custom container (5 ms)
    using custom container with fallback should be possible
      ✓ custom container with fallback (8 ms)
    using custom container with fallback and fallback on throw error should be possible
      ✓ custom container with fallback and fallback on throw error (7 ms)

PASS test/unit/controller-inheritance.spec.ts
  controller inheritance
    ✓ should build empty meta for empty set (11 ms)
    ✓ should build meta if the only derivative controller is given (2 ms)
    ✓ should build meta if the only autonomous controller is given (1 ms)
    ✓ should build meta both when autonomous and derivative controllers are given (1 ms)

PASS test/functional/controller-base-routes.spec.ts
    controller > base routes functionality
      ✓ get should respond with proper status code, headers and body content (56 ms)
      ✓ get should respond with proper status code, headers and body content (5 ms)
      ✓ get should respond with proper status code, headers and body content - 2nd pass (4 ms)
      ✓ wrong route should respond with 404 error (4 ms)
      ✓ wrong route should respond with 404 error (3 ms)
      ✓ wrong route should respond with 404 error (2 ms)

PASS test/functional/class-validator-options.spec.ts
    no options
      ✓ should not use any options if not set (53 ms)
    global options
      should merge local validation options with global validation options prioritizing local
        ✓ succeed (5 ms)
      should pass the valid param after validation
        ✓ succeed (4 ms)
        ✓ should contain param name on validation failed (15 ms)
    local options
      ✓ should apply local options (6 ms)

PASS test/functional/express-middlewares.spec.ts
    express middlewares
      ✓ should call a global middlewares (20 ms)
      ✓ should use a custom middleware when @UseBefore or @UseAfter is used (3 ms)
      ✓ should call middleware and call it before controller action when @UseBefore is used (2 ms)
      ✓ should call middleware and call it after controller action when @UseAfter is used (2 ms)
      ✓ should call before middleware and call after middleware when @UseAfter and @UseAfter are used (2 ms)
      ✓ should handle errors in custom middlewares (23 ms)

PASS test/functional/express-custom-error-handling.spec.ts
    custom express error handling
      ✓ should not call global error handler middleware if there was no errors (21 ms)
      ✓ should call global error handler middleware (19 ms)

PASS test/functional/render-decorator.spec.ts
    template rendering
      ✓ should render a template and use given variables (28 ms)
      ✓ should render a template with given variables and locals variables (4 ms)

PASS test/functional/special-result-send.spec.ts
    special result value treatment
      ✓ should pipe stream to response (23 ms)
      ✓ should send raw binary data from Buffer (2 ms)
      ✓ should send raw binary data from UIntArray (3 ms)

PASS test/functional/express-global-before-error-handling.spec.ts
    custom express global before middleware error handling
      ✓ should call global error handler middleware with CustomError (37 ms)

PASS test/functional/middlewares-order.spec.ts
    loaded direct from array
      ✓ should call middlewares in order defined by items order (11 ms)
    specified by priority option
      ✓ should call middlewares in order defined by priority parameter of decorator (16 ms)

PASS test/functional/error-subclasses.spec.ts
  HttpError
    ✓ should be instance of HttpError and Error (3 ms)
  BadRequestError
    ✓ should be instance of BadRequestError, HttpError and Error (1 ms)

Summary of all failing tests
FAIL test/ActionParameterHandler.spec.ts
  ● ActionParameterHandler › negative › handle - throws error if the parameter is required

    Expected value   "TypeError: Cannot read property 'uuid' of undefined"
    Received:
      "TypeError: Cannot read properties of undefined (reading 'uuid')"

    Message:
      expected 'TypeError: Cannot read properties of undefined (reading \'uuid\')' to equal 'TypeError: Cannot read property \'uuid\' of undefined'

    Difference:

    - Expected
    + Received

    - TypeError: Cannot read property 'uuid' of undefined
    + TypeError: Cannot read properties of undefined (reading 'uuid')

      152 |       }
      153 | 
    > 154 |       expect(error.toString()).to.be.eq("TypeError: Cannot read property 'uuid' of undefined");
          |                                      ^
      155 |     });
      156 | 
      157 |     it('handle - throws error if the parameter is required, type file provided', async () => {

      at Object.<anonymous> (test/ActionParameterHandler.spec.ts:154:38)

FAIL test/functional/action-params.spec.ts
  ●  › encountered a declaration exception

    TypeError: inherits is not a function

      15 | var bytes = require('bytes')
      16 | var contentType = require('content-type')
    > 17 | var createError = require('http-errors')
         |                   ^
      18 | var debug = require('debug')('body-parser:urlencoded')
      19 | var deprecate = require('depd')('body-parser')
      20 | var read = require('../read')

      at createHttpErrorConstructor (../../../VariantsDeps/body-parser/variant2/body-parser/node_modules/http-errors/index.js:117:3)
      at Object.<anonymous> (../../../VariantsDeps/body-parser/variant2/body-parser/node_modules/http-errors/index.js:27:28)
      at Object.<anonymous> (../../../VariantsDeps/body-parser/variant2/body-parser/lib/types/urlencoded.js:17:19)

FAIL test/functional/controller-options.spec.ts
  ●  › controller options › controller transform is enabled by default

    TypeError: inherits is not a function

      15 | var bytes = require('bytes')
      16 | var contentType = require('content-type')
    > 17 | var createError = require('http-errors')
         |                   ^
      18 | var debug = require('debug')('body-parser:json')
      19 | var read = require('../read')
      20 | var typeis = require('type-is')

      at createHttpErrorConstructor (../../../VariantsDeps/body-parser/variant2/body-parser/node_modules/http-errors/index.js:117:3)
      at Object.<anonymous> (../../../VariantsDeps/body-parser/variant2/body-parser/node_modules/http-errors/index.js:27:28)
      at Object.<anonymous> (../../../VariantsDeps/body-parser/variant2/body-parser/lib/types/json.js:17:19)

  ●  › controller options › controller transform is enabled by default

    expect.assertions(4)

    Expected four assertions to be called but received zero assertion calls.

      71 | 
      72 |     it('controller transform is enabled by default', async () => {
    > 73 |       expect.assertions(4);
         |              ^
      74 |       try {
      75 |         const response = await axios.post('/default', user);
      76 |         expect(initializedUser).toBeInstanceOf(UserModel);

      at Object.<anonymous> (test/functional/controller-options.spec.ts:73:14)

  ●  › controller options › when controller transform is enabled

    TypeError: inherits is not a function

      15 | var bytes = require('bytes')
      16 | var contentType = require('content-type')
    > 17 | var createError = require('http-errors')
         |                   ^
      18 | var debug = require('debug')('body-parser:json')
      19 | var read = require('../read')
      20 | var typeis = require('type-is')

      at createHttpErrorConstructor (../../../VariantsDeps/body-parser/variant2/body-parser/node_modules/http-errors/index.js:117:3)
      at Object.<anonymous> (../../../VariantsDeps/body-parser/variant2/body-parser/node_modules/http-errors/index.js:27:28)
      at Object.<anonymous> (../../../VariantsDeps/body-parser/variant2/body-parser/lib/types/json.js:17:19)

  ●  › controller options › when controller transform is enabled

    expect.assertions(4)

    Expected four assertions to be called but received zero assertion calls.

      84 | 
      85 |     it('when controller transform is enabled', async () => {
    > 86 |       expect.assertions(4);
         |              ^
      87 |       try {
      88 |         const response = await axios.post('/transform', user);
      89 |         expect(initializedUser).toBeInstanceOf(UserModel);

      at Object.<anonymous> (test/functional/controller-options.spec.ts:86:14)
      at processTicksAndRejections (node:internal/process/task_queues:95:5)

  ●  › controller options › when controller transform is disabled

    TypeError: inherits is not a function

      15 | var bytes = require('bytes')
      16 | var contentType = require('content-type')
    > 17 | var createError = require('http-errors')
         |                   ^
      18 | var debug = require('debug')('body-parser:json')
      19 | var read = require('../read')
      20 | var typeis = require('type-is')

      at createHttpErrorConstructor (../../../VariantsDeps/body-parser/variant2/body-parser/node_modules/http-errors/index.js:117:3)
      at Object.<anonymous> (../../../VariantsDeps/body-parser/variant2/body-parser/node_modules/http-errors/index.js:27:28)
      at Object.<anonymous> (../../../VariantsDeps/body-parser/variant2/body-parser/lib/types/json.js:17:19)

  ●  › controller options › when controller transform is disabled

    expect.assertions(4)

    Expected four assertions to be called but received zero assertion calls.

       97 | 
       98 |     it('when controller transform is disabled', async () => {
    >  99 |       expect.assertions(4);
          |              ^
      100 |       try {
      101 |         const response = await axios.post('/noTransform', user);
      102 |         expect(initializedUser).toMatchObject(user);

      at Object.<anonymous> (test/functional/controller-options.spec.ts:99:14)
      at processTicksAndRejections (node:internal/process/task_queues:95:5)

FAIL test/functional/global-options.spec.ts
  ●  › routing-controllers global options › useClassTransformer default value › useClassTransformer by default must be set to true

    TypeError: inherits is not a function

      15 | var bytes = require('bytes')
      16 | var contentType = require('content-type')
    > 17 | var createError = require('http-errors')
         |                   ^
      18 | var debug = require('debug')('body-parser:json')
      19 | var read = require('../read')
      20 | var typeis = require('type-is')

      at createHttpErrorConstructor (../../../VariantsDeps/body-parser/variant2/body-parser/node_modules/http-errors/index.js:117:3)
      at Object.<anonymous> (../../../VariantsDeps/body-parser/variant2/body-parser/node_modules/http-errors/index.js:27:28)
      at Object.<anonymous> (../../../VariantsDeps/body-parser/variant2/body-parser/lib/types/json.js:17:19)

  ●  › routing-controllers global options › useClassTransformer default value › useClassTransformer by default must be set to true

    connect ECONNREFUSED 127.0.0.1:3001

      at TCPConnectWrap.afterConnect [as oncomplete] (node:net:1229:16)

  ●  › routing-controllers global options › useClassTransformer default value › useClassTransformer by default must be set to true

    TypeError: Cannot read properties of undefined (reading 'close')

      52 | 
      53 |       afterEach((done: DoneCallback) => {
    > 54 |         expressServer.close(done);
         |                       ^
      55 |       });
      56 | 
      57 |       it('useClassTransformer by default must be set to true', async () => {

      at Object.<anonymous> (test/functional/global-options.spec.ts:54:23)
      at processTicksAndRejections (node:internal/process/task_queues:95:5)

  ●  › routing-controllers global options › useClassTransformer default value › useClassTransformer by default must be set to true

    expect.assertions(2)

    Expected two assertions to be called but received zero assertion calls.

      56 | 
      57 |       it('useClassTransformer by default must be set to true', async () => {
    > 58 |         expect.assertions(2);
         |                ^
      59 |         const response = await axios.post('/users', user);
      60 |         expect(initializedUser).toBeInstanceOf(User);
      61 |         expect(response.status).toEqual(HttpStatusCodes.OK);

      at Object.<anonymous> (test/functional/global-options.spec.ts:58:16)

  ●  › routing-controllers global options › when useClassTransformer is set to true › useClassTransformer is enabled

    TypeError: this.loadBodyParser(...).json is not a function

      102 |     if (actionMetadata.isBodyUsed) {
      103 |       if (actionMetadata.isJsonTyped) {
    > 104 |         defaultMiddlewares.push(this.loadBodyParser().json(actionMetadata.bodyExtraOptions));
          |                                                       ^
      105 |       } else {
      106 |         defaultMiddlewares.push(this.loadBodyParser().text(actionMetadata.bodyExtraOptions));
      107 |       }

      at ExpressDriver.registerAction (src/driver/express/ExpressDriver.ts:104:55)
      at src/RoutingControllers.ts:81:21
          at Array.forEach (<anonymous>)
      at src/RoutingControllers.ts:75:26
          at Array.forEach (<anonymous>)
      at RoutingControllers.registerControllers (src/RoutingControllers.ts:74:17)
      at createExecutor (src/index.ts:219:6)
      at createServer (src/index.ts:148:3)
      at Object.createExpressServer (src/index.ts:125:10)
      at Object.<anonymous> (test/functional/global-options.spec.ts:82:25)

  ●  › routing-controllers global options › when useClassTransformer is set to true › useClassTransformer is enabled

    connect ECONNREFUSED 127.0.0.1:3001

      at TCPConnectWrap.afterConnect [as oncomplete] (node:net:1229:16)

  ●  › routing-controllers global options › when useClassTransformer is set to true › useClassTransformer is enabled

    TypeError: Cannot read properties of undefined (reading 'close')

      88 | 
      89 |       afterEach((done: DoneCallback) => {
    > 90 |         expressServer.close(done);
         |                       ^
      91 |       });
      92 | 
      93 |       it('useClassTransformer is enabled', async () => {

      at Object.<anonymous> (test/functional/global-options.spec.ts:90:23)
      at processTicksAndRejections (node:internal/process/task_queues:95:5)

  ●  › routing-controllers global options › when useClassTransformer is set to true › useClassTransformer is enabled

    expect.assertions(2)

    Expected two assertions to be called but received zero assertion calls.

      92 | 
      93 |       it('useClassTransformer is enabled', async () => {
    > 94 |         expect.assertions(2);
         |                ^
      95 |         const response = await axios.post('/users', user);
      96 |         expect(initializedUser).toBeInstanceOf(User);
      97 |         expect(response.status).toEqual(HttpStatusCodes.OK);

      at Object.<anonymous> (test/functional/global-options.spec.ts:94:16)
      at processTicksAndRejections (node:internal/process/task_queues:95:5)

  ●  › routing-controllers global options › when useClassTransformer is set to false › useClassTransformer is disabled

    TypeError: this.loadBodyParser(...).json is not a function

      102 |     if (actionMetadata.isBodyUsed) {
      103 |       if (actionMetadata.isJsonTyped) {
    > 104 |         defaultMiddlewares.push(this.loadBodyParser().json(actionMetadata.bodyExtraOptions));
          |                                                       ^
      105 |       } else {
      106 |         defaultMiddlewares.push(this.loadBodyParser().text(actionMetadata.bodyExtraOptions));
      107 |       }

      at ExpressDriver.registerAction (src/driver/express/ExpressDriver.ts:104:55)
      at src/RoutingControllers.ts:81:21
          at Array.forEach (<anonymous>)
      at src/RoutingControllers.ts:75:26
          at Array.forEach (<anonymous>)
      at RoutingControllers.registerControllers (src/RoutingControllers.ts:74:17)
      at createExecutor (src/index.ts:219:6)
      at createServer (src/index.ts:148:3)
      at Object.createExpressServer (src/index.ts:125:10)
      at Object.<anonymous> (test/functional/global-options.spec.ts:118:25)

  ●  › routing-controllers global options › when useClassTransformer is set to false › useClassTransformer is disabled

    connect ECONNREFUSED 127.0.0.1:3001

      at TCPConnectWrap.afterConnect [as oncomplete] (node:net:1229:16)

  ●  › routing-controllers global options › when useClassTransformer is set to false › useClassTransformer is disabled

    TypeError: Cannot read properties of undefined (reading 'close')

      124 | 
      125 |       afterEach((done: DoneCallback) => {
    > 126 |         expressServer.close(done);
          |                       ^
      127 |       });
      128 | 
      129 |       it('useClassTransformer is disabled', async () => {

      at Object.<anonymous> (test/functional/global-options.spec.ts:126:23)
      at processTicksAndRejections (node:internal/process/task_queues:95:5)

  ●  › routing-controllers global options › when useClassTransformer is set to false › useClassTransformer is disabled

    expect.assertions(2)

    Expected two assertions to be called but received zero assertion calls.

      128 | 
      129 |       it('useClassTransformer is disabled', async () => {
    > 130 |         expect.assertions(2);
          |                ^
      131 |         const response = await axios.post('/users', user);
      132 |         expect(initializedUser).not.toBeInstanceOf(User);
      133 |         expect(response.status).toEqual(HttpStatusCodes.OK);

      at Object.<anonymous> (test/functional/global-options.spec.ts:130:16)
      at processTicksAndRejections (node:internal/process/task_queues:95:5)

  ●  › routing-controllers global options › when routePrefix is used all controller routes should be appended by it › routePrefix is enabled

    TypeError: this.loadBodyParser(...).json is not a function

      102 |     if (actionMetadata.isBodyUsed) {
      103 |       if (actionMetadata.isJsonTyped) {
    > 104 |         defaultMiddlewares.push(this.loadBodyParser().json(actionMetadata.bodyExtraOptions));
          |                                                       ^
      105 |       } else {
      106 |         defaultMiddlewares.push(this.loadBodyParser().text(actionMetadata.bodyExtraOptions));
      107 |       }

      at ExpressDriver.registerAction (src/driver/express/ExpressDriver.ts:104:55)
      at src/RoutingControllers.ts:81:21
          at Array.forEach (<anonymous>)
      at src/RoutingControllers.ts:75:26
          at Array.forEach (<anonymous>)
      at RoutingControllers.registerControllers (src/RoutingControllers.ts:74:17)
      at createExecutor (src/index.ts:219:6)
      at createServer (src/index.ts:148:3)
      at Object.createExpressServer (src/index.ts:125:10)
      at Object.<anonymous> (test/functional/global-options.spec.ts:154:25)

  ●  › routing-controllers global options › when routePrefix is used all controller routes should be appended by it › routePrefix is enabled

    connect ECONNREFUSED 127.0.0.1:3001

      at TCPConnectWrap.afterConnect [as oncomplete] (node:net:1229:16)

  ●  › routing-controllers global options › when routePrefix is used all controller routes should be appended by it › routePrefix is enabled

    TypeError: Cannot read properties of undefined (reading 'close')

      160 | 
      161 |       afterEach((done: DoneCallback) => {
    > 162 |         expressServer.close(done);
          |                       ^
      163 |       });
      164 | 
      165 |       it('routePrefix is enabled', async () => {

      at Object.<anonymous> (test/functional/global-options.spec.ts:162:23)
      at processTicksAndRejections (node:internal/process/task_queues:95:5)

  ●  › routing-controllers global options › when routePrefix is used all controller routes should be appended by it › routePrefix is enabled

    expect.assertions(4)

    Expected four assertions to be called but received zero assertion calls.

      164 | 
      165 |       it('routePrefix is enabled', async () => {
    > 166 |         expect.assertions(4);
          |                ^
      167 |         let response = await axios.post('/api/users', user);
      168 |         expect(initializedUser).toBeInstanceOf(User);
      169 |         expect(response.status).toEqual(HttpStatusCodes.OK);

      at Object.<anonymous> (test/functional/global-options.spec.ts:166:16)
      at processTicksAndRejections (node:internal/process/task_queues:95:5)

FAIL test/functional/action-options.spec.ts
  ●  › should use controller options when action transform options are not set

    TypeError: inherits is not a function

      15 | var bytes = require('bytes')
      16 | var contentType = require('content-type')
    > 17 | var createError = require('http-errors')
         |                   ^
      18 | var debug = require('debug')('body-parser:json')
      19 | var read = require('../read')
      20 | var typeis = require('type-is')

      at createHttpErrorConstructor (../../../VariantsDeps/body-parser/variant2/body-parser/node_modules/http-errors/index.js:117:3)
      at Object.<anonymous> (../../../VariantsDeps/body-parser/variant2/body-parser/node_modules/http-errors/index.js:27:28)
      at Object.<anonymous> (../../../VariantsDeps/body-parser/variant2/body-parser/lib/types/json.js:17:19)

  ●  › should use controller options when action transform options are not set

    connect ECONNREFUSED 127.0.0.1:3001

      at TCPConnectWrap.afterConnect [as oncomplete] (node:net:1229:16)

  ●  › should use controller options when action transform options are not set

    expect.assertions(4)

    Expected four assertions to be called but received zero assertion calls.

      63 | 
      64 |   it('should use controller options when action transform options are not set', async () => {
    > 65 |     expect.assertions(4);
         |            ^
      66 |     const response = await axios.post('/default', user);
      67 |     expect(initializedUser).toBeInstanceOf(UserModel);
      68 |     expect(initializedUser.lastName).toBeUndefined();

      at Object.<anonymous> (test/functional/action-options.spec.ts:65:12)

  ●  › should override controller options with action transformRequest option

    TypeError: inherits is not a function

      15 | var bytes = require('bytes')
      16 | var contentType = require('content-type')
    > 17 | var createError = require('http-errors')
         |                   ^
      18 | var debug = require('debug')('body-parser:json')
      19 | var read = require('../read')
      20 | var typeis = require('type-is')

      at createHttpErrorConstructor (../../../VariantsDeps/body-parser/variant2/body-parser/node_modules/http-errors/index.js:117:3)
      at Object.<anonymous> (../../../VariantsDeps/body-parser/variant2/body-parser/node_modules/http-errors/index.js:27:28)
      at Object.<anonymous> (../../../VariantsDeps/body-parser/variant2/body-parser/lib/types/json.js:17:19)

  ●  › should override controller options with action transformRequest option

    connect ECONNREFUSED 127.0.0.1:3001

      at TCPConnectWrap.afterConnect [as oncomplete] (node:net:1229:16)

  ●  › should override controller options with action transformRequest option

    expect.assertions(4)

    Expected four assertions to be called but received zero assertion calls.

      72 | 
      73 |   it('should override controller options with action transformRequest option', async () => {
    > 74 |     expect.assertions(4);
         |            ^
      75 |     const response = await axios.post('/transformRequestOnly', user);
      76 |     expect(initializedUser).toBeInstanceOf(UserModel);
      77 |     expect(initializedUser.lastName).toBeUndefined();

      at Object.<anonymous> (test/functional/action-options.spec.ts:74:12)
      at processTicksAndRejections (node:internal/process/task_queues:95:5)

  ●  › should override controller options with action transformResponse option

    TypeError: inherits is not a function

      15 | var bytes = require('bytes')
      16 | var contentType = require('content-type')
    > 17 | var createError = require('http-errors')
         |                   ^
      18 | var debug = require('debug')('body-parser:json')
      19 | var read = require('../read')
      20 | var typeis = require('type-is')

      at createHttpErrorConstructor (../../../VariantsDeps/body-parser/variant2/body-parser/node_modules/http-errors/index.js:117:3)
      at Object.<anonymous> (../../../VariantsDeps/body-parser/variant2/body-parser/node_modules/http-errors/index.js:27:28)
      at Object.<anonymous> (../../../VariantsDeps/body-parser/variant2/body-parser/lib/types/json.js:17:19)

  ●  › should override controller options with action transformResponse option

    connect ECONNREFUSED 127.0.0.1:3001

      at TCPConnectWrap.afterConnect [as oncomplete] (node:net:1229:16)

  ●  › should override controller options with action transformResponse option

    expect.assertions(4)

    Expected four assertions to be called but received zero assertion calls.

      81 | 
      82 |   it('should override controller options with action transformResponse option', async () => {
    > 83 |     expect.assertions(4);
         |            ^
      84 |     const response = await axios.post('/transformResponseOnly', user);
      85 |     expect(initializedUser).not.toBeInstanceOf(UserModel);
      86 |     expect(initializedUser.lastName).not.toBeUndefined();

      at Object.<anonymous> (test/functional/action-options.spec.ts:83:12)
      at processTicksAndRejections (node:internal/process/task_queues:95:5)


Test Suites: 5 failed, 21 passed, 26 total
Tests:       12 failed, 124 passed, 136 total
Snapshots:   0 total
Time:        12.194 s
Ran all test suites.
ts-jest[config] (WARN) The option `tsConfig` is deprecated and will be removed in ts-jest 27, use `tsconfig` instead
FAIL test/ActionParameterHandler.spec.ts
  ActionParameterHandler
    positive
      ✓ handle - should process string parameters (27 ms)
      ✓ handle - should process string parameters, returns empty if a given string is empty
      ✓ handle - should process number parameters (1 ms)
      ✓ handle - undefined on empty object provided
      ✓ handle - null provided (17 ms)
    negative
      ✕ handle - throws error if the parameter is required (6 ms)
      ✓ handle - throws error if the parameter is required, type file provided

  ● ActionParameterHandler › negative › handle - throws error if the parameter is required

    Expected value   "TypeError: Cannot read property 'uuid' of undefined"
    Received:
      "TypeError: Cannot read properties of undefined (reading 'uuid')"

    Message:
      expected 'TypeError: Cannot read properties of undefined (reading \'uuid\')' to equal 'TypeError: Cannot read property \'uuid\' of undefined'

    Difference:

    - Expected
    + Received

    - TypeError: Cannot read property 'uuid' of undefined
    + TypeError: Cannot read properties of undefined (reading 'uuid')

      152 |       }
      153 | 
    > 154 |       expect(error.toString()).to.be.eq("TypeError: Cannot read property 'uuid' of undefined");
          |                                      ^
      155 |     });
      156 | 
      157 |     it('handle - throws error if the parameter is required, type file provided', async () => {

      at Object.<anonymous> (test/ActionParameterHandler.spec.ts:154:38)

PASS test/functional/action-params.spec.ts
    ✓ @Req and @Res should be provided as Request and Response objects (20 ms)
    ✓ @Res writing directly to the response should work (5 ms)
    ✓ @Param should give a param from route (4 ms)
    ✓ @Param multiple params should give a proper values from route (4 ms)
    ✓ @SessionParam without middleware (23 ms)
    ✓ @Session should return a value from session (11 ms)
    ✓ @Session(param) should allow to inject empty property (3 ms)
    ✓ @QueryParams should give a proper values from request's query parameters (9 ms)
    ✓ @QueryParams should give a proper values from request's query parameters and one multiple value (6 ms)
    ✓ @QueryParams should give a proper values from request's query with validate whitelist option on (4 ms)
    ✓ @QueryParams should give a proper values from request's query parameters with nested json (4 ms)
    ✓ @QueryParams should not validate request query parameters when it's turned off in validator options (3 ms)
    ✓ @QueryParams should give a proper values from request's optional query parameters (10 ms)
    ✓ @QueryParam should give a proper values from request query parameters (3 ms)
    ✓ @QueryParam should give an array of string with only one query parameter (2 ms)
    ✓ @QueryParam should give an array of string with multiple query parameters (2 ms)
    ✓ @QueryParam should give an array of number with only one query parameter (2 ms)
    ✓ @QueryParam should give an array of number with multiple query parameters (2 ms)
    ✓ @QueryParam should give an array of date with only one query parameter (2 ms)
    ✓ @QueryParam should give an array of date with multiple query parameters (2 ms)
    ✓ @QueryParam when required params must be provided and they should not be empty (8 ms)
    ✓ @QueryParam when the type is Date then it should be parsed (2 ms)
    ✓ @QueryParam when the type is Date and it is invalid then the response should be a BadRequest error (2 ms)
    ✓ @QueryParam when parseJson flag is used query param must be converted to object (2 ms)
    ✓ @HeaderParam should give a proper values from request headers (2 ms)
    ✓ @HeaderParam when required is params must be provided and they should not be empty (2 ms)
    ✓ @HeaderParam should fail with invalid request options (2 ms)
    ✓ @HeaderParam should fail with missing required params (2 ms)
    ✓ for @HeaderParam when parseJson flag is used query param must be converted to object (2 ms)
    ✓ @CookieParam should give a proper values from request headers (2 ms)
    ✓ @CookieParam when required is params must be provided and they should not be empty (4 ms)
    ✓ @CookieParam when parseJson flag is used query param must be converted to object (2 ms)
    ✓ @Body should provide a request body (12 ms)
    ✓ @Body should fail if required body was not provided (6 ms)
    ✓ @Body should provide a json object for json-typed controllers and actions (3 ms)
    ✓ @Body should fail if required body was not provided for json-typed controllers and actions (4 ms)
    ✓ @BodyParam should provide a json object for json-typed controllers and actions (2 ms)
    ✓ @BodyParam should fail if required body was not provided for json-typed controllers and actions (21 ms)
    ✓ @Body using application/x-www-form-urlencoded should handle url encoded form data (4 ms)
    ✓ @UploadedFile using multipart/form-data should provide uploaded file with the given name (11 ms)
    ✓ @UploadedFile with @Body should return both the file and the body (6 ms)
    ✓ @UploadedFile with @BodyParam should return both the file and the body param (4 ms)
    ✓ @UploadedFile with passed uploading options (limit) should throw an error (5 ms)
    ✓ @UploadedFile when required is used files must be provided (6 ms)
    ✓ @UploadedFiles should provide uploaded files with the given name (4 ms)
    ✓ @UploadedFiles with passed uploading options (limit) should throw an error (5 ms)
    ✓ @UploadedFiles when required is used files must be provided (5 ms)

PASS test/functional/global-options.spec.ts
    routing-controllers global options
      useClassTransformer default value
        ✓ useClassTransformer by default must be set to true (74 ms)
      when useClassTransformer is set to true
        ✓ useClassTransformer is enabled (3 ms)
      when useClassTransformer is set to false
        ✓ useClassTransformer is disabled (4 ms)
      when routePrefix is used all controller routes should be appended by it
        ✓ routePrefix is enabled (6 ms)

PASS test/functional/controller-options.spec.ts
    controller options
      ✓ controller transform is enabled by default (65 ms)
      ✓ when controller transform is enabled (5 ms)
      ✓ when controller transform is disabled (4 ms)

PASS test/functional/action-options.spec.ts
    ✓ should use controller options when action transform options are not set (18 ms)
    ✓ should override controller options with action transformRequest option (4 ms)
    ✓ should override controller options with action transformResponse option (3 ms)

PASS test/functional/controller-methods.spec.ts
    controller methods
      ✓ get should respond with proper status code, headers and body content (9 ms)
      ✓ post respond with proper status code, headers and body content (3 ms)
      ✓ put respond with proper status code, headers and body content (13 ms)
      ✓ patch respond with proper status code, headers and body content (2 ms)
      ✓ delete respond with proper status code, headers and body content (2 ms)
      ✓ head respond with proper status code, headers and body content (2 ms)
      ✓ custom method (post) respond with proper status code, headers and body content (2 ms)
      ✓ custom method (delete) respond with proper status code, headers and body content (2 ms)
      ✓ route should work with parameter (3 ms)
      ✓ route should work with regexp parameter (2 ms)
      ✓ should respond with 404 when regexp does not match (4 ms)
      ✓ route should work with string regexp parameter (3 ms)
      ✓ should respond with 404 when regexp does not match (4 ms)
      ✓ should return result from a promise (503 ms)
      ✓ should respond with 500 if promise failed (504 ms)
      ✓ should respond with 204 No Content when null returned in action (4 ms)
      ✓ should respond with 404 Not Found text when undefined returned in action (19 ms)
      ✓ should respond with 404 Not Found JSON when undefined returned in action (2 ms)
      ✓ should respond with 200 and text/html even in json controller's method (2 ms)
      ✓ should respond with 200 and text/plain even in json controller's method (2 ms)
      ✓ should respond with 401 and text/html when UnauthorizedError throwed even in json controller's method (4 ms)
      ✓ should respond with 401 and aplication/json when UnauthorizedError is thrown in standard json controller's method (2 ms)

PASS test/functional/json-controller-methods.spec.ts
    json-controller methods
      ✓ get should respond with proper status code, headers and body content (9 ms)
      ✓ post respond with proper status code, headers and body content (3 ms)
      ✓ put respond with proper status code, headers and body content (2 ms)
      ✓ patch respond with proper status code, headers and body content (4 ms)
      ✓ delete respond with proper status code, headers and body content (3 ms)
      ✓ head respond with proper status code, headers and body content (2 ms)
      ✓ custom method (post) respond with proper status code, headers and body content (2 ms)
      ✓ custom method (delete) respond with proper status code, headers and body content (2 ms)
      ✓ route should work with parameter (2 ms)
      ✓ route should work with regexp parameter (2 ms)
      ✓ should respond with 404 when regexp does not match (3 ms)
      ✓ route should work with string regexp parameter (16 ms)
      ✓ should respond with 404 when regexp does not match (2 ms)
      ✓ should return result from a promise (503 ms)
      ✓ should respond with 500 if promise failed (504 ms)

PASS test/functional/interceptors.spec.ts
    interceptor
      ✓ custom interceptor function should replace returned content (12 ms)
      ✓ custom interceptor class should replace returned content (26 ms)
      ✓ custom interceptor class used on the whole controller should replace returned content (3 ms)
      ✓ global interceptor class should replace returned content (3 ms)
      ✓ interceptors should support promises (1004 ms)

PASS test/functional/load-from-directory.spec.ts
    loading all controllers from the given directories
      ✓ should load all controllers (31 ms)
    loading all express middlewares and error handlers from the given directories
      ✓ should succeed (10 ms)
      ✓ should fail (20 ms)

PASS test/functional/other-controller-decorators.spec.ts
    other controller decorators
      ✓ should return httpCode set by @HttpCode decorator (11 ms)
      ✓ should return custom code when @OnNull (32 ms)
      ✓ should return custom error message and code when @OnUndefined is used with Error class (6 ms)
      ✓ should return custom code when @OnUndefined (8 ms)
      ✓ should return content-type in the response when @ContentType is used (2 ms)
      ✓ should return content-type in the response when @ContentType is used (2 ms)
      ✓ should return response with custom headers when @Header is used (3 ms)
      ✓ should relocate to new location when @Location is used (2 ms)

PASS test/functional/auth-decorator.spec.ts
    Controller responds with value when Authorization succeeds (async)
      ✓ without roles (66 ms)
      ✓ with roles (16 ms)
      ✓ async (51 ms)
    Controller responds with value when Authorization succeeds (sync)
      ✓ without roles (6 ms)
      ✓ with roles (6 ms)
      ✓ async (39 ms)
    Authorized Decorators Http Status Code
      ✓ without roles (115 ms)
      ✓ with roles (18 ms)
    Authorization checker allows to throw (async)
      ✓ custom errors (13 ms)
    Authorization checker allows to throw (sync)
      ✓ custom errors (4 ms)

PASS test/unit/controller-inheritance.spec.ts
  controller inheritance
    ✓ should build empty meta for empty set (10 ms)
    ✓ should build meta if the only derivative controller is given (2 ms)
    ✓ should build meta if the only autonomous controller is given (1 ms)
    ✓ should build meta both when autonomous and derivative controllers are given

PASS test/functional/container.spec.ts
    using typedi container should be possible
      ✓ typedi container (56 ms)
    using custom container should be possible
      ✓ custom container (5 ms)
    using custom container with fallback should be possible
      ✓ custom container with fallback (8 ms)
    using custom container with fallback and fallback on throw error should be possible
      ✓ custom container with fallback and fallback on throw error (7 ms)

PASS test/functional/class-transformer-options.spec.ts
    should not use any options if not set
      ✓ technical wrapper (25 ms)
    should apply global options
      ✓ technical wrapper (5 ms)
    should apply local options
      ✓ technical wrapper (5 ms)

PASS test/functional/class-validator-options.spec.ts
    no options
      ✓ should not use any options if not set (56 ms)
    global options
      should merge local validation options with global validation options prioritizing local
        ✓ succeed (5 ms)
      should pass the valid param after validation
        ✓ succeed (4 ms)
        ✓ should contain param name on validation failed (16 ms)
    local options
      ✓ should apply local options (4 ms)

PASS test/functional/middlewares-order.spec.ts
    loaded direct from array
      ✓ should call middlewares in order defined by items order (21 ms)
    specified by priority option
      ✓ should call middlewares in order defined by priority parameter of decorator (2 ms)

PASS test/functional/express-middlewares.spec.ts
    express middlewares
      ✓ should call a global middlewares (21 ms)
      ✓ should use a custom middleware when @UseBefore or @UseAfter is used (3 ms)
      ✓ should call middleware and call it before controller action when @UseBefore is used (2 ms)
      ✓ should call middleware and call it after controller action when @UseAfter is used (3 ms)
      ✓ should call before middleware and call after middleware when @UseAfter and @UseAfter are used (2 ms)
      ✓ should handle errors in custom middlewares (22 ms)

PASS test/functional/express-error-handling.spec.ts
    express error handling
      ✓ should not call global error handler middleware if there was no errors (32 ms)
      ✓ should call global error handler middleware (21 ms)
      ✓ should call global error handler middleware (4 ms)
      ✓ should call error handler middleware if used (3 ms)
      ✓ should not execute next middleware if soft error handled specifically and stopped error bubbling (2 ms)
      ✓ should process JsonErrors by their toJSON method if it exists (3 ms)

PASS test/functional/defaults.spec.ts
    defaults
      ✓ should return undefinedResultCode from defaults config for void function (20 ms)
      ✓ should return undefinedResultCode from defaults config for promise void function (2 ms)
      ✓ should return 400 from required paramOptions (15 ms)
      ✓ should return nullResultCode from defaults config (3 ms)
      ✓ should return status code from OnUndefined annotation (2 ms)
      ✓ should mark arg optional from QueryParam annotation (4 ms)

PASS test/functional/render-decorator.spec.ts
    template rendering
      ✓ should render a template and use given variables (25 ms)
      ✓ should render a template with given variables and locals variables (4 ms)

PASS test/functional/controller-base-routes.spec.ts
    controller > base routes functionality
      ✓ get should respond with proper status code, headers and body content (53 ms)
      ✓ get should respond with proper status code, headers and body content (3 ms)
      ✓ get should respond with proper status code, headers and body content - 2nd pass (4 ms)
      ✓ wrong route should respond with 404 error (3 ms)
      ✓ wrong route should respond with 404 error (3 ms)
      ✓ wrong route should respond with 404 error (2 ms)

PASS test/functional/express-custom-error-handling.spec.ts
    custom express error handling
      ✓ should not call global error handler middleware if there was no errors (42 ms)
      ✓ should call global error handler middleware (45 ms)

PASS test/functional/redirect-decorator.spec.ts
    dynamic redirect
      ✓ using template (28 ms)
      ✓ using override (3 ms)
      ✓ using original (4 ms)

PASS test/functional/express-global-before-error-handling.spec.ts
    custom express global before middleware error handling
      ✓ should call global error handler middleware with CustomError (24 ms)

PASS test/functional/special-result-send.spec.ts
    special result value treatment
      ✓ should pipe stream to response (8 ms)
      ✓ should send raw binary data from Buffer (2 ms)
      ✓ should send raw binary data from UIntArray (2 ms)

PASS test/functional/error-subclasses.spec.ts
  HttpError
    ✓ should be instance of HttpError and Error (3 ms)
  BadRequestError
    ✓ should be instance of BadRequestError, HttpError and Error (1 ms)

Summary of all failing tests
FAIL test/ActionParameterHandler.spec.ts
  ● ActionParameterHandler › negative › handle - throws error if the parameter is required

    Expected value   "TypeError: Cannot read property 'uuid' of undefined"
    Received:
      "TypeError: Cannot read properties of undefined (reading 'uuid')"

    Message:
      expected 'TypeError: Cannot read properties of undefined (reading \'uuid\')' to equal 'TypeError: Cannot read property \'uuid\' of undefined'

    Difference:

    - Expected
    + Received

    - TypeError: Cannot read property 'uuid' of undefined
    + TypeError: Cannot read properties of undefined (reading 'uuid')

      152 |       }
      153 | 
    > 154 |       expect(error.toString()).to.be.eq("TypeError: Cannot read property 'uuid' of undefined");
          |                                      ^
      155 |     });
      156 | 
      157 |     it('handle - throws error if the parameter is required, type file provided', async () => {

      at Object.<anonymous> (test/ActionParameterHandler.spec.ts:154:38)


Test Suites: 1 failed, 25 passed, 26 total
Tests:       1 failed, 181 passed, 182 total
Snapshots:   0 total
Time:        12.591 s
Ran all test suites.
