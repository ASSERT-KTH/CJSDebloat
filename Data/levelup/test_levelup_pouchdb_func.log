/data/js-variants/multee
16
pouchdb is testing ./Variants/levelup/variant16/levelup
/data/js-variants/multee
************* npm unlink module *************

up to date, audited 1032 packages in 2s

64 packages are looking for funding
  run `npm fund` for details

41 vulnerabilities (1 low, 9 moderate, 25 high, 6 critical)

To address issues that do not require attention, run:
  npm audit fix

To address all issues possible (including breaking changes), run:
  npm audit fix --force

Some issues need review, and may require choosing
a different dependency.

Run `npm audit` for details.
************* npm unlink module done *************
************* npm unlink globally *************

up to date, audited 1 package in 107ms

found 0 vulnerabilities
************* npm unlink globally done *************
************* npm link globally *************

added 1 package, and audited 3 packages in 400ms

found 0 vulnerabilities
************* npm link globally done *************
************* npm link module *************

added 1 package, changed 1 package, and audited 1034 packages in 5s

64 packages are looking for funding
  run `npm fund` for details

41 vulnerabilities (1 low, 9 moderate, 25 high, 6 critical)

To address issues that do not require attention, run:
  npm audit fix

To address all issues possible (including breaking changes), run:
  npm audit fix --force

Some issues need review, and may require choosing
a different dependency.

Run `npm audit` for details.
************* npm link module done *************
************* start run test *************

> pouchdb-monorepo@7.0.0-prerelease test
> bash bin/run-test.sh


> pouchdb-monorepo@7.0.0-prerelease build-node
> bash bin/build-node.sh


> pouchdb-monorepo@7.0.0-prerelease build-modules
> node bin/build-modules.js

Building pouchdb...
Building pouchdb-abstract-mapreduce...
Building pouchdb-adapter-http...
Building pouchdb-adapter-idb...
Building pouchdb-adapter-indexeddb...
Building pouchdb-adapter-leveldb...
Building pouchdb-adapter-leveldb-core...
Building pouchdb-adapter-localstorage...
Building pouchdb-adapter-memory...
Building pouchdb-adapter-utils...
Building pouchdb-binary-utils...
Building pouchdb-browser...
Building pouchdb-changes-filter...
Building pouchdb-checkpointer...
Building pouchdb-collate...
Building pouchdb-collections...
Building pouchdb-core...
Building pouchdb-errors...
Building pouchdb-fetch...
Building pouchdb-find...
Building pouchdb-for-coverage...
Building pouchdb-generate-replication-id...
Building pouchdb-json...
Building pouchdb-mapreduce...
Building pouchdb-mapreduce-utils...
Building pouchdb-md5...
Building pouchdb-merge...
Building pouchdb-node...
Building pouchdb-replication...
Building pouchdb-selector-core...
Building pouchdb-utils...
Building sublevel-pouchdb...
  ✓ wrote pouchdb-adapter-localstorage/lib/index.js in vanilla mode
  ✓ wrote pouchdb-adapter-localstorage/lib/index.es.js in vanilla mode
  ✓ wrote pouchdb-adapter-memory/lib/index.js in vanilla mode
  ✓ wrote pouchdb-adapter-memory/lib/index.es.js in vanilla mode
  ✓ wrote pouchdb-checkpointer/lib/index.js in vanilla mode
  ✓ wrote pouchdb-checkpointer/lib/index.es.js in vanilla mode
  ✓ wrote pouchdb-errors/lib/index.js in vanilla mode
  ✓ wrote pouchdb-errors/lib/index.es.js in vanilla mode
  ✓ wrote pouchdb-generate-replication-id/lib/index.js in vanilla mode
  ✓ wrote pouchdb-generate-replication-id/lib/index.es.js in vanilla mode
  ✓ wrote pouchdb-adapter-http/lib/index.js in vanilla mode
  ✓ wrote pouchdb-adapter-http/lib/index.es.js in vanilla mode
  ✓ wrote pouchdb-adapter-leveldb/lib/index.js in node mode
  ✓ wrote pouchdb-adapter-leveldb/lib/index.es.js in node mode
  ✓ wrote pouchdb-adapter-leveldb/lib/index-browser.js in browser mode
  ✓ wrote pouchdb-adapter-leveldb/lib/index-browser.es.js in browser mode
  ✓ wrote pouchdb-adapter-leveldb-core/lib/index.js in node mode
  ✓ wrote pouchdb-adapter-leveldb-core/lib/index.es.js in node mode
  ✓ wrote pouchdb-adapter-leveldb-core/lib/index-browser.js in browser mode
  ✓ wrote pouchdb-adapter-leveldb-core/lib/index-browser.es.js in browser mode
  ✓ wrote pouchdb-changes-filter/lib/index-browser.js in browser mode
  ✓ wrote pouchdb-changes-filter/lib/index-browser.es.js in browser mode
  ✓ wrote pouchdb-fetch/lib/index-browser.js in browser mode
  ✓ wrote pouchdb-fetch/lib/index-browser.es.js in browser mode
  ✓ wrote pouchdb-md5/lib/index-browser.js in browser mode
  ✓ wrote pouchdb-md5/lib/index-browser.es.js in browser mode
  ✓ wrote pouchdb-changes-filter/lib/index.js in node mode
  ✓ wrote pouchdb-changes-filter/lib/index.es.js in node mode
  ✓ wrote pouchdb-collate/lib/index.js in vanilla mode
  ✓ wrote pouchdb-collate/lib/index.es.js in vanilla mode
  ✓ wrote pouchdb-fetch/lib/index.js in node mode
  ✓ wrote pouchdb-fetch/lib/index.es.js in node mode
  ✓ wrote pouchdb-json/lib/index.js in vanilla mode
  ✓ wrote pouchdb-json/lib/index.es.js in vanilla mode
  ✓ wrote pouchdb-mapreduce-utils/lib/index.js in vanilla mode
  ✓ wrote pouchdb-mapreduce-utils/lib/index.es.js in vanilla mode
  ✓ wrote pouchdb-md5/lib/index.js in node mode
  ✓ wrote pouchdb-md5/lib/index.es.js in node mode
  ✓ wrote pouchdb-abstract-mapreduce/lib/index.js in vanilla mode
  ✓ wrote pouchdb-abstract-mapreduce/lib/index.es.js in vanilla mode
  ✓ wrote pouchdb-adapter-idb/lib/index.js in vanilla mode
  ✓ wrote pouchdb-adapter-idb/lib/index.es.js in vanilla mode
  ✓ wrote pouchdb-binary-utils/lib/index-browser.js in browser mode
  ✓ wrote pouchdb-binary-utils/lib/index-browser.es.js in browser mode
  ✓ wrote pouchdb-utils/lib/index-browser.js in browser mode
  ✓ wrote pouchdb-utils/lib/index-browser.es.js in browser mode
  ✓ wrote pouchdb-utils/lib/index.js in node mode
  ✓ wrote pouchdb-utils/lib/index.es.js in node mode
  ✓ wrote pouchdb-adapter-indexeddb/lib/index.js in vanilla mode
  ✓ wrote pouchdb-adapter-indexeddb/lib/index.es.js in vanilla mode
  ✓ wrote pouchdb-adapter-utils/lib/index.js in vanilla mode
  ✓ wrote pouchdb-adapter-utils/lib/index.es.js in vanilla mode
  ✓ wrote pouchdb-binary-utils/lib/index.js in node mode
  ✓ wrote pouchdb-binary-utils/lib/index.es.js in node mode
  ✓ wrote pouchdb-collections/lib/index.js in vanilla mode
  ✓ wrote pouchdb-collections/lib/index.es.js in vanilla mode
  ✓ wrote pouchdb-merge/lib/index.js in vanilla mode
  ✓ wrote pouchdb-merge/lib/index.es.js in vanilla mode
  ✓ wrote pouchdb-selector-core/lib/index.js in vanilla mode
  ✓ wrote pouchdb-selector-core/lib/index.es.js in vanilla mode
  ✓ wrote sublevel-pouchdb/lib/index.js in vanilla mode
  ✓ wrote sublevel-pouchdb/lib/index.es.js in vanilla mode
  ✓ wrote pouchdb-mapreduce/lib/index-browser.js in browser mode
  ✓ wrote pouchdb-mapreduce/lib/index-browser.es.js in browser mode
  ✓ wrote pouchdb-replication/lib/index.js in vanilla mode
  ✓ wrote pouchdb-replication/lib/index.es.js in vanilla mode
  ✓ wrote pouchdb-mapreduce/lib/index.js in node mode
  ✓ wrote pouchdb-mapreduce/lib/index.es.js in node mode
  ✓ wrote pouchdb-core/lib/index.js in vanilla mode
  ✓ wrote pouchdb-core/lib/index.es.js in vanilla mode
  ✓ wrote pouchdb-find/lib/index.js in node mode
  ✓ wrote pouchdb-find/lib/index.es.js in node mode
  ✓ wrote pouchdb-find/lib/index-browser.js in browser mode
  ✓ wrote pouchdb-find/lib/index-browser.es.js in browser mode
  ✓ wrote pouchdb-for-coverage/lib/index.js in node mode
  ✓ wrote pouchdb-for-coverage/lib/index.es.js in node mode
  ✓ wrote pouchdb-for-coverage/lib/index-browser.js in browser mode
  ✓ wrote pouchdb-for-coverage/lib/index-browser.es.js in browser mode
  ✓ wrote pouchdb-browser/lib/index.js in vanilla mode
  ✓ wrote pouchdb-browser/lib/index.es.js in vanilla mode
  ✓ wrote pouchdb-node/lib/index.js in vanilla mode
  ✓ wrote pouchdb-node/lib/index.es.js in vanilla mode
  ✓ wrote packages/node_modules/pouchdb/lib/index.js
  ✓ wrote packages/node_modules/pouchdb/lib/index.es.js
Waiting for host to start ..
Host started :)
> pouchdb-monorepo@7.0.0-prerelease test-node
> bash bin/test-node.sh

Down server listening on port 3010
Seeded with: 1660142580283


  DB Setup
    ✓ PouchDB has a version
    ✓ PouchDB version matches package.json

  test.active_tasks.js
    ✓ Can add a task
    ✓ Can get tasks by id
    ✓ Can get all tasks
    ✓ Can update a task
    ✓ Can remove a task

  test.all_docs.js-http
    ✓ Testing all docs (150ms)
    ✓ Testing allDocs opts.keys (64ms)
    ✓ Testing allDocs opts.keys with skip
    ✓ Testing allDocs opts.keys with limit
    ✓ Testing allDocs invalid opts.keys
    ✓ Testing deleting in changes (47ms)
    ✓ Testing updating in changes (46ms)
    ✓ Testing include docs
    ✓ Testing conflicts (48ms)
    ✓ test basic collation
    ✓ 3883 start_key end_key aliases
    ✓ test total_rows with a variety of criteria (138ms)
    ✓ test total_rows with both skip and limit (38ms)
    ✓ test limit option and total_rows
    ✓ test escaped startkey/endkey
    ✓ test "key" option
    ✓ test inclusive_end=false (50ms)
    ✓ test descending with startkey/endkey
    ✓ #3082 test wrong num results returned (271ms)
    ✓ test empty db
    ✓ test after db close
    ✓ 5793 _conflicts should not exist if no conflicts
    ✓ #6230 Test allDocs opts update_seq: false
    ✓ #6230 Test allDocs opts update_seq: true
    ✓ #6230 Test allDocs opts with update_seq missing

  test.all_docs.js-local
    ✓ Testing all docs
    ✓ Testing allDocs opts.keys
    ✓ Testing allDocs opts.keys with skip
    ✓ Testing allDocs opts.keys with limit
    ✓ Testing allDocs invalid opts.keys
    ✓ Testing deleting in changes
    ✓ Testing updating in changes
    ✓ Testing include docs
    ✓ Testing conflicts
    ✓ test basic collation
    ✓ 3883 start_key end_key aliases
    ✓ test total_rows with a variety of criteria
    ✓ test total_rows with both skip and limit
    ✓ test limit option and total_rows
    ✓ test escaped startkey/endkey
    ✓ test "key" option
    ✓ test inclusive_end=false
    ✓ test descending with startkey/endkey
    ✓ #3082 test wrong num results returned (200ms)
    ✓ test empty db
    ✓ test after db close
    ✓ test unicode ids and revs
    ✓ 5793 _conflicts should not exist if no conflicts
    ✓ #6230 Test allDocs opts update_seq: false
    ✓ #6230 Test allDocs opts update_seq: true
    ✓ #6230 Test allDocs opts with update_seq missing

  suite2 test.attachments.js-local
    ✓ 3357 Attachment names cant start with _
    ✓ 5736 warning for putAttachment without content_type
    ✓ 5736 warning for bulkDocs attachments without content_type
    ✓ fetch atts with open_revs and missing
    ✓ issue 2803 should throw 412
    ✓ issue 2803 should throw 412 part 2
    ✓ issue 2803 should throw 412 part 3
    ✓ issue 2803 should throw 412 part 4
    ✓ #2858 {binary: true} in get()
    ✓ #2858 {binary: true} in allDocs() 1
    ✓ #2858 {binary: true} in allDocs() 2
    ✓ #2858 {binary: true} in allDocs() 3
    ✓ #2858 {binary: true} in allDocs() 4
    ✓ #2858 {binary: true} in allDocs() 5
    ✓ #2858 {binary: true} in allDocs(), many atts
    ✓ #2858 {binary: true} in allDocs(), mixed atts
    ✓ #2858 {binary: true} in changes() non-live
    ✓ #2858 {binary: true} in changes() non-live, many atts
    ✓ #2858 {binary: true} in changes() non-live, mixed atts
    ✓ #2858 {binary: true} non-live changes, complete event
    ✓ #2858 {binary: true} in live changes
    ✓ #2858 {binary: true} in live changes, mixed atts
    ✓ #2858 {binary: true} in live+retry changes
    ✓ #2858 {binary: true} in live changes, attachments:false
    ✓ #2858 {binary: true} in live changes, include_docs:false
    ✓ #6736 {binary: true} in bulkGet()
    ✓ Measures length correctly after put()
    ✓ #3074 non-live changes()
    ✓ #3074 live changes()
    ✓ #3074 non-live changes(), no attachments
    ✓ #3074 live changes(), no attachments
    ✓ #3881 filter extraneous keys from _attachments
    ✓ #2771 allDocs() 1, single attachment
    ✓ #2771 allDocs() 2, many docs same att
    ✓ #2771 allDocs() 3, many docs diff atts
    ✓ #2771 allDocs() 4, mix of atts and no atts
    ✓ #2771 allDocs() 5, no atts
    ✓ #2771 allDocs() 6, no docs
    ✓ #2771 allDocs() 7, revisions and deletions
    ✓ #2771 allDocs() 8, empty attachment
    ✓ No length for non-stubs
    ✓ Test some attachments
    ✓ Test getAttachment
    ✓ Test getAttachment with stubs
    ✓ Test get() with binary:true and stubs
    ✓ Test attachments in allDocs/changes
    ✓ Test putAttachment with base64 plaintext
    ✓ Test putAttachment with invalid base64
    ✓ Test getAttachment with empty text
    ✓ Test getAttachment with normal text
    ✓ Test getAttachment with PNG
    ✓ Test getAttachment with PNG using bulkDocs
    ✓ Test getAttachment with PNG using post
    ✓ Test postAttachment with PNG then bulkDocs
    ✓ proper stub behavior
    ✓ Testing with invalid docs
    ✓ Test create attachment and doc in one go
    ✓ Test create attachment and doc in one go without callback
    ✓ Test create attachment without callback
    ✓ Test put attachment on a doc without attachments
    ✓ Test put attachment with unencoded name
    ✓ 3963 length property on stubs
    ✓ Testing with invalid rev
    ✓ Test put another attachment on a doc with attachments
    ✓ Test get with attachments: true if empty attachments
    ✓ Test delete attachment from a doc
    ✓ Test a document with a json string attachment
    ✓ Test remove doc with attachment
    ✓ Try to insert a doc with unencoded attachment
    ✓ Try to get attachment of unexistent doc
    ✓ Test synchronous putAttachment with text data
    ✓ Test synchronous putAttachment with no text data
    ✓ Test put with partial stubs
    ✓ Test put with attachments and new_edits=false
    ✓ Test getAttachment with specific rev
    ✓ Test getAttachment with diff revs and content
    ✓ Test stubs
    ✓ Try to get unexistent attachment of some doc
    ✓ putAttachment and getAttachment with plaintext
    ✓ putAttachment and getAttachment with png data
    ✓ putAttachment in new doc with base64
    ✓ #2818 - save same attachment in different revs
    ✓ #2818 - save same attachment many times in parallel
    ✓ #2818 - revisions keep attachments (no compaction)
    ✓ #2818 - doesn't throw 409 if same filename
    ✓ #3008 test correct encoding/decoding of \u0000 etc.
    ✓ putAttachment and getAttachment with big png data (84ms)
    ✓ #2709 `revpos` with putAttachment
    ✓ #2709 `revpos` with inline attachment
    ✓ #2709 `revpos` with allDocs
    ✓ #7403 {attachments: true, binary: true, include_docs: true} in allDocs with one missing doc

  suite2 test.attachments.js-http
    ✓ 3357 Attachment names cant start with _
    ✓ 5736 warning for putAttachment without content_type
    ✓ 5736 warning for bulkDocs attachments without content_type
    ✓ fetch atts with open_revs and missing
    ✓ issue 2803 should throw 412
    ✓ issue 2803 should throw 412 part 2
    ✓ issue 2803 should throw 412 part 3
    ✓ issue 2803 should throw 412 part 4
    ✓ #2858 {binary: true} in get()
    ✓ #2858 {binary: true} in allDocs() 1
    ✓ #2858 {binary: true} in allDocs() 2
    ✓ #2858 {binary: true} in allDocs() 3
    ✓ #2858 {binary: true} in allDocs() 4
    ✓ #2858 {binary: true} in allDocs() 5
    ✓ #2858 {binary: true} in allDocs(), many atts
    ✓ #2858 {binary: true} in allDocs(), mixed atts
    ✓ #2858 {binary: true} in changes() non-live
    ✓ #2858 {binary: true} in changes() non-live, many atts
    ✓ #2858 {binary: true} in changes() non-live, mixed atts
    ✓ #2858 {binary: true} non-live changes, complete event
    ✓ #2858 {binary: true} in live changes
    ✓ #2858 {binary: true} in live changes, mixed atts
    ✓ #2858 {binary: true} in live+retry changes
    ✓ #2858 {binary: true} in live changes, attachments:false
    ✓ #2858 {binary: true} in live changes, include_docs:false
    ✓ #6736 {binary: true} in bulkGet()
    ✓ Measures length correctly after put()
    ✓ #3074 non-live changes()
    ✓ #3074 live changes() (44ms)
    ✓ #3074 non-live changes(), no attachments (39ms)
    ✓ #3074 live changes(), no attachments
    ✓ #3881 filter extraneous keys from _attachments
    ✓ #2771 allDocs() 1, single attachment
    ✓ #2771 allDocs() 2, many docs same att
    ✓ #2771 allDocs() 3, many docs diff atts
    ✓ #2771 allDocs() 4, mix of atts and no atts
    ✓ #2771 allDocs() 5, no atts
    ✓ #2771 allDocs() 6, no docs
    ✓ #2771 allDocs() 7, revisions and deletions (52ms)
    ✓ #2771 allDocs() 8, empty attachment
    ✓ No length for non-stubs
    ✓ Test some attachments (84ms)
    ✓ Test getAttachment
    ✓ Test getAttachment with stubs
    ✓ Test get() with binary:true and stubs
    ✓ Test attachments in allDocs/changes
    ✓ Test putAttachment with base64 plaintext
    ✓ Test putAttachment with invalid base64
    ✓ Test getAttachment with empty text
    ✓ Test getAttachment with normal text
    ✓ Test getAttachment with PNG
    ✓ Test getAttachment with PNG using bulkDocs
    ✓ Test getAttachment with PNG using post
    ✓ Test postAttachment with PNG then bulkDocs
    ✓ proper stub behavior (49ms)
    ✓ Testing with invalid docs
    ✓ Test create attachment and doc in one go
    ✓ Test create attachment and doc in one go without callback
    ✓ Test create attachment without callback
    ✓ Test put attachment on a doc without attachments
    ✓ Test put attachment with unencoded name
    ✓ 3963 length property on stubs (48ms)
    ✓ Testing with invalid rev
    ✓ Test put another attachment on a doc with attachments
    ✓ Test get with attachments: true if empty attachments
    ✓ Test delete attachment from a doc (46ms)
    ✓ Test a document with a json string attachment
    ✓ Test remove doc with attachment
    ✓ Try to insert a doc with unencoded attachment
    ✓ Try to get attachment of unexistent doc
    ✓ Test synchronous putAttachment with text data
    ✓ Test synchronous putAttachment with no text data
    ✓ Test put with partial stubs
    ✓ Test put with attachments and new_edits=false
    ✓ Test getAttachment with specific rev (40ms)
    ✓ Test getAttachment with diff revs and content (42ms)
    ✓ Test stubs
    ✓ Try to get unexistent attachment of some doc
    ✓ putAttachment and getAttachment with plaintext
    ✓ putAttachment and getAttachment with png data
    ✓ putAttachment in new doc with base64
    ✓ #2818 - save same attachment in different revs (57ms)
    ✓ #2818 - save same attachment many times in parallel
    ✓ #2818 - revisions keep attachments (no compaction) (39ms)
    ✓ #2818 - doesn't throw 409 if same filename
    ✓ #3008 test correct encoding/decoding of \u0000 etc.
    ✓ putAttachment and getAttachment with big png data (128ms)
    ✓ #2709 `revpos` with putAttachment (42ms)
    ✓ #2709 `revpos` with inline attachment
    ✓ #2709 `revpos` with allDocs
    ✓ #7403 {attachments: true, binary: true, include_docs: true} in allDocs with one missing doc

  suite2 test.attachments.js- local:http
    ✓ Attachments replicate back and forth (112ms)
    ✓ Replicate same doc, same atts (112ms)
    ✓ Replicate same doc, same atts 2 (114ms)
    ✓ Attachments replicate (62ms)
    ✓ Attachment types replicate (52ms)
    ✓ Many many attachments replicate (182ms)
    ✓ Many many png attachments replicate (198ms)
    ✓ Multiple attachments replicate (81ms)
    - #3961 Many attachments on same doc
    ✓ Multiple attachments replicate, different docs (#2698) (112ms)
    ✓ Multiple attachments replicate, different docs png (#2698) (71ms)
    ✓ #3932 attachments with tricky revpos (136ms)
    ✓ replication with changing attachments (97ms)
    ✓ 3955 race condition in put
    ✓ #8456 bad attachment rev after replication (179ms)

  suite2 test.attachments.js- http:http
    ✓ Attachments replicate back and forth (158ms)
    ✓ Replicate same doc, same atts (174ms)
    ✓ Replicate same doc, same atts 2 (178ms)
    ✓ Attachments replicate (80ms)
    ✓ Attachment types replicate (97ms)
    ✓ Many many attachments replicate (381ms)
    ✓ Many many png attachments replicate (341ms)
    ✓ Multiple attachments replicate (130ms)
    - #3961 Many attachments on same doc
    ✓ Multiple attachments replicate, different docs (#2698) (125ms)
    ✓ Multiple attachments replicate, different docs png (#2698) (128ms)
    ✓ #3932 attachments with tricky revpos (230ms)
    ✓ replication with changing attachments (158ms)
    ✓ 3955 race condition in put
    ✓ #8456 bad attachment rev after replication (189ms)

  suite2 test.attachments.js- http:local
    ✓ Attachments replicate back and forth (117ms)
    ✓ Replicate same doc, same atts (96ms)
    ✓ Replicate same doc, same atts 2 (105ms)
    ✓ Attachments replicate (65ms)
    ✓ Attachment types replicate (97ms)
    ✓ Many many attachments replicate (153ms)
    ✓ Many many png attachments replicate (170ms)
    ✓ Multiple attachments replicate (92ms)
    - #3961 Many attachments on same doc
    ✓ Multiple attachments replicate, different docs (#2698) (128ms)
    ✓ Multiple attachments replicate, different docs png (#2698) (101ms)
    ✓ #3932 attachments with tricky revpos (153ms)
    ✓ replication with changing attachments (118ms)
    ✓ 3955 race condition in put
    ✓ #8456 bad attachment rev after replication (151ms)

  suite2 test.attachments.js- local:local
    ✓ Attachments replicate back and forth (59ms)
    ✓ Replicate same doc, same atts
    ✓ Replicate same doc, same atts 2 (38ms)
    ✓ Attachments replicate (41ms)
    ✓ Attachment types replicate
    ✓ Many many attachments replicate (39ms)
    ✓ Many many png attachments replicate
    ✓ Multiple attachments replicate
    - #3961 Many attachments on same doc
    ✓ Multiple attachments replicate, different docs (#2698)
    ✓ Multiple attachments replicate, different docs png (#2698)
    ✓ #3932 attachments with tricky revpos (65ms)
    ✓ replication with changing attachments
    ✓ 3955 race condition in put
    ✓ #8456 bad attachment rev after replication

  test.basics.js-http
    ✓ Create a pouch without new keyword
    ✓ Name is accessible via instance
    ✓ 4314 Create a pouch with + in name
    ✓ Creating Pouch without name will throw
    ✓ 4314 Create a pouch with urlencoded name
    ✓ 4219 destroy a pouch
    ✓ 4339 throw useful error if method called on stale instance
    ✓ [4595] should reject xhr errors
    ✓ [4595] should emit error event on xhr error
    ✓ Add a doc
    ✓ Get invalid id
    ✓ Missing doc should contain ID in error object
    ✓ PUTed Conflicted doc should contain ID in error object
    ✓ POSTed Conflicted doc should contain ID in error object
    ✓ Add a doc with a promise
    ✓ Add a doc with opts object
    ✓ Modify a doc
    ✓ Modifying a doc that has rewritten content
    ✓ Modify a doc with a promise
    ✓ Read db id
    ✓ Read db id with promise
    ✓ Close db
    ✓ Close db with a promise
    ✓ Read db id after closing Close
    ✓ Modify a doc with incorrect rev
    ✓ Remove doc
    ✓ Remove doc with a promise
    ✓ Remove doc with new syntax
    ✓ Remove doc with new syntax and a promise
    ✓ Doc removal leaves only stub
    ✓ Remove doc twice with specified id
    ✓ Remove doc, no callback
    ✓ Delete document without id
    ✓ Delete document with many args
    ✓ Delete document with many args, callback style
    ✓ Delete doc with id + rev + no opts
    ✓ Delete doc with id + rev + no opts, callback style
    ✓ Delete doc with doc + opts
    ✓ Delete doc with doc + opts, callback style
    ✓ Delete doc with rev in opts
    ✓ Bulk docs
    ✓ Bulk docs with a promise
    ✓ Basic checks
    ✓ update with invalid rev
    ✓ Doc validation
    ✓ Replication fields (#2442)
    ✓ Testing issue #48 (54ms)
    ✓ Testing valid id
    ✓ Put doc without _id should fail
    ✓ Put doc with bad reserved id should fail
    ✓ update_seq persists
    ✓ deletions persists (49ms)
    ✓ #4126 should not store raw Dates
    ✓ Create a db with a reserved name
    ✓ Error when document is not an object
    ✓ Test instance update_seq updates correctly
    ✓ Fail to fetch a doc after db was deleted (57ms)
    ✓ Fail to fetch a doc after db was deleted (59ms)
    ✓ Cant add docs with empty ids
    ✓ Test doc with percent in ID
    ✓ db.info should give auto_compaction = false (#2744)
    ✓ db.info should give auto_compaction = true (#2744)
    ✓ db.info should give adapter name (#3567)
    ✓ db.info should give correct doc_count
    ✓ putting returns {ok: true}
    ✓ putting is override-able
    ✓ issue 2779, deleted docs, old revs COUCHDB-292
    ✓ issue 2888, successive deletes and writes (38ms)
    ✓ 2 invalid puts
    ✓ Docs save "null" value
    ✓ replace PouchDB.destroy() (express-pouchdb#203)
    ✓ 3968, keeps all object fields
    ✓ 4712 invalid rev for new doc generates conflict
    ✓ test info() after db close
    ✓ test get() after db close
    ✓ test close() after db close
    ✓ 7259 should have "this" keyword properly scoped
    ✓ #5471 PouchDB.plugin() should throw error if passed wrong type or empty object

  test.basics.js-local
    ✓ Create a pouch without new keyword
    ✓ Name is accessible via instance
    ✓ 4314 Create a pouch with + in name
    ✓ Creating Pouch without name will throw
    ✓ 4314 Create a pouch with urlencoded name
    ✓ 4219 destroy a pouch
    ✓ 4339 throw useful error if method called on stale instance
    ✓ [4595] should reject xhr errors
    ✓ [4595] should emit error event on xhr error
    ✓ Add a doc
    ✓ Get invalid id
    ✓ Missing doc should contain ID in error object
    ✓ PUTed Conflicted doc should contain ID in error object
    ✓ POSTed Conflicted doc should contain ID in error object
    ✓ Add a doc with a promise
    ✓ Add a doc with opts object
    ✓ Modify a doc
    ✓ Modifying a doc that has rewritten content
    ✓ Modify a doc with a promise
    ✓ Read db id
    ✓ Read db id with promise
    ✓ Close db
    ✓ Close db with a promise
    ✓ Read db id after closing Close
    ✓ Modify a doc with incorrect rev
    ✓ Remove doc
    ✓ Remove doc with a promise
    ✓ Remove doc with new syntax
    ✓ Remove doc with new syntax and a promise
    ✓ Doc removal leaves only stub
    ✓ Remove doc twice with specified id
    ✓ Remove doc, no callback
    ✓ Delete document without id
    ✓ Delete document with many args
    ✓ Delete document with many args, callback style
    ✓ Delete doc with id + rev + no opts
    ✓ Delete doc with id + rev + no opts, callback style
    ✓ Delete doc with doc + opts
    ✓ Delete doc with doc + opts, callback style
    ✓ Delete doc with rev in opts
    ✓ Bulk docs
    ✓ Bulk docs with a promise
    ✓ Basic checks
    ✓ update with invalid rev
    ✓ Doc validation
    ✓ Replication fields (#2442)
    ✓ Allows _access field in documents (#8171)
    ✓ Testing issue #48 (51ms)
    ✓ Testing valid id
    ✓ Put doc without _id should fail
    ✓ Put doc with bad reserved id should fail
    ✓ update_seq persists
    ✓ deletions persists
    ✓ #4126 should not store raw Dates
    ✓ Create a db with a reserved name
    ✓ Error when document is not an object
    ✓ Test instance update_seq updates correctly
    ✓ Fail to fetch a doc after db was deleted
    ✓ Fail to fetch a doc after db was deleted
    ✓ Cant add docs with empty ids
    ✓ Test doc with percent in ID
    ✓ db.info should give auto_compaction = false (#2744)
    ✓ db.info should give auto_compaction = true (#2744)
    ✓ db.info should give adapter name (#3567)
    ✓ db.info should give correct doc_count
    ✓ putting returns {ok: true}
    ✓ putting is override-able
    ✓ issue 2779, deleted docs, old revs COUCHDB-292
    ✓ issue 2888, successive deletes and writes
    ✓ 2 invalid puts
    ✓ Docs save "null" value
    ✓ replace PouchDB.destroy() (express-pouchdb#203)
    ✓ 3968, keeps all object fields
    ✓ 4712 invalid rev for new doc generates conflict
    ✓ test info() after db close
    ✓ test get() after db close
    ✓ test close() after db close
    ✓ 7259 should have "this" keyword properly scoped
    ✓ should allow unicode doc ids
    ✓ should have same blob support for 2 dbs
    ✓ 6053, PouchDB.plugin() resets defaults
    ✓ #5471 PouchDB.plugin() should throw error if passed wrong type or empty object

  test.bulk_docs.js-local
    ✓ Testing bulk docs
    ✓ #6039 test id in bulk docs for conflict
    ✓ No id in bulk docs
    ✓ No _rev and new_edits=false
    ✓ 7829 bare rev 1- with new_edits=false
    ✓ Test empty bulkDocs
    ✓ Test many bulkDocs
    ✓ Test errors on invalid doc id
    ✓ Test two errors on invalid doc id
    ✓ No docs
    ✓ Jira 911
    ✓ Test multiple bulkdocs
    ✓ #2935 new_edits=false correct number
    ✓ #2935 new_edits=false correct number 2
    ✓ bulk docs update then delete then conflict
    ✓ bulk_docs delete then undelete
    ✓ #2935 new_edits=false with single unauthorized
    ✓ Deleting _local docs with bulkDocs
    ✓ Deleting _local docs with bulkDocs, not found
    ✓ Deleting _local docs with bulkDocs, wrong rev
    ✓ Bulk with new_edits=false
    ✓ Testing successive new_edits to the same doc
    ✓ #3062 bulkDocs with staggered seqs
    ✓ Testing successive new_edits to the same doc, different content
    ✓ Testing successive new_edits to two doc
    ✓ Deletion with new_edits=false
    ✓ Deletion with new_edits=false, no history
    ✓ Modification with new_edits=false, no history
    ✓ Deletion with new_edits=false, no history, no revisions
    ✓ Testing new_edits=false in req body
    ✓ 656 regression in handling deleted docs
    ✓ Test quotes in doc ids
    ✓ Bulk docs empty list
    ✓ handles simultaneous writes
    ✓ bulk docs input by array
    ✓ Bulk empty list
    ✓ Bulk docs not an array
    ✓ Bulk docs not an object
    ✓ Bulk docs two different revisions to same document id
    ✓ 4204 respect revs_limit (270ms)
    ✓ 2839 implement revs_limit (184ms)
    ✓ 4372 revs_limit deletes old revisions of the doc
    ✓ 4372 revs_limit with auto_compaction deletes old revisions of the doc
    ✓ 4712 invalid rev for new doc generates conflict
    ✓ 5793 bulk docs accepts _conflicts when new_edits=false

  test.bulk_docs.js-http
    ✓ Testing bulk docs
    ✓ #6039 test id in bulk docs for conflict
    ✓ No id in bulk docs
    ✓ No _rev and new_edits=false
    ✓ 7829 bare rev 1- with new_edits=false
    ✓ Test empty bulkDocs
    ✓ Test many bulkDocs
    ✓ Test errors on invalid doc id
    ✓ Test two errors on invalid doc id
    ✓ No docs
    ✓ Jira 911
    ✓ Test multiple bulkdocs
    ✓ #2935 new_edits=false correct number
    ✓ #2935 new_edits=false correct number 2
    ✓ bulk docs update then delete then conflict
    ✓ bulk_docs delete then undelete
    ✓ #2935 new_edits=false with single unauthorized
    ✓ Deleting _local docs with bulkDocs
    ✓ Bulk with new_edits=false
    ✓ Testing successive new_edits to the same doc
    ✓ #3062 bulkDocs with staggered seqs
    ✓ Testing successive new_edits to the same doc, different content
    ✓ Testing successive new_edits to two doc
    ✓ Deletion with new_edits=false
    ✓ Deletion with new_edits=false, no history
    ✓ Modification with new_edits=false, no history
    ✓ Deletion with new_edits=false, no history, no revisions
    ✓ Testing new_edits=false in req body
    ✓ 656 regression in handling deleted docs (46ms)
    ✓ Test quotes in doc ids
    ✓ Bulk docs empty list
    ✓ handles simultaneous writes
    ✓ bulk docs input by array
    ✓ Bulk empty list
    ✓ Bulk docs not an array
    ✓ Bulk docs not an object
    ✓ Bulk docs two different revisions to same document id
    ✓ 4204 respect revs_limit (243ms)
    ✓ 2839 implement revs_limit
    ✓ 4372 revs_limit deletes old revisions of the doc
    ✓ 4372 revs_limit with auto_compaction deletes old revisions of the doc
    ✓ 4712 invalid rev for new doc generates conflict
    ✓ 5793 bulk docs accepts _conflicts when new_edits=false

  test.bulk_get.js-http
    ✓ test bulk get with rev specified
    ✓ test bulk get with latest=true
    ✓ test bulk get with no rev specified
    ✓ _revisions is not returned by default
    ✓ #5886 bulkGet with reserved id
    ✓ _revisions is returned when specified
    ✓ _revisions is returned when specified, using implicit rev
    ✓ attachments are not included by default
    ✓ attachments are included when specified
    ✓ attachments are included when specified, using implicit rev

  test.bulk_get.js-local
    ✓ test bulk get with rev specified
    ✓ test bulk get with latest=true
    ✓ test bulk get with no rev specified
    ✓ _revisions is not returned by default
    ✓ #5886 bulkGet with reserved id
    ✓ _revisions is returned when specified
    ✓ _revisions is returned when specified, using implicit rev
    ✓ attachments are not included by default
    ✓ attachments are included when specified
    ✓ attachments are included when specified, using implicit rev

  test.changes.js-http
    ✓ All changes
    ✓ Changes with complete callback as param
    ✓ Promise resolved when changes cancelled
    - Live changes should clean listener when cancelled
    ✓ Changes Since
    ✓ Changes Since and limit limit 1
    ✓ Changes Since and limit limit 0
    ✓ Changes limit (39ms)
    ✓ Changes with filter not present in ddoc
    ✓ Changes with `filters` key not present in ddoc
    ✓ Changes limit and filter
    ✓ Changes with shorthand function name
    ✓ Changes with filter from nonexistent ddoc
    ✓ Changes with view not present in ddoc
    ✓ Changes with `views` key not present in ddoc
    ✓ #4451 Changes with invalid view filter
    ✓ 3356 throw inside a filter
    ✓ Changes with missing param `view` in request
    ✓ Changes limit and view instead of filter
    ✓ #3609 view option implies filter: _view
    ✓ Immediately cancel changes
    ✓ Changes with invalid ddoc view name
    ✓ Changes with invalid ddoc view name 2
    ✓ Changes with style = all_docs (64ms)
    ✓ Changes with style = all_docs and a callback for complete (75ms)
    ✓ Changes limit = 0
    ✓ Changes doc
    - Descending many changes
    ✓ live-changes
    ✓ Multiple watchers
    ✓ Continuous changes doc
    ✓ Cancel changes (323ms)
    ✓ #3579 changes firing 1 too many times (75ms)
    ✓ Kill database while listening to live changes
    ✓ #3136 style=all_docs (38ms)
    ✓ #4191 revs_diff causes endless loop
    ✓ #3136 style=all_docs & include_docs
    ✓ changes-filter with query params
    ✓ Non-live changes filter
    ✓ Non-live changes filter, descending
    ✓ #2569 Non-live doc_ids filter
    ✓ #2569 Big non-live doc_ids filter
    ✓ #2569 Live doc_ids filter
    ✓ #2569 Big live doc_ids filter
    ✓ #2569 Non-live doc_ids filter with filter=_doc_ids
    ✓ #2569 Live doc_ids filter with filter=_doc_ids
    ✓ Changes to same doc are grouped
    ✓ Changes with conflicts are handled correctly (125ms)
    ✓ Change entry for a deleted doc
    ✓ changes large number of docs
    ✓ Calling db.changes({since: 'now'})
    ✓ Calling db.changes({since: 'latest'})
    ✓ Closing db does not cause a crash if changes cancelled
    ✓ fire-complete-on-cancel (101ms)
    ✓ changes are not duplicated (1028ms)
    ✓ supports return_docs=false
    ✓ should respects limit (74ms)
    ✓ doesn't throw if opts.complete is undefined
    ✓ handle individual changes in live replication (199ms)
    ✓ changes-filter without filter
    ✓ #3539 - Exception in changes is fine
    ✓ Changes with selector
    ✓ Changes with selector, explicit filter
    ✓ Changes with selector and mismatched filter
    ✓ Changes with limit and selector

  test.changes.js-local
    ✓ All changes
    ✓ Changes with complete callback as param
    ✓ Promise resolved when changes cancelled
    - Live changes should clean listener when cancelled
    ✓ Changes Since
    ✓ Changes Since and limit limit 1
    ✓ Changes Since and limit limit 0
    ✓ Changes limit
    ✓ Changes with filter not present in ddoc
    ✓ Changes with `filters` key not present in ddoc
    ✓ Changes limit and filter
    ✓ Changes with shorthand function name
    ✓ Changes with filter from nonexistent ddoc
    ✓ Changes with view not present in ddoc
    ✓ Changes with `views` key not present in ddoc
    ✓ #4451 Changes with invalid view filter
    ✓ 3356 throw inside a filter
    ✓ Changes with missing param `view` in request
    ✓ Changes limit and view instead of filter
    ✓ #3609 view option implies filter: _view
    ✓ Immediately cancel changes
    ✓ Changes with invalid ddoc view name
    ✓ Changes with invalid ddoc view name 2
    ✓ Changes with style = all_docs
    ✓ Changes with style = all_docs and a callback for complete
    ✓ Changes limit = 0
    ✓ Changes doc
    - Descending many changes
    ✓ live-changes
    ✓ Multiple watchers (41ms)
    ✓ Continuous changes doc
    ✓ Cancel changes (316ms)
    ✓ #3579 changes firing 1 too many times (70ms)
    ✓ Kill database while listening to live changes
    ✓ #3136 style=all_docs
    ✓ #4191 revs_diff causes endless loop
    ✓ #3136 style=all_docs & include_docs
    ✓ changes-filter with query params
    ✓ Non-live changes filter
    ✓ Non-live changes filter, descending
    ✓ #2569 Non-live doc_ids filter
    ✓ #2569 Big non-live doc_ids filter
    ✓ #2569 Live doc_ids filter
    ✓ #2569 Big live doc_ids filter
    ✓ #2569 Non-live doc_ids filter with filter=_doc_ids
    ✓ #2569 Live doc_ids filter with filter=_doc_ids
    ✓ Changes to same doc are grouped
    ✓ Changes with conflicts are handled correctly
    ✓ Change entry for a deleted doc
    ✓ changes large number of docs
    ✓ Calling db.changes({since: 'now'})
    ✓ Calling db.changes({since: 'latest'})
    ✓ Closing db does not cause a crash if changes cancelled
    ✓ fire-complete-on-cancel (101ms)
    ✓ changes are not duplicated (1016ms)
    ✓ supports return_docs=false
    ✓ should respects limit (65ms)
    ✓ doesn't throw if opts.complete is undefined
    ✓ handle individual changes in live replication (74ms)
    ✓ changes-filter without filter
    ✓ #3539 - Exception in changes is fine
    ✓ Changes with selector
    ✓ Changes with selector, explicit filter
    ✓ Changes with selector and mismatched filter
    ✓ Changes with limit and selector

  changes-standalone
    - Changes reports errors

  test.close.js-local
    ✓ should emit destroyed even when closed (sync)
    ✓ should emit destroyed even when closed (async)
precondition_failed: Database not open
    at Object.<anonymous> (/data/js-variants/multee/Clients/levelup/pouchdb/packages/node_modules/pouchdb/lib/index.js:614:16)
    at Module._compile (node:internal/modules/cjs/loader:1105:14)
    at Module._extensions..js (node:internal/modules/cjs/loader:1159:10)
    at Module.load (node:internal/modules/cjs/loader:981:32)
    at Module._load (node:internal/modules/cjs/loader:827:12)
    at Module.require (node:internal/modules/cjs/loader:1005:19)
    at require (node:internal/modules/cjs/helpers:102:18)
    at commonUtils.loadPouchDBForNode (/data/js-variants/multee/Clients/levelup/pouchdb/tests/common-utils.js:92:17)
    at commonUtils.loadPouchDB (/data/js-variants/multee/Clients/levelup/pouchdb/tests/common-utils.js:78:39)
    at Object.<anonymous> (/data/js-variants/multee/Clients/levelup/pouchdb/tests/integration/node.setup.js:21:28)
    at Module._compile (node:internal/modules/cjs/loader:1105:14)
    at Module._extensions..js (node:internal/modules/cjs/loader:1159:10)
    at Module.load (node:internal/modules/cjs/loader:981:32)
    at Module._load (node:internal/modules/cjs/loader:827:12)
    at Module.require (node:internal/modules/cjs/loader:1005:19)
    at require (node:internal/modules/cjs/helpers:102:18)
    at /data/js-variants/multee/Clients/levelup/pouchdb/node_modules/mocha/bin/_mocha:366:3
    at Array.forEach (<anonymous>)
    at Object.<anonymous> (/data/js-variants/multee/Clients/levelup/pouchdb/node_modules/mocha/bin/_mocha:365:10)
    at Module._compile (node:internal/modules/cjs/loader:1105:14)
    at Module._extensions..js (node:internal/modules/cjs/loader:1159:10)
    at Module.load (node:internal/modules/cjs/loader:981:32)
    at Module._load (node:internal/modules/cjs/loader:827:12)
    at Function.executeUserEntryPoint [as runMain] (node:internal/modules/run_main:77:12)
    at node:internal/main/run_main_module:17:47
    ✓ should emit closed even when destroyed (async #2)
precondition_failed: Database not open
    at Object.<anonymous> (/data/js-variants/multee/Clients/levelup/pouchdb/packages/node_modules/pouchdb/lib/index.js:614:16)
    at Module._compile (node:internal/modules/cjs/loader:1105:14)
    at Module._extensions..js (node:internal/modules/cjs/loader:1159:10)
    at Module.load (node:internal/modules/cjs/loader:981:32)
    at Module._load (node:internal/modules/cjs/loader:827:12)
    at Module.require (node:internal/modules/cjs/loader:1005:19)
    at require (node:internal/modules/cjs/helpers:102:18)
    at commonUtils.loadPouchDBForNode (/data/js-variants/multee/Clients/levelup/pouchdb/tests/common-utils.js:92:17)
    at commonUtils.loadPouchDB (/data/js-variants/multee/Clients/levelup/pouchdb/tests/common-utils.js:78:39)
    at Object.<anonymous> (/data/js-variants/multee/Clients/levelup/pouchdb/tests/integration/node.setup.js:21:28)
    at Module._compile (node:internal/modules/cjs/loader:1105:14)
    at Module._extensions..js (node:internal/modules/cjs/loader:1159:10)
    at Module.load (node:internal/modules/cjs/loader:981:32)
    at Module._load (node:internal/modules/cjs/loader:827:12)
    at Module.require (node:internal/modules/cjs/loader:1005:19)
    at require (node:internal/modules/cjs/helpers:102:18)
    at /data/js-variants/multee/Clients/levelup/pouchdb/node_modules/mocha/bin/_mocha:366:3
    at Array.forEach (<anonymous>)
    at Object.<anonymous> (/data/js-variants/multee/Clients/levelup/pouchdb/node_modules/mocha/bin/_mocha:365:10)
    at Module._compile (node:internal/modules/cjs/loader:1105:14)
    at Module._extensions..js (node:internal/modules/cjs/loader:1159:10)
    at Module.load (node:internal/modules/cjs/loader:981:32)
    at Module._load (node:internal/modules/cjs/loader:827:12)
    at Function.executeUserEntryPoint [as runMain] (node:internal/modules/run_main:77:12)
    at node:internal/main/run_main_module:17:47
    ✓ test unref for coverage
    ✓ test double unref for coverage
precondition_failed: Database not open
    at Object.<anonymous> (/data/js-variants/multee/Clients/levelup/pouchdb/packages/node_modules/pouchdb/lib/index.js:614:16)
    at Module._compile (node:internal/modules/cjs/loader:1105:14)
    at Module._extensions..js (node:internal/modules/cjs/loader:1159:10)
    at Module.load (node:internal/modules/cjs/loader:981:32)
    at Module._load (node:internal/modules/cjs/loader:827:12)
    at Module.require (node:internal/modules/cjs/loader:1005:19)
    at require (node:internal/modules/cjs/helpers:102:18)
    at commonUtils.loadPouchDBForNode (/data/js-variants/multee/Clients/levelup/pouchdb/tests/common-utils.js:92:17)
    at commonUtils.loadPouchDB (/data/js-variants/multee/Clients/levelup/pouchdb/tests/common-utils.js:78:39)
    at Object.<anonymous> (/data/js-variants/multee/Clients/levelup/pouchdb/tests/integration/node.setup.js:21:28)
    at Module._compile (node:internal/modules/cjs/loader:1105:14)
    at Module._extensions..js (node:internal/modules/cjs/loader:1159:10)
    at Module.load (node:internal/modules/cjs/loader:981:32)
    at Module._load (node:internal/modules/cjs/loader:827:12)
    at Module.require (node:internal/modules/cjs/loader:1005:19)
    at require (node:internal/modules/cjs/helpers:102:18)
    at /data/js-variants/multee/Clients/levelup/pouchdb/node_modules/mocha/bin/_mocha:366:3
    at Array.forEach (<anonymous>)
    at Object.<anonymous> (/data/js-variants/multee/Clients/levelup/pouchdb/node_modules/mocha/bin/_mocha:365:10)
    at Module._compile (node:internal/modules/cjs/loader:1105:14)
    at Module._extensions..js (node:internal/modules/cjs/loader:1159:10)
    at Module.load (node:internal/modules/cjs/loader:981:32)
    at Module._load (node:internal/modules/cjs/loader:827:12)
    at Function.executeUserEntryPoint [as runMain] (node:internal/modules/run_main:77:12)
    at node:internal/main/run_main_module:17:47
    ✓ test close-then-destroyed for coverage
************* run test done *************
pouchdb is testing ./Variants/levelup/variant15/levelup
/data/js-variants/multee
************* npm unlink module *************

removed 1 package, changed 1 package, and audited 1032 packages in 4s

64 packages are looking for funding
  run `npm fund` for details

41 vulnerabilities (1 low, 9 moderate, 25 high, 6 critical)

To address issues that do not require attention, run:
  npm audit fix

To address all issues possible (including breaking changes), run:
  npm audit fix --force

Some issues need review, and may require choosing
a different dependency.

Run `npm audit` for details.
************* npm unlink module done *************
************* npm unlink globally *************

removed 1 package, and audited 1 package in 1s

found 0 vulnerabilities
************* npm unlink globally done *************
************* npm link globally *************

added 1 package, and audited 3 packages in 461ms

found 0 vulnerabilities
************* npm link globally done *************
************* npm link module *************

added 1 package, changed 1 package, and audited 1034 packages in 4s

64 packages are looking for funding
  run `npm fund` for details

41 vulnerabilities (1 low, 9 moderate, 25 high, 6 critical)

To address issues that do not require attention, run:
  npm audit fix

To address all issues possible (including breaking changes), run:
  npm audit fix --force

Some issues need review, and may require choosing
a different dependency.

Run `npm audit` for details.
************* npm link module done *************
************* start run test *************

> pouchdb-monorepo@7.0.0-prerelease test
> bash bin/run-test.sh


> pouchdb-monorepo@7.0.0-prerelease build-node
> bash bin/build-node.sh


> pouchdb-monorepo@7.0.0-prerelease build-modules
> node bin/build-modules.js

Building pouchdb...
Building pouchdb-abstract-mapreduce...
Building pouchdb-adapter-http...
Building pouchdb-adapter-idb...
Building pouchdb-adapter-indexeddb...
Building pouchdb-adapter-leveldb...
Building pouchdb-adapter-leveldb-core...
Building pouchdb-adapter-localstorage...
Building pouchdb-adapter-memory...
Building pouchdb-adapter-utils...
Building pouchdb-binary-utils...
Building pouchdb-browser...
Building pouchdb-changes-filter...
Building pouchdb-checkpointer...
Building pouchdb-collate...
Building pouchdb-collections...
Building pouchdb-core...
Building pouchdb-errors...
Building pouchdb-fetch...
Building pouchdb-find...
Building pouchdb-for-coverage...
Building pouchdb-generate-replication-id...
Building pouchdb-json...
Building pouchdb-mapreduce...
Building pouchdb-mapreduce-utils...
Building pouchdb-md5...
Building pouchdb-merge...
Building pouchdb-node...
Building pouchdb-replication...
Building pouchdb-selector-core...
Building pouchdb-utils...
Building sublevel-pouchdb...
  ✓ wrote pouchdb-adapter-localstorage/lib/index.js in vanilla mode
  ✓ wrote pouchdb-adapter-localstorage/lib/index.es.js in vanilla mode
  ✓ wrote pouchdb-adapter-memory/lib/index.js in vanilla mode
  ✓ wrote pouchdb-adapter-memory/lib/index.es.js in vanilla mode
  ✓ wrote pouchdb-checkpointer/lib/index.js in vanilla mode
  ✓ wrote pouchdb-checkpointer/lib/index.es.js in vanilla mode
  ✓ wrote pouchdb-errors/lib/index.js in vanilla mode
  ✓ wrote pouchdb-errors/lib/index.es.js in vanilla mode
  ✓ wrote pouchdb-generate-replication-id/lib/index.js in vanilla mode
  ✓ wrote pouchdb-generate-replication-id/lib/index.es.js in vanilla mode
  ✓ wrote pouchdb-adapter-http/lib/index.js in vanilla mode
  ✓ wrote pouchdb-adapter-http/lib/index.es.js in vanilla mode
  ✓ wrote pouchdb-adapter-leveldb/lib/index.js in node mode
  ✓ wrote pouchdb-adapter-leveldb/lib/index.es.js in node mode
  ✓ wrote pouchdb-adapter-leveldb/lib/index-browser.js in browser mode
  ✓ wrote pouchdb-adapter-leveldb/lib/index-browser.es.js in browser mode
  ✓ wrote pouchdb-adapter-leveldb-core/lib/index.js in node mode
  ✓ wrote pouchdb-adapter-leveldb-core/lib/index.es.js in node mode
  ✓ wrote pouchdb-adapter-leveldb-core/lib/index-browser.js in browser mode
  ✓ wrote pouchdb-adapter-leveldb-core/lib/index-browser.es.js in browser mode
  ✓ wrote pouchdb-changes-filter/lib/index-browser.js in browser mode
  ✓ wrote pouchdb-changes-filter/lib/index-browser.es.js in browser mode
  ✓ wrote pouchdb-fetch/lib/index-browser.js in browser mode
  ✓ wrote pouchdb-fetch/lib/index-browser.es.js in browser mode
  ✓ wrote pouchdb-md5/lib/index-browser.js in browser mode
  ✓ wrote pouchdb-md5/lib/index-browser.es.js in browser mode
  ✓ wrote pouchdb-changes-filter/lib/index.js in node mode
  ✓ wrote pouchdb-changes-filter/lib/index.es.js in node mode
  ✓ wrote pouchdb-collate/lib/index.js in vanilla mode
  ✓ wrote pouchdb-collate/lib/index.es.js in vanilla mode
  ✓ wrote pouchdb-fetch/lib/index.js in node mode
  ✓ wrote pouchdb-fetch/lib/index.es.js in node mode
  ✓ wrote pouchdb-json/lib/index.js in vanilla mode
  ✓ wrote pouchdb-json/lib/index.es.js in vanilla mode
  ✓ wrote pouchdb-mapreduce-utils/lib/index.js in vanilla mode
  ✓ wrote pouchdb-mapreduce-utils/lib/index.es.js in vanilla mode
  ✓ wrote pouchdb-md5/lib/index.js in node mode
  ✓ wrote pouchdb-md5/lib/index.es.js in node mode
  ✓ wrote pouchdb-abstract-mapreduce/lib/index.js in vanilla mode
  ✓ wrote pouchdb-abstract-mapreduce/lib/index.es.js in vanilla mode
  ✓ wrote pouchdb-adapter-idb/lib/index.js in vanilla mode
  ✓ wrote pouchdb-adapter-idb/lib/index.es.js in vanilla mode
  ✓ wrote pouchdb-adapter-indexeddb/lib/index.js in vanilla mode
  ✓ wrote pouchdb-adapter-indexeddb/lib/index.es.js in vanilla mode
  ✓ wrote pouchdb-binary-utils/lib/index-browser.js in browser mode
  ✓ wrote pouchdb-binary-utils/lib/index-browser.es.js in browser mode
  ✓ wrote pouchdb-utils/lib/index-browser.js in browser mode
  ✓ wrote pouchdb-utils/lib/index-browser.es.js in browser mode
  ✓ wrote pouchdb-utils/lib/index.js in node mode
  ✓ wrote pouchdb-utils/lib/index.es.js in node mode
  ✓ wrote pouchdb-binary-utils/lib/index.js in node mode
  ✓ wrote pouchdb-binary-utils/lib/index.es.js in node mode
  ✓ wrote pouchdb-adapter-utils/lib/index.js in vanilla mode
  ✓ wrote pouchdb-adapter-utils/lib/index.es.js in vanilla mode
  ✓ wrote pouchdb-collections/lib/index.js in vanilla mode
  ✓ wrote pouchdb-collections/lib/index.es.js in vanilla mode
  ✓ wrote pouchdb-merge/lib/index.js in vanilla mode
  ✓ wrote pouchdb-merge/lib/index.es.js in vanilla mode
  ✓ wrote pouchdb-selector-core/lib/index.js in vanilla mode
  ✓ wrote pouchdb-selector-core/lib/index.es.js in vanilla mode
  ✓ wrote sublevel-pouchdb/lib/index.js in vanilla mode
  ✓ wrote sublevel-pouchdb/lib/index.es.js in vanilla mode
  ✓ wrote pouchdb-mapreduce/lib/index-browser.js in browser mode
  ✓ wrote pouchdb-mapreduce/lib/index-browser.es.js in browser mode
  ✓ wrote pouchdb-replication/lib/index.js in vanilla mode
  ✓ wrote pouchdb-replication/lib/index.es.js in vanilla mode
  ✓ wrote pouchdb-mapreduce/lib/index.js in node mode
  ✓ wrote pouchdb-mapreduce/lib/index.es.js in node mode
  ✓ wrote pouchdb-core/lib/index.js in vanilla mode
  ✓ wrote pouchdb-core/lib/index.es.js in vanilla mode
  ✓ wrote pouchdb-find/lib/index.js in node mode
  ✓ wrote pouchdb-find/lib/index.es.js in node mode
  ✓ wrote pouchdb-find/lib/index-browser.js in browser mode
  ✓ wrote pouchdb-find/lib/index-browser.es.js in browser mode
  ✓ wrote pouchdb-for-coverage/lib/index.js in node mode
  ✓ wrote pouchdb-for-coverage/lib/index.es.js in node mode
  ✓ wrote pouchdb-for-coverage/lib/index-browser.js in browser mode
  ✓ wrote pouchdb-for-coverage/lib/index-browser.es.js in browser mode
  ✓ wrote pouchdb-browser/lib/index.js in vanilla mode
  ✓ wrote pouchdb-browser/lib/index.es.js in vanilla mode
  ✓ wrote pouchdb-node/lib/index.js in vanilla mode
  ✓ wrote pouchdb-node/lib/index.es.js in vanilla mode
  ✓ wrote packages/node_modules/pouchdb/lib/index.js
  ✓ wrote packages/node_modules/pouchdb/lib/index.es.js
Waiting for host to start ..
Host started :)
> pouchdb-monorepo@7.0.0-prerelease test-node
> bash bin/test-node.sh

Down server listening on port 3010
Seeded with: 1660142634441


  DB Setup
    ✓ PouchDB has a version
    ✓ PouchDB version matches package.json

  test.active_tasks.js
    ✓ Can add a task
    ✓ Can get tasks by id
    ✓ Can get all tasks
    ✓ Can update a task
    ✓ Can remove a task

  test.all_docs.js-http
    ✓ Testing all docs (172ms)
    ✓ Testing allDocs opts.keys (65ms)
    ✓ Testing allDocs opts.keys with skip
    ✓ Testing allDocs opts.keys with limit
    ✓ Testing allDocs invalid opts.keys
    ✓ Testing deleting in changes (43ms)
    ✓ Testing updating in changes (45ms)
    ✓ Testing include docs
    ✓ Testing conflicts (53ms)
    ✓ test basic collation
    ✓ 3883 start_key end_key aliases
    ✓ test total_rows with a variety of criteria (144ms)
    ✓ test total_rows with both skip and limit (41ms)
    ✓ test limit option and total_rows
    ✓ test escaped startkey/endkey
    ✓ test "key" option
    ✓ test inclusive_end=false (56ms)
    ✓ test descending with startkey/endkey
    ✓ #3082 test wrong num results returned (252ms)
    ✓ test empty db
    ✓ test after db close
    ✓ 5793 _conflicts should not exist if no conflicts
    ✓ #6230 Test allDocs opts update_seq: false
    ✓ #6230 Test allDocs opts update_seq: true
    ✓ #6230 Test allDocs opts with update_seq missing

  test.all_docs.js-local
    ✓ Testing all docs (44ms)
    ✓ Testing allDocs opts.keys
    ✓ Testing allDocs opts.keys with skip
    ✓ Testing allDocs opts.keys with limit
    ✓ Testing allDocs invalid opts.keys
    ✓ Testing deleting in changes
    ✓ Testing updating in changes
    ✓ Testing include docs
    ✓ Testing conflicts
    ✓ test basic collation
    ✓ 3883 start_key end_key aliases
    ✓ test total_rows with a variety of criteria
    ✓ test total_rows with both skip and limit
    ✓ test limit option and total_rows
    ✓ test escaped startkey/endkey
    ✓ test "key" option
    ✓ test inclusive_end=false
    ✓ test descending with startkey/endkey
    ✓ #3082 test wrong num results returned (202ms)
    ✓ test empty db
    ✓ test after db close
    ✓ test unicode ids and revs
    ✓ 5793 _conflicts should not exist if no conflicts
    ✓ #6230 Test allDocs opts update_seq: false
    ✓ #6230 Test allDocs opts update_seq: true
    ✓ #6230 Test allDocs opts with update_seq missing

  suite2 test.attachments.js-local
    ✓ 3357 Attachment names cant start with _
    ✓ 5736 warning for putAttachment without content_type
    ✓ 5736 warning for bulkDocs attachments without content_type
    ✓ fetch atts with open_revs and missing
    ✓ issue 2803 should throw 412
    ✓ issue 2803 should throw 412 part 2
    ✓ issue 2803 should throw 412 part 3
    ✓ issue 2803 should throw 412 part 4
    ✓ #2858 {binary: true} in get()
    ✓ #2858 {binary: true} in allDocs() 1
    ✓ #2858 {binary: true} in allDocs() 2
    ✓ #2858 {binary: true} in allDocs() 3
    ✓ #2858 {binary: true} in allDocs() 4
    ✓ #2858 {binary: true} in allDocs() 5
    ✓ #2858 {binary: true} in allDocs(), many atts
    ✓ #2858 {binary: true} in allDocs(), mixed atts
    ✓ #2858 {binary: true} in changes() non-live
    ✓ #2858 {binary: true} in changes() non-live, many atts
    ✓ #2858 {binary: true} in changes() non-live, mixed atts
    ✓ #2858 {binary: true} non-live changes, complete event
    ✓ #2858 {binary: true} in live changes
    ✓ #2858 {binary: true} in live changes, mixed atts
    ✓ #2858 {binary: true} in live+retry changes
    ✓ #2858 {binary: true} in live changes, attachments:false
    ✓ #2858 {binary: true} in live changes, include_docs:false
    ✓ #6736 {binary: true} in bulkGet()
    ✓ Measures length correctly after put()
    ✓ #3074 non-live changes()
    ✓ #3074 live changes()
    ✓ #3074 non-live changes(), no attachments
    ✓ #3074 live changes(), no attachments
    ✓ #3881 filter extraneous keys from _attachments
    ✓ #2771 allDocs() 1, single attachment
    ✓ #2771 allDocs() 2, many docs same att
    ✓ #2771 allDocs() 3, many docs diff atts
    ✓ #2771 allDocs() 4, mix of atts and no atts
    ✓ #2771 allDocs() 5, no atts
    ✓ #2771 allDocs() 6, no docs
    ✓ #2771 allDocs() 7, revisions and deletions
    ✓ #2771 allDocs() 8, empty attachment
    ✓ No length for non-stubs
    ✓ Test some attachments
    ✓ Test getAttachment
    ✓ Test getAttachment with stubs
    ✓ Test get() with binary:true and stubs
    ✓ Test attachments in allDocs/changes
    ✓ Test putAttachment with base64 plaintext
    ✓ Test putAttachment with invalid base64
    ✓ Test getAttachment with empty text
    ✓ Test getAttachment with normal text
    ✓ Test getAttachment with PNG
    ✓ Test getAttachment with PNG using bulkDocs
    ✓ Test getAttachment with PNG using post
    ✓ Test postAttachment with PNG then bulkDocs
    ✓ proper stub behavior
    ✓ Testing with invalid docs
    ✓ Test create attachment and doc in one go
    ✓ Test create attachment and doc in one go without callback
    ✓ Test create attachment without callback
    ✓ Test put attachment on a doc without attachments
    ✓ Test put attachment with unencoded name
    ✓ 3963 length property on stubs
    ✓ Testing with invalid rev
    ✓ Test put another attachment on a doc with attachments
    ✓ Test get with attachments: true if empty attachments
    ✓ Test delete attachment from a doc
    ✓ Test a document with a json string attachment
    ✓ Test remove doc with attachment
    ✓ Try to insert a doc with unencoded attachment
    ✓ Try to get attachment of unexistent doc
    ✓ Test synchronous putAttachment with text data
    ✓ Test synchronous putAttachment with no text data
    ✓ Test put with partial stubs
    ✓ Test put with attachments and new_edits=false
    ✓ Test getAttachment with specific rev
    ✓ Test getAttachment with diff revs and content
    ✓ Test stubs
    ✓ Try to get unexistent attachment of some doc
    ✓ putAttachment and getAttachment with plaintext
    ✓ putAttachment and getAttachment with png data
    ✓ putAttachment in new doc with base64
    ✓ #2818 - save same attachment in different revs
    ✓ #2818 - save same attachment many times in parallel
    ✓ #2818 - revisions keep attachments (no compaction)
    ✓ #2818 - doesn't throw 409 if same filename
    ✓ #3008 test correct encoding/decoding of \u0000 etc.
    ✓ putAttachment and getAttachment with big png data (106ms)
    ✓ #2709 `revpos` with putAttachment
    ✓ #2709 `revpos` with inline attachment
    ✓ #2709 `revpos` with allDocs
    ✓ #7403 {attachments: true, binary: true, include_docs: true} in allDocs with one missing doc

  suite2 test.attachments.js-http
    ✓ 3357 Attachment names cant start with _
    ✓ 5736 warning for putAttachment without content_type
    ✓ 5736 warning for bulkDocs attachments without content_type
    ✓ fetch atts with open_revs and missing
    ✓ issue 2803 should throw 412
    ✓ issue 2803 should throw 412 part 2
    ✓ issue 2803 should throw 412 part 3
    ✓ issue 2803 should throw 412 part 4
    ✓ #2858 {binary: true} in get()
    ✓ #2858 {binary: true} in allDocs() 1 (71ms)
    ✓ #2858 {binary: true} in allDocs() 2
    ✓ #2858 {binary: true} in allDocs() 3
    ✓ #2858 {binary: true} in allDocs() 4
    ✓ #2858 {binary: true} in allDocs() 5
    ✓ #2858 {binary: true} in allDocs(), many atts
    ✓ #2858 {binary: true} in allDocs(), mixed atts
    ✓ #2858 {binary: true} in changes() non-live
    ✓ #2858 {binary: true} in changes() non-live, many atts
    ✓ #2858 {binary: true} in changes() non-live, mixed atts
    ✓ #2858 {binary: true} non-live changes, complete event
    ✓ #2858 {binary: true} in live changes
    ✓ #2858 {binary: true} in live changes, mixed atts
    ✓ #2858 {binary: true} in live+retry changes
    ✓ #2858 {binary: true} in live changes, attachments:false
    ✓ #2858 {binary: true} in live changes, include_docs:false (38ms)
    ✓ #6736 {binary: true} in bulkGet() (44ms)
    ✓ Measures length correctly after put()
    ✓ #3074 non-live changes() (39ms)
    ✓ #3074 live changes() (46ms)
    ✓ #3074 non-live changes(), no attachments (38ms)
    ✓ #3074 live changes(), no attachments
    ✓ #3881 filter extraneous keys from _attachments
    ✓ #2771 allDocs() 1, single attachment
    ✓ #2771 allDocs() 2, many docs same att
    ✓ #2771 allDocs() 3, many docs diff atts
    ✓ #2771 allDocs() 4, mix of atts and no atts (40ms)
    ✓ #2771 allDocs() 5, no atts
    ✓ #2771 allDocs() 6, no docs
    ✓ #2771 allDocs() 7, revisions and deletions
    ✓ #2771 allDocs() 8, empty attachment
    ✓ No length for non-stubs
    ✓ Test some attachments (71ms)
    ✓ Test getAttachment (50ms)
    ✓ Test getAttachment with stubs
    ✓ Test get() with binary:true and stubs
    ✓ Test attachments in allDocs/changes
    ✓ Test putAttachment with base64 plaintext
    ✓ Test putAttachment with invalid base64
    ✓ Test getAttachment with empty text
    ✓ Test getAttachment with normal text
    ✓ Test getAttachment with PNG
    ✓ Test getAttachment with PNG using bulkDocs
    ✓ Test getAttachment with PNG using post
    ✓ Test postAttachment with PNG then bulkDocs
    ✓ proper stub behavior (44ms)
    ✓ Testing with invalid docs
    ✓ Test create attachment and doc in one go
    ✓ Test create attachment and doc in one go without callback
    ✓ Test create attachment without callback
    ✓ Test put attachment on a doc without attachments
    ✓ Test put attachment with unencoded name
    ✓ 3963 length property on stubs (47ms)
    ✓ Testing with invalid rev
    ✓ Test put another attachment on a doc with attachments
    ✓ Test get with attachments: true if empty attachments
    ✓ Test delete attachment from a doc (48ms)
    ✓ Test a document with a json string attachment
    ✓ Test remove doc with attachment
    ✓ Try to insert a doc with unencoded attachment
    ✓ Try to get attachment of unexistent doc
    ✓ Test synchronous putAttachment with text data
    ✓ Test synchronous putAttachment with no text data
    ✓ Test put with partial stubs (39ms)
    ✓ Test put with attachments and new_edits=false
    ✓ Test getAttachment with specific rev (39ms)
    ✓ Test getAttachment with diff revs and content
    ✓ Test stubs
    ✓ Try to get unexistent attachment of some doc
    ✓ putAttachment and getAttachment with plaintext
    ✓ putAttachment and getAttachment with png data
    ✓ putAttachment in new doc with base64
    ✓ #2818 - save same attachment in different revs (54ms)
    ✓ #2818 - save same attachment many times in parallel
    ✓ #2818 - revisions keep attachments (no compaction)
    ✓ #2818 - doesn't throw 409 if same filename
    ✓ #3008 test correct encoding/decoding of \u0000 etc.
    ✓ putAttachment and getAttachment with big png data (124ms)
    ✓ #2709 `revpos` with putAttachment (40ms)
    ✓ #2709 `revpos` with inline attachment
    ✓ #2709 `revpos` with allDocs
    ✓ #7403 {attachments: true, binary: true, include_docs: true} in allDocs with one missing doc

  suite2 test.attachments.js- local:http
    ✓ Attachments replicate back and forth (113ms)
    ✓ Replicate same doc, same atts (193ms)
    ✓ Replicate same doc, same atts 2 (168ms)
    ✓ Attachments replicate (65ms)
    ✓ Attachment types replicate (53ms)
    ✓ Many many attachments replicate (199ms)
    ✓ Many many png attachments replicate (189ms)
    ✓ Multiple attachments replicate (77ms)
    - #3961 Many attachments on same doc
    ✓ Multiple attachments replicate, different docs (#2698) (83ms)
    ✓ Multiple attachments replicate, different docs png (#2698) (74ms)
    ✓ #3932 attachments with tricky revpos (137ms)
    ✓ replication with changing attachments (100ms)
    ✓ 3955 race condition in put
    ✓ #8456 bad attachment rev after replication (117ms)

  suite2 test.attachments.js- http:http
    ✓ Attachments replicate back and forth (162ms)
    ✓ Replicate same doc, same atts (175ms)
    ✓ Replicate same doc, same atts 2 (271ms)
    ✓ Attachments replicate (85ms)
    ✓ Attachment types replicate (97ms)
    ✓ Many many attachments replicate (368ms)
    ✓ Many many png attachments replicate (294ms)
    ✓ Multiple attachments replicate (129ms)
    - #3961 Many attachments on same doc
    ✓ Multiple attachments replicate, different docs (#2698) (127ms)
    ✓ Multiple attachments replicate, different docs png (#2698) (122ms)
    ✓ #3932 attachments with tricky revpos (223ms)
    ✓ replication with changing attachments (144ms)
    ✓ 3955 race condition in put
    ✓ #8456 bad attachment rev after replication (301ms)

  suite2 test.attachments.js- http:local
    ✓ Attachments replicate back and forth (102ms)
    ✓ Replicate same doc, same atts (92ms)
    ✓ Replicate same doc, same atts 2 (100ms)
    ✓ Attachments replicate (65ms)
    ✓ Attachment types replicate (51ms)
    ✓ Many many attachments replicate (152ms)
    ✓ Many many png attachments replicate (158ms)
    ✓ Multiple attachments replicate (83ms)
    - #3961 Many attachments on same doc
    ✓ Multiple attachments replicate, different docs (#2698) (70ms)
    ✓ Multiple attachments replicate, different docs png (#2698) (88ms)
    ✓ #3932 attachments with tricky revpos (142ms)
    ✓ replication with changing attachments (96ms)
    ✓ 3955 race condition in put
    ✓ #8456 bad attachment rev after replication (122ms)

  suite2 test.attachments.js- local:local
    ✓ Attachments replicate back and forth
    ✓ Replicate same doc, same atts
    ✓ Replicate same doc, same atts 2
    ✓ Attachments replicate
    ✓ Attachment types replicate
    ✓ Many many attachments replicate (49ms)
    ✓ Many many png attachments replicate (39ms)
    ✓ Multiple attachments replicate
    - #3961 Many attachments on same doc
    ✓ Multiple attachments replicate, different docs (#2698)
    ✓ Multiple attachments replicate, different docs png (#2698)
    ✓ #3932 attachments with tricky revpos (39ms)
    ✓ replication with changing attachments
    ✓ 3955 race condition in put
    ✓ #8456 bad attachment rev after replication

  test.basics.js-http
    ✓ Create a pouch without new keyword
    ✓ Name is accessible via instance
    ✓ 4314 Create a pouch with + in name
    ✓ Creating Pouch without name will throw
    ✓ 4314 Create a pouch with urlencoded name
    ✓ 4219 destroy a pouch
    ✓ 4339 throw useful error if method called on stale instance
    ✓ [4595] should reject xhr errors
    ✓ [4595] should emit error event on xhr error
    ✓ Add a doc
    ✓ Get invalid id
    ✓ Missing doc should contain ID in error object
    ✓ PUTed Conflicted doc should contain ID in error object
    ✓ POSTed Conflicted doc should contain ID in error object
    ✓ Add a doc with a promise
    ✓ Add a doc with opts object
    ✓ Modify a doc
    ✓ Modifying a doc that has rewritten content
    ✓ Modify a doc with a promise
    ✓ Read db id
    ✓ Read db id with promise
    ✓ Close db
    ✓ Close db with a promise
    ✓ Read db id after closing Close
    ✓ Modify a doc with incorrect rev
    ✓ Remove doc
    ✓ Remove doc with a promise
    ✓ Remove doc with new syntax
    ✓ Remove doc with new syntax and a promise
    ✓ Doc removal leaves only stub
    ✓ Remove doc twice with specified id
    ✓ Remove doc, no callback
    ✓ Delete document without id
    ✓ Delete document with many args
    ✓ Delete document with many args, callback style
    ✓ Delete doc with id + rev + no opts
    ✓ Delete doc with id + rev + no opts, callback style
    ✓ Delete doc with doc + opts
    ✓ Delete doc with doc + opts, callback style
    ✓ Delete doc with rev in opts
    ✓ Bulk docs
    ✓ Bulk docs with a promise
    ✓ Basic checks
    ✓ update with invalid rev
    ✓ Doc validation
    ✓ Replication fields (#2442)
    ✓ Testing issue #48 (54ms)
    ✓ Testing valid id
    ✓ Put doc without _id should fail
    ✓ Put doc with bad reserved id should fail
    ✓ update_seq persists
    ✓ deletions persists
    ✓ #4126 should not store raw Dates
    ✓ Create a db with a reserved name
    ✓ Error when document is not an object
    ✓ Test instance update_seq updates correctly
    ✓ Fail to fetch a doc after db was deleted (81ms)
    ✓ Fail to fetch a doc after db was deleted (57ms)
    ✓ Cant add docs with empty ids
    ✓ Test doc with percent in ID
    ✓ db.info should give auto_compaction = false (#2744)
    ✓ db.info should give auto_compaction = true (#2744)
    ✓ db.info should give adapter name (#3567)
    ✓ db.info should give correct doc_count
    ✓ putting returns {ok: true}
    ✓ putting is override-able
    ✓ issue 2779, deleted docs, old revs COUCHDB-292
    ✓ issue 2888, successive deletes and writes (38ms)
    ✓ 2 invalid puts
    ✓ Docs save "null" value
    ✓ replace PouchDB.destroy() (express-pouchdb#203)
    ✓ 3968, keeps all object fields
    ✓ 4712 invalid rev for new doc generates conflict
    ✓ test info() after db close
    ✓ test get() after db close
    ✓ test close() after db close
    ✓ 7259 should have "this" keyword properly scoped
    ✓ #5471 PouchDB.plugin() should throw error if passed wrong type or empty object

  test.basics.js-local
    ✓ Create a pouch without new keyword
    ✓ Name is accessible via instance
    ✓ 4314 Create a pouch with + in name
    ✓ Creating Pouch without name will throw
    ✓ 4314 Create a pouch with urlencoded name
    ✓ 4219 destroy a pouch
    ✓ 4339 throw useful error if method called on stale instance
    ✓ [4595] should reject xhr errors
    ✓ [4595] should emit error event on xhr error
    ✓ Add a doc
    ✓ Get invalid id
    ✓ Missing doc should contain ID in error object
    ✓ PUTed Conflicted doc should contain ID in error object
    ✓ POSTed Conflicted doc should contain ID in error object
    ✓ Add a doc with a promise
    ✓ Add a doc with opts object
    ✓ Modify a doc
    ✓ Modifying a doc that has rewritten content
    ✓ Modify a doc with a promise
    ✓ Read db id
    ✓ Read db id with promise
    ✓ Close db
    ✓ Close db with a promise
    ✓ Read db id after closing Close
    ✓ Modify a doc with incorrect rev
    ✓ Remove doc
    ✓ Remove doc with a promise
    ✓ Remove doc with new syntax
    ✓ Remove doc with new syntax and a promise
    ✓ Doc removal leaves only stub
    ✓ Remove doc twice with specified id
    ✓ Remove doc, no callback
    ✓ Delete document without id
    ✓ Delete document with many args
    ✓ Delete document with many args, callback style
    ✓ Delete doc with id + rev + no opts
    ✓ Delete doc with id + rev + no opts, callback style
    ✓ Delete doc with doc + opts
    ✓ Delete doc with doc + opts, callback style
    ✓ Delete doc with rev in opts
    ✓ Bulk docs
    ✓ Bulk docs with a promise
    ✓ Basic checks
    ✓ update with invalid rev
    ✓ Doc validation
    ✓ Replication fields (#2442)
    ✓ Allows _access field in documents (#8171)
    ✓ Testing issue #48 (53ms)
    ✓ Testing valid id
    ✓ Put doc without _id should fail
    ✓ Put doc with bad reserved id should fail
    ✓ update_seq persists (49ms)
    ✓ deletions persists
    ✓ #4126 should not store raw Dates
    ✓ Create a db with a reserved name
    ✓ Error when document is not an object
    ✓ Test instance update_seq updates correctly
    ✓ Fail to fetch a doc after db was deleted
    ✓ Fail to fetch a doc after db was deleted
    ✓ Cant add docs with empty ids
    ✓ Test doc with percent in ID
    ✓ db.info should give auto_compaction = false (#2744)
    ✓ db.info should give auto_compaction = true (#2744)
    ✓ db.info should give adapter name (#3567)
    ✓ db.info should give correct doc_count
    ✓ putting returns {ok: true}
    ✓ putting is override-able
    ✓ issue 2779, deleted docs, old revs COUCHDB-292
    ✓ issue 2888, successive deletes and writes
    ✓ 2 invalid puts
    ✓ Docs save "null" value
    ✓ replace PouchDB.destroy() (express-pouchdb#203)
    ✓ 3968, keeps all object fields
    ✓ 4712 invalid rev for new doc generates conflict
    ✓ test info() after db close
    ✓ test get() after db close
    ✓ test close() after db close
    ✓ 7259 should have "this" keyword properly scoped
    ✓ should allow unicode doc ids
    ✓ should have same blob support for 2 dbs
    ✓ 6053, PouchDB.plugin() resets defaults
    ✓ #5471 PouchDB.plugin() should throw error if passed wrong type or empty object

  test.bulk_docs.js-local
    ✓ Testing bulk docs
    ✓ #6039 test id in bulk docs for conflict
    ✓ No id in bulk docs
    ✓ No _rev and new_edits=false
    ✓ 7829 bare rev 1- with new_edits=false
    ✓ Test empty bulkDocs
    ✓ Test many bulkDocs
    ✓ Test errors on invalid doc id
    ✓ Test two errors on invalid doc id
    ✓ No docs
    ✓ Jira 911
    ✓ Test multiple bulkdocs
    ✓ #2935 new_edits=false correct number
    ✓ #2935 new_edits=false correct number 2
    ✓ bulk docs update then delete then conflict
    ✓ bulk_docs delete then undelete
    ✓ #2935 new_edits=false with single unauthorized
    ✓ Deleting _local docs with bulkDocs
    ✓ Deleting _local docs with bulkDocs, not found
    ✓ Deleting _local docs with bulkDocs, wrong rev
    ✓ Bulk with new_edits=false
    ✓ Testing successive new_edits to the same doc
    ✓ #3062 bulkDocs with staggered seqs
    ✓ Testing successive new_edits to the same doc, different content
    ✓ Testing successive new_edits to two doc
    ✓ Deletion with new_edits=false
    ✓ Deletion with new_edits=false, no history
    ✓ Modification with new_edits=false, no history
    ✓ Deletion with new_edits=false, no history, no revisions
    ✓ Testing new_edits=false in req body
    ✓ 656 regression in handling deleted docs
    ✓ Test quotes in doc ids
    ✓ Bulk docs empty list
    ✓ handles simultaneous writes
    ✓ bulk docs input by array
    ✓ Bulk empty list
    ✓ Bulk docs not an array
    ✓ Bulk docs not an object
    ✓ Bulk docs two different revisions to same document id
    ✓ 4204 respect revs_limit (265ms)
    ✓ 2839 implement revs_limit (191ms)
    ✓ 4372 revs_limit deletes old revisions of the doc
    ✓ 4372 revs_limit with auto_compaction deletes old revisions of the doc
    ✓ 4712 invalid rev for new doc generates conflict
    ✓ 5793 bulk docs accepts _conflicts when new_edits=false

  test.bulk_docs.js-http
    ✓ Testing bulk docs
    ✓ #6039 test id in bulk docs for conflict
    ✓ No id in bulk docs
    ✓ No _rev and new_edits=false
    ✓ 7829 bare rev 1- with new_edits=false
    ✓ Test empty bulkDocs
    ✓ Test many bulkDocs (47ms)
    ✓ Test errors on invalid doc id
    ✓ Test two errors on invalid doc id
    ✓ No docs
    ✓ Jira 911
    ✓ Test multiple bulkdocs
    ✓ #2935 new_edits=false correct number
    ✓ #2935 new_edits=false correct number 2
    ✓ bulk docs update then delete then conflict
    ✓ bulk_docs delete then undelete
    ✓ #2935 new_edits=false with single unauthorized
    ✓ Deleting _local docs with bulkDocs (45ms)
    ✓ Bulk with new_edits=false
    ✓ Testing successive new_edits to the same doc (51ms)
    ✓ #3062 bulkDocs with staggered seqs
    ✓ Testing successive new_edits to the same doc, different content
    ✓ Testing successive new_edits to two doc
    ✓ Deletion with new_edits=false
    ✓ Deletion with new_edits=false, no history
    ✓ Modification with new_edits=false, no history
    ✓ Deletion with new_edits=false, no history, no revisions
    ✓ Testing new_edits=false in req body
    ✓ 656 regression in handling deleted docs
    ✓ Test quotes in doc ids
    ✓ Bulk docs empty list
    ✓ handles simultaneous writes
    ✓ bulk docs input by array
    ✓ Bulk empty list
    ✓ Bulk docs not an array
    ✓ Bulk docs not an object
    ✓ Bulk docs two different revisions to same document id
    ✓ 4204 respect revs_limit (242ms)
    ✓ 2839 implement revs_limit
    ✓ 4372 revs_limit deletes old revisions of the doc
    ✓ 4372 revs_limit with auto_compaction deletes old revisions of the doc
    ✓ 4712 invalid rev for new doc generates conflict
    ✓ 5793 bulk docs accepts _conflicts when new_edits=false

  test.bulk_get.js-http
    ✓ test bulk get with rev specified
    ✓ test bulk get with latest=true
    ✓ test bulk get with no rev specified
    ✓ _revisions is not returned by default
    ✓ #5886 bulkGet with reserved id
    ✓ _revisions is returned when specified
    ✓ _revisions is returned when specified, using implicit rev
    ✓ attachments are not included by default
    ✓ attachments are included when specified
    ✓ attachments are included when specified, using implicit rev

  test.bulk_get.js-local
    ✓ test bulk get with rev specified
    ✓ test bulk get with latest=true
    ✓ test bulk get with no rev specified
    ✓ _revisions is not returned by default
    ✓ #5886 bulkGet with reserved id
    ✓ _revisions is returned when specified
    ✓ _revisions is returned when specified, using implicit rev
    ✓ attachments are not included by default
    ✓ attachments are included when specified
    ✓ attachments are included when specified, using implicit rev

  test.changes.js-http
    ✓ All changes
    ✓ Changes with complete callback as param
    ✓ Promise resolved when changes cancelled
    - Live changes should clean listener when cancelled
    ✓ Changes Since
    ✓ Changes Since and limit limit 1
    ✓ Changes Since and limit limit 0
    ✓ Changes limit (39ms)
    ✓ Changes with filter not present in ddoc
    ✓ Changes with `filters` key not present in ddoc
    ✓ Changes limit and filter (39ms)
    ✓ Changes with shorthand function name
    ✓ Changes with filter from nonexistent ddoc
    ✓ Changes with view not present in ddoc
    ✓ Changes with `views` key not present in ddoc
    ✓ #4451 Changes with invalid view filter
    ✓ 3356 throw inside a filter
    ✓ Changes with missing param `view` in request
    ✓ Changes limit and view instead of filter (40ms)
    ✓ #3609 view option implies filter: _view
    ✓ Immediately cancel changes
    ✓ Changes with invalid ddoc view name
    ✓ Changes with invalid ddoc view name 2
    ✓ Changes with style = all_docs (64ms)
    ✓ Changes with style = all_docs and a callback for complete (58ms)
    ✓ Changes limit = 0
    ✓ Changes doc
    - Descending many changes
    ✓ live-changes
    ✓ Multiple watchers
    ✓ Continuous changes doc
    ✓ Cancel changes (324ms)
    ✓ #3579 changes firing 1 too many times (75ms)
    ✓ Kill database while listening to live changes
    ✓ #3136 style=all_docs
    ✓ #4191 revs_diff causes endless loop
    ✓ #3136 style=all_docs & include_docs (38ms)
    ✓ changes-filter with query params
    ✓ Non-live changes filter
    ✓ Non-live changes filter, descending
    ✓ #2569 Non-live doc_ids filter (45ms)
    ✓ #2569 Big non-live doc_ids filter
    ✓ #2569 Live doc_ids filter
    ✓ #2569 Big live doc_ids filter
    ✓ #2569 Non-live doc_ids filter with filter=_doc_ids
    ✓ #2569 Live doc_ids filter with filter=_doc_ids
    ✓ Changes to same doc are grouped
    ✓ Changes with conflicts are handled correctly (153ms)
    ✓ Change entry for a deleted doc
    ✓ changes large number of docs
    ✓ Calling db.changes({since: 'now'})
    ✓ Calling db.changes({since: 'latest'})
    ✓ Closing db does not cause a crash if changes cancelled
    ✓ fire-complete-on-cancel (101ms)
    ✓ changes are not duplicated (1027ms)
    ✓ supports return_docs=false
    ✓ should respects limit (72ms)
    ✓ doesn't throw if opts.complete is undefined
    ✓ handle individual changes in live replication (191ms)
    ✓ changes-filter without filter
    ✓ #3539 - Exception in changes is fine
    ✓ Changes with selector
    ✓ Changes with selector, explicit filter
    ✓ Changes with selector and mismatched filter
    ✓ Changes with limit and selector

  test.changes.js-local
    ✓ All changes
    ✓ Changes with complete callback as param
    ✓ Promise resolved when changes cancelled
    - Live changes should clean listener when cancelled
    ✓ Changes Since
    ✓ Changes Since and limit limit 1
    ✓ Changes Since and limit limit 0
    ✓ Changes limit
    ✓ Changes with filter not present in ddoc
    ✓ Changes with `filters` key not present in ddoc
    ✓ Changes limit and filter
    ✓ Changes with shorthand function name
    ✓ Changes with filter from nonexistent ddoc
    ✓ Changes with view not present in ddoc
    ✓ Changes with `views` key not present in ddoc
    ✓ #4451 Changes with invalid view filter
    ✓ 3356 throw inside a filter
    ✓ Changes with missing param `view` in request
    ✓ Changes limit and view instead of filter
    ✓ #3609 view option implies filter: _view
    ✓ Immediately cancel changes
    ✓ Changes with invalid ddoc view name
    ✓ Changes with invalid ddoc view name 2
    ✓ Changes with style = all_docs
    ✓ Changes with style = all_docs and a callback for complete
    ✓ Changes limit = 0
    ✓ Changes doc
    - Descending many changes
    ✓ live-changes
    ✓ Multiple watchers
    ✓ Continuous changes doc
    ✓ Cancel changes (317ms)
    ✓ #3579 changes firing 1 too many times (67ms)
    ✓ Kill database while listening to live changes
    ✓ #3136 style=all_docs
    ✓ #4191 revs_diff causes endless loop
    ✓ #3136 style=all_docs & include_docs
    ✓ changes-filter with query params
    ✓ Non-live changes filter
    ✓ Non-live changes filter, descending
    ✓ #2569 Non-live doc_ids filter
    ✓ #2569 Big non-live doc_ids filter
    ✓ #2569 Live doc_ids filter
    ✓ #2569 Big live doc_ids filter
    ✓ #2569 Non-live doc_ids filter with filter=_doc_ids
    ✓ #2569 Live doc_ids filter with filter=_doc_ids
    ✓ Changes to same doc are grouped
    ✓ Changes with conflicts are handled correctly
    ✓ Change entry for a deleted doc
    ✓ changes large number of docs
    ✓ Calling db.changes({since: 'now'})
    ✓ Calling db.changes({since: 'latest'})
    ✓ Closing db does not cause a crash if changes cancelled
    ✓ fire-complete-on-cancel (102ms)
    ✓ changes are not duplicated (1015ms)
    ✓ supports return_docs=false
    ✓ should respects limit (73ms)
    ✓ doesn't throw if opts.complete is undefined
    ✓ handle individual changes in live replication (67ms)
    ✓ changes-filter without filter
    ✓ #3539 - Exception in changes is fine
    ✓ Changes with selector
    ✓ Changes with selector, explicit filter
    ✓ Changes with selector and mismatched filter
    ✓ Changes with limit and selector

  changes-standalone
    - Changes reports errors

  test.close.js-local
    ✓ should emit destroyed even when closed (sync)
    ✓ should emit destroyed even when closed (async)
precondition_failed: Database not open
    at Object.<anonymous> (/data/js-variants/multee/Clients/levelup/pouchdb/packages/node_modules/pouchdb/lib/index.js:614:16)
    at Module._compile (node:internal/modules/cjs/loader:1105:14)
    at Module._extensions..js (node:internal/modules/cjs/loader:1159:10)
    at Module.load (node:internal/modules/cjs/loader:981:32)
    at Module._load (node:internal/modules/cjs/loader:827:12)
    at Module.require (node:internal/modules/cjs/loader:1005:19)
    at require (node:internal/modules/cjs/helpers:102:18)
    at commonUtils.loadPouchDBForNode (/data/js-variants/multee/Clients/levelup/pouchdb/tests/common-utils.js:92:17)
    at commonUtils.loadPouchDB (/data/js-variants/multee/Clients/levelup/pouchdb/tests/common-utils.js:78:39)
    at Object.<anonymous> (/data/js-variants/multee/Clients/levelup/pouchdb/tests/integration/node.setup.js:21:28)
    at Module._compile (node:internal/modules/cjs/loader:1105:14)
    at Module._extensions..js (node:internal/modules/cjs/loader:1159:10)
    at Module.load (node:internal/modules/cjs/loader:981:32)
    at Module._load (node:internal/modules/cjs/loader:827:12)
    at Module.require (node:internal/modules/cjs/loader:1005:19)
    at require (node:internal/modules/cjs/helpers:102:18)
    at /data/js-variants/multee/Clients/levelup/pouchdb/node_modules/mocha/bin/_mocha:366:3
    at Array.forEach (<anonymous>)
    at Object.<anonymous> (/data/js-variants/multee/Clients/levelup/pouchdb/node_modules/mocha/bin/_mocha:365:10)
    at Module._compile (node:internal/modules/cjs/loader:1105:14)
    at Module._extensions..js (node:internal/modules/cjs/loader:1159:10)
    at Module.load (node:internal/modules/cjs/loader:981:32)
    at Module._load (node:internal/modules/cjs/loader:827:12)
    at Function.executeUserEntryPoint [as runMain] (node:internal/modules/run_main:77:12)
    at node:internal/main/run_main_module:17:47
    ✓ should emit closed even when destroyed (async #2)
precondition_failed: Database not open
    at Object.<anonymous> (/data/js-variants/multee/Clients/levelup/pouchdb/packages/node_modules/pouchdb/lib/index.js:614:16)
    at Module._compile (node:internal/modules/cjs/loader:1105:14)
    at Module._extensions..js (node:internal/modules/cjs/loader:1159:10)
    at Module.load (node:internal/modules/cjs/loader:981:32)
    at Module._load (node:internal/modules/cjs/loader:827:12)
    at Module.require (node:internal/modules/cjs/loader:1005:19)
    at require (node:internal/modules/cjs/helpers:102:18)
    at commonUtils.loadPouchDBForNode (/data/js-variants/multee/Clients/levelup/pouchdb/tests/common-utils.js:92:17)
    at commonUtils.loadPouchDB (/data/js-variants/multee/Clients/levelup/pouchdb/tests/common-utils.js:78:39)
    at Object.<anonymous> (/data/js-variants/multee/Clients/levelup/pouchdb/tests/integration/node.setup.js:21:28)
    at Module._compile (node:internal/modules/cjs/loader:1105:14)
    at Module._extensions..js (node:internal/modules/cjs/loader:1159:10)
    at Module.load (node:internal/modules/cjs/loader:981:32)
    at Module._load (node:internal/modules/cjs/loader:827:12)
    at Module.require (node:internal/modules/cjs/loader:1005:19)
    at require (node:internal/modules/cjs/helpers:102:18)
    at /data/js-variants/multee/Clients/levelup/pouchdb/node_modules/mocha/bin/_mocha:366:3
    at Array.forEach (<anonymous>)
    at Object.<anonymous> (/data/js-variants/multee/Clients/levelup/pouchdb/node_modules/mocha/bin/_mocha:365:10)
    at Module._compile (node:internal/modules/cjs/loader:1105:14)
    at Module._extensions..js (node:internal/modules/cjs/loader:1159:10)
    at Module.load (node:internal/modules/cjs/loader:981:32)
    at Module._load (node:internal/modules/cjs/loader:827:12)
    at Function.executeUserEntryPoint [as runMain] (node:internal/modules/run_main:77:12)
    at node:internal/main/run_main_module:17:47
    ✓ test unref for coverage
    ✓ test double unref for coverage
precondition_failed: Database not open
    at Object.<anonymous> (/data/js-variants/multee/Clients/levelup/pouchdb/packages/node_modules/pouchdb/lib/index.js:614:16)
    at Module._compile (node:internal/modules/cjs/loader:1105:14)
    at Module._extensions..js (node:internal/modules/cjs/loader:1159:10)
    at Module.load (node:internal/modules/cjs/loader:981:32)
    at Module._load (node:internal/modules/cjs/loader:827:12)
    at Module.require (node:internal/modules/cjs/loader:1005:19)
    at require (node:internal/modules/cjs/helpers:102:18)
    at commonUtils.loadPouchDBForNode (/data/js-variants/multee/Clients/levelup/pouchdb/tests/common-utils.js:92:17)
    at commonUtils.loadPouchDB (/data/js-variants/multee/Clients/levelup/pouchdb/tests/common-utils.js:78:39)
    at Object.<anonymous> (/data/js-variants/multee/Clients/levelup/pouchdb/tests/integration/node.setup.js:21:28)
    at Module._compile (node:internal/modules/cjs/loader:1105:14)
    at Module._extensions..js (node:internal/modules/cjs/loader:1159:10)
    at Module.load (node:internal/modules/cjs/loader:981:32)
    at Module._load (node:internal/modules/cjs/loader:827:12)
    at Module.require (node:internal/modules/cjs/loader:1005:19)
    at require (node:internal/modules/cjs/helpers:102:18)
    at /data/js-variants/multee/Clients/levelup/pouchdb/node_modules/mocha/bin/_mocha:366:3
    at Array.forEach (<anonymous>)
    at Object.<anonymous> (/data/js-variants/multee/Clients/levelup/pouchdb/node_modules/mocha/bin/_mocha:365:10)
    at Module._compile (node:internal/modules/cjs/loader:1105:14)
    at Module._extensions..js (node:internal/modules/cjs/loader:1159:10)
    at Module.load (node:internal/modules/cjs/loader:981:32)
    at Module._load (node:internal/modules/cjs/loader:827:12)
    at Function.executeUserEntryPoint [as runMain] (node:internal/modules/run_main:77:12)
    at node:internal/main/run_main_module:17:47
    ✓ test close-then-destroyed for coverage
************* run test done *************
pouchdb is testing ./Variants/levelup/variant14/levelup
/data/js-variants/multee
************* npm unlink module *************

removed 1 package, changed 1 package, and audited 1032 packages in 8s

64 packages are looking for funding
  run `npm fund` for details

41 vulnerabilities (1 low, 9 moderate, 25 high, 6 critical)

To address issues that do not require attention, run:
  npm audit fix

To address all issues possible (including breaking changes), run:
  npm audit fix --force

Some issues need review, and may require choosing
a different dependency.

Run `npm audit` for details.
************* npm unlink module done *************
************* npm unlink globally *************

removed 1 package, and audited 1 package in 1s

found 0 vulnerabilities
************* npm unlink globally done *************
************* npm link globally *************

added 1 package, and audited 3 packages in 413ms

found 0 vulnerabilities
************* npm link globally done *************
************* npm link module *************

added 1 package, changed 1 package, and audited 1034 packages in 4s

64 packages are looking for funding
  run `npm fund` for details

41 vulnerabilities (1 low, 9 moderate, 25 high, 6 critical)

To address issues that do not require attention, run:
  npm audit fix

To address all issues possible (including breaking changes), run:
  npm audit fix --force

Some issues need review, and may require choosing
a different dependency.

Run `npm audit` for details.
************* npm link module done *************
************* start run test *************

> pouchdb-monorepo@7.0.0-prerelease test
> bash bin/run-test.sh


> pouchdb-monorepo@7.0.0-prerelease build-node
> bash bin/build-node.sh


> pouchdb-monorepo@7.0.0-prerelease build-modules
> node bin/build-modules.js

Building pouchdb...
Building pouchdb-abstract-mapreduce...
Building pouchdb-adapter-http...
Building pouchdb-adapter-idb...
Building pouchdb-adapter-indexeddb...
Building pouchdb-adapter-leveldb...
Building pouchdb-adapter-leveldb-core...
Building pouchdb-adapter-localstorage...
Building pouchdb-adapter-memory...
Building pouchdb-adapter-utils...
Building pouchdb-binary-utils...
Building pouchdb-browser...
Building pouchdb-changes-filter...
Building pouchdb-checkpointer...
Building pouchdb-collate...
Building pouchdb-collections...
Building pouchdb-core...
Building pouchdb-errors...
Building pouchdb-fetch...
Building pouchdb-find...
Building pouchdb-for-coverage...
Building pouchdb-generate-replication-id...
Building pouchdb-json...
Building pouchdb-mapreduce...
Building pouchdb-mapreduce-utils...
Building pouchdb-md5...
Building pouchdb-merge...
Building pouchdb-node...
Building pouchdb-replication...
Building pouchdb-selector-core...
Building pouchdb-utils...
Building sublevel-pouchdb...
  ✓ wrote pouchdb-adapter-localstorage/lib/index.js in vanilla mode
  ✓ wrote pouchdb-adapter-localstorage/lib/index.es.js in vanilla mode
  ✓ wrote pouchdb-adapter-memory/lib/index.js in vanilla mode
  ✓ wrote pouchdb-adapter-memory/lib/index.es.js in vanilla mode
  ✓ wrote pouchdb-checkpointer/lib/index.js in vanilla mode
  ✓ wrote pouchdb-checkpointer/lib/index.es.js in vanilla mode
  ✓ wrote pouchdb-errors/lib/index.js in vanilla mode
  ✓ wrote pouchdb-errors/lib/index.es.js in vanilla mode
  ✓ wrote pouchdb-generate-replication-id/lib/index.js in vanilla mode
  ✓ wrote pouchdb-generate-replication-id/lib/index.es.js in vanilla mode
  ✓ wrote pouchdb-adapter-http/lib/index.js in vanilla mode
  ✓ wrote pouchdb-adapter-http/lib/index.es.js in vanilla mode
  ✓ wrote pouchdb-adapter-leveldb/lib/index.js in node mode
  ✓ wrote pouchdb-adapter-leveldb/lib/index.es.js in node mode
  ✓ wrote pouchdb-adapter-leveldb/lib/index-browser.js in browser mode
  ✓ wrote pouchdb-adapter-leveldb/lib/index-browser.es.js in browser mode
  ✓ wrote pouchdb-adapter-leveldb-core/lib/index.js in node mode
  ✓ wrote pouchdb-adapter-leveldb-core/lib/index.es.js in node mode
  ✓ wrote pouchdb-adapter-leveldb-core/lib/index-browser.js in browser mode
  ✓ wrote pouchdb-adapter-leveldb-core/lib/index-browser.es.js in browser mode
  ✓ wrote pouchdb-changes-filter/lib/index-browser.js in browser mode
  ✓ wrote pouchdb-changes-filter/lib/index-browser.es.js in browser mode
  ✓ wrote pouchdb-fetch/lib/index-browser.js in browser mode
  ✓ wrote pouchdb-fetch/lib/index-browser.es.js in browser mode
  ✓ wrote pouchdb-md5/lib/index-browser.js in browser mode
  ✓ wrote pouchdb-md5/lib/index-browser.es.js in browser mode
  ✓ wrote pouchdb-changes-filter/lib/index.js in node mode
  ✓ wrote pouchdb-changes-filter/lib/index.es.js in node mode
  ✓ wrote pouchdb-collate/lib/index.js in vanilla mode
  ✓ wrote pouchdb-collate/lib/index.es.js in vanilla mode
  ✓ wrote pouchdb-fetch/lib/index.js in node mode
  ✓ wrote pouchdb-fetch/lib/index.es.js in node mode
  ✓ wrote pouchdb-json/lib/index.js in vanilla mode
  ✓ wrote pouchdb-json/lib/index.es.js in vanilla mode
  ✓ wrote pouchdb-mapreduce-utils/lib/index.js in vanilla mode
  ✓ wrote pouchdb-mapreduce-utils/lib/index.es.js in vanilla mode
  ✓ wrote pouchdb-md5/lib/index.js in node mode
  ✓ wrote pouchdb-md5/lib/index.es.js in node mode
  ✓ wrote pouchdb-abstract-mapreduce/lib/index.js in vanilla mode
  ✓ wrote pouchdb-abstract-mapreduce/lib/index.es.js in vanilla mode
  ✓ wrote pouchdb-adapter-idb/lib/index.js in vanilla mode
  ✓ wrote pouchdb-adapter-idb/lib/index.es.js in vanilla mode
  ✓ wrote pouchdb-adapter-indexeddb/lib/index.js in vanilla mode
  ✓ wrote pouchdb-adapter-indexeddb/lib/index.es.js in vanilla mode
  ✓ wrote pouchdb-binary-utils/lib/index-browser.js in browser mode
  ✓ wrote pouchdb-binary-utils/lib/index-browser.es.js in browser mode
  ✓ wrote pouchdb-adapter-utils/lib/index.js in vanilla mode
  ✓ wrote pouchdb-adapter-utils/lib/index.es.js in vanilla mode
  ✓ wrote pouchdb-binary-utils/lib/index.js in node mode
  ✓ wrote pouchdb-binary-utils/lib/index.es.js in node mode
  ✓ wrote pouchdb-collections/lib/index.js in vanilla mode
  ✓ wrote pouchdb-collections/lib/index.es.js in vanilla mode
  ✓ wrote pouchdb-merge/lib/index.js in vanilla mode
  ✓ wrote pouchdb-merge/lib/index.es.js in vanilla mode
  ✓ wrote pouchdb-selector-core/lib/index.js in vanilla mode
  ✓ wrote pouchdb-selector-core/lib/index.es.js in vanilla mode
  ✓ wrote pouchdb-utils/lib/index-browser.js in browser mode
  ✓ wrote pouchdb-utils/lib/index-browser.es.js in browser mode
  ✓ wrote pouchdb-utils/lib/index.js in node mode
  ✓ wrote pouchdb-utils/lib/index.es.js in node mode
  ✓ wrote sublevel-pouchdb/lib/index.js in vanilla mode
  ✓ wrote sublevel-pouchdb/lib/index.es.js in vanilla mode
  ✓ wrote pouchdb-mapreduce/lib/index-browser.js in browser mode
  ✓ wrote pouchdb-mapreduce/lib/index-browser.es.js in browser mode
  ✓ wrote pouchdb-replication/lib/index.js in vanilla mode
  ✓ wrote pouchdb-replication/lib/index.es.js in vanilla mode
  ✓ wrote pouchdb-mapreduce/lib/index.js in node mode
  ✓ wrote pouchdb-mapreduce/lib/index.es.js in node mode
  ✓ wrote pouchdb-core/lib/index.js in vanilla mode
  ✓ wrote pouchdb-core/lib/index.es.js in vanilla mode
  ✓ wrote pouchdb-find/lib/index.js in node mode
  ✓ wrote pouchdb-find/lib/index.es.js in node mode
  ✓ wrote pouchdb-find/lib/index-browser.js in browser mode
  ✓ wrote pouchdb-find/lib/index-browser.es.js in browser mode
  ✓ wrote pouchdb-for-coverage/lib/index.js in node mode
  ✓ wrote pouchdb-for-coverage/lib/index.es.js in node mode
  ✓ wrote pouchdb-for-coverage/lib/index-browser.js in browser mode
  ✓ wrote pouchdb-for-coverage/lib/index-browser.es.js in browser mode
  ✓ wrote pouchdb-browser/lib/index.js in vanilla mode
  ✓ wrote pouchdb-browser/lib/index.es.js in vanilla mode
  ✓ wrote pouchdb-node/lib/index.js in vanilla mode
  ✓ wrote pouchdb-node/lib/index.es.js in vanilla mode
  ✓ wrote packages/node_modules/pouchdb/lib/index.es.js
  ✓ wrote packages/node_modules/pouchdb/lib/index.js
Waiting for host to start ..
Host started :)
> pouchdb-monorepo@7.0.0-prerelease test-node
> bash bin/test-node.sh

Down server listening on port 3010
Seeded with: 1660142693000


  DB Setup
    ✓ PouchDB has a version
    ✓ PouchDB version matches package.json

  test.active_tasks.js
    ✓ Can add a task
    ✓ Can get tasks by id
    ✓ Can get all tasks
    ✓ Can update a task
    ✓ Can remove a task

  test.all_docs.js-http
    ✓ Testing all docs (171ms)
    ✓ Testing allDocs opts.keys (64ms)
    ✓ Testing allDocs opts.keys with skip
    ✓ Testing allDocs opts.keys with limit (39ms)
    ✓ Testing allDocs invalid opts.keys
    ✓ Testing deleting in changes (48ms)
    ✓ Testing updating in changes (51ms)
    ✓ Testing include docs
    ✓ Testing conflicts (51ms)
    ✓ test basic collation
    ✓ 3883 start_key end_key aliases
    ✓ test total_rows with a variety of criteria (143ms)
    ✓ test total_rows with both skip and limit
    ✓ test limit option and total_rows
    ✓ test escaped startkey/endkey
    ✓ test "key" option
    ✓ test inclusive_end=false (58ms)
    ✓ test descending with startkey/endkey
    ✓ #3082 test wrong num results returned (256ms)
    ✓ test empty db
    ✓ test after db close
    ✓ 5793 _conflicts should not exist if no conflicts
    ✓ #6230 Test allDocs opts update_seq: false
    ✓ #6230 Test allDocs opts update_seq: true
    ✓ #6230 Test allDocs opts with update_seq missing (43ms)

  test.all_docs.js-local
    ✓ Testing all docs (53ms)
    ✓ Testing allDocs opts.keys
    ✓ Testing allDocs opts.keys with skip
    ✓ Testing allDocs opts.keys with limit
    ✓ Testing allDocs invalid opts.keys
    ✓ Testing deleting in changes
    ✓ Testing updating in changes
    ✓ Testing include docs
    ✓ Testing conflicts
    ✓ test basic collation
    ✓ 3883 start_key end_key aliases
    ✓ test total_rows with a variety of criteria
    ✓ test total_rows with both skip and limit
    ✓ test limit option and total_rows
    ✓ test escaped startkey/endkey
    ✓ test "key" option
    ✓ test inclusive_end=false
    ✓ test descending with startkey/endkey
    ✓ #3082 test wrong num results returned (190ms)
    ✓ test empty db
    ✓ test after db close
    ✓ test unicode ids and revs
    ✓ 5793 _conflicts should not exist if no conflicts
    ✓ #6230 Test allDocs opts update_seq: false
    ✓ #6230 Test allDocs opts update_seq: true
    ✓ #6230 Test allDocs opts with update_seq missing

  suite2 test.attachments.js-local
    ✓ 3357 Attachment names cant start with _
    ✓ 5736 warning for putAttachment without content_type
    ✓ 5736 warning for bulkDocs attachments without content_type
    ✓ fetch atts with open_revs and missing
    ✓ issue 2803 should throw 412
    ✓ issue 2803 should throw 412 part 2
    ✓ issue 2803 should throw 412 part 3
    ✓ issue 2803 should throw 412 part 4
    ✓ #2858 {binary: true} in get() (125ms)
    ✓ #2858 {binary: true} in allDocs() 1
    ✓ #2858 {binary: true} in allDocs() 2
    ✓ #2858 {binary: true} in allDocs() 3
    ✓ #2858 {binary: true} in allDocs() 4
    ✓ #2858 {binary: true} in allDocs() 5
    ✓ #2858 {binary: true} in allDocs(), many atts
    ✓ #2858 {binary: true} in allDocs(), mixed atts
    ✓ #2858 {binary: true} in changes() non-live
    ✓ #2858 {binary: true} in changes() non-live, many atts
    ✓ #2858 {binary: true} in changes() non-live, mixed atts
    ✓ #2858 {binary: true} non-live changes, complete event
    ✓ #2858 {binary: true} in live changes
    ✓ #2858 {binary: true} in live changes, mixed atts
    ✓ #2858 {binary: true} in live+retry changes
    ✓ #2858 {binary: true} in live changes, attachments:false
    ✓ #2858 {binary: true} in live changes, include_docs:false
    ✓ #6736 {binary: true} in bulkGet()
    ✓ Measures length correctly after put()
    ✓ #3074 non-live changes()
    ✓ #3074 live changes()
    ✓ #3074 non-live changes(), no attachments
    ✓ #3074 live changes(), no attachments
    ✓ #3881 filter extraneous keys from _attachments
    ✓ #2771 allDocs() 1, single attachment
    ✓ #2771 allDocs() 2, many docs same att
    ✓ #2771 allDocs() 3, many docs diff atts
    ✓ #2771 allDocs() 4, mix of atts and no atts
    ✓ #2771 allDocs() 5, no atts
    ✓ #2771 allDocs() 6, no docs
    ✓ #2771 allDocs() 7, revisions and deletions
    ✓ #2771 allDocs() 8, empty attachment
    ✓ No length for non-stubs
    ✓ Test some attachments
    ✓ Test getAttachment
    ✓ Test getAttachment with stubs
    ✓ Test get() with binary:true and stubs
    ✓ Test attachments in allDocs/changes (41ms)
    ✓ Test putAttachment with base64 plaintext
    ✓ Test putAttachment with invalid base64
    ✓ Test getAttachment with empty text
    ✓ Test getAttachment with normal text
    ✓ Test getAttachment with PNG
    ✓ Test getAttachment with PNG using bulkDocs
    ✓ Test getAttachment with PNG using post
    ✓ Test postAttachment with PNG then bulkDocs
    ✓ proper stub behavior
    ✓ Testing with invalid docs
    ✓ Test create attachment and doc in one go
    ✓ Test create attachment and doc in one go without callback
    ✓ Test create attachment without callback
    ✓ Test put attachment on a doc without attachments
    ✓ Test put attachment with unencoded name
    ✓ 3963 length property on stubs
    ✓ Testing with invalid rev
    ✓ Test put another attachment on a doc with attachments
    ✓ Test get with attachments: true if empty attachments
    ✓ Test delete attachment from a doc
    ✓ Test a document with a json string attachment
    ✓ Test remove doc with attachment
    ✓ Try to insert a doc with unencoded attachment
    ✓ Try to get attachment of unexistent doc
    ✓ Test synchronous putAttachment with text data
    ✓ Test synchronous putAttachment with no text data
    ✓ Test put with partial stubs
    ✓ Test put with attachments and new_edits=false
    ✓ Test getAttachment with specific rev
    ✓ Test getAttachment with diff revs and content
    ✓ Test stubs
    ✓ Try to get unexistent attachment of some doc
    ✓ putAttachment and getAttachment with plaintext
    ✓ putAttachment and getAttachment with png data
    ✓ putAttachment in new doc with base64
    ✓ #2818 - save same attachment in different revs
    ✓ #2818 - save same attachment many times in parallel
    ✓ #2818 - revisions keep attachments (no compaction)
    ✓ #2818 - doesn't throw 409 if same filename
    ✓ #3008 test correct encoding/decoding of \u0000 etc.
    ✓ putAttachment and getAttachment with big png data (95ms)
    ✓ #2709 `revpos` with putAttachment
    ✓ #2709 `revpos` with inline attachment
    ✓ #2709 `revpos` with allDocs
    ✓ #7403 {attachments: true, binary: true, include_docs: true} in allDocs with one missing doc

  suite2 test.attachments.js-http
    ✓ 3357 Attachment names cant start with _
    ✓ 5736 warning for putAttachment without content_type
    ✓ 5736 warning for bulkDocs attachments without content_type
    ✓ fetch atts with open_revs and missing
    ✓ issue 2803 should throw 412
    ✓ issue 2803 should throw 412 part 2
    ✓ issue 2803 should throw 412 part 3
    ✓ issue 2803 should throw 412 part 4
    ✓ #2858 {binary: true} in get() (38ms)
    ✓ #2858 {binary: true} in allDocs() 1
    ✓ #2858 {binary: true} in allDocs() 2
    ✓ #2858 {binary: true} in allDocs() 3
    ✓ #2858 {binary: true} in allDocs() 4
    ✓ #2858 {binary: true} in allDocs() 5
    ✓ #2858 {binary: true} in allDocs(), many atts
    ✓ #2858 {binary: true} in allDocs(), mixed atts
    ✓ #2858 {binary: true} in changes() non-live
    ✓ #2858 {binary: true} in changes() non-live, many atts
    ✓ #2858 {binary: true} in changes() non-live, mixed atts
    ✓ #2858 {binary: true} non-live changes, complete event
    ✓ #2858 {binary: true} in live changes
    ✓ #2858 {binary: true} in live changes, mixed atts
    ✓ #2858 {binary: true} in live+retry changes
    ✓ #2858 {binary: true} in live changes, attachments:false
    ✓ #2858 {binary: true} in live changes, include_docs:false
    ✓ #6736 {binary: true} in bulkGet()
    ✓ Measures length correctly after put()
    ✓ #3074 non-live changes() (42ms)
    ✓ #3074 live changes() (40ms)
    ✓ #3074 non-live changes(), no attachments
    ✓ #3074 live changes(), no attachments
    ✓ #3881 filter extraneous keys from _attachments
    ✓ #2771 allDocs() 1, single attachment (38ms)
    ✓ #2771 allDocs() 2, many docs same att
    ✓ #2771 allDocs() 3, many docs diff atts
    ✓ #2771 allDocs() 4, mix of atts and no atts
    ✓ #2771 allDocs() 5, no atts
    ✓ #2771 allDocs() 6, no docs
    ✓ #2771 allDocs() 7, revisions and deletions (40ms)
    ✓ #2771 allDocs() 8, empty attachment
    ✓ No length for non-stubs (49ms)
    ✓ Test some attachments (49ms)
    ✓ Test getAttachment
    ✓ Test getAttachment with stubs
    ✓ Test get() with binary:true and stubs
    ✓ Test attachments in allDocs/changes
    ✓ Test putAttachment with base64 plaintext
    ✓ Test putAttachment with invalid base64
    ✓ Test getAttachment with empty text
    ✓ Test getAttachment with normal text
    ✓ Test getAttachment with PNG
    ✓ Test getAttachment with PNG using bulkDocs
    ✓ Test getAttachment with PNG using post
    ✓ Test postAttachment with PNG then bulkDocs (70ms)
    ✓ proper stub behavior (59ms)
    ✓ Testing with invalid docs
    ✓ Test create attachment and doc in one go
    ✓ Test create attachment and doc in one go without callback
    ✓ Test create attachment without callback (41ms)
    ✓ Test put attachment on a doc without attachments
    ✓ Test put attachment with unencoded name
    ✓ 3963 length property on stubs (47ms)
    ✓ Testing with invalid rev
    ✓ Test put another attachment on a doc with attachments
    ✓ Test get with attachments: true if empty attachments
    ✓ Test delete attachment from a doc (44ms)
    ✓ Test a document with a json string attachment
    ✓ Test remove doc with attachment
    ✓ Try to insert a doc with unencoded attachment
    ✓ Try to get attachment of unexistent doc
    ✓ Test synchronous putAttachment with text data
    ✓ Test synchronous putAttachment with no text data
    ✓ Test put with partial stubs
    ✓ Test put with attachments and new_edits=false
    ✓ Test getAttachment with specific rev
    ✓ Test getAttachment with diff revs and content (38ms)
    ✓ Test stubs
    ✓ Try to get unexistent attachment of some doc
    ✓ putAttachment and getAttachment with plaintext
    ✓ putAttachment and getAttachment with png data
    ✓ putAttachment in new doc with base64
    ✓ #2818 - save same attachment in different revs (49ms)
    ✓ #2818 - save same attachment many times in parallel
    ✓ #2818 - revisions keep attachments (no compaction) (40ms)
    ✓ #2818 - doesn't throw 409 if same filename
    ✓ #3008 test correct encoding/decoding of \u0000 etc.
    ✓ putAttachment and getAttachment with big png data (125ms)
    ✓ #2709 `revpos` with putAttachment (42ms)
    ✓ #2709 `revpos` with inline attachment
    ✓ #2709 `revpos` with allDocs
    ✓ #7403 {attachments: true, binary: true, include_docs: true} in allDocs with one missing doc

  suite2 test.attachments.js- local:http
    ✓ Attachments replicate back and forth (108ms)
    ✓ Replicate same doc, same atts (112ms)
    ✓ Replicate same doc, same atts 2 (110ms)
    ✓ Attachments replicate (83ms)
    ✓ Attachment types replicate (53ms)
    ✓ Many many attachments replicate (282ms)
    ✓ Many many png attachments replicate (207ms)
    ✓ Multiple attachments replicate (72ms)
    - #3961 Many attachments on same doc
    ✓ Multiple attachments replicate, different docs (#2698) (81ms)
    ✓ Multiple attachments replicate, different docs png (#2698) (65ms)
    ✓ #3932 attachments with tricky revpos (133ms)
    ✓ replication with changing attachments (95ms)
    ✓ 3955 race condition in put
    ✓ #8456 bad attachment rev after replication (117ms)

  suite2 test.attachments.js- http:http
    ✓ Attachments replicate back and forth (163ms)
    ✓ Replicate same doc, same atts (179ms)
    ✓ Replicate same doc, same atts 2 (186ms)
    ✓ Attachments replicate (76ms)
    ✓ Attachment types replicate (90ms)
    ✓ Many many attachments replicate (477ms)
    ✓ Many many png attachments replicate (294ms)
    ✓ Multiple attachments replicate (127ms)
    - #3961 Many attachments on same doc
    ✓ Multiple attachments replicate, different docs (#2698) (120ms)
    ✓ Multiple attachments replicate, different docs png (#2698) (122ms)
    ✓ #3932 attachments with tricky revpos (232ms)
    ✓ replication with changing attachments (157ms)
    ✓ 3955 race condition in put
    ✓ #8456 bad attachment rev after replication (176ms)

  suite2 test.attachments.js- http:local
    ✓ Attachments replicate back and forth (106ms)
    ✓ Replicate same doc, same atts (93ms)
    ✓ Replicate same doc, same atts 2 (146ms)
    ✓ Attachments replicate (59ms)
    ✓ Attachment types replicate (49ms)
    ✓ Many many attachments replicate (139ms)
    ✓ Many many png attachments replicate (187ms)
    ✓ Multiple attachments replicate (82ms)
    - #3961 Many attachments on same doc
    ✓ Multiple attachments replicate, different docs (#2698) (70ms)
    ✓ Multiple attachments replicate, different docs png (#2698) (86ms)
    ✓ #3932 attachments with tricky revpos (160ms)
    ✓ replication with changing attachments (93ms)
    ✓ 3955 race condition in put
    ✓ #8456 bad attachment rev after replication (115ms)

  suite2 test.attachments.js- local:local
    ✓ Attachments replicate back and forth
    ✓ Replicate same doc, same atts
    ✓ Replicate same doc, same atts 2
    ✓ Attachments replicate
    ✓ Attachment types replicate
    ✓ Many many attachments replicate
    ✓ Many many png attachments replicate
    ✓ Multiple attachments replicate
    - #3961 Many attachments on same doc
    ✓ Multiple attachments replicate, different docs (#2698)
    ✓ Multiple attachments replicate, different docs png (#2698)
    ✓ #3932 attachments with tricky revpos
    ✓ replication with changing attachments
    ✓ 3955 race condition in put
    ✓ #8456 bad attachment rev after replication (76ms)

  test.basics.js-http
    ✓ Create a pouch without new keyword
    ✓ Name is accessible via instance
    ✓ 4314 Create a pouch with + in name
    ✓ Creating Pouch without name will throw
    ✓ 4314 Create a pouch with urlencoded name
    ✓ 4219 destroy a pouch
    ✓ 4339 throw useful error if method called on stale instance
    ✓ [4595] should reject xhr errors
    ✓ [4595] should emit error event on xhr error
    ✓ Add a doc
    ✓ Get invalid id
    ✓ Missing doc should contain ID in error object
    ✓ PUTed Conflicted doc should contain ID in error object
    ✓ POSTed Conflicted doc should contain ID in error object
    ✓ Add a doc with a promise
    ✓ Add a doc with opts object
    ✓ Modify a doc
    ✓ Modifying a doc that has rewritten content
    ✓ Modify a doc with a promise
    ✓ Read db id
    ✓ Read db id with promise
    ✓ Close db
    ✓ Close db with a promise
    ✓ Read db id after closing Close
    ✓ Modify a doc with incorrect rev
    ✓ Remove doc
    ✓ Remove doc with a promise
    ✓ Remove doc with new syntax
    ✓ Remove doc with new syntax and a promise
    ✓ Doc removal leaves only stub
    ✓ Remove doc twice with specified id
    ✓ Remove doc, no callback
    ✓ Delete document without id
    ✓ Delete document with many args
    ✓ Delete document with many args, callback style
    ✓ Delete doc with id + rev + no opts
    ✓ Delete doc with id + rev + no opts, callback style
    ✓ Delete doc with doc + opts
    ✓ Delete doc with doc + opts, callback style
    ✓ Delete doc with rev in opts
    ✓ Bulk docs
    ✓ Bulk docs with a promise
    ✓ Basic checks
    ✓ update with invalid rev
    ✓ Doc validation
    ✓ Replication fields (#2442)
    ✓ Testing issue #48 (58ms)
    ✓ Testing valid id
    ✓ Put doc without _id should fail
    ✓ Put doc with bad reserved id should fail
    ✓ update_seq persists
    ✓ deletions persists
    ✓ #4126 should not store raw Dates
    ✓ Create a db with a reserved name
    ✓ Error when document is not an object
    ✓ Test instance update_seq updates correctly
    ✓ Fail to fetch a doc after db was deleted (56ms)
    ✓ Fail to fetch a doc after db was deleted (65ms)
    ✓ Cant add docs with empty ids
    ✓ Test doc with percent in ID
    ✓ db.info should give auto_compaction = false (#2744)
    ✓ db.info should give auto_compaction = true (#2744)
    ✓ db.info should give adapter name (#3567)
    ✓ db.info should give correct doc_count
    ✓ putting returns {ok: true}
    ✓ putting is override-able
    ✓ issue 2779, deleted docs, old revs COUCHDB-292
    ✓ issue 2888, successive deletes and writes
    ✓ 2 invalid puts
    ✓ Docs save "null" value
    ✓ replace PouchDB.destroy() (express-pouchdb#203)
    ✓ 3968, keeps all object fields
    ✓ 4712 invalid rev for new doc generates conflict
    ✓ test info() after db close
    ✓ test get() after db close
    ✓ test close() after db close
    ✓ 7259 should have "this" keyword properly scoped
    ✓ #5471 PouchDB.plugin() should throw error if passed wrong type or empty object

  test.basics.js-local
    ✓ Create a pouch without new keyword
    ✓ Name is accessible via instance
    ✓ 4314 Create a pouch with + in name
    ✓ Creating Pouch without name will throw
    ✓ 4314 Create a pouch with urlencoded name
    ✓ 4219 destroy a pouch
    ✓ 4339 throw useful error if method called on stale instance
    ✓ [4595] should reject xhr errors
    ✓ [4595] should emit error event on xhr error
    ✓ Add a doc
    ✓ Get invalid id
    ✓ Missing doc should contain ID in error object
    ✓ PUTed Conflicted doc should contain ID in error object
    ✓ POSTed Conflicted doc should contain ID in error object
    ✓ Add a doc with a promise
    ✓ Add a doc with opts object
    ✓ Modify a doc
    ✓ Modifying a doc that has rewritten content
    ✓ Modify a doc with a promise
    ✓ Read db id
    ✓ Read db id with promise
    ✓ Close db
    ✓ Close db with a promise
    ✓ Read db id after closing Close
    ✓ Modify a doc with incorrect rev
    ✓ Remove doc
    ✓ Remove doc with a promise
    ✓ Remove doc with new syntax
    ✓ Remove doc with new syntax and a promise
    ✓ Doc removal leaves only stub
    ✓ Remove doc twice with specified id
    ✓ Remove doc, no callback
    ✓ Delete document without id
    ✓ Delete document with many args
    ✓ Delete document with many args, callback style
    ✓ Delete doc with id + rev + no opts
    ✓ Delete doc with id + rev + no opts, callback style
    ✓ Delete doc with doc + opts
    ✓ Delete doc with doc + opts, callback style
    ✓ Delete doc with rev in opts
    ✓ Bulk docs
    ✓ Bulk docs with a promise
    ✓ Basic checks
    ✓ update with invalid rev
    ✓ Doc validation
    ✓ Replication fields (#2442)
    ✓ Allows _access field in documents (#8171)
    ✓ Testing issue #48 (51ms)
    ✓ Testing valid id
    ✓ Put doc without _id should fail
    ✓ Put doc with bad reserved id should fail
    ✓ update_seq persists
    ✓ deletions persists
    ✓ #4126 should not store raw Dates
    ✓ Create a db with a reserved name
    ✓ Error when document is not an object
    ✓ Test instance update_seq updates correctly
    ✓ Fail to fetch a doc after db was deleted
    ✓ Fail to fetch a doc after db was deleted
    ✓ Cant add docs with empty ids
    ✓ Test doc with percent in ID
    ✓ db.info should give auto_compaction = false (#2744)
    ✓ db.info should give auto_compaction = true (#2744)
    ✓ db.info should give adapter name (#3567)
    ✓ db.info should give correct doc_count
    ✓ putting returns {ok: true}
    ✓ putting is override-able
    ✓ issue 2779, deleted docs, old revs COUCHDB-292
    ✓ issue 2888, successive deletes and writes
    ✓ 2 invalid puts
    ✓ Docs save "null" value
    ✓ replace PouchDB.destroy() (express-pouchdb#203)
    ✓ 3968, keeps all object fields
    ✓ 4712 invalid rev for new doc generates conflict
    ✓ test info() after db close
    ✓ test get() after db close
    ✓ test close() after db close
    ✓ 7259 should have "this" keyword properly scoped
    ✓ should allow unicode doc ids
    ✓ should have same blob support for 2 dbs
    ✓ 6053, PouchDB.plugin() resets defaults
    ✓ #5471 PouchDB.plugin() should throw error if passed wrong type or empty object

  test.bulk_docs.js-local
    ✓ Testing bulk docs
    ✓ #6039 test id in bulk docs for conflict
    ✓ No id in bulk docs
    ✓ No _rev and new_edits=false
    ✓ 7829 bare rev 1- with new_edits=false
    ✓ Test empty bulkDocs
    ✓ Test many bulkDocs
    ✓ Test errors on invalid doc id
    ✓ Test two errors on invalid doc id
    ✓ No docs
    ✓ Jira 911
    ✓ Test multiple bulkdocs
    ✓ #2935 new_edits=false correct number
    ✓ #2935 new_edits=false correct number 2
    ✓ bulk docs update then delete then conflict
    ✓ bulk_docs delete then undelete
    ✓ #2935 new_edits=false with single unauthorized
    ✓ Deleting _local docs with bulkDocs
    ✓ Deleting _local docs with bulkDocs, not found
    ✓ Deleting _local docs with bulkDocs, wrong rev
    ✓ Bulk with new_edits=false
    ✓ Testing successive new_edits to the same doc
    ✓ #3062 bulkDocs with staggered seqs (38ms)
    ✓ Testing successive new_edits to the same doc, different content
    ✓ Testing successive new_edits to two doc
    ✓ Deletion with new_edits=false
    ✓ Deletion with new_edits=false, no history
    ✓ Modification with new_edits=false, no history
    ✓ Deletion with new_edits=false, no history, no revisions
    ✓ Testing new_edits=false in req body
    ✓ 656 regression in handling deleted docs
    ✓ Test quotes in doc ids
    ✓ Bulk docs empty list
    ✓ handles simultaneous writes
    ✓ bulk docs input by array
    ✓ Bulk empty list
    ✓ Bulk docs not an array
    ✓ Bulk docs not an object
    ✓ Bulk docs two different revisions to same document id
    ✓ 4204 respect revs_limit (267ms)
    ✓ 2839 implement revs_limit (177ms)
    ✓ 4372 revs_limit deletes old revisions of the doc
    ✓ 4372 revs_limit with auto_compaction deletes old revisions of the doc
    ✓ 4712 invalid rev for new doc generates conflict
    ✓ 5793 bulk docs accepts _conflicts when new_edits=false

  test.bulk_docs.js-http
    ✓ Testing bulk docs (42ms)
    ✓ #6039 test id in bulk docs for conflict
    ✓ No id in bulk docs
    ✓ No _rev and new_edits=false
    ✓ 7829 bare rev 1- with new_edits=false
    ✓ Test empty bulkDocs
    ✓ Test many bulkDocs
    ✓ Test errors on invalid doc id
    ✓ Test two errors on invalid doc id
    ✓ No docs
    ✓ Jira 911
    ✓ Test multiple bulkdocs
    ✓ #2935 new_edits=false correct number
    ✓ #2935 new_edits=false correct number 2
    ✓ bulk docs update then delete then conflict
    ✓ bulk_docs delete then undelete
    ✓ #2935 new_edits=false with single unauthorized
    ✓ Deleting _local docs with bulkDocs (38ms)
    ✓ Bulk with new_edits=false
    ✓ Testing successive new_edits to the same doc
    ✓ #3062 bulkDocs with staggered seqs
    ✓ Testing successive new_edits to the same doc, different content
    ✓ Testing successive new_edits to two doc
    ✓ Deletion with new_edits=false
    ✓ Deletion with new_edits=false, no history
    ✓ Modification with new_edits=false, no history
    ✓ Deletion with new_edits=false, no history, no revisions
    ✓ Testing new_edits=false in req body
    ✓ 656 regression in handling deleted docs
    ✓ Test quotes in doc ids
    ✓ Bulk docs empty list
    ✓ handles simultaneous writes
    ✓ bulk docs input by array
    ✓ Bulk empty list
    ✓ Bulk docs not an array
    ✓ Bulk docs not an object
    ✓ Bulk docs two different revisions to same document id
    ✓ 4204 respect revs_limit (323ms)
    ✓ 2839 implement revs_limit
    ✓ 4372 revs_limit deletes old revisions of the doc
    ✓ 4372 revs_limit with auto_compaction deletes old revisions of the doc
    ✓ 4712 invalid rev for new doc generates conflict
    ✓ 5793 bulk docs accepts _conflicts when new_edits=false (46ms)

  test.bulk_get.js-http
    ✓ test bulk get with rev specified
    ✓ test bulk get with latest=true
    ✓ test bulk get with no rev specified
    ✓ _revisions is not returned by default
    ✓ #5886 bulkGet with reserved id
    ✓ _revisions is returned when specified
    ✓ _revisions is returned when specified, using implicit rev
    ✓ attachments are not included by default
    ✓ attachments are included when specified
    ✓ attachments are included when specified, using implicit rev (42ms)

  test.bulk_get.js-local
    ✓ test bulk get with rev specified
    ✓ test bulk get with latest=true
    ✓ test bulk get with no rev specified
    ✓ _revisions is not returned by default
    ✓ #5886 bulkGet with reserved id
    ✓ _revisions is returned when specified
    ✓ _revisions is returned when specified, using implicit rev
    ✓ attachments are not included by default
    ✓ attachments are included when specified
    ✓ attachments are included when specified, using implicit rev

  test.changes.js-http
    ✓ All changes
    ✓ Changes with complete callback as param
    ✓ Promise resolved when changes cancelled
    - Live changes should clean listener when cancelled
    ✓ Changes Since
    ✓ Changes Since and limit limit 1 (39ms)
    ✓ Changes Since and limit limit 0 (38ms)
    ✓ Changes limit (56ms)
    ✓ Changes with filter not present in ddoc
    ✓ Changes with `filters` key not present in ddoc (46ms)
    ✓ Changes limit and filter
    ✓ Changes with shorthand function name
    ✓ Changes with filter from nonexistent ddoc
    ✓ Changes with view not present in ddoc
    ✓ Changes with `views` key not present in ddoc
    ✓ #4451 Changes with invalid view filter
    ✓ 3356 throw inside a filter
    ✓ Changes with missing param `view` in request
    ✓ Changes limit and view instead of filter
    ✓ #3609 view option implies filter: _view
    ✓ Immediately cancel changes
    ✓ Changes with invalid ddoc view name
    ✓ Changes with invalid ddoc view name 2
    ✓ Changes with style = all_docs (70ms)
    ✓ Changes with style = all_docs and a callback for complete (58ms)
    ✓ Changes limit = 0 (44ms)
    ✓ Changes doc
    - Descending many changes
    ✓ live-changes
    ✓ Multiple watchers
    ✓ Continuous changes doc
    ✓ Cancel changes (333ms)
    ✓ #3579 changes firing 1 too many times (86ms)
    ✓ Kill database while listening to live changes
    ✓ #3136 style=all_docs
    ✓ #4191 revs_diff causes endless loop
    ✓ #3136 style=all_docs & include_docs (50ms)
    ✓ changes-filter with query params (39ms)
    ✓ Non-live changes filter
    ✓ Non-live changes filter, descending
    ✓ #2569 Non-live doc_ids filter
    ✓ #2569 Big non-live doc_ids filter
    ✓ #2569 Live doc_ids filter
    ✓ #2569 Big live doc_ids filter
    ✓ #2569 Non-live doc_ids filter with filter=_doc_ids
    ✓ #2569 Live doc_ids filter with filter=_doc_ids
    ✓ Changes to same doc are grouped
    ✓ Changes with conflicts are handled correctly (135ms)
    ✓ Change entry for a deleted doc
    ✓ changes large number of docs (42ms)
    ✓ Calling db.changes({since: 'now'})
    ✓ Calling db.changes({since: 'latest'}) (59ms)
    ✓ Closing db does not cause a crash if changes cancelled (43ms)
    ✓ fire-complete-on-cancel (100ms)
    ✓ changes are not duplicated (1043ms)
    ✓ supports return_docs=false
    ✓ should respects limit (74ms)
    ✓ doesn't throw if opts.complete is undefined
    ✓ handle individual changes in live replication (224ms)
    ✓ changes-filter without filter
    ✓ #3539 - Exception in changes is fine
    ✓ Changes with selector
    ✓ Changes with selector, explicit filter
    ✓ Changes with selector and mismatched filter
    ✓ Changes with limit and selector

  test.changes.js-local
    ✓ All changes
    ✓ Changes with complete callback as param
    ✓ Promise resolved when changes cancelled
    - Live changes should clean listener when cancelled
    ✓ Changes Since
    ✓ Changes Since and limit limit 1
    ✓ Changes Since and limit limit 0
    ✓ Changes limit
    ✓ Changes with filter not present in ddoc
    ✓ Changes with `filters` key not present in ddoc
    ✓ Changes limit and filter
    ✓ Changes with shorthand function name
    ✓ Changes with filter from nonexistent ddoc
    ✓ Changes with view not present in ddoc
    ✓ Changes with `views` key not present in ddoc
    ✓ #4451 Changes with invalid view filter
    ✓ 3356 throw inside a filter
    ✓ Changes with missing param `view` in request
    ✓ Changes limit and view instead of filter
    ✓ #3609 view option implies filter: _view
    ✓ Immediately cancel changes
    ✓ Changes with invalid ddoc view name
    ✓ Changes with invalid ddoc view name 2
    ✓ Changes with style = all_docs
    ✓ Changes with style = all_docs and a callback for complete
    ✓ Changes limit = 0
    ✓ Changes doc
    - Descending many changes
    ✓ live-changes
    ✓ Multiple watchers
    ✓ Continuous changes doc
    ✓ Cancel changes (328ms)
    ✓ #3579 changes firing 1 too many times (73ms)
    ✓ Kill database while listening to live changes
    ✓ #3136 style=all_docs
    ✓ #4191 revs_diff causes endless loop
    ✓ #3136 style=all_docs & include_docs
    ✓ changes-filter with query params
    ✓ Non-live changes filter
    ✓ Non-live changes filter, descending
    ✓ #2569 Non-live doc_ids filter
    ✓ #2569 Big non-live doc_ids filter
    ✓ #2569 Live doc_ids filter
    ✓ #2569 Big live doc_ids filter
    ✓ #2569 Non-live doc_ids filter with filter=_doc_ids
    ✓ #2569 Live doc_ids filter with filter=_doc_ids
    ✓ Changes to same doc are grouped
    ✓ Changes with conflicts are handled correctly
    ✓ Change entry for a deleted doc
    ✓ changes large number of docs
    ✓ Calling db.changes({since: 'now'})
    ✓ Calling db.changes({since: 'latest'}) (48ms)
    ✓ Closing db does not cause a crash if changes cancelled
    ✓ fire-complete-on-cancel (101ms)
    ✓ changes are not duplicated (1020ms)
    ✓ supports return_docs=false
    ✓ should respects limit (96ms)
    ✓ doesn't throw if opts.complete is undefined
    ✓ handle individual changes in live replication (81ms)
    ✓ changes-filter without filter
    ✓ #3539 - Exception in changes is fine
    ✓ Changes with selector
    ✓ Changes with selector, explicit filter
    ✓ Changes with selector and mismatched filter
    ✓ Changes with limit and selector

  changes-standalone
    - Changes reports errors

  test.close.js-local
    ✓ should emit destroyed even when closed (sync)
    ✓ should emit destroyed even when closed (async)
precondition_failed: Database not open
    at Object.<anonymous> (/data/js-variants/multee/Clients/levelup/pouchdb/packages/node_modules/pouchdb/lib/index.js:614:16)
    at Module._compile (node:internal/modules/cjs/loader:1105:14)
    at Module._extensions..js (node:internal/modules/cjs/loader:1159:10)
    at Module.load (node:internal/modules/cjs/loader:981:32)
    at Module._load (node:internal/modules/cjs/loader:827:12)
    at Module.require (node:internal/modules/cjs/loader:1005:19)
    at require (node:internal/modules/cjs/helpers:102:18)
    at commonUtils.loadPouchDBForNode (/data/js-variants/multee/Clients/levelup/pouchdb/tests/common-utils.js:92:17)
    at commonUtils.loadPouchDB (/data/js-variants/multee/Clients/levelup/pouchdb/tests/common-utils.js:78:39)
    at Object.<anonymous> (/data/js-variants/multee/Clients/levelup/pouchdb/tests/integration/node.setup.js:21:28)
    at Module._compile (node:internal/modules/cjs/loader:1105:14)
    at Module._extensions..js (node:internal/modules/cjs/loader:1159:10)
    at Module.load (node:internal/modules/cjs/loader:981:32)
    at Module._load (node:internal/modules/cjs/loader:827:12)
    at Module.require (node:internal/modules/cjs/loader:1005:19)
    at require (node:internal/modules/cjs/helpers:102:18)
    at /data/js-variants/multee/Clients/levelup/pouchdb/node_modules/mocha/bin/_mocha:366:3
    at Array.forEach (<anonymous>)
    at Object.<anonymous> (/data/js-variants/multee/Clients/levelup/pouchdb/node_modules/mocha/bin/_mocha:365:10)
    at Module._compile (node:internal/modules/cjs/loader:1105:14)
    at Module._extensions..js (node:internal/modules/cjs/loader:1159:10)
    at Module.load (node:internal/modules/cjs/loader:981:32)
    at Module._load (node:internal/modules/cjs/loader:827:12)
    at Function.executeUserEntryPoint [as runMain] (node:internal/modules/run_main:77:12)
    at node:internal/main/run_main_module:17:47
    ✓ should emit closed even when destroyed (async #2)
precondition_failed: Database not open
    at Object.<anonymous> (/data/js-variants/multee/Clients/levelup/pouchdb/packages/node_modules/pouchdb/lib/index.js:614:16)
    at Module._compile (node:internal/modules/cjs/loader:1105:14)
    at Module._extensions..js (node:internal/modules/cjs/loader:1159:10)
    at Module.load (node:internal/modules/cjs/loader:981:32)
    at Module._load (node:internal/modules/cjs/loader:827:12)
    at Module.require (node:internal/modules/cjs/loader:1005:19)
    at require (node:internal/modules/cjs/helpers:102:18)
    at commonUtils.loadPouchDBForNode (/data/js-variants/multee/Clients/levelup/pouchdb/tests/common-utils.js:92:17)
    at commonUtils.loadPouchDB (/data/js-variants/multee/Clients/levelup/pouchdb/tests/common-utils.js:78:39)
    at Object.<anonymous> (/data/js-variants/multee/Clients/levelup/pouchdb/tests/integration/node.setup.js:21:28)
    at Module._compile (node:internal/modules/cjs/loader:1105:14)
    at Module._extensions..js (node:internal/modules/cjs/loader:1159:10)
    at Module.load (node:internal/modules/cjs/loader:981:32)
    at Module._load (node:internal/modules/cjs/loader:827:12)
    at Module.require (node:internal/modules/cjs/loader:1005:19)
    at require (node:internal/modules/cjs/helpers:102:18)
    at /data/js-variants/multee/Clients/levelup/pouchdb/node_modules/mocha/bin/_mocha:366:3
    at Array.forEach (<anonymous>)
    at Object.<anonymous> (/data/js-variants/multee/Clients/levelup/pouchdb/node_modules/mocha/bin/_mocha:365:10)
    at Module._compile (node:internal/modules/cjs/loader:1105:14)
    at Module._extensions..js (node:internal/modules/cjs/loader:1159:10)
    at Module.load (node:internal/modules/cjs/loader:981:32)
    at Module._load (node:internal/modules/cjs/loader:827:12)
    at Function.executeUserEntryPoint [as runMain] (node:internal/modules/run_main:77:12)
    at node:internal/main/run_main_module:17:47
    ✓ test unref for coverage
    ✓ test double unref for coverage
precondition_failed: Database not open
    at Object.<anonymous> (/data/js-variants/multee/Clients/levelup/pouchdb/packages/node_modules/pouchdb/lib/index.js:614:16)
    at Module._compile (node:internal/modules/cjs/loader:1105:14)
    at Module._extensions..js (node:internal/modules/cjs/loader:1159:10)
    at Module.load (node:internal/modules/cjs/loader:981:32)
    at Module._load (node:internal/modules/cjs/loader:827:12)
    at Module.require (node:internal/modules/cjs/loader:1005:19)
    at require (node:internal/modules/cjs/helpers:102:18)
    at commonUtils.loadPouchDBForNode (/data/js-variants/multee/Clients/levelup/pouchdb/tests/common-utils.js:92:17)
    at commonUtils.loadPouchDB (/data/js-variants/multee/Clients/levelup/pouchdb/tests/common-utils.js:78:39)
    at Object.<anonymous> (/data/js-variants/multee/Clients/levelup/pouchdb/tests/integration/node.setup.js:21:28)
    at Module._compile (node:internal/modules/cjs/loader:1105:14)
    at Module._extensions..js (node:internal/modules/cjs/loader:1159:10)
    at Module.load (node:internal/modules/cjs/loader:981:32)
    at Module._load (node:internal/modules/cjs/loader:827:12)
    at Module.require (node:internal/modules/cjs/loader:1005:19)
    at require (node:internal/modules/cjs/helpers:102:18)
    at /data/js-variants/multee/Clients/levelup/pouchdb/node_modules/mocha/bin/_mocha:366:3
    at Array.forEach (<anonymous>)
    at Object.<anonymous> (/data/js-variants/multee/Clients/levelup/pouchdb/node_modules/mocha/bin/_mocha:365:10)
    at Module._compile (node:internal/modules/cjs/loader:1105:14)
    at Module._extensions..js (node:internal/modules/cjs/loader:1159:10)
    at Module.load (node:internal/modules/cjs/loader:981:32)
    at Module._load (node:internal/modules/cjs/loader:827:12)
    at Function.executeUserEntryPoint [as runMain] (node:internal/modules/run_main:77:12)
    at node:internal/main/run_main_module:17:47
    ✓ test close-then-destroyed for coverage (45ms)
************* run test done *************
pouchdb is testing ./Variants/levelup/variant13/levelup
/data/js-variants/multee
************* npm unlink module *************

removed 1 package, changed 1 package, and audited 1032 packages in 4s

64 packages are looking for funding
  run `npm fund` for details

41 vulnerabilities (1 low, 9 moderate, 25 high, 6 critical)

To address issues that do not require attention, run:
  npm audit fix

To address all issues possible (including breaking changes), run:
  npm audit fix --force

Some issues need review, and may require choosing
a different dependency.

Run `npm audit` for details.
************* npm unlink module done *************
************* npm unlink globally *************

removed 1 package, and audited 1 package in 1s

found 0 vulnerabilities
************* npm unlink globally done *************
************* npm link globally *************

added 1 package, and audited 3 packages in 497ms

found 0 vulnerabilities
************* npm link globally done *************
************* npm link module *************

added 1 package, changed 1 package, and audited 1034 packages in 3s

64 packages are looking for funding
  run `npm fund` for details

41 vulnerabilities (1 low, 9 moderate, 25 high, 6 critical)

To address issues that do not require attention, run:
  npm audit fix

To address all issues possible (including breaking changes), run:
  npm audit fix --force

Some issues need review, and may require choosing
a different dependency.

Run `npm audit` for details.
************* npm link module done *************
************* start run test *************

> pouchdb-monorepo@7.0.0-prerelease test
> bash bin/run-test.sh


> pouchdb-monorepo@7.0.0-prerelease build-node
> bash bin/build-node.sh


> pouchdb-monorepo@7.0.0-prerelease build-modules
> node bin/build-modules.js

Building pouchdb...
Building pouchdb-abstract-mapreduce...
Building pouchdb-adapter-http...
Building pouchdb-adapter-idb...
Building pouchdb-adapter-indexeddb...
Building pouchdb-adapter-leveldb...
Building pouchdb-adapter-leveldb-core...
Building pouchdb-adapter-localstorage...
Building pouchdb-adapter-memory...
Building pouchdb-adapter-utils...
Building pouchdb-binary-utils...
Building pouchdb-browser...
Building pouchdb-changes-filter...
Building pouchdb-checkpointer...
Building pouchdb-collate...
Building pouchdb-collections...
Building pouchdb-core...
Building pouchdb-errors...
Building pouchdb-fetch...
Building pouchdb-find...
Building pouchdb-for-coverage...
Building pouchdb-generate-replication-id...
Building pouchdb-json...
Building pouchdb-mapreduce...
Building pouchdb-mapreduce-utils...
Building pouchdb-md5...
Building pouchdb-merge...
Building pouchdb-node...
Building pouchdb-replication...
Building pouchdb-selector-core...
Building pouchdb-utils...
Building sublevel-pouchdb...
  ✓ wrote pouchdb-adapter-localstorage/lib/index.js in vanilla mode
  ✓ wrote pouchdb-adapter-localstorage/lib/index.es.js in vanilla mode
  ✓ wrote pouchdb-adapter-memory/lib/index.js in vanilla mode
  ✓ wrote pouchdb-adapter-memory/lib/index.es.js in vanilla mode
  ✓ wrote pouchdb-checkpointer/lib/index.js in vanilla mode
  ✓ wrote pouchdb-checkpointer/lib/index.es.js in vanilla mode
  ✓ wrote pouchdb-errors/lib/index.js in vanilla mode
  ✓ wrote pouchdb-errors/lib/index.es.js in vanilla mode
  ✓ wrote pouchdb-generate-replication-id/lib/index.js in vanilla mode
  ✓ wrote pouchdb-generate-replication-id/lib/index.es.js in vanilla mode
  ✓ wrote pouchdb-adapter-http/lib/index.js in vanilla mode
  ✓ wrote pouchdb-adapter-http/lib/index.es.js in vanilla mode
  ✓ wrote pouchdb-adapter-leveldb/lib/index.js in node mode
  ✓ wrote pouchdb-adapter-leveldb/lib/index.es.js in node mode
  ✓ wrote pouchdb-adapter-leveldb/lib/index-browser.js in browser mode
  ✓ wrote pouchdb-adapter-leveldb/lib/index-browser.es.js in browser mode
  ✓ wrote pouchdb-changes-filter/lib/index-browser.js in browser mode
  ✓ wrote pouchdb-changes-filter/lib/index-browser.es.js in browser mode
  ✓ wrote pouchdb-fetch/lib/index-browser.js in browser mode
  ✓ wrote pouchdb-fetch/lib/index-browser.es.js in browser mode
  ✓ wrote pouchdb-md5/lib/index-browser.js in browser mode
  ✓ wrote pouchdb-md5/lib/index-browser.es.js in browser mode
  ✓ wrote pouchdb-adapter-leveldb-core/lib/index.js in node mode
  ✓ wrote pouchdb-adapter-leveldb-core/lib/index.es.js in node mode
  ✓ wrote pouchdb-adapter-leveldb-core/lib/index-browser.js in browser mode
  ✓ wrote pouchdb-adapter-leveldb-core/lib/index-browser.es.js in browser mode
  ✓ wrote pouchdb-changes-filter/lib/index.js in node mode
  ✓ wrote pouchdb-changes-filter/lib/index.es.js in node mode
  ✓ wrote pouchdb-collate/lib/index.js in vanilla mode
  ✓ wrote pouchdb-collate/lib/index.es.js in vanilla mode
  ✓ wrote pouchdb-fetch/lib/index.js in node mode
  ✓ wrote pouchdb-fetch/lib/index.es.js in node mode
  ✓ wrote pouchdb-json/lib/index.js in vanilla mode
  ✓ wrote pouchdb-json/lib/index.es.js in vanilla mode
  ✓ wrote pouchdb-mapreduce-utils/lib/index.js in vanilla mode
  ✓ wrote pouchdb-mapreduce-utils/lib/index.es.js in vanilla mode
  ✓ wrote pouchdb-md5/lib/index.js in node mode
  ✓ wrote pouchdb-md5/lib/index.es.js in node mode
  ✓ wrote pouchdb-adapter-idb/lib/index.js in vanilla mode
  ✓ wrote pouchdb-adapter-idb/lib/index.es.js in vanilla mode
  ✓ wrote pouchdb-adapter-indexeddb/lib/index.js in vanilla mode
  ✓ wrote pouchdb-adapter-indexeddb/lib/index.es.js in vanilla mode
  ✓ wrote pouchdb-abstract-mapreduce/lib/index.js in vanilla mode
  ✓ wrote pouchdb-abstract-mapreduce/lib/index.es.js in vanilla mode
  ✓ wrote pouchdb-binary-utils/lib/index-browser.js in browser mode
  ✓ wrote pouchdb-binary-utils/lib/index-browser.es.js in browser mode
  ✓ wrote pouchdb-utils/lib/index-browser.js in browser mode
  ✓ wrote pouchdb-utils/lib/index-browser.es.js in browser mode
  ✓ wrote pouchdb-utils/lib/index.js in node mode
  ✓ wrote pouchdb-utils/lib/index.es.js in node mode
  ✓ wrote pouchdb-adapter-utils/lib/index.js in vanilla mode
  ✓ wrote pouchdb-adapter-utils/lib/index.es.js in vanilla mode
  ✓ wrote pouchdb-binary-utils/lib/index.js in node mode
  ✓ wrote pouchdb-binary-utils/lib/index.es.js in node mode
  ✓ wrote pouchdb-collections/lib/index.js in vanilla mode
  ✓ wrote pouchdb-collections/lib/index.es.js in vanilla mode
  ✓ wrote pouchdb-merge/lib/index.js in vanilla mode
  ✓ wrote pouchdb-merge/lib/index.es.js in vanilla mode
  ✓ wrote pouchdb-selector-core/lib/index.js in vanilla mode
  ✓ wrote pouchdb-selector-core/lib/index.es.js in vanilla mode
  ✓ wrote sublevel-pouchdb/lib/index.js in vanilla mode
  ✓ wrote sublevel-pouchdb/lib/index.es.js in vanilla mode
  ✓ wrote pouchdb-mapreduce/lib/index-browser.js in browser mode
  ✓ wrote pouchdb-mapreduce/lib/index-browser.es.js in browser mode
  ✓ wrote pouchdb-mapreduce/lib/index.js in node mode
  ✓ wrote pouchdb-mapreduce/lib/index.es.js in node mode
  ✓ wrote pouchdb-replication/lib/index.js in vanilla mode
  ✓ wrote pouchdb-replication/lib/index.es.js in vanilla mode
  ✓ wrote pouchdb-core/lib/index.js in vanilla mode
  ✓ wrote pouchdb-core/lib/index.es.js in vanilla mode
  ✓ wrote pouchdb-find/lib/index.js in node mode
  ✓ wrote pouchdb-find/lib/index.es.js in node mode
  ✓ wrote pouchdb-find/lib/index-browser.js in browser mode
  ✓ wrote pouchdb-find/lib/index-browser.es.js in browser mode
  ✓ wrote pouchdb-browser/lib/index.js in vanilla mode
  ✓ wrote pouchdb-browser/lib/index.es.js in vanilla mode
  ✓ wrote pouchdb-node/lib/index.js in vanilla mode
  ✓ wrote pouchdb-node/lib/index.es.js in vanilla mode
  ✓ wrote pouchdb-for-coverage/lib/index.js in node mode
  ✓ wrote pouchdb-for-coverage/lib/index-browser.js in browser mode
  ✓ wrote pouchdb-for-coverage/lib/index.es.js in node mode
  ✓ wrote pouchdb-for-coverage/lib/index-browser.es.js in browser mode
  ✓ wrote packages/node_modules/pouchdb/lib/index.js
  ✓ wrote packages/node_modules/pouchdb/lib/index.es.js
Waiting for host to start ..
Host started :)
> pouchdb-monorepo@7.0.0-prerelease test-node
> bash bin/test-node.sh

Down server listening on port 3010
Seeded with: 1660142748371


  DB Setup
    ✓ PouchDB has a version
    ✓ PouchDB version matches package.json

  test.active_tasks.js
    ✓ Can add a task
    ✓ Can get tasks by id
    ✓ Can get all tasks
    ✓ Can update a task
    ✓ Can remove a task

  test.all_docs.js-http
    ✓ Testing all docs (167ms)
    ✓ Testing allDocs opts.keys (64ms)
    ✓ Testing allDocs opts.keys with skip
    ✓ Testing allDocs opts.keys with limit
    ✓ Testing allDocs invalid opts.keys
    ✓ Testing deleting in changes (42ms)
    ✓ Testing updating in changes (43ms)
    ✓ Testing include docs
    ✓ Testing conflicts (48ms)
    ✓ test basic collation
    ✓ 3883 start_key end_key aliases
    ✓ test total_rows with a variety of criteria (143ms)
    ✓ test total_rows with both skip and limit (41ms)
    ✓ test limit option and total_rows
    ✓ test escaped startkey/endkey
    ✓ test "key" option
    ✓ test inclusive_end=false (60ms)
    ✓ test descending with startkey/endkey
    ✓ #3082 test wrong num results returned (258ms)
    ✓ test empty db
    ✓ test after db close
    ✓ 5793 _conflicts should not exist if no conflicts
    ✓ #6230 Test allDocs opts update_seq: false
    ✓ #6230 Test allDocs opts update_seq: true
    ✓ #6230 Test allDocs opts with update_seq missing

  test.all_docs.js-local
    ✓ Testing all docs
    ✓ Testing allDocs opts.keys (44ms)
    ✓ Testing allDocs opts.keys with skip
    ✓ Testing allDocs opts.keys with limit
    ✓ Testing allDocs invalid opts.keys
    ✓ Testing deleting in changes
    ✓ Testing updating in changes
    ✓ Testing include docs
    ✓ Testing conflicts
    ✓ test basic collation
    ✓ 3883 start_key end_key aliases
    ✓ test total_rows with a variety of criteria
    ✓ test total_rows with both skip and limit
    ✓ test limit option and total_rows
    ✓ test escaped startkey/endkey
    ✓ test "key" option
    ✓ test inclusive_end=false
    ✓ test descending with startkey/endkey
    ✓ #3082 test wrong num results returned (202ms)
    ✓ test empty db
    ✓ test after db close
    ✓ test unicode ids and revs
    ✓ 5793 _conflicts should not exist if no conflicts
    ✓ #6230 Test allDocs opts update_seq: false
    ✓ #6230 Test allDocs opts update_seq: true
    ✓ #6230 Test allDocs opts with update_seq missing

  suite2 test.attachments.js-local
    ✓ 3357 Attachment names cant start with _
    ✓ 5736 warning for putAttachment without content_type
    ✓ 5736 warning for bulkDocs attachments without content_type
    ✓ fetch atts with open_revs and missing
    ✓ issue 2803 should throw 412
    ✓ issue 2803 should throw 412 part 2
    ✓ issue 2803 should throw 412 part 3
    ✓ issue 2803 should throw 412 part 4
    ✓ #2858 {binary: true} in get()
    ✓ #2858 {binary: true} in allDocs() 1
    ✓ #2858 {binary: true} in allDocs() 2
    ✓ #2858 {binary: true} in allDocs() 3
    ✓ #2858 {binary: true} in allDocs() 4
    ✓ #2858 {binary: true} in allDocs() 5
    ✓ #2858 {binary: true} in allDocs(), many atts
    ✓ #2858 {binary: true} in allDocs(), mixed atts
    ✓ #2858 {binary: true} in changes() non-live
    ✓ #2858 {binary: true} in changes() non-live, many atts
    ✓ #2858 {binary: true} in changes() non-live, mixed atts
    ✓ #2858 {binary: true} non-live changes, complete event
    ✓ #2858 {binary: true} in live changes
    ✓ #2858 {binary: true} in live changes, mixed atts
    ✓ #2858 {binary: true} in live+retry changes
    ✓ #2858 {binary: true} in live changes, attachments:false
    ✓ #2858 {binary: true} in live changes, include_docs:false
    ✓ #6736 {binary: true} in bulkGet()
    ✓ Measures length correctly after put()
    ✓ #3074 non-live changes()
    ✓ #3074 live changes()
    ✓ #3074 non-live changes(), no attachments
    ✓ #3074 live changes(), no attachments
    ✓ #3881 filter extraneous keys from _attachments
    ✓ #2771 allDocs() 1, single attachment
    ✓ #2771 allDocs() 2, many docs same att
    ✓ #2771 allDocs() 3, many docs diff atts
    ✓ #2771 allDocs() 4, mix of atts and no atts
    ✓ #2771 allDocs() 5, no atts
    ✓ #2771 allDocs() 6, no docs
    ✓ #2771 allDocs() 7, revisions and deletions
    ✓ #2771 allDocs() 8, empty attachment
    ✓ No length for non-stubs
    ✓ Test some attachments
    ✓ Test getAttachment
    ✓ Test getAttachment with stubs
    ✓ Test get() with binary:true and stubs
    ✓ Test attachments in allDocs/changes
    ✓ Test putAttachment with base64 plaintext
    ✓ Test putAttachment with invalid base64
    ✓ Test getAttachment with empty text
    ✓ Test getAttachment with normal text
    ✓ Test getAttachment with PNG
    ✓ Test getAttachment with PNG using bulkDocs
    ✓ Test getAttachment with PNG using post
    ✓ Test postAttachment with PNG then bulkDocs
    ✓ proper stub behavior
    ✓ Testing with invalid docs
    ✓ Test create attachment and doc in one go
    ✓ Test create attachment and doc in one go without callback
    ✓ Test create attachment without callback
    ✓ Test put attachment on a doc without attachments
    ✓ Test put attachment with unencoded name
    ✓ 3963 length property on stubs
    ✓ Testing with invalid rev
    ✓ Test put another attachment on a doc with attachments
    ✓ Test get with attachments: true if empty attachments
    ✓ Test delete attachment from a doc
    ✓ Test a document with a json string attachment
    ✓ Test remove doc with attachment
    ✓ Try to insert a doc with unencoded attachment
    ✓ Try to get attachment of unexistent doc
    ✓ Test synchronous putAttachment with text data
    ✓ Test synchronous putAttachment with no text data
    ✓ Test put with partial stubs
    ✓ Test put with attachments and new_edits=false
    ✓ Test getAttachment with specific rev
    ✓ Test getAttachment with diff revs and content
    ✓ Test stubs
    ✓ Try to get unexistent attachment of some doc
    ✓ putAttachment and getAttachment with plaintext
    ✓ putAttachment and getAttachment with png data
    ✓ putAttachment in new doc with base64
    ✓ #2818 - save same attachment in different revs
    ✓ #2818 - save same attachment many times in parallel
    ✓ #2818 - revisions keep attachments (no compaction)
    ✓ #2818 - doesn't throw 409 if same filename
    ✓ #3008 test correct encoding/decoding of \u0000 etc.
    ✓ putAttachment and getAttachment with big png data (93ms)
    ✓ #2709 `revpos` with putAttachment
    ✓ #2709 `revpos` with inline attachment
    ✓ #2709 `revpos` with allDocs
    ✓ #7403 {attachments: true, binary: true, include_docs: true} in allDocs with one missing doc

  suite2 test.attachments.js-http
    ✓ 3357 Attachment names cant start with _
    ✓ 5736 warning for putAttachment without content_type
    ✓ 5736 warning for bulkDocs attachments without content_type
    ✓ fetch atts with open_revs and missing
    ✓ issue 2803 should throw 412
    ✓ issue 2803 should throw 412 part 2 (94ms)
    ✓ issue 2803 should throw 412 part 3 (47ms)
    ✓ issue 2803 should throw 412 part 4
    ✓ #2858 {binary: true} in get() (38ms)
    ✓ #2858 {binary: true} in allDocs() 1
    ✓ #2858 {binary: true} in allDocs() 2
    ✓ #2858 {binary: true} in allDocs() 3
    ✓ #2858 {binary: true} in allDocs() 4
    ✓ #2858 {binary: true} in allDocs() 5
    ✓ #2858 {binary: true} in allDocs(), many atts
    ✓ #2858 {binary: true} in allDocs(), mixed atts
    ✓ #2858 {binary: true} in changes() non-live
    ✓ #2858 {binary: true} in changes() non-live, many atts
    ✓ #2858 {binary: true} in changes() non-live, mixed atts
    ✓ #2858 {binary: true} non-live changes, complete event
    ✓ #2858 {binary: true} in live changes
    ✓ #2858 {binary: true} in live changes, mixed atts
    ✓ #2858 {binary: true} in live+retry changes
    ✓ #2858 {binary: true} in live changes, attachments:false
    ✓ #2858 {binary: true} in live changes, include_docs:false (43ms)
    ✓ #6736 {binary: true} in bulkGet()
    ✓ Measures length correctly after put()
    ✓ #3074 non-live changes() (41ms)
    ✓ #3074 live changes() (43ms)
    ✓ #3074 non-live changes(), no attachments
    ✓ #3074 live changes(), no attachments (44ms)
    ✓ #3881 filter extraneous keys from _attachments
    ✓ #2771 allDocs() 1, single attachment (45ms)
    ✓ #2771 allDocs() 2, many docs same att
    ✓ #2771 allDocs() 3, many docs diff atts
    ✓ #2771 allDocs() 4, mix of atts and no atts (42ms)
    ✓ #2771 allDocs() 5, no atts
    ✓ #2771 allDocs() 6, no docs
    ✓ #2771 allDocs() 7, revisions and deletions
    ✓ #2771 allDocs() 8, empty attachment
    ✓ No length for non-stubs (53ms)
    ✓ Test some attachments (48ms)
    ✓ Test getAttachment
    ✓ Test getAttachment with stubs
    ✓ Test get() with binary:true and stubs
    ✓ Test attachments in allDocs/changes
    ✓ Test putAttachment with base64 plaintext
    ✓ Test putAttachment with invalid base64
    ✓ Test getAttachment with empty text
    ✓ Test getAttachment with normal text
    ✓ Test getAttachment with PNG
    ✓ Test getAttachment with PNG using bulkDocs
    ✓ Test getAttachment with PNG using post
    ✓ Test postAttachment with PNG then bulkDocs
    ✓ proper stub behavior (39ms)
    ✓ Testing with invalid docs
    ✓ Test create attachment and doc in one go
    ✓ Test create attachment and doc in one go without callback
    ✓ Test create attachment without callback (41ms)
    ✓ Test put attachment on a doc without attachments
    ✓ Test put attachment with unencoded name
    ✓ 3963 length property on stubs (46ms)
    ✓ Testing with invalid rev
    ✓ Test put another attachment on a doc with attachments (39ms)
    ✓ Test get with attachments: true if empty attachments (45ms)
    ✓ Test delete attachment from a doc (53ms)
    ✓ Test a document with a json string attachment
    ✓ Test remove doc with attachment
    ✓ Try to insert a doc with unencoded attachment
    ✓ Try to get attachment of unexistent doc
    ✓ Test synchronous putAttachment with text data
    ✓ Test synchronous putAttachment with no text data
    ✓ Test put with partial stubs
    ✓ Test put with attachments and new_edits=false
    ✓ Test getAttachment with specific rev (40ms)
    ✓ Test getAttachment with diff revs and content
    ✓ Test stubs
    ✓ Try to get unexistent attachment of some doc
    ✓ putAttachment and getAttachment with plaintext
    ✓ putAttachment and getAttachment with png data
    ✓ putAttachment in new doc with base64
    ✓ #2818 - save same attachment in different revs (47ms)
    ✓ #2818 - save same attachment many times in parallel
    ✓ #2818 - revisions keep attachments (no compaction) (41ms)
    ✓ #2818 - doesn't throw 409 if same filename
    ✓ #3008 test correct encoding/decoding of \u0000 etc.
    ✓ putAttachment and getAttachment with big png data (127ms)
    ✓ #2709 `revpos` with putAttachment (44ms)
    ✓ #2709 `revpos` with inline attachment
    ✓ #2709 `revpos` with allDocs
    ✓ #7403 {attachments: true, binary: true, include_docs: true} in allDocs with one missing doc

  suite2 test.attachments.js- local:http
    ✓ Attachments replicate back and forth (135ms)
    ✓ Replicate same doc, same atts (116ms)
    ✓ Replicate same doc, same atts 2 (121ms)
    ✓ Attachments replicate (61ms)
    ✓ Attachment types replicate (53ms)
    ✓ Many many attachments replicate (199ms)
    ✓ Many many png attachments replicate (245ms)
    ✓ Multiple attachments replicate (84ms)
    - #3961 Many attachments on same doc
    ✓ Multiple attachments replicate, different docs (#2698) (80ms)
    ✓ Multiple attachments replicate, different docs png (#2698) (71ms)
    ✓ #3932 attachments with tricky revpos (129ms)
    ✓ replication with changing attachments (98ms)
    ✓ 3955 race condition in put
    ✓ #8456 bad attachment rev after replication (124ms)

  suite2 test.attachments.js- http:http
    ✓ Attachments replicate back and forth (159ms)
    ✓ Replicate same doc, same atts (177ms)
    ✓ Replicate same doc, same atts 2 (173ms)
    ✓ Attachments replicate (77ms)
    ✓ Attachment types replicate (93ms)
    ✓ Many many attachments replicate (373ms)
    ✓ Many many png attachments replicate (340ms)
    ✓ Multiple attachments replicate (123ms)
    - #3961 Many attachments on same doc
    ✓ Multiple attachments replicate, different docs (#2698) (124ms)
    ✓ Multiple attachments replicate, different docs png (#2698) (119ms)
    ✓ #3932 attachments with tricky revpos (223ms)
    ✓ replication with changing attachments (148ms)
    ✓ 3955 race condition in put
    ✓ #8456 bad attachment rev after replication (175ms)

  suite2 test.attachments.js- http:local
    ✓ Attachments replicate back and forth (107ms)
    ✓ Replicate same doc, same atts (101ms)
    ✓ Replicate same doc, same atts 2 (99ms)
    ✓ Attachments replicate (52ms)
    ✓ Attachment types replicate (53ms)
    ✓ Many many attachments replicate (211ms)
    ✓ Many many png attachments replicate (157ms)
    ✓ Multiple attachments replicate (110ms)
    - #3961 Many attachments on same doc
    ✓ Multiple attachments replicate, different docs (#2698) (64ms)
    ✓ Multiple attachments replicate, different docs png (#2698) (83ms)
    ✓ #3932 attachments with tricky revpos (148ms)
    ✓ replication with changing attachments (90ms)
    ✓ 3955 race condition in put
    ✓ #8456 bad attachment rev after replication (115ms)

  suite2 test.attachments.js- local:local
    ✓ Attachments replicate back and forth
    ✓ Replicate same doc, same atts
    ✓ Replicate same doc, same atts 2
    ✓ Attachments replicate
    ✓ Attachment types replicate
    ✓ Many many attachments replicate
    ✓ Many many png attachments replicate
    ✓ Multiple attachments replicate (38ms)
    - #3961 Many attachments on same doc
    ✓ Multiple attachments replicate, different docs (#2698)
    ✓ Multiple attachments replicate, different docs png (#2698)
    ✓ #3932 attachments with tricky revpos
    ✓ replication with changing attachments
    ✓ 3955 race condition in put
    ✓ #8456 bad attachment rev after replication

  test.basics.js-http
    ✓ Create a pouch without new keyword
    ✓ Name is accessible via instance
    ✓ 4314 Create a pouch with + in name
    ✓ Creating Pouch without name will throw
    ✓ 4314 Create a pouch with urlencoded name
    ✓ 4219 destroy a pouch
    ✓ 4339 throw useful error if method called on stale instance
    ✓ [4595] should reject xhr errors
    ✓ [4595] should emit error event on xhr error
    ✓ Add a doc
    ✓ Get invalid id
    ✓ Missing doc should contain ID in error object (41ms)
    ✓ PUTed Conflicted doc should contain ID in error object
    ✓ POSTed Conflicted doc should contain ID in error object
    ✓ Add a doc with a promise
    ✓ Add a doc with opts object
    ✓ Modify a doc
    ✓ Modifying a doc that has rewritten content
    ✓ Modify a doc with a promise
    ✓ Read db id
    ✓ Read db id with promise
    ✓ Close db
    ✓ Close db with a promise
    ✓ Read db id after closing Close
    ✓ Modify a doc with incorrect rev
    ✓ Remove doc
    ✓ Remove doc with a promise
    ✓ Remove doc with new syntax
    ✓ Remove doc with new syntax and a promise
    ✓ Doc removal leaves only stub
    ✓ Remove doc twice with specified id
    ✓ Remove doc, no callback
    ✓ Delete document without id
    ✓ Delete document with many args
    ✓ Delete document with many args, callback style
    ✓ Delete doc with id + rev + no opts
    ✓ Delete doc with id + rev + no opts, callback style
    ✓ Delete doc with doc + opts
    ✓ Delete doc with doc + opts, callback style
    ✓ Delete doc with rev in opts
    ✓ Bulk docs
    ✓ Bulk docs with a promise
    ✓ Basic checks
    ✓ update with invalid rev
    ✓ Doc validation
    ✓ Replication fields (#2442)
    ✓ Testing issue #48 (53ms)
    ✓ Testing valid id
    ✓ Put doc without _id should fail
    ✓ Put doc with bad reserved id should fail
    ✓ update_seq persists
    ✓ deletions persists
    ✓ #4126 should not store raw Dates
    ✓ Create a db with a reserved name
    ✓ Error when document is not an object
    ✓ Test instance update_seq updates correctly
    ✓ Fail to fetch a doc after db was deleted (49ms)
    ✓ Fail to fetch a doc after db was deleted (62ms)
    ✓ Cant add docs with empty ids
    ✓ Test doc with percent in ID
    ✓ db.info should give auto_compaction = false (#2744)
    ✓ db.info should give auto_compaction = true (#2744)
    ✓ db.info should give adapter name (#3567)
    ✓ db.info should give correct doc_count
    ✓ putting returns {ok: true}
    ✓ putting is override-able
    ✓ issue 2779, deleted docs, old revs COUCHDB-292
    ✓ issue 2888, successive deletes and writes (41ms)
    ✓ 2 invalid puts
    ✓ Docs save "null" value
    ✓ replace PouchDB.destroy() (express-pouchdb#203)
    ✓ 3968, keeps all object fields
    ✓ 4712 invalid rev for new doc generates conflict
    ✓ test info() after db close
    ✓ test get() after db close
    ✓ test close() after db close
    ✓ 7259 should have "this" keyword properly scoped
    ✓ #5471 PouchDB.plugin() should throw error if passed wrong type or empty object

  test.basics.js-local
    ✓ Create a pouch without new keyword
    ✓ Name is accessible via instance
    ✓ 4314 Create a pouch with + in name
    ✓ Creating Pouch without name will throw
    ✓ 4314 Create a pouch with urlencoded name
    ✓ 4219 destroy a pouch
    ✓ 4339 throw useful error if method called on stale instance
    ✓ [4595] should reject xhr errors
    ✓ [4595] should emit error event on xhr error
    ✓ Add a doc
    ✓ Get invalid id
    ✓ Missing doc should contain ID in error object
    ✓ PUTed Conflicted doc should contain ID in error object
    ✓ POSTed Conflicted doc should contain ID in error object
    ✓ Add a doc with a promise
    ✓ Add a doc with opts object
    ✓ Modify a doc
    ✓ Modifying a doc that has rewritten content
    ✓ Modify a doc with a promise
    ✓ Read db id
    ✓ Read db id with promise
    ✓ Close db
    ✓ Close db with a promise
    ✓ Read db id after closing Close
    ✓ Modify a doc with incorrect rev
    ✓ Remove doc
    ✓ Remove doc with a promise
    ✓ Remove doc with new syntax
    ✓ Remove doc with new syntax and a promise
    ✓ Doc removal leaves only stub
    ✓ Remove doc twice with specified id
    ✓ Remove doc, no callback
    ✓ Delete document without id
    ✓ Delete document with many args
    ✓ Delete document with many args, callback style
    ✓ Delete doc with id + rev + no opts
    ✓ Delete doc with id + rev + no opts, callback style
    ✓ Delete doc with doc + opts
    ✓ Delete doc with doc + opts, callback style
    ✓ Delete doc with rev in opts
    ✓ Bulk docs
    ✓ Bulk docs with a promise
    ✓ Basic checks
    ✓ update with invalid rev
    ✓ Doc validation
    ✓ Replication fields (#2442)
    ✓ Allows _access field in documents (#8171)
    ✓ Testing issue #48 (51ms)
    ✓ Testing valid id
    ✓ Put doc without _id should fail
    ✓ Put doc with bad reserved id should fail
    ✓ update_seq persists
    ✓ deletions persists
    ✓ #4126 should not store raw Dates
    ✓ Create a db with a reserved name
    ✓ Error when document is not an object
    ✓ Test instance update_seq updates correctly
    ✓ Fail to fetch a doc after db was deleted
    ✓ Fail to fetch a doc after db was deleted
    ✓ Cant add docs with empty ids
    ✓ Test doc with percent in ID
    ✓ db.info should give auto_compaction = false (#2744)
    ✓ db.info should give auto_compaction = true (#2744)
    ✓ db.info should give adapter name (#3567)
    ✓ db.info should give correct doc_count
    ✓ putting returns {ok: true}
    ✓ putting is override-able
    ✓ issue 2779, deleted docs, old revs COUCHDB-292
    ✓ issue 2888, successive deletes and writes
    ✓ 2 invalid puts
    ✓ Docs save "null" value
    ✓ replace PouchDB.destroy() (express-pouchdb#203)
    ✓ 3968, keeps all object fields
    ✓ 4712 invalid rev for new doc generates conflict
    ✓ test info() after db close
    ✓ test get() after db close
    ✓ test close() after db close
    ✓ 7259 should have "this" keyword properly scoped
    ✓ should allow unicode doc ids
    ✓ should have same blob support for 2 dbs
    ✓ 6053, PouchDB.plugin() resets defaults
    ✓ #5471 PouchDB.plugin() should throw error if passed wrong type or empty object

  test.bulk_docs.js-local
    ✓ Testing bulk docs
    ✓ #6039 test id in bulk docs for conflict
    ✓ No id in bulk docs
    ✓ No _rev and new_edits=false
    ✓ 7829 bare rev 1- with new_edits=false
    ✓ Test empty bulkDocs
    ✓ Test many bulkDocs
    ✓ Test errors on invalid doc id
    ✓ Test two errors on invalid doc id
    ✓ No docs
    ✓ Jira 911
    ✓ Test multiple bulkdocs
    ✓ #2935 new_edits=false correct number
    ✓ #2935 new_edits=false correct number 2
    ✓ bulk docs update then delete then conflict
    ✓ bulk_docs delete then undelete
    ✓ #2935 new_edits=false with single unauthorized
    ✓ Deleting _local docs with bulkDocs
    ✓ Deleting _local docs with bulkDocs, not found
    ✓ Deleting _local docs with bulkDocs, wrong rev
    ✓ Bulk with new_edits=false
    ✓ Testing successive new_edits to the same doc
    ✓ #3062 bulkDocs with staggered seqs
    ✓ Testing successive new_edits to the same doc, different content
    ✓ Testing successive new_edits to two doc
    ✓ Deletion with new_edits=false
    ✓ Deletion with new_edits=false, no history
    ✓ Modification with new_edits=false, no history
    ✓ Deletion with new_edits=false, no history, no revisions
    ✓ Testing new_edits=false in req body
    ✓ 656 regression in handling deleted docs
    ✓ Test quotes in doc ids
    ✓ Bulk docs empty list
    ✓ handles simultaneous writes
    ✓ bulk docs input by array
    ✓ Bulk empty list
    ✓ Bulk docs not an array
    ✓ Bulk docs not an object
    ✓ Bulk docs two different revisions to same document id
    ✓ 4204 respect revs_limit (303ms)
    ✓ 2839 implement revs_limit (184ms)
    ✓ 4372 revs_limit deletes old revisions of the doc
    ✓ 4372 revs_limit with auto_compaction deletes old revisions of the doc
    ✓ 4712 invalid rev for new doc generates conflict
    ✓ 5793 bulk docs accepts _conflicts when new_edits=false

  test.bulk_docs.js-http
    ✓ Testing bulk docs
    ✓ #6039 test id in bulk docs for conflict
    ✓ No id in bulk docs
    ✓ No _rev and new_edits=false
    ✓ 7829 bare rev 1- with new_edits=false
    ✓ Test empty bulkDocs
    ✓ Test many bulkDocs
    ✓ Test errors on invalid doc id
    ✓ Test two errors on invalid doc id
    ✓ No docs
    ✓ Jira 911
    ✓ Test multiple bulkdocs
    ✓ #2935 new_edits=false correct number
    ✓ #2935 new_edits=false correct number 2
    ✓ bulk docs update then delete then conflict
    ✓ bulk_docs delete then undelete
    ✓ #2935 new_edits=false with single unauthorized
    ✓ Deleting _local docs with bulkDocs
    ✓ Bulk with new_edits=false
    ✓ Testing successive new_edits to the same doc
    ✓ #3062 bulkDocs with staggered seqs
    ✓ Testing successive new_edits to the same doc, different content
    ✓ Testing successive new_edits to two doc
    ✓ Deletion with new_edits=false
    ✓ Deletion with new_edits=false, no history
    ✓ Modification with new_edits=false, no history
    ✓ Deletion with new_edits=false, no history, no revisions
    ✓ Testing new_edits=false in req body
    ✓ 656 regression in handling deleted docs
    ✓ Test quotes in doc ids
    ✓ Bulk docs empty list
    ✓ handles simultaneous writes
    ✓ bulk docs input by array
    ✓ Bulk empty list
    ✓ Bulk docs not an array
    ✓ Bulk docs not an object
    ✓ Bulk docs two different revisions to same document id
    ✓ 4204 respect revs_limit (285ms)
    ✓ 2839 implement revs_limit
    ✓ 4372 revs_limit deletes old revisions of the doc
    ✓ 4372 revs_limit with auto_compaction deletes old revisions of the doc
    ✓ 4712 invalid rev for new doc generates conflict
    ✓ 5793 bulk docs accepts _conflicts when new_edits=false (42ms)

  test.bulk_get.js-http
    ✓ test bulk get with rev specified
    ✓ test bulk get with latest=true
    ✓ test bulk get with no rev specified
    ✓ _revisions is not returned by default
    ✓ #5886 bulkGet with reserved id
    ✓ _revisions is returned when specified
    ✓ _revisions is returned when specified, using implicit rev
    ✓ attachments are not included by default
    ✓ attachments are included when specified
    ✓ attachments are included when specified, using implicit rev

  test.bulk_get.js-local
    ✓ test bulk get with rev specified
    ✓ test bulk get with latest=true
    ✓ test bulk get with no rev specified
    ✓ _revisions is not returned by default
    ✓ #5886 bulkGet with reserved id
    ✓ _revisions is returned when specified
    ✓ _revisions is returned when specified, using implicit rev
    ✓ attachments are not included by default
    ✓ attachments are included when specified
    ✓ attachments are included when specified, using implicit rev

  test.changes.js-http
    ✓ All changes
    ✓ Changes with complete callback as param
    ✓ Promise resolved when changes cancelled
    - Live changes should clean listener when cancelled
    ✓ Changes Since
    ✓ Changes Since and limit limit 1
    ✓ Changes Since and limit limit 0
    ✓ Changes limit (39ms)
    ✓ Changes with filter not present in ddoc
    ✓ Changes with `filters` key not present in ddoc
    ✓ Changes limit and filter
    ✓ Changes with shorthand function name
    ✓ Changes with filter from nonexistent ddoc
    ✓ Changes with view not present in ddoc
    ✓ Changes with `views` key not present in ddoc
    ✓ #4451 Changes with invalid view filter
    ✓ 3356 throw inside a filter
    ✓ Changes with missing param `view` in request
    ✓ Changes limit and view instead of filter
    ✓ #3609 view option implies filter: _view
    ✓ Immediately cancel changes
    ✓ Changes with invalid ddoc view name
    ✓ Changes with invalid ddoc view name 2
    ✓ Changes with style = all_docs (63ms)
    ✓ Changes with style = all_docs and a callback for complete (58ms)
    ✓ Changes limit = 0
    ✓ Changes doc
    - Descending many changes
    ✓ live-changes
    ✓ Multiple watchers
    ✓ Continuous changes doc
    ✓ Cancel changes (321ms)
    ✓ #3579 changes firing 1 too many times (73ms)
    ✓ Kill database while listening to live changes
    ✓ #3136 style=all_docs
    ✓ #4191 revs_diff causes endless loop (73ms)
    ✓ #3136 style=all_docs & include_docs (71ms)
    ✓ changes-filter with query params
    ✓ Non-live changes filter
    ✓ Non-live changes filter, descending
    ✓ #2569 Non-live doc_ids filter
    ✓ #2569 Big non-live doc_ids filter
    ✓ #2569 Live doc_ids filter
    ✓ #2569 Big live doc_ids filter
    ✓ #2569 Non-live doc_ids filter with filter=_doc_ids
    ✓ #2569 Live doc_ids filter with filter=_doc_ids
    ✓ Changes to same doc are grouped
    ✓ Changes with conflicts are handled correctly (128ms)
    ✓ Change entry for a deleted doc
    ✓ changes large number of docs
    ✓ Calling db.changes({since: 'now'})
    ✓ Calling db.changes({since: 'latest'})
    ✓ Closing db does not cause a crash if changes cancelled
    ✓ fire-complete-on-cancel (103ms)
    ✓ changes are not duplicated (1024ms)
    ✓ supports return_docs=false
    ✓ should respects limit (72ms)
    ✓ doesn't throw if opts.complete is undefined
    ✓ handle individual changes in live replication (201ms)
    ✓ changes-filter without filter
    ✓ #3539 - Exception in changes is fine
    ✓ Changes with selector
    ✓ Changes with selector, explicit filter
    ✓ Changes with selector and mismatched filter
    ✓ Changes with limit and selector

  test.changes.js-local
    ✓ All changes
    ✓ Changes with complete callback as param
    ✓ Promise resolved when changes cancelled
    - Live changes should clean listener when cancelled
    ✓ Changes Since
    ✓ Changes Since and limit limit 1
    ✓ Changes Since and limit limit 0
    ✓ Changes limit
    ✓ Changes with filter not present in ddoc
    ✓ Changes with `filters` key not present in ddoc
    ✓ Changes limit and filter
    ✓ Changes with shorthand function name
    ✓ Changes with filter from nonexistent ddoc
    ✓ Changes with view not present in ddoc
    ✓ Changes with `views` key not present in ddoc
    ✓ #4451 Changes with invalid view filter
    ✓ 3356 throw inside a filter
    ✓ Changes with missing param `view` in request
    ✓ Changes limit and view instead of filter
    ✓ #3609 view option implies filter: _view
    ✓ Immediately cancel changes
    ✓ Changes with invalid ddoc view name
    ✓ Changes with invalid ddoc view name 2
    ✓ Changes with style = all_docs
    ✓ Changes with style = all_docs and a callback for complete
    ✓ Changes limit = 0
    ✓ Changes doc
    - Descending many changes
    ✓ live-changes
    ✓ Multiple watchers
    ✓ Continuous changes doc
    ✓ Cancel changes (315ms)
    ✓ #3579 changes firing 1 too many times (65ms)
    ✓ Kill database while listening to live changes
    ✓ #3136 style=all_docs
    ✓ #4191 revs_diff causes endless loop
    ✓ #3136 style=all_docs & include_docs
    ✓ changes-filter with query params
    ✓ Non-live changes filter
    ✓ Non-live changes filter, descending
    ✓ #2569 Non-live doc_ids filter
    ✓ #2569 Big non-live doc_ids filter
    ✓ #2569 Live doc_ids filter
    ✓ #2569 Big live doc_ids filter
    ✓ #2569 Non-live doc_ids filter with filter=_doc_ids
    ✓ #2569 Live doc_ids filter with filter=_doc_ids
    ✓ Changes to same doc are grouped
    ✓ Changes with conflicts are handled correctly
    ✓ Change entry for a deleted doc
    ✓ changes large number of docs
    ✓ Calling db.changes({since: 'now'})
    ✓ Calling db.changes({since: 'latest'})
    ✓ Closing db does not cause a crash if changes cancelled
    ✓ fire-complete-on-cancel (100ms)
    ✓ changes are not duplicated (1016ms)
    ✓ supports return_docs=false
    ✓ should respects limit (67ms)
    ✓ doesn't throw if opts.complete is undefined
    ✓ handle individual changes in live replication (65ms)
    ✓ changes-filter without filter
    ✓ #3539 - Exception in changes is fine
    ✓ Changes with selector
    ✓ Changes with selector, explicit filter
    ✓ Changes with selector and mismatched filter
    ✓ Changes with limit and selector

  changes-standalone
    - Changes reports errors

  test.close.js-local
    ✓ should emit destroyed even when closed (sync)
    ✓ should emit destroyed even when closed (async)
precondition_failed: Database not open
    at Object.<anonymous> (/data/js-variants/multee/Clients/levelup/pouchdb/packages/node_modules/pouchdb/lib/index.js:614:16)
    at Module._compile (node:internal/modules/cjs/loader:1105:14)
    at Module._extensions..js (node:internal/modules/cjs/loader:1159:10)
    at Module.load (node:internal/modules/cjs/loader:981:32)
    at Module._load (node:internal/modules/cjs/loader:827:12)
    at Module.require (node:internal/modules/cjs/loader:1005:19)
    at require (node:internal/modules/cjs/helpers:102:18)
    at commonUtils.loadPouchDBForNode (/data/js-variants/multee/Clients/levelup/pouchdb/tests/common-utils.js:92:17)
    at commonUtils.loadPouchDB (/data/js-variants/multee/Clients/levelup/pouchdb/tests/common-utils.js:78:39)
    at Object.<anonymous> (/data/js-variants/multee/Clients/levelup/pouchdb/tests/integration/node.setup.js:21:28)
    at Module._compile (node:internal/modules/cjs/loader:1105:14)
    at Module._extensions..js (node:internal/modules/cjs/loader:1159:10)
    at Module.load (node:internal/modules/cjs/loader:981:32)
    at Module._load (node:internal/modules/cjs/loader:827:12)
    at Module.require (node:internal/modules/cjs/loader:1005:19)
    at require (node:internal/modules/cjs/helpers:102:18)
    at /data/js-variants/multee/Clients/levelup/pouchdb/node_modules/mocha/bin/_mocha:366:3
    at Array.forEach (<anonymous>)
    at Object.<anonymous> (/data/js-variants/multee/Clients/levelup/pouchdb/node_modules/mocha/bin/_mocha:365:10)
    at Module._compile (node:internal/modules/cjs/loader:1105:14)
    at Module._extensions..js (node:internal/modules/cjs/loader:1159:10)
    at Module.load (node:internal/modules/cjs/loader:981:32)
    at Module._load (node:internal/modules/cjs/loader:827:12)
    at Function.executeUserEntryPoint [as runMain] (node:internal/modules/run_main:77:12)
    at node:internal/main/run_main_module:17:47
    ✓ should emit closed even when destroyed (async #2)
precondition_failed: Database not open
    at Object.<anonymous> (/data/js-variants/multee/Clients/levelup/pouchdb/packages/node_modules/pouchdb/lib/index.js:614:16)
    at Module._compile (node:internal/modules/cjs/loader:1105:14)
    at Module._extensions..js (node:internal/modules/cjs/loader:1159:10)
    at Module.load (node:internal/modules/cjs/loader:981:32)
    at Module._load (node:internal/modules/cjs/loader:827:12)
    at Module.require (node:internal/modules/cjs/loader:1005:19)
    at require (node:internal/modules/cjs/helpers:102:18)
    at commonUtils.loadPouchDBForNode (/data/js-variants/multee/Clients/levelup/pouchdb/tests/common-utils.js:92:17)
    at commonUtils.loadPouchDB (/data/js-variants/multee/Clients/levelup/pouchdb/tests/common-utils.js:78:39)
    at Object.<anonymous> (/data/js-variants/multee/Clients/levelup/pouchdb/tests/integration/node.setup.js:21:28)
    at Module._compile (node:internal/modules/cjs/loader:1105:14)
    at Module._extensions..js (node:internal/modules/cjs/loader:1159:10)
    at Module.load (node:internal/modules/cjs/loader:981:32)
    at Module._load (node:internal/modules/cjs/loader:827:12)
    at Module.require (node:internal/modules/cjs/loader:1005:19)
    at require (node:internal/modules/cjs/helpers:102:18)
    at /data/js-variants/multee/Clients/levelup/pouchdb/node_modules/mocha/bin/_mocha:366:3
    at Array.forEach (<anonymous>)
    at Object.<anonymous> (/data/js-variants/multee/Clients/levelup/pouchdb/node_modules/mocha/bin/_mocha:365:10)
    at Module._compile (node:internal/modules/cjs/loader:1105:14)
    at Module._extensions..js (node:internal/modules/cjs/loader:1159:10)
    at Module.load (node:internal/modules/cjs/loader:981:32)
    at Module._load (node:internal/modules/cjs/loader:827:12)
    at Function.executeUserEntryPoint [as runMain] (node:internal/modules/run_main:77:12)
    at node:internal/main/run_main_module:17:47
    ✓ test unref for coverage
    ✓ test double unref for coverage
precondition_failed: Database not open
    at Object.<anonymous> (/data/js-variants/multee/Clients/levelup/pouchdb/packages/node_modules/pouchdb/lib/index.js:614:16)
    at Module._compile (node:internal/modules/cjs/loader:1105:14)
    at Module._extensions..js (node:internal/modules/cjs/loader:1159:10)
    at Module.load (node:internal/modules/cjs/loader:981:32)
    at Module._load (node:internal/modules/cjs/loader:827:12)
    at Module.require (node:internal/modules/cjs/loader:1005:19)
    at require (node:internal/modules/cjs/helpers:102:18)
    at commonUtils.loadPouchDBForNode (/data/js-variants/multee/Clients/levelup/pouchdb/tests/common-utils.js:92:17)
    at commonUtils.loadPouchDB (/data/js-variants/multee/Clients/levelup/pouchdb/tests/common-utils.js:78:39)
    at Object.<anonymous> (/data/js-variants/multee/Clients/levelup/pouchdb/tests/integration/node.setup.js:21:28)
    at Module._compile (node:internal/modules/cjs/loader:1105:14)
    at Module._extensions..js (node:internal/modules/cjs/loader:1159:10)
    at Module.load (node:internal/modules/cjs/loader:981:32)
    at Module._load (node:internal/modules/cjs/loader:827:12)
    at Module.require (node:internal/modules/cjs/loader:1005:19)
    at require (node:internal/modules/cjs/helpers:102:18)
    at /data/js-variants/multee/Clients/levelup/pouchdb/node_modules/mocha/bin/_mocha:366:3
    at Array.forEach (<anonymous>)
    at Object.<anonymous> (/data/js-variants/multee/Clients/levelup/pouchdb/node_modules/mocha/bin/_mocha:365:10)
    at Module._compile (node:internal/modules/cjs/loader:1105:14)
    at Module._extensions..js (node:internal/modules/cjs/loader:1159:10)
    at Module.load (node:internal/modules/cjs/loader:981:32)
    at Module._load (node:internal/modules/cjs/loader:827:12)
    at Function.executeUserEntryPoint [as runMain] (node:internal/modules/run_main:77:12)
    at node:internal/main/run_main_module:17:47
    ✓ test close-then-destroyed for coverage
************* run test done *************
pouchdb is testing ./Variants/levelup/variant12/levelup
/data/js-variants/multee
************* npm unlink module *************

removed 1 package, changed 1 package, and audited 1032 packages in 3s

64 packages are looking for funding
  run `npm fund` for details

41 vulnerabilities (1 low, 9 moderate, 25 high, 6 critical)

To address issues that do not require attention, run:
  npm audit fix

To address all issues possible (including breaking changes), run:
  npm audit fix --force

Some issues need review, and may require choosing
a different dependency.

Run `npm audit` for details.
************* npm unlink module done *************
************* npm unlink globally *************

removed 1 package, and audited 1 package in 1s

found 0 vulnerabilities
************* npm unlink globally done *************
************* npm link globally *************

added 1 package, and audited 3 packages in 403ms

found 0 vulnerabilities
************* npm link globally done *************
************* npm link module *************

added 1 package, changed 1 package, and audited 1034 packages in 4s

64 packages are looking for funding
  run `npm fund` for details

41 vulnerabilities (1 low, 9 moderate, 25 high, 6 critical)

To address issues that do not require attention, run:
  npm audit fix

To address all issues possible (including breaking changes), run:
  npm audit fix --force

Some issues need review, and may require choosing
a different dependency.

Run `npm audit` for details.
************* npm link module done *************
************* start run test *************

> pouchdb-monorepo@7.0.0-prerelease test
> bash bin/run-test.sh


> pouchdb-monorepo@7.0.0-prerelease build-node
> bash bin/build-node.sh


> pouchdb-monorepo@7.0.0-prerelease build-modules
> node bin/build-modules.js

Building pouchdb...
Building pouchdb-abstract-mapreduce...
Building pouchdb-adapter-http...
Building pouchdb-adapter-idb...
Building pouchdb-adapter-indexeddb...
Building pouchdb-adapter-leveldb...
Building pouchdb-adapter-leveldb-core...
Building pouchdb-adapter-localstorage...
Building pouchdb-adapter-memory...
Building pouchdb-adapter-utils...
Building pouchdb-binary-utils...
Building pouchdb-browser...
Building pouchdb-changes-filter...
Building pouchdb-checkpointer...
Building pouchdb-collate...
Building pouchdb-collections...
Building pouchdb-core...
Building pouchdb-errors...
Building pouchdb-fetch...
Building pouchdb-find...
Building pouchdb-for-coverage...
Building pouchdb-generate-replication-id...
Building pouchdb-json...
Building pouchdb-mapreduce...
Building pouchdb-mapreduce-utils...
Building pouchdb-md5...
Building pouchdb-merge...
Building pouchdb-node...
Building pouchdb-replication...
Building pouchdb-selector-core...
Building pouchdb-utils...
Building sublevel-pouchdb...
  ✓ wrote pouchdb-adapter-localstorage/lib/index.js in vanilla mode
  ✓ wrote pouchdb-adapter-localstorage/lib/index.es.js in vanilla mode
  ✓ wrote pouchdb-adapter-memory/lib/index.js in vanilla mode
  ✓ wrote pouchdb-adapter-memory/lib/index.es.js in vanilla mode
  ✓ wrote pouchdb-checkpointer/lib/index.js in vanilla mode
  ✓ wrote pouchdb-checkpointer/lib/index.es.js in vanilla mode
  ✓ wrote pouchdb-errors/lib/index.js in vanilla mode
  ✓ wrote pouchdb-errors/lib/index.es.js in vanilla mode
  ✓ wrote pouchdb-generate-replication-id/lib/index.js in vanilla mode
  ✓ wrote pouchdb-generate-replication-id/lib/index.es.js in vanilla mode
  ✓ wrote pouchdb-adapter-http/lib/index.js in vanilla mode
  ✓ wrote pouchdb-adapter-http/lib/index.es.js in vanilla mode
  ✓ wrote pouchdb-adapter-leveldb-core/lib/index.js in node mode
  ✓ wrote pouchdb-adapter-leveldb-core/lib/index.es.js in node mode
  ✓ wrote pouchdb-adapter-leveldb-core/lib/index-browser.js in browser mode
  ✓ wrote pouchdb-adapter-leveldb-core/lib/index-browser.es.js in browser mode
  ✓ wrote pouchdb-adapter-leveldb/lib/index.js in node mode
  ✓ wrote pouchdb-adapter-leveldb/lib/index.es.js in node mode
  ✓ wrote pouchdb-adapter-leveldb/lib/index-browser.js in browser mode
  ✓ wrote pouchdb-adapter-leveldb/lib/index-browser.es.js in browser mode
  ✓ wrote pouchdb-changes-filter/lib/index-browser.js in browser mode
  ✓ wrote pouchdb-changes-filter/lib/index-browser.es.js in browser mode
  ✓ wrote pouchdb-fetch/lib/index-browser.js in browser mode
  ✓ wrote pouchdb-fetch/lib/index-browser.es.js in browser mode
  ✓ wrote pouchdb-md5/lib/index-browser.js in browser mode
  ✓ wrote pouchdb-md5/lib/index-browser.es.js in browser mode
  ✓ wrote pouchdb-changes-filter/lib/index.js in node mode
  ✓ wrote pouchdb-changes-filter/lib/index.es.js in node mode
  ✓ wrote pouchdb-collate/lib/index.js in vanilla mode
  ✓ wrote pouchdb-collate/lib/index.es.js in vanilla mode
  ✓ wrote pouchdb-fetch/lib/index.js in node mode
  ✓ wrote pouchdb-fetch/lib/index.es.js in node mode
  ✓ wrote pouchdb-json/lib/index.js in vanilla mode
  ✓ wrote pouchdb-json/lib/index.es.js in vanilla mode
  ✓ wrote pouchdb-mapreduce-utils/lib/index.js in vanilla mode
  ✓ wrote pouchdb-mapreduce-utils/lib/index.es.js in vanilla mode
  ✓ wrote pouchdb-md5/lib/index.js in node mode
  ✓ wrote pouchdb-md5/lib/index.es.js in node mode
  ✓ wrote pouchdb-abstract-mapreduce/lib/index.js in vanilla mode
  ✓ wrote pouchdb-abstract-mapreduce/lib/index.es.js in vanilla mode
  ✓ wrote pouchdb-adapter-idb/lib/index.js in vanilla mode
  ✓ wrote pouchdb-adapter-idb/lib/index.es.js in vanilla mode
  ✓ wrote pouchdb-adapter-indexeddb/lib/index.js in vanilla mode
  ✓ wrote pouchdb-adapter-indexeddb/lib/index.es.js in vanilla mode
  ✓ wrote pouchdb-binary-utils/lib/index-browser.js in browser mode
  ✓ wrote pouchdb-binary-utils/lib/index-browser.es.js in browser mode
  ✓ wrote pouchdb-utils/lib/index-browser.js in browser mode
  ✓ wrote pouchdb-utils/lib/index-browser.es.js in browser mode
  ✓ wrote pouchdb-utils/lib/index.js in node mode
  ✓ wrote pouchdb-utils/lib/index.es.js in node mode
  ✓ wrote pouchdb-binary-utils/lib/index.js in node mode
  ✓ wrote pouchdb-binary-utils/lib/index.es.js in node mode
  ✓ wrote pouchdb-adapter-utils/lib/index.js in vanilla mode
  ✓ wrote pouchdb-adapter-utils/lib/index.es.js in vanilla mode
  ✓ wrote pouchdb-collections/lib/index.js in vanilla mode
  ✓ wrote pouchdb-collections/lib/index.es.js in vanilla mode
  ✓ wrote pouchdb-merge/lib/index.js in vanilla mode
  ✓ wrote pouchdb-merge/lib/index.es.js in vanilla mode
  ✓ wrote pouchdb-selector-core/lib/index.js in vanilla mode
  ✓ wrote pouchdb-selector-core/lib/index.es.js in vanilla mode
  ✓ wrote sublevel-pouchdb/lib/index.js in vanilla mode
  ✓ wrote sublevel-pouchdb/lib/index.es.js in vanilla mode
  ✓ wrote pouchdb-mapreduce/lib/index-browser.js in browser mode
  ✓ wrote pouchdb-mapreduce/lib/index-browser.es.js in browser mode
  ✓ wrote pouchdb-replication/lib/index.js in vanilla mode
  ✓ wrote pouchdb-replication/lib/index.es.js in vanilla mode
  ✓ wrote pouchdb-mapreduce/lib/index.js in node mode
  ✓ wrote pouchdb-mapreduce/lib/index.es.js in node mode
  ✓ wrote pouchdb-core/lib/index.js in vanilla mode
  ✓ wrote pouchdb-core/lib/index.es.js in vanilla mode
  ✓ wrote pouchdb-find/lib/index.js in node mode
  ✓ wrote pouchdb-find/lib/index.es.js in node mode
  ✓ wrote pouchdb-find/lib/index-browser.js in browser mode
  ✓ wrote pouchdb-find/lib/index-browser.es.js in browser mode
  ✓ wrote pouchdb-for-coverage/lib/index.js in node mode
  ✓ wrote pouchdb-for-coverage/lib/index.es.js in node mode
  ✓ wrote pouchdb-for-coverage/lib/index-browser.js in browser mode
  ✓ wrote pouchdb-for-coverage/lib/index-browser.es.js in browser mode
  ✓ wrote pouchdb-browser/lib/index.js in vanilla mode
  ✓ wrote pouchdb-browser/lib/index.es.js in vanilla mode
  ✓ wrote pouchdb-node/lib/index.js in vanilla mode
  ✓ wrote pouchdb-node/lib/index.es.js in vanilla mode
  ✓ wrote packages/node_modules/pouchdb/lib/index.js
  ✓ wrote packages/node_modules/pouchdb/lib/index.es.js
Waiting for host to start ..
Host started :)
> pouchdb-monorepo@7.0.0-prerelease test-node
> bash bin/test-node.sh

Down server listening on port 3010
Seeded with: 1660142801667


  DB Setup
    ✓ PouchDB has a version
    ✓ PouchDB version matches package.json

  test.active_tasks.js
    ✓ Can add a task
    ✓ Can get tasks by id
    ✓ Can get all tasks
    ✓ Can update a task
    ✓ Can remove a task

  test.all_docs.js-http
    ✓ Testing all docs (167ms)
    ✓ Testing allDocs opts.keys (60ms)
    ✓ Testing allDocs opts.keys with skip
    ✓ Testing allDocs opts.keys with limit
    ✓ Testing allDocs invalid opts.keys
    ✓ Testing deleting in changes (45ms)
    ✓ Testing updating in changes (48ms)
    ✓ Testing include docs
    ✓ Testing conflicts (96ms)
    ✓ test basic collation
    ✓ 3883 start_key end_key aliases
    ✓ test total_rows with a variety of criteria (133ms)
    ✓ test total_rows with both skip and limit
    ✓ test limit option and total_rows
    ✓ test escaped startkey/endkey
    ✓ test "key" option
    ✓ test inclusive_end=false (57ms)
    ✓ test descending with startkey/endkey
    ✓ #3082 test wrong num results returned (252ms)
    ✓ test empty db
    ✓ test after db close
    ✓ 5793 _conflicts should not exist if no conflicts
    ✓ #6230 Test allDocs opts update_seq: false
    ✓ #6230 Test allDocs opts update_seq: true
    ✓ #6230 Test allDocs opts with update_seq missing

  test.all_docs.js-local
    ✓ Testing all docs (40ms)
    ✓ Testing allDocs opts.keys
    ✓ Testing allDocs opts.keys with skip
    ✓ Testing allDocs opts.keys with limit
    ✓ Testing allDocs invalid opts.keys
    ✓ Testing deleting in changes
    ✓ Testing updating in changes
    ✓ Testing include docs
    ✓ Testing conflicts
    ✓ test basic collation
    ✓ 3883 start_key end_key aliases
    ✓ test total_rows with a variety of criteria
    ✓ test total_rows with both skip and limit
    ✓ test limit option and total_rows
    ✓ test escaped startkey/endkey
    ✓ test "key" option
    ✓ test inclusive_end=false
    ✓ test descending with startkey/endkey
    ✓ #3082 test wrong num results returned (191ms)
    ✓ test empty db
    ✓ test after db close
    ✓ test unicode ids and revs
    ✓ 5793 _conflicts should not exist if no conflicts
    ✓ #6230 Test allDocs opts update_seq: false
    ✓ #6230 Test allDocs opts update_seq: true
    ✓ #6230 Test allDocs opts with update_seq missing

  suite2 test.attachments.js-local
    ✓ 3357 Attachment names cant start with _
    ✓ 5736 warning for putAttachment without content_type
    ✓ 5736 warning for bulkDocs attachments without content_type
    ✓ fetch atts with open_revs and missing
    ✓ issue 2803 should throw 412
    ✓ issue 2803 should throw 412 part 2
    ✓ issue 2803 should throw 412 part 3
    ✓ issue 2803 should throw 412 part 4
    ✓ #2858 {binary: true} in get()
    ✓ #2858 {binary: true} in allDocs() 1
    ✓ #2858 {binary: true} in allDocs() 2
    ✓ #2858 {binary: true} in allDocs() 3
    ✓ #2858 {binary: true} in allDocs() 4
    ✓ #2858 {binary: true} in allDocs() 5
    ✓ #2858 {binary: true} in allDocs(), many atts
    ✓ #2858 {binary: true} in allDocs(), mixed atts
    ✓ #2858 {binary: true} in changes() non-live
    ✓ #2858 {binary: true} in changes() non-live, many atts
    ✓ #2858 {binary: true} in changes() non-live, mixed atts
    ✓ #2858 {binary: true} non-live changes, complete event
    ✓ #2858 {binary: true} in live changes
    ✓ #2858 {binary: true} in live changes, mixed atts
    ✓ #2858 {binary: true} in live+retry changes
    ✓ #2858 {binary: true} in live changes, attachments:false
    ✓ #2858 {binary: true} in live changes, include_docs:false
    ✓ #6736 {binary: true} in bulkGet()
    ✓ Measures length correctly after put()
    ✓ #3074 non-live changes() (54ms)
    ✓ #3074 live changes()
    ✓ #3074 non-live changes(), no attachments
    ✓ #3074 live changes(), no attachments
    ✓ #3881 filter extraneous keys from _attachments
    ✓ #2771 allDocs() 1, single attachment
    ✓ #2771 allDocs() 2, many docs same att
    ✓ #2771 allDocs() 3, many docs diff atts
    ✓ #2771 allDocs() 4, mix of atts and no atts
    ✓ #2771 allDocs() 5, no atts
    ✓ #2771 allDocs() 6, no docs
    ✓ #2771 allDocs() 7, revisions and deletions
    ✓ #2771 allDocs() 8, empty attachment
    ✓ No length for non-stubs
    ✓ Test some attachments
    ✓ Test getAttachment
    ✓ Test getAttachment with stubs
    ✓ Test get() with binary:true and stubs
    ✓ Test attachments in allDocs/changes
    ✓ Test putAttachment with base64 plaintext
    ✓ Test putAttachment with invalid base64
    ✓ Test getAttachment with empty text
    ✓ Test getAttachment with normal text
    ✓ Test getAttachment with PNG
    ✓ Test getAttachment with PNG using bulkDocs
    ✓ Test getAttachment with PNG using post
    ✓ Test postAttachment with PNG then bulkDocs
    ✓ proper stub behavior
    ✓ Testing with invalid docs
    ✓ Test create attachment and doc in one go
    ✓ Test create attachment and doc in one go without callback
    ✓ Test create attachment without callback
    ✓ Test put attachment on a doc without attachments
    ✓ Test put attachment with unencoded name
    ✓ 3963 length property on stubs
    ✓ Testing with invalid rev
    ✓ Test put another attachment on a doc with attachments
    ✓ Test get with attachments: true if empty attachments
    ✓ Test delete attachment from a doc
    ✓ Test a document with a json string attachment
    ✓ Test remove doc with attachment
    ✓ Try to insert a doc with unencoded attachment
    ✓ Try to get attachment of unexistent doc
    ✓ Test synchronous putAttachment with text data
    ✓ Test synchronous putAttachment with no text data
    ✓ Test put with partial stubs
    ✓ Test put with attachments and new_edits=false
    ✓ Test getAttachment with specific rev
    ✓ Test getAttachment with diff revs and content
    ✓ Test stubs
    ✓ Try to get unexistent attachment of some doc
    ✓ putAttachment and getAttachment with plaintext
    ✓ putAttachment and getAttachment with png data
    ✓ putAttachment in new doc with base64
    ✓ #2818 - save same attachment in different revs
    ✓ #2818 - save same attachment many times in parallel
    ✓ #2818 - revisions keep attachments (no compaction)
    ✓ #2818 - doesn't throw 409 if same filename
    ✓ #3008 test correct encoding/decoding of \u0000 etc.
    ✓ putAttachment and getAttachment with big png data (90ms)
    ✓ #2709 `revpos` with putAttachment
    ✓ #2709 `revpos` with inline attachment
    ✓ #2709 `revpos` with allDocs
    ✓ #7403 {attachments: true, binary: true, include_docs: true} in allDocs with one missing doc

  suite2 test.attachments.js-http
    ✓ 3357 Attachment names cant start with _
    ✓ 5736 warning for putAttachment without content_type
    ✓ 5736 warning for bulkDocs attachments without content_type
    ✓ fetch atts with open_revs and missing
    ✓ issue 2803 should throw 412
    ✓ issue 2803 should throw 412 part 2
    ✓ issue 2803 should throw 412 part 3
    ✓ issue 2803 should throw 412 part 4
    ✓ #2858 {binary: true} in get()
    ✓ #2858 {binary: true} in allDocs() 1
    ✓ #2858 {binary: true} in allDocs() 2
    ✓ #2858 {binary: true} in allDocs() 3
    ✓ #2858 {binary: true} in allDocs() 4
    ✓ #2858 {binary: true} in allDocs() 5
    ✓ #2858 {binary: true} in allDocs(), many atts
    ✓ #2858 {binary: true} in allDocs(), mixed atts
    ✓ #2858 {binary: true} in changes() non-live
    ✓ #2858 {binary: true} in changes() non-live, many atts
    ✓ #2858 {binary: true} in changes() non-live, mixed atts
    ✓ #2858 {binary: true} non-live changes, complete event
    ✓ #2858 {binary: true} in live changes
    ✓ #2858 {binary: true} in live changes, mixed atts
    ✓ #2858 {binary: true} in live+retry changes
    ✓ #2858 {binary: true} in live changes, attachments:false
    ✓ #2858 {binary: true} in live changes, include_docs:false
    ✓ #6736 {binary: true} in bulkGet()
    ✓ Measures length correctly after put()
    ✓ #3074 non-live changes() (46ms)
    ✓ #3074 live changes() (43ms)
    ✓ #3074 non-live changes(), no attachments
    ✓ #3074 live changes(), no attachments
    ✓ #3881 filter extraneous keys from _attachments
    ✓ #2771 allDocs() 1, single attachment
    ✓ #2771 allDocs() 2, many docs same att
    ✓ #2771 allDocs() 3, many docs diff atts
    ✓ #2771 allDocs() 4, mix of atts and no atts
    ✓ #2771 allDocs() 5, no atts
    ✓ #2771 allDocs() 6, no docs
    ✓ #2771 allDocs() 7, revisions and deletions
    ✓ #2771 allDocs() 8, empty attachment (54ms)
    ✓ No length for non-stubs
    ✓ Test some attachments (47ms)
    ✓ Test getAttachment
    ✓ Test getAttachment with stubs
    ✓ Test get() with binary:true and stubs (40ms)
    ✓ Test attachments in allDocs/changes
    ✓ Test putAttachment with base64 plaintext
    ✓ Test putAttachment with invalid base64
    ✓ Test getAttachment with empty text
    ✓ Test getAttachment with normal text
    ✓ Test getAttachment with PNG
    ✓ Test getAttachment with PNG using bulkDocs
    ✓ Test getAttachment with PNG using post
    ✓ Test postAttachment with PNG then bulkDocs
    ✓ proper stub behavior (38ms)
    ✓ Testing with invalid docs
    ✓ Test create attachment and doc in one go
    ✓ Test create attachment and doc in one go without callback
    ✓ Test create attachment without callback (40ms)
    ✓ Test put attachment on a doc without attachments
    ✓ Test put attachment with unencoded name
    ✓ 3963 length property on stubs (50ms)
    ✓ Testing with invalid rev
    ✓ Test put another attachment on a doc with attachments
    ✓ Test get with attachments: true if empty attachments
    ✓ Test delete attachment from a doc (40ms)
    ✓ Test a document with a json string attachment
    ✓ Test remove doc with attachment
    ✓ Try to insert a doc with unencoded attachment
    ✓ Try to get attachment of unexistent doc
    ✓ Test synchronous putAttachment with text data
    ✓ Test synchronous putAttachment with no text data
    ✓ Test put with partial stubs
    ✓ Test put with attachments and new_edits=false
    ✓ Test getAttachment with specific rev
    ✓ Test getAttachment with diff revs and content
    ✓ Test stubs
    ✓ Try to get unexistent attachment of some doc
    ✓ putAttachment and getAttachment with plaintext
    ✓ putAttachment and getAttachment with png data
    ✓ putAttachment in new doc with base64
    ✓ #2818 - save same attachment in different revs (45ms)
    ✓ #2818 - save same attachment many times in parallel
    ✓ #2818 - revisions keep attachments (no compaction)
    ✓ #2818 - doesn't throw 409 if same filename
    ✓ #3008 test correct encoding/decoding of \u0000 etc.
    ✓ putAttachment and getAttachment with big png data (163ms)
    ✓ #2709 `revpos` with putAttachment (53ms)
    ✓ #2709 `revpos` with inline attachment (67ms)
    ✓ #2709 `revpos` with allDocs
    ✓ #7403 {attachments: true, binary: true, include_docs: true} in allDocs with one missing doc

  suite2 test.attachments.js- local:http
    ✓ Attachments replicate back and forth (114ms)
    ✓ Replicate same doc, same atts (109ms)
    ✓ Replicate same doc, same atts 2 (119ms)
    ✓ Attachments replicate (60ms)
    ✓ Attachment types replicate (51ms)
    ✓ Many many attachments replicate (183ms)
    ✓ Many many png attachments replicate (197ms)
    ✓ Multiple attachments replicate (82ms)
    - #3961 Many attachments on same doc
    ✓ Multiple attachments replicate, different docs (#2698) (79ms)
    ✓ Multiple attachments replicate, different docs png (#2698) (80ms)
    ✓ #3932 attachments with tricky revpos (134ms)
    ✓ replication with changing attachments (98ms)
    ✓ 3955 race condition in put
    ✓ #8456 bad attachment rev after replication (115ms)

  suite2 test.attachments.js- http:http
    ✓ Attachments replicate back and forth (188ms)
    ✓ Replicate same doc, same atts (177ms)
    ✓ Replicate same doc, same atts 2 (174ms)
    ✓ Attachments replicate (80ms)
    ✓ Attachment types replicate (93ms)
    ✓ Many many attachments replicate (372ms)
    ✓ Many many png attachments replicate (290ms)
    ✓ Multiple attachments replicate (123ms)
    - #3961 Many attachments on same doc
    ✓ Multiple attachments replicate, different docs (#2698) (121ms)
    ✓ Multiple attachments replicate, different docs png (#2698) (126ms)
    ✓ #3932 attachments with tricky revpos (281ms)
    ✓ replication with changing attachments (203ms)
    ✓ 3955 race condition in put
    ✓ #8456 bad attachment rev after replication (183ms)

  suite2 test.attachments.js- http:local
    ✓ Attachments replicate back and forth (106ms)
    ✓ Replicate same doc, same atts (104ms)
    ✓ Replicate same doc, same atts 2 (101ms)
    ✓ Attachments replicate (52ms)
    ✓ Attachment types replicate (56ms)
    ✓ Many many attachments replicate (140ms)
    ✓ Many many png attachments replicate (187ms)
    ✓ Multiple attachments replicate (86ms)
    - #3961 Many attachments on same doc
    ✓ Multiple attachments replicate, different docs (#2698) (69ms)
    ✓ Multiple attachments replicate, different docs png (#2698) (91ms)
    ✓ #3932 attachments with tricky revpos (141ms)
    ✓ replication with changing attachments (95ms)
    ✓ 3955 race condition in put
    ✓ #8456 bad attachment rev after replication (150ms)

  suite2 test.attachments.js- local:local
    ✓ Attachments replicate back and forth
    ✓ Replicate same doc, same atts
    ✓ Replicate same doc, same atts 2
    ✓ Attachments replicate
    ✓ Attachment types replicate
    ✓ Many many attachments replicate (39ms)
    ✓ Many many png attachments replicate
    ✓ Multiple attachments replicate
    - #3961 Many attachments on same doc
    ✓ Multiple attachments replicate, different docs (#2698)
    ✓ Multiple attachments replicate, different docs png (#2698)
    ✓ #3932 attachments with tricky revpos
    ✓ replication with changing attachments
    ✓ 3955 race condition in put
    ✓ #8456 bad attachment rev after replication

  test.basics.js-http
    ✓ Create a pouch without new keyword
    ✓ Name is accessible via instance
    ✓ 4314 Create a pouch with + in name
    ✓ Creating Pouch without name will throw
    ✓ 4314 Create a pouch with urlencoded name
    ✓ 4219 destroy a pouch
    ✓ 4339 throw useful error if method called on stale instance
    ✓ [4595] should reject xhr errors
    ✓ [4595] should emit error event on xhr error
    ✓ Add a doc
    ✓ Get invalid id
    ✓ Missing doc should contain ID in error object
    ✓ PUTed Conflicted doc should contain ID in error object
    ✓ POSTed Conflicted doc should contain ID in error object
    ✓ Add a doc with a promise
    ✓ Add a doc with opts object
    ✓ Modify a doc
    ✓ Modifying a doc that has rewritten content
    ✓ Modify a doc with a promise
    ✓ Read db id
    ✓ Read db id with promise
    ✓ Close db
    ✓ Close db with a promise
    ✓ Read db id after closing Close
    ✓ Modify a doc with incorrect rev
    ✓ Remove doc
    ✓ Remove doc with a promise
    ✓ Remove doc with new syntax
    ✓ Remove doc with new syntax and a promise
    ✓ Doc removal leaves only stub
    ✓ Remove doc twice with specified id
    ✓ Remove doc, no callback
    ✓ Delete document without id
    ✓ Delete document with many args
    ✓ Delete document with many args, callback style
    ✓ Delete doc with id + rev + no opts
    ✓ Delete doc with id + rev + no opts, callback style
    ✓ Delete doc with doc + opts
    ✓ Delete doc with doc + opts, callback style
    ✓ Delete doc with rev in opts
    ✓ Bulk docs
    ✓ Bulk docs with a promise
    ✓ Basic checks
    ✓ update with invalid rev
    ✓ Doc validation
    ✓ Replication fields (#2442)
    ✓ Testing issue #48 (111ms)
    ✓ Testing valid id
    ✓ Put doc without _id should fail
    ✓ Put doc with bad reserved id should fail
    ✓ update_seq persists
    ✓ deletions persists
    ✓ #4126 should not store raw Dates
    ✓ Create a db with a reserved name
    ✓ Error when document is not an object
    ✓ Test instance update_seq updates correctly
    ✓ Fail to fetch a doc after db was deleted (45ms)
    ✓ Fail to fetch a doc after db was deleted (44ms)
    ✓ Cant add docs with empty ids
    ✓ Test doc with percent in ID
    ✓ db.info should give auto_compaction = false (#2744)
    ✓ db.info should give auto_compaction = true (#2744)
    ✓ db.info should give adapter name (#3567)
    ✓ db.info should give correct doc_count
    ✓ putting returns {ok: true}
    ✓ putting is override-able
    ✓ issue 2779, deleted docs, old revs COUCHDB-292
    ✓ issue 2888, successive deletes and writes
    ✓ 2 invalid puts
    ✓ Docs save "null" value
    ✓ replace PouchDB.destroy() (express-pouchdb#203)
    ✓ 3968, keeps all object fields
    ✓ 4712 invalid rev for new doc generates conflict
    ✓ test info() after db close
    ✓ test get() after db close
    ✓ test close() after db close
    ✓ 7259 should have "this" keyword properly scoped
    ✓ #5471 PouchDB.plugin() should throw error if passed wrong type or empty object

  test.basics.js-local
    ✓ Create a pouch without new keyword
    ✓ Name is accessible via instance
    ✓ 4314 Create a pouch with + in name
    ✓ Creating Pouch without name will throw
    ✓ 4314 Create a pouch with urlencoded name
    ✓ 4219 destroy a pouch
    ✓ 4339 throw useful error if method called on stale instance
    ✓ [4595] should reject xhr errors
    ✓ [4595] should emit error event on xhr error
    ✓ Add a doc
    ✓ Get invalid id
    ✓ Missing doc should contain ID in error object
    ✓ PUTed Conflicted doc should contain ID in error object
    ✓ POSTed Conflicted doc should contain ID in error object
    ✓ Add a doc with a promise
    ✓ Add a doc with opts object
    ✓ Modify a doc
    ✓ Modifying a doc that has rewritten content
    ✓ Modify a doc with a promise
    ✓ Read db id
    ✓ Read db id with promise
    ✓ Close db
    ✓ Close db with a promise
    ✓ Read db id after closing Close
    ✓ Modify a doc with incorrect rev
    ✓ Remove doc
    ✓ Remove doc with a promise
    ✓ Remove doc with new syntax
    ✓ Remove doc with new syntax and a promise
    ✓ Doc removal leaves only stub
    ✓ Remove doc twice with specified id
    ✓ Remove doc, no callback
    ✓ Delete document without id
    ✓ Delete document with many args
    ✓ Delete document with many args, callback style
    ✓ Delete doc with id + rev + no opts
    ✓ Delete doc with id + rev + no opts, callback style
    ✓ Delete doc with doc + opts
    ✓ Delete doc with doc + opts, callback style
    ✓ Delete doc with rev in opts
    ✓ Bulk docs
    ✓ Bulk docs with a promise
    ✓ Basic checks
    ✓ update with invalid rev
    ✓ Doc validation
    ✓ Replication fields (#2442)
    ✓ Allows _access field in documents (#8171)
    ✓ Testing issue #48 (52ms)
    ✓ Testing valid id
    ✓ Put doc without _id should fail
    ✓ Put doc with bad reserved id should fail
    ✓ update_seq persists
    ✓ deletions persists
    ✓ #4126 should not store raw Dates
    ✓ Create a db with a reserved name
    ✓ Error when document is not an object
    ✓ Test instance update_seq updates correctly
    ✓ Fail to fetch a doc after db was deleted
    ✓ Fail to fetch a doc after db was deleted
    ✓ Cant add docs with empty ids
    ✓ Test doc with percent in ID
    ✓ db.info should give auto_compaction = false (#2744)
    ✓ db.info should give auto_compaction = true (#2744)
    ✓ db.info should give adapter name (#3567)
    ✓ db.info should give correct doc_count
    ✓ putting returns {ok: true}
    ✓ putting is override-able
    ✓ issue 2779, deleted docs, old revs COUCHDB-292
    ✓ issue 2888, successive deletes and writes
    ✓ 2 invalid puts
    ✓ Docs save "null" value
    ✓ replace PouchDB.destroy() (express-pouchdb#203)
    ✓ 3968, keeps all object fields
    ✓ 4712 invalid rev for new doc generates conflict
    ✓ test info() after db close
    ✓ test get() after db close
    ✓ test close() after db close
    ✓ 7259 should have "this" keyword properly scoped
    ✓ should allow unicode doc ids
    ✓ should have same blob support for 2 dbs
    ✓ 6053, PouchDB.plugin() resets defaults
    ✓ #5471 PouchDB.plugin() should throw error if passed wrong type or empty object

  test.bulk_docs.js-local
    ✓ Testing bulk docs
    ✓ #6039 test id in bulk docs for conflict
    ✓ No id in bulk docs
    ✓ No _rev and new_edits=false
    ✓ 7829 bare rev 1- with new_edits=false
    ✓ Test empty bulkDocs
    ✓ Test many bulkDocs
    ✓ Test errors on invalid doc id
    ✓ Test two errors on invalid doc id
    ✓ No docs
    ✓ Jira 911
    ✓ Test multiple bulkdocs
    ✓ #2935 new_edits=false correct number
    ✓ #2935 new_edits=false correct number 2
    ✓ bulk docs update then delete then conflict
    ✓ bulk_docs delete then undelete
    ✓ #2935 new_edits=false with single unauthorized
    ✓ Deleting _local docs with bulkDocs
    ✓ Deleting _local docs with bulkDocs, not found
    ✓ Deleting _local docs with bulkDocs, wrong rev
    ✓ Bulk with new_edits=false
    ✓ Testing successive new_edits to the same doc
    ✓ #3062 bulkDocs with staggered seqs
    ✓ Testing successive new_edits to the same doc, different content
    ✓ Testing successive new_edits to two doc
    ✓ Deletion with new_edits=false
    ✓ Deletion with new_edits=false, no history
    ✓ Modification with new_edits=false, no history
    ✓ Deletion with new_edits=false, no history, no revisions
    ✓ Testing new_edits=false in req body
    ✓ 656 regression in handling deleted docs
    ✓ Test quotes in doc ids
    ✓ Bulk docs empty list
    ✓ handles simultaneous writes
    ✓ bulk docs input by array
    ✓ Bulk empty list
    ✓ Bulk docs not an array
    ✓ Bulk docs not an object (135ms)
    ✓ Bulk docs two different revisions to same document id
    ✓ 4204 respect revs_limit (268ms)
    ✓ 2839 implement revs_limit (184ms)
    ✓ 4372 revs_limit deletes old revisions of the doc
    ✓ 4372 revs_limit with auto_compaction deletes old revisions of the doc
    ✓ 4712 invalid rev for new doc generates conflict
    ✓ 5793 bulk docs accepts _conflicts when new_edits=false

  test.bulk_docs.js-http
    ✓ Testing bulk docs (45ms)
    ✓ #6039 test id in bulk docs for conflict
    ✓ No id in bulk docs
    ✓ No _rev and new_edits=false
    ✓ 7829 bare rev 1- with new_edits=false
    ✓ Test empty bulkDocs
    ✓ Test many bulkDocs (41ms)
    ✓ Test errors on invalid doc id
    ✓ Test two errors on invalid doc id
    ✓ No docs
    ✓ Jira 911
    ✓ Test multiple bulkdocs
    ✓ #2935 new_edits=false correct number
    ✓ #2935 new_edits=false correct number 2
    ✓ bulk docs update then delete then conflict
    ✓ bulk_docs delete then undelete
    ✓ #2935 new_edits=false with single unauthorized
    ✓ Deleting _local docs with bulkDocs
    ✓ Bulk with new_edits=false
    ✓ Testing successive new_edits to the same doc
    ✓ #3062 bulkDocs with staggered seqs
    ✓ Testing successive new_edits to the same doc, different content
    ✓ Testing successive new_edits to two doc
    ✓ Deletion with new_edits=false
    ✓ Deletion with new_edits=false, no history
    ✓ Modification with new_edits=false, no history
    ✓ Deletion with new_edits=false, no history, no revisions
    ✓ Testing new_edits=false in req body
    ✓ 656 regression in handling deleted docs
    ✓ Test quotes in doc ids
    ✓ Bulk docs empty list
    ✓ handles simultaneous writes
    ✓ bulk docs input by array
    ✓ Bulk empty list
    ✓ Bulk docs not an array
    ✓ Bulk docs not an object
    ✓ Bulk docs two different revisions to same document id
    ✓ 4204 respect revs_limit (304ms)
    ✓ 2839 implement revs_limit
    ✓ 4372 revs_limit deletes old revisions of the doc
    ✓ 4372 revs_limit with auto_compaction deletes old revisions of the doc
    ✓ 4712 invalid rev for new doc generates conflict
    ✓ 5793 bulk docs accepts _conflicts when new_edits=false (38ms)

  test.bulk_get.js-http
    ✓ test bulk get with rev specified
    ✓ test bulk get with latest=true
    ✓ test bulk get with no rev specified
    ✓ _revisions is not returned by default
    ✓ #5886 bulkGet with reserved id
    ✓ _revisions is returned when specified
    ✓ _revisions is returned when specified, using implicit rev
    ✓ attachments are not included by default
    ✓ attachments are included when specified
    ✓ attachments are included when specified, using implicit rev

  test.bulk_get.js-local
    ✓ test bulk get with rev specified
    ✓ test bulk get with latest=true
    ✓ test bulk get with no rev specified
    ✓ _revisions is not returned by default
    ✓ #5886 bulkGet with reserved id
    ✓ _revisions is returned when specified
    ✓ _revisions is returned when specified, using implicit rev
    ✓ attachments are not included by default
    ✓ attachments are included when specified
    ✓ attachments are included when specified, using implicit rev

  test.changes.js-http
    ✓ All changes
    ✓ Changes with complete callback as param
    ✓ Promise resolved when changes cancelled
    - Live changes should clean listener when cancelled
    ✓ Changes Since
    ✓ Changes Since and limit limit 1
    ✓ Changes Since and limit limit 0
    ✓ Changes limit
    ✓ Changes with filter not present in ddoc
    ✓ Changes with `filters` key not present in ddoc
    ✓ Changes limit and filter
    ✓ Changes with shorthand function name
    ✓ Changes with filter from nonexistent ddoc
    ✓ Changes with view not present in ddoc
    ✓ Changes with `views` key not present in ddoc
    ✓ #4451 Changes with invalid view filter
    ✓ 3356 throw inside a filter
    ✓ Changes with missing param `view` in request
    ✓ Changes limit and view instead of filter
    ✓ #3609 view option implies filter: _view
    ✓ Immediately cancel changes
    ✓ Changes with invalid ddoc view name
    ✓ Changes with invalid ddoc view name 2
    ✓ Changes with style = all_docs (68ms)
    ✓ Changes with style = all_docs and a callback for complete (60ms)
    ✓ Changes limit = 0
    ✓ Changes doc
    - Descending many changes
    ✓ live-changes
    ✓ Multiple watchers
    ✓ Continuous changes doc
    ✓ Cancel changes (325ms)
    ✓ #3579 changes firing 1 too many times (78ms)
    ✓ Kill database while listening to live changes
    ✓ #3136 style=all_docs
    ✓ #4191 revs_diff causes endless loop
    ✓ #3136 style=all_docs & include_docs
    ✓ changes-filter with query params
    ✓ Non-live changes filter
    ✓ Non-live changes filter, descending
    ✓ #2569 Non-live doc_ids filter
    ✓ #2569 Big non-live doc_ids filter
    ✓ #2569 Live doc_ids filter
    ✓ #2569 Big live doc_ids filter
    ✓ #2569 Non-live doc_ids filter with filter=_doc_ids
    ✓ #2569 Live doc_ids filter with filter=_doc_ids
    ✓ Changes to same doc are grouped
    ✓ Changes with conflicts are handled correctly (135ms)
    ✓ Change entry for a deleted doc
    ✓ changes large number of docs (45ms)
    ✓ Calling db.changes({since: 'now'})
    ✓ Calling db.changes({since: 'latest'})
    ✓ Closing db does not cause a crash if changes cancelled
    ✓ fire-complete-on-cancel (101ms)
    ✓ changes are not duplicated (1022ms)
    ✓ supports return_docs=false
    ✓ should respects limit (71ms)
    ✓ doesn't throw if opts.complete is undefined
    ✓ handle individual changes in live replication (194ms)
    ✓ changes-filter without filter
    ✓ #3539 - Exception in changes is fine
    ✓ Changes with selector
    ✓ Changes with selector, explicit filter
    ✓ Changes with selector and mismatched filter
    ✓ Changes with limit and selector

  test.changes.js-local
    ✓ All changes
    ✓ Changes with complete callback as param
    ✓ Promise resolved when changes cancelled
    - Live changes should clean listener when cancelled
    ✓ Changes Since
    ✓ Changes Since and limit limit 1
    ✓ Changes Since and limit limit 0
    ✓ Changes limit
    ✓ Changes with filter not present in ddoc
    ✓ Changes with `filters` key not present in ddoc
    ✓ Changes limit and filter
    ✓ Changes with shorthand function name
    ✓ Changes with filter from nonexistent ddoc
    ✓ Changes with view not present in ddoc
    ✓ Changes with `views` key not present in ddoc
    ✓ #4451 Changes with invalid view filter
    ✓ 3356 throw inside a filter
    ✓ Changes with missing param `view` in request
    ✓ Changes limit and view instead of filter
    ✓ #3609 view option implies filter: _view
    ✓ Immediately cancel changes
    ✓ Changes with invalid ddoc view name
    ✓ Changes with invalid ddoc view name 2
    ✓ Changes with style = all_docs
    ✓ Changes with style = all_docs and a callback for complete
    ✓ Changes limit = 0
    ✓ Changes doc
    - Descending many changes
    ✓ live-changes
    ✓ Multiple watchers
    ✓ Continuous changes doc
    ✓ Cancel changes (317ms)
    ✓ #3579 changes firing 1 too many times (68ms)
    ✓ Kill database while listening to live changes
    ✓ #3136 style=all_docs
    ✓ #4191 revs_diff causes endless loop
    ✓ #3136 style=all_docs & include_docs
    ✓ changes-filter with query params
    ✓ Non-live changes filter
    ✓ Non-live changes filter, descending
    ✓ #2569 Non-live doc_ids filter
    ✓ #2569 Big non-live doc_ids filter
    ✓ #2569 Live doc_ids filter
    ✓ #2569 Big live doc_ids filter
    ✓ #2569 Non-live doc_ids filter with filter=_doc_ids
    ✓ #2569 Live doc_ids filter with filter=_doc_ids
    ✓ Changes to same doc are grouped
    ✓ Changes with conflicts are handled correctly
    ✓ Change entry for a deleted doc
    ✓ changes large number of docs
    ✓ Calling db.changes({since: 'now'})
    ✓ Calling db.changes({since: 'latest'})
    ✓ Closing db does not cause a crash if changes cancelled
    ✓ fire-complete-on-cancel (101ms)
    ✓ changes are not duplicated (1016ms)
    ✓ supports return_docs=false
    ✓ should respects limit (66ms)
    ✓ doesn't throw if opts.complete is undefined
    ✓ handle individual changes in live replication (71ms)
    ✓ changes-filter without filter
    ✓ #3539 - Exception in changes is fine
    ✓ Changes with selector
    ✓ Changes with selector, explicit filter
    ✓ Changes with selector and mismatched filter
    ✓ Changes with limit and selector

  changes-standalone
    - Changes reports errors

  test.close.js-local
    ✓ should emit destroyed even when closed (sync)
    ✓ should emit destroyed even when closed (async)
precondition_failed: Database not open
    at Object.<anonymous> (/data/js-variants/multee/Clients/levelup/pouchdb/packages/node_modules/pouchdb/lib/index.js:614:16)
    at Module._compile (node:internal/modules/cjs/loader:1105:14)
    at Module._extensions..js (node:internal/modules/cjs/loader:1159:10)
    at Module.load (node:internal/modules/cjs/loader:981:32)
    at Module._load (node:internal/modules/cjs/loader:827:12)
    at Module.require (node:internal/modules/cjs/loader:1005:19)
    at require (node:internal/modules/cjs/helpers:102:18)
    at commonUtils.loadPouchDBForNode (/data/js-variants/multee/Clients/levelup/pouchdb/tests/common-utils.js:92:17)
    at commonUtils.loadPouchDB (/data/js-variants/multee/Clients/levelup/pouchdb/tests/common-utils.js:78:39)
    at Object.<anonymous> (/data/js-variants/multee/Clients/levelup/pouchdb/tests/integration/node.setup.js:21:28)
    at Module._compile (node:internal/modules/cjs/loader:1105:14)
    at Module._extensions..js (node:internal/modules/cjs/loader:1159:10)
    at Module.load (node:internal/modules/cjs/loader:981:32)
    at Module._load (node:internal/modules/cjs/loader:827:12)
    at Module.require (node:internal/modules/cjs/loader:1005:19)
    at require (node:internal/modules/cjs/helpers:102:18)
    at /data/js-variants/multee/Clients/levelup/pouchdb/node_modules/mocha/bin/_mocha:366:3
    at Array.forEach (<anonymous>)
    at Object.<anonymous> (/data/js-variants/multee/Clients/levelup/pouchdb/node_modules/mocha/bin/_mocha:365:10)
    at Module._compile (node:internal/modules/cjs/loader:1105:14)
    at Module._extensions..js (node:internal/modules/cjs/loader:1159:10)
    at Module.load (node:internal/modules/cjs/loader:981:32)
    at Module._load (node:internal/modules/cjs/loader:827:12)
    at Function.executeUserEntryPoint [as runMain] (node:internal/modules/run_main:77:12)
    at node:internal/main/run_main_module:17:47
    ✓ should emit closed even when destroyed (async #2)
precondition_failed: Database not open
    at Object.<anonymous> (/data/js-variants/multee/Clients/levelup/pouchdb/packages/node_modules/pouchdb/lib/index.js:614:16)
    at Module._compile (node:internal/modules/cjs/loader:1105:14)
    at Module._extensions..js (node:internal/modules/cjs/loader:1159:10)
    at Module.load (node:internal/modules/cjs/loader:981:32)
    at Module._load (node:internal/modules/cjs/loader:827:12)
    at Module.require (node:internal/modules/cjs/loader:1005:19)
    at require (node:internal/modules/cjs/helpers:102:18)
    at commonUtils.loadPouchDBForNode (/data/js-variants/multee/Clients/levelup/pouchdb/tests/common-utils.js:92:17)
    at commonUtils.loadPouchDB (/data/js-variants/multee/Clients/levelup/pouchdb/tests/common-utils.js:78:39)
    at Object.<anonymous> (/data/js-variants/multee/Clients/levelup/pouchdb/tests/integration/node.setup.js:21:28)
    at Module._compile (node:internal/modules/cjs/loader:1105:14)
    at Module._extensions..js (node:internal/modules/cjs/loader:1159:10)
    at Module.load (node:internal/modules/cjs/loader:981:32)
    at Module._load (node:internal/modules/cjs/loader:827:12)
    at Module.require (node:internal/modules/cjs/loader:1005:19)
    at require (node:internal/modules/cjs/helpers:102:18)
    at /data/js-variants/multee/Clients/levelup/pouchdb/node_modules/mocha/bin/_mocha:366:3
    at Array.forEach (<anonymous>)
    at Object.<anonymous> (/data/js-variants/multee/Clients/levelup/pouchdb/node_modules/mocha/bin/_mocha:365:10)
    at Module._compile (node:internal/modules/cjs/loader:1105:14)
    at Module._extensions..js (node:internal/modules/cjs/loader:1159:10)
    at Module.load (node:internal/modules/cjs/loader:981:32)
    at Module._load (node:internal/modules/cjs/loader:827:12)
    at Function.executeUserEntryPoint [as runMain] (node:internal/modules/run_main:77:12)
    at node:internal/main/run_main_module:17:47
    ✓ test unref for coverage
    ✓ test double unref for coverage
precondition_failed: Database not open
    at Object.<anonymous> (/data/js-variants/multee/Clients/levelup/pouchdb/packages/node_modules/pouchdb/lib/index.js:614:16)
    at Module._compile (node:internal/modules/cjs/loader:1105:14)
    at Module._extensions..js (node:internal/modules/cjs/loader:1159:10)
    at Module.load (node:internal/modules/cjs/loader:981:32)
    at Module._load (node:internal/modules/cjs/loader:827:12)
    at Module.require (node:internal/modules/cjs/loader:1005:19)
    at require (node:internal/modules/cjs/helpers:102:18)
    at commonUtils.loadPouchDBForNode (/data/js-variants/multee/Clients/levelup/pouchdb/tests/common-utils.js:92:17)
    at commonUtils.loadPouchDB (/data/js-variants/multee/Clients/levelup/pouchdb/tests/common-utils.js:78:39)
    at Object.<anonymous> (/data/js-variants/multee/Clients/levelup/pouchdb/tests/integration/node.setup.js:21:28)
    at Module._compile (node:internal/modules/cjs/loader:1105:14)
    at Module._extensions..js (node:internal/modules/cjs/loader:1159:10)
    at Module.load (node:internal/modules/cjs/loader:981:32)
    at Module._load (node:internal/modules/cjs/loader:827:12)
    at Module.require (node:internal/modules/cjs/loader:1005:19)
    at require (node:internal/modules/cjs/helpers:102:18)
    at /data/js-variants/multee/Clients/levelup/pouchdb/node_modules/mocha/bin/_mocha:366:3
    at Array.forEach (<anonymous>)
    at Object.<anonymous> (/data/js-variants/multee/Clients/levelup/pouchdb/node_modules/mocha/bin/_mocha:365:10)
    at Module._compile (node:internal/modules/cjs/loader:1105:14)
    at Module._extensions..js (node:internal/modules/cjs/loader:1159:10)
    at Module.load (node:internal/modules/cjs/loader:981:32)
    at Module._load (node:internal/modules/cjs/loader:827:12)
    at Function.executeUserEntryPoint [as runMain] (node:internal/modules/run_main:77:12)
    at node:internal/main/run_main_module:17:47
    ✓ test close-then-destroyed for coverage
************* run test done *************
pouchdb is testing ./Variants/levelup/variant11/levelup
/data/js-variants/multee
************* npm unlink module *************

removed 1 package, changed 1 package, and audited 1032 packages in 3s

64 packages are looking for funding
  run `npm fund` for details

41 vulnerabilities (1 low, 9 moderate, 25 high, 6 critical)

To address issues that do not require attention, run:
  npm audit fix

To address all issues possible (including breaking changes), run:
  npm audit fix --force

Some issues need review, and may require choosing
a different dependency.

Run `npm audit` for details.
************* npm unlink module done *************
************* npm unlink globally *************

removed 1 package, and audited 1 package in 1s

found 0 vulnerabilities
************* npm unlink globally done *************
************* npm link globally *************

added 1 package, and audited 3 packages in 415ms

found 0 vulnerabilities
************* npm link globally done *************
************* npm link module *************

added 1 package, changed 1 package, and audited 1034 packages in 4s

64 packages are looking for funding
  run `npm fund` for details

41 vulnerabilities (1 low, 9 moderate, 25 high, 6 critical)

To address issues that do not require attention, run:
  npm audit fix

To address all issues possible (including breaking changes), run:
  npm audit fix --force

Some issues need review, and may require choosing
a different dependency.

Run `npm audit` for details.
************* npm link module done *************
************* start run test *************

> pouchdb-monorepo@7.0.0-prerelease test
> bash bin/run-test.sh


> pouchdb-monorepo@7.0.0-prerelease build-node
> bash bin/build-node.sh


> pouchdb-monorepo@7.0.0-prerelease build-modules
> node bin/build-modules.js

Building pouchdb...
Building pouchdb-abstract-mapreduce...
Building pouchdb-adapter-http...
Building pouchdb-adapter-idb...
Building pouchdb-adapter-indexeddb...
Building pouchdb-adapter-leveldb...
Building pouchdb-adapter-leveldb-core...
Building pouchdb-adapter-localstorage...
Building pouchdb-adapter-memory...
Building pouchdb-adapter-utils...
Building pouchdb-binary-utils...
Building pouchdb-browser...
Building pouchdb-changes-filter...
Building pouchdb-checkpointer...
Building pouchdb-collate...
Building pouchdb-collections...
Building pouchdb-core...
Building pouchdb-errors...
Building pouchdb-fetch...
Building pouchdb-find...
Building pouchdb-for-coverage...
Building pouchdb-generate-replication-id...
Building pouchdb-json...
Building pouchdb-mapreduce...
Building pouchdb-mapreduce-utils...
Building pouchdb-md5...
Building pouchdb-merge...
Building pouchdb-node...
Building pouchdb-replication...
Building pouchdb-selector-core...
Building pouchdb-utils...
Building sublevel-pouchdb...
  ✓ wrote pouchdb-adapter-localstorage/lib/index.js in vanilla mode
  ✓ wrote pouchdb-adapter-localstorage/lib/index.es.js in vanilla mode
  ✓ wrote pouchdb-adapter-memory/lib/index.js in vanilla mode
  ✓ wrote pouchdb-adapter-memory/lib/index.es.js in vanilla mode
  ✓ wrote pouchdb-checkpointer/lib/index.js in vanilla mode
  ✓ wrote pouchdb-checkpointer/lib/index.es.js in vanilla mode
  ✓ wrote pouchdb-errors/lib/index.js in vanilla mode
  ✓ wrote pouchdb-errors/lib/index.es.js in vanilla mode
  ✓ wrote pouchdb-generate-replication-id/lib/index.js in vanilla mode
  ✓ wrote pouchdb-generate-replication-id/lib/index.es.js in vanilla mode
  ✓ wrote pouchdb-adapter-http/lib/index.js in vanilla mode
  ✓ wrote pouchdb-adapter-leveldb/lib/index.js in node mode
  ✓ wrote pouchdb-adapter-http/lib/index.es.js in vanilla mode
  ✓ wrote pouchdb-adapter-leveldb/lib/index.es.js in node mode
  ✓ wrote pouchdb-adapter-leveldb/lib/index-browser.js in browser mode
  ✓ wrote pouchdb-adapter-leveldb/lib/index-browser.es.js in browser mode
  ✓ wrote pouchdb-adapter-leveldb-core/lib/index.js in node mode
  ✓ wrote pouchdb-adapter-leveldb-core/lib/index.es.js in node mode
  ✓ wrote pouchdb-adapter-leveldb-core/lib/index-browser.js in browser mode
  ✓ wrote pouchdb-adapter-leveldb-core/lib/index-browser.es.js in browser mode
  ✓ wrote pouchdb-changes-filter/lib/index-browser.js in browser mode
  ✓ wrote pouchdb-changes-filter/lib/index-browser.es.js in browser mode
  ✓ wrote pouchdb-fetch/lib/index-browser.js in browser mode
  ✓ wrote pouchdb-fetch/lib/index-browser.es.js in browser mode
  ✓ wrote pouchdb-md5/lib/index-browser.js in browser mode
  ✓ wrote pouchdb-md5/lib/index-browser.es.js in browser mode
  ✓ wrote pouchdb-changes-filter/lib/index.js in node mode
  ✓ wrote pouchdb-changes-filter/lib/index.es.js in node mode
  ✓ wrote pouchdb-collate/lib/index.js in vanilla mode
  ✓ wrote pouchdb-collate/lib/index.es.js in vanilla mode
  ✓ wrote pouchdb-fetch/lib/index.js in node mode
  ✓ wrote pouchdb-fetch/lib/index.es.js in node mode
  ✓ wrote pouchdb-json/lib/index.js in vanilla mode
  ✓ wrote pouchdb-json/lib/index.es.js in vanilla mode
  ✓ wrote pouchdb-mapreduce-utils/lib/index.js in vanilla mode
  ✓ wrote pouchdb-mapreduce-utils/lib/index.es.js in vanilla mode
  ✓ wrote pouchdb-md5/lib/index.js in node mode
  ✓ wrote pouchdb-md5/lib/index.es.js in node mode
  ✓ wrote pouchdb-abstract-mapreduce/lib/index.js in vanilla mode
  ✓ wrote pouchdb-abstract-mapreduce/lib/index.es.js in vanilla mode
  ✓ wrote pouchdb-adapter-idb/lib/index.js in vanilla mode
  ✓ wrote pouchdb-adapter-idb/lib/index.es.js in vanilla mode
  ✓ wrote pouchdb-adapter-indexeddb/lib/index.js in vanilla mode
  ✓ wrote pouchdb-adapter-indexeddb/lib/index.es.js in vanilla mode
  ✓ wrote pouchdb-binary-utils/lib/index-browser.js in browser mode
  ✓ wrote pouchdb-binary-utils/lib/index-browser.es.js in browser mode
  ✓ wrote pouchdb-utils/lib/index-browser.js in browser mode
  ✓ wrote pouchdb-utils/lib/index.js in node mode
  ✓ wrote pouchdb-utils/lib/index-browser.es.js in browser mode
  ✓ wrote pouchdb-utils/lib/index.es.js in node mode
  ✓ wrote pouchdb-adapter-utils/lib/index.js in vanilla mode
  ✓ wrote pouchdb-adapter-utils/lib/index.es.js in vanilla mode
  ✓ wrote pouchdb-binary-utils/lib/index.js in node mode
  ✓ wrote pouchdb-binary-utils/lib/index.es.js in node mode
  ✓ wrote pouchdb-collections/lib/index.js in vanilla mode
  ✓ wrote pouchdb-collections/lib/index.es.js in vanilla mode
  ✓ wrote pouchdb-merge/lib/index.js in vanilla mode
  ✓ wrote pouchdb-merge/lib/index.es.js in vanilla mode
  ✓ wrote pouchdb-selector-core/lib/index.js in vanilla mode
  ✓ wrote pouchdb-selector-core/lib/index.es.js in vanilla mode
  ✓ wrote sublevel-pouchdb/lib/index.js in vanilla mode
  ✓ wrote sublevel-pouchdb/lib/index.es.js in vanilla mode
  ✓ wrote pouchdb-mapreduce/lib/index-browser.js in browser mode
  ✓ wrote pouchdb-mapreduce/lib/index-browser.es.js in browser mode
  ✓ wrote pouchdb-replication/lib/index.js in vanilla mode
  ✓ wrote pouchdb-replication/lib/index.es.js in vanilla mode
  ✓ wrote pouchdb-mapreduce/lib/index.js in node mode
  ✓ wrote pouchdb-mapreduce/lib/index.es.js in node mode
  ✓ wrote pouchdb-core/lib/index.js in vanilla mode
  ✓ wrote pouchdb-core/lib/index.es.js in vanilla mode
  ✓ wrote pouchdb-find/lib/index.js in node mode
  ✓ wrote pouchdb-find/lib/index.es.js in node mode
  ✓ wrote pouchdb-find/lib/index-browser.js in browser mode
  ✓ wrote pouchdb-find/lib/index-browser.es.js in browser mode
  ✓ wrote pouchdb-node/lib/index.js in vanilla mode
  ✓ wrote pouchdb-node/lib/index.es.js in vanilla mode
  ✓ wrote pouchdb-browser/lib/index.js in vanilla mode
  ✓ wrote pouchdb-browser/lib/index.es.js in vanilla mode
  ✓ wrote packages/node_modules/pouchdb/lib/index.js
  ✓ wrote packages/node_modules/pouchdb/lib/index.es.js
  ✓ wrote pouchdb-for-coverage/lib/index-browser.js in browser mode
  ✓ wrote pouchdb-for-coverage/lib/index-browser.es.js in browser mode
  ✓ wrote pouchdb-for-coverage/lib/index.js in node mode
  ✓ wrote pouchdb-for-coverage/lib/index.es.js in node mode
Waiting for host to start ..
Host started :)
> pouchdb-monorepo@7.0.0-prerelease test-node
> bash bin/test-node.sh

Down server listening on port 3010
Seeded with: 1660142854902


  DB Setup
    ✓ PouchDB has a version
    ✓ PouchDB version matches package.json

  test.active_tasks.js
    ✓ Can add a task
    ✓ Can get tasks by id
    ✓ Can get all tasks
    ✓ Can update a task
    ✓ Can remove a task

  test.all_docs.js-http
    ✓ Testing all docs (163ms)
    ✓ Testing allDocs opts.keys (60ms)
    ✓ Testing allDocs opts.keys with skip
    ✓ Testing allDocs opts.keys with limit (41ms)
    ✓ Testing allDocs invalid opts.keys
    ✓ Testing deleting in changes (47ms)
    ✓ Testing updating in changes (49ms)
    ✓ Testing include docs (43ms)
    ✓ Testing conflicts (57ms)
    ✓ test basic collation
    ✓ 3883 start_key end_key aliases
    ✓ test total_rows with a variety of criteria (149ms)
    ✓ test total_rows with both skip and limit (40ms)
    ✓ test limit option and total_rows
    ✓ test escaped startkey/endkey
    ✓ test "key" option
    ✓ test inclusive_end=false (55ms)
    ✓ test descending with startkey/endkey
    ✓ #3082 test wrong num results returned (337ms)
    ✓ test empty db
    ✓ test after db close
    ✓ 5793 _conflicts should not exist if no conflicts
    ✓ #6230 Test allDocs opts update_seq: false
    ✓ #6230 Test allDocs opts update_seq: true
    ✓ #6230 Test allDocs opts with update_seq missing

  test.all_docs.js-local
    ✓ Testing all docs
    ✓ Testing allDocs opts.keys
    ✓ Testing allDocs opts.keys with skip
    ✓ Testing allDocs opts.keys with limit
    ✓ Testing allDocs invalid opts.keys
    ✓ Testing deleting in changes
    ✓ Testing updating in changes
    ✓ Testing include docs
    ✓ Testing conflicts
    ✓ test basic collation
    ✓ 3883 start_key end_key aliases
    ✓ test total_rows with a variety of criteria
    ✓ test total_rows with both skip and limit
    ✓ test limit option and total_rows
    ✓ test escaped startkey/endkey
    ✓ test "key" option
    ✓ test inclusive_end=false
    ✓ test descending with startkey/endkey
    ✓ #3082 test wrong num results returned (193ms)
    ✓ test empty db
    ✓ test after db close
    ✓ test unicode ids and revs
    ✓ 5793 _conflicts should not exist if no conflicts
    ✓ #6230 Test allDocs opts update_seq: false
    ✓ #6230 Test allDocs opts update_seq: true
    ✓ #6230 Test allDocs opts with update_seq missing

  suite2 test.attachments.js-local
    ✓ 3357 Attachment names cant start with _
    ✓ 5736 warning for putAttachment without content_type
    ✓ 5736 warning for bulkDocs attachments without content_type
    ✓ fetch atts with open_revs and missing
    ✓ issue 2803 should throw 412
    ✓ issue 2803 should throw 412 part 2
    ✓ issue 2803 should throw 412 part 3
    ✓ issue 2803 should throw 412 part 4
    ✓ #2858 {binary: true} in get()
    ✓ #2858 {binary: true} in allDocs() 1
    ✓ #2858 {binary: true} in allDocs() 2
    ✓ #2858 {binary: true} in allDocs() 3
    ✓ #2858 {binary: true} in allDocs() 4
    ✓ #2858 {binary: true} in allDocs() 5
    ✓ #2858 {binary: true} in allDocs(), many atts
    ✓ #2858 {binary: true} in allDocs(), mixed atts
    ✓ #2858 {binary: true} in changes() non-live
    ✓ #2858 {binary: true} in changes() non-live, many atts
    ✓ #2858 {binary: true} in changes() non-live, mixed atts
    ✓ #2858 {binary: true} non-live changes, complete event
    ✓ #2858 {binary: true} in live changes
    ✓ #2858 {binary: true} in live changes, mixed atts
    ✓ #2858 {binary: true} in live+retry changes
    ✓ #2858 {binary: true} in live changes, attachments:false
    ✓ #2858 {binary: true} in live changes, include_docs:false
    ✓ #6736 {binary: true} in bulkGet()
    ✓ Measures length correctly after put()
    ✓ #3074 non-live changes()
    ✓ #3074 live changes()
    ✓ #3074 non-live changes(), no attachments
    ✓ #3074 live changes(), no attachments
    ✓ #3881 filter extraneous keys from _attachments
    ✓ #2771 allDocs() 1, single attachment
    ✓ #2771 allDocs() 2, many docs same att
    ✓ #2771 allDocs() 3, many docs diff atts
    ✓ #2771 allDocs() 4, mix of atts and no atts
    ✓ #2771 allDocs() 5, no atts
    ✓ #2771 allDocs() 6, no docs
    ✓ #2771 allDocs() 7, revisions and deletions
    ✓ #2771 allDocs() 8, empty attachment
    ✓ No length for non-stubs
    ✓ Test some attachments
    ✓ Test getAttachment
    ✓ Test getAttachment with stubs
    ✓ Test get() with binary:true and stubs
    ✓ Test attachments in allDocs/changes
    ✓ Test putAttachment with base64 plaintext
    ✓ Test putAttachment with invalid base64
    ✓ Test getAttachment with empty text
    ✓ Test getAttachment with normal text
    ✓ Test getAttachment with PNG
    ✓ Test getAttachment with PNG using bulkDocs
    ✓ Test getAttachment with PNG using post
    ✓ Test postAttachment with PNG then bulkDocs
    ✓ proper stub behavior
    ✓ Testing with invalid docs
    ✓ Test create attachment and doc in one go
    ✓ Test create attachment and doc in one go without callback
    ✓ Test create attachment without callback
    ✓ Test put attachment on a doc without attachments
    ✓ Test put attachment with unencoded name
    ✓ 3963 length property on stubs
    ✓ Testing with invalid rev
    ✓ Test put another attachment on a doc with attachments
    ✓ Test get with attachments: true if empty attachments
    ✓ Test delete attachment from a doc
    ✓ Test a document with a json string attachment
    ✓ Test remove doc with attachment
    ✓ Try to insert a doc with unencoded attachment
    ✓ Try to get attachment of unexistent doc
    ✓ Test synchronous putAttachment with text data
    ✓ Test synchronous putAttachment with no text data
    ✓ Test put with partial stubs
    ✓ Test put with attachments and new_edits=false
    ✓ Test getAttachment with specific rev
    ✓ Test getAttachment with diff revs and content
    ✓ Test stubs
    ✓ Try to get unexistent attachment of some doc
    ✓ putAttachment and getAttachment with plaintext
    ✓ putAttachment and getAttachment with png data
    ✓ putAttachment in new doc with base64
    ✓ #2818 - save same attachment in different revs
    ✓ #2818 - save same attachment many times in parallel
    ✓ #2818 - revisions keep attachments (no compaction)
    ✓ #2818 - doesn't throw 409 if same filename
    ✓ #3008 test correct encoding/decoding of \u0000 etc.
    ✓ putAttachment and getAttachment with big png data (92ms)
    ✓ #2709 `revpos` with putAttachment
    ✓ #2709 `revpos` with inline attachment
    ✓ #2709 `revpos` with allDocs
    ✓ #7403 {attachments: true, binary: true, include_docs: true} in allDocs with one missing doc

  suite2 test.attachments.js-http
    ✓ 3357 Attachment names cant start with _
    ✓ 5736 warning for putAttachment without content_type
    ✓ 5736 warning for bulkDocs attachments without content_type
    ✓ fetch atts with open_revs and missing
    ✓ issue 2803 should throw 412
    ✓ issue 2803 should throw 412 part 2
    ✓ issue 2803 should throw 412 part 3
    ✓ issue 2803 should throw 412 part 4
    ✓ #2858 {binary: true} in get()
    ✓ #2858 {binary: true} in allDocs() 1
    ✓ #2858 {binary: true} in allDocs() 2
    ✓ #2858 {binary: true} in allDocs() 3
    ✓ #2858 {binary: true} in allDocs() 4
    ✓ #2858 {binary: true} in allDocs() 5
    ✓ #2858 {binary: true} in allDocs(), many atts
    ✓ #2858 {binary: true} in allDocs(), mixed atts
    ✓ #2858 {binary: true} in changes() non-live
    ✓ #2858 {binary: true} in changes() non-live, many atts
    ✓ #2858 {binary: true} in changes() non-live, mixed atts
    ✓ #2858 {binary: true} non-live changes, complete event
    ✓ #2858 {binary: true} in live changes
    ✓ #2858 {binary: true} in live changes, mixed atts
    ✓ #2858 {binary: true} in live+retry changes
    ✓ #2858 {binary: true} in live changes, attachments:false
    ✓ #2858 {binary: true} in live changes, include_docs:false
    ✓ #6736 {binary: true} in bulkGet()
    ✓ Measures length correctly after put()
    ✓ #3074 non-live changes() (44ms)
    ✓ #3074 live changes()
    ✓ #3074 non-live changes(), no attachments
    ✓ #3074 live changes(), no attachments
    ✓ #3881 filter extraneous keys from _attachments
    ✓ #2771 allDocs() 1, single attachment
    ✓ #2771 allDocs() 2, many docs same att
    ✓ #2771 allDocs() 3, many docs diff atts
    ✓ #2771 allDocs() 4, mix of atts and no atts (38ms)
    ✓ #2771 allDocs() 5, no atts
    ✓ #2771 allDocs() 6, no docs
    ✓ #2771 allDocs() 7, revisions and deletions
    ✓ #2771 allDocs() 8, empty attachment
    ✓ No length for non-stubs
    ✓ Test some attachments (46ms)
    ✓ Test getAttachment
    ✓ Test getAttachment with stubs (52ms)
    ✓ Test get() with binary:true and stubs
    ✓ Test attachments in allDocs/changes
    ✓ Test putAttachment with base64 plaintext
    ✓ Test putAttachment with invalid base64
    ✓ Test getAttachment with empty text
    ✓ Test getAttachment with normal text
    ✓ Test getAttachment with PNG
    ✓ Test getAttachment with PNG using bulkDocs
    ✓ Test getAttachment with PNG using post
    ✓ Test postAttachment with PNG then bulkDocs
    ✓ proper stub behavior
    ✓ Testing with invalid docs
    ✓ Test create attachment and doc in one go
    ✓ Test create attachment and doc in one go without callback
    ✓ Test create attachment without callback
    ✓ Test put attachment on a doc without attachments
    ✓ Test put attachment with unencoded name
    ✓ 3963 length property on stubs (48ms)
    ✓ Testing with invalid rev
    ✓ Test put another attachment on a doc with attachments
    ✓ Test get with attachments: true if empty attachments
    ✓ Test delete attachment from a doc (39ms)
    ✓ Test a document with a json string attachment
    ✓ Test remove doc with attachment
    ✓ Try to insert a doc with unencoded attachment
    ✓ Try to get attachment of unexistent doc
    ✓ Test synchronous putAttachment with text data
    ✓ Test synchronous putAttachment with no text data
    ✓ Test put with partial stubs
    ✓ Test put with attachments and new_edits=false
    ✓ Test getAttachment with specific rev (38ms)
    ✓ Test getAttachment with diff revs and content
    ✓ Test stubs
    ✓ Try to get unexistent attachment of some doc
    ✓ putAttachment and getAttachment with plaintext
    ✓ putAttachment and getAttachment with png data
    ✓ putAttachment in new doc with base64
    ✓ #2818 - save same attachment in different revs (50ms)
    ✓ #2818 - save same attachment many times in parallel
    ✓ #2818 - revisions keep attachments (no compaction) (40ms)
    ✓ #2818 - doesn't throw 409 if same filename
    ✓ #3008 test correct encoding/decoding of \u0000 etc.
    ✓ putAttachment and getAttachment with big png data (128ms)
    ✓ #2709 `revpos` with putAttachment (42ms)
    ✓ #2709 `revpos` with inline attachment (39ms)
    ✓ #2709 `revpos` with allDocs
    ✓ #7403 {attachments: true, binary: true, include_docs: true} in allDocs with one missing doc

  suite2 test.attachments.js- local:http
    ✓ Attachments replicate back and forth (115ms)
    ✓ Replicate same doc, same atts (111ms)
    ✓ Replicate same doc, same atts 2 (132ms)
    ✓ Attachments replicate (113ms)
    ✓ Attachment types replicate (102ms)
    ✓ Many many attachments replicate (193ms)
    ✓ Many many png attachments replicate (210ms)
    ✓ Multiple attachments replicate (83ms)
    - #3961 Many attachments on same doc
    ✓ Multiple attachments replicate, different docs (#2698) (87ms)
    ✓ Multiple attachments replicate, different docs png (#2698) (74ms)
    ✓ #3932 attachments with tricky revpos (141ms)
    ✓ replication with changing attachments (99ms)
    ✓ 3955 race condition in put
    ✓ #8456 bad attachment rev after replication (119ms)

  suite2 test.attachments.js- http:http
    ✓ Attachments replicate back and forth (156ms)
    ✓ Replicate same doc, same atts (174ms)
    ✓ Replicate same doc, same atts 2 (168ms)
    ✓ Attachments replicate (82ms)
    ✓ Attachment types replicate (163ms)
    ✓ Many many attachments replicate (369ms)
    ✓ Many many png attachments replicate (292ms)
    ✓ Multiple attachments replicate (131ms)
    - #3961 Many attachments on same doc
    ✓ Multiple attachments replicate, different docs (#2698) (125ms)
    ✓ Multiple attachments replicate, different docs png (#2698) (123ms)
    ✓ #3932 attachments with tricky revpos (222ms)
    ✓ replication with changing attachments (146ms)
    ✓ 3955 race condition in put
    ✓ #8456 bad attachment rev after replication (173ms)

  suite2 test.attachments.js- http:local
    ✓ Attachments replicate back and forth (102ms)
    ✓ Replicate same doc, same atts (165ms)
    ✓ Replicate same doc, same atts 2 (99ms)
    ✓ Attachments replicate (69ms)
    ✓ Attachment types replicate (49ms)
    ✓ Many many attachments replicate (144ms)
    ✓ Many many png attachments replicate (190ms)
    ✓ Multiple attachments replicate (82ms)
    - #3961 Many attachments on same doc
    ✓ Multiple attachments replicate, different docs (#2698) (72ms)
    ✓ Multiple attachments replicate, different docs png (#2698) (88ms)
    ✓ #3932 attachments with tricky revpos (137ms)
    ✓ replication with changing attachments (90ms)
    ✓ 3955 race condition in put
    ✓ #8456 bad attachment rev after replication (122ms)

  suite2 test.attachments.js- local:local
    ✓ Attachments replicate back and forth
    ✓ Replicate same doc, same atts
    ✓ Replicate same doc, same atts 2
    ✓ Attachments replicate
    ✓ Attachment types replicate
    ✓ Many many attachments replicate
    ✓ Many many png attachments replicate
    ✓ Multiple attachments replicate
    - #3961 Many attachments on same doc
    ✓ Multiple attachments replicate, different docs (#2698)
    ✓ Multiple attachments replicate, different docs png (#2698)
    ✓ #3932 attachments with tricky revpos (40ms)
    ✓ replication with changing attachments
    ✓ 3955 race condition in put
    ✓ #8456 bad attachment rev after replication

  test.basics.js-http
    ✓ Create a pouch without new keyword
    ✓ Name is accessible via instance
    ✓ 4314 Create a pouch with + in name
    ✓ Creating Pouch without name will throw
    ✓ 4314 Create a pouch with urlencoded name
    ✓ 4219 destroy a pouch
    ✓ 4339 throw useful error if method called on stale instance
    ✓ [4595] should reject xhr errors
    ✓ [4595] should emit error event on xhr error
    ✓ Add a doc
    ✓ Get invalid id
    ✓ Missing doc should contain ID in error object
    ✓ PUTed Conflicted doc should contain ID in error object
    ✓ POSTed Conflicted doc should contain ID in error object
    ✓ Add a doc with a promise
    ✓ Add a doc with opts object
    ✓ Modify a doc
    ✓ Modifying a doc that has rewritten content
    ✓ Modify a doc with a promise
    ✓ Read db id
    ✓ Read db id with promise
    ✓ Close db
    ✓ Close db with a promise
    ✓ Read db id after closing Close
    ✓ Modify a doc with incorrect rev
    ✓ Remove doc
    ✓ Remove doc with a promise
    ✓ Remove doc with new syntax
    ✓ Remove doc with new syntax and a promise
    ✓ Doc removal leaves only stub
    ✓ Remove doc twice with specified id
    ✓ Remove doc, no callback
    ✓ Delete document without id
    ✓ Delete document with many args
    ✓ Delete document with many args, callback style
    ✓ Delete doc with id + rev + no opts
    ✓ Delete doc with id + rev + no opts, callback style
    ✓ Delete doc with doc + opts
    ✓ Delete doc with doc + opts, callback style
    ✓ Delete doc with rev in opts
    ✓ Bulk docs
    ✓ Bulk docs with a promise
    ✓ Basic checks
    ✓ update with invalid rev
    ✓ Doc validation
    ✓ Replication fields (#2442)
    ✓ Testing issue #48 (57ms)
    ✓ Testing valid id
    ✓ Put doc without _id should fail
    ✓ Put doc with bad reserved id should fail
    ✓ update_seq persists
    ✓ deletions persists
    ✓ #4126 should not store raw Dates
    ✓ Create a db with a reserved name
    ✓ Error when document is not an object
    ✓ Test instance update_seq updates correctly
    ✓ Fail to fetch a doc after db was deleted (51ms)
    ✓ Fail to fetch a doc after db was deleted (55ms)
    ✓ Cant add docs with empty ids
    ✓ Test doc with percent in ID
    ✓ db.info should give auto_compaction = false (#2744)
    ✓ db.info should give auto_compaction = true (#2744)
    ✓ db.info should give adapter name (#3567)
    ✓ db.info should give correct doc_count
    ✓ putting returns {ok: true}
    ✓ putting is override-able
    ✓ issue 2779, deleted docs, old revs COUCHDB-292
    ✓ issue 2888, successive deletes and writes (99ms)
    ✓ 2 invalid puts
    ✓ Docs save "null" value
    ✓ replace PouchDB.destroy() (express-pouchdb#203)
    ✓ 3968, keeps all object fields
    ✓ 4712 invalid rev for new doc generates conflict
    ✓ test info() after db close
    ✓ test get() after db close
    ✓ test close() after db close
    ✓ 7259 should have "this" keyword properly scoped
    ✓ #5471 PouchDB.plugin() should throw error if passed wrong type or empty object

  test.basics.js-local
    ✓ Create a pouch without new keyword
    ✓ Name is accessible via instance
    ✓ 4314 Create a pouch with + in name
    ✓ Creating Pouch without name will throw
    ✓ 4314 Create a pouch with urlencoded name
    ✓ 4219 destroy a pouch
    ✓ 4339 throw useful error if method called on stale instance
    ✓ [4595] should reject xhr errors
    ✓ [4595] should emit error event on xhr error
    ✓ Add a doc
    ✓ Get invalid id
    ✓ Missing doc should contain ID in error object
    ✓ PUTed Conflicted doc should contain ID in error object
    ✓ POSTed Conflicted doc should contain ID in error object
    ✓ Add a doc with a promise
    ✓ Add a doc with opts object
    ✓ Modify a doc
    ✓ Modifying a doc that has rewritten content
    ✓ Modify a doc with a promise
    ✓ Read db id
    ✓ Read db id with promise
    ✓ Close db
    ✓ Close db with a promise
    ✓ Read db id after closing Close
    ✓ Modify a doc with incorrect rev
    ✓ Remove doc
    ✓ Remove doc with a promise
    ✓ Remove doc with new syntax
    ✓ Remove doc with new syntax and a promise
    ✓ Doc removal leaves only stub
    ✓ Remove doc twice with specified id
    ✓ Remove doc, no callback
    ✓ Delete document without id
    ✓ Delete document with many args
    ✓ Delete document with many args, callback style
    ✓ Delete doc with id + rev + no opts
    ✓ Delete doc with id + rev + no opts, callback style
    ✓ Delete doc with doc + opts
    ✓ Delete doc with doc + opts, callback style
    ✓ Delete doc with rev in opts
    ✓ Bulk docs
    ✓ Bulk docs with a promise
    ✓ Basic checks
    ✓ update with invalid rev
    ✓ Doc validation
    ✓ Replication fields (#2442)
    ✓ Allows _access field in documents (#8171)
    ✓ Testing issue #48 (53ms)
    ✓ Testing valid id
    ✓ Put doc without _id should fail
    ✓ Put doc with bad reserved id should fail
    ✓ update_seq persists
    ✓ deletions persists
    ✓ #4126 should not store raw Dates
    ✓ Create a db with a reserved name
    ✓ Error when document is not an object
    ✓ Test instance update_seq updates correctly
    ✓ Fail to fetch a doc after db was deleted
    ✓ Fail to fetch a doc after db was deleted (38ms)
    ✓ Cant add docs with empty ids
    ✓ Test doc with percent in ID
    ✓ db.info should give auto_compaction = false (#2744)
    ✓ db.info should give auto_compaction = true (#2744)
    ✓ db.info should give adapter name (#3567)
    ✓ db.info should give correct doc_count
    ✓ putting returns {ok: true}
    ✓ putting is override-able
    ✓ issue 2779, deleted docs, old revs COUCHDB-292
    ✓ issue 2888, successive deletes and writes
    ✓ 2 invalid puts
    ✓ Docs save "null" value
    ✓ replace PouchDB.destroy() (express-pouchdb#203)
    ✓ 3968, keeps all object fields
    ✓ 4712 invalid rev for new doc generates conflict
    ✓ test info() after db close
    ✓ test get() after db close
    ✓ test close() after db close
    ✓ 7259 should have "this" keyword properly scoped
    ✓ should allow unicode doc ids
    ✓ should have same blob support for 2 dbs
    ✓ 6053, PouchDB.plugin() resets defaults
    ✓ #5471 PouchDB.plugin() should throw error if passed wrong type or empty object

  test.bulk_docs.js-local
    ✓ Testing bulk docs
    ✓ #6039 test id in bulk docs for conflict
    ✓ No id in bulk docs
    ✓ No _rev and new_edits=false
    ✓ 7829 bare rev 1- with new_edits=false
    ✓ Test empty bulkDocs
    ✓ Test many bulkDocs
    ✓ Test errors on invalid doc id
    ✓ Test two errors on invalid doc id
    ✓ No docs
    ✓ Jira 911 (41ms)
    ✓ Test multiple bulkdocs
    ✓ #2935 new_edits=false correct number
    ✓ #2935 new_edits=false correct number 2
    ✓ bulk docs update then delete then conflict
    ✓ bulk_docs delete then undelete
    ✓ #2935 new_edits=false with single unauthorized
    ✓ Deleting _local docs with bulkDocs
    ✓ Deleting _local docs with bulkDocs, not found
    ✓ Deleting _local docs with bulkDocs, wrong rev
    ✓ Bulk with new_edits=false
    ✓ Testing successive new_edits to the same doc
    ✓ #3062 bulkDocs with staggered seqs
    ✓ Testing successive new_edits to the same doc, different content
    ✓ Testing successive new_edits to two doc
    ✓ Deletion with new_edits=false
    ✓ Deletion with new_edits=false, no history
    ✓ Modification with new_edits=false, no history
    ✓ Deletion with new_edits=false, no history, no revisions
    ✓ Testing new_edits=false in req body
    ✓ 656 regression in handling deleted docs
    ✓ Test quotes in doc ids
    ✓ Bulk docs empty list
    ✓ handles simultaneous writes
    ✓ bulk docs input by array
    ✓ Bulk empty list
    ✓ Bulk docs not an array
    ✓ Bulk docs not an object
    ✓ Bulk docs two different revisions to same document id
    ✓ 4204 respect revs_limit (267ms)
    ✓ 2839 implement revs_limit (180ms)
    ✓ 4372 revs_limit deletes old revisions of the doc
    ✓ 4372 revs_limit with auto_compaction deletes old revisions of the doc
    ✓ 4712 invalid rev for new doc generates conflict
    ✓ 5793 bulk docs accepts _conflicts when new_edits=false

  test.bulk_docs.js-http
    ✓ Testing bulk docs
    ✓ #6039 test id in bulk docs for conflict
    ✓ No id in bulk docs
    ✓ No _rev and new_edits=false
    ✓ 7829 bare rev 1- with new_edits=false
    ✓ Test empty bulkDocs
    ✓ Test many bulkDocs (41ms)
    ✓ Test errors on invalid doc id
    ✓ Test two errors on invalid doc id
    ✓ No docs
    ✓ Jira 911
    ✓ Test multiple bulkdocs
    ✓ #2935 new_edits=false correct number
    ✓ #2935 new_edits=false correct number 2
    ✓ bulk docs update then delete then conflict
    ✓ bulk_docs delete then undelete
    ✓ #2935 new_edits=false with single unauthorized
    ✓ Deleting _local docs with bulkDocs
    ✓ Bulk with new_edits=false
    ✓ Testing successive new_edits to the same doc
    ✓ #3062 bulkDocs with staggered seqs
    ✓ Testing successive new_edits to the same doc, different content
    ✓ Testing successive new_edits to two doc
    ✓ Deletion with new_edits=false
    ✓ Deletion with new_edits=false, no history
    ✓ Modification with new_edits=false, no history
    ✓ Deletion with new_edits=false, no history, no revisions
    ✓ Testing new_edits=false in req body
    ✓ 656 regression in handling deleted docs
    ✓ Test quotes in doc ids
    ✓ Bulk docs empty list
    ✓ handles simultaneous writes
    ✓ bulk docs input by array
    ✓ Bulk empty list
    ✓ Bulk docs not an array
    ✓ Bulk docs not an object
    ✓ Bulk docs two different revisions to same document id
    ✓ 4204 respect revs_limit (359ms)
    ✓ 2839 implement revs_limit
    ✓ 4372 revs_limit deletes old revisions of the doc
    ✓ 4372 revs_limit with auto_compaction deletes old revisions of the doc
    ✓ 4712 invalid rev for new doc generates conflict
    ✓ 5793 bulk docs accepts _conflicts when new_edits=false (44ms)

  test.bulk_get.js-http
    ✓ test bulk get with rev specified
    ✓ test bulk get with latest=true
    ✓ test bulk get with no rev specified
    ✓ _revisions is not returned by default
    ✓ #5886 bulkGet with reserved id
    ✓ _revisions is returned when specified
    ✓ _revisions is returned when specified, using implicit rev
    ✓ attachments are not included by default
    ✓ attachments are included when specified
    ✓ attachments are included when specified, using implicit rev

  test.bulk_get.js-local
    ✓ test bulk get with rev specified
    ✓ test bulk get with latest=true
    ✓ test bulk get with no rev specified
    ✓ _revisions is not returned by default
    ✓ #5886 bulkGet with reserved id
    ✓ _revisions is returned when specified
    ✓ _revisions is returned when specified, using implicit rev
    ✓ attachments are not included by default
    ✓ attachments are included when specified
    ✓ attachments are included when specified, using implicit rev

  test.changes.js-http
    ✓ All changes
    ✓ Changes with complete callback as param
    ✓ Promise resolved when changes cancelled
    - Live changes should clean listener when cancelled
    ✓ Changes Since
    ✓ Changes Since and limit limit 1
    ✓ Changes Since and limit limit 0
    ✓ Changes limit (48ms)
    ✓ Changes with filter not present in ddoc
    ✓ Changes with `filters` key not present in ddoc
    ✓ Changes limit and filter
    ✓ Changes with shorthand function name
    ✓ Changes with filter from nonexistent ddoc
    ✓ Changes with view not present in ddoc
    ✓ Changes with `views` key not present in ddoc (48ms)
    ✓ #4451 Changes with invalid view filter
    ✓ 3356 throw inside a filter (39ms)
    ✓ Changes with missing param `view` in request
    ✓ Changes limit and view instead of filter
    ✓ #3609 view option implies filter: _view
    ✓ Immediately cancel changes
    ✓ Changes with invalid ddoc view name
    ✓ Changes with invalid ddoc view name 2
    ✓ Changes with style = all_docs (63ms)
    ✓ Changes with style = all_docs and a callback for complete (67ms)
    ✓ Changes limit = 0
    ✓ Changes doc
    - Descending many changes
    ✓ live-changes
    ✓ Multiple watchers
    ✓ Continuous changes doc
    ✓ Cancel changes (324ms)
    ✓ #3579 changes firing 1 too many times (73ms)
    ✓ Kill database while listening to live changes
    ✓ #3136 style=all_docs
    ✓ #4191 revs_diff causes endless loop
    ✓ #3136 style=all_docs & include_docs
    ✓ changes-filter with query params
    ✓ Non-live changes filter
    ✓ Non-live changes filter, descending
    ✓ #2569 Non-live doc_ids filter
    ✓ #2569 Big non-live doc_ids filter
    ✓ #2569 Live doc_ids filter
    ✓ #2569 Big live doc_ids filter
    ✓ #2569 Non-live doc_ids filter with filter=_doc_ids
    ✓ #2569 Live doc_ids filter with filter=_doc_ids
    ✓ Changes to same doc are grouped
    ✓ Changes with conflicts are handled correctly (127ms)
    ✓ Change entry for a deleted doc
    ✓ changes large number of docs
    ✓ Calling db.changes({since: 'now'})
    ✓ Calling db.changes({since: 'latest'})
    ✓ Closing db does not cause a crash if changes cancelled
    ✓ fire-complete-on-cancel (102ms)
    ✓ changes are not duplicated (1029ms)
    ✓ supports return_docs=false
    ✓ should respects limit (78ms)
    ✓ doesn't throw if opts.complete is undefined
    ✓ handle individual changes in live replication (203ms)
    ✓ changes-filter without filter
    ✓ #3539 - Exception in changes is fine
    ✓ Changes with selector
    ✓ Changes with selector, explicit filter
    ✓ Changes with selector and mismatched filter
    ✓ Changes with limit and selector

  test.changes.js-local
    ✓ All changes
    ✓ Changes with complete callback as param
    ✓ Promise resolved when changes cancelled
    - Live changes should clean listener when cancelled
    ✓ Changes Since
    ✓ Changes Since and limit limit 1
    ✓ Changes Since and limit limit 0
    ✓ Changes limit
    ✓ Changes with filter not present in ddoc
    ✓ Changes with `filters` key not present in ddoc
    ✓ Changes limit and filter
    ✓ Changes with shorthand function name
    ✓ Changes with filter from nonexistent ddoc
    ✓ Changes with view not present in ddoc
    ✓ Changes with `views` key not present in ddoc
    ✓ #4451 Changes with invalid view filter
    ✓ 3356 throw inside a filter
    ✓ Changes with missing param `view` in request
    ✓ Changes limit and view instead of filter
    ✓ #3609 view option implies filter: _view
    ✓ Immediately cancel changes
    ✓ Changes with invalid ddoc view name
    ✓ Changes with invalid ddoc view name 2
    ✓ Changes with style = all_docs
    ✓ Changes with style = all_docs and a callback for complete
    ✓ Changes limit = 0
    ✓ Changes doc
    - Descending many changes
    ✓ live-changes
    ✓ Multiple watchers
    ✓ Continuous changes doc
    ✓ Cancel changes (320ms)
    ✓ #3579 changes firing 1 too many times (67ms)
    ✓ Kill database while listening to live changes
    ✓ #3136 style=all_docs
    ✓ #4191 revs_diff causes endless loop
    ✓ #3136 style=all_docs & include_docs
    ✓ changes-filter with query params
    ✓ Non-live changes filter
    ✓ Non-live changes filter, descending
    ✓ #2569 Non-live doc_ids filter
    ✓ #2569 Big non-live doc_ids filter
    ✓ #2569 Live doc_ids filter
    ✓ #2569 Big live doc_ids filter
    ✓ #2569 Non-live doc_ids filter with filter=_doc_ids
    ✓ #2569 Live doc_ids filter with filter=_doc_ids
    ✓ Changes to same doc are grouped
    ✓ Changes with conflicts are handled correctly (38ms)
    ✓ Change entry for a deleted doc
    ✓ changes large number of docs
    ✓ Calling db.changes({since: 'now'})
    ✓ Calling db.changes({since: 'latest'})
    ✓ Closing db does not cause a crash if changes cancelled
    ✓ fire-complete-on-cancel (101ms)
    ✓ changes are not duplicated (1018ms)
    ✓ supports return_docs=false
    ✓ should respects limit (67ms)
    ✓ doesn't throw if opts.complete is undefined
    ✓ handle individual changes in live replication (71ms)
    ✓ changes-filter without filter
    ✓ #3539 - Exception in changes is fine
    ✓ Changes with selector
    ✓ Changes with selector, explicit filter
    ✓ Changes with selector and mismatched filter
    ✓ Changes with limit and selector

  changes-standalone
    - Changes reports errors

  test.close.js-local
    ✓ should emit destroyed even when closed (sync)
    ✓ should emit destroyed even when closed (async)
    ✓ should emit closed even when destroyed (async #2)
precondition_failed: Database not open
    at Object.<anonymous> (/data/js-variants/multee/Clients/levelup/pouchdb/packages/node_modules/pouchdb/lib/index.js:614:16)
    at Module._compile (node:internal/modules/cjs/loader:1105:14)
    at Module._extensions..js (node:internal/modules/cjs/loader:1159:10)
    at Module.load (node:internal/modules/cjs/loader:981:32)
    at Module._load (node:internal/modules/cjs/loader:827:12)
    at Module.require (node:internal/modules/cjs/loader:1005:19)
    at require (node:internal/modules/cjs/helpers:102:18)
    at commonUtils.loadPouchDBForNode (/data/js-variants/multee/Clients/levelup/pouchdb/tests/common-utils.js:92:17)
    at commonUtils.loadPouchDB (/data/js-variants/multee/Clients/levelup/pouchdb/tests/common-utils.js:78:39)
    at Object.<anonymous> (/data/js-variants/multee/Clients/levelup/pouchdb/tests/integration/node.setup.js:21:28)
    at Module._compile (node:internal/modules/cjs/loader:1105:14)
    at Module._extensions..js (node:internal/modules/cjs/loader:1159:10)
    at Module.load (node:internal/modules/cjs/loader:981:32)
    at Module._load (node:internal/modules/cjs/loader:827:12)
    at Module.require (node:internal/modules/cjs/loader:1005:19)
    at require (node:internal/modules/cjs/helpers:102:18)
    at /data/js-variants/multee/Clients/levelup/pouchdb/node_modules/mocha/bin/_mocha:366:3
    at Array.forEach (<anonymous>)
    at Object.<anonymous> (/data/js-variants/multee/Clients/levelup/pouchdb/node_modules/mocha/bin/_mocha:365:10)
    at Module._compile (node:internal/modules/cjs/loader:1105:14)
    at Module._extensions..js (node:internal/modules/cjs/loader:1159:10)
    at Module.load (node:internal/modules/cjs/loader:981:32)
    at Module._load (node:internal/modules/cjs/loader:827:12)
    at Function.executeUserEntryPoint [as runMain] (node:internal/modules/run_main:77:12)
    at node:internal/main/run_main_module:17:47
    ✓ test unref for coverage
    ✓ test double unref for coverage
precondition_failed: Database not open
    at Object.<anonymous> (/data/js-variants/multee/Clients/levelup/pouchdb/packages/node_modules/pouchdb/lib/index.js:614:16)
    at Module._compile (node:internal/modules/cjs/loader:1105:14)
    at Module._extensions..js (node:internal/modules/cjs/loader:1159:10)
    at Module.load (node:internal/modules/cjs/loader:981:32)
    at Module._load (node:internal/modules/cjs/loader:827:12)
    at Module.require (node:internal/modules/cjs/loader:1005:19)
    at require (node:internal/modules/cjs/helpers:102:18)
    at commonUtils.loadPouchDBForNode (/data/js-variants/multee/Clients/levelup/pouchdb/tests/common-utils.js:92:17)
    at commonUtils.loadPouchDB (/data/js-variants/multee/Clients/levelup/pouchdb/tests/common-utils.js:78:39)
    at Object.<anonymous> (/data/js-variants/multee/Clients/levelup/pouchdb/tests/integration/node.setup.js:21:28)
    at Module._compile (node:internal/modules/cjs/loader:1105:14)
    at Module._extensions..js (node:internal/modules/cjs/loader:1159:10)
    at Module.load (node:internal/modules/cjs/loader:981:32)
    at Module._load (node:internal/modules/cjs/loader:827:12)
    at Module.require (node:internal/modules/cjs/loader:1005:19)
    at require (node:internal/modules/cjs/helpers:102:18)
    at /data/js-variants/multee/Clients/levelup/pouchdb/node_modules/mocha/bin/_mocha:366:3
    at Array.forEach (<anonymous>)
    at Object.<anonymous> (/data/js-variants/multee/Clients/levelup/pouchdb/node_modules/mocha/bin/_mocha:365:10)
    at Module._compile (node:internal/modules/cjs/loader:1105:14)
    at Module._extensions..js (node:internal/modules/cjs/loader:1159:10)
    at Module.load (node:internal/modules/cjs/loader:981:32)
    at Module._load (node:internal/modules/cjs/loader:827:12)
    at Function.executeUserEntryPoint [as runMain] (node:internal/modules/run_main:77:12)
    at node:internal/main/run_main_module:17:47
    ✓ test close-then-destroyed for coverage
************* run test done *************
pouchdb is testing ./Variants/levelup/variant10/levelup
/data/js-variants/multee
************* npm unlink module *************

removed 1 package, changed 1 package, and audited 1032 packages in 4s

64 packages are looking for funding
  run `npm fund` for details

41 vulnerabilities (1 low, 9 moderate, 25 high, 6 critical)

To address issues that do not require attention, run:
  npm audit fix

To address all issues possible (including breaking changes), run:
  npm audit fix --force

Some issues need review, and may require choosing
a different dependency.

Run `npm audit` for details.
************* npm unlink module done *************
************* npm unlink globally *************

removed 1 package, and audited 1 package in 1s

found 0 vulnerabilities
************* npm unlink globally done *************
************* npm link globally *************

added 1 package, and audited 3 packages in 403ms

found 0 vulnerabilities
************* npm link globally done *************
************* npm link module *************

added 1 package, changed 1 package, and audited 1034 packages in 5s

64 packages are looking for funding
  run `npm fund` for details

41 vulnerabilities (1 low, 9 moderate, 25 high, 6 critical)

To address issues that do not require attention, run:
  npm audit fix

To address all issues possible (including breaking changes), run:
  npm audit fix --force

Some issues need review, and may require choosing
a different dependency.

Run `npm audit` for details.
************* npm link module done *************
************* start run test *************

> pouchdb-monorepo@7.0.0-prerelease test
> bash bin/run-test.sh


> pouchdb-monorepo@7.0.0-prerelease build-node
> bash bin/build-node.sh


> pouchdb-monorepo@7.0.0-prerelease build-modules
> node bin/build-modules.js

Building pouchdb...
Building pouchdb-abstract-mapreduce...
Building pouchdb-adapter-http...
Building pouchdb-adapter-idb...
Building pouchdb-adapter-indexeddb...
Building pouchdb-adapter-leveldb...
Building pouchdb-adapter-leveldb-core...
Building pouchdb-adapter-localstorage...
Building pouchdb-adapter-memory...
Building pouchdb-adapter-utils...
Building pouchdb-binary-utils...
Building pouchdb-browser...
Building pouchdb-changes-filter...
Building pouchdb-checkpointer...
Building pouchdb-collate...
Building pouchdb-collections...
Building pouchdb-core...
Building pouchdb-errors...
Building pouchdb-fetch...
Building pouchdb-find...
Building pouchdb-for-coverage...
Building pouchdb-generate-replication-id...
Building pouchdb-json...
Building pouchdb-mapreduce...
Building pouchdb-mapreduce-utils...
Building pouchdb-md5...
Building pouchdb-merge...
Building pouchdb-node...
Building pouchdb-replication...
Building pouchdb-selector-core...
Building pouchdb-utils...
Building sublevel-pouchdb...
  ✓ wrote pouchdb-adapter-localstorage/lib/index.js in vanilla mode
  ✓ wrote pouchdb-adapter-localstorage/lib/index.es.js in vanilla mode
  ✓ wrote pouchdb-adapter-memory/lib/index.js in vanilla mode
  ✓ wrote pouchdb-adapter-memory/lib/index.es.js in vanilla mode
  ✓ wrote pouchdb-checkpointer/lib/index.js in vanilla mode
  ✓ wrote pouchdb-checkpointer/lib/index.es.js in vanilla mode
  ✓ wrote pouchdb-errors/lib/index.js in vanilla mode
  ✓ wrote pouchdb-errors/lib/index.es.js in vanilla mode
  ✓ wrote pouchdb-generate-replication-id/lib/index.es.js in vanilla mode
  ✓ wrote pouchdb-generate-replication-id/lib/index.js in vanilla mode
  ✓ wrote pouchdb-adapter-http/lib/index.js in vanilla mode
  ✓ wrote pouchdb-adapter-http/lib/index.es.js in vanilla mode
  ✓ wrote pouchdb-adapter-leveldb/lib/index.js in node mode
  ✓ wrote pouchdb-adapter-leveldb/lib/index.es.js in node mode
  ✓ wrote pouchdb-adapter-leveldb/lib/index-browser.js in browser mode
  ✓ wrote pouchdb-adapter-leveldb/lib/index-browser.es.js in browser mode
  ✓ wrote pouchdb-adapter-leveldb-core/lib/index.js in node mode
  ✓ wrote pouchdb-adapter-leveldb-core/lib/index.es.js in node mode
  ✓ wrote pouchdb-adapter-leveldb-core/lib/index-browser.js in browser mode
  ✓ wrote pouchdb-adapter-leveldb-core/lib/index-browser.es.js in browser mode
  ✓ wrote pouchdb-changes-filter/lib/index-browser.js in browser mode
  ✓ wrote pouchdb-changes-filter/lib/index-browser.es.js in browser mode
  ✓ wrote pouchdb-fetch/lib/index-browser.js in browser mode
  ✓ wrote pouchdb-fetch/lib/index-browser.es.js in browser mode
  ✓ wrote pouchdb-md5/lib/index-browser.js in browser mode
  ✓ wrote pouchdb-md5/lib/index-browser.es.js in browser mode
  ✓ wrote pouchdb-changes-filter/lib/index.js in node mode
  ✓ wrote pouchdb-changes-filter/lib/index.es.js in node mode
  ✓ wrote pouchdb-collate/lib/index.js in vanilla mode
  ✓ wrote pouchdb-collate/lib/index.es.js in vanilla mode
  ✓ wrote pouchdb-fetch/lib/index.js in node mode
  ✓ wrote pouchdb-fetch/lib/index.es.js in node mode
  ✓ wrote pouchdb-json/lib/index.js in vanilla mode
  ✓ wrote pouchdb-json/lib/index.es.js in vanilla mode
  ✓ wrote pouchdb-md5/lib/index.js in node mode
  ✓ wrote pouchdb-md5/lib/index.es.js in node mode
  ✓ wrote pouchdb-mapreduce-utils/lib/index.js in vanilla mode
  ✓ wrote pouchdb-mapreduce-utils/lib/index.es.js in vanilla mode
  ✓ wrote pouchdb-abstract-mapreduce/lib/index.js in vanilla mode
  ✓ wrote pouchdb-abstract-mapreduce/lib/index.es.js in vanilla mode
  ✓ wrote pouchdb-adapter-idb/lib/index.js in vanilla mode
  ✓ wrote pouchdb-adapter-idb/lib/index.es.js in vanilla mode
  ✓ wrote pouchdb-adapter-indexeddb/lib/index.js in vanilla mode
  ✓ wrote pouchdb-adapter-indexeddb/lib/index.es.js in vanilla mode
  ✓ wrote pouchdb-binary-utils/lib/index-browser.js in browser mode
  ✓ wrote pouchdb-binary-utils/lib/index-browser.es.js in browser mode
  ✓ wrote pouchdb-adapter-utils/lib/index.js in vanilla mode
  ✓ wrote pouchdb-adapter-utils/lib/index.es.js in vanilla mode
  ✓ wrote pouchdb-binary-utils/lib/index.js in node mode
  ✓ wrote pouchdb-binary-utils/lib/index.es.js in node mode
  ✓ wrote pouchdb-collections/lib/index.js in vanilla mode
  ✓ wrote pouchdb-collections/lib/index.es.js in vanilla mode
  ✓ wrote pouchdb-merge/lib/index.js in vanilla mode
  ✓ wrote pouchdb-merge/lib/index.es.js in vanilla mode
  ✓ wrote pouchdb-selector-core/lib/index.js in vanilla mode
  ✓ wrote pouchdb-selector-core/lib/index.es.js in vanilla mode
  ✓ wrote pouchdb-utils/lib/index-browser.js in browser mode
  ✓ wrote pouchdb-utils/lib/index-browser.es.js in browser mode
  ✓ wrote pouchdb-utils/lib/index.js in node mode
  ✓ wrote pouchdb-utils/lib/index.es.js in node mode
  ✓ wrote sublevel-pouchdb/lib/index.js in vanilla mode
  ✓ wrote sublevel-pouchdb/lib/index.es.js in vanilla mode
  ✓ wrote pouchdb-mapreduce/lib/index-browser.js in browser mode
  ✓ wrote pouchdb-mapreduce/lib/index-browser.es.js in browser mode
  ✓ wrote pouchdb-replication/lib/index.js in vanilla mode
  ✓ wrote pouchdb-replication/lib/index.es.js in vanilla mode
  ✓ wrote pouchdb-mapreduce/lib/index.js in node mode
  ✓ wrote pouchdb-mapreduce/lib/index.es.js in node mode
  ✓ wrote pouchdb-core/lib/index.js in vanilla mode
  ✓ wrote pouchdb-core/lib/index.es.js in vanilla mode
  ✓ wrote pouchdb-find/lib/index.js in node mode
  ✓ wrote pouchdb-find/lib/index.es.js in node mode
  ✓ wrote pouchdb-find/lib/index-browser.js in browser mode
  ✓ wrote pouchdb-find/lib/index-browser.es.js in browser mode
  ✓ wrote pouchdb-for-coverage/lib/index.js in node mode
  ✓ wrote pouchdb-for-coverage/lib/index.es.js in node mode
  ✓ wrote pouchdb-for-coverage/lib/index-browser.js in browser mode
  ✓ wrote pouchdb-for-coverage/lib/index-browser.es.js in browser mode
  ✓ wrote pouchdb-browser/lib/index.js in vanilla mode
  ✓ wrote pouchdb-browser/lib/index.es.js in vanilla mode
  ✓ wrote pouchdb-node/lib/index.js in vanilla mode
  ✓ wrote pouchdb-node/lib/index.es.js in vanilla mode
  ✓ wrote packages/node_modules/pouchdb/lib/index.js
  ✓ wrote packages/node_modules/pouchdb/lib/index.es.js
Waiting for host to start ..
Host started :)
> pouchdb-monorepo@7.0.0-prerelease test-node
> bash bin/test-node.sh

Down server listening on port 3010
Seeded with: 1660142909647


  DB Setup
    ✓ PouchDB has a version
    ✓ PouchDB version matches package.json

  test.active_tasks.js
    ✓ Can add a task
    ✓ Can get tasks by id
    ✓ Can get all tasks
    ✓ Can update a task
    ✓ Can remove a task

  test.all_docs.js-http
    ✓ Testing all docs (161ms)
    ✓ Testing allDocs opts.keys (65ms)
    ✓ Testing allDocs opts.keys with skip
    ✓ Testing allDocs opts.keys with limit
    ✓ Testing allDocs invalid opts.keys
    ✓ Testing deleting in changes (47ms)
    ✓ Testing updating in changes (48ms)
    ✓ Testing include docs
    ✓ Testing conflicts (47ms)
    ✓ test basic collation
    ✓ 3883 start_key end_key aliases
    ✓ test total_rows with a variety of criteria (120ms)
    ✓ test total_rows with both skip and limit (40ms)
    ✓ test limit option and total_rows
    ✓ test escaped startkey/endkey
    ✓ test "key" option
    ✓ test inclusive_end=false (57ms)
    ✓ test descending with startkey/endkey
    ✓ #3082 test wrong num results returned (258ms)
    ✓ test empty db
    ✓ test after db close
    ✓ 5793 _conflicts should not exist if no conflicts
    ✓ #6230 Test allDocs opts update_seq: false
    ✓ #6230 Test allDocs opts update_seq: true
    ✓ #6230 Test allDocs opts with update_seq missing

  test.all_docs.js-local
    ✓ Testing all docs
    ✓ Testing allDocs opts.keys
    ✓ Testing allDocs opts.keys with skip
    ✓ Testing allDocs opts.keys with limit
    ✓ Testing allDocs invalid opts.keys
    ✓ Testing deleting in changes
    ✓ Testing updating in changes
    ✓ Testing include docs
    ✓ Testing conflicts
    ✓ test basic collation
    ✓ 3883 start_key end_key aliases
    ✓ test total_rows with a variety of criteria
    ✓ test total_rows with both skip and limit
    ✓ test limit option and total_rows
    ✓ test escaped startkey/endkey
    ✓ test "key" option
    ✓ test inclusive_end=false
    ✓ test descending with startkey/endkey
    ✓ #3082 test wrong num results returned (195ms)
    ✓ test empty db
    ✓ test after db close
    ✓ test unicode ids and revs
    ✓ 5793 _conflicts should not exist if no conflicts
    ✓ #6230 Test allDocs opts update_seq: false
    ✓ #6230 Test allDocs opts update_seq: true
    ✓ #6230 Test allDocs opts with update_seq missing

  suite2 test.attachments.js-local
    ✓ 3357 Attachment names cant start with _
    ✓ 5736 warning for putAttachment without content_type
    ✓ 5736 warning for bulkDocs attachments without content_type
    ✓ fetch atts with open_revs and missing
    ✓ issue 2803 should throw 412
    ✓ issue 2803 should throw 412 part 2
    ✓ issue 2803 should throw 412 part 3
    ✓ issue 2803 should throw 412 part 4
    ✓ #2858 {binary: true} in get()
    ✓ #2858 {binary: true} in allDocs() 1
    ✓ #2858 {binary: true} in allDocs() 2
    ✓ #2858 {binary: true} in allDocs() 3
    ✓ #2858 {binary: true} in allDocs() 4
    ✓ #2858 {binary: true} in allDocs() 5
    ✓ #2858 {binary: true} in allDocs(), many atts
    ✓ #2858 {binary: true} in allDocs(), mixed atts
    ✓ #2858 {binary: true} in changes() non-live
    ✓ #2858 {binary: true} in changes() non-live, many atts
    ✓ #2858 {binary: true} in changes() non-live, mixed atts
    ✓ #2858 {binary: true} non-live changes, complete event
    ✓ #2858 {binary: true} in live changes
    ✓ #2858 {binary: true} in live changes, mixed atts
    ✓ #2858 {binary: true} in live+retry changes
    ✓ #2858 {binary: true} in live changes, attachments:false
    ✓ #2858 {binary: true} in live changes, include_docs:false
    ✓ #6736 {binary: true} in bulkGet()
    ✓ Measures length correctly after put()
    ✓ #3074 non-live changes()
    ✓ #3074 live changes()
    ✓ #3074 non-live changes(), no attachments
    ✓ #3074 live changes(), no attachments
    ✓ #3881 filter extraneous keys from _attachments
    ✓ #2771 allDocs() 1, single attachment
    ✓ #2771 allDocs() 2, many docs same att
    ✓ #2771 allDocs() 3, many docs diff atts
    ✓ #2771 allDocs() 4, mix of atts and no atts
    ✓ #2771 allDocs() 5, no atts
    ✓ #2771 allDocs() 6, no docs
    ✓ #2771 allDocs() 7, revisions and deletions
    ✓ #2771 allDocs() 8, empty attachment
    ✓ No length for non-stubs (40ms)
    ✓ Test some attachments
    ✓ Test getAttachment
    ✓ Test getAttachment with stubs
    ✓ Test get() with binary:true and stubs
    ✓ Test attachments in allDocs/changes
    ✓ Test putAttachment with base64 plaintext
    ✓ Test putAttachment with invalid base64
    ✓ Test getAttachment with empty text
    ✓ Test getAttachment with normal text
    ✓ Test getAttachment with PNG
    ✓ Test getAttachment with PNG using bulkDocs
    ✓ Test getAttachment with PNG using post
    ✓ Test postAttachment with PNG then bulkDocs
    ✓ proper stub behavior
    ✓ Testing with invalid docs
    ✓ Test create attachment and doc in one go
    ✓ Test create attachment and doc in one go without callback
    ✓ Test create attachment without callback
    ✓ Test put attachment on a doc without attachments
    ✓ Test put attachment with unencoded name
    ✓ 3963 length property on stubs
    ✓ Testing with invalid rev
    ✓ Test put another attachment on a doc with attachments
    ✓ Test get with attachments: true if empty attachments
    ✓ Test delete attachment from a doc
    ✓ Test a document with a json string attachment
    ✓ Test remove doc with attachment
    ✓ Try to insert a doc with unencoded attachment
    ✓ Try to get attachment of unexistent doc
    ✓ Test synchronous putAttachment with text data
    ✓ Test synchronous putAttachment with no text data
    ✓ Test put with partial stubs
    ✓ Test put with attachments and new_edits=false
    ✓ Test getAttachment with specific rev
    ✓ Test getAttachment with diff revs and content
    ✓ Test stubs
    ✓ Try to get unexistent attachment of some doc
    ✓ putAttachment and getAttachment with plaintext
    ✓ putAttachment and getAttachment with png data
    ✓ putAttachment in new doc with base64
    ✓ #2818 - save same attachment in different revs
    ✓ #2818 - save same attachment many times in parallel
    ✓ #2818 - revisions keep attachments (no compaction)
    ✓ #2818 - doesn't throw 409 if same filename
    ✓ #3008 test correct encoding/decoding of \u0000 etc.
    ✓ putAttachment and getAttachment with big png data (87ms)
    ✓ #2709 `revpos` with putAttachment
    ✓ #2709 `revpos` with inline attachment
    ✓ #2709 `revpos` with allDocs
    ✓ #7403 {attachments: true, binary: true, include_docs: true} in allDocs with one missing doc

  suite2 test.attachments.js-http
    ✓ 3357 Attachment names cant start with _
    ✓ 5736 warning for putAttachment without content_type
    ✓ 5736 warning for bulkDocs attachments without content_type
    ✓ fetch atts with open_revs and missing
    ✓ issue 2803 should throw 412
    ✓ issue 2803 should throw 412 part 2
    ✓ issue 2803 should throw 412 part 3
    ✓ issue 2803 should throw 412 part 4
    ✓ #2858 {binary: true} in get()
    ✓ #2858 {binary: true} in allDocs() 1
    ✓ #2858 {binary: true} in allDocs() 2
    ✓ #2858 {binary: true} in allDocs() 3
    ✓ #2858 {binary: true} in allDocs() 4
    ✓ #2858 {binary: true} in allDocs() 5
    ✓ #2858 {binary: true} in allDocs(), many atts
    ✓ #2858 {binary: true} in allDocs(), mixed atts
    ✓ #2858 {binary: true} in changes() non-live
    ✓ #2858 {binary: true} in changes() non-live, many atts
    ✓ #2858 {binary: true} in changes() non-live, mixed atts
    ✓ #2858 {binary: true} non-live changes, complete event
    ✓ #2858 {binary: true} in live changes
    ✓ #2858 {binary: true} in live changes, mixed atts
    ✓ #2858 {binary: true} in live+retry changes
    ✓ #2858 {binary: true} in live changes, attachments:false
    ✓ #2858 {binary: true} in live changes, include_docs:false
    ✓ #6736 {binary: true} in bulkGet()
    ✓ Measures length correctly after put()
    ✓ #3074 non-live changes() (38ms)
    ✓ #3074 live changes()
    ✓ #3074 non-live changes(), no attachments
    ✓ #3074 live changes(), no attachments
    ✓ #3881 filter extraneous keys from _attachments
    ✓ #2771 allDocs() 1, single attachment
    ✓ #2771 allDocs() 2, many docs same att
    ✓ #2771 allDocs() 3, many docs diff atts
    ✓ #2771 allDocs() 4, mix of atts and no atts (42ms)
    ✓ #2771 allDocs() 5, no atts
    ✓ #2771 allDocs() 6, no docs
    ✓ #2771 allDocs() 7, revisions and deletions
    ✓ #2771 allDocs() 8, empty attachment
    ✓ No length for non-stubs
    ✓ Test some attachments (46ms)
    ✓ Test getAttachment
    ✓ Test getAttachment with stubs
    ✓ Test get() with binary:true and stubs
    ✓ Test attachments in allDocs/changes
    ✓ Test putAttachment with base64 plaintext
    ✓ Test putAttachment with invalid base64
    ✓ Test getAttachment with empty text
    ✓ Test getAttachment with normal text
    ✓ Test getAttachment with PNG
    ✓ Test getAttachment with PNG using bulkDocs
    ✓ Test getAttachment with PNG using post
    ✓ Test postAttachment with PNG then bulkDocs
    ✓ proper stub behavior (40ms)
    ✓ Testing with invalid docs
    ✓ Test create attachment and doc in one go
    ✓ Test create attachment and doc in one go without callback
    ✓ Test create attachment without callback (40ms)
    ✓ Test put attachment on a doc without attachments
    ✓ Test put attachment with unencoded name
    ✓ 3963 length property on stubs (47ms)
    ✓ Testing with invalid rev
    ✓ Test put another attachment on a doc with attachments
    ✓ Test get with attachments: true if empty attachments
    ✓ Test delete attachment from a doc (44ms)
    ✓ Test a document with a json string attachment
    ✓ Test remove doc with attachment
    ✓ Try to insert a doc with unencoded attachment
    ✓ Try to get attachment of unexistent doc
    ✓ Test synchronous putAttachment with text data
    ✓ Test synchronous putAttachment with no text data
    ✓ Test put with partial stubs
    ✓ Test put with attachments and new_edits=false
    ✓ Test getAttachment with specific rev (38ms)
    ✓ Test getAttachment with diff revs and content (49ms)
    ✓ Test stubs
    ✓ Try to get unexistent attachment of some doc
    ✓ putAttachment and getAttachment with plaintext
    ✓ putAttachment and getAttachment with png data
    ✓ putAttachment in new doc with base64
    ✓ #2818 - save same attachment in different revs (47ms)
    ✓ #2818 - save same attachment many times in parallel
    ✓ #2818 - revisions keep attachments (no compaction)
    ✓ #2818 - doesn't throw 409 if same filename
    ✓ #3008 test correct encoding/decoding of \u0000 etc.
    ✓ putAttachment and getAttachment with big png data (115ms)
    ✓ #2709 `revpos` with putAttachment (42ms)
    ✓ #2709 `revpos` with inline attachment (40ms)
    ✓ #2709 `revpos` with allDocs
    ✓ #7403 {attachments: true, binary: true, include_docs: true} in allDocs with one missing doc

  suite2 test.attachments.js- local:http
    ✓ Attachments replicate back and forth (189ms)
    ✓ Replicate same doc, same atts (108ms)
    ✓ Replicate same doc, same atts 2 (133ms)
    ✓ Attachments replicate (74ms)
    ✓ Attachment types replicate (55ms)
    ✓ Many many attachments replicate (175ms)
    ✓ Many many png attachments replicate (213ms)
    ✓ Multiple attachments replicate (81ms)
    - #3961 Many attachments on same doc
    ✓ Multiple attachments replicate, different docs (#2698) (77ms)
    ✓ Multiple attachments replicate, different docs png (#2698) (74ms)
    ✓ #3932 attachments with tricky revpos (132ms)
    ✓ replication with changing attachments (97ms)
    ✓ 3955 race condition in put
    ✓ #8456 bad attachment rev after replication (119ms)

  suite2 test.attachments.js- http:http
    ✓ Attachments replicate back and forth (170ms)
    ✓ Replicate same doc, same atts (275ms)
    ✓ Replicate same doc, same atts 2 (188ms)
    ✓ Attachments replicate (108ms)
    ✓ Attachment types replicate (133ms)
    ✓ Many many attachments replicate (355ms)
    ✓ Many many png attachments replicate (307ms)
    ✓ Multiple attachments replicate (124ms)
    - #3961 Many attachments on same doc
    ✓ Multiple attachments replicate, different docs (#2698) (126ms)
    ✓ Multiple attachments replicate, different docs png (#2698) (127ms)
    ✓ #3932 attachments with tricky revpos (234ms)
    ✓ replication with changing attachments (203ms)
    ✓ 3955 race condition in put
    ✓ #8456 bad attachment rev after replication (171ms)

  suite2 test.attachments.js- http:local
    ✓ Attachments replicate back and forth (104ms)
    ✓ Replicate same doc, same atts (97ms)
    ✓ Replicate same doc, same atts 2 (95ms)
    ✓ Attachments replicate (71ms)
    ✓ Attachment types replicate (57ms)
    ✓ Many many attachments replicate (138ms)
    ✓ Many many png attachments replicate (204ms)
    ✓ Multiple attachments replicate (90ms)
    - #3961 Many attachments on same doc
    ✓ Multiple attachments replicate, different docs (#2698) (71ms)
    ✓ Multiple attachments replicate, different docs png (#2698) (89ms)
    ✓ #3932 attachments with tricky revpos (144ms)
    ✓ replication with changing attachments (100ms)
    ✓ 3955 race condition in put
    ✓ #8456 bad attachment rev after replication (191ms)

  suite2 test.attachments.js- local:local
    ✓ Attachments replicate back and forth
    ✓ Replicate same doc, same atts
    ✓ Replicate same doc, same atts 2
    ✓ Attachments replicate (38ms)
    ✓ Attachment types replicate
    ✓ Many many attachments replicate
    ✓ Many many png attachments replicate
    ✓ Multiple attachments replicate
    - #3961 Many attachments on same doc
    ✓ Multiple attachments replicate, different docs (#2698)
    ✓ Multiple attachments replicate, different docs png (#2698)
    ✓ #3932 attachments with tricky revpos
    ✓ replication with changing attachments
    ✓ 3955 race condition in put
    ✓ #8456 bad attachment rev after replication

  test.basics.js-http
    ✓ Create a pouch without new keyword
    ✓ Name is accessible via instance
    ✓ 4314 Create a pouch with + in name
    ✓ Creating Pouch without name will throw
    ✓ 4314 Create a pouch with urlencoded name
    ✓ 4219 destroy a pouch
    ✓ 4339 throw useful error if method called on stale instance
    ✓ [4595] should reject xhr errors
    ✓ [4595] should emit error event on xhr error
    ✓ Add a doc
    ✓ Get invalid id
    ✓ Missing doc should contain ID in error object
    ✓ PUTed Conflicted doc should contain ID in error object
    ✓ POSTed Conflicted doc should contain ID in error object
    ✓ Add a doc with a promise
    ✓ Add a doc with opts object
    ✓ Modify a doc
    ✓ Modifying a doc that has rewritten content
    ✓ Modify a doc with a promise
    ✓ Read db id
    ✓ Read db id with promise
    ✓ Close db
    ✓ Close db with a promise
    ✓ Read db id after closing Close
    ✓ Modify a doc with incorrect rev
    ✓ Remove doc
    ✓ Remove doc with a promise
    ✓ Remove doc with new syntax
    ✓ Remove doc with new syntax and a promise
    ✓ Doc removal leaves only stub
    ✓ Remove doc twice with specified id (39ms)
    ✓ Remove doc, no callback
    ✓ Delete document without id
    ✓ Delete document with many args
    ✓ Delete document with many args, callback style
    ✓ Delete doc with id + rev + no opts
    ✓ Delete doc with id + rev + no opts, callback style
    ✓ Delete doc with doc + opts
    ✓ Delete doc with doc + opts, callback style
    ✓ Delete doc with rev in opts
    ✓ Bulk docs
    ✓ Bulk docs with a promise
    ✓ Basic checks
    ✓ update with invalid rev
    ✓ Doc validation
    ✓ Replication fields (#2442)
    ✓ Testing issue #48 (74ms)
    ✓ Testing valid id
    ✓ Put doc without _id should fail
    ✓ Put doc with bad reserved id should fail
    ✓ update_seq persists
    ✓ deletions persists (45ms)
    ✓ #4126 should not store raw Dates
    ✓ Create a db with a reserved name
    ✓ Error when document is not an object
    ✓ Test instance update_seq updates correctly
    ✓ Fail to fetch a doc after db was deleted (49ms)
    ✓ Fail to fetch a doc after db was deleted (60ms)
    ✓ Cant add docs with empty ids
    ✓ Test doc with percent in ID
    ✓ db.info should give auto_compaction = false (#2744)
    ✓ db.info should give auto_compaction = true (#2744)
    ✓ db.info should give adapter name (#3567)
    ✓ db.info should give correct doc_count
    ✓ putting returns {ok: true}
    ✓ putting is override-able
    ✓ issue 2779, deleted docs, old revs COUCHDB-292
    ✓ issue 2888, successive deletes and writes
    ✓ 2 invalid puts
    ✓ Docs save "null" value
    ✓ replace PouchDB.destroy() (express-pouchdb#203)
    ✓ 3968, keeps all object fields
    ✓ 4712 invalid rev for new doc generates conflict
    ✓ test info() after db close
    ✓ test get() after db close
    ✓ test close() after db close
    ✓ 7259 should have "this" keyword properly scoped
    ✓ #5471 PouchDB.plugin() should throw error if passed wrong type or empty object

  test.basics.js-local
    ✓ Create a pouch without new keyword
    ✓ Name is accessible via instance
    ✓ 4314 Create a pouch with + in name
    ✓ Creating Pouch without name will throw
    ✓ 4314 Create a pouch with urlencoded name
    ✓ 4219 destroy a pouch
    ✓ 4339 throw useful error if method called on stale instance
    ✓ [4595] should reject xhr errors
    ✓ [4595] should emit error event on xhr error
    ✓ Add a doc
    ✓ Get invalid id
    ✓ Missing doc should contain ID in error object
    ✓ PUTed Conflicted doc should contain ID in error object
    ✓ POSTed Conflicted doc should contain ID in error object
    ✓ Add a doc with a promise
    ✓ Add a doc with opts object
    ✓ Modify a doc
    ✓ Modifying a doc that has rewritten content
    ✓ Modify a doc with a promise
    ✓ Read db id
    ✓ Read db id with promise
    ✓ Close db
    ✓ Close db with a promise
    ✓ Read db id after closing Close
    ✓ Modify a doc with incorrect rev
    ✓ Remove doc
    ✓ Remove doc with a promise
    ✓ Remove doc with new syntax
    ✓ Remove doc with new syntax and a promise
    ✓ Doc removal leaves only stub
    ✓ Remove doc twice with specified id
    ✓ Remove doc, no callback
    ✓ Delete document without id
    ✓ Delete document with many args
    ✓ Delete document with many args, callback style
    ✓ Delete doc with id + rev + no opts
    ✓ Delete doc with id + rev + no opts, callback style
    ✓ Delete doc with doc + opts
    ✓ Delete doc with doc + opts, callback style
    ✓ Delete doc with rev in opts
    ✓ Bulk docs
    ✓ Bulk docs with a promise
    ✓ Basic checks
    ✓ update with invalid rev
    ✓ Doc validation
    ✓ Replication fields (#2442)
    ✓ Allows _access field in documents (#8171)
    ✓ Testing issue #48 (52ms)
    ✓ Testing valid id
    ✓ Put doc without _id should fail
    ✓ Put doc with bad reserved id should fail
    ✓ update_seq persists
    ✓ deletions persists
    ✓ #4126 should not store raw Dates
    ✓ Create a db with a reserved name
    ✓ Error when document is not an object
    ✓ Test instance update_seq updates correctly
    ✓ Fail to fetch a doc after db was deleted
    ✓ Fail to fetch a doc after db was deleted
    ✓ Cant add docs with empty ids
    ✓ Test doc with percent in ID
    ✓ db.info should give auto_compaction = false (#2744)
    ✓ db.info should give auto_compaction = true (#2744)
    ✓ db.info should give adapter name (#3567)
    ✓ db.info should give correct doc_count
    ✓ putting returns {ok: true}
    ✓ putting is override-able
    ✓ issue 2779, deleted docs, old revs COUCHDB-292
    ✓ issue 2888, successive deletes and writes
    ✓ 2 invalid puts
    ✓ Docs save "null" value
    ✓ replace PouchDB.destroy() (express-pouchdb#203)
    ✓ 3968, keeps all object fields
    ✓ 4712 invalid rev for new doc generates conflict
    ✓ test info() after db close
    ✓ test get() after db close
    ✓ test close() after db close
    ✓ 7259 should have "this" keyword properly scoped
    ✓ should allow unicode doc ids
    ✓ should have same blob support for 2 dbs
    ✓ 6053, PouchDB.plugin() resets defaults
    ✓ #5471 PouchDB.plugin() should throw error if passed wrong type or empty object

  test.bulk_docs.js-local
    ✓ Testing bulk docs
    ✓ #6039 test id in bulk docs for conflict
    ✓ No id in bulk docs
    ✓ No _rev and new_edits=false
    ✓ 7829 bare rev 1- with new_edits=false
    ✓ Test empty bulkDocs
    ✓ Test many bulkDocs
    ✓ Test errors on invalid doc id
    ✓ Test two errors on invalid doc id
    ✓ No docs
    ✓ Jira 911
    ✓ Test multiple bulkdocs
    ✓ #2935 new_edits=false correct number
    ✓ #2935 new_edits=false correct number 2
    ✓ bulk docs update then delete then conflict
    ✓ bulk_docs delete then undelete
    ✓ #2935 new_edits=false with single unauthorized
    ✓ Deleting _local docs with bulkDocs
    ✓ Deleting _local docs with bulkDocs, not found
    ✓ Deleting _local docs with bulkDocs, wrong rev
    ✓ Bulk with new_edits=false
    ✓ Testing successive new_edits to the same doc
    ✓ #3062 bulkDocs with staggered seqs
    ✓ Testing successive new_edits to the same doc, different content
    ✓ Testing successive new_edits to two doc
    ✓ Deletion with new_edits=false
    ✓ Deletion with new_edits=false, no history
    ✓ Modification with new_edits=false, no history
    ✓ Deletion with new_edits=false, no history, no revisions
    ✓ Testing new_edits=false in req body
    ✓ 656 regression in handling deleted docs
    ✓ Test quotes in doc ids
    ✓ Bulk docs empty list
    ✓ handles simultaneous writes
    ✓ bulk docs input by array
    ✓ Bulk empty list
    ✓ Bulk docs not an array
    ✓ Bulk docs not an object
    ✓ Bulk docs two different revisions to same document id
    ✓ 4204 respect revs_limit (263ms)
    ✓ 2839 implement revs_limit (185ms)
    ✓ 4372 revs_limit deletes old revisions of the doc
    ✓ 4372 revs_limit with auto_compaction deletes old revisions of the doc
    ✓ 4712 invalid rev for new doc generates conflict
    ✓ 5793 bulk docs accepts _conflicts when new_edits=false

  test.bulk_docs.js-http
    ✓ Testing bulk docs
    ✓ #6039 test id in bulk docs for conflict
    ✓ No id in bulk docs
    ✓ No _rev and new_edits=false
    ✓ 7829 bare rev 1- with new_edits=false
    ✓ Test empty bulkDocs
    ✓ Test many bulkDocs
    ✓ Test errors on invalid doc id
    ✓ Test two errors on invalid doc id
    ✓ No docs
    ✓ Jira 911
    ✓ Test multiple bulkdocs
    ✓ #2935 new_edits=false correct number
    ✓ #2935 new_edits=false correct number 2
    ✓ bulk docs update then delete then conflict
    ✓ bulk_docs delete then undelete
    ✓ #2935 new_edits=false with single unauthorized
    ✓ Deleting _local docs with bulkDocs (47ms)
    ✓ Bulk with new_edits=false (41ms)
    ✓ Testing successive new_edits to the same doc
    ✓ #3062 bulkDocs with staggered seqs
    ✓ Testing successive new_edits to the same doc, different content
    ✓ Testing successive new_edits to two doc
    ✓ Deletion with new_edits=false
    ✓ Deletion with new_edits=false, no history
    ✓ Modification with new_edits=false, no history
    ✓ Deletion with new_edits=false, no history, no revisions
    ✓ Testing new_edits=false in req body
    ✓ 656 regression in handling deleted docs
    ✓ Test quotes in doc ids
    ✓ Bulk docs empty list
    ✓ handles simultaneous writes
    ✓ bulk docs input by array
    ✓ Bulk empty list
    ✓ Bulk docs not an array
    ✓ Bulk docs not an object
    ✓ Bulk docs two different revisions to same document id
    ✓ 4204 respect revs_limit (292ms)
    ✓ 2839 implement revs_limit
    ✓ 4372 revs_limit deletes old revisions of the doc
    ✓ 4372 revs_limit with auto_compaction deletes old revisions of the doc
    ✓ 4712 invalid rev for new doc generates conflict
    ✓ 5793 bulk docs accepts _conflicts when new_edits=false (42ms)

  test.bulk_get.js-http
    ✓ test bulk get with rev specified
    ✓ test bulk get with latest=true
    ✓ test bulk get with no rev specified (38ms)
    ✓ _revisions is not returned by default
    ✓ #5886 bulkGet with reserved id
    ✓ _revisions is returned when specified
    ✓ _revisions is returned when specified, using implicit rev
    ✓ attachments are not included by default
    ✓ attachments are included when specified
    ✓ attachments are included when specified, using implicit rev

  test.bulk_get.js-local
    ✓ test bulk get with rev specified
    ✓ test bulk get with latest=true
    ✓ test bulk get with no rev specified
    ✓ _revisions is not returned by default
    ✓ #5886 bulkGet with reserved id
    ✓ _revisions is returned when specified
    ✓ _revisions is returned when specified, using implicit rev
    ✓ attachments are not included by default
    ✓ attachments are included when specified
    ✓ attachments are included when specified, using implicit rev

  test.changes.js-http
    ✓ All changes
    ✓ Changes with complete callback as param
    ✓ Promise resolved when changes cancelled
    - Live changes should clean listener when cancelled
    ✓ Changes Since
    ✓ Changes Since and limit limit 1
    ✓ Changes Since and limit limit 0
    ✓ Changes limit (39ms)
    ✓ Changes with filter not present in ddoc
    ✓ Changes with `filters` key not present in ddoc
    ✓ Changes limit and filter
    ✓ Changes with shorthand function name
    ✓ Changes with filter from nonexistent ddoc
    ✓ Changes with view not present in ddoc
    ✓ Changes with `views` key not present in ddoc
    ✓ #4451 Changes with invalid view filter
    ✓ 3356 throw inside a filter
    ✓ Changes with missing param `view` in request (41ms)
    ✓ Changes limit and view instead of filter
    ✓ #3609 view option implies filter: _view
    ✓ Immediately cancel changes
    ✓ Changes with invalid ddoc view name
    ✓ Changes with invalid ddoc view name 2
    ✓ Changes with style = all_docs (69ms)
    ✓ Changes with style = all_docs and a callback for complete (56ms)
    ✓ Changes limit = 0
    ✓ Changes doc
    - Descending many changes
    ✓ live-changes
    ✓ Multiple watchers
    ✓ Continuous changes doc
    ✓ Cancel changes (326ms)
    ✓ #3579 changes firing 1 too many times (78ms)
    ✓ Kill database while listening to live changes
    ✓ #3136 style=all_docs
    ✓ #4191 revs_diff causes endless loop
    ✓ #3136 style=all_docs & include_docs
    ✓ changes-filter with query params
    ✓ Non-live changes filter
    ✓ Non-live changes filter, descending
    ✓ #2569 Non-live doc_ids filter
    ✓ #2569 Big non-live doc_ids filter
    ✓ #2569 Live doc_ids filter
    ✓ #2569 Big live doc_ids filter
    ✓ #2569 Non-live doc_ids filter with filter=_doc_ids
    ✓ #2569 Live doc_ids filter with filter=_doc_ids
    ✓ Changes to same doc are grouped
    ✓ Changes with conflicts are handled correctly (142ms)
    ✓ Change entry for a deleted doc
    ✓ changes large number of docs (40ms)
    ✓ Calling db.changes({since: 'now'})
    ✓ Calling db.changes({since: 'latest'})
    ✓ Closing db does not cause a crash if changes cancelled (39ms)
    ✓ fire-complete-on-cancel (100ms)
    ✓ changes are not duplicated (1024ms)
    ✓ supports return_docs=false
    ✓ should respects limit (76ms)
    ✓ doesn't throw if opts.complete is undefined
    ✓ handle individual changes in live replication (199ms)
    ✓ changes-filter without filter
    ✓ #3539 - Exception in changes is fine
    ✓ Changes with selector
    ✓ Changes with selector, explicit filter
    ✓ Changes with selector and mismatched filter
    ✓ Changes with limit and selector

  test.changes.js-local
    ✓ All changes
    ✓ Changes with complete callback as param
    ✓ Promise resolved when changes cancelled
    - Live changes should clean listener when cancelled
    ✓ Changes Since
    ✓ Changes Since and limit limit 1
    ✓ Changes Since and limit limit 0
    ✓ Changes limit
    ✓ Changes with filter not present in ddoc
    ✓ Changes with `filters` key not present in ddoc
    ✓ Changes limit and filter
    ✓ Changes with shorthand function name
    ✓ Changes with filter from nonexistent ddoc
    ✓ Changes with view not present in ddoc
    ✓ Changes with `views` key not present in ddoc
    ✓ #4451 Changes with invalid view filter
    ✓ 3356 throw inside a filter
    ✓ Changes with missing param `view` in request
    ✓ Changes limit and view instead of filter
    ✓ #3609 view option implies filter: _view
    ✓ Immediately cancel changes
    ✓ Changes with invalid ddoc view name
    ✓ Changes with invalid ddoc view name 2
    ✓ Changes with style = all_docs
    ✓ Changes with style = all_docs and a callback for complete
    ✓ Changes limit = 0
    ✓ Changes doc
    - Descending many changes
    ✓ live-changes
    ✓ Multiple watchers
    ✓ Continuous changes doc
    ✓ Cancel changes (315ms)
    ✓ #3579 changes firing 1 too many times (66ms)
    ✓ Kill database while listening to live changes
    ✓ #3136 style=all_docs
    ✓ #4191 revs_diff causes endless loop
    ✓ #3136 style=all_docs & include_docs
    ✓ changes-filter with query params
    ✓ Non-live changes filter
    ✓ Non-live changes filter, descending
    ✓ #2569 Non-live doc_ids filter
    ✓ #2569 Big non-live doc_ids filter
    ✓ #2569 Live doc_ids filter
    ✓ #2569 Big live doc_ids filter
    ✓ #2569 Non-live doc_ids filter with filter=_doc_ids
    ✓ #2569 Live doc_ids filter with filter=_doc_ids
    ✓ Changes to same doc are grouped
    ✓ Changes with conflicts are handled correctly
    ✓ Change entry for a deleted doc
    ✓ changes large number of docs
    ✓ Calling db.changes({since: 'now'})
    ✓ Calling db.changes({since: 'latest'})
    ✓ Closing db does not cause a crash if changes cancelled (38ms)
    ✓ fire-complete-on-cancel (100ms)
    ✓ changes are not duplicated (1019ms)
    ✓ supports return_docs=false
    ✓ should respects limit (67ms)
    ✓ doesn't throw if opts.complete is undefined
    ✓ handle individual changes in live replication (71ms)
    ✓ changes-filter without filter
    ✓ #3539 - Exception in changes is fine
    ✓ Changes with selector
    ✓ Changes with selector, explicit filter
    ✓ Changes with selector and mismatched filter
    ✓ Changes with limit and selector

  changes-standalone
    - Changes reports errors

  test.close.js-local
    ✓ should emit destroyed even when closed (sync)
    ✓ should emit destroyed even when closed (async)
precondition_failed: Database not open
    at Object.<anonymous> (/data/js-variants/multee/Clients/levelup/pouchdb/packages/node_modules/pouchdb/lib/index.js:614:16)
    at Module._compile (node:internal/modules/cjs/loader:1105:14)
    at Module._extensions..js (node:internal/modules/cjs/loader:1159:10)
    at Module.load (node:internal/modules/cjs/loader:981:32)
    at Module._load (node:internal/modules/cjs/loader:827:12)
    at Module.require (node:internal/modules/cjs/loader:1005:19)
    at require (node:internal/modules/cjs/helpers:102:18)
    at commonUtils.loadPouchDBForNode (/data/js-variants/multee/Clients/levelup/pouchdb/tests/common-utils.js:92:17)
    at commonUtils.loadPouchDB (/data/js-variants/multee/Clients/levelup/pouchdb/tests/common-utils.js:78:39)
    at Object.<anonymous> (/data/js-variants/multee/Clients/levelup/pouchdb/tests/integration/node.setup.js:21:28)
    at Module._compile (node:internal/modules/cjs/loader:1105:14)
    at Module._extensions..js (node:internal/modules/cjs/loader:1159:10)
    at Module.load (node:internal/modules/cjs/loader:981:32)
    at Module._load (node:internal/modules/cjs/loader:827:12)
    at Module.require (node:internal/modules/cjs/loader:1005:19)
    at require (node:internal/modules/cjs/helpers:102:18)
    at /data/js-variants/multee/Clients/levelup/pouchdb/node_modules/mocha/bin/_mocha:366:3
    at Array.forEach (<anonymous>)
    at Object.<anonymous> (/data/js-variants/multee/Clients/levelup/pouchdb/node_modules/mocha/bin/_mocha:365:10)
    at Module._compile (node:internal/modules/cjs/loader:1105:14)
    at Module._extensions..js (node:internal/modules/cjs/loader:1159:10)
    at Module.load (node:internal/modules/cjs/loader:981:32)
    at Module._load (node:internal/modules/cjs/loader:827:12)
    at Function.executeUserEntryPoint [as runMain] (node:internal/modules/run_main:77:12)
    at node:internal/main/run_main_module:17:47
    ✓ should emit closed even when destroyed (async #2)
precondition_failed: Database not open
    at Object.<anonymous> (/data/js-variants/multee/Clients/levelup/pouchdb/packages/node_modules/pouchdb/lib/index.js:614:16)
    at Module._compile (node:internal/modules/cjs/loader:1105:14)
    at Module._extensions..js (node:internal/modules/cjs/loader:1159:10)
    at Module.load (node:internal/modules/cjs/loader:981:32)
    at Module._load (node:internal/modules/cjs/loader:827:12)
    at Module.require (node:internal/modules/cjs/loader:1005:19)
    at require (node:internal/modules/cjs/helpers:102:18)
    at commonUtils.loadPouchDBForNode (/data/js-variants/multee/Clients/levelup/pouchdb/tests/common-utils.js:92:17)
    at commonUtils.loadPouchDB (/data/js-variants/multee/Clients/levelup/pouchdb/tests/common-utils.js:78:39)
    at Object.<anonymous> (/data/js-variants/multee/Clients/levelup/pouchdb/tests/integration/node.setup.js:21:28)
    at Module._compile (node:internal/modules/cjs/loader:1105:14)
    at Module._extensions..js (node:internal/modules/cjs/loader:1159:10)
    at Module.load (node:internal/modules/cjs/loader:981:32)
    at Module._load (node:internal/modules/cjs/loader:827:12)
    at Module.require (node:internal/modules/cjs/loader:1005:19)
    at require (node:internal/modules/cjs/helpers:102:18)
    at /data/js-variants/multee/Clients/levelup/pouchdb/node_modules/mocha/bin/_mocha:366:3
    at Array.forEach (<anonymous>)
    at Object.<anonymous> (/data/js-variants/multee/Clients/levelup/pouchdb/node_modules/mocha/bin/_mocha:365:10)
    at Module._compile (node:internal/modules/cjs/loader:1105:14)
    at Module._extensions..js (node:internal/modules/cjs/loader:1159:10)
    at Module.load (node:internal/modules/cjs/loader:981:32)
    at Module._load (node:internal/modules/cjs/loader:827:12)
    at Function.executeUserEntryPoint [as runMain] (node:internal/modules/run_main:77:12)
    at node:internal/main/run_main_module:17:47
    ✓ test unref for coverage
    ✓ test double unref for coverage
precondition_failed: Database not open
    at Object.<anonymous> (/data/js-variants/multee/Clients/levelup/pouchdb/packages/node_modules/pouchdb/lib/index.js:614:16)
    at Module._compile (node:internal/modules/cjs/loader:1105:14)
    at Module._extensions..js (node:internal/modules/cjs/loader:1159:10)
    at Module.load (node:internal/modules/cjs/loader:981:32)
    at Module._load (node:internal/modules/cjs/loader:827:12)
    at Module.require (node:internal/modules/cjs/loader:1005:19)
    at require (node:internal/modules/cjs/helpers:102:18)
    at commonUtils.loadPouchDBForNode (/data/js-variants/multee/Clients/levelup/pouchdb/tests/common-utils.js:92:17)
    at commonUtils.loadPouchDB (/data/js-variants/multee/Clients/levelup/pouchdb/tests/common-utils.js:78:39)
    at Object.<anonymous> (/data/js-variants/multee/Clients/levelup/pouchdb/tests/integration/node.setup.js:21:28)
    at Module._compile (node:internal/modules/cjs/loader:1105:14)
    at Module._extensions..js (node:internal/modules/cjs/loader:1159:10)
    at Module.load (node:internal/modules/cjs/loader:981:32)
    at Module._load (node:internal/modules/cjs/loader:827:12)
    at Module.require (node:internal/modules/cjs/loader:1005:19)
    at require (node:internal/modules/cjs/helpers:102:18)
    at /data/js-variants/multee/Clients/levelup/pouchdb/node_modules/mocha/bin/_mocha:366:3
    at Array.forEach (<anonymous>)
    at Object.<anonymous> (/data/js-variants/multee/Clients/levelup/pouchdb/node_modules/mocha/bin/_mocha:365:10)
    at Module._compile (node:internal/modules/cjs/loader:1105:14)
    at Module._extensions..js (node:internal/modules/cjs/loader:1159:10)
    at Module.load (node:internal/modules/cjs/loader:981:32)
    at Module._load (node:internal/modules/cjs/loader:827:12)
    at Function.executeUserEntryPoint [as runMain] (node:internal/modules/run_main:77:12)
    at node:internal/main/run_main_module:17:47
    ✓ test close-then-destroyed for coverage
************* run test done *************
pouchdb is testing ./Variants/levelup/variant9/levelup
/data/js-variants/multee
************* npm unlink module *************

removed 1 package, changed 1 package, and audited 1032 packages in 4s

64 packages are looking for funding
  run `npm fund` for details

41 vulnerabilities (1 low, 9 moderate, 25 high, 6 critical)

To address issues that do not require attention, run:
  npm audit fix

To address all issues possible (including breaking changes), run:
  npm audit fix --force

Some issues need review, and may require choosing
a different dependency.

Run `npm audit` for details.
************* npm unlink module done *************
************* npm unlink globally *************

removed 1 package, and audited 1 package in 1s

found 0 vulnerabilities
************* npm unlink globally done *************
************* npm link globally *************

added 1 package, and audited 3 packages in 425ms

found 0 vulnerabilities
************* npm link globally done *************
************* npm link module *************

added 1 package, changed 1 package, and audited 1034 packages in 4s

64 packages are looking for funding
  run `npm fund` for details

41 vulnerabilities (1 low, 9 moderate, 25 high, 6 critical)

To address issues that do not require attention, run:
  npm audit fix

To address all issues possible (including breaking changes), run:
  npm audit fix --force

Some issues need review, and may require choosing
a different dependency.

Run `npm audit` for details.
************* npm link module done *************
************* start run test *************

> pouchdb-monorepo@7.0.0-prerelease test
> bash bin/run-test.sh


> pouchdb-monorepo@7.0.0-prerelease build-node
> bash bin/build-node.sh


> pouchdb-monorepo@7.0.0-prerelease build-modules
> node bin/build-modules.js

Building pouchdb...
Building pouchdb-abstract-mapreduce...
Building pouchdb-adapter-http...
Building pouchdb-adapter-idb...
Building pouchdb-adapter-indexeddb...
Building pouchdb-adapter-leveldb...
Building pouchdb-adapter-leveldb-core...
Building pouchdb-adapter-localstorage...
Building pouchdb-adapter-memory...
Building pouchdb-adapter-utils...
Building pouchdb-binary-utils...
Building pouchdb-browser...
Building pouchdb-changes-filter...
Building pouchdb-checkpointer...
Building pouchdb-collate...
Building pouchdb-collections...
Building pouchdb-core...
Building pouchdb-errors...
Building pouchdb-fetch...
Building pouchdb-find...
Building pouchdb-for-coverage...
Building pouchdb-generate-replication-id...
Building pouchdb-json...
Building pouchdb-mapreduce...
Building pouchdb-mapreduce-utils...
Building pouchdb-md5...
Building pouchdb-merge...
Building pouchdb-node...
Building pouchdb-replication...
Building pouchdb-selector-core...
Building pouchdb-utils...
Building sublevel-pouchdb...
  ✓ wrote pouchdb-adapter-localstorage/lib/index.js in vanilla mode
  ✓ wrote pouchdb-adapter-localstorage/lib/index.es.js in vanilla mode
  ✓ wrote pouchdb-adapter-memory/lib/index.js in vanilla mode
  ✓ wrote pouchdb-adapter-memory/lib/index.es.js in vanilla mode
  ✓ wrote pouchdb-checkpointer/lib/index.js in vanilla mode
  ✓ wrote pouchdb-checkpointer/lib/index.es.js in vanilla mode
  ✓ wrote pouchdb-errors/lib/index.js in vanilla mode
  ✓ wrote pouchdb-errors/lib/index.es.js in vanilla mode
  ✓ wrote pouchdb-generate-replication-id/lib/index.js in vanilla mode
  ✓ wrote pouchdb-generate-replication-id/lib/index.es.js in vanilla mode
  ✓ wrote pouchdb-adapter-http/lib/index.js in vanilla mode
  ✓ wrote pouchdb-adapter-http/lib/index.es.js in vanilla mode
  ✓ wrote pouchdb-adapter-leveldb-core/lib/index.js in node mode
  ✓ wrote pouchdb-adapter-leveldb-core/lib/index.es.js in node mode
  ✓ wrote pouchdb-adapter-leveldb-core/lib/index-browser.js in browser mode
  ✓ wrote pouchdb-adapter-leveldb-core/lib/index-browser.es.js in browser mode
  ✓ wrote pouchdb-adapter-leveldb/lib/index.js in node mode
  ✓ wrote pouchdb-adapter-leveldb/lib/index.es.js in node mode
  ✓ wrote pouchdb-adapter-leveldb/lib/index-browser.js in browser mode
  ✓ wrote pouchdb-adapter-leveldb/lib/index-browser.es.js in browser mode
  ✓ wrote pouchdb-changes-filter/lib/index-browser.js in browser mode
  ✓ wrote pouchdb-changes-filter/lib/index-browser.es.js in browser mode
  ✓ wrote pouchdb-fetch/lib/index-browser.js in browser mode
  ✓ wrote pouchdb-fetch/lib/index-browser.es.js in browser mode
  ✓ wrote pouchdb-md5/lib/index-browser.js in browser mode
  ✓ wrote pouchdb-md5/lib/index-browser.es.js in browser mode
  ✓ wrote pouchdb-changes-filter/lib/index.js in node mode
  ✓ wrote pouchdb-changes-filter/lib/index.es.js in node mode
  ✓ wrote pouchdb-collate/lib/index.js in vanilla mode
  ✓ wrote pouchdb-collate/lib/index.es.js in vanilla mode
  ✓ wrote pouchdb-fetch/lib/index.js in node mode
  ✓ wrote pouchdb-fetch/lib/index.es.js in node mode
  ✓ wrote pouchdb-json/lib/index.js in vanilla mode
  ✓ wrote pouchdb-json/lib/index.es.js in vanilla mode
  ✓ wrote pouchdb-md5/lib/index.js in node mode
  ✓ wrote pouchdb-md5/lib/index.es.js in node mode
  ✓ wrote pouchdb-mapreduce-utils/lib/index.js in vanilla mode
  ✓ wrote pouchdb-mapreduce-utils/lib/index.es.js in vanilla mode
  ✓ wrote pouchdb-abstract-mapreduce/lib/index.js in vanilla mode
  ✓ wrote pouchdb-abstract-mapreduce/lib/index.es.js in vanilla mode
  ✓ wrote pouchdb-adapter-indexeddb/lib/index.js in vanilla mode
  ✓ wrote pouchdb-adapter-indexeddb/lib/index.es.js in vanilla mode
  ✓ wrote pouchdb-adapter-idb/lib/index.js in vanilla mode
  ✓ wrote pouchdb-adapter-idb/lib/index.es.js in vanilla mode
  ✓ wrote pouchdb-binary-utils/lib/index-browser.js in browser mode
  ✓ wrote pouchdb-binary-utils/lib/index-browser.es.js in browser mode
  ✓ wrote pouchdb-utils/lib/index-browser.js in browser mode
  ✓ wrote pouchdb-utils/lib/index-browser.es.js in browser mode
  ✓ wrote pouchdb-utils/lib/index.js in node mode
  ✓ wrote pouchdb-utils/lib/index.es.js in node mode
  ✓ wrote pouchdb-binary-utils/lib/index.js in node mode
  ✓ wrote pouchdb-binary-utils/lib/index.es.js in node mode
  ✓ wrote pouchdb-adapter-utils/lib/index.js in vanilla mode
  ✓ wrote pouchdb-adapter-utils/lib/index.es.js in vanilla mode
  ✓ wrote pouchdb-collections/lib/index.js in vanilla mode
  ✓ wrote pouchdb-collections/lib/index.es.js in vanilla mode
  ✓ wrote pouchdb-merge/lib/index.js in vanilla mode
  ✓ wrote pouchdb-merge/lib/index.es.js in vanilla mode
  ✓ wrote pouchdb-selector-core/lib/index.js in vanilla mode
  ✓ wrote pouchdb-selector-core/lib/index.es.js in vanilla mode
  ✓ wrote sublevel-pouchdb/lib/index.js in vanilla mode
  ✓ wrote sublevel-pouchdb/lib/index.es.js in vanilla mode
  ✓ wrote pouchdb-mapreduce/lib/index-browser.js in browser mode
  ✓ wrote pouchdb-mapreduce/lib/index-browser.es.js in browser mode
  ✓ wrote pouchdb-replication/lib/index.js in vanilla mode
  ✓ wrote pouchdb-replication/lib/index.es.js in vanilla mode
  ✓ wrote pouchdb-mapreduce/lib/index.js in node mode
  ✓ wrote pouchdb-mapreduce/lib/index.es.js in node mode
  ✓ wrote pouchdb-core/lib/index.js in vanilla mode
  ✓ wrote pouchdb-core/lib/index.es.js in vanilla mode
  ✓ wrote pouchdb-find/lib/index.js in node mode
  ✓ wrote pouchdb-find/lib/index.es.js in node mode
  ✓ wrote pouchdb-find/lib/index-browser.js in browser mode
  ✓ wrote pouchdb-find/lib/index-browser.es.js in browser mode
  ✓ wrote pouchdb-for-coverage/lib/index.js in node mode
  ✓ wrote pouchdb-for-coverage/lib/index.es.js in node mode
  ✓ wrote pouchdb-for-coverage/lib/index-browser.js in browser mode
  ✓ wrote pouchdb-for-coverage/lib/index-browser.es.js in browser mode
  ✓ wrote pouchdb-browser/lib/index.js in vanilla mode
  ✓ wrote pouchdb-browser/lib/index.es.js in vanilla mode
  ✓ wrote pouchdb-node/lib/index.js in vanilla mode
  ✓ wrote pouchdb-node/lib/index.es.js in vanilla mode
  ✓ wrote packages/node_modules/pouchdb/lib/index.js
  ✓ wrote packages/node_modules/pouchdb/lib/index.es.js
Waiting for host to start ..
Host started :)
> pouchdb-monorepo@7.0.0-prerelease test-node
> bash bin/test-node.sh

Down server listening on port 3010
Seeded with: 1660142963928


  DB Setup
    ✓ PouchDB has a version
    ✓ PouchDB version matches package.json

  test.active_tasks.js
    ✓ Can add a task
    ✓ Can get tasks by id
    ✓ Can get all tasks
    ✓ Can update a task
    ✓ Can remove a task

  test.all_docs.js-http
    ✓ Testing all docs (175ms)
    ✓ Testing allDocs opts.keys (66ms)
    ✓ Testing allDocs opts.keys with skip
    ✓ Testing allDocs opts.keys with limit
    ✓ Testing allDocs invalid opts.keys
    ✓ Testing deleting in changes (45ms)
    ✓ Testing updating in changes (62ms)
    ✓ Testing include docs (40ms)
    ✓ Testing conflicts (50ms)
    ✓ test basic collation
    ✓ 3883 start_key end_key aliases
    ✓ test total_rows with a variety of criteria (147ms)
    ✓ test total_rows with both skip and limit (38ms)
    ✓ test limit option and total_rows
    ✓ test escaped startkey/endkey
    ✓ test "key" option
    ✓ test inclusive_end=false (59ms)
    ✓ test descending with startkey/endkey
    ✓ #3082 test wrong num results returned (257ms)
    ✓ test empty db
    ✓ test after db close
    ✓ 5793 _conflicts should not exist if no conflicts
    ✓ #6230 Test allDocs opts update_seq: false
    ✓ #6230 Test allDocs opts update_seq: true
    ✓ #6230 Test allDocs opts with update_seq missing

  test.all_docs.js-local
    ✓ Testing all docs
    ✓ Testing allDocs opts.keys
    ✓ Testing allDocs opts.keys with skip
    ✓ Testing allDocs opts.keys with limit
    ✓ Testing allDocs invalid opts.keys
    ✓ Testing deleting in changes
    ✓ Testing updating in changes
    ✓ Testing include docs
    ✓ Testing conflicts
    ✓ test basic collation
    ✓ 3883 start_key end_key aliases
    ✓ test total_rows with a variety of criteria
    ✓ test total_rows with both skip and limit
    ✓ test limit option and total_rows
    ✓ test escaped startkey/endkey
    ✓ test "key" option
    ✓ test inclusive_end=false (61ms)
    ✓ test descending with startkey/endkey (61ms)
    ✓ #3082 test wrong num results returned (208ms)
    ✓ test empty db
    ✓ test after db close
    ✓ test unicode ids and revs
    ✓ 5793 _conflicts should not exist if no conflicts
    ✓ #6230 Test allDocs opts update_seq: false
    ✓ #6230 Test allDocs opts update_seq: true
    ✓ #6230 Test allDocs opts with update_seq missing

  suite2 test.attachments.js-local
    ✓ 3357 Attachment names cant start with _
    ✓ 5736 warning for putAttachment without content_type
    ✓ 5736 warning for bulkDocs attachments without content_type
    ✓ fetch atts with open_revs and missing
    ✓ issue 2803 should throw 412
    ✓ issue 2803 should throw 412 part 2
    ✓ issue 2803 should throw 412 part 3
    ✓ issue 2803 should throw 412 part 4 (56ms)
    ✓ #2858 {binary: true} in get() (87ms)
    ✓ #2858 {binary: true} in allDocs() 1
    ✓ #2858 {binary: true} in allDocs() 2
    ✓ #2858 {binary: true} in allDocs() 3 (38ms)
    ✓ #2858 {binary: true} in allDocs() 4
    ✓ #2858 {binary: true} in allDocs() 5
    ✓ #2858 {binary: true} in allDocs(), many atts
    ✓ #2858 {binary: true} in allDocs(), mixed atts
    ✓ #2858 {binary: true} in changes() non-live
    ✓ #2858 {binary: true} in changes() non-live, many atts
    ✓ #2858 {binary: true} in changes() non-live, mixed atts
    ✓ #2858 {binary: true} non-live changes, complete event
    ✓ #2858 {binary: true} in live changes
    ✓ #2858 {binary: true} in live changes, mixed atts
    ✓ #2858 {binary: true} in live+retry changes
    ✓ #2858 {binary: true} in live changes, attachments:false
    ✓ #2858 {binary: true} in live changes, include_docs:false
    ✓ #6736 {binary: true} in bulkGet()
    ✓ Measures length correctly after put()
    ✓ #3074 non-live changes()
    ✓ #3074 live changes()
    ✓ #3074 non-live changes(), no attachments
    ✓ #3074 live changes(), no attachments
    ✓ #3881 filter extraneous keys from _attachments
    ✓ #2771 allDocs() 1, single attachment
    ✓ #2771 allDocs() 2, many docs same att
    ✓ #2771 allDocs() 3, many docs diff atts
    ✓ #2771 allDocs() 4, mix of atts and no atts
    ✓ #2771 allDocs() 5, no atts
    ✓ #2771 allDocs() 6, no docs
    ✓ #2771 allDocs() 7, revisions and deletions
    ✓ #2771 allDocs() 8, empty attachment
    ✓ No length for non-stubs
    ✓ Test some attachments
    ✓ Test getAttachment
    ✓ Test getAttachment with stubs
    ✓ Test get() with binary:true and stubs
    ✓ Test attachments in allDocs/changes
    ✓ Test putAttachment with base64 plaintext
    ✓ Test putAttachment with invalid base64
    ✓ Test getAttachment with empty text (41ms)
    ✓ Test getAttachment with normal text
    ✓ Test getAttachment with PNG
    ✓ Test getAttachment with PNG using bulkDocs
    ✓ Test getAttachment with PNG using post
    ✓ Test postAttachment with PNG then bulkDocs
    ✓ proper stub behavior
    ✓ Testing with invalid docs
    ✓ Test create attachment and doc in one go
    ✓ Test create attachment and doc in one go without callback
    ✓ Test create attachment without callback
    ✓ Test put attachment on a doc without attachments
    ✓ Test put attachment with unencoded name
    ✓ 3963 length property on stubs
    ✓ Testing with invalid rev
    ✓ Test put another attachment on a doc with attachments
    ✓ Test get with attachments: true if empty attachments
    ✓ Test delete attachment from a doc
    ✓ Test a document with a json string attachment
    ✓ Test remove doc with attachment
    ✓ Try to insert a doc with unencoded attachment
    ✓ Try to get attachment of unexistent doc (42ms)
    ✓ Test synchronous putAttachment with text data
    ✓ Test synchronous putAttachment with no text data
    ✓ Test put with partial stubs
    ✓ Test put with attachments and new_edits=false
    ✓ Test getAttachment with specific rev
    ✓ Test getAttachment with diff revs and content
    ✓ Test stubs
    ✓ Try to get unexistent attachment of some doc
    ✓ putAttachment and getAttachment with plaintext
    ✓ putAttachment and getAttachment with png data
    ✓ putAttachment in new doc with base64 (38ms)
    ✓ #2818 - save same attachment in different revs (51ms)
    ✓ #2818 - save same attachment many times in parallel
    ✓ #2818 - revisions keep attachments (no compaction)
    ✓ #2818 - doesn't throw 409 if same filename
    ✓ #3008 test correct encoding/decoding of \u0000 etc.
    ✓ putAttachment and getAttachment with big png data (99ms)
    ✓ #2709 `revpos` with putAttachment
    ✓ #2709 `revpos` with inline attachment
    ✓ #2709 `revpos` with allDocs
    ✓ #7403 {attachments: true, binary: true, include_docs: true} in allDocs with one missing doc

  suite2 test.attachments.js-http
    ✓ 3357 Attachment names cant start with _
    ✓ 5736 warning for putAttachment without content_type
    ✓ 5736 warning for bulkDocs attachments without content_type
    ✓ fetch atts with open_revs and missing
    ✓ issue 2803 should throw 412
    ✓ issue 2803 should throw 412 part 2 (69ms)
    ✓ issue 2803 should throw 412 part 3 (40ms)
    ✓ issue 2803 should throw 412 part 4 (39ms)
    ✓ #2858 {binary: true} in get() (38ms)
    ✓ #2858 {binary: true} in allDocs() 1 (46ms)
    ✓ #2858 {binary: true} in allDocs() 2 (40ms)
    ✓ #2858 {binary: true} in allDocs() 3 (49ms)
    ✓ #2858 {binary: true} in allDocs() 4 (38ms)
    ✓ #2858 {binary: true} in allDocs() 5
    ✓ #2858 {binary: true} in allDocs(), many atts
    ✓ #2858 {binary: true} in allDocs(), mixed atts
    ✓ #2858 {binary: true} in changes() non-live
    ✓ #2858 {binary: true} in changes() non-live, many atts (40ms)
    ✓ #2858 {binary: true} in changes() non-live, mixed atts (44ms)
    ✓ #2858 {binary: true} non-live changes, complete event
    ✓ #2858 {binary: true} in live changes (38ms)
    ✓ #2858 {binary: true} in live changes, mixed atts
    ✓ #2858 {binary: true} in live+retry changes
    ✓ #2858 {binary: true} in live changes, attachments:false
    ✓ #2858 {binary: true} in live changes, include_docs:false (38ms)
    ✓ #6736 {binary: true} in bulkGet()
    ✓ Measures length correctly after put()
    ✓ #3074 non-live changes() (39ms)
    ✓ #3074 live changes() (41ms)
    ✓ #3074 non-live changes(), no attachments
    ✓ #3074 live changes(), no attachments
    ✓ #3881 filter extraneous keys from _attachments
    ✓ #2771 allDocs() 1, single attachment
    ✓ #2771 allDocs() 2, many docs same att
    ✓ #2771 allDocs() 3, many docs diff atts
    ✓ #2771 allDocs() 4, mix of atts and no atts
    ✓ #2771 allDocs() 5, no atts
    ✓ #2771 allDocs() 6, no docs
    ✓ #2771 allDocs() 7, revisions and deletions
    ✓ #2771 allDocs() 8, empty attachment
    ✓ No length for non-stubs (48ms)
    ✓ Test some attachments (45ms)
    ✓ Test getAttachment
    ✓ Test getAttachment with stubs
    ✓ Test get() with binary:true and stubs
    ✓ Test attachments in allDocs/changes
    ✓ Test putAttachment with base64 plaintext
    ✓ Test putAttachment with invalid base64
    ✓ Test getAttachment with empty text
    ✓ Test getAttachment with normal text
    ✓ Test getAttachment with PNG
    ✓ Test getAttachment with PNG using bulkDocs
    ✓ Test getAttachment with PNG using post
    ✓ Test postAttachment with PNG then bulkDocs
    ✓ proper stub behavior
    ✓ Testing with invalid docs
    ✓ Test create attachment and doc in one go
    ✓ Test create attachment and doc in one go without callback
    ✓ Test create attachment without callback (38ms)
    ✓ Test put attachment on a doc without attachments
    ✓ Test put attachment with unencoded name
    ✓ 3963 length property on stubs (48ms)
    ✓ Testing with invalid rev
    ✓ Test put another attachment on a doc with attachments
    ✓ Test get with attachments: true if empty attachments
    ✓ Test delete attachment from a doc (55ms)
    ✓ Test a document with a json string attachment
    ✓ Test remove doc with attachment
    ✓ Try to insert a doc with unencoded attachment
    ✓ Try to get attachment of unexistent doc
    ✓ Test synchronous putAttachment with text data
    ✓ Test synchronous putAttachment with no text data
    ✓ Test put with partial stubs
    ✓ Test put with attachments and new_edits=false (38ms)
    ✓ Test getAttachment with specific rev (38ms)
    ✓ Test getAttachment with diff revs and content (38ms)
    ✓ Test stubs
    ✓ Try to get unexistent attachment of some doc
    ✓ putAttachment and getAttachment with plaintext (46ms)
    ✓ putAttachment and getAttachment with png data
    ✓ putAttachment in new doc with base64
    ✓ #2818 - save same attachment in different revs (46ms)
    ✓ #2818 - save same attachment many times in parallel
    ✓ #2818 - revisions keep attachments (no compaction) (42ms)
    ✓ #2818 - doesn't throw 409 if same filename
    ✓ #3008 test correct encoding/decoding of \u0000 etc.
    ✓ putAttachment and getAttachment with big png data (131ms)
    ✓ #2709 `revpos` with putAttachment (40ms)
    ✓ #2709 `revpos` with inline attachment
    ✓ #2709 `revpos` with allDocs
    ✓ #7403 {attachments: true, binary: true, include_docs: true} in allDocs with one missing doc

  suite2 test.attachments.js- local:http
    ✓ Attachments replicate back and forth (113ms)
    ✓ Replicate same doc, same atts (111ms)
    ✓ Replicate same doc, same atts 2 (114ms)
    ✓ Attachments replicate (80ms)
    ✓ Attachment types replicate (60ms)
    ✓ Many many attachments replicate (190ms)
    ✓ Many many png attachments replicate (255ms)
    ✓ Multiple attachments replicate (94ms)
    - #3961 Many attachments on same doc
    ✓ Multiple attachments replicate, different docs (#2698) (81ms)
    ✓ Multiple attachments replicate, different docs png (#2698) (72ms)
    ✓ #3932 attachments with tricky revpos (140ms)
    ✓ replication with changing attachments (97ms)
    ✓ 3955 race condition in put
    ✓ #8456 bad attachment rev after replication (122ms)

  suite2 test.attachments.js- http:http
    ✓ Attachments replicate back and forth (169ms)
    ✓ Replicate same doc, same atts (183ms)
    ✓ Replicate same doc, same atts 2 (180ms)
    ✓ Attachments replicate (75ms)
    ✓ Attachment types replicate (130ms)
    ✓ Many many attachments replicate (365ms)
    ✓ Many many png attachments replicate (299ms)
    ✓ Multiple attachments replicate (126ms)
    - #3961 Many attachments on same doc
    ✓ Multiple attachments replicate, different docs (#2698) (128ms)
    ✓ Multiple attachments replicate, different docs png (#2698) (121ms)
    ✓ #3932 attachments with tricky revpos (224ms)
    ✓ replication with changing attachments (157ms)
    ✓ 3955 race condition in put
    ✓ #8456 bad attachment rev after replication (173ms)

  suite2 test.attachments.js- http:local
    ✓ Attachments replicate back and forth (112ms)
    ✓ Replicate same doc, same atts (99ms)
    ✓ Replicate same doc, same atts 2 (99ms)
    ✓ Attachments replicate (53ms)
    ✓ Attachment types replicate (58ms)
    ✓ Many many attachments replicate (236ms)
    ✓ Many many png attachments replicate (190ms)
    ✓ Multiple attachments replicate (82ms)
    - #3961 Many attachments on same doc
    ✓ Multiple attachments replicate, different docs (#2698) (73ms)
    ✓ Multiple attachments replicate, different docs png (#2698) (87ms)
    ✓ #3932 attachments with tricky revpos (137ms)
    ✓ replication with changing attachments (94ms)
    ✓ 3955 race condition in put
    ✓ #8456 bad attachment rev after replication (128ms)

  suite2 test.attachments.js- local:local
    ✓ Attachments replicate back and forth
    ✓ Replicate same doc, same atts
    ✓ Replicate same doc, same atts 2 (38ms)
    ✓ Attachments replicate
    ✓ Attachment types replicate
    ✓ Many many attachments replicate
    ✓ Many many png attachments replicate
    ✓ Multiple attachments replicate
    - #3961 Many attachments on same doc
    ✓ Multiple attachments replicate, different docs (#2698)
    ✓ Multiple attachments replicate, different docs png (#2698)
    ✓ #3932 attachments with tricky revpos
    ✓ replication with changing attachments
    ✓ 3955 race condition in put
    ✓ #8456 bad attachment rev after replication

  test.basics.js-http
    ✓ Create a pouch without new keyword
    ✓ Name is accessible via instance
    ✓ 4314 Create a pouch with + in name
    ✓ Creating Pouch without name will throw
    ✓ 4314 Create a pouch with urlencoded name
    ✓ 4219 destroy a pouch
    ✓ 4339 throw useful error if method called on stale instance
    ✓ [4595] should reject xhr errors
    ✓ [4595] should emit error event on xhr error
    ✓ Add a doc
    ✓ Get invalid id
    ✓ Missing doc should contain ID in error object
    ✓ PUTed Conflicted doc should contain ID in error object
    ✓ POSTed Conflicted doc should contain ID in error object
    ✓ Add a doc with a promise
    ✓ Add a doc with opts object
    ✓ Modify a doc
    ✓ Modifying a doc that has rewritten content
    ✓ Modify a doc with a promise
    ✓ Read db id
    ✓ Read db id with promise
    ✓ Close db
    ✓ Close db with a promise
    ✓ Read db id after closing Close
    ✓ Modify a doc with incorrect rev
    ✓ Remove doc
    ✓ Remove doc with a promise
    ✓ Remove doc with new syntax
    ✓ Remove doc with new syntax and a promise
    ✓ Doc removal leaves only stub
    ✓ Remove doc twice with specified id
    ✓ Remove doc, no callback
    ✓ Delete document without id
    ✓ Delete document with many args
    ✓ Delete document with many args, callback style
    ✓ Delete doc with id + rev + no opts
    ✓ Delete doc with id + rev + no opts, callback style
    ✓ Delete doc with doc + opts
    ✓ Delete doc with doc + opts, callback style
    ✓ Delete doc with rev in opts
    ✓ Bulk docs
    ✓ Bulk docs with a promise
    ✓ Basic checks
    ✓ update with invalid rev
    ✓ Doc validation
    ✓ Replication fields (#2442)
    ✓ Testing issue #48 (55ms)
    ✓ Testing valid id
    ✓ Put doc without _id should fail
    ✓ Put doc with bad reserved id should fail
    ✓ update_seq persists
    ✓ deletions persists
    ✓ #4126 should not store raw Dates
    ✓ Create a db with a reserved name
    ✓ Error when document is not an object
    ✓ Test instance update_seq updates correctly
    ✓ Fail to fetch a doc after db was deleted (49ms)
    ✓ Fail to fetch a doc after db was deleted (56ms)
    ✓ Cant add docs with empty ids
    ✓ Test doc with percent in ID
    ✓ db.info should give auto_compaction = false (#2744)
    ✓ db.info should give auto_compaction = true (#2744)
    ✓ db.info should give adapter name (#3567)
    ✓ db.info should give correct doc_count
    ✓ putting returns {ok: true}
    ✓ putting is override-able
    ✓ issue 2779, deleted docs, old revs COUCHDB-292
    ✓ issue 2888, successive deletes and writes (39ms)
    ✓ 2 invalid puts
    ✓ Docs save "null" value
    ✓ replace PouchDB.destroy() (express-pouchdb#203)
    ✓ 3968, keeps all object fields
    ✓ 4712 invalid rev for new doc generates conflict
    ✓ test info() after db close
    ✓ test get() after db close
    ✓ test close() after db close
    ✓ 7259 should have "this" keyword properly scoped
    ✓ #5471 PouchDB.plugin() should throw error if passed wrong type or empty object

  test.basics.js-local
    ✓ Create a pouch without new keyword
    ✓ Name is accessible via instance
    ✓ 4314 Create a pouch with + in name
    ✓ Creating Pouch without name will throw
    ✓ 4314 Create a pouch with urlencoded name
    ✓ 4219 destroy a pouch
    ✓ 4339 throw useful error if method called on stale instance
    ✓ [4595] should reject xhr errors
    ✓ [4595] should emit error event on xhr error
    ✓ Add a doc
    ✓ Get invalid id
    ✓ Missing doc should contain ID in error object
    ✓ PUTed Conflicted doc should contain ID in error object
    ✓ POSTed Conflicted doc should contain ID in error object
    ✓ Add a doc with a promise
    ✓ Add a doc with opts object
    ✓ Modify a doc
    ✓ Modifying a doc that has rewritten content
    ✓ Modify a doc with a promise
    ✓ Read db id
    ✓ Read db id with promise
    ✓ Close db
    ✓ Close db with a promise
    ✓ Read db id after closing Close
    ✓ Modify a doc with incorrect rev
    ✓ Remove doc
    ✓ Remove doc with a promise
    ✓ Remove doc with new syntax
    ✓ Remove doc with new syntax and a promise
    ✓ Doc removal leaves only stub
    ✓ Remove doc twice with specified id
    ✓ Remove doc, no callback
    ✓ Delete document without id
    ✓ Delete document with many args
    ✓ Delete document with many args, callback style
    ✓ Delete doc with id + rev + no opts
    ✓ Delete doc with id + rev + no opts, callback style
    ✓ Delete doc with doc + opts
    ✓ Delete doc with doc + opts, callback style
    ✓ Delete doc with rev in opts
    ✓ Bulk docs
    ✓ Bulk docs with a promise
    ✓ Basic checks
    ✓ update with invalid rev
    ✓ Doc validation
    ✓ Replication fields (#2442)
    ✓ Allows _access field in documents (#8171)
    ✓ Testing issue #48 (51ms)
    ✓ Testing valid id
    ✓ Put doc without _id should fail
    ✓ Put doc with bad reserved id should fail
    ✓ update_seq persists
    ✓ deletions persists
    ✓ #4126 should not store raw Dates
    ✓ Create a db with a reserved name
    ✓ Error when document is not an object
    ✓ Test instance update_seq updates correctly
    ✓ Fail to fetch a doc after db was deleted
    ✓ Fail to fetch a doc after db was deleted
    ✓ Cant add docs with empty ids
    ✓ Test doc with percent in ID
    ✓ db.info should give auto_compaction = false (#2744)
    ✓ db.info should give auto_compaction = true (#2744)
    ✓ db.info should give adapter name (#3567)
    ✓ db.info should give correct doc_count
    ✓ putting returns {ok: true}
    ✓ putting is override-able
    ✓ issue 2779, deleted docs, old revs COUCHDB-292
    ✓ issue 2888, successive deletes and writes
    ✓ 2 invalid puts
    ✓ Docs save "null" value
    ✓ replace PouchDB.destroy() (express-pouchdb#203)
    ✓ 3968, keeps all object fields
    ✓ 4712 invalid rev for new doc generates conflict
    ✓ test info() after db close
    ✓ test get() after db close
    ✓ test close() after db close
    ✓ 7259 should have "this" keyword properly scoped
    ✓ should allow unicode doc ids
    ✓ should have same blob support for 2 dbs
    ✓ 6053, PouchDB.plugin() resets defaults
    ✓ #5471 PouchDB.plugin() should throw error if passed wrong type or empty object

  test.bulk_docs.js-local
    ✓ Testing bulk docs
    ✓ #6039 test id in bulk docs for conflict
    ✓ No id in bulk docs
    ✓ No _rev and new_edits=false
    ✓ 7829 bare rev 1- with new_edits=false
    ✓ Test empty bulkDocs
    ✓ Test many bulkDocs
    ✓ Test errors on invalid doc id
    ✓ Test two errors on invalid doc id
    ✓ No docs
    ✓ Jira 911
    ✓ Test multiple bulkdocs
    ✓ #2935 new_edits=false correct number
    ✓ #2935 new_edits=false correct number 2
    ✓ bulk docs update then delete then conflict
    ✓ bulk_docs delete then undelete
    ✓ #2935 new_edits=false with single unauthorized
    ✓ Deleting _local docs with bulkDocs
    ✓ Deleting _local docs with bulkDocs, not found
    ✓ Deleting _local docs with bulkDocs, wrong rev
    ✓ Bulk with new_edits=false
    ✓ Testing successive new_edits to the same doc
    ✓ #3062 bulkDocs with staggered seqs
    ✓ Testing successive new_edits to the same doc, different content
    ✓ Testing successive new_edits to two doc
    ✓ Deletion with new_edits=false
    ✓ Deletion with new_edits=false, no history
    ✓ Modification with new_edits=false, no history
    ✓ Deletion with new_edits=false, no history, no revisions
    ✓ Testing new_edits=false in req body
    ✓ 656 regression in handling deleted docs
    ✓ Test quotes in doc ids
    ✓ Bulk docs empty list
    ✓ handles simultaneous writes
    ✓ bulk docs input by array
    ✓ Bulk empty list
    ✓ Bulk docs not an array
    ✓ Bulk docs not an object
    ✓ Bulk docs two different revisions to same document id
    ✓ 4204 respect revs_limit (272ms)
    ✓ 2839 implement revs_limit (188ms)
    ✓ 4372 revs_limit deletes old revisions of the doc
    ✓ 4372 revs_limit with auto_compaction deletes old revisions of the doc
    ✓ 4712 invalid rev for new doc generates conflict
    ✓ 5793 bulk docs accepts _conflicts when new_edits=false

  test.bulk_docs.js-http
    ✓ Testing bulk docs
    ✓ #6039 test id in bulk docs for conflict
    ✓ No id in bulk docs
    ✓ No _rev and new_edits=false
    ✓ 7829 bare rev 1- with new_edits=false
    ✓ Test empty bulkDocs
    ✓ Test many bulkDocs
    ✓ Test errors on invalid doc id
    ✓ Test two errors on invalid doc id
    ✓ No docs
    ✓ Jira 911
    ✓ Test multiple bulkdocs
    ✓ #2935 new_edits=false correct number
    ✓ #2935 new_edits=false correct number 2
    ✓ bulk docs update then delete then conflict
    ✓ bulk_docs delete then undelete
    ✓ #2935 new_edits=false with single unauthorized
    ✓ Deleting _local docs with bulkDocs (45ms)
    ✓ Bulk with new_edits=false
    ✓ Testing successive new_edits to the same doc
    ✓ #3062 bulkDocs with staggered seqs
    ✓ Testing successive new_edits to the same doc, different content
    ✓ Testing successive new_edits to two doc
    ✓ Deletion with new_edits=false
    ✓ Deletion with new_edits=false, no history
    ✓ Modification with new_edits=false, no history
    ✓ Deletion with new_edits=false, no history, no revisions
    ✓ Testing new_edits=false in req body
    ✓ 656 regression in handling deleted docs
    ✓ Test quotes in doc ids
    ✓ Bulk docs empty list
    ✓ handles simultaneous writes
    ✓ bulk docs input by array
    ✓ Bulk empty list
    ✓ Bulk docs not an array
    ✓ Bulk docs not an object
    ✓ Bulk docs two different revisions to same document id
    ✓ 4204 respect revs_limit (295ms)
    ✓ 2839 implement revs_limit
    ✓ 4372 revs_limit deletes old revisions of the doc
    ✓ 4372 revs_limit with auto_compaction deletes old revisions of the doc
    ✓ 4712 invalid rev for new doc generates conflict
    ✓ 5793 bulk docs accepts _conflicts when new_edits=false (103ms)

  test.bulk_get.js-http
    ✓ test bulk get with rev specified
    ✓ test bulk get with latest=true
    ✓ test bulk get with no rev specified
    ✓ _revisions is not returned by default
    ✓ #5886 bulkGet with reserved id
    ✓ _revisions is returned when specified
    ✓ _revisions is returned when specified, using implicit rev
    ✓ attachments are not included by default
    ✓ attachments are included when specified
    ✓ attachments are included when specified, using implicit rev

  test.bulk_get.js-local
    ✓ test bulk get with rev specified
    ✓ test bulk get with latest=true
    ✓ test bulk get with no rev specified
    ✓ _revisions is not returned by default
    ✓ #5886 bulkGet with reserved id
    ✓ _revisions is returned when specified
    ✓ _revisions is returned when specified, using implicit rev
    ✓ attachments are not included by default
    ✓ attachments are included when specified
    ✓ attachments are included when specified, using implicit rev

  test.changes.js-http
    ✓ All changes
    ✓ Changes with complete callback as param (38ms)
    ✓ Promise resolved when changes cancelled
    - Live changes should clean listener when cancelled
    ✓ Changes Since
    ✓ Changes Since and limit limit 1
    ✓ Changes Since and limit limit 0
    ✓ Changes limit (45ms)
    ✓ Changes with filter not present in ddoc
    ✓ Changes with `filters` key not present in ddoc
    ✓ Changes limit and filter
    ✓ Changes with shorthand function name
    ✓ Changes with filter from nonexistent ddoc
    ✓ Changes with view not present in ddoc
    ✓ Changes with `views` key not present in ddoc
    ✓ #4451 Changes with invalid view filter
    ✓ 3356 throw inside a filter
    ✓ Changes with missing param `view` in request
    ✓ Changes limit and view instead of filter
    ✓ #3609 view option implies filter: _view
    ✓ Immediately cancel changes
    ✓ Changes with invalid ddoc view name
    ✓ Changes with invalid ddoc view name 2
    ✓ Changes with style = all_docs (62ms)
    ✓ Changes with style = all_docs and a callback for complete (61ms)
    ✓ Changes limit = 0
    ✓ Changes doc
    - Descending many changes
    ✓ live-changes
    ✓ Multiple watchers
    ✓ Continuous changes doc
    ✓ Cancel changes (323ms)
    ✓ #3579 changes firing 1 too many times (74ms)
    ✓ Kill database while listening to live changes
    ✓ #3136 style=all_docs
    ✓ #4191 revs_diff causes endless loop
    ✓ #3136 style=all_docs & include_docs
    ✓ changes-filter with query params
    ✓ Non-live changes filter
    ✓ Non-live changes filter, descending
    ✓ #2569 Non-live doc_ids filter
    ✓ #2569 Big non-live doc_ids filter
    ✓ #2569 Live doc_ids filter
    ✓ #2569 Big live doc_ids filter
    ✓ #2569 Non-live doc_ids filter with filter=_doc_ids
    ✓ #2569 Live doc_ids filter with filter=_doc_ids
    ✓ Changes to same doc are grouped
    ✓ Changes with conflicts are handled correctly (126ms)
    ✓ Change entry for a deleted doc
    ✓ changes large number of docs (49ms)
    ✓ Calling db.changes({since: 'now'})
    ✓ Calling db.changes({since: 'latest'})
    ✓ Closing db does not cause a crash if changes cancelled
    ✓ fire-complete-on-cancel (102ms)
    ✓ changes are not duplicated (1022ms)
    ✓ supports return_docs=false
    ✓ should respects limit (75ms)
    ✓ doesn't throw if opts.complete is undefined
    ✓ handle individual changes in live replication (199ms)
    ✓ changes-filter without filter
    ✓ #3539 - Exception in changes is fine
    ✓ Changes with selector
    ✓ Changes with selector, explicit filter
    ✓ Changes with selector and mismatched filter
    ✓ Changes with limit and selector

  test.changes.js-local
    ✓ All changes
    ✓ Changes with complete callback as param
    ✓ Promise resolved when changes cancelled
    - Live changes should clean listener when cancelled
    ✓ Changes Since
    ✓ Changes Since and limit limit 1
    ✓ Changes Since and limit limit 0
    ✓ Changes limit
    ✓ Changes with filter not present in ddoc
    ✓ Changes with `filters` key not present in ddoc
    ✓ Changes limit and filter
    ✓ Changes with shorthand function name
    ✓ Changes with filter from nonexistent ddoc
    ✓ Changes with view not present in ddoc
    ✓ Changes with `views` key not present in ddoc
    ✓ #4451 Changes with invalid view filter
    ✓ 3356 throw inside a filter
    ✓ Changes with missing param `view` in request
    ✓ Changes limit and view instead of filter
    ✓ #3609 view option implies filter: _view
    ✓ Immediately cancel changes
    ✓ Changes with invalid ddoc view name
    ✓ Changes with invalid ddoc view name 2
    ✓ Changes with style = all_docs
    ✓ Changes with style = all_docs and a callback for complete
    ✓ Changes limit = 0
    ✓ Changes doc
    - Descending many changes
    ✓ live-changes
    ✓ Multiple watchers
    ✓ Continuous changes doc
    ✓ Cancel changes (313ms)
    ✓ #3579 changes firing 1 too many times (66ms)
    ✓ Kill database while listening to live changes
    ✓ #3136 style=all_docs
    ✓ #4191 revs_diff causes endless loop
    ✓ #3136 style=all_docs & include_docs
    ✓ changes-filter with query params
    ✓ Non-live changes filter
    ✓ Non-live changes filter, descending
    ✓ #2569 Non-live doc_ids filter
    ✓ #2569 Big non-live doc_ids filter
    ✓ #2569 Live doc_ids filter
    ✓ #2569 Big live doc_ids filter
    ✓ #2569 Non-live doc_ids filter with filter=_doc_ids
    ✓ #2569 Live doc_ids filter with filter=_doc_ids
    ✓ Changes to same doc are grouped
    ✓ Changes with conflicts are handled correctly
    ✓ Change entry for a deleted doc
    ✓ changes large number of docs
    ✓ Calling db.changes({since: 'now'})
    ✓ Calling db.changes({since: 'latest'})
    ✓ Closing db does not cause a crash if changes cancelled
    ✓ fire-complete-on-cancel (102ms)
    ✓ changes are not duplicated (1020ms)
    ✓ supports return_docs=false
    ✓ should respects limit (66ms)
    ✓ doesn't throw if opts.complete is undefined
    ✓ handle individual changes in live replication (107ms)
    ✓ changes-filter without filter
    ✓ #3539 - Exception in changes is fine
    ✓ Changes with selector
    ✓ Changes with selector, explicit filter
    ✓ Changes with selector and mismatched filter
    ✓ Changes with limit and selector

  changes-standalone
    - Changes reports errors

  test.close.js-local
    ✓ should emit destroyed even when closed (sync)
    ✓ should emit destroyed even when closed (async)
precondition_failed: Database not open
    at Object.<anonymous> (/data/js-variants/multee/Clients/levelup/pouchdb/packages/node_modules/pouchdb/lib/index.js:614:16)
    at Module._compile (node:internal/modules/cjs/loader:1105:14)
    at Module._extensions..js (node:internal/modules/cjs/loader:1159:10)
    at Module.load (node:internal/modules/cjs/loader:981:32)
    at Module._load (node:internal/modules/cjs/loader:827:12)
    at Module.require (node:internal/modules/cjs/loader:1005:19)
    at require (node:internal/modules/cjs/helpers:102:18)
    at commonUtils.loadPouchDBForNode (/data/js-variants/multee/Clients/levelup/pouchdb/tests/common-utils.js:92:17)
    at commonUtils.loadPouchDB (/data/js-variants/multee/Clients/levelup/pouchdb/tests/common-utils.js:78:39)
    at Object.<anonymous> (/data/js-variants/multee/Clients/levelup/pouchdb/tests/integration/node.setup.js:21:28)
    at Module._compile (node:internal/modules/cjs/loader:1105:14)
    at Module._extensions..js (node:internal/modules/cjs/loader:1159:10)
    at Module.load (node:internal/modules/cjs/loader:981:32)
    at Module._load (node:internal/modules/cjs/loader:827:12)
    at Module.require (node:internal/modules/cjs/loader:1005:19)
    at require (node:internal/modules/cjs/helpers:102:18)
    at /data/js-variants/multee/Clients/levelup/pouchdb/node_modules/mocha/bin/_mocha:366:3
    at Array.forEach (<anonymous>)
    at Object.<anonymous> (/data/js-variants/multee/Clients/levelup/pouchdb/node_modules/mocha/bin/_mocha:365:10)
    at Module._compile (node:internal/modules/cjs/loader:1105:14)
    at Module._extensions..js (node:internal/modules/cjs/loader:1159:10)
    at Module.load (node:internal/modules/cjs/loader:981:32)
    at Module._load (node:internal/modules/cjs/loader:827:12)
    at Function.executeUserEntryPoint [as runMain] (node:internal/modules/run_main:77:12)
    at node:internal/main/run_main_module:17:47
    ✓ should emit closed even when destroyed (async #2)
precondition_failed: Database not open
    at Object.<anonymous> (/data/js-variants/multee/Clients/levelup/pouchdb/packages/node_modules/pouchdb/lib/index.js:614:16)
    at Module._compile (node:internal/modules/cjs/loader:1105:14)
    at Module._extensions..js (node:internal/modules/cjs/loader:1159:10)
    at Module.load (node:internal/modules/cjs/loader:981:32)
    at Module._load (node:internal/modules/cjs/loader:827:12)
    at Module.require (node:internal/modules/cjs/loader:1005:19)
    at require (node:internal/modules/cjs/helpers:102:18)
    at commonUtils.loadPouchDBForNode (/data/js-variants/multee/Clients/levelup/pouchdb/tests/common-utils.js:92:17)
    at commonUtils.loadPouchDB (/data/js-variants/multee/Clients/levelup/pouchdb/tests/common-utils.js:78:39)
    at Object.<anonymous> (/data/js-variants/multee/Clients/levelup/pouchdb/tests/integration/node.setup.js:21:28)
    at Module._compile (node:internal/modules/cjs/loader:1105:14)
    at Module._extensions..js (node:internal/modules/cjs/loader:1159:10)
    at Module.load (node:internal/modules/cjs/loader:981:32)
    at Module._load (node:internal/modules/cjs/loader:827:12)
    at Module.require (node:internal/modules/cjs/loader:1005:19)
    at require (node:internal/modules/cjs/helpers:102:18)
    at /data/js-variants/multee/Clients/levelup/pouchdb/node_modules/mocha/bin/_mocha:366:3
    at Array.forEach (<anonymous>)
    at Object.<anonymous> (/data/js-variants/multee/Clients/levelup/pouchdb/node_modules/mocha/bin/_mocha:365:10)
    at Module._compile (node:internal/modules/cjs/loader:1105:14)
    at Module._extensions..js (node:internal/modules/cjs/loader:1159:10)
    at Module.load (node:internal/modules/cjs/loader:981:32)
    at Module._load (node:internal/modules/cjs/loader:827:12)
    at Function.executeUserEntryPoint [as runMain] (node:internal/modules/run_main:77:12)
    at node:internal/main/run_main_module:17:47
    ✓ test unref for coverage
    ✓ test double unref for coverage
precondition_failed: Database not open
    at Object.<anonymous> (/data/js-variants/multee/Clients/levelup/pouchdb/packages/node_modules/pouchdb/lib/index.js:614:16)
    at Module._compile (node:internal/modules/cjs/loader:1105:14)
    at Module._extensions..js (node:internal/modules/cjs/loader:1159:10)
    at Module.load (node:internal/modules/cjs/loader:981:32)
    at Module._load (node:internal/modules/cjs/loader:827:12)
    at Module.require (node:internal/modules/cjs/loader:1005:19)
    at require (node:internal/modules/cjs/helpers:102:18)
    at commonUtils.loadPouchDBForNode (/data/js-variants/multee/Clients/levelup/pouchdb/tests/common-utils.js:92:17)
    at commonUtils.loadPouchDB (/data/js-variants/multee/Clients/levelup/pouchdb/tests/common-utils.js:78:39)
    at Object.<anonymous> (/data/js-variants/multee/Clients/levelup/pouchdb/tests/integration/node.setup.js:21:28)
    at Module._compile (node:internal/modules/cjs/loader:1105:14)
    at Module._extensions..js (node:internal/modules/cjs/loader:1159:10)
    at Module.load (node:internal/modules/cjs/loader:981:32)
    at Module._load (node:internal/modules/cjs/loader:827:12)
    at Module.require (node:internal/modules/cjs/loader:1005:19)
    at require (node:internal/modules/cjs/helpers:102:18)
    at /data/js-variants/multee/Clients/levelup/pouchdb/node_modules/mocha/bin/_mocha:366:3
    at Array.forEach (<anonymous>)
    at Object.<anonymous> (/data/js-variants/multee/Clients/levelup/pouchdb/node_modules/mocha/bin/_mocha:365:10)
    at Module._compile (node:internal/modules/cjs/loader:1105:14)
    at Module._extensions..js (node:internal/modules/cjs/loader:1159:10)
    at Module.load (node:internal/modules/cjs/loader:981:32)
    at Module._load (node:internal/modules/cjs/loader:827:12)
    at Function.executeUserEntryPoint [as runMain] (node:internal/modules/run_main:77:12)
    at node:internal/main/run_main_module:17:47
    ✓ test close-then-destroyed for coverage
************* run test done *************
pouchdb is testing ./Variants/levelup/variant8/levelup
/data/js-variants/multee
************* npm unlink module *************

removed 1 package, changed 1 package, and audited 1032 packages in 7s

64 packages are looking for funding
  run `npm fund` for details

41 vulnerabilities (1 low, 9 moderate, 25 high, 6 critical)

To address issues that do not require attention, run:
  npm audit fix

To address all issues possible (including breaking changes), run:
  npm audit fix --force

Some issues need review, and may require choosing
a different dependency.

Run `npm audit` for details.
************* npm unlink module done *************
************* npm unlink globally *************

removed 1 package, and audited 1 package in 1s

found 0 vulnerabilities
************* npm unlink globally done *************
************* npm link globally *************

added 1 package, and audited 3 packages in 406ms

found 0 vulnerabilities
************* npm link globally done *************
************* npm link module *************

added 1 package, changed 1 package, and audited 1034 packages in 4s

64 packages are looking for funding
  run `npm fund` for details

41 vulnerabilities (1 low, 9 moderate, 25 high, 6 critical)

To address issues that do not require attention, run:
  npm audit fix

To address all issues possible (including breaking changes), run:
  npm audit fix --force

Some issues need review, and may require choosing
a different dependency.

Run `npm audit` for details.
************* npm link module done *************
************* start run test *************

> pouchdb-monorepo@7.0.0-prerelease test
> bash bin/run-test.sh


> pouchdb-monorepo@7.0.0-prerelease build-node
> bash bin/build-node.sh


> pouchdb-monorepo@7.0.0-prerelease build-modules
> node bin/build-modules.js

Building pouchdb...
Building pouchdb-abstract-mapreduce...
Building pouchdb-adapter-http...
Building pouchdb-adapter-idb...
Building pouchdb-adapter-indexeddb...
Building pouchdb-adapter-leveldb...
Building pouchdb-adapter-leveldb-core...
Building pouchdb-adapter-localstorage...
Building pouchdb-adapter-memory...
Building pouchdb-adapter-utils...
Building pouchdb-binary-utils...
Building pouchdb-browser...
Building pouchdb-changes-filter...
Building pouchdb-checkpointer...
Building pouchdb-collate...
Building pouchdb-collections...
Building pouchdb-core...
Building pouchdb-errors...
Building pouchdb-fetch...
Building pouchdb-find...
Building pouchdb-for-coverage...
Building pouchdb-generate-replication-id...
Building pouchdb-json...
Building pouchdb-mapreduce...
Building pouchdb-mapreduce-utils...
Building pouchdb-md5...
Building pouchdb-merge...
Building pouchdb-node...
Building pouchdb-replication...
Building pouchdb-selector-core...
Building pouchdb-utils...
Building sublevel-pouchdb...
  ✓ wrote pouchdb-adapter-localstorage/lib/index.js in vanilla mode
  ✓ wrote pouchdb-adapter-localstorage/lib/index.es.js in vanilla mode
  ✓ wrote pouchdb-adapter-memory/lib/index.js in vanilla mode
  ✓ wrote pouchdb-adapter-memory/lib/index.es.js in vanilla mode
  ✓ wrote pouchdb-checkpointer/lib/index.js in vanilla mode
  ✓ wrote pouchdb-checkpointer/lib/index.es.js in vanilla mode
  ✓ wrote pouchdb-errors/lib/index.js in vanilla mode
  ✓ wrote pouchdb-errors/lib/index.es.js in vanilla mode
  ✓ wrote pouchdb-generate-replication-id/lib/index.js in vanilla mode
  ✓ wrote pouchdb-generate-replication-id/lib/index.es.js in vanilla mode
  ✓ wrote pouchdb-adapter-http/lib/index.js in vanilla mode
  ✓ wrote pouchdb-adapter-http/lib/index.es.js in vanilla mode
  ✓ wrote pouchdb-adapter-leveldb/lib/index.js in node mode
  ✓ wrote pouchdb-adapter-leveldb/lib/index.es.js in node mode
  ✓ wrote pouchdb-adapter-leveldb/lib/index-browser.js in browser mode
  ✓ wrote pouchdb-adapter-leveldb/lib/index-browser.es.js in browser mode
  ✓ wrote pouchdb-adapter-leveldb-core/lib/index.js in node mode
  ✓ wrote pouchdb-adapter-leveldb-core/lib/index.es.js in node mode
  ✓ wrote pouchdb-adapter-leveldb-core/lib/index-browser.js in browser mode
  ✓ wrote pouchdb-adapter-leveldb-core/lib/index-browser.es.js in browser mode
  ✓ wrote pouchdb-changes-filter/lib/index-browser.js in browser mode
  ✓ wrote pouchdb-changes-filter/lib/index-browser.es.js in browser mode
  ✓ wrote pouchdb-fetch/lib/index-browser.js in browser mode
  ✓ wrote pouchdb-fetch/lib/index-browser.es.js in browser mode
  ✓ wrote pouchdb-md5/lib/index-browser.js in browser mode
  ✓ wrote pouchdb-md5/lib/index-browser.es.js in browser mode
  ✓ wrote pouchdb-changes-filter/lib/index.js in node mode
  ✓ wrote pouchdb-changes-filter/lib/index.es.js in node mode
  ✓ wrote pouchdb-collate/lib/index.js in vanilla mode
  ✓ wrote pouchdb-collate/lib/index.es.js in vanilla mode
  ✓ wrote pouchdb-fetch/lib/index.js in node mode
  ✓ wrote pouchdb-fetch/lib/index.es.js in node mode
  ✓ wrote pouchdb-json/lib/index.js in vanilla mode
  ✓ wrote pouchdb-json/lib/index.es.js in vanilla mode
  ✓ wrote pouchdb-mapreduce-utils/lib/index.js in vanilla mode
  ✓ wrote pouchdb-mapreduce-utils/lib/index.es.js in vanilla mode
  ✓ wrote pouchdb-md5/lib/index.js in node mode
  ✓ wrote pouchdb-md5/lib/index.es.js in node mode
  ✓ wrote pouchdb-abstract-mapreduce/lib/index.js in vanilla mode
  ✓ wrote pouchdb-abstract-mapreduce/lib/index.es.js in vanilla mode
  ✓ wrote pouchdb-adapter-idb/lib/index.js in vanilla mode
  ✓ wrote pouchdb-adapter-idb/lib/index.es.js in vanilla mode
  ✓ wrote pouchdb-adapter-indexeddb/lib/index.js in vanilla mode
  ✓ wrote pouchdb-adapter-indexeddb/lib/index.es.js in vanilla mode
  ✓ wrote pouchdb-binary-utils/lib/index-browser.js in browser mode
  ✓ wrote pouchdb-binary-utils/lib/index-browser.es.js in browser mode
  ✓ wrote pouchdb-utils/lib/index-browser.js in browser mode
  ✓ wrote pouchdb-utils/lib/index-browser.es.js in browser mode
  ✓ wrote pouchdb-utils/lib/index.js in node mode
  ✓ wrote pouchdb-utils/lib/index.es.js in node mode
  ✓ wrote pouchdb-adapter-utils/lib/index.js in vanilla mode
  ✓ wrote pouchdb-adapter-utils/lib/index.es.js in vanilla mode
  ✓ wrote pouchdb-binary-utils/lib/index.js in node mode
  ✓ wrote pouchdb-binary-utils/lib/index.es.js in node mode
  ✓ wrote pouchdb-collections/lib/index.js in vanilla mode
  ✓ wrote pouchdb-collections/lib/index.es.js in vanilla mode
  ✓ wrote pouchdb-merge/lib/index.js in vanilla mode
  ✓ wrote pouchdb-merge/lib/index.es.js in vanilla mode
  ✓ wrote sublevel-pouchdb/lib/index.js in vanilla mode
  ✓ wrote sublevel-pouchdb/lib/index.es.js in vanilla mode
  ✓ wrote pouchdb-selector-core/lib/index.js in vanilla mode
  ✓ wrote pouchdb-selector-core/lib/index.es.js in vanilla mode
  ✓ wrote pouchdb-mapreduce/lib/index-browser.js in browser mode
  ✓ wrote pouchdb-mapreduce/lib/index-browser.es.js in browser mode
  ✓ wrote pouchdb-replication/lib/index.js in vanilla mode
  ✓ wrote pouchdb-replication/lib/index.es.js in vanilla mode
  ✓ wrote pouchdb-mapreduce/lib/index.js in node mode
  ✓ wrote pouchdb-mapreduce/lib/index.es.js in node mode
  ✓ wrote pouchdb-core/lib/index.js in vanilla mode
  ✓ wrote pouchdb-core/lib/index.es.js in vanilla mode
  ✓ wrote pouchdb-find/lib/index.js in node mode
  ✓ wrote pouchdb-find/lib/index.es.js in node mode
  ✓ wrote pouchdb-find/lib/index-browser.js in browser mode
  ✓ wrote pouchdb-find/lib/index-browser.es.js in browser mode
  ✓ wrote pouchdb-for-coverage/lib/index.js in node mode
  ✓ wrote pouchdb-for-coverage/lib/index.es.js in node mode
  ✓ wrote pouchdb-for-coverage/lib/index-browser.js in browser mode
  ✓ wrote pouchdb-browser/lib/index.js in vanilla mode
  ✓ wrote pouchdb-for-coverage/lib/index-browser.es.js in browser mode
  ✓ wrote pouchdb-browser/lib/index.es.js in vanilla mode
  ✓ wrote pouchdb-node/lib/index.js in vanilla mode
  ✓ wrote pouchdb-node/lib/index.es.js in vanilla mode
  ✓ wrote packages/node_modules/pouchdb/lib/index.js
  ✓ wrote packages/node_modules/pouchdb/lib/index.es.js
Waiting for host to start ..
Host started :)
> pouchdb-monorepo@7.0.0-prerelease test-node
> bash bin/test-node.sh

Down server listening on port 3010
Seeded with: 1660143021430


  DB Setup
    ✓ PouchDB has a version
    ✓ PouchDB version matches package.json

  test.active_tasks.js
    ✓ Can add a task
    ✓ Can get tasks by id
    ✓ Can get all tasks
    ✓ Can update a task
    ✓ Can remove a task

  test.all_docs.js-http
    ✓ Testing all docs (170ms)
    ✓ Testing allDocs opts.keys (64ms)
    ✓ Testing allDocs opts.keys with skip
    ✓ Testing allDocs opts.keys with limit
    ✓ Testing allDocs invalid opts.keys
    ✓ Testing deleting in changes (45ms)
    ✓ Testing updating in changes (41ms)
    ✓ Testing include docs
    ✓ Testing conflicts (49ms)
    ✓ test basic collation (46ms)
    ✓ 3883 start_key end_key aliases
    ✓ test total_rows with a variety of criteria (117ms)
    ✓ test total_rows with both skip and limit (42ms)
    ✓ test limit option and total_rows
    ✓ test escaped startkey/endkey
    ✓ test "key" option (80ms)
    ✓ test inclusive_end=false (74ms)
    ✓ test descending with startkey/endkey
    ✓ #3082 test wrong num results returned (251ms)
    ✓ test empty db
    ✓ test after db close
    ✓ 5793 _conflicts should not exist if no conflicts
    ✓ #6230 Test allDocs opts update_seq: false
    ✓ #6230 Test allDocs opts update_seq: true
    ✓ #6230 Test allDocs opts with update_seq missing

  test.all_docs.js-local
    ✓ Testing all docs
    ✓ Testing allDocs opts.keys
    ✓ Testing allDocs opts.keys with skip
    ✓ Testing allDocs opts.keys with limit
    ✓ Testing allDocs invalid opts.keys
    ✓ Testing deleting in changes
    ✓ Testing updating in changes
    ✓ Testing include docs
    ✓ Testing conflicts
    ✓ test basic collation
    ✓ 3883 start_key end_key aliases
    ✓ test total_rows with a variety of criteria
    ✓ test total_rows with both skip and limit
    ✓ test limit option and total_rows
    ✓ test escaped startkey/endkey
    ✓ test "key" option
    ✓ test inclusive_end=false
    ✓ test descending with startkey/endkey
    ✓ #3082 test wrong num results returned (186ms)
    ✓ test empty db
    ✓ test after db close
    ✓ test unicode ids and revs
    ✓ 5793 _conflicts should not exist if no conflicts
    ✓ #6230 Test allDocs opts update_seq: false
    ✓ #6230 Test allDocs opts update_seq: true
    ✓ #6230 Test allDocs opts with update_seq missing

  suite2 test.attachments.js-local
    ✓ 3357 Attachment names cant start with _
    ✓ 5736 warning for putAttachment without content_type
    ✓ 5736 warning for bulkDocs attachments without content_type
    ✓ fetch atts with open_revs and missing
    ✓ issue 2803 should throw 412
    ✓ issue 2803 should throw 412 part 2
    ✓ issue 2803 should throw 412 part 3
    ✓ issue 2803 should throw 412 part 4
    ✓ #2858 {binary: true} in get()
    ✓ #2858 {binary: true} in allDocs() 1
    ✓ #2858 {binary: true} in allDocs() 2
    ✓ #2858 {binary: true} in allDocs() 3
    ✓ #2858 {binary: true} in allDocs() 4
    ✓ #2858 {binary: true} in allDocs() 5
    ✓ #2858 {binary: true} in allDocs(), many atts
    ✓ #2858 {binary: true} in allDocs(), mixed atts
    ✓ #2858 {binary: true} in changes() non-live
    ✓ #2858 {binary: true} in changes() non-live, many atts
    ✓ #2858 {binary: true} in changes() non-live, mixed atts
    ✓ #2858 {binary: true} non-live changes, complete event
    ✓ #2858 {binary: true} in live changes
    ✓ #2858 {binary: true} in live changes, mixed atts
    ✓ #2858 {binary: true} in live+retry changes
    ✓ #2858 {binary: true} in live changes, attachments:false
    ✓ #2858 {binary: true} in live changes, include_docs:false
    ✓ #6736 {binary: true} in bulkGet()
    ✓ Measures length correctly after put()
    ✓ #3074 non-live changes()
    ✓ #3074 live changes()
    ✓ #3074 non-live changes(), no attachments
    ✓ #3074 live changes(), no attachments
    ✓ #3881 filter extraneous keys from _attachments
    ✓ #2771 allDocs() 1, single attachment
    ✓ #2771 allDocs() 2, many docs same att
    ✓ #2771 allDocs() 3, many docs diff atts
    ✓ #2771 allDocs() 4, mix of atts and no atts
    ✓ #2771 allDocs() 5, no atts
    ✓ #2771 allDocs() 6, no docs
    ✓ #2771 allDocs() 7, revisions and deletions
    ✓ #2771 allDocs() 8, empty attachment
    ✓ No length for non-stubs
    ✓ Test some attachments
    ✓ Test getAttachment
    ✓ Test getAttachment with stubs
    ✓ Test get() with binary:true and stubs
    ✓ Test attachments in allDocs/changes
    ✓ Test putAttachment with base64 plaintext
    ✓ Test putAttachment with invalid base64
    ✓ Test getAttachment with empty text
    ✓ Test getAttachment with normal text
    ✓ Test getAttachment with PNG
    ✓ Test getAttachment with PNG using bulkDocs
    ✓ Test getAttachment with PNG using post
    ✓ Test postAttachment with PNG then bulkDocs
    ✓ proper stub behavior
    ✓ Testing with invalid docs
    ✓ Test create attachment and doc in one go
    ✓ Test create attachment and doc in one go without callback
    ✓ Test create attachment without callback
    ✓ Test put attachment on a doc without attachments
    ✓ Test put attachment with unencoded name
    ✓ 3963 length property on stubs
    ✓ Testing with invalid rev
    ✓ Test put another attachment on a doc with attachments
    ✓ Test get with attachments: true if empty attachments
    ✓ Test delete attachment from a doc
    ✓ Test a document with a json string attachment
    ✓ Test remove doc with attachment
    ✓ Try to insert a doc with unencoded attachment
    ✓ Try to get attachment of unexistent doc
    ✓ Test synchronous putAttachment with text data
    ✓ Test synchronous putAttachment with no text data
    ✓ Test put with partial stubs
    ✓ Test put with attachments and new_edits=false
    ✓ Test getAttachment with specific rev
    ✓ Test getAttachment with diff revs and content
    ✓ Test stubs
    ✓ Try to get unexistent attachment of some doc
    ✓ putAttachment and getAttachment with plaintext
    ✓ putAttachment and getAttachment with png data
    ✓ putAttachment in new doc with base64
    ✓ #2818 - save same attachment in different revs
    ✓ #2818 - save same attachment many times in parallel
    ✓ #2818 - revisions keep attachments (no compaction)
    ✓ #2818 - doesn't throw 409 if same filename
    ✓ #3008 test correct encoding/decoding of \u0000 etc.
    ✓ putAttachment and getAttachment with big png data (93ms)
    ✓ #2709 `revpos` with putAttachment
    ✓ #2709 `revpos` with inline attachment
    ✓ #2709 `revpos` with allDocs
    ✓ #7403 {attachments: true, binary: true, include_docs: true} in allDocs with one missing doc

  suite2 test.attachments.js-http
    ✓ 3357 Attachment names cant start with _
    ✓ 5736 warning for putAttachment without content_type
    ✓ 5736 warning for bulkDocs attachments without content_type
    ✓ fetch atts with open_revs and missing
    ✓ issue 2803 should throw 412
    ✓ issue 2803 should throw 412 part 2
    ✓ issue 2803 should throw 412 part 3
    ✓ issue 2803 should throw 412 part 4
    ✓ #2858 {binary: true} in get()
    ✓ #2858 {binary: true} in allDocs() 1
    ✓ #2858 {binary: true} in allDocs() 2
    ✓ #2858 {binary: true} in allDocs() 3
    ✓ #2858 {binary: true} in allDocs() 4
    ✓ #2858 {binary: true} in allDocs() 5
    ✓ #2858 {binary: true} in allDocs(), many atts
    ✓ #2858 {binary: true} in allDocs(), mixed atts
    ✓ #2858 {binary: true} in changes() non-live
    ✓ #2858 {binary: true} in changes() non-live, many atts
    ✓ #2858 {binary: true} in changes() non-live, mixed atts
    ✓ #2858 {binary: true} non-live changes, complete event
    ✓ #2858 {binary: true} in live changes
    ✓ #2858 {binary: true} in live changes, mixed atts
    ✓ #2858 {binary: true} in live+retry changes
    ✓ #2858 {binary: true} in live changes, attachments:false
    ✓ #2858 {binary: true} in live changes, include_docs:false
    ✓ #6736 {binary: true} in bulkGet()
    ✓ Measures length correctly after put()
    ✓ #3074 non-live changes()
    ✓ #3074 live changes() (44ms)
    ✓ #3074 non-live changes(), no attachments (39ms)
    ✓ #3074 live changes(), no attachments
    ✓ #3881 filter extraneous keys from _attachments
    ✓ #2771 allDocs() 1, single attachment
    ✓ #2771 allDocs() 2, many docs same att
    ✓ #2771 allDocs() 3, many docs diff atts
    ✓ #2771 allDocs() 4, mix of atts and no atts
    ✓ #2771 allDocs() 5, no atts
    ✓ #2771 allDocs() 6, no docs
    ✓ #2771 allDocs() 7, revisions and deletions (38ms)
    ✓ #2771 allDocs() 8, empty attachment
    ✓ No length for non-stubs
    ✓ Test some attachments (43ms)
    ✓ Test getAttachment
    ✓ Test getAttachment with stubs (45ms)
    ✓ Test get() with binary:true and stubs (66ms)
    ✓ Test attachments in allDocs/changes
    ✓ Test putAttachment with base64 plaintext
    ✓ Test putAttachment with invalid base64
    ✓ Test getAttachment with empty text
    ✓ Test getAttachment with normal text
    ✓ Test getAttachment with PNG
    ✓ Test getAttachment with PNG using bulkDocs
    ✓ Test getAttachment with PNG using post
    ✓ Test postAttachment with PNG then bulkDocs
    ✓ proper stub behavior
    ✓ Testing with invalid docs
    ✓ Test create attachment and doc in one go
    ✓ Test create attachment and doc in one go without callback
    ✓ Test create attachment without callback
    ✓ Test put attachment on a doc without attachments
    ✓ Test put attachment with unencoded name
    ✓ 3963 length property on stubs (44ms)
    ✓ Testing with invalid rev
    ✓ Test put another attachment on a doc with attachments
    ✓ Test get with attachments: true if empty attachments
    ✓ Test delete attachment from a doc (39ms)
    ✓ Test a document with a json string attachment
    ✓ Test remove doc with attachment
    ✓ Try to insert a doc with unencoded attachment
    ✓ Try to get attachment of unexistent doc
    ✓ Test synchronous putAttachment with text data
    ✓ Test synchronous putAttachment with no text data
    ✓ Test put with partial stubs
    ✓ Test put with attachments and new_edits=false
    ✓ Test getAttachment with specific rev (47ms)
    ✓ Test getAttachment with diff revs and content (39ms)
    ✓ Test stubs
    ✓ Try to get unexistent attachment of some doc
    ✓ putAttachment and getAttachment with plaintext
    ✓ putAttachment and getAttachment with png data
    ✓ putAttachment in new doc with base64
    ✓ #2818 - save same attachment in different revs (48ms)
    ✓ #2818 - save same attachment many times in parallel
    ✓ #2818 - revisions keep attachments (no compaction)
    ✓ #2818 - doesn't throw 409 if same filename
    ✓ #3008 test correct encoding/decoding of \u0000 etc.
    ✓ putAttachment and getAttachment with big png data (143ms)
    ✓ #2709 `revpos` with putAttachment (40ms)
    ✓ #2709 `revpos` with inline attachment
    ✓ #2709 `revpos` with allDocs
    ✓ #7403 {attachments: true, binary: true, include_docs: true} in allDocs with one missing doc

  suite2 test.attachments.js- local:http
    ✓ Attachments replicate back and forth (107ms)
    ✓ Replicate same doc, same atts (111ms)
    ✓ Replicate same doc, same atts 2 (104ms)
    ✓ Attachments replicate (87ms)
    ✓ Attachment types replicate (99ms)
    ✓ Many many attachments replicate (217ms)
    ✓ Many many png attachments replicate (201ms)
    ✓ Multiple attachments replicate (78ms)
    - #3961 Many attachments on same doc
    ✓ Multiple attachments replicate, different docs (#2698) (77ms)
    ✓ Multiple attachments replicate, different docs png (#2698) (79ms)
    ✓ #3932 attachments with tricky revpos (126ms)
    ✓ replication with changing attachments (94ms)
    ✓ 3955 race condition in put
    ✓ #8456 bad attachment rev after replication (119ms)

  suite2 test.attachments.js- http:http
    ✓ Attachments replicate back and forth (167ms)
    ✓ Replicate same doc, same atts (172ms)
    ✓ Replicate same doc, same atts 2 (174ms)
    ✓ Attachments replicate (74ms)
    ✓ Attachment types replicate (162ms)
    ✓ Many many attachments replicate (348ms)
    ✓ Many many png attachments replicate (295ms)
    ✓ Multiple attachments replicate (124ms)
    - #3961 Many attachments on same doc
    ✓ Multiple attachments replicate, different docs (#2698) (129ms)
    ✓ Multiple attachments replicate, different docs png (#2698) (118ms)
    ✓ #3932 attachments with tricky revpos (224ms)
    ✓ replication with changing attachments (147ms)
    ✓ 3955 race condition in put
    ✓ #8456 bad attachment rev after replication (176ms)

  suite2 test.attachments.js- http:local
    ✓ Attachments replicate back and forth (106ms)
    ✓ Replicate same doc, same atts (151ms)
    ✓ Replicate same doc, same atts 2 (101ms)
    ✓ Attachments replicate (65ms)
    ✓ Attachment types replicate (56ms)
    ✓ Many many attachments replicate (139ms)
    ✓ Many many png attachments replicate (157ms)
    ✓ Multiple attachments replicate (80ms)
    - #3961 Many attachments on same doc
    ✓ Multiple attachments replicate, different docs (#2698) (67ms)
    ✓ Multiple attachments replicate, different docs png (#2698) (88ms)
    ✓ #3932 attachments with tricky revpos (142ms)
    ✓ replication with changing attachments (99ms)
    ✓ 3955 race condition in put
    ✓ #8456 bad attachment rev after replication (111ms)

  suite2 test.attachments.js- local:local
    ✓ Attachments replicate back and forth
    ✓ Replicate same doc, same atts
    ✓ Replicate same doc, same atts 2
    ✓ Attachments replicate
    ✓ Attachment types replicate
    ✓ Many many attachments replicate
    ✓ Many many png attachments replicate
    ✓ Multiple attachments replicate
    - #3961 Many attachments on same doc
    ✓ Multiple attachments replicate, different docs (#2698)
    ✓ Multiple attachments replicate, different docs png (#2698)
    ✓ #3932 attachments with tricky revpos (68ms)
    ✓ replication with changing attachments (43ms)
    ✓ 3955 race condition in put
    ✓ #8456 bad attachment rev after replication

  test.basics.js-http
    ✓ Create a pouch without new keyword
    ✓ Name is accessible via instance
    ✓ 4314 Create a pouch with + in name
    ✓ Creating Pouch without name will throw
    ✓ 4314 Create a pouch with urlencoded name
    ✓ 4219 destroy a pouch
    ✓ 4339 throw useful error if method called on stale instance (124ms)
    ✓ [4595] should reject xhr errors
    ✓ [4595] should emit error event on xhr error
    ✓ Add a doc
    ✓ Get invalid id
    ✓ Missing doc should contain ID in error object
    ✓ PUTed Conflicted doc should contain ID in error object
    ✓ POSTed Conflicted doc should contain ID in error object
    ✓ Add a doc with a promise
    ✓ Add a doc with opts object
    ✓ Modify a doc
    ✓ Modifying a doc that has rewritten content
    ✓ Modify a doc with a promise
    ✓ Read db id
    ✓ Read db id with promise
    ✓ Close db
    ✓ Close db with a promise
    ✓ Read db id after closing Close
    ✓ Modify a doc with incorrect rev
    ✓ Remove doc
    ✓ Remove doc with a promise
    ✓ Remove doc with new syntax
    ✓ Remove doc with new syntax and a promise
    ✓ Doc removal leaves only stub
    ✓ Remove doc twice with specified id
    ✓ Remove doc, no callback
    ✓ Delete document without id
    ✓ Delete document with many args
    ✓ Delete document with many args, callback style
    ✓ Delete doc with id + rev + no opts
    ✓ Delete doc with id + rev + no opts, callback style
    ✓ Delete doc with doc + opts
    ✓ Delete doc with doc + opts, callback style
    ✓ Delete doc with rev in opts
    ✓ Bulk docs
    ✓ Bulk docs with a promise
    ✓ Basic checks
    ✓ update with invalid rev
    ✓ Doc validation
    ✓ Replication fields (#2442)
    ✓ Testing issue #48 (54ms)
    ✓ Testing valid id
    ✓ Put doc without _id should fail
    ✓ Put doc with bad reserved id should fail
    ✓ update_seq persists
    ✓ deletions persists
    ✓ #4126 should not store raw Dates
    ✓ Create a db with a reserved name
    ✓ Error when document is not an object
    ✓ Test instance update_seq updates correctly
    ✓ Fail to fetch a doc after db was deleted (46ms)
    ✓ Fail to fetch a doc after db was deleted (55ms)
    ✓ Cant add docs with empty ids
    ✓ Test doc with percent in ID
    ✓ db.info should give auto_compaction = false (#2744)
    ✓ db.info should give auto_compaction = true (#2744)
    ✓ db.info should give adapter name (#3567)
    ✓ db.info should give correct doc_count
    ✓ putting returns {ok: true}
    ✓ putting is override-able
    ✓ issue 2779, deleted docs, old revs COUCHDB-292
    ✓ issue 2888, successive deletes and writes (61ms)
    ✓ 2 invalid puts
    ✓ Docs save "null" value
    ✓ replace PouchDB.destroy() (express-pouchdb#203)
    ✓ 3968, keeps all object fields
    ✓ 4712 invalid rev for new doc generates conflict
    ✓ test info() after db close
    ✓ test get() after db close
    ✓ test close() after db close
    ✓ 7259 should have "this" keyword properly scoped
    ✓ #5471 PouchDB.plugin() should throw error if passed wrong type or empty object

  test.basics.js-local
    ✓ Create a pouch without new keyword
    ✓ Name is accessible via instance
    ✓ 4314 Create a pouch with + in name
    ✓ Creating Pouch without name will throw
    ✓ 4314 Create a pouch with urlencoded name
    ✓ 4219 destroy a pouch
    ✓ 4339 throw useful error if method called on stale instance
    ✓ [4595] should reject xhr errors
    ✓ [4595] should emit error event on xhr error
    ✓ Add a doc
    ✓ Get invalid id
    ✓ Missing doc should contain ID in error object
    ✓ PUTed Conflicted doc should contain ID in error object
    ✓ POSTed Conflicted doc should contain ID in error object
    ✓ Add a doc with a promise
    ✓ Add a doc with opts object
    ✓ Modify a doc
    ✓ Modifying a doc that has rewritten content
    ✓ Modify a doc with a promise
    ✓ Read db id
    ✓ Read db id with promise
    ✓ Close db
    ✓ Close db with a promise
    ✓ Read db id after closing Close
    ✓ Modify a doc with incorrect rev
    ✓ Remove doc
    ✓ Remove doc with a promise
    ✓ Remove doc with new syntax
    ✓ Remove doc with new syntax and a promise
    ✓ Doc removal leaves only stub
    ✓ Remove doc twice with specified id
    ✓ Remove doc, no callback
    ✓ Delete document without id
    ✓ Delete document with many args
    ✓ Delete document with many args, callback style
    ✓ Delete doc with id + rev + no opts
    ✓ Delete doc with id + rev + no opts, callback style
    ✓ Delete doc with doc + opts
    ✓ Delete doc with doc + opts, callback style
    ✓ Delete doc with rev in opts
    ✓ Bulk docs
    ✓ Bulk docs with a promise
    ✓ Basic checks
    ✓ update with invalid rev
    ✓ Doc validation
    ✓ Replication fields (#2442)
    ✓ Allows _access field in documents (#8171)
    ✓ Testing issue #48 (51ms)
    ✓ Testing valid id
    ✓ Put doc without _id should fail
    ✓ Put doc with bad reserved id should fail
    ✓ update_seq persists
    ✓ deletions persists
    ✓ #4126 should not store raw Dates
    ✓ Create a db with a reserved name
    ✓ Error when document is not an object
    ✓ Test instance update_seq updates correctly
    ✓ Fail to fetch a doc after db was deleted (53ms)
    ✓ Fail to fetch a doc after db was deleted (45ms)
    ✓ Cant add docs with empty ids
    ✓ Test doc with percent in ID
    ✓ db.info should give auto_compaction = false (#2744)
    ✓ db.info should give auto_compaction = true (#2744)
    ✓ db.info should give adapter name (#3567)
    ✓ db.info should give correct doc_count
    ✓ putting returns {ok: true}
    ✓ putting is override-able
    ✓ issue 2779, deleted docs, old revs COUCHDB-292
    ✓ issue 2888, successive deletes and writes
    ✓ 2 invalid puts
    ✓ Docs save "null" value
    ✓ replace PouchDB.destroy() (express-pouchdb#203)
    ✓ 3968, keeps all object fields
    ✓ 4712 invalid rev for new doc generates conflict
    ✓ test info() after db close
    ✓ test get() after db close
    ✓ test close() after db close
    ✓ 7259 should have "this" keyword properly scoped
    ✓ should allow unicode doc ids
    ✓ should have same blob support for 2 dbs
    ✓ 6053, PouchDB.plugin() resets defaults
    ✓ #5471 PouchDB.plugin() should throw error if passed wrong type or empty object

  test.bulk_docs.js-local
    ✓ Testing bulk docs
    ✓ #6039 test id in bulk docs for conflict
    ✓ No id in bulk docs
    ✓ No _rev and new_edits=false
    ✓ 7829 bare rev 1- with new_edits=false
    ✓ Test empty bulkDocs
    ✓ Test many bulkDocs
    ✓ Test errors on invalid doc id
    ✓ Test two errors on invalid doc id
    ✓ No docs
    ✓ Jira 911
    ✓ Test multiple bulkdocs
    ✓ #2935 new_edits=false correct number
    ✓ #2935 new_edits=false correct number 2
    ✓ bulk docs update then delete then conflict
    ✓ bulk_docs delete then undelete
    ✓ #2935 new_edits=false with single unauthorized
    ✓ Deleting _local docs with bulkDocs
    ✓ Deleting _local docs with bulkDocs, not found
    ✓ Deleting _local docs with bulkDocs, wrong rev
    ✓ Bulk with new_edits=false
    ✓ Testing successive new_edits to the same doc
    ✓ #3062 bulkDocs with staggered seqs
    ✓ Testing successive new_edits to the same doc, different content
    ✓ Testing successive new_edits to two doc
    ✓ Deletion with new_edits=false
    ✓ Deletion with new_edits=false, no history
    ✓ Modification with new_edits=false, no history
    ✓ Deletion with new_edits=false, no history, no revisions
    ✓ Testing new_edits=false in req body
    ✓ 656 regression in handling deleted docs
    ✓ Test quotes in doc ids
    ✓ Bulk docs empty list
    ✓ handles simultaneous writes
    ✓ bulk docs input by array
    ✓ Bulk empty list
    ✓ Bulk docs not an array
    ✓ Bulk docs not an object
    ✓ Bulk docs two different revisions to same document id
    ✓ 4204 respect revs_limit (261ms)
    ✓ 2839 implement revs_limit (192ms)
    ✓ 4372 revs_limit deletes old revisions of the doc
    ✓ 4372 revs_limit with auto_compaction deletes old revisions of the doc
    ✓ 4712 invalid rev for new doc generates conflict
    ✓ 5793 bulk docs accepts _conflicts when new_edits=false

  test.bulk_docs.js-http
    ✓ Testing bulk docs (46ms)
    ✓ #6039 test id in bulk docs for conflict
    ✓ No id in bulk docs
    ✓ No _rev and new_edits=false
    ✓ 7829 bare rev 1- with new_edits=false
    ✓ Test empty bulkDocs
    ✓ Test many bulkDocs
    ✓ Test errors on invalid doc id
    ✓ Test two errors on invalid doc id
    ✓ No docs
    ✓ Jira 911
    ✓ Test multiple bulkdocs
    ✓ #2935 new_edits=false correct number
    ✓ #2935 new_edits=false correct number 2
    ✓ bulk docs update then delete then conflict
    ✓ bulk_docs delete then undelete
    ✓ #2935 new_edits=false with single unauthorized
    ✓ Deleting _local docs with bulkDocs (43ms)
    ✓ Bulk with new_edits=false
    ✓ Testing successive new_edits to the same doc
    ✓ #3062 bulkDocs with staggered seqs
    ✓ Testing successive new_edits to the same doc, different content
    ✓ Testing successive new_edits to two doc
    ✓ Deletion with new_edits=false
    ✓ Deletion with new_edits=false, no history
    ✓ Modification with new_edits=false, no history
    ✓ Deletion with new_edits=false, no history, no revisions
    ✓ Testing new_edits=false in req body
    ✓ 656 regression in handling deleted docs
    ✓ Test quotes in doc ids
    ✓ Bulk docs empty list
    ✓ handles simultaneous writes
    ✓ bulk docs input by array (40ms)
    ✓ Bulk empty list
    ✓ Bulk docs not an array
    ✓ Bulk docs not an object
    ✓ Bulk docs two different revisions to same document id
    ✓ 4204 respect revs_limit (326ms)
    ✓ 2839 implement revs_limit
    ✓ 4372 revs_limit deletes old revisions of the doc
    ✓ 4372 revs_limit with auto_compaction deletes old revisions of the doc
    ✓ 4712 invalid rev for new doc generates conflict
    ✓ 5793 bulk docs accepts _conflicts when new_edits=false (39ms)

  test.bulk_get.js-http
    ✓ test bulk get with rev specified
    ✓ test bulk get with latest=true
    ✓ test bulk get with no rev specified
    ✓ _revisions is not returned by default
    ✓ #5886 bulkGet with reserved id
    ✓ _revisions is returned when specified
    ✓ _revisions is returned when specified, using implicit rev
    ✓ attachments are not included by default
    ✓ attachments are included when specified
    ✓ attachments are included when specified, using implicit rev

  test.bulk_get.js-local
    ✓ test bulk get with rev specified
    ✓ test bulk get with latest=true
    ✓ test bulk get with no rev specified
    ✓ _revisions is not returned by default
    ✓ #5886 bulkGet with reserved id
    ✓ _revisions is returned when specified
    ✓ _revisions is returned when specified, using implicit rev
    ✓ attachments are not included by default
    ✓ attachments are included when specified
    ✓ attachments are included when specified, using implicit rev

  test.changes.js-http
    ✓ All changes
    ✓ Changes with complete callback as param
    ✓ Promise resolved when changes cancelled
    - Live changes should clean listener when cancelled
    ✓ Changes Since
    ✓ Changes Since and limit limit 1
    ✓ Changes Since and limit limit 0
    ✓ Changes limit (38ms)
    ✓ Changes with filter not present in ddoc
    ✓ Changes with `filters` key not present in ddoc
    ✓ Changes limit and filter
    ✓ Changes with shorthand function name
    ✓ Changes with filter from nonexistent ddoc
    ✓ Changes with view not present in ddoc
    ✓ Changes with `views` key not present in ddoc
    ✓ #4451 Changes with invalid view filter
    ✓ 3356 throw inside a filter
    ✓ Changes with missing param `view` in request
    ✓ Changes limit and view instead of filter
    ✓ #3609 view option implies filter: _view
    ✓ Immediately cancel changes
    ✓ Changes with invalid ddoc view name
    ✓ Changes with invalid ddoc view name 2
    ✓ Changes with style = all_docs (62ms)
    ✓ Changes with style = all_docs and a callback for complete (55ms)
    ✓ Changes limit = 0
    ✓ Changes doc
    - Descending many changes
    ✓ live-changes
    ✓ Multiple watchers
    ✓ Continuous changes doc
    ✓ Cancel changes (320ms)
    ✓ #3579 changes firing 1 too many times (75ms)
    ✓ Kill database while listening to live changes
    ✓ #3136 style=all_docs
    ✓ #4191 revs_diff causes endless loop
    ✓ #3136 style=all_docs & include_docs
    ✓ changes-filter with query params
    ✓ Non-live changes filter
    ✓ Non-live changes filter, descending
    ✓ #2569 Non-live doc_ids filter
    ✓ #2569 Big non-live doc_ids filter
    ✓ #2569 Live doc_ids filter
    ✓ #2569 Big live doc_ids filter
    ✓ #2569 Non-live doc_ids filter with filter=_doc_ids
    ✓ #2569 Live doc_ids filter with filter=_doc_ids
    ✓ Changes to same doc are grouped
    ✓ Changes with conflicts are handled correctly (129ms)
    ✓ Change entry for a deleted doc
    ✓ changes large number of docs (49ms)
    ✓ Calling db.changes({since: 'now'})
    ✓ Calling db.changes({since: 'latest'})
    ✓ Closing db does not cause a crash if changes cancelled
    ✓ fire-complete-on-cancel (101ms)
    ✓ changes are not duplicated (1031ms)
    ✓ supports return_docs=false
    ✓ should respects limit (75ms)
    ✓ doesn't throw if opts.complete is undefined
    ✓ handle individual changes in live replication (199ms)
    ✓ changes-filter without filter
    ✓ #3539 - Exception in changes is fine
    ✓ Changes with selector
    ✓ Changes with selector, explicit filter
    ✓ Changes with selector and mismatched filter
    ✓ Changes with limit and selector

  test.changes.js-local
    ✓ All changes
    ✓ Changes with complete callback as param
    ✓ Promise resolved when changes cancelled
    - Live changes should clean listener when cancelled
    ✓ Changes Since
    ✓ Changes Since and limit limit 1
    ✓ Changes Since and limit limit 0
    ✓ Changes limit
    ✓ Changes with filter not present in ddoc
    ✓ Changes with `filters` key not present in ddoc
    ✓ Changes limit and filter
    ✓ Changes with shorthand function name
    ✓ Changes with filter from nonexistent ddoc
    ✓ Changes with view not present in ddoc
    ✓ Changes with `views` key not present in ddoc
    ✓ #4451 Changes with invalid view filter
    ✓ 3356 throw inside a filter
    ✓ Changes with missing param `view` in request
    ✓ Changes limit and view instead of filter
    ✓ #3609 view option implies filter: _view
    ✓ Immediately cancel changes
    ✓ Changes with invalid ddoc view name
    ✓ Changes with invalid ddoc view name 2
    ✓ Changes with style = all_docs
    ✓ Changes with style = all_docs and a callback for complete
    ✓ Changes limit = 0
    ✓ Changes doc
    - Descending many changes
    ✓ live-changes
    ✓ Multiple watchers
    ✓ Continuous changes doc
    ✓ Cancel changes (327ms)
    ✓ #3579 changes firing 1 too many times (70ms)
    ✓ Kill database while listening to live changes
    ✓ #3136 style=all_docs
    ✓ #4191 revs_diff causes endless loop
    ✓ #3136 style=all_docs & include_docs
    ✓ changes-filter with query params
    ✓ Non-live changes filter
    ✓ Non-live changes filter, descending
    ✓ #2569 Non-live doc_ids filter
    ✓ #2569 Big non-live doc_ids filter
    ✓ #2569 Live doc_ids filter
    ✓ #2569 Big live doc_ids filter
    ✓ #2569 Non-live doc_ids filter with filter=_doc_ids
    ✓ #2569 Live doc_ids filter with filter=_doc_ids
    ✓ Changes to same doc are grouped
    ✓ Changes with conflicts are handled correctly
    ✓ Change entry for a deleted doc
    ✓ changes large number of docs
    ✓ Calling db.changes({since: 'now'})
    ✓ Calling db.changes({since: 'latest'})
    ✓ Closing db does not cause a crash if changes cancelled
    ✓ fire-complete-on-cancel (100ms)
    ✓ changes are not duplicated (1016ms)
    ✓ supports return_docs=false
    ✓ should respects limit (66ms)
    ✓ doesn't throw if opts.complete is undefined
    ✓ handle individual changes in live replication (72ms)
    ✓ changes-filter without filter
    ✓ #3539 - Exception in changes is fine
    ✓ Changes with selector
    ✓ Changes with selector, explicit filter
    ✓ Changes with selector and mismatched filter
    ✓ Changes with limit and selector

  changes-standalone
    - Changes reports errors

  test.close.js-local
    ✓ should emit destroyed even when closed (sync)
    ✓ should emit destroyed even when closed (async)
precondition_failed: Database not open
    at Object.<anonymous> (/data/js-variants/multee/Clients/levelup/pouchdb/packages/node_modules/pouchdb/lib/index.js:614:16)
    at Module._compile (node:internal/modules/cjs/loader:1105:14)
    at Module._extensions..js (node:internal/modules/cjs/loader:1159:10)
    at Module.load (node:internal/modules/cjs/loader:981:32)
    at Module._load (node:internal/modules/cjs/loader:827:12)
    at Module.require (node:internal/modules/cjs/loader:1005:19)
    at require (node:internal/modules/cjs/helpers:102:18)
    at commonUtils.loadPouchDBForNode (/data/js-variants/multee/Clients/levelup/pouchdb/tests/common-utils.js:92:17)
    at commonUtils.loadPouchDB (/data/js-variants/multee/Clients/levelup/pouchdb/tests/common-utils.js:78:39)
    at Object.<anonymous> (/data/js-variants/multee/Clients/levelup/pouchdb/tests/integration/node.setup.js:21:28)
    at Module._compile (node:internal/modules/cjs/loader:1105:14)
    at Module._extensions..js (node:internal/modules/cjs/loader:1159:10)
    at Module.load (node:internal/modules/cjs/loader:981:32)
    at Module._load (node:internal/modules/cjs/loader:827:12)
    at Module.require (node:internal/modules/cjs/loader:1005:19)
    at require (node:internal/modules/cjs/helpers:102:18)
    at /data/js-variants/multee/Clients/levelup/pouchdb/node_modules/mocha/bin/_mocha:366:3
    at Array.forEach (<anonymous>)
    at Object.<anonymous> (/data/js-variants/multee/Clients/levelup/pouchdb/node_modules/mocha/bin/_mocha:365:10)
    at Module._compile (node:internal/modules/cjs/loader:1105:14)
    at Module._extensions..js (node:internal/modules/cjs/loader:1159:10)
    at Module.load (node:internal/modules/cjs/loader:981:32)
    at Module._load (node:internal/modules/cjs/loader:827:12)
    at Function.executeUserEntryPoint [as runMain] (node:internal/modules/run_main:77:12)
    at node:internal/main/run_main_module:17:47
    ✓ should emit closed even when destroyed (async #2)
precondition_failed: Database not open
    at Object.<anonymous> (/data/js-variants/multee/Clients/levelup/pouchdb/packages/node_modules/pouchdb/lib/index.js:614:16)
    at Module._compile (node:internal/modules/cjs/loader:1105:14)
    at Module._extensions..js (node:internal/modules/cjs/loader:1159:10)
    at Module.load (node:internal/modules/cjs/loader:981:32)
    at Module._load (node:internal/modules/cjs/loader:827:12)
    at Module.require (node:internal/modules/cjs/loader:1005:19)
    at require (node:internal/modules/cjs/helpers:102:18)
    at commonUtils.loadPouchDBForNode (/data/js-variants/multee/Clients/levelup/pouchdb/tests/common-utils.js:92:17)
    at commonUtils.loadPouchDB (/data/js-variants/multee/Clients/levelup/pouchdb/tests/common-utils.js:78:39)
    at Object.<anonymous> (/data/js-variants/multee/Clients/levelup/pouchdb/tests/integration/node.setup.js:21:28)
    at Module._compile (node:internal/modules/cjs/loader:1105:14)
    at Module._extensions..js (node:internal/modules/cjs/loader:1159:10)
    at Module.load (node:internal/modules/cjs/loader:981:32)
    at Module._load (node:internal/modules/cjs/loader:827:12)
    at Module.require (node:internal/modules/cjs/loader:1005:19)
    at require (node:internal/modules/cjs/helpers:102:18)
    at /data/js-variants/multee/Clients/levelup/pouchdb/node_modules/mocha/bin/_mocha:366:3
    at Array.forEach (<anonymous>)
    at Object.<anonymous> (/data/js-variants/multee/Clients/levelup/pouchdb/node_modules/mocha/bin/_mocha:365:10)
    at Module._compile (node:internal/modules/cjs/loader:1105:14)
    at Module._extensions..js (node:internal/modules/cjs/loader:1159:10)
    at Module.load (node:internal/modules/cjs/loader:981:32)
    at Module._load (node:internal/modules/cjs/loader:827:12)
    at Function.executeUserEntryPoint [as runMain] (node:internal/modules/run_main:77:12)
    at node:internal/main/run_main_module:17:47
    ✓ test unref for coverage
    ✓ test double unref for coverage
precondition_failed: Database not open
    at Object.<anonymous> (/data/js-variants/multee/Clients/levelup/pouchdb/packages/node_modules/pouchdb/lib/index.js:614:16)
    at Module._compile (node:internal/modules/cjs/loader:1105:14)
    at Module._extensions..js (node:internal/modules/cjs/loader:1159:10)
    at Module.load (node:internal/modules/cjs/loader:981:32)
    at Module._load (node:internal/modules/cjs/loader:827:12)
    at Module.require (node:internal/modules/cjs/loader:1005:19)
    at require (node:internal/modules/cjs/helpers:102:18)
    at commonUtils.loadPouchDBForNode (/data/js-variants/multee/Clients/levelup/pouchdb/tests/common-utils.js:92:17)
    at commonUtils.loadPouchDB (/data/js-variants/multee/Clients/levelup/pouchdb/tests/common-utils.js:78:39)
    at Object.<anonymous> (/data/js-variants/multee/Clients/levelup/pouchdb/tests/integration/node.setup.js:21:28)
    at Module._compile (node:internal/modules/cjs/loader:1105:14)
    at Module._extensions..js (node:internal/modules/cjs/loader:1159:10)
    at Module.load (node:internal/modules/cjs/loader:981:32)
    at Module._load (node:internal/modules/cjs/loader:827:12)
    at Module.require (node:internal/modules/cjs/loader:1005:19)
    at require (node:internal/modules/cjs/helpers:102:18)
    at /data/js-variants/multee/Clients/levelup/pouchdb/node_modules/mocha/bin/_mocha:366:3
    at Array.forEach (<anonymous>)
    at Object.<anonymous> (/data/js-variants/multee/Clients/levelup/pouchdb/node_modules/mocha/bin/_mocha:365:10)
    at Module._compile (node:internal/modules/cjs/loader:1105:14)
    at Module._extensions..js (node:internal/modules/cjs/loader:1159:10)
    at Module.load (node:internal/modules/cjs/loader:981:32)
    at Module._load (node:internal/modules/cjs/loader:827:12)
    at Function.executeUserEntryPoint [as runMain] (node:internal/modules/run_main:77:12)
    at node:internal/main/run_main_module:17:47
    ✓ test close-then-destroyed for coverage
************* run test done *************
pouchdb is testing ./Variants/levelup/variant7/levelup
/data/js-variants/multee
************* npm unlink module *************

removed 1 package, changed 1 package, and audited 1032 packages in 4s

64 packages are looking for funding
  run `npm fund` for details

41 vulnerabilities (1 low, 9 moderate, 25 high, 6 critical)

To address issues that do not require attention, run:
  npm audit fix

To address all issues possible (including breaking changes), run:
  npm audit fix --force

Some issues need review, and may require choosing
a different dependency.

Run `npm audit` for details.
************* npm unlink module done *************
************* npm unlink globally *************

removed 1 package, and audited 1 package in 1s

found 0 vulnerabilities
************* npm unlink globally done *************
************* npm link globally *************

added 1 package, and audited 3 packages in 404ms

found 0 vulnerabilities
************* npm link globally done *************
************* npm link module *************

added 1 package, changed 1 package, and audited 1034 packages in 4s

64 packages are looking for funding
  run `npm fund` for details

41 vulnerabilities (1 low, 9 moderate, 25 high, 6 critical)

To address issues that do not require attention, run:
  npm audit fix

To address all issues possible (including breaking changes), run:
  npm audit fix --force

Some issues need review, and may require choosing
a different dependency.

Run `npm audit` for details.
************* npm link module done *************
************* start run test *************

> pouchdb-monorepo@7.0.0-prerelease test
> bash bin/run-test.sh


> pouchdb-monorepo@7.0.0-prerelease build-node
> bash bin/build-node.sh


> pouchdb-monorepo@7.0.0-prerelease build-modules
> node bin/build-modules.js

Building pouchdb...
Building pouchdb-abstract-mapreduce...
Building pouchdb-adapter-http...
Building pouchdb-adapter-idb...
Building pouchdb-adapter-indexeddb...
Building pouchdb-adapter-leveldb...
Building pouchdb-adapter-leveldb-core...
Building pouchdb-adapter-localstorage...
Building pouchdb-adapter-memory...
Building pouchdb-adapter-utils...
Building pouchdb-binary-utils...
Building pouchdb-browser...
Building pouchdb-changes-filter...
Building pouchdb-checkpointer...
Building pouchdb-collate...
Building pouchdb-collections...
Building pouchdb-core...
Building pouchdb-errors...
Building pouchdb-fetch...
Building pouchdb-find...
Building pouchdb-for-coverage...
Building pouchdb-generate-replication-id...
Building pouchdb-json...
Building pouchdb-mapreduce...
Building pouchdb-mapreduce-utils...
Building pouchdb-md5...
Building pouchdb-merge...
Building pouchdb-node...
Building pouchdb-replication...
Building pouchdb-selector-core...
Building pouchdb-utils...
Building sublevel-pouchdb...
  ✓ wrote pouchdb-adapter-localstorage/lib/index.js in vanilla mode
  ✓ wrote pouchdb-adapter-localstorage/lib/index.es.js in vanilla mode
  ✓ wrote pouchdb-adapter-memory/lib/index.js in vanilla mode
  ✓ wrote pouchdb-adapter-memory/lib/index.es.js in vanilla mode
  ✓ wrote pouchdb-checkpointer/lib/index.js in vanilla mode
  ✓ wrote pouchdb-checkpointer/lib/index.es.js in vanilla mode
  ✓ wrote pouchdb-errors/lib/index.js in vanilla mode
  ✓ wrote pouchdb-errors/lib/index.es.js in vanilla mode
  ✓ wrote pouchdb-generate-replication-id/lib/index.js in vanilla mode
  ✓ wrote pouchdb-generate-replication-id/lib/index.es.js in vanilla mode
  ✓ wrote pouchdb-adapter-http/lib/index.js in vanilla mode
  ✓ wrote pouchdb-adapter-http/lib/index.es.js in vanilla mode
  ✓ wrote pouchdb-adapter-leveldb/lib/index.js in node mode
  ✓ wrote pouchdb-adapter-leveldb/lib/index.es.js in node mode
  ✓ wrote pouchdb-adapter-leveldb/lib/index-browser.js in browser mode
  ✓ wrote pouchdb-adapter-leveldb/lib/index-browser.es.js in browser mode
  ✓ wrote pouchdb-adapter-leveldb-core/lib/index.js in node mode
  ✓ wrote pouchdb-adapter-leveldb-core/lib/index.es.js in node mode
  ✓ wrote pouchdb-adapter-leveldb-core/lib/index-browser.js in browser mode
  ✓ wrote pouchdb-adapter-leveldb-core/lib/index-browser.es.js in browser mode
  ✓ wrote pouchdb-changes-filter/lib/index-browser.js in browser mode
  ✓ wrote pouchdb-changes-filter/lib/index-browser.es.js in browser mode
  ✓ wrote pouchdb-fetch/lib/index-browser.js in browser mode
  ✓ wrote pouchdb-fetch/lib/index-browser.es.js in browser mode
  ✓ wrote pouchdb-md5/lib/index-browser.js in browser mode
  ✓ wrote pouchdb-md5/lib/index-browser.es.js in browser mode
  ✓ wrote pouchdb-changes-filter/lib/index.js in node mode
  ✓ wrote pouchdb-changes-filter/lib/index.es.js in node mode
  ✓ wrote pouchdb-collate/lib/index.js in vanilla mode
  ✓ wrote pouchdb-collate/lib/index.es.js in vanilla mode
  ✓ wrote pouchdb-fetch/lib/index.js in node mode
  ✓ wrote pouchdb-fetch/lib/index.es.js in node mode
  ✓ wrote pouchdb-json/lib/index.js in vanilla mode
  ✓ wrote pouchdb-json/lib/index.es.js in vanilla mode
  ✓ wrote pouchdb-mapreduce-utils/lib/index.js in vanilla mode
  ✓ wrote pouchdb-mapreduce-utils/lib/index.es.js in vanilla mode
  ✓ wrote pouchdb-md5/lib/index.js in node mode
  ✓ wrote pouchdb-md5/lib/index.es.js in node mode
  ✓ wrote pouchdb-abstract-mapreduce/lib/index.js in vanilla mode
  ✓ wrote pouchdb-abstract-mapreduce/lib/index.es.js in vanilla mode
  ✓ wrote pouchdb-adapter-idb/lib/index.js in vanilla mode
  ✓ wrote pouchdb-adapter-idb/lib/index.es.js in vanilla mode
  ✓ wrote pouchdb-adapter-indexeddb/lib/index.js in vanilla mode
  ✓ wrote pouchdb-adapter-indexeddb/lib/index.es.js in vanilla mode
  ✓ wrote pouchdb-binary-utils/lib/index-browser.js in browser mode
  ✓ wrote pouchdb-binary-utils/lib/index-browser.es.js in browser mode
  ✓ wrote pouchdb-utils/lib/index-browser.js in browser mode
  ✓ wrote pouchdb-utils/lib/index-browser.es.js in browser mode
  ✓ wrote pouchdb-utils/lib/index.js in node mode
  ✓ wrote pouchdb-utils/lib/index.es.js in node mode
  ✓ wrote pouchdb-adapter-utils/lib/index.js in vanilla mode
  ✓ wrote pouchdb-adapter-utils/lib/index.es.js in vanilla mode
  ✓ wrote pouchdb-binary-utils/lib/index.js in node mode
  ✓ wrote pouchdb-binary-utils/lib/index.es.js in node mode
  ✓ wrote pouchdb-collections/lib/index.js in vanilla mode
  ✓ wrote pouchdb-collections/lib/index.es.js in vanilla mode
  ✓ wrote pouchdb-merge/lib/index.js in vanilla mode
  ✓ wrote pouchdb-merge/lib/index.es.js in vanilla mode
  ✓ wrote pouchdb-selector-core/lib/index.js in vanilla mode
  ✓ wrote pouchdb-selector-core/lib/index.es.js in vanilla mode
  ✓ wrote sublevel-pouchdb/lib/index.js in vanilla mode
  ✓ wrote sublevel-pouchdb/lib/index.es.js in vanilla mode
  ✓ wrote pouchdb-mapreduce/lib/index-browser.js in browser mode
  ✓ wrote pouchdb-mapreduce/lib/index-browser.es.js in browser mode
  ✓ wrote pouchdb-replication/lib/index.js in vanilla mode
  ✓ wrote pouchdb-replication/lib/index.es.js in vanilla mode
  ✓ wrote pouchdb-mapreduce/lib/index.js in node mode
  ✓ wrote pouchdb-mapreduce/lib/index.es.js in node mode
  ✓ wrote pouchdb-core/lib/index.js in vanilla mode
  ✓ wrote pouchdb-core/lib/index.es.js in vanilla mode
  ✓ wrote pouchdb-find/lib/index.js in node mode
  ✓ wrote pouchdb-find/lib/index.es.js in node mode
  ✓ wrote pouchdb-find/lib/index-browser.js in browser mode
  ✓ wrote pouchdb-find/lib/index-browser.es.js in browser mode
  ✓ wrote pouchdb-for-coverage/lib/index.js in node mode
  ✓ wrote pouchdb-for-coverage/lib/index.es.js in node mode
  ✓ wrote pouchdb-for-coverage/lib/index-browser.js in browser mode
  ✓ wrote pouchdb-for-coverage/lib/index-browser.es.js in browser mode
  ✓ wrote pouchdb-browser/lib/index.js in vanilla mode
  ✓ wrote pouchdb-browser/lib/index.es.js in vanilla mode
  ✓ wrote pouchdb-node/lib/index.js in vanilla mode
  ✓ wrote pouchdb-node/lib/index.es.js in vanilla mode
  ✓ wrote packages/node_modules/pouchdb/lib/index.js
  ✓ wrote packages/node_modules/pouchdb/lib/index.es.js
Waiting for host to start ..
Host started :)
> pouchdb-monorepo@7.0.0-prerelease test-node
> bash bin/test-node.sh

Down server listening on port 3010
Seeded with: 1660143075127


  DB Setup
    ✓ PouchDB has a version
    ✓ PouchDB version matches package.json

  test.active_tasks.js
    ✓ Can add a task
    ✓ Can get tasks by id
    ✓ Can get all tasks
    ✓ Can update a task
    ✓ Can remove a task

  test.all_docs.js-http
    ✓ Testing all docs (148ms)
    ✓ Testing allDocs opts.keys (68ms)
    ✓ Testing allDocs opts.keys with skip
    ✓ Testing allDocs opts.keys with limit
    ✓ Testing allDocs invalid opts.keys
    ✓ Testing deleting in changes (47ms)
    ✓ Testing updating in changes (55ms)
    ✓ Testing include docs (39ms)
    ✓ Testing conflicts (50ms)
    ✓ test basic collation
    ✓ 3883 start_key end_key aliases
    ✓ test total_rows with a variety of criteria (131ms)
    ✓ test total_rows with both skip and limit (41ms)
    ✓ test limit option and total_rows
    ✓ test escaped startkey/endkey
    ✓ test "key" option
    ✓ test inclusive_end=false (53ms)
    ✓ test descending with startkey/endkey
    ✓ #3082 test wrong num results returned (245ms)
    ✓ test empty db
    ✓ test after db close
    ✓ 5793 _conflicts should not exist if no conflicts (40ms)
    ✓ #6230 Test allDocs opts update_seq: false
    ✓ #6230 Test allDocs opts update_seq: true
    ✓ #6230 Test allDocs opts with update_seq missing

  test.all_docs.js-local
    ✓ Testing all docs
    ✓ Testing allDocs opts.keys
    ✓ Testing allDocs opts.keys with skip
    ✓ Testing allDocs opts.keys with limit
    ✓ Testing allDocs invalid opts.keys
    ✓ Testing deleting in changes
    ✓ Testing updating in changes
    ✓ Testing include docs
    ✓ Testing conflicts
    ✓ test basic collation
    ✓ 3883 start_key end_key aliases
    ✓ test total_rows with a variety of criteria
    ✓ test total_rows with both skip and limit
    ✓ test limit option and total_rows
    ✓ test escaped startkey/endkey
    ✓ test "key" option
    ✓ test inclusive_end=false
    ✓ test descending with startkey/endkey
    ✓ #3082 test wrong num results returned (181ms)
    ✓ test empty db
    ✓ test after db close
    ✓ test unicode ids and revs
    ✓ 5793 _conflicts should not exist if no conflicts
    ✓ #6230 Test allDocs opts update_seq: false
    ✓ #6230 Test allDocs opts update_seq: true
    ✓ #6230 Test allDocs opts with update_seq missing

  suite2 test.attachments.js-local
    ✓ 3357 Attachment names cant start with _
    ✓ 5736 warning for putAttachment without content_type
    ✓ 5736 warning for bulkDocs attachments without content_type
    ✓ fetch atts with open_revs and missing
    ✓ issue 2803 should throw 412
    ✓ issue 2803 should throw 412 part 2
    ✓ issue 2803 should throw 412 part 3
    ✓ issue 2803 should throw 412 part 4
    ✓ #2858 {binary: true} in get()
    ✓ #2858 {binary: true} in allDocs() 1
    ✓ #2858 {binary: true} in allDocs() 2
    ✓ #2858 {binary: true} in allDocs() 3
    ✓ #2858 {binary: true} in allDocs() 4
    ✓ #2858 {binary: true} in allDocs() 5
    ✓ #2858 {binary: true} in allDocs(), many atts
    ✓ #2858 {binary: true} in allDocs(), mixed atts
    ✓ #2858 {binary: true} in changes() non-live
    ✓ #2858 {binary: true} in changes() non-live, many atts
    ✓ #2858 {binary: true} in changes() non-live, mixed atts
    ✓ #2858 {binary: true} non-live changes, complete event
    ✓ #2858 {binary: true} in live changes
    ✓ #2858 {binary: true} in live changes, mixed atts
    ✓ #2858 {binary: true} in live+retry changes
    ✓ #2858 {binary: true} in live changes, attachments:false
    ✓ #2858 {binary: true} in live changes, include_docs:false
    ✓ #6736 {binary: true} in bulkGet()
    ✓ Measures length correctly after put()
    ✓ #3074 non-live changes()
    ✓ #3074 live changes()
    ✓ #3074 non-live changes(), no attachments
    ✓ #3074 live changes(), no attachments
    ✓ #3881 filter extraneous keys from _attachments
    ✓ #2771 allDocs() 1, single attachment
    ✓ #2771 allDocs() 2, many docs same att
    ✓ #2771 allDocs() 3, many docs diff atts
    ✓ #2771 allDocs() 4, mix of atts and no atts
    ✓ #2771 allDocs() 5, no atts
    ✓ #2771 allDocs() 6, no docs
    ✓ #2771 allDocs() 7, revisions and deletions
    ✓ #2771 allDocs() 8, empty attachment
    ✓ No length for non-stubs
    ✓ Test some attachments
    ✓ Test getAttachment
    ✓ Test getAttachment with stubs
    ✓ Test get() with binary:true and stubs
    ✓ Test attachments in allDocs/changes
    ✓ Test putAttachment with base64 plaintext
    ✓ Test putAttachment with invalid base64
    ✓ Test getAttachment with empty text
    ✓ Test getAttachment with normal text
    ✓ Test getAttachment with PNG
    ✓ Test getAttachment with PNG using bulkDocs
    ✓ Test getAttachment with PNG using post
    ✓ Test postAttachment with PNG then bulkDocs
    ✓ proper stub behavior
    ✓ Testing with invalid docs
    ✓ Test create attachment and doc in one go
    ✓ Test create attachment and doc in one go without callback
    ✓ Test create attachment without callback
    ✓ Test put attachment on a doc without attachments
    ✓ Test put attachment with unencoded name
    ✓ 3963 length property on stubs
    ✓ Testing with invalid rev
    ✓ Test put another attachment on a doc with attachments
    ✓ Test get with attachments: true if empty attachments
    ✓ Test delete attachment from a doc
    ✓ Test a document with a json string attachment
    ✓ Test remove doc with attachment
    ✓ Try to insert a doc with unencoded attachment
    ✓ Try to get attachment of unexistent doc
    ✓ Test synchronous putAttachment with text data
    ✓ Test synchronous putAttachment with no text data
    ✓ Test put with partial stubs
    ✓ Test put with attachments and new_edits=false
    ✓ Test getAttachment with specific rev
    ✓ Test getAttachment with diff revs and content
    ✓ Test stubs
    ✓ Try to get unexistent attachment of some doc
    ✓ putAttachment and getAttachment with plaintext
    ✓ putAttachment and getAttachment with png data
    ✓ putAttachment in new doc with base64
    ✓ #2818 - save same attachment in different revs
    ✓ #2818 - save same attachment many times in parallel
    ✓ #2818 - revisions keep attachments (no compaction)
    ✓ #2818 - doesn't throw 409 if same filename
    ✓ #3008 test correct encoding/decoding of \u0000 etc.
    ✓ putAttachment and getAttachment with big png data (87ms)
    ✓ #2709 `revpos` with putAttachment
    ✓ #2709 `revpos` with inline attachment
    ✓ #2709 `revpos` with allDocs
    ✓ #7403 {attachments: true, binary: true, include_docs: true} in allDocs with one missing doc

  suite2 test.attachments.js-http
    ✓ 3357 Attachment names cant start with _
    ✓ 5736 warning for putAttachment without content_type
    ✓ 5736 warning for bulkDocs attachments without content_type
    ✓ fetch atts with open_revs and missing
    ✓ issue 2803 should throw 412
    ✓ issue 2803 should throw 412 part 2
    ✓ issue 2803 should throw 412 part 3
    ✓ issue 2803 should throw 412 part 4
    ✓ #2858 {binary: true} in get()
    ✓ #2858 {binary: true} in allDocs() 1
    ✓ #2858 {binary: true} in allDocs() 2
    ✓ #2858 {binary: true} in allDocs() 3
    ✓ #2858 {binary: true} in allDocs() 4
    ✓ #2858 {binary: true} in allDocs() 5
    ✓ #2858 {binary: true} in allDocs(), many atts
    ✓ #2858 {binary: true} in allDocs(), mixed atts
    ✓ #2858 {binary: true} in changes() non-live
    ✓ #2858 {binary: true} in changes() non-live, many atts
    ✓ #2858 {binary: true} in changes() non-live, mixed atts
    ✓ #2858 {binary: true} non-live changes, complete event
    ✓ #2858 {binary: true} in live changes
    ✓ #2858 {binary: true} in live changes, mixed atts
    ✓ #2858 {binary: true} in live+retry changes
    ✓ #2858 {binary: true} in live changes, attachments:false
    ✓ #2858 {binary: true} in live changes, include_docs:false
    ✓ #6736 {binary: true} in bulkGet()
    ✓ Measures length correctly after put()
    ✓ #3074 non-live changes() (38ms)
    ✓ #3074 live changes()
    ✓ #3074 non-live changes(), no attachments
    ✓ #3074 live changes(), no attachments
    ✓ #3881 filter extraneous keys from _attachments
    ✓ #2771 allDocs() 1, single attachment (38ms)
    ✓ #2771 allDocs() 2, many docs same att
    ✓ #2771 allDocs() 3, many docs diff atts
    ✓ #2771 allDocs() 4, mix of atts and no atts
    ✓ #2771 allDocs() 5, no atts
    ✓ #2771 allDocs() 6, no docs
    ✓ #2771 allDocs() 7, revisions and deletions
    ✓ #2771 allDocs() 8, empty attachment
    ✓ No length for non-stubs
    ✓ Test some attachments (73ms)
    ✓ Test getAttachment
    ✓ Test getAttachment with stubs
    ✓ Test get() with binary:true and stubs
    ✓ Test attachments in allDocs/changes
    ✓ Test putAttachment with base64 plaintext
    ✓ Test putAttachment with invalid base64
    ✓ Test getAttachment with empty text
    ✓ Test getAttachment with normal text
    ✓ Test getAttachment with PNG
    ✓ Test getAttachment with PNG using bulkDocs (50ms)
    ✓ Test getAttachment with PNG using post
    ✓ Test postAttachment with PNG then bulkDocs
    ✓ proper stub behavior
    ✓ Testing with invalid docs
    ✓ Test create attachment and doc in one go
    ✓ Test create attachment and doc in one go without callback
    ✓ Test create attachment without callback (40ms)
    ✓ Test put attachment on a doc without attachments
    ✓ Test put attachment with unencoded name
    ✓ 3963 length property on stubs (46ms)
    ✓ Testing with invalid rev
    ✓ Test put another attachment on a doc with attachments (49ms)
    ✓ Test get with attachments: true if empty attachments
    ✓ Test delete attachment from a doc (43ms)
    ✓ Test a document with a json string attachment
    ✓ Test remove doc with attachment
    ✓ Try to insert a doc with unencoded attachment
    ✓ Try to get attachment of unexistent doc
    ✓ Test synchronous putAttachment with text data
    ✓ Test synchronous putAttachment with no text data
    ✓ Test put with partial stubs
    ✓ Test put with attachments and new_edits=false
    ✓ Test getAttachment with specific rev (40ms)
    ✓ Test getAttachment with diff revs and content
    ✓ Test stubs
    ✓ Try to get unexistent attachment of some doc
    ✓ putAttachment and getAttachment with plaintext
    ✓ putAttachment and getAttachment with png data
    ✓ putAttachment in new doc with base64
    ✓ #2818 - save same attachment in different revs (47ms)
    ✓ #2818 - save same attachment many times in parallel
    ✓ #2818 - revisions keep attachments (no compaction) (38ms)
    ✓ #2818 - doesn't throw 409 if same filename
    ✓ #3008 test correct encoding/decoding of \u0000 etc.
    ✓ putAttachment and getAttachment with big png data (127ms)
    ✓ #2709 `revpos` with putAttachment (39ms)
    ✓ #2709 `revpos` with inline attachment
    ✓ #2709 `revpos` with allDocs
    ✓ #7403 {attachments: true, binary: true, include_docs: true} in allDocs with one missing doc

  suite2 test.attachments.js- local:http
    ✓ Attachments replicate back and forth (117ms)
    ✓ Replicate same doc, same atts (112ms)
    ✓ Replicate same doc, same atts 2 (107ms)
    ✓ Attachments replicate (64ms)
    ✓ Attachment types replicate (53ms)
    ✓ Many many attachments replicate (280ms)
    ✓ Many many png attachments replicate (198ms)
    ✓ Multiple attachments replicate (79ms)
    - #3961 Many attachments on same doc
    ✓ Multiple attachments replicate, different docs (#2698) (82ms)
    ✓ Multiple attachments replicate, different docs png (#2698) (72ms)
    ✓ #3932 attachments with tricky revpos (142ms)
    ✓ replication with changing attachments (94ms)
    ✓ 3955 race condition in put
    ✓ #8456 bad attachment rev after replication (119ms)

  suite2 test.attachments.js- http:http
    ✓ Attachments replicate back and forth (161ms)
    ✓ Replicate same doc, same atts (177ms)
    ✓ Replicate same doc, same atts 2 (173ms)
    ✓ Attachments replicate (76ms)
    ✓ Attachment types replicate (95ms)
    ✓ Many many attachments replicate (454ms)
    ✓ Many many png attachments replicate (288ms)
    ✓ Multiple attachments replicate (122ms)
    - #3961 Many attachments on same doc
    ✓ Multiple attachments replicate, different docs (#2698) (125ms)
    ✓ Multiple attachments replicate, different docs png (#2698) (124ms)
    ✓ #3932 attachments with tricky revpos (224ms)
    ✓ replication with changing attachments (229ms)
    ✓ 3955 race condition in put
    ✓ #8456 bad attachment rev after replication (173ms)

  suite2 test.attachments.js- http:local
    ✓ Attachments replicate back and forth (101ms)
    ✓ Replicate same doc, same atts (96ms)
    ✓ Replicate same doc, same atts 2 (167ms)
    ✓ Attachments replicate (63ms)
    ✓ Attachment types replicate (55ms)
    ✓ Many many attachments replicate (138ms)
    ✓ Many many png attachments replicate (183ms)
    ✓ Multiple attachments replicate (82ms)
    - #3961 Many attachments on same doc
    ✓ Multiple attachments replicate, different docs (#2698) (71ms)
    ✓ Multiple attachments replicate, different docs png (#2698) (104ms)
    ✓ #3932 attachments with tricky revpos (155ms)
    ✓ replication with changing attachments (100ms)
    ✓ 3955 race condition in put
    ✓ #8456 bad attachment rev after replication (115ms)

  suite2 test.attachments.js- local:local
    ✓ Attachments replicate back and forth
    ✓ Replicate same doc, same atts
    ✓ Replicate same doc, same atts 2
    ✓ Attachments replicate
    ✓ Attachment types replicate
    ✓ Many many attachments replicate
    ✓ Many many png attachments replicate
    ✓ Multiple attachments replicate (40ms)
    - #3961 Many attachments on same doc
    ✓ Multiple attachments replicate, different docs (#2698)
    ✓ Multiple attachments replicate, different docs png (#2698)
    ✓ #3932 attachments with tricky revpos
    ✓ replication with changing attachments (64ms)
    ✓ 3955 race condition in put
    ✓ #8456 bad attachment rev after replication

  test.basics.js-http
    ✓ Create a pouch without new keyword
    ✓ Name is accessible via instance
    ✓ 4314 Create a pouch with + in name
    ✓ Creating Pouch without name will throw
    ✓ 4314 Create a pouch with urlencoded name
    ✓ 4219 destroy a pouch
    ✓ 4339 throw useful error if method called on stale instance
    ✓ [4595] should reject xhr errors
    ✓ [4595] should emit error event on xhr error
    ✓ Add a doc
    ✓ Get invalid id
    ✓ Missing doc should contain ID in error object
    ✓ PUTed Conflicted doc should contain ID in error object
    ✓ POSTed Conflicted doc should contain ID in error object
    ✓ Add a doc with a promise
    ✓ Add a doc with opts object
    ✓ Modify a doc
    ✓ Modifying a doc that has rewritten content
    ✓ Modify a doc with a promise
    ✓ Read db id
    ✓ Read db id with promise
    ✓ Close db
    ✓ Close db with a promise
    ✓ Read db id after closing Close
    ✓ Modify a doc with incorrect rev
    ✓ Remove doc
    ✓ Remove doc with a promise
    ✓ Remove doc with new syntax
    ✓ Remove doc with new syntax and a promise
    ✓ Doc removal leaves only stub
    ✓ Remove doc twice with specified id (39ms)
    ✓ Remove doc, no callback
    ✓ Delete document without id
    ✓ Delete document with many args
    ✓ Delete document with many args, callback style
    ✓ Delete doc with id + rev + no opts
    ✓ Delete doc with id + rev + no opts, callback style
    ✓ Delete doc with doc + opts
    ✓ Delete doc with doc + opts, callback style
    ✓ Delete doc with rev in opts
    ✓ Bulk docs
    ✓ Bulk docs with a promise
    ✓ Basic checks
    ✓ update with invalid rev
    ✓ Doc validation
    ✓ Replication fields (#2442)
    ✓ Testing issue #48 (55ms)
    ✓ Testing valid id
    ✓ Put doc without _id should fail
    ✓ Put doc with bad reserved id should fail
    ✓ update_seq persists
    ✓ deletions persists
    ✓ #4126 should not store raw Dates
    ✓ Create a db with a reserved name
    ✓ Error when document is not an object
    ✓ Test instance update_seq updates correctly
    ✓ Fail to fetch a doc after db was deleted (48ms)
    ✓ Fail to fetch a doc after db was deleted (60ms)
    ✓ Cant add docs with empty ids
    ✓ Test doc with percent in ID
    ✓ db.info should give auto_compaction = false (#2744)
    ✓ db.info should give auto_compaction = true (#2744)
    ✓ db.info should give adapter name (#3567)
    ✓ db.info should give correct doc_count
    ✓ putting returns {ok: true}
    ✓ putting is override-able
    ✓ issue 2779, deleted docs, old revs COUCHDB-292
    ✓ issue 2888, successive deletes and writes
    ✓ 2 invalid puts
    ✓ Docs save "null" value
    ✓ replace PouchDB.destroy() (express-pouchdb#203)
    ✓ 3968, keeps all object fields
    ✓ 4712 invalid rev for new doc generates conflict
    ✓ test info() after db close
    ✓ test get() after db close
    ✓ test close() after db close
    ✓ 7259 should have "this" keyword properly scoped
    ✓ #5471 PouchDB.plugin() should throw error if passed wrong type or empty object

  test.basics.js-local
    ✓ Create a pouch without new keyword
    ✓ Name is accessible via instance
    ✓ 4314 Create a pouch with + in name
    ✓ Creating Pouch without name will throw
    ✓ 4314 Create a pouch with urlencoded name
    ✓ 4219 destroy a pouch
    ✓ 4339 throw useful error if method called on stale instance
    ✓ [4595] should reject xhr errors
    ✓ [4595] should emit error event on xhr error
    ✓ Add a doc
    ✓ Get invalid id
    ✓ Missing doc should contain ID in error object
    ✓ PUTed Conflicted doc should contain ID in error object
    ✓ POSTed Conflicted doc should contain ID in error object
    ✓ Add a doc with a promise
    ✓ Add a doc with opts object
    ✓ Modify a doc
    ✓ Modifying a doc that has rewritten content
    ✓ Modify a doc with a promise
    ✓ Read db id
    ✓ Read db id with promise
    ✓ Close db
    ✓ Close db with a promise
    ✓ Read db id after closing Close
    ✓ Modify a doc with incorrect rev
    ✓ Remove doc
    ✓ Remove doc with a promise
    ✓ Remove doc with new syntax
    ✓ Remove doc with new syntax and a promise
    ✓ Doc removal leaves only stub
    ✓ Remove doc twice with specified id
    ✓ Remove doc, no callback
    ✓ Delete document without id
    ✓ Delete document with many args
    ✓ Delete document with many args, callback style
    ✓ Delete doc with id + rev + no opts
    ✓ Delete doc with id + rev + no opts, callback style
    ✓ Delete doc with doc + opts
    ✓ Delete doc with doc + opts, callback style
    ✓ Delete doc with rev in opts
    ✓ Bulk docs
    ✓ Bulk docs with a promise
    ✓ Basic checks
    ✓ update with invalid rev
    ✓ Doc validation
    ✓ Replication fields (#2442)
    ✓ Allows _access field in documents (#8171)
    ✓ Testing issue #48 (53ms)
    ✓ Testing valid id
    ✓ Put doc without _id should fail
    ✓ Put doc with bad reserved id should fail
    ✓ update_seq persists
    ✓ deletions persists
    ✓ #4126 should not store raw Dates
    ✓ Create a db with a reserved name
    ✓ Error when document is not an object
    ✓ Test instance update_seq updates correctly
    ✓ Fail to fetch a doc after db was deleted
    ✓ Fail to fetch a doc after db was deleted
    ✓ Cant add docs with empty ids
    ✓ Test doc with percent in ID
    ✓ db.info should give auto_compaction = false (#2744)
    ✓ db.info should give auto_compaction = true (#2744)
    ✓ db.info should give adapter name (#3567)
    ✓ db.info should give correct doc_count
    ✓ putting returns {ok: true}
    ✓ putting is override-able
    ✓ issue 2779, deleted docs, old revs COUCHDB-292
    ✓ issue 2888, successive deletes and writes
    ✓ 2 invalid puts
    ✓ Docs save "null" value
    ✓ replace PouchDB.destroy() (express-pouchdb#203)
    ✓ 3968, keeps all object fields
    ✓ 4712 invalid rev for new doc generates conflict
    ✓ test info() after db close
    ✓ test get() after db close
    ✓ test close() after db close
    ✓ 7259 should have "this" keyword properly scoped
    ✓ should allow unicode doc ids
    ✓ should have same blob support for 2 dbs
    ✓ 6053, PouchDB.plugin() resets defaults
    ✓ #5471 PouchDB.plugin() should throw error if passed wrong type or empty object

  test.bulk_docs.js-local
    ✓ Testing bulk docs
    ✓ #6039 test id in bulk docs for conflict
    ✓ No id in bulk docs
    ✓ No _rev and new_edits=false
    ✓ 7829 bare rev 1- with new_edits=false
    ✓ Test empty bulkDocs
    ✓ Test many bulkDocs
    ✓ Test errors on invalid doc id
    ✓ Test two errors on invalid doc id
    ✓ No docs
    ✓ Jira 911
    ✓ Test multiple bulkdocs
    ✓ #2935 new_edits=false correct number
    ✓ #2935 new_edits=false correct number 2
    ✓ bulk docs update then delete then conflict
    ✓ bulk_docs delete then undelete
    ✓ #2935 new_edits=false with single unauthorized
    ✓ Deleting _local docs with bulkDocs
    ✓ Deleting _local docs with bulkDocs, not found
    ✓ Deleting _local docs with bulkDocs, wrong rev
    ✓ Bulk with new_edits=false
    ✓ Testing successive new_edits to the same doc
    ✓ #3062 bulkDocs with staggered seqs
    ✓ Testing successive new_edits to the same doc, different content
    ✓ Testing successive new_edits to two doc
    ✓ Deletion with new_edits=false
    ✓ Deletion with new_edits=false, no history
    ✓ Modification with new_edits=false, no history
    ✓ Deletion with new_edits=false, no history, no revisions
    ✓ Testing new_edits=false in req body
    ✓ 656 regression in handling deleted docs
    ✓ Test quotes in doc ids
    ✓ Bulk docs empty list
    ✓ handles simultaneous writes
    ✓ bulk docs input by array
    ✓ Bulk empty list
    ✓ Bulk docs not an array
    ✓ Bulk docs not an object
    ✓ Bulk docs two different revisions to same document id
    ✓ 4204 respect revs_limit (264ms)
    ✓ 2839 implement revs_limit (181ms)
    ✓ 4372 revs_limit deletes old revisions of the doc
    ✓ 4372 revs_limit with auto_compaction deletes old revisions of the doc
    ✓ 4712 invalid rev for new doc generates conflict
    ✓ 5793 bulk docs accepts _conflicts when new_edits=false

  test.bulk_docs.js-http
    ✓ Testing bulk docs
    ✓ #6039 test id in bulk docs for conflict
    ✓ No id in bulk docs
    ✓ No _rev and new_edits=false
    ✓ 7829 bare rev 1- with new_edits=false
    ✓ Test empty bulkDocs
    ✓ Test many bulkDocs
    ✓ Test errors on invalid doc id
    ✓ Test two errors on invalid doc id
    ✓ No docs
    ✓ Jira 911
    ✓ Test multiple bulkdocs
    ✓ #2935 new_edits=false correct number
    ✓ #2935 new_edits=false correct number 2
    ✓ bulk docs update then delete then conflict
    ✓ bulk_docs delete then undelete
    ✓ #2935 new_edits=false with single unauthorized
    ✓ Deleting _local docs with bulkDocs
    ✓ Bulk with new_edits=false
    ✓ Testing successive new_edits to the same doc
    ✓ #3062 bulkDocs with staggered seqs
    ✓ Testing successive new_edits to the same doc, different content (38ms)
    ✓ Testing successive new_edits to two doc
    ✓ Deletion with new_edits=false
    ✓ Deletion with new_edits=false, no history
    ✓ Modification with new_edits=false, no history
    ✓ Deletion with new_edits=false, no history, no revisions
    ✓ Testing new_edits=false in req body
    ✓ 656 regression in handling deleted docs
    ✓ Test quotes in doc ids
    ✓ Bulk docs empty list
    ✓ handles simultaneous writes
    ✓ bulk docs input by array
    ✓ Bulk empty list
    ✓ Bulk docs not an array
    ✓ Bulk docs not an object
    ✓ Bulk docs two different revisions to same document id
    ✓ 4204 respect revs_limit (308ms)
    ✓ 2839 implement revs_limit
    ✓ 4372 revs_limit deletes old revisions of the doc
    ✓ 4372 revs_limit with auto_compaction deletes old revisions of the doc
    ✓ 4712 invalid rev for new doc generates conflict
    ✓ 5793 bulk docs accepts _conflicts when new_edits=false (50ms)

  test.bulk_get.js-http
    ✓ test bulk get with rev specified
    ✓ test bulk get with latest=true
    ✓ test bulk get with no rev specified
    ✓ _revisions is not returned by default
    ✓ #5886 bulkGet with reserved id
    ✓ _revisions is returned when specified
    ✓ _revisions is returned when specified, using implicit rev
    ✓ attachments are not included by default
    ✓ attachments are included when specified
    ✓ attachments are included when specified, using implicit rev

  test.bulk_get.js-local
    ✓ test bulk get with rev specified
    ✓ test bulk get with latest=true
    ✓ test bulk get with no rev specified
    ✓ _revisions is not returned by default
    ✓ #5886 bulkGet with reserved id
    ✓ _revisions is returned when specified
    ✓ _revisions is returned when specified, using implicit rev
    ✓ attachments are not included by default
    ✓ attachments are included when specified
    ✓ attachments are included when specified, using implicit rev

  test.changes.js-http
    ✓ All changes
    ✓ Changes with complete callback as param
    ✓ Promise resolved when changes cancelled
    - Live changes should clean listener when cancelled
    ✓ Changes Since
    ✓ Changes Since and limit limit 1
    ✓ Changes Since and limit limit 0
    ✓ Changes limit
    ✓ Changes with filter not present in ddoc
    ✓ Changes with `filters` key not present in ddoc
    ✓ Changes limit and filter
    ✓ Changes with shorthand function name
    ✓ Changes with filter from nonexistent ddoc
    ✓ Changes with view not present in ddoc
    ✓ Changes with `views` key not present in ddoc
    ✓ #4451 Changes with invalid view filter
    ✓ 3356 throw inside a filter
    ✓ Changes with missing param `view` in request
    ✓ Changes limit and view instead of filter
    ✓ #3609 view option implies filter: _view
    ✓ Immediately cancel changes
    ✓ Changes with invalid ddoc view name
    ✓ Changes with invalid ddoc view name 2
    ✓ Changes with style = all_docs (62ms)
    ✓ Changes with style = all_docs and a callback for complete (56ms)
    ✓ Changes limit = 0
    ✓ Changes doc
    - Descending many changes
    ✓ live-changes
    ✓ Multiple watchers
    ✓ Continuous changes doc
    ✓ Cancel changes (320ms)
    ✓ #3579 changes firing 1 too many times (75ms)
    ✓ Kill database while listening to live changes
    ✓ #3136 style=all_docs
    ✓ #4191 revs_diff causes endless loop
    ✓ #3136 style=all_docs & include_docs
    ✓ changes-filter with query params
    ✓ Non-live changes filter
    ✓ Non-live changes filter, descending
    ✓ #2569 Non-live doc_ids filter
    ✓ #2569 Big non-live doc_ids filter
    ✓ #2569 Live doc_ids filter
    ✓ #2569 Big live doc_ids filter
    ✓ #2569 Non-live doc_ids filter with filter=_doc_ids
    ✓ #2569 Live doc_ids filter with filter=_doc_ids
    ✓ Changes to same doc are grouped (38ms)
    ✓ Changes with conflicts are handled correctly (128ms)
    ✓ Change entry for a deleted doc
    ✓ changes large number of docs (45ms)
    ✓ Calling db.changes({since: 'now'})
    ✓ Calling db.changes({since: 'latest'})
    ✓ Closing db does not cause a crash if changes cancelled
    ✓ fire-complete-on-cancel (101ms)
    ✓ changes are not duplicated (1025ms)
    ✓ supports return_docs=false
    ✓ should respects limit (70ms)
    ✓ doesn't throw if opts.complete is undefined
    ✓ handle individual changes in live replication (194ms)
    ✓ changes-filter without filter
    ✓ #3539 - Exception in changes is fine
    ✓ Changes with selector
    ✓ Changes with selector, explicit filter
    ✓ Changes with selector and mismatched filter
    ✓ Changes with limit and selector

  test.changes.js-local
    ✓ All changes
    ✓ Changes with complete callback as param
    ✓ Promise resolved when changes cancelled
    - Live changes should clean listener when cancelled
    ✓ Changes Since
    ✓ Changes Since and limit limit 1
    ✓ Changes Since and limit limit 0
    ✓ Changes limit
    ✓ Changes with filter not present in ddoc
    ✓ Changes with `filters` key not present in ddoc
    ✓ Changes limit and filter
    ✓ Changes with shorthand function name
    ✓ Changes with filter from nonexistent ddoc
    ✓ Changes with view not present in ddoc
    ✓ Changes with `views` key not present in ddoc
    ✓ #4451 Changes with invalid view filter
    ✓ 3356 throw inside a filter
    ✓ Changes with missing param `view` in request
    ✓ Changes limit and view instead of filter
    ✓ #3609 view option implies filter: _view
    ✓ Immediately cancel changes
    ✓ Changes with invalid ddoc view name
    ✓ Changes with invalid ddoc view name 2
    ✓ Changes with style = all_docs
    ✓ Changes with style = all_docs and a callback for complete
    ✓ Changes limit = 0
    ✓ Changes doc
    - Descending many changes
    ✓ live-changes
    ✓ Multiple watchers
    ✓ Continuous changes doc
    ✓ Cancel changes (314ms)
    ✓ #3579 changes firing 1 too many times (93ms)
    ✓ Kill database while listening to live changes
    ✓ #3136 style=all_docs
    ✓ #4191 revs_diff causes endless loop
    ✓ #3136 style=all_docs & include_docs
    ✓ changes-filter with query params
    ✓ Non-live changes filter
    ✓ Non-live changes filter, descending
    ✓ #2569 Non-live doc_ids filter
    ✓ #2569 Big non-live doc_ids filter
    ✓ #2569 Live doc_ids filter
    ✓ #2569 Big live doc_ids filter
    ✓ #2569 Non-live doc_ids filter with filter=_doc_ids
    ✓ #2569 Live doc_ids filter with filter=_doc_ids
    ✓ Changes to same doc are grouped
    ✓ Changes with conflicts are handled correctly
    ✓ Change entry for a deleted doc
    ✓ changes large number of docs
    ✓ Calling db.changes({since: 'now'})
    ✓ Calling db.changes({since: 'latest'})
    ✓ Closing db does not cause a crash if changes cancelled
    ✓ fire-complete-on-cancel (102ms)
    ✓ changes are not duplicated (1017ms)
    ✓ supports return_docs=false
    ✓ should respects limit (65ms)
    ✓ doesn't throw if opts.complete is undefined
    ✓ handle individual changes in live replication (71ms)
    ✓ changes-filter without filter
    ✓ #3539 - Exception in changes is fine
    ✓ Changes with selector
    ✓ Changes with selector, explicit filter
    ✓ Changes with selector and mismatched filter
    ✓ Changes with limit and selector

  changes-standalone
    - Changes reports errors

  test.close.js-local
    ✓ should emit destroyed even when closed (sync)
    ✓ should emit destroyed even when closed (async)
precondition_failed: Database not open
    at Object.<anonymous> (/data/js-variants/multee/Clients/levelup/pouchdb/packages/node_modules/pouchdb/lib/index.js:614:16)
    at Module._compile (node:internal/modules/cjs/loader:1105:14)
    at Module._extensions..js (node:internal/modules/cjs/loader:1159:10)
    at Module.load (node:internal/modules/cjs/loader:981:32)
    at Module._load (node:internal/modules/cjs/loader:827:12)
    at Module.require (node:internal/modules/cjs/loader:1005:19)
    at require (node:internal/modules/cjs/helpers:102:18)
    at commonUtils.loadPouchDBForNode (/data/js-variants/multee/Clients/levelup/pouchdb/tests/common-utils.js:92:17)
    at commonUtils.loadPouchDB (/data/js-variants/multee/Clients/levelup/pouchdb/tests/common-utils.js:78:39)
    at Object.<anonymous> (/data/js-variants/multee/Clients/levelup/pouchdb/tests/integration/node.setup.js:21:28)
    at Module._compile (node:internal/modules/cjs/loader:1105:14)
    at Module._extensions..js (node:internal/modules/cjs/loader:1159:10)
    at Module.load (node:internal/modules/cjs/loader:981:32)
    at Module._load (node:internal/modules/cjs/loader:827:12)
    at Module.require (node:internal/modules/cjs/loader:1005:19)
    at require (node:internal/modules/cjs/helpers:102:18)
    at /data/js-variants/multee/Clients/levelup/pouchdb/node_modules/mocha/bin/_mocha:366:3
    at Array.forEach (<anonymous>)
    at Object.<anonymous> (/data/js-variants/multee/Clients/levelup/pouchdb/node_modules/mocha/bin/_mocha:365:10)
    at Module._compile (node:internal/modules/cjs/loader:1105:14)
    at Module._extensions..js (node:internal/modules/cjs/loader:1159:10)
    at Module.load (node:internal/modules/cjs/loader:981:32)
    at Module._load (node:internal/modules/cjs/loader:827:12)
    at Function.executeUserEntryPoint [as runMain] (node:internal/modules/run_main:77:12)
    at node:internal/main/run_main_module:17:47
    ✓ should emit closed even when destroyed (async #2)
precondition_failed: Database not open
    at Object.<anonymous> (/data/js-variants/multee/Clients/levelup/pouchdb/packages/node_modules/pouchdb/lib/index.js:614:16)
    at Module._compile (node:internal/modules/cjs/loader:1105:14)
    at Module._extensions..js (node:internal/modules/cjs/loader:1159:10)
    at Module.load (node:internal/modules/cjs/loader:981:32)
    at Module._load (node:internal/modules/cjs/loader:827:12)
    at Module.require (node:internal/modules/cjs/loader:1005:19)
    at require (node:internal/modules/cjs/helpers:102:18)
    at commonUtils.loadPouchDBForNode (/data/js-variants/multee/Clients/levelup/pouchdb/tests/common-utils.js:92:17)
    at commonUtils.loadPouchDB (/data/js-variants/multee/Clients/levelup/pouchdb/tests/common-utils.js:78:39)
    at Object.<anonymous> (/data/js-variants/multee/Clients/levelup/pouchdb/tests/integration/node.setup.js:21:28)
    at Module._compile (node:internal/modules/cjs/loader:1105:14)
    at Module._extensions..js (node:internal/modules/cjs/loader:1159:10)
    at Module.load (node:internal/modules/cjs/loader:981:32)
    at Module._load (node:internal/modules/cjs/loader:827:12)
    at Module.require (node:internal/modules/cjs/loader:1005:19)
    at require (node:internal/modules/cjs/helpers:102:18)
    at /data/js-variants/multee/Clients/levelup/pouchdb/node_modules/mocha/bin/_mocha:366:3
    at Array.forEach (<anonymous>)
    at Object.<anonymous> (/data/js-variants/multee/Clients/levelup/pouchdb/node_modules/mocha/bin/_mocha:365:10)
    at Module._compile (node:internal/modules/cjs/loader:1105:14)
    at Module._extensions..js (node:internal/modules/cjs/loader:1159:10)
    at Module.load (node:internal/modules/cjs/loader:981:32)
    at Module._load (node:internal/modules/cjs/loader:827:12)
    at Function.executeUserEntryPoint [as runMain] (node:internal/modules/run_main:77:12)
    at node:internal/main/run_main_module:17:47
    ✓ test unref for coverage
    ✓ test double unref for coverage
precondition_failed: Database not open
    at Object.<anonymous> (/data/js-variants/multee/Clients/levelup/pouchdb/packages/node_modules/pouchdb/lib/index.js:614:16)
    at Module._compile (node:internal/modules/cjs/loader:1105:14)
    at Module._extensions..js (node:internal/modules/cjs/loader:1159:10)
    at Module.load (node:internal/modules/cjs/loader:981:32)
    at Module._load (node:internal/modules/cjs/loader:827:12)
    at Module.require (node:internal/modules/cjs/loader:1005:19)
    at require (node:internal/modules/cjs/helpers:102:18)
    at commonUtils.loadPouchDBForNode (/data/js-variants/multee/Clients/levelup/pouchdb/tests/common-utils.js:92:17)
    at commonUtils.loadPouchDB (/data/js-variants/multee/Clients/levelup/pouchdb/tests/common-utils.js:78:39)
    at Object.<anonymous> (/data/js-variants/multee/Clients/levelup/pouchdb/tests/integration/node.setup.js:21:28)
    at Module._compile (node:internal/modules/cjs/loader:1105:14)
    at Module._extensions..js (node:internal/modules/cjs/loader:1159:10)
    at Module.load (node:internal/modules/cjs/loader:981:32)
    at Module._load (node:internal/modules/cjs/loader:827:12)
    at Module.require (node:internal/modules/cjs/loader:1005:19)
    at require (node:internal/modules/cjs/helpers:102:18)
    at /data/js-variants/multee/Clients/levelup/pouchdb/node_modules/mocha/bin/_mocha:366:3
    at Array.forEach (<anonymous>)
    at Object.<anonymous> (/data/js-variants/multee/Clients/levelup/pouchdb/node_modules/mocha/bin/_mocha:365:10)
    at Module._compile (node:internal/modules/cjs/loader:1105:14)
    at Module._extensions..js (node:internal/modules/cjs/loader:1159:10)
    at Module.load (node:internal/modules/cjs/loader:981:32)
    at Module._load (node:internal/modules/cjs/loader:827:12)
    at Function.executeUserEntryPoint [as runMain] (node:internal/modules/run_main:77:12)
    at node:internal/main/run_main_module:17:47
    ✓ test close-then-destroyed for coverage
************* run test done *************
pouchdb is testing ./Variants/levelup/variant6/levelup
/data/js-variants/multee
************* npm unlink module *************

removed 1 package, changed 1 package, and audited 1032 packages in 3s

64 packages are looking for funding
  run `npm fund` for details

41 vulnerabilities (1 low, 9 moderate, 25 high, 6 critical)

To address issues that do not require attention, run:
  npm audit fix

To address all issues possible (including breaking changes), run:
  npm audit fix --force

Some issues need review, and may require choosing
a different dependency.

Run `npm audit` for details.
************* npm unlink module done *************
************* npm unlink globally *************

removed 1 package, and audited 1 package in 1s

found 0 vulnerabilities
************* npm unlink globally done *************
************* npm link globally *************

added 1 package, and audited 3 packages in 404ms

found 0 vulnerabilities
************* npm link globally done *************
************* npm link module *************

added 1 package, changed 1 package, and audited 1034 packages in 4s

64 packages are looking for funding
  run `npm fund` for details

41 vulnerabilities (1 low, 9 moderate, 25 high, 6 critical)

To address issues that do not require attention, run:
  npm audit fix

To address all issues possible (including breaking changes), run:
  npm audit fix --force

Some issues need review, and may require choosing
a different dependency.

Run `npm audit` for details.
************* npm link module done *************
************* start run test *************

> pouchdb-monorepo@7.0.0-prerelease test
> bash bin/run-test.sh


> pouchdb-monorepo@7.0.0-prerelease build-node
> bash bin/build-node.sh


> pouchdb-monorepo@7.0.0-prerelease build-modules
> node bin/build-modules.js

Building pouchdb...
Building pouchdb-abstract-mapreduce...
Building pouchdb-adapter-http...
Building pouchdb-adapter-idb...
Building pouchdb-adapter-indexeddb...
Building pouchdb-adapter-leveldb...
Building pouchdb-adapter-leveldb-core...
Building pouchdb-adapter-localstorage...
Building pouchdb-adapter-memory...
Building pouchdb-adapter-utils...
Building pouchdb-binary-utils...
Building pouchdb-browser...
Building pouchdb-changes-filter...
Building pouchdb-checkpointer...
Building pouchdb-collate...
Building pouchdb-collections...
Building pouchdb-core...
Building pouchdb-errors...
Building pouchdb-fetch...
Building pouchdb-find...
Building pouchdb-for-coverage...
Building pouchdb-generate-replication-id...
Building pouchdb-json...
Building pouchdb-mapreduce...
Building pouchdb-mapreduce-utils...
Building pouchdb-md5...
Building pouchdb-merge...
Building pouchdb-node...
Building pouchdb-replication...
Building pouchdb-selector-core...
Building pouchdb-utils...
Building sublevel-pouchdb...
  ✓ wrote pouchdb-adapter-localstorage/lib/index.js in vanilla mode
  ✓ wrote pouchdb-adapter-localstorage/lib/index.es.js in vanilla mode
  ✓ wrote pouchdb-adapter-memory/lib/index.js in vanilla mode
  ✓ wrote pouchdb-adapter-memory/lib/index.es.js in vanilla mode
  ✓ wrote pouchdb-checkpointer/lib/index.js in vanilla mode
  ✓ wrote pouchdb-checkpointer/lib/index.es.js in vanilla mode
  ✓ wrote pouchdb-errors/lib/index.js in vanilla mode
  ✓ wrote pouchdb-errors/lib/index.es.js in vanilla mode
  ✓ wrote pouchdb-generate-replication-id/lib/index.js in vanilla mode
  ✓ wrote pouchdb-generate-replication-id/lib/index.es.js in vanilla mode
  ✓ wrote pouchdb-adapter-http/lib/index.js in vanilla mode
  ✓ wrote pouchdb-adapter-http/lib/index.es.js in vanilla mode
  ✓ wrote pouchdb-adapter-leveldb-core/lib/index.js in node mode
  ✓ wrote pouchdb-adapter-leveldb-core/lib/index.es.js in node mode
  ✓ wrote pouchdb-adapter-leveldb-core/lib/index-browser.js in browser mode
  ✓ wrote pouchdb-adapter-leveldb-core/lib/index-browser.es.js in browser mode
  ✓ wrote pouchdb-adapter-leveldb/lib/index.js in node mode
  ✓ wrote pouchdb-adapter-leveldb/lib/index.es.js in node mode
  ✓ wrote pouchdb-adapter-leveldb/lib/index-browser.js in browser mode
  ✓ wrote pouchdb-adapter-leveldb/lib/index-browser.es.js in browser mode
  ✓ wrote pouchdb-changes-filter/lib/index-browser.js in browser mode
  ✓ wrote pouchdb-changes-filter/lib/index-browser.es.js in browser mode
  ✓ wrote pouchdb-fetch/lib/index-browser.js in browser mode
  ✓ wrote pouchdb-fetch/lib/index-browser.es.js in browser mode
  ✓ wrote pouchdb-md5/lib/index-browser.js in browser mode
  ✓ wrote pouchdb-md5/lib/index-browser.es.js in browser mode
  ✓ wrote pouchdb-changes-filter/lib/index.js in node mode
  ✓ wrote pouchdb-changes-filter/lib/index.es.js in node mode
  ✓ wrote pouchdb-collate/lib/index.js in vanilla mode
  ✓ wrote pouchdb-collate/lib/index.es.js in vanilla mode
  ✓ wrote pouchdb-fetch/lib/index.js in node mode
  ✓ wrote pouchdb-fetch/lib/index.es.js in node mode
  ✓ wrote pouchdb-json/lib/index.js in vanilla mode
  ✓ wrote pouchdb-json/lib/index.es.js in vanilla mode
  ✓ wrote pouchdb-mapreduce-utils/lib/index.js in vanilla mode
  ✓ wrote pouchdb-mapreduce-utils/lib/index.es.js in vanilla mode
  ✓ wrote pouchdb-md5/lib/index.js in node mode
  ✓ wrote pouchdb-md5/lib/index.es.js in node mode
  ✓ wrote pouchdb-abstract-mapreduce/lib/index.js in vanilla mode
  ✓ wrote pouchdb-abstract-mapreduce/lib/index.es.js in vanilla mode
  ✓ wrote pouchdb-adapter-indexeddb/lib/index.es.js in vanilla mode
  ✓ wrote pouchdb-adapter-indexeddb/lib/index.js in vanilla mode
  ✓ wrote pouchdb-binary-utils/lib/index-browser.js in browser mode
  ✓ wrote pouchdb-binary-utils/lib/index-browser.es.js in browser mode
  ✓ wrote pouchdb-utils/lib/index-browser.js in browser mode
  ✓ wrote pouchdb-utils/lib/index-browser.es.js in browser mode
  ✓ wrote pouchdb-utils/lib/index.js in node mode
  ✓ wrote pouchdb-utils/lib/index.es.js in node mode
  ✓ wrote pouchdb-adapter-idb/lib/index.js in vanilla mode
  ✓ wrote pouchdb-adapter-idb/lib/index.es.js in vanilla mode
  ✓ wrote pouchdb-binary-utils/lib/index.js in node mode
  ✓ wrote pouchdb-binary-utils/lib/index.es.js in node mode
  ✓ wrote pouchdb-adapter-utils/lib/index.js in vanilla mode
  ✓ wrote pouchdb-adapter-utils/lib/index.es.js in vanilla mode
  ✓ wrote pouchdb-collections/lib/index.js in vanilla mode
  ✓ wrote pouchdb-collections/lib/index.es.js in vanilla mode
  ✓ wrote pouchdb-merge/lib/index.js in vanilla mode
  ✓ wrote pouchdb-merge/lib/index.es.js in vanilla mode
  ✓ wrote pouchdb-selector-core/lib/index.js in vanilla mode
  ✓ wrote pouchdb-selector-core/lib/index.es.js in vanilla mode
  ✓ wrote sublevel-pouchdb/lib/index.js in vanilla mode
  ✓ wrote sublevel-pouchdb/lib/index.es.js in vanilla mode
  ✓ wrote pouchdb-mapreduce/lib/index-browser.js in browser mode
  ✓ wrote pouchdb-mapreduce/lib/index-browser.es.js in browser mode
  ✓ wrote pouchdb-mapreduce/lib/index.js in node mode
  ✓ wrote pouchdb-mapreduce/lib/index.es.js in node mode
  ✓ wrote pouchdb-replication/lib/index.js in vanilla mode
  ✓ wrote pouchdb-replication/lib/index.es.js in vanilla mode
  ✓ wrote pouchdb-core/lib/index.js in vanilla mode
  ✓ wrote pouchdb-core/lib/index.es.js in vanilla mode
  ✓ wrote pouchdb-find/lib/index.js in node mode
  ✓ wrote pouchdb-find/lib/index.es.js in node mode
  ✓ wrote pouchdb-find/lib/index-browser.js in browser mode
  ✓ wrote pouchdb-find/lib/index-browser.es.js in browser mode
  ✓ wrote pouchdb-browser/lib/index.js in vanilla mode
  ✓ wrote pouchdb-browser/lib/index.es.js in vanilla mode
  ✓ wrote pouchdb-node/lib/index.js in vanilla mode
  ✓ wrote pouchdb-node/lib/index.es.js in vanilla mode
  ✓ wrote pouchdb-for-coverage/lib/index.es.js in node mode
  ✓ wrote pouchdb-for-coverage/lib/index-browser.js in browser mode
  ✓ wrote pouchdb-for-coverage/lib/index-browser.es.js in browser mode
  ✓ wrote packages/node_modules/pouchdb/lib/index.js
  ✓ wrote packages/node_modules/pouchdb/lib/index.es.js
  ✓ wrote pouchdb-for-coverage/lib/index.js in node mode
Waiting for host to start ..
Host started :)
> pouchdb-monorepo@7.0.0-prerelease test-node
> bash bin/test-node.sh

Down server listening on port 3010
Seeded with: 1660143128111


  DB Setup
    ✓ PouchDB has a version
    ✓ PouchDB version matches package.json

  test.active_tasks.js
    ✓ Can add a task
    ✓ Can get tasks by id
    ✓ Can get all tasks
    ✓ Can update a task
    ✓ Can remove a task

  test.all_docs.js-http
    ✓ Testing all docs (203ms)
    ✓ Testing allDocs opts.keys (63ms)
    ✓ Testing allDocs opts.keys with skip
    ✓ Testing allDocs opts.keys with limit
    ✓ Testing allDocs invalid opts.keys
    ✓ Testing deleting in changes (45ms)
    ✓ Testing updating in changes (49ms)
    ✓ Testing include docs
    ✓ Testing conflicts (46ms)
    ✓ test basic collation
    ✓ 3883 start_key end_key aliases
    ✓ test total_rows with a variety of criteria (141ms)
    ✓ test total_rows with both skip and limit (38ms)
    ✓ test limit option and total_rows
    ✓ test escaped startkey/endkey
    ✓ test "key" option
    ✓ test inclusive_end=false (84ms)
    ✓ test descending with startkey/endkey (39ms)
    ✓ #3082 test wrong num results returned (261ms)
    ✓ test empty db
    ✓ test after db close
    ✓ 5793 _conflicts should not exist if no conflicts
    ✓ #6230 Test allDocs opts update_seq: false
    ✓ #6230 Test allDocs opts update_seq: true
    ✓ #6230 Test allDocs opts with update_seq missing

  test.all_docs.js-local
    ✓ Testing all docs
    ✓ Testing allDocs opts.keys
    ✓ Testing allDocs opts.keys with skip
    ✓ Testing allDocs opts.keys with limit
    ✓ Testing allDocs invalid opts.keys
    ✓ Testing deleting in changes
    ✓ Testing updating in changes
    ✓ Testing include docs
    ✓ Testing conflicts
    ✓ test basic collation
    ✓ 3883 start_key end_key aliases
    ✓ test total_rows with a variety of criteria
    ✓ test total_rows with both skip and limit
    ✓ test limit option and total_rows
    ✓ test escaped startkey/endkey
    ✓ test "key" option
    ✓ test inclusive_end=false
    ✓ test descending with startkey/endkey
    ✓ #3082 test wrong num results returned (186ms)
    ✓ test empty db
    ✓ test after db close
    ✓ test unicode ids and revs
    ✓ 5793 _conflicts should not exist if no conflicts
    ✓ #6230 Test allDocs opts update_seq: false
    ✓ #6230 Test allDocs opts update_seq: true
    ✓ #6230 Test allDocs opts with update_seq missing

  suite2 test.attachments.js-local
    ✓ 3357 Attachment names cant start with _
    ✓ 5736 warning for putAttachment without content_type
    ✓ 5736 warning for bulkDocs attachments without content_type
    ✓ fetch atts with open_revs and missing
    ✓ issue 2803 should throw 412
    ✓ issue 2803 should throw 412 part 2
    ✓ issue 2803 should throw 412 part 3
    ✓ issue 2803 should throw 412 part 4
    ✓ #2858 {binary: true} in get()
    ✓ #2858 {binary: true} in allDocs() 1
    ✓ #2858 {binary: true} in allDocs() 2
    ✓ #2858 {binary: true} in allDocs() 3
    ✓ #2858 {binary: true} in allDocs() 4
    ✓ #2858 {binary: true} in allDocs() 5
    ✓ #2858 {binary: true} in allDocs(), many atts
    ✓ #2858 {binary: true} in allDocs(), mixed atts
    ✓ #2858 {binary: true} in changes() non-live
    ✓ #2858 {binary: true} in changes() non-live, many atts
    ✓ #2858 {binary: true} in changes() non-live, mixed atts
    ✓ #2858 {binary: true} non-live changes, complete event
    ✓ #2858 {binary: true} in live changes
    ✓ #2858 {binary: true} in live changes, mixed atts
    ✓ #2858 {binary: true} in live+retry changes
    ✓ #2858 {binary: true} in live changes, attachments:false
    ✓ #2858 {binary: true} in live changes, include_docs:false
    ✓ #6736 {binary: true} in bulkGet()
    ✓ Measures length correctly after put()
    ✓ #3074 non-live changes()
    ✓ #3074 live changes()
    ✓ #3074 non-live changes(), no attachments
    ✓ #3074 live changes(), no attachments
    ✓ #3881 filter extraneous keys from _attachments
    ✓ #2771 allDocs() 1, single attachment
    ✓ #2771 allDocs() 2, many docs same att
    ✓ #2771 allDocs() 3, many docs diff atts
    ✓ #2771 allDocs() 4, mix of atts and no atts
    ✓ #2771 allDocs() 5, no atts
    ✓ #2771 allDocs() 6, no docs
    ✓ #2771 allDocs() 7, revisions and deletions
    ✓ #2771 allDocs() 8, empty attachment
    ✓ No length for non-stubs
    ✓ Test some attachments
    ✓ Test getAttachment
    ✓ Test getAttachment with stubs
    ✓ Test get() with binary:true and stubs
    ✓ Test attachments in allDocs/changes
    ✓ Test putAttachment with base64 plaintext
    ✓ Test putAttachment with invalid base64
    ✓ Test getAttachment with empty text
    ✓ Test getAttachment with normal text
    ✓ Test getAttachment with PNG
    ✓ Test getAttachment with PNG using bulkDocs
    ✓ Test getAttachment with PNG using post
    ✓ Test postAttachment with PNG then bulkDocs
    ✓ proper stub behavior
    ✓ Testing with invalid docs
    ✓ Test create attachment and doc in one go
    ✓ Test create attachment and doc in one go without callback
    ✓ Test create attachment without callback
    ✓ Test put attachment on a doc without attachments
    ✓ Test put attachment with unencoded name
    ✓ 3963 length property on stubs
    ✓ Testing with invalid rev
    ✓ Test put another attachment on a doc with attachments
    ✓ Test get with attachments: true if empty attachments
    ✓ Test delete attachment from a doc
    ✓ Test a document with a json string attachment
    ✓ Test remove doc with attachment
    ✓ Try to insert a doc with unencoded attachment
    ✓ Try to get attachment of unexistent doc
    ✓ Test synchronous putAttachment with text data
    ✓ Test synchronous putAttachment with no text data
    ✓ Test put with partial stubs
    ✓ Test put with attachments and new_edits=false
    ✓ Test getAttachment with specific rev
    ✓ Test getAttachment with diff revs and content
    ✓ Test stubs
    ✓ Try to get unexistent attachment of some doc
    ✓ putAttachment and getAttachment with plaintext
    ✓ putAttachment and getAttachment with png data
    ✓ putAttachment in new doc with base64
    ✓ #2818 - save same attachment in different revs
    ✓ #2818 - save same attachment many times in parallel
    ✓ #2818 - revisions keep attachments (no compaction)
    ✓ #2818 - doesn't throw 409 if same filename
    ✓ #3008 test correct encoding/decoding of \u0000 etc.
    ✓ putAttachment and getAttachment with big png data (89ms)
    ✓ #2709 `revpos` with putAttachment
    ✓ #2709 `revpos` with inline attachment
    ✓ #2709 `revpos` with allDocs
    ✓ #7403 {attachments: true, binary: true, include_docs: true} in allDocs with one missing doc

  suite2 test.attachments.js-http
    ✓ 3357 Attachment names cant start with _
    ✓ 5736 warning for putAttachment without content_type
    ✓ 5736 warning for bulkDocs attachments without content_type
    ✓ fetch atts with open_revs and missing
    ✓ issue 2803 should throw 412
    ✓ issue 2803 should throw 412 part 2
    ✓ issue 2803 should throw 412 part 3
    ✓ issue 2803 should throw 412 part 4
    ✓ #2858 {binary: true} in get() (40ms)
    ✓ #2858 {binary: true} in allDocs() 1
    ✓ #2858 {binary: true} in allDocs() 2
    ✓ #2858 {binary: true} in allDocs() 3
    ✓ #2858 {binary: true} in allDocs() 4
    ✓ #2858 {binary: true} in allDocs() 5
    ✓ #2858 {binary: true} in allDocs(), many atts
    ✓ #2858 {binary: true} in allDocs(), mixed atts
    ✓ #2858 {binary: true} in changes() non-live
    ✓ #2858 {binary: true} in changes() non-live, many atts (59ms)
    ✓ #2858 {binary: true} in changes() non-live, mixed atts
    ✓ #2858 {binary: true} non-live changes, complete event
    ✓ #2858 {binary: true} in live changes
    ✓ #2858 {binary: true} in live changes, mixed atts
    ✓ #2858 {binary: true} in live+retry changes
    ✓ #2858 {binary: true} in live changes, attachments:false
    ✓ #2858 {binary: true} in live changes, include_docs:false
    ✓ #6736 {binary: true} in bulkGet()
    ✓ Measures length correctly after put()
    ✓ #3074 non-live changes() (46ms)
    ✓ #3074 live changes() (43ms)
    ✓ #3074 non-live changes(), no attachments
    ✓ #3074 live changes(), no attachments
    ✓ #3881 filter extraneous keys from _attachments
    ✓ #2771 allDocs() 1, single attachment
    ✓ #2771 allDocs() 2, many docs same att
    ✓ #2771 allDocs() 3, many docs diff atts
    ✓ #2771 allDocs() 4, mix of atts and no atts
    ✓ #2771 allDocs() 5, no atts
    ✓ #2771 allDocs() 6, no docs
    ✓ #2771 allDocs() 7, revisions and deletions
    ✓ #2771 allDocs() 8, empty attachment
    ✓ No length for non-stubs
    ✓ Test some attachments (74ms)
    ✓ Test getAttachment
    ✓ Test getAttachment with stubs
    ✓ Test get() with binary:true and stubs
    ✓ Test attachments in allDocs/changes
    ✓ Test putAttachment with base64 plaintext
    ✓ Test putAttachment with invalid base64
    ✓ Test getAttachment with empty text
    ✓ Test getAttachment with normal text
    ✓ Test getAttachment with PNG
    ✓ Test getAttachment with PNG using bulkDocs
    ✓ Test getAttachment with PNG using post
    ✓ Test postAttachment with PNG then bulkDocs
    ✓ proper stub behavior
    ✓ Testing with invalid docs
    ✓ Test create attachment and doc in one go
    ✓ Test create attachment and doc in one go without callback
    ✓ Test create attachment without callback (39ms)
    ✓ Test put attachment on a doc without attachments
    ✓ Test put attachment with unencoded name
    ✓ 3963 length property on stubs (46ms)
    ✓ Testing with invalid rev
    ✓ Test put another attachment on a doc with attachments
    ✓ Test get with attachments: true if empty attachments
    ✓ Test delete attachment from a doc (43ms)
    ✓ Test a document with a json string attachment
    ✓ Test remove doc with attachment
    ✓ Try to insert a doc with unencoded attachment
    ✓ Try to get attachment of unexistent doc
    ✓ Test synchronous putAttachment with text data
    ✓ Test synchronous putAttachment with no text data
    ✓ Test put with partial stubs
    ✓ Test put with attachments and new_edits=false
    ✓ Test getAttachment with specific rev (38ms)
    ✓ Test getAttachment with diff revs and content
    ✓ Test stubs
    ✓ Try to get unexistent attachment of some doc
    ✓ putAttachment and getAttachment with plaintext
    ✓ putAttachment and getAttachment with png data
    ✓ putAttachment in new doc with base64
    ✓ #2818 - save same attachment in different revs (84ms)
    ✓ #2818 - save same attachment many times in parallel
    ✓ #2818 - revisions keep attachments (no compaction) (39ms)
    ✓ #2818 - doesn't throw 409 if same filename
    ✓ #3008 test correct encoding/decoding of \u0000 etc.
    ✓ putAttachment and getAttachment with big png data (125ms)
    ✓ #2709 `revpos` with putAttachment (43ms)
    ✓ #2709 `revpos` with inline attachment
    ✓ #2709 `revpos` with allDocs
    ✓ #7403 {attachments: true, binary: true, include_docs: true} in allDocs with one missing doc

  suite2 test.attachments.js- local:http
    ✓ Attachments replicate back and forth (117ms)
    ✓ Replicate same doc, same atts (109ms)
    ✓ Replicate same doc, same atts 2 (112ms)
    ✓ Attachments replicate (88ms)
    ✓ Attachment types replicate (57ms)
    ✓ Many many attachments replicate (183ms)
    ✓ Many many png attachments replicate (200ms)
    ✓ Multiple attachments replicate (94ms)
    - #3961 Many attachments on same doc
    ✓ Multiple attachments replicate, different docs (#2698) (82ms)
    ✓ Multiple attachments replicate, different docs png (#2698) (70ms)
    ✓ #3932 attachments with tricky revpos (138ms)
    ✓ replication with changing attachments (185ms)
    ✓ 3955 race condition in put
    ✓ #8456 bad attachment rev after replication (116ms)

  suite2 test.attachments.js- http:http
    ✓ Attachments replicate back and forth (158ms)
    ✓ Replicate same doc, same atts (171ms)
    ✓ Replicate same doc, same atts 2 (175ms)
    ✓ Attachments replicate (90ms)
    ✓ Attachment types replicate (91ms)
    ✓ Many many attachments replicate (356ms)
    ✓ Many many png attachments replicate (295ms)
    ✓ Multiple attachments replicate (121ms)
    - #3961 Many attachments on same doc
    ✓ Multiple attachments replicate, different docs (#2698) (137ms)
    ✓ Multiple attachments replicate, different docs png (#2698) (158ms)
    ✓ #3932 attachments with tricky revpos (220ms)
    ✓ replication with changing attachments (153ms)
    ✓ 3955 race condition in put
    ✓ #8456 bad attachment rev after replication (168ms)

  suite2 test.attachments.js- http:local
    ✓ Attachments replicate back and forth (104ms)
    ✓ Replicate same doc, same atts (104ms)
    ✓ Replicate same doc, same atts 2 (107ms)
    ✓ Attachments replicate (52ms)
    ✓ Attachment types replicate (54ms)
    ✓ Many many attachments replicate (137ms)
    ✓ Many many png attachments replicate (154ms)
    ✓ Multiple attachments replicate (83ms)
    - #3961 Many attachments on same doc
    ✓ Multiple attachments replicate, different docs (#2698) (73ms)
    ✓ Multiple attachments replicate, different docs png (#2698) (89ms)
    ✓ #3932 attachments with tricky revpos (236ms)
    ✓ replication with changing attachments (90ms)
    ✓ 3955 race condition in put
    ✓ #8456 bad attachment rev after replication (107ms)

  suite2 test.attachments.js- local:local
    ✓ Attachments replicate back and forth
    ✓ Replicate same doc, same atts
    ✓ Replicate same doc, same atts 2
    ✓ Attachments replicate
    ✓ Attachment types replicate
    ✓ Many many attachments replicate
    ✓ Many many png attachments replicate
    ✓ Multiple attachments replicate
    - #3961 Many attachments on same doc
    ✓ Multiple attachments replicate, different docs (#2698)
    ✓ Multiple attachments replicate, different docs png (#2698)
    ✓ #3932 attachments with tricky revpos (42ms)
    ✓ replication with changing attachments
    ✓ 3955 race condition in put
    ✓ #8456 bad attachment rev after replication

  test.basics.js-http
    ✓ Create a pouch without new keyword
    ✓ Name is accessible via instance
    ✓ 4314 Create a pouch with + in name
    ✓ Creating Pouch without name will throw
    ✓ 4314 Create a pouch with urlencoded name
    ✓ 4219 destroy a pouch
    ✓ 4339 throw useful error if method called on stale instance
    ✓ [4595] should reject xhr errors
    ✓ [4595] should emit error event on xhr error
    ✓ Add a doc
    ✓ Get invalid id
    ✓ Missing doc should contain ID in error object
    ✓ PUTed Conflicted doc should contain ID in error object
    ✓ POSTed Conflicted doc should contain ID in error object
    ✓ Add a doc with a promise
    ✓ Add a doc with opts object
    ✓ Modify a doc
    ✓ Modifying a doc that has rewritten content
    ✓ Modify a doc with a promise
    ✓ Read db id
    ✓ Read db id with promise
    ✓ Close db
    ✓ Close db with a promise
    ✓ Read db id after closing Close
    ✓ Modify a doc with incorrect rev
    ✓ Remove doc
    ✓ Remove doc with a promise
    ✓ Remove doc with new syntax
    ✓ Remove doc with new syntax and a promise
    ✓ Doc removal leaves only stub
    ✓ Remove doc twice with specified id
    ✓ Remove doc, no callback
    ✓ Delete document without id
    ✓ Delete document with many args
    ✓ Delete document with many args, callback style
    ✓ Delete doc with id + rev + no opts
    ✓ Delete doc with id + rev + no opts, callback style
    ✓ Delete doc with doc + opts (44ms)
    ✓ Delete doc with doc + opts, callback style
    ✓ Delete doc with rev in opts
    ✓ Bulk docs
    ✓ Bulk docs with a promise
    ✓ Basic checks
    ✓ update with invalid rev
    ✓ Doc validation
    ✓ Replication fields (#2442)
    ✓ Testing issue #48 (54ms)
    ✓ Testing valid id
    ✓ Put doc without _id should fail
    ✓ Put doc with bad reserved id should fail
    ✓ update_seq persists
    ✓ deletions persists
    ✓ #4126 should not store raw Dates
    ✓ Create a db with a reserved name
    ✓ Error when document is not an object
    ✓ Test instance update_seq updates correctly
    ✓ Fail to fetch a doc after db was deleted (51ms)
    ✓ Fail to fetch a doc after db was deleted (48ms)
    ✓ Cant add docs with empty ids
    ✓ Test doc with percent in ID
    ✓ db.info should give auto_compaction = false (#2744)
    ✓ db.info should give auto_compaction = true (#2744)
    ✓ db.info should give adapter name (#3567)
    ✓ db.info should give correct doc_count
    ✓ putting returns {ok: true}
    ✓ putting is override-able
    ✓ issue 2779, deleted docs, old revs COUCHDB-292
    ✓ issue 2888, successive deletes and writes
    ✓ 2 invalid puts
    ✓ Docs save "null" value
    ✓ replace PouchDB.destroy() (express-pouchdb#203)
    ✓ 3968, keeps all object fields
    ✓ 4712 invalid rev for new doc generates conflict
    ✓ test info() after db close
    ✓ test get() after db close
    ✓ test close() after db close
    ✓ 7259 should have "this" keyword properly scoped
    ✓ #5471 PouchDB.plugin() should throw error if passed wrong type or empty object

  test.basics.js-local
    ✓ Create a pouch without new keyword
    ✓ Name is accessible via instance
    ✓ 4314 Create a pouch with + in name
    ✓ Creating Pouch without name will throw
    ✓ 4314 Create a pouch with urlencoded name
    ✓ 4219 destroy a pouch
    ✓ 4339 throw useful error if method called on stale instance
    ✓ [4595] should reject xhr errors
    ✓ [4595] should emit error event on xhr error
    ✓ Add a doc
    ✓ Get invalid id
    ✓ Missing doc should contain ID in error object
    ✓ PUTed Conflicted doc should contain ID in error object
    ✓ POSTed Conflicted doc should contain ID in error object
    ✓ Add a doc with a promise
    ✓ Add a doc with opts object
    ✓ Modify a doc
    ✓ Modifying a doc that has rewritten content
    ✓ Modify a doc with a promise
    ✓ Read db id
    ✓ Read db id with promise
    ✓ Close db
    ✓ Close db with a promise
    ✓ Read db id after closing Close
    ✓ Modify a doc with incorrect rev
    ✓ Remove doc
    ✓ Remove doc with a promise
    ✓ Remove doc with new syntax
    ✓ Remove doc with new syntax and a promise
    ✓ Doc removal leaves only stub
    ✓ Remove doc twice with specified id
    ✓ Remove doc, no callback
    ✓ Delete document without id
    ✓ Delete document with many args
    ✓ Delete document with many args, callback style
    ✓ Delete doc with id + rev + no opts
    ✓ Delete doc with id + rev + no opts, callback style
    ✓ Delete doc with doc + opts
    ✓ Delete doc with doc + opts, callback style
    ✓ Delete doc with rev in opts
    ✓ Bulk docs
    ✓ Bulk docs with a promise
    ✓ Basic checks
    ✓ update with invalid rev
    ✓ Doc validation
    ✓ Replication fields (#2442)
    ✓ Allows _access field in documents (#8171)
    ✓ Testing issue #48 (52ms)
    ✓ Testing valid id
    ✓ Put doc without _id should fail
    ✓ Put doc with bad reserved id should fail
    ✓ update_seq persists
    ✓ deletions persists
    ✓ #4126 should not store raw Dates
    ✓ Create a db with a reserved name
    ✓ Error when document is not an object
    ✓ Test instance update_seq updates correctly
    ✓ Fail to fetch a doc after db was deleted
    ✓ Fail to fetch a doc after db was deleted
    ✓ Cant add docs with empty ids
    ✓ Test doc with percent in ID
    ✓ db.info should give auto_compaction = false (#2744)
    ✓ db.info should give auto_compaction = true (#2744)
    ✓ db.info should give adapter name (#3567)
    ✓ db.info should give correct doc_count
    ✓ putting returns {ok: true}
    ✓ putting is override-able
    ✓ issue 2779, deleted docs, old revs COUCHDB-292
    ✓ issue 2888, successive deletes and writes
    ✓ 2 invalid puts
    ✓ Docs save "null" value
    ✓ replace PouchDB.destroy() (express-pouchdb#203)
    ✓ 3968, keeps all object fields
    ✓ 4712 invalid rev for new doc generates conflict
    ✓ test info() after db close
    ✓ test get() after db close
    ✓ test close() after db close
    ✓ 7259 should have "this" keyword properly scoped
    ✓ should allow unicode doc ids
    ✓ should have same blob support for 2 dbs
    ✓ 6053, PouchDB.plugin() resets defaults
    ✓ #5471 PouchDB.plugin() should throw error if passed wrong type or empty object

  test.bulk_docs.js-local
    ✓ Testing bulk docs
    ✓ #6039 test id in bulk docs for conflict
    ✓ No id in bulk docs
    ✓ No _rev and new_edits=false
    ✓ 7829 bare rev 1- with new_edits=false
    ✓ Test empty bulkDocs
    ✓ Test many bulkDocs
    ✓ Test errors on invalid doc id
    ✓ Test two errors on invalid doc id
    ✓ No docs
    ✓ Jira 911
    ✓ Test multiple bulkdocs
    ✓ #2935 new_edits=false correct number
    ✓ #2935 new_edits=false correct number 2
    ✓ bulk docs update then delete then conflict
    ✓ bulk_docs delete then undelete
    ✓ #2935 new_edits=false with single unauthorized
    ✓ Deleting _local docs with bulkDocs
    ✓ Deleting _local docs with bulkDocs, not found
    ✓ Deleting _local docs with bulkDocs, wrong rev
    ✓ Bulk with new_edits=false
    ✓ Testing successive new_edits to the same doc
    ✓ #3062 bulkDocs with staggered seqs
    ✓ Testing successive new_edits to the same doc, different content
    ✓ Testing successive new_edits to two doc
    ✓ Deletion with new_edits=false
    ✓ Deletion with new_edits=false, no history
    ✓ Modification with new_edits=false, no history
    ✓ Deletion with new_edits=false, no history, no revisions
    ✓ Testing new_edits=false in req body
    ✓ 656 regression in handling deleted docs
    ✓ Test quotes in doc ids
    ✓ Bulk docs empty list
    ✓ handles simultaneous writes
    ✓ bulk docs input by array
    ✓ Bulk empty list
    ✓ Bulk docs not an array
    ✓ Bulk docs not an object
    ✓ Bulk docs two different revisions to same document id
    ✓ 4204 respect revs_limit (267ms)
    ✓ 2839 implement revs_limit (178ms)
    ✓ 4372 revs_limit deletes old revisions of the doc
    ✓ 4372 revs_limit with auto_compaction deletes old revisions of the doc
    ✓ 4712 invalid rev for new doc generates conflict
    ✓ 5793 bulk docs accepts _conflicts when new_edits=false

  test.bulk_docs.js-http
    ✓ Testing bulk docs
    ✓ #6039 test id in bulk docs for conflict
    ✓ No id in bulk docs
    ✓ No _rev and new_edits=false
    ✓ 7829 bare rev 1- with new_edits=false
    ✓ Test empty bulkDocs
    ✓ Test many bulkDocs
    ✓ Test errors on invalid doc id
    ✓ Test two errors on invalid doc id
    ✓ No docs
    ✓ Jira 911
    ✓ Test multiple bulkdocs
    ✓ #2935 new_edits=false correct number (53ms)
    ✓ #2935 new_edits=false correct number 2 (48ms)
    ✓ bulk docs update then delete then conflict
    ✓ bulk_docs delete then undelete
    ✓ #2935 new_edits=false with single unauthorized
    ✓ Deleting _local docs with bulkDocs
    ✓ Bulk with new_edits=false
    ✓ Testing successive new_edits to the same doc
    ✓ #3062 bulkDocs with staggered seqs
    ✓ Testing successive new_edits to the same doc, different content
    ✓ Testing successive new_edits to two doc
    ✓ Deletion with new_edits=false
    ✓ Deletion with new_edits=false, no history
    ✓ Modification with new_edits=false, no history
    ✓ Deletion with new_edits=false, no history, no revisions
    ✓ Testing new_edits=false in req body
    ✓ 656 regression in handling deleted docs
    ✓ Test quotes in doc ids
    ✓ Bulk docs empty list
    ✓ handles simultaneous writes
    ✓ bulk docs input by array
    ✓ Bulk empty list
    ✓ Bulk docs not an array
    ✓ Bulk docs not an object
    ✓ Bulk docs two different revisions to same document id
    ✓ 4204 respect revs_limit (290ms)
    ✓ 2839 implement revs_limit
    ✓ 4372 revs_limit deletes old revisions of the doc
    ✓ 4372 revs_limit with auto_compaction deletes old revisions of the doc
    ✓ 4712 invalid rev for new doc generates conflict
    ✓ 5793 bulk docs accepts _conflicts when new_edits=false (41ms)

  test.bulk_get.js-http
    ✓ test bulk get with rev specified
    ✓ test bulk get with latest=true
    ✓ test bulk get with no rev specified
    ✓ _revisions is not returned by default
    ✓ #5886 bulkGet with reserved id
    ✓ _revisions is returned when specified
    ✓ _revisions is returned when specified, using implicit rev
    ✓ attachments are not included by default
    ✓ attachments are included when specified
    ✓ attachments are included when specified, using implicit rev

  test.bulk_get.js-local
    ✓ test bulk get with rev specified
    ✓ test bulk get with latest=true
    ✓ test bulk get with no rev specified
    ✓ _revisions is not returned by default
    ✓ #5886 bulkGet with reserved id
    ✓ _revisions is returned when specified
    ✓ _revisions is returned when specified, using implicit rev
    ✓ attachments are not included by default
    ✓ attachments are included when specified
    ✓ attachments are included when specified, using implicit rev

  test.changes.js-http
    ✓ All changes
    ✓ Changes with complete callback as param
    ✓ Promise resolved when changes cancelled
    - Live changes should clean listener when cancelled
    ✓ Changes Since
    ✓ Changes Since and limit limit 1
    ✓ Changes Since and limit limit 0
    ✓ Changes limit
    ✓ Changes with filter not present in ddoc
    ✓ Changes with `filters` key not present in ddoc
    ✓ Changes limit and filter
    ✓ Changes with shorthand function name
    ✓ Changes with filter from nonexistent ddoc
    ✓ Changes with view not present in ddoc
    ✓ Changes with `views` key not present in ddoc
    ✓ #4451 Changes with invalid view filter
    ✓ 3356 throw inside a filter
    ✓ Changes with missing param `view` in request
    ✓ Changes limit and view instead of filter
    ✓ #3609 view option implies filter: _view
    ✓ Immediately cancel changes
    ✓ Changes with invalid ddoc view name
    ✓ Changes with invalid ddoc view name 2
    ✓ Changes with style = all_docs (62ms)
    ✓ Changes with style = all_docs and a callback for complete (55ms)
    ✓ Changes limit = 0
    ✓ Changes doc
    - Descending many changes
    ✓ live-changes
    ✓ Multiple watchers
    ✓ Continuous changes doc
    ✓ Cancel changes (325ms)
    ✓ #3579 changes firing 1 too many times (75ms)
    ✓ Kill database while listening to live changes
    ✓ #3136 style=all_docs (40ms)
    ✓ #4191 revs_diff causes endless loop
    ✓ #3136 style=all_docs & include_docs
    ✓ changes-filter with query params
    ✓ Non-live changes filter
    ✓ Non-live changes filter, descending
    ✓ #2569 Non-live doc_ids filter
    ✓ #2569 Big non-live doc_ids filter
    ✓ #2569 Live doc_ids filter
    ✓ #2569 Big live doc_ids filter
    ✓ #2569 Non-live doc_ids filter with filter=_doc_ids
    ✓ #2569 Live doc_ids filter with filter=_doc_ids
    ✓ Changes to same doc are grouped
    ✓ Changes with conflicts are handled correctly (132ms)
    ✓ Change entry for a deleted doc
    ✓ changes large number of docs (53ms)
    ✓ Calling db.changes({since: 'now'}) (38ms)
    ✓ Calling db.changes({since: 'latest'})
    ✓ Closing db does not cause a crash if changes cancelled
    ✓ fire-complete-on-cancel (101ms)
    ✓ changes are not duplicated (1024ms)
    ✓ supports return_docs=false
    ✓ should respects limit (73ms)
    ✓ doesn't throw if opts.complete is undefined
    ✓ handle individual changes in live replication (277ms)
    ✓ changes-filter without filter
    ✓ #3539 - Exception in changes is fine (40ms)
    ✓ Changes with selector
    ✓ Changes with selector, explicit filter
    ✓ Changes with selector and mismatched filter
    ✓ Changes with limit and selector

  test.changes.js-local
    ✓ All changes
    ✓ Changes with complete callback as param
    ✓ Promise resolved when changes cancelled
    - Live changes should clean listener when cancelled
    ✓ Changes Since
    ✓ Changes Since and limit limit 1
    ✓ Changes Since and limit limit 0
    ✓ Changes limit
    ✓ Changes with filter not present in ddoc
    ✓ Changes with `filters` key not present in ddoc
    ✓ Changes limit and filter
    ✓ Changes with shorthand function name
    ✓ Changes with filter from nonexistent ddoc
    ✓ Changes with view not present in ddoc
    ✓ Changes with `views` key not present in ddoc
    ✓ #4451 Changes with invalid view filter
    ✓ 3356 throw inside a filter
    ✓ Changes with missing param `view` in request
    ✓ Changes limit and view instead of filter
    ✓ #3609 view option implies filter: _view
    ✓ Immediately cancel changes
    ✓ Changes with invalid ddoc view name
    ✓ Changes with invalid ddoc view name 2
    ✓ Changes with style = all_docs
    ✓ Changes with style = all_docs and a callback for complete
    ✓ Changes limit = 0
    ✓ Changes doc
    - Descending many changes
    ✓ live-changes
    ✓ Multiple watchers
    ✓ Continuous changes doc
    ✓ Cancel changes (316ms)
    ✓ #3579 changes firing 1 too many times (69ms)
    ✓ Kill database while listening to live changes
    ✓ #3136 style=all_docs
    ✓ #4191 revs_diff causes endless loop
    ✓ #3136 style=all_docs & include_docs
    ✓ changes-filter with query params
    ✓ Non-live changes filter
    ✓ Non-live changes filter, descending
    ✓ #2569 Non-live doc_ids filter
    ✓ #2569 Big non-live doc_ids filter
    ✓ #2569 Live doc_ids filter
    ✓ #2569 Big live doc_ids filter
    ✓ #2569 Non-live doc_ids filter with filter=_doc_ids
    ✓ #2569 Live doc_ids filter with filter=_doc_ids
    ✓ Changes to same doc are grouped
    ✓ Changes with conflicts are handled correctly
    ✓ Change entry for a deleted doc
    ✓ changes large number of docs (47ms)
    ✓ Calling db.changes({since: 'now'})
    ✓ Calling db.changes({since: 'latest'})
    ✓ Closing db does not cause a crash if changes cancelled
    ✓ fire-complete-on-cancel (102ms)
    ✓ changes are not duplicated (1018ms)
    ✓ supports return_docs=false
    ✓ should respects limit (66ms)
    ✓ doesn't throw if opts.complete is undefined
    ✓ handle individual changes in live replication (69ms)
    ✓ changes-filter without filter
    ✓ #3539 - Exception in changes is fine
    ✓ Changes with selector
    ✓ Changes with selector, explicit filter
    ✓ Changes with selector and mismatched filter
    ✓ Changes with limit and selector

  changes-standalone
    - Changes reports errors

  test.close.js-local
    ✓ should emit destroyed even when closed (sync)
    ✓ should emit destroyed even when closed (async)
precondition_failed: Database not open
    at Object.<anonymous> (/data/js-variants/multee/Clients/levelup/pouchdb/packages/node_modules/pouchdb/lib/index.js:614:16)
    at Module._compile (node:internal/modules/cjs/loader:1105:14)
    at Module._extensions..js (node:internal/modules/cjs/loader:1159:10)
    at Module.load (node:internal/modules/cjs/loader:981:32)
    at Module._load (node:internal/modules/cjs/loader:827:12)
    at Module.require (node:internal/modules/cjs/loader:1005:19)
    at require (node:internal/modules/cjs/helpers:102:18)
    at commonUtils.loadPouchDBForNode (/data/js-variants/multee/Clients/levelup/pouchdb/tests/common-utils.js:92:17)
    at commonUtils.loadPouchDB (/data/js-variants/multee/Clients/levelup/pouchdb/tests/common-utils.js:78:39)
    at Object.<anonymous> (/data/js-variants/multee/Clients/levelup/pouchdb/tests/integration/node.setup.js:21:28)
    at Module._compile (node:internal/modules/cjs/loader:1105:14)
    at Module._extensions..js (node:internal/modules/cjs/loader:1159:10)
    at Module.load (node:internal/modules/cjs/loader:981:32)
    at Module._load (node:internal/modules/cjs/loader:827:12)
    at Module.require (node:internal/modules/cjs/loader:1005:19)
    at require (node:internal/modules/cjs/helpers:102:18)
    at /data/js-variants/multee/Clients/levelup/pouchdb/node_modules/mocha/bin/_mocha:366:3
    at Array.forEach (<anonymous>)
    at Object.<anonymous> (/data/js-variants/multee/Clients/levelup/pouchdb/node_modules/mocha/bin/_mocha:365:10)
    at Module._compile (node:internal/modules/cjs/loader:1105:14)
    at Module._extensions..js (node:internal/modules/cjs/loader:1159:10)
    at Module.load (node:internal/modules/cjs/loader:981:32)
    at Module._load (node:internal/modules/cjs/loader:827:12)
    at Function.executeUserEntryPoint [as runMain] (node:internal/modules/run_main:77:12)
    at node:internal/main/run_main_module:17:47
    ✓ should emit closed even when destroyed (async #2)
precondition_failed: Database not open
    at Object.<anonymous> (/data/js-variants/multee/Clients/levelup/pouchdb/packages/node_modules/pouchdb/lib/index.js:614:16)
    at Module._compile (node:internal/modules/cjs/loader:1105:14)
    at Module._extensions..js (node:internal/modules/cjs/loader:1159:10)
    at Module.load (node:internal/modules/cjs/loader:981:32)
    at Module._load (node:internal/modules/cjs/loader:827:12)
    at Module.require (node:internal/modules/cjs/loader:1005:19)
    at require (node:internal/modules/cjs/helpers:102:18)
    at commonUtils.loadPouchDBForNode (/data/js-variants/multee/Clients/levelup/pouchdb/tests/common-utils.js:92:17)
    at commonUtils.loadPouchDB (/data/js-variants/multee/Clients/levelup/pouchdb/tests/common-utils.js:78:39)
    at Object.<anonymous> (/data/js-variants/multee/Clients/levelup/pouchdb/tests/integration/node.setup.js:21:28)
    at Module._compile (node:internal/modules/cjs/loader:1105:14)
    at Module._extensions..js (node:internal/modules/cjs/loader:1159:10)
    at Module.load (node:internal/modules/cjs/loader:981:32)
    at Module._load (node:internal/modules/cjs/loader:827:12)
    at Module.require (node:internal/modules/cjs/loader:1005:19)
    at require (node:internal/modules/cjs/helpers:102:18)
    at /data/js-variants/multee/Clients/levelup/pouchdb/node_modules/mocha/bin/_mocha:366:3
    at Array.forEach (<anonymous>)
    at Object.<anonymous> (/data/js-variants/multee/Clients/levelup/pouchdb/node_modules/mocha/bin/_mocha:365:10)
    at Module._compile (node:internal/modules/cjs/loader:1105:14)
    at Module._extensions..js (node:internal/modules/cjs/loader:1159:10)
    at Module.load (node:internal/modules/cjs/loader:981:32)
    at Module._load (node:internal/modules/cjs/loader:827:12)
    at Function.executeUserEntryPoint [as runMain] (node:internal/modules/run_main:77:12)
    at node:internal/main/run_main_module:17:47
    ✓ test unref for coverage
    ✓ test double unref for coverage
precondition_failed: Database not open
    at Object.<anonymous> (/data/js-variants/multee/Clients/levelup/pouchdb/packages/node_modules/pouchdb/lib/index.js:614:16)
    at Module._compile (node:internal/modules/cjs/loader:1105:14)
    at Module._extensions..js (node:internal/modules/cjs/loader:1159:10)
    at Module.load (node:internal/modules/cjs/loader:981:32)
    at Module._load (node:internal/modules/cjs/loader:827:12)
    at Module.require (node:internal/modules/cjs/loader:1005:19)
    at require (node:internal/modules/cjs/helpers:102:18)
    at commonUtils.loadPouchDBForNode (/data/js-variants/multee/Clients/levelup/pouchdb/tests/common-utils.js:92:17)
    at commonUtils.loadPouchDB (/data/js-variants/multee/Clients/levelup/pouchdb/tests/common-utils.js:78:39)
    at Object.<anonymous> (/data/js-variants/multee/Clients/levelup/pouchdb/tests/integration/node.setup.js:21:28)
    at Module._compile (node:internal/modules/cjs/loader:1105:14)
    at Module._extensions..js (node:internal/modules/cjs/loader:1159:10)
    at Module.load (node:internal/modules/cjs/loader:981:32)
    at Module._load (node:internal/modules/cjs/loader:827:12)
    at Module.require (node:internal/modules/cjs/loader:1005:19)
    at require (node:internal/modules/cjs/helpers:102:18)
    at /data/js-variants/multee/Clients/levelup/pouchdb/node_modules/mocha/bin/_mocha:366:3
    at Array.forEach (<anonymous>)
    at Object.<anonymous> (/data/js-variants/multee/Clients/levelup/pouchdb/node_modules/mocha/bin/_mocha:365:10)
    at Module._compile (node:internal/modules/cjs/loader:1105:14)
    at Module._extensions..js (node:internal/modules/cjs/loader:1159:10)
    at Module.load (node:internal/modules/cjs/loader:981:32)
    at Module._load (node:internal/modules/cjs/loader:827:12)
    at Function.executeUserEntryPoint [as runMain] (node:internal/modules/run_main:77:12)
    at node:internal/main/run_main_module:17:47
    ✓ test close-then-destroyed for coverage
************* run test done *************
pouchdb is testing ./Variants/levelup/variant5/levelup
/data/js-variants/multee
************* npm unlink module *************

removed 1 package, changed 1 package, and audited 1032 packages in 3s

64 packages are looking for funding
  run `npm fund` for details

41 vulnerabilities (1 low, 9 moderate, 25 high, 6 critical)

To address issues that do not require attention, run:
  npm audit fix

To address all issues possible (including breaking changes), run:
  npm audit fix --force

Some issues need review, and may require choosing
a different dependency.

Run `npm audit` for details.
************* npm unlink module done *************
************* npm unlink globally *************

removed 1 package, and audited 1 package in 1s

found 0 vulnerabilities
************* npm unlink globally done *************
************* npm link globally *************

added 1 package, and audited 3 packages in 425ms

found 0 vulnerabilities
************* npm link globally done *************
************* npm link module *************

added 1 package, changed 1 package, and audited 1034 packages in 4s

64 packages are looking for funding
  run `npm fund` for details

41 vulnerabilities (1 low, 9 moderate, 25 high, 6 critical)

To address issues that do not require attention, run:
  npm audit fix

To address all issues possible (including breaking changes), run:
  npm audit fix --force

Some issues need review, and may require choosing
a different dependency.

Run `npm audit` for details.
************* npm link module done *************
************* start run test *************

> pouchdb-monorepo@7.0.0-prerelease test
> bash bin/run-test.sh


> pouchdb-monorepo@7.0.0-prerelease build-node
> bash bin/build-node.sh


> pouchdb-monorepo@7.0.0-prerelease build-modules
> node bin/build-modules.js

Building pouchdb...
Building pouchdb-abstract-mapreduce...
Building pouchdb-adapter-http...
Building pouchdb-adapter-idb...
Building pouchdb-adapter-indexeddb...
Building pouchdb-adapter-leveldb...
Building pouchdb-adapter-leveldb-core...
Building pouchdb-adapter-localstorage...
Building pouchdb-adapter-memory...
Building pouchdb-adapter-utils...
Building pouchdb-binary-utils...
Building pouchdb-browser...
Building pouchdb-changes-filter...
Building pouchdb-checkpointer...
Building pouchdb-collate...
Building pouchdb-collections...
Building pouchdb-core...
Building pouchdb-errors...
Building pouchdb-fetch...
Building pouchdb-find...
Building pouchdb-for-coverage...
Building pouchdb-generate-replication-id...
Building pouchdb-json...
Building pouchdb-mapreduce...
Building pouchdb-mapreduce-utils...
Building pouchdb-md5...
Building pouchdb-merge...
Building pouchdb-node...
Building pouchdb-replication...
Building pouchdb-selector-core...
Building pouchdb-utils...
Building sublevel-pouchdb...
  ✓ wrote pouchdb-adapter-localstorage/lib/index.js in vanilla mode
  ✓ wrote pouchdb-adapter-localstorage/lib/index.es.js in vanilla mode
  ✓ wrote pouchdb-adapter-memory/lib/index.js in vanilla mode
  ✓ wrote pouchdb-adapter-memory/lib/index.es.js in vanilla mode
  ✓ wrote pouchdb-checkpointer/lib/index.js in vanilla mode
  ✓ wrote pouchdb-checkpointer/lib/index.es.js in vanilla mode
  ✓ wrote pouchdb-errors/lib/index.js in vanilla mode
  ✓ wrote pouchdb-errors/lib/index.es.js in vanilla mode
  ✓ wrote pouchdb-generate-replication-id/lib/index.js in vanilla mode
  ✓ wrote pouchdb-generate-replication-id/lib/index.es.js in vanilla mode
  ✓ wrote pouchdb-adapter-http/lib/index.js in vanilla mode
  ✓ wrote pouchdb-adapter-http/lib/index.es.js in vanilla mode
  ✓ wrote pouchdb-adapter-leveldb-core/lib/index.js in node mode
  ✓ wrote pouchdb-adapter-leveldb-core/lib/index.es.js in node mode
  ✓ wrote pouchdb-adapter-leveldb-core/lib/index-browser.js in browser mode
  ✓ wrote pouchdb-adapter-leveldb-core/lib/index-browser.es.js in browser mode
  ✓ wrote pouchdb-adapter-leveldb/lib/index.js in node mode
  ✓ wrote pouchdb-adapter-leveldb/lib/index.es.js in node mode
  ✓ wrote pouchdb-adapter-leveldb/lib/index-browser.js in browser mode
  ✓ wrote pouchdb-adapter-leveldb/lib/index-browser.es.js in browser mode
  ✓ wrote pouchdb-changes-filter/lib/index-browser.js in browser mode
  ✓ wrote pouchdb-changes-filter/lib/index-browser.es.js in browser mode
  ✓ wrote pouchdb-fetch/lib/index-browser.js in browser mode
  ✓ wrote pouchdb-fetch/lib/index-browser.es.js in browser mode
  ✓ wrote pouchdb-md5/lib/index-browser.js in browser mode
  ✓ wrote pouchdb-md5/lib/index-browser.es.js in browser mode
  ✓ wrote pouchdb-changes-filter/lib/index.js in node mode
  ✓ wrote pouchdb-changes-filter/lib/index.es.js in node mode
  ✓ wrote pouchdb-collate/lib/index.js in vanilla mode
  ✓ wrote pouchdb-collate/lib/index.es.js in vanilla mode
  ✓ wrote pouchdb-fetch/lib/index.js in node mode
  ✓ wrote pouchdb-fetch/lib/index.es.js in node mode
  ✓ wrote pouchdb-json/lib/index.js in vanilla mode
  ✓ wrote pouchdb-json/lib/index.es.js in vanilla mode
  ✓ wrote pouchdb-mapreduce-utils/lib/index.js in vanilla mode
  ✓ wrote pouchdb-mapreduce-utils/lib/index.es.js in vanilla mode
  ✓ wrote pouchdb-md5/lib/index.js in node mode
  ✓ wrote pouchdb-md5/lib/index.es.js in node mode
  ✓ wrote pouchdb-abstract-mapreduce/lib/index.js in vanilla mode
  ✓ wrote pouchdb-abstract-mapreduce/lib/index.es.js in vanilla mode
  ✓ wrote pouchdb-adapter-idb/lib/index.js in vanilla mode
  ✓ wrote pouchdb-adapter-idb/lib/index.es.js in vanilla mode
  ✓ wrote pouchdb-adapter-indexeddb/lib/index.js in vanilla mode
  ✓ wrote pouchdb-adapter-indexeddb/lib/index.es.js in vanilla mode
  ✓ wrote pouchdb-binary-utils/lib/index-browser.js in browser mode
  ✓ wrote pouchdb-binary-utils/lib/index-browser.es.js in browser mode
  ✓ wrote pouchdb-utils/lib/index-browser.js in browser mode
  ✓ wrote pouchdb-utils/lib/index-browser.es.js in browser mode
  ✓ wrote pouchdb-utils/lib/index.js in node mode
  ✓ wrote pouchdb-utils/lib/index.es.js in node mode
  ✓ wrote pouchdb-adapter-utils/lib/index.js in vanilla mode
  ✓ wrote pouchdb-adapter-utils/lib/index.es.js in vanilla mode
  ✓ wrote pouchdb-binary-utils/lib/index.js in node mode
  ✓ wrote pouchdb-binary-utils/lib/index.es.js in node mode
  ✓ wrote pouchdb-collections/lib/index.js in vanilla mode
  ✓ wrote pouchdb-collections/lib/index.es.js in vanilla mode
  ✓ wrote pouchdb-merge/lib/index.js in vanilla mode
  ✓ wrote pouchdb-merge/lib/index.es.js in vanilla mode
  ✓ wrote pouchdb-selector-core/lib/index.js in vanilla mode
  ✓ wrote pouchdb-selector-core/lib/index.es.js in vanilla mode
  ✓ wrote sublevel-pouchdb/lib/index.js in vanilla mode
  ✓ wrote sublevel-pouchdb/lib/index.es.js in vanilla mode
  ✓ wrote pouchdb-mapreduce/lib/index-browser.js in browser mode
  ✓ wrote pouchdb-mapreduce/lib/index-browser.es.js in browser mode
  ✓ wrote pouchdb-replication/lib/index.js in vanilla mode
  ✓ wrote pouchdb-replication/lib/index.es.js in vanilla mode
  ✓ wrote pouchdb-mapreduce/lib/index.js in node mode
  ✓ wrote pouchdb-mapreduce/lib/index.es.js in node mode
  ✓ wrote pouchdb-core/lib/index.js in vanilla mode
  ✓ wrote pouchdb-core/lib/index.es.js in vanilla mode
  ✓ wrote pouchdb-find/lib/index.js in node mode
  ✓ wrote pouchdb-find/lib/index.es.js in node mode
  ✓ wrote pouchdb-find/lib/index-browser.js in browser mode
  ✓ wrote pouchdb-find/lib/index-browser.es.js in browser mode
  ✓ wrote pouchdb-browser/lib/index.js in vanilla mode
  ✓ wrote pouchdb-browser/lib/index.es.js in vanilla mode
  ✓ wrote pouchdb-node/lib/index.js in vanilla mode
  ✓ wrote pouchdb-node/lib/index.es.js in vanilla mode
  ✓ wrote pouchdb-for-coverage/lib/index.js in node mode
  ✓ wrote pouchdb-for-coverage/lib/index.es.js in node mode
  ✓ wrote pouchdb-for-coverage/lib/index-browser.js in browser mode
  ✓ wrote packages/node_modules/pouchdb/lib/index.js
  ✓ wrote pouchdb-for-coverage/lib/index-browser.es.js in browser mode
  ✓ wrote packages/node_modules/pouchdb/lib/index.es.js
Waiting for host to start ..
Host started :)
> pouchdb-monorepo@7.0.0-prerelease test-node
> bash bin/test-node.sh

Down server listening on port 3010
Seeded with: 1660143181381


  DB Setup
    ✓ PouchDB has a version
    ✓ PouchDB version matches package.json

  test.active_tasks.js
    ✓ Can add a task
    ✓ Can get tasks by id
    ✓ Can get all tasks
    ✓ Can update a task
    ✓ Can remove a task

  test.all_docs.js-http
    ✓ Testing all docs (146ms)
    ✓ Testing allDocs opts.keys (65ms)
    ✓ Testing allDocs opts.keys with skip
    ✓ Testing allDocs opts.keys with limit
    ✓ Testing allDocs invalid opts.keys
    ✓ Testing deleting in changes (43ms)
    ✓ Testing updating in changes (43ms)
    ✓ Testing include docs
    ✓ Testing conflicts (45ms)
    ✓ test basic collation
    ✓ 3883 start_key end_key aliases
    ✓ test total_rows with a variety of criteria (152ms)
    ✓ test total_rows with both skip and limit
    ✓ test limit option and total_rows
    ✓ test escaped startkey/endkey
    ✓ test "key" option
    ✓ test inclusive_end=false (51ms)
    ✓ test descending with startkey/endkey (42ms)
    ✓ #3082 test wrong num results returned (276ms)
    ✓ test empty db
    ✓ test after db close
    ✓ 5793 _conflicts should not exist if no conflicts
    ✓ #6230 Test allDocs opts update_seq: false
    ✓ #6230 Test allDocs opts update_seq: true
    ✓ #6230 Test allDocs opts with update_seq missing

  test.all_docs.js-local
    ✓ Testing all docs
    ✓ Testing allDocs opts.keys
    ✓ Testing allDocs opts.keys with skip
    ✓ Testing allDocs opts.keys with limit
    ✓ Testing allDocs invalid opts.keys
    ✓ Testing deleting in changes
    ✓ Testing updating in changes
    ✓ Testing include docs
    ✓ Testing conflicts
    ✓ test basic collation
    ✓ 3883 start_key end_key aliases
    ✓ test total_rows with a variety of criteria
    ✓ test total_rows with both skip and limit
    ✓ test limit option and total_rows
    ✓ test escaped startkey/endkey
    ✓ test "key" option
    ✓ test inclusive_end=false
    ✓ test descending with startkey/endkey
    ✓ #3082 test wrong num results returned (182ms)
    ✓ test empty db
    ✓ test after db close
    ✓ test unicode ids and revs
    ✓ 5793 _conflicts should not exist if no conflicts
    ✓ #6230 Test allDocs opts update_seq: false
    ✓ #6230 Test allDocs opts update_seq: true
    ✓ #6230 Test allDocs opts with update_seq missing

  suite2 test.attachments.js-local
    ✓ 3357 Attachment names cant start with _
    ✓ 5736 warning for putAttachment without content_type
    ✓ 5736 warning for bulkDocs attachments without content_type
    ✓ fetch atts with open_revs and missing
    ✓ issue 2803 should throw 412
    ✓ issue 2803 should throw 412 part 2
    ✓ issue 2803 should throw 412 part 3
    ✓ issue 2803 should throw 412 part 4
    ✓ #2858 {binary: true} in get()
    ✓ #2858 {binary: true} in allDocs() 1
    ✓ #2858 {binary: true} in allDocs() 2
    ✓ #2858 {binary: true} in allDocs() 3
    ✓ #2858 {binary: true} in allDocs() 4
    ✓ #2858 {binary: true} in allDocs() 5
    ✓ #2858 {binary: true} in allDocs(), many atts
    ✓ #2858 {binary: true} in allDocs(), mixed atts
    ✓ #2858 {binary: true} in changes() non-live
    ✓ #2858 {binary: true} in changes() non-live, many atts
    ✓ #2858 {binary: true} in changes() non-live, mixed atts
    ✓ #2858 {binary: true} non-live changes, complete event
    ✓ #2858 {binary: true} in live changes
    ✓ #2858 {binary: true} in live changes, mixed atts
    ✓ #2858 {binary: true} in live+retry changes
    ✓ #2858 {binary: true} in live changes, attachments:false
    ✓ #2858 {binary: true} in live changes, include_docs:false
    ✓ #6736 {binary: true} in bulkGet()
    ✓ Measures length correctly after put()
    ✓ #3074 non-live changes()
    ✓ #3074 live changes()
    ✓ #3074 non-live changes(), no attachments
    ✓ #3074 live changes(), no attachments
    ✓ #3881 filter extraneous keys from _attachments
    ✓ #2771 allDocs() 1, single attachment
    ✓ #2771 allDocs() 2, many docs same att
    ✓ #2771 allDocs() 3, many docs diff atts
    ✓ #2771 allDocs() 4, mix of atts and no atts
    ✓ #2771 allDocs() 5, no atts
    ✓ #2771 allDocs() 6, no docs
    ✓ #2771 allDocs() 7, revisions and deletions
    ✓ #2771 allDocs() 8, empty attachment
    ✓ No length for non-stubs
    ✓ Test some attachments
    ✓ Test getAttachment
    ✓ Test getAttachment with stubs
    ✓ Test get() with binary:true and stubs
    ✓ Test attachments in allDocs/changes
    ✓ Test putAttachment with base64 plaintext
    ✓ Test putAttachment with invalid base64
    ✓ Test getAttachment with empty text
    ✓ Test getAttachment with normal text
    ✓ Test getAttachment with PNG
    ✓ Test getAttachment with PNG using bulkDocs
    ✓ Test getAttachment with PNG using post
    ✓ Test postAttachment with PNG then bulkDocs
    ✓ proper stub behavior
    ✓ Testing with invalid docs
    ✓ Test create attachment and doc in one go
    ✓ Test create attachment and doc in one go without callback
    ✓ Test create attachment without callback
    ✓ Test put attachment on a doc without attachments
    ✓ Test put attachment with unencoded name
    ✓ 3963 length property on stubs
    ✓ Testing with invalid rev
    ✓ Test put another attachment on a doc with attachments
    ✓ Test get with attachments: true if empty attachments
    ✓ Test delete attachment from a doc
    ✓ Test a document with a json string attachment
    ✓ Test remove doc with attachment
    ✓ Try to insert a doc with unencoded attachment
    ✓ Try to get attachment of unexistent doc
    ✓ Test synchronous putAttachment with text data
    ✓ Test synchronous putAttachment with no text data
    ✓ Test put with partial stubs
    ✓ Test put with attachments and new_edits=false
    ✓ Test getAttachment with specific rev
    ✓ Test getAttachment with diff revs and content
    ✓ Test stubs
    ✓ Try to get unexistent attachment of some doc
    ✓ putAttachment and getAttachment with plaintext
    ✓ putAttachment and getAttachment with png data
    ✓ putAttachment in new doc with base64
    ✓ #2818 - save same attachment in different revs
    ✓ #2818 - save same attachment many times in parallel
    ✓ #2818 - revisions keep attachments (no compaction)
    ✓ #2818 - doesn't throw 409 if same filename
    ✓ #3008 test correct encoding/decoding of \u0000 etc.
    ✓ putAttachment and getAttachment with big png data (87ms)
    ✓ #2709 `revpos` with putAttachment
    ✓ #2709 `revpos` with inline attachment
    ✓ #2709 `revpos` with allDocs
    ✓ #7403 {attachments: true, binary: true, include_docs: true} in allDocs with one missing doc

  suite2 test.attachments.js-http
    ✓ 3357 Attachment names cant start with _
    ✓ 5736 warning for putAttachment without content_type
    ✓ 5736 warning for bulkDocs attachments without content_type
    ✓ fetch atts with open_revs and missing
    ✓ issue 2803 should throw 412
    ✓ issue 2803 should throw 412 part 2
    ✓ issue 2803 should throw 412 part 3
    ✓ issue 2803 should throw 412 part 4
    ✓ #2858 {binary: true} in get()
    ✓ #2858 {binary: true} in allDocs() 1
    ✓ #2858 {binary: true} in allDocs() 2
    ✓ #2858 {binary: true} in allDocs() 3
    ✓ #2858 {binary: true} in allDocs() 4
    ✓ #2858 {binary: true} in allDocs() 5
    ✓ #2858 {binary: true} in allDocs(), many atts
    ✓ #2858 {binary: true} in allDocs(), mixed atts
    ✓ #2858 {binary: true} in changes() non-live
    ✓ #2858 {binary: true} in changes() non-live, many atts
    ✓ #2858 {binary: true} in changes() non-live, mixed atts
    ✓ #2858 {binary: true} non-live changes, complete event
    ✓ #2858 {binary: true} in live changes
    ✓ #2858 {binary: true} in live changes, mixed atts
    ✓ #2858 {binary: true} in live+retry changes
    ✓ #2858 {binary: true} in live changes, attachments:false
    ✓ #2858 {binary: true} in live changes, include_docs:false
    ✓ #6736 {binary: true} in bulkGet()
    ✓ Measures length correctly after put()
    ✓ #3074 non-live changes()
    ✓ #3074 live changes()
    ✓ #3074 non-live changes(), no attachments
    ✓ #3074 live changes(), no attachments
    ✓ #3881 filter extraneous keys from _attachments
    ✓ #2771 allDocs() 1, single attachment
    ✓ #2771 allDocs() 2, many docs same att
    ✓ #2771 allDocs() 3, many docs diff atts
    ✓ #2771 allDocs() 4, mix of atts and no atts
    ✓ #2771 allDocs() 5, no atts
    ✓ #2771 allDocs() 6, no docs
    ✓ #2771 allDocs() 7, revisions and deletions (38ms)
    ✓ #2771 allDocs() 8, empty attachment
    ✓ No length for non-stubs
    ✓ Test some attachments (62ms)
    ✓ Test getAttachment (44ms)
    ✓ Test getAttachment with stubs (54ms)
    ✓ Test get() with binary:true and stubs (83ms)
    ✓ Test attachments in allDocs/changes
    ✓ Test putAttachment with base64 plaintext
    ✓ Test putAttachment with invalid base64
    ✓ Test getAttachment with empty text
    ✓ Test getAttachment with normal text
    ✓ Test getAttachment with PNG
    ✓ Test getAttachment with PNG using bulkDocs (41ms)
    ✓ Test getAttachment with PNG using post
    ✓ Test postAttachment with PNG then bulkDocs
    ✓ proper stub behavior
    ✓ Testing with invalid docs
    ✓ Test create attachment and doc in one go
    ✓ Test create attachment and doc in one go without callback
    ✓ Test create attachment without callback (38ms)
    ✓ Test put attachment on a doc without attachments
    ✓ Test put attachment with unencoded name
    ✓ 3963 length property on stubs (46ms)
    ✓ Testing with invalid rev
    ✓ Test put another attachment on a doc with attachments
    ✓ Test get with attachments: true if empty attachments
    ✓ Test delete attachment from a doc (44ms)
    ✓ Test a document with a json string attachment
    ✓ Test remove doc with attachment
    ✓ Try to insert a doc with unencoded attachment
    ✓ Try to get attachment of unexistent doc
    ✓ Test synchronous putAttachment with text data
    ✓ Test synchronous putAttachment with no text data
    ✓ Test put with partial stubs
    ✓ Test put with attachments and new_edits=false
    ✓ Test getAttachment with specific rev (38ms)
    ✓ Test getAttachment with diff revs and content (38ms)
    ✓ Test stubs
    ✓ Try to get unexistent attachment of some doc
    ✓ putAttachment and getAttachment with plaintext
    ✓ putAttachment and getAttachment with png data
    ✓ putAttachment in new doc with base64
    ✓ #2818 - save same attachment in different revs (50ms)
    ✓ #2818 - save same attachment many times in parallel
    ✓ #2818 - revisions keep attachments (no compaction) (41ms)
    ✓ #2818 - doesn't throw 409 if same filename
    ✓ #3008 test correct encoding/decoding of \u0000 etc.
    ✓ putAttachment and getAttachment with big png data (129ms)
    ✓ #2709 `revpos` with putAttachment (40ms)
    ✓ #2709 `revpos` with inline attachment
    ✓ #2709 `revpos` with allDocs
    ✓ #7403 {attachments: true, binary: true, include_docs: true} in allDocs with one missing doc

  suite2 test.attachments.js- local:http
    ✓ Attachments replicate back and forth (105ms)
    ✓ Replicate same doc, same atts (109ms)
    ✓ Replicate same doc, same atts 2 (116ms)
    ✓ Attachments replicate (87ms)
    ✓ Attachment types replicate (50ms)
    ✓ Many many attachments replicate (266ms)
    ✓ Many many png attachments replicate (195ms)
    ✓ Multiple attachments replicate (81ms)
    - #3961 Many attachments on same doc
    ✓ Multiple attachments replicate, different docs (#2698) (93ms)
    ✓ Multiple attachments replicate, different docs png (#2698) (75ms)
    ✓ #3932 attachments with tricky revpos (142ms)
    ✓ replication with changing attachments (102ms)
    ✓ 3955 race condition in put
    ✓ #8456 bad attachment rev after replication (118ms)

  suite2 test.attachments.js- http:http
    ✓ Attachments replicate back and forth (154ms)
    ✓ Replicate same doc, same atts (171ms)
    ✓ Replicate same doc, same atts 2 (173ms)
    ✓ Attachments replicate (138ms)
    ✓ Attachment types replicate (134ms)
    ✓ Many many attachments replicate (345ms)
    ✓ Many many png attachments replicate (295ms)
    ✓ Multiple attachments replicate (119ms)
    - #3961 Many attachments on same doc
    ✓ Multiple attachments replicate, different docs (#2698) (127ms)
    ✓ Multiple attachments replicate, different docs png (#2698) (126ms)
    ✓ #3932 attachments with tricky revpos (224ms)
    ✓ replication with changing attachments (150ms)
    ✓ 3955 race condition in put
    ✓ #8456 bad attachment rev after replication (179ms)

  suite2 test.attachments.js- http:local
    ✓ Attachments replicate back and forth (200ms)
    ✓ Replicate same doc, same atts (103ms)
    ✓ Replicate same doc, same atts 2 (94ms)
    ✓ Attachments replicate (48ms)
    ✓ Attachment types replicate (55ms)
    ✓ Many many attachments replicate (140ms)
    ✓ Many many png attachments replicate (184ms)
    ✓ Multiple attachments replicate (88ms)
    - #3961 Many attachments on same doc
    ✓ Multiple attachments replicate, different docs (#2698) (68ms)
    ✓ Multiple attachments replicate, different docs png (#2698) (94ms)
    ✓ #3932 attachments with tricky revpos (141ms)
    ✓ replication with changing attachments (95ms)
    ✓ 3955 race condition in put
    ✓ #8456 bad attachment rev after replication (118ms)

  suite2 test.attachments.js- local:local
    ✓ Attachments replicate back and forth
    ✓ Replicate same doc, same atts
    ✓ Replicate same doc, same atts 2
    ✓ Attachments replicate
    ✓ Attachment types replicate
    ✓ Many many attachments replicate
    ✓ Many many png attachments replicate
    ✓ Multiple attachments replicate
    - #3961 Many attachments on same doc
    ✓ Multiple attachments replicate, different docs (#2698) (40ms)
    ✓ Multiple attachments replicate, different docs png (#2698) (50ms)
    ✓ #3932 attachments with tricky revpos (40ms)
    ✓ replication with changing attachments
    ✓ 3955 race condition in put
    ✓ #8456 bad attachment rev after replication

  test.basics.js-http
    ✓ Create a pouch without new keyword
    ✓ Name is accessible via instance
    ✓ 4314 Create a pouch with + in name
    ✓ Creating Pouch without name will throw
    ✓ 4314 Create a pouch with urlencoded name
    ✓ 4219 destroy a pouch
    ✓ 4339 throw useful error if method called on stale instance
    ✓ [4595] should reject xhr errors
    ✓ [4595] should emit error event on xhr error
    ✓ Add a doc
    ✓ Get invalid id
    ✓ Missing doc should contain ID in error object
    ✓ PUTed Conflicted doc should contain ID in error object
    ✓ POSTed Conflicted doc should contain ID in error object
    ✓ Add a doc with a promise
    ✓ Add a doc with opts object
    ✓ Modify a doc
    ✓ Modifying a doc that has rewritten content
    ✓ Modify a doc with a promise
    ✓ Read db id
    ✓ Read db id with promise
    ✓ Close db
    ✓ Close db with a promise
    ✓ Read db id after closing Close
    ✓ Modify a doc with incorrect rev
    ✓ Remove doc
    ✓ Remove doc with a promise
    ✓ Remove doc with new syntax
    ✓ Remove doc with new syntax and a promise
    ✓ Doc removal leaves only stub
    ✓ Remove doc twice with specified id
    ✓ Remove doc, no callback
    ✓ Delete document without id
    ✓ Delete document with many args
    ✓ Delete document with many args, callback style
    ✓ Delete doc with id + rev + no opts
    ✓ Delete doc with id + rev + no opts, callback style
    ✓ Delete doc with doc + opts
    ✓ Delete doc with doc + opts, callback style
    ✓ Delete doc with rev in opts
    ✓ Bulk docs
    ✓ Bulk docs with a promise
    ✓ Basic checks
    ✓ update with invalid rev
    ✓ Doc validation
    ✓ Replication fields (#2442)
    ✓ Testing issue #48 (56ms)
    ✓ Testing valid id
    ✓ Put doc without _id should fail
    ✓ Put doc with bad reserved id should fail
    ✓ update_seq persists
    ✓ deletions persists
    ✓ #4126 should not store raw Dates
    ✓ Create a db with a reserved name
    ✓ Error when document is not an object
    ✓ Test instance update_seq updates correctly
    ✓ Fail to fetch a doc after db was deleted (43ms)
    ✓ Fail to fetch a doc after db was deleted (52ms)
    ✓ Cant add docs with empty ids
    ✓ Test doc with percent in ID
    ✓ db.info should give auto_compaction = false (#2744)
    ✓ db.info should give auto_compaction = true (#2744)
    ✓ db.info should give adapter name (#3567)
    ✓ db.info should give correct doc_count
    ✓ putting returns {ok: true}
    ✓ putting is override-able
    ✓ issue 2779, deleted docs, old revs COUCHDB-292
    ✓ issue 2888, successive deletes and writes
    ✓ 2 invalid puts
    ✓ Docs save "null" value
    ✓ replace PouchDB.destroy() (express-pouchdb#203)
    ✓ 3968, keeps all object fields
    ✓ 4712 invalid rev for new doc generates conflict
    ✓ test info() after db close
    ✓ test get() after db close
    ✓ test close() after db close
    ✓ 7259 should have "this" keyword properly scoped
    ✓ #5471 PouchDB.plugin() should throw error if passed wrong type or empty object

  test.basics.js-local
    ✓ Create a pouch without new keyword
    ✓ Name is accessible via instance
    ✓ 4314 Create a pouch with + in name
    ✓ Creating Pouch without name will throw
    ✓ 4314 Create a pouch with urlencoded name
    ✓ 4219 destroy a pouch
    ✓ 4339 throw useful error if method called on stale instance
    ✓ [4595] should reject xhr errors
    ✓ [4595] should emit error event on xhr error
    ✓ Add a doc
    ✓ Get invalid id
    ✓ Missing doc should contain ID in error object
    ✓ PUTed Conflicted doc should contain ID in error object
    ✓ POSTed Conflicted doc should contain ID in error object
    ✓ Add a doc with a promise
    ✓ Add a doc with opts object
    ✓ Modify a doc
    ✓ Modifying a doc that has rewritten content
    ✓ Modify a doc with a promise
    ✓ Read db id
    ✓ Read db id with promise
    ✓ Close db
    ✓ Close db with a promise
    ✓ Read db id after closing Close
    ✓ Modify a doc with incorrect rev
    ✓ Remove doc
    ✓ Remove doc with a promise
    ✓ Remove doc with new syntax
    ✓ Remove doc with new syntax and a promise
    ✓ Doc removal leaves only stub
    ✓ Remove doc twice with specified id
    ✓ Remove doc, no callback
    ✓ Delete document without id
    ✓ Delete document with many args
    ✓ Delete document with many args, callback style
    ✓ Delete doc with id + rev + no opts
    ✓ Delete doc with id + rev + no opts, callback style
    ✓ Delete doc with doc + opts
    ✓ Delete doc with doc + opts, callback style
    ✓ Delete doc with rev in opts
    ✓ Bulk docs
    ✓ Bulk docs with a promise
    ✓ Basic checks
    ✓ update with invalid rev
    ✓ Doc validation
    ✓ Replication fields (#2442)
    ✓ Allows _access field in documents (#8171)
    ✓ Testing issue #48 (56ms)
    ✓ Testing valid id
    ✓ Put doc without _id should fail
    ✓ Put doc with bad reserved id should fail
    ✓ update_seq persists
    ✓ deletions persists
    ✓ #4126 should not store raw Dates
    ✓ Create a db with a reserved name
    ✓ Error when document is not an object
    ✓ Test instance update_seq updates correctly
    ✓ Fail to fetch a doc after db was deleted (40ms)
    ✓ Fail to fetch a doc after db was deleted (40ms)
    ✓ Cant add docs with empty ids
    ✓ Test doc with percent in ID
    ✓ db.info should give auto_compaction = false (#2744)
    ✓ db.info should give auto_compaction = true (#2744)
    ✓ db.info should give adapter name (#3567)
    ✓ db.info should give correct doc_count
    ✓ putting returns {ok: true}
    ✓ putting is override-able
    ✓ issue 2779, deleted docs, old revs COUCHDB-292
    ✓ issue 2888, successive deletes and writes
    ✓ 2 invalid puts
    ✓ Docs save "null" value
    ✓ replace PouchDB.destroy() (express-pouchdb#203)
    ✓ 3968, keeps all object fields
    ✓ 4712 invalid rev for new doc generates conflict
    ✓ test info() after db close
    ✓ test get() after db close
    ✓ test close() after db close
    ✓ 7259 should have "this" keyword properly scoped
    ✓ should allow unicode doc ids
    ✓ should have same blob support for 2 dbs
    ✓ 6053, PouchDB.plugin() resets defaults
    ✓ #5471 PouchDB.plugin() should throw error if passed wrong type or empty object

  test.bulk_docs.js-local
    ✓ Testing bulk docs
    ✓ #6039 test id in bulk docs for conflict
    ✓ No id in bulk docs
    ✓ No _rev and new_edits=false
    ✓ 7829 bare rev 1- with new_edits=false
    ✓ Test empty bulkDocs
    ✓ Test many bulkDocs
    ✓ Test errors on invalid doc id
    ✓ Test two errors on invalid doc id
    ✓ No docs
    ✓ Jira 911
    ✓ Test multiple bulkdocs
    ✓ #2935 new_edits=false correct number
    ✓ #2935 new_edits=false correct number 2
    ✓ bulk docs update then delete then conflict
    ✓ bulk_docs delete then undelete
    ✓ #2935 new_edits=false with single unauthorized
    ✓ Deleting _local docs with bulkDocs
    ✓ Deleting _local docs with bulkDocs, not found
    ✓ Deleting _local docs with bulkDocs, wrong rev
    ✓ Bulk with new_edits=false
    ✓ Testing successive new_edits to the same doc
    ✓ #3062 bulkDocs with staggered seqs
    ✓ Testing successive new_edits to the same doc, different content
    ✓ Testing successive new_edits to two doc
    ✓ Deletion with new_edits=false
    ✓ Deletion with new_edits=false, no history
    ✓ Modification with new_edits=false, no history
    ✓ Deletion with new_edits=false, no history, no revisions
    ✓ Testing new_edits=false in req body
    ✓ 656 regression in handling deleted docs
    ✓ Test quotes in doc ids
    ✓ Bulk docs empty list
    ✓ handles simultaneous writes
    ✓ bulk docs input by array
    ✓ Bulk empty list
    ✓ Bulk docs not an array
    ✓ Bulk docs not an object
    ✓ Bulk docs two different revisions to same document id
    ✓ 4204 respect revs_limit (268ms)
    ✓ 2839 implement revs_limit (179ms)
    ✓ 4372 revs_limit deletes old revisions of the doc
    ✓ 4372 revs_limit with auto_compaction deletes old revisions of the doc
    ✓ 4712 invalid rev for new doc generates conflict
    ✓ 5793 bulk docs accepts _conflicts when new_edits=false

  test.bulk_docs.js-http
    ✓ Testing bulk docs
    ✓ #6039 test id in bulk docs for conflict
    ✓ No id in bulk docs
    ✓ No _rev and new_edits=false
    ✓ 7829 bare rev 1- with new_edits=false
    ✓ Test empty bulkDocs
    ✓ Test many bulkDocs
    ✓ Test errors on invalid doc id
    ✓ Test two errors on invalid doc id
    ✓ No docs
    ✓ Jira 911
    ✓ Test multiple bulkdocs
    ✓ #2935 new_edits=false correct number
    ✓ #2935 new_edits=false correct number 2
    ✓ bulk docs update then delete then conflict
    ✓ bulk_docs delete then undelete
    ✓ #2935 new_edits=false with single unauthorized
    ✓ Deleting _local docs with bulkDocs
    ✓ Bulk with new_edits=false
    ✓ Testing successive new_edits to the same doc
    ✓ #3062 bulkDocs with staggered seqs
    ✓ Testing successive new_edits to the same doc, different content
    ✓ Testing successive new_edits to two doc
    ✓ Deletion with new_edits=false
    ✓ Deletion with new_edits=false, no history
    ✓ Modification with new_edits=false, no history
    ✓ Deletion with new_edits=false, no history, no revisions
    ✓ Testing new_edits=false in req body
    ✓ 656 regression in handling deleted docs
    ✓ Test quotes in doc ids
    ✓ Bulk docs empty list
    ✓ handles simultaneous writes
    ✓ bulk docs input by array
    ✓ Bulk empty list
    ✓ Bulk docs not an array
    ✓ Bulk docs not an object
    ✓ Bulk docs two different revisions to same document id
    ✓ 4204 respect revs_limit (295ms)
    ✓ 2839 implement revs_limit
    ✓ 4372 revs_limit deletes old revisions of the doc
    ✓ 4372 revs_limit with auto_compaction deletes old revisions of the doc
    ✓ 4712 invalid rev for new doc generates conflict
    ✓ 5793 bulk docs accepts _conflicts when new_edits=false (50ms)

  test.bulk_get.js-http
    ✓ test bulk get with rev specified
    ✓ test bulk get with latest=true
    ✓ test bulk get with no rev specified
    ✓ _revisions is not returned by default
    ✓ #5886 bulkGet with reserved id
    ✓ _revisions is returned when specified
    ✓ _revisions is returned when specified, using implicit rev
    ✓ attachments are not included by default
    ✓ attachments are included when specified
    ✓ attachments are included when specified, using implicit rev

  test.bulk_get.js-local
    ✓ test bulk get with rev specified
    ✓ test bulk get with latest=true
    ✓ test bulk get with no rev specified
    ✓ _revisions is not returned by default
    ✓ #5886 bulkGet with reserved id
    ✓ _revisions is returned when specified
    ✓ _revisions is returned when specified, using implicit rev
    ✓ attachments are not included by default
    ✓ attachments are included when specified
    ✓ attachments are included when specified, using implicit rev

  test.changes.js-http
    ✓ All changes
    ✓ Changes with complete callback as param
    ✓ Promise resolved when changes cancelled
    - Live changes should clean listener when cancelled
    ✓ Changes Since
    ✓ Changes Since and limit limit 1
    ✓ Changes Since and limit limit 0
    ✓ Changes limit (46ms)
    ✓ Changes with filter not present in ddoc
    ✓ Changes with `filters` key not present in ddoc
    ✓ Changes limit and filter
    ✓ Changes with shorthand function name
    ✓ Changes with filter from nonexistent ddoc
    ✓ Changes with view not present in ddoc
    ✓ Changes with `views` key not present in ddoc
    ✓ #4451 Changes with invalid view filter
    ✓ 3356 throw inside a filter
    ✓ Changes with missing param `view` in request
    ✓ Changes limit and view instead of filter
    ✓ #3609 view option implies filter: _view
    ✓ Immediately cancel changes
    ✓ Changes with invalid ddoc view name
    ✓ Changes with invalid ddoc view name 2
    ✓ Changes with style = all_docs (58ms)
    ✓ Changes with style = all_docs and a callback for complete (60ms)
    ✓ Changes limit = 0
    ✓ Changes doc
    - Descending many changes
    ✓ live-changes
    ✓ Multiple watchers
    ✓ Continuous changes doc
    ✓ Cancel changes (328ms)
    ✓ #3579 changes firing 1 too many times (75ms)
    ✓ Kill database while listening to live changes
    ✓ #3136 style=all_docs
    ✓ #4191 revs_diff causes endless loop
    ✓ #3136 style=all_docs & include_docs
    ✓ changes-filter with query params
    ✓ Non-live changes filter
    ✓ Non-live changes filter, descending
    ✓ #2569 Non-live doc_ids filter
    ✓ #2569 Big non-live doc_ids filter
    ✓ #2569 Live doc_ids filter
    ✓ #2569 Big live doc_ids filter
    ✓ #2569 Non-live doc_ids filter with filter=_doc_ids
    ✓ #2569 Live doc_ids filter with filter=_doc_ids
    ✓ Changes to same doc are grouped
    ✓ Changes with conflicts are handled correctly (124ms)
    ✓ Change entry for a deleted doc (39ms)
    ✓ changes large number of docs (38ms)
    ✓ Calling db.changes({since: 'now'})
    ✓ Calling db.changes({since: 'latest'})
    ✓ Closing db does not cause a crash if changes cancelled
    ✓ fire-complete-on-cancel (102ms)
    ✓ changes are not duplicated (1021ms)
    ✓ supports return_docs=false
    ✓ should respects limit (72ms)
    ✓ doesn't throw if opts.complete is undefined
    ✓ handle individual changes in live replication (196ms)
    ✓ changes-filter without filter
    ✓ #3539 - Exception in changes is fine
    ✓ Changes with selector
    ✓ Changes with selector, explicit filter
    ✓ Changes with selector and mismatched filter
    ✓ Changes with limit and selector

  test.changes.js-local
    ✓ All changes
    ✓ Changes with complete callback as param
    ✓ Promise resolved when changes cancelled
    - Live changes should clean listener when cancelled
    ✓ Changes Since
    ✓ Changes Since and limit limit 1
    ✓ Changes Since and limit limit 0
    ✓ Changes limit
    ✓ Changes with filter not present in ddoc
    ✓ Changes with `filters` key not present in ddoc
    ✓ Changes limit and filter
    ✓ Changes with shorthand function name
    ✓ Changes with filter from nonexistent ddoc
    ✓ Changes with view not present in ddoc
    ✓ Changes with `views` key not present in ddoc
    ✓ #4451 Changes with invalid view filter
    ✓ 3356 throw inside a filter
    ✓ Changes with missing param `view` in request
    ✓ Changes limit and view instead of filter
    ✓ #3609 view option implies filter: _view
    ✓ Immediately cancel changes
    ✓ Changes with invalid ddoc view name
    ✓ Changes with invalid ddoc view name 2
    ✓ Changes with style = all_docs
    ✓ Changes with style = all_docs and a callback for complete
    ✓ Changes limit = 0
    ✓ Changes doc
    - Descending many changes
    ✓ live-changes
    ✓ Multiple watchers
    ✓ Continuous changes doc
    ✓ Cancel changes (317ms)
    ✓ #3579 changes firing 1 too many times (69ms)
    ✓ Kill database while listening to live changes
    ✓ #3136 style=all_docs
    ✓ #4191 revs_diff causes endless loop
    ✓ #3136 style=all_docs & include_docs
    ✓ changes-filter with query params
    ✓ Non-live changes filter
    ✓ Non-live changes filter, descending
    ✓ #2569 Non-live doc_ids filter
    ✓ #2569 Big non-live doc_ids filter
    ✓ #2569 Live doc_ids filter
    ✓ #2569 Big live doc_ids filter
    ✓ #2569 Non-live doc_ids filter with filter=_doc_ids
    ✓ #2569 Live doc_ids filter with filter=_doc_ids
    ✓ Changes to same doc are grouped
    ✓ Changes with conflicts are handled correctly
    ✓ Change entry for a deleted doc
    ✓ changes large number of docs
    ✓ Calling db.changes({since: 'now'})
    ✓ Calling db.changes({since: 'latest'})
    ✓ Closing db does not cause a crash if changes cancelled
    ✓ fire-complete-on-cancel (100ms)
    ✓ changes are not duplicated (1015ms)
    ✓ supports return_docs=false (41ms)
    ✓ should respects limit (66ms)
    ✓ doesn't throw if opts.complete is undefined
    ✓ handle individual changes in live replication (65ms)
    ✓ changes-filter without filter
    ✓ #3539 - Exception in changes is fine
    ✓ Changes with selector
    ✓ Changes with selector, explicit filter
    ✓ Changes with selector and mismatched filter
    ✓ Changes with limit and selector

  changes-standalone
    - Changes reports errors

  test.close.js-local
    ✓ should emit destroyed even when closed (sync)
    ✓ should emit destroyed even when closed (async)
precondition_failed: Database not open
    at Object.<anonymous> (/data/js-variants/multee/Clients/levelup/pouchdb/packages/node_modules/pouchdb/lib/index.js:614:16)
    at Module._compile (node:internal/modules/cjs/loader:1105:14)
    at Module._extensions..js (node:internal/modules/cjs/loader:1159:10)
    at Module.load (node:internal/modules/cjs/loader:981:32)
    at Module._load (node:internal/modules/cjs/loader:827:12)
    at Module.require (node:internal/modules/cjs/loader:1005:19)
    at require (node:internal/modules/cjs/helpers:102:18)
    at commonUtils.loadPouchDBForNode (/data/js-variants/multee/Clients/levelup/pouchdb/tests/common-utils.js:92:17)
    at commonUtils.loadPouchDB (/data/js-variants/multee/Clients/levelup/pouchdb/tests/common-utils.js:78:39)
    at Object.<anonymous> (/data/js-variants/multee/Clients/levelup/pouchdb/tests/integration/node.setup.js:21:28)
    at Module._compile (node:internal/modules/cjs/loader:1105:14)
    at Module._extensions..js (node:internal/modules/cjs/loader:1159:10)
    at Module.load (node:internal/modules/cjs/loader:981:32)
    at Module._load (node:internal/modules/cjs/loader:827:12)
    at Module.require (node:internal/modules/cjs/loader:1005:19)
    at require (node:internal/modules/cjs/helpers:102:18)
    at /data/js-variants/multee/Clients/levelup/pouchdb/node_modules/mocha/bin/_mocha:366:3
    at Array.forEach (<anonymous>)
    at Object.<anonymous> (/data/js-variants/multee/Clients/levelup/pouchdb/node_modules/mocha/bin/_mocha:365:10)
    at Module._compile (node:internal/modules/cjs/loader:1105:14)
    at Module._extensions..js (node:internal/modules/cjs/loader:1159:10)
    at Module.load (node:internal/modules/cjs/loader:981:32)
    at Module._load (node:internal/modules/cjs/loader:827:12)
    at Function.executeUserEntryPoint [as runMain] (node:internal/modules/run_main:77:12)
    at node:internal/main/run_main_module:17:47
    ✓ should emit closed even when destroyed (async #2)
precondition_failed: Database not open
    at Object.<anonymous> (/data/js-variants/multee/Clients/levelup/pouchdb/packages/node_modules/pouchdb/lib/index.js:614:16)
    at Module._compile (node:internal/modules/cjs/loader:1105:14)
    at Module._extensions..js (node:internal/modules/cjs/loader:1159:10)
    at Module.load (node:internal/modules/cjs/loader:981:32)
    at Module._load (node:internal/modules/cjs/loader:827:12)
    at Module.require (node:internal/modules/cjs/loader:1005:19)
    at require (node:internal/modules/cjs/helpers:102:18)
    at commonUtils.loadPouchDBForNode (/data/js-variants/multee/Clients/levelup/pouchdb/tests/common-utils.js:92:17)
    at commonUtils.loadPouchDB (/data/js-variants/multee/Clients/levelup/pouchdb/tests/common-utils.js:78:39)
    at Object.<anonymous> (/data/js-variants/multee/Clients/levelup/pouchdb/tests/integration/node.setup.js:21:28)
    at Module._compile (node:internal/modules/cjs/loader:1105:14)
    at Module._extensions..js (node:internal/modules/cjs/loader:1159:10)
    at Module.load (node:internal/modules/cjs/loader:981:32)
    at Module._load (node:internal/modules/cjs/loader:827:12)
    at Module.require (node:internal/modules/cjs/loader:1005:19)
    at require (node:internal/modules/cjs/helpers:102:18)
    at /data/js-variants/multee/Clients/levelup/pouchdb/node_modules/mocha/bin/_mocha:366:3
    at Array.forEach (<anonymous>)
    at Object.<anonymous> (/data/js-variants/multee/Clients/levelup/pouchdb/node_modules/mocha/bin/_mocha:365:10)
    at Module._compile (node:internal/modules/cjs/loader:1105:14)
    at Module._extensions..js (node:internal/modules/cjs/loader:1159:10)
    at Module.load (node:internal/modules/cjs/loader:981:32)
    at Module._load (node:internal/modules/cjs/loader:827:12)
    at Function.executeUserEntryPoint [as runMain] (node:internal/modules/run_main:77:12)
    at node:internal/main/run_main_module:17:47
    ✓ test unref for coverage
    ✓ test double unref for coverage
precondition_failed: Database not open
    at Object.<anonymous> (/data/js-variants/multee/Clients/levelup/pouchdb/packages/node_modules/pouchdb/lib/index.js:614:16)
    at Module._compile (node:internal/modules/cjs/loader:1105:14)
    at Module._extensions..js (node:internal/modules/cjs/loader:1159:10)
    at Module.load (node:internal/modules/cjs/loader:981:32)
    at Module._load (node:internal/modules/cjs/loader:827:12)
    at Module.require (node:internal/modules/cjs/loader:1005:19)
    at require (node:internal/modules/cjs/helpers:102:18)
    at commonUtils.loadPouchDBForNode (/data/js-variants/multee/Clients/levelup/pouchdb/tests/common-utils.js:92:17)
    at commonUtils.loadPouchDB (/data/js-variants/multee/Clients/levelup/pouchdb/tests/common-utils.js:78:39)
    at Object.<anonymous> (/data/js-variants/multee/Clients/levelup/pouchdb/tests/integration/node.setup.js:21:28)
    at Module._compile (node:internal/modules/cjs/loader:1105:14)
    at Module._extensions..js (node:internal/modules/cjs/loader:1159:10)
    at Module.load (node:internal/modules/cjs/loader:981:32)
    at Module._load (node:internal/modules/cjs/loader:827:12)
    at Module.require (node:internal/modules/cjs/loader:1005:19)
    at require (node:internal/modules/cjs/helpers:102:18)
    at /data/js-variants/multee/Clients/levelup/pouchdb/node_modules/mocha/bin/_mocha:366:3
    at Array.forEach (<anonymous>)
    at Object.<anonymous> (/data/js-variants/multee/Clients/levelup/pouchdb/node_modules/mocha/bin/_mocha:365:10)
    at Module._compile (node:internal/modules/cjs/loader:1105:14)
    at Module._extensions..js (node:internal/modules/cjs/loader:1159:10)
    at Module.load (node:internal/modules/cjs/loader:981:32)
    at Module._load (node:internal/modules/cjs/loader:827:12)
    at Function.executeUserEntryPoint [as runMain] (node:internal/modules/run_main:77:12)
    at node:internal/main/run_main_module:17:47
    ✓ test close-then-destroyed for coverage
************* run test done *************
pouchdb is testing ./Variants/levelup/variant4/levelup
/data/js-variants/multee
************* npm unlink module *************

removed 1 package, changed 1 package, and audited 1032 packages in 3s

64 packages are looking for funding
  run `npm fund` for details

41 vulnerabilities (1 low, 9 moderate, 25 high, 6 critical)

To address issues that do not require attention, run:
  npm audit fix

To address all issues possible (including breaking changes), run:
  npm audit fix --force

Some issues need review, and may require choosing
a different dependency.

Run `npm audit` for details.
************* npm unlink module done *************
************* npm unlink globally *************

removed 1 package, and audited 1 package in 1s

found 0 vulnerabilities
************* npm unlink globally done *************
************* npm link globally *************

added 1 package, and audited 3 packages in 416ms

found 0 vulnerabilities
************* npm link globally done *************
************* npm link module *************

added 1 package, changed 1 package, and audited 1034 packages in 5s

64 packages are looking for funding
  run `npm fund` for details

41 vulnerabilities (1 low, 9 moderate, 25 high, 6 critical)

To address issues that do not require attention, run:
  npm audit fix

To address all issues possible (including breaking changes), run:
  npm audit fix --force

Some issues need review, and may require choosing
a different dependency.

Run `npm audit` for details.
************* npm link module done *************
************* start run test *************

> pouchdb-monorepo@7.0.0-prerelease test
> bash bin/run-test.sh


> pouchdb-monorepo@7.0.0-prerelease build-node
> bash bin/build-node.sh


> pouchdb-monorepo@7.0.0-prerelease build-modules
> node bin/build-modules.js

Building pouchdb...
Building pouchdb-abstract-mapreduce...
Building pouchdb-adapter-http...
Building pouchdb-adapter-idb...
Building pouchdb-adapter-indexeddb...
Building pouchdb-adapter-leveldb...
Building pouchdb-adapter-leveldb-core...
Building pouchdb-adapter-localstorage...
Building pouchdb-adapter-memory...
Building pouchdb-adapter-utils...
Building pouchdb-binary-utils...
Building pouchdb-browser...
Building pouchdb-changes-filter...
Building pouchdb-checkpointer...
Building pouchdb-collate...
Building pouchdb-collections...
Building pouchdb-core...
Building pouchdb-errors...
Building pouchdb-fetch...
Building pouchdb-find...
Building pouchdb-for-coverage...
Building pouchdb-generate-replication-id...
Building pouchdb-json...
Building pouchdb-mapreduce...
Building pouchdb-mapreduce-utils...
Building pouchdb-md5...
Building pouchdb-merge...
Building pouchdb-node...
Building pouchdb-replication...
Building pouchdb-selector-core...
Building pouchdb-utils...
Building sublevel-pouchdb...
  ✓ wrote pouchdb-adapter-localstorage/lib/index.js in vanilla mode
  ✓ wrote pouchdb-adapter-localstorage/lib/index.es.js in vanilla mode
  ✓ wrote pouchdb-adapter-memory/lib/index.js in vanilla mode
  ✓ wrote pouchdb-adapter-memory/lib/index.es.js in vanilla mode
  ✓ wrote pouchdb-checkpointer/lib/index.js in vanilla mode
  ✓ wrote pouchdb-checkpointer/lib/index.es.js in vanilla mode
  ✓ wrote pouchdb-errors/lib/index.js in vanilla mode
  ✓ wrote pouchdb-errors/lib/index.es.js in vanilla mode
  ✓ wrote pouchdb-generate-replication-id/lib/index.js in vanilla mode
  ✓ wrote pouchdb-generate-replication-id/lib/index.es.js in vanilla mode
  ✓ wrote pouchdb-adapter-http/lib/index.js in vanilla mode
  ✓ wrote pouchdb-adapter-http/lib/index.es.js in vanilla mode
  ✓ wrote pouchdb-adapter-leveldb-core/lib/index.js in node mode
  ✓ wrote pouchdb-adapter-leveldb-core/lib/index.es.js in node mode
  ✓ wrote pouchdb-adapter-leveldb-core/lib/index-browser.js in browser mode
  ✓ wrote pouchdb-adapter-leveldb-core/lib/index-browser.es.js in browser mode
  ✓ wrote pouchdb-adapter-leveldb/lib/index.js in node mode
  ✓ wrote pouchdb-adapter-leveldb/lib/index.es.js in node mode
  ✓ wrote pouchdb-adapter-leveldb/lib/index-browser.js in browser mode
  ✓ wrote pouchdb-adapter-leveldb/lib/index-browser.es.js in browser mode
  ✓ wrote pouchdb-changes-filter/lib/index-browser.js in browser mode
  ✓ wrote pouchdb-changes-filter/lib/index-browser.es.js in browser mode
  ✓ wrote pouchdb-fetch/lib/index-browser.js in browser mode
  ✓ wrote pouchdb-fetch/lib/index-browser.es.js in browser mode
  ✓ wrote pouchdb-md5/lib/index-browser.js in browser mode
  ✓ wrote pouchdb-md5/lib/index-browser.es.js in browser mode
  ✓ wrote pouchdb-changes-filter/lib/index.js in node mode
  ✓ wrote pouchdb-changes-filter/lib/index.es.js in node mode
  ✓ wrote pouchdb-collate/lib/index.js in vanilla mode
  ✓ wrote pouchdb-collate/lib/index.es.js in vanilla mode
  ✓ wrote pouchdb-fetch/lib/index.js in node mode
  ✓ wrote pouchdb-fetch/lib/index.es.js in node mode
  ✓ wrote pouchdb-json/lib/index.js in vanilla mode
  ✓ wrote pouchdb-json/lib/index.es.js in vanilla mode
  ✓ wrote pouchdb-mapreduce-utils/lib/index.js in vanilla mode
  ✓ wrote pouchdb-mapreduce-utils/lib/index.es.js in vanilla mode
  ✓ wrote pouchdb-md5/lib/index.js in node mode
  ✓ wrote pouchdb-md5/lib/index.es.js in node mode
  ✓ wrote pouchdb-abstract-mapreduce/lib/index.js in vanilla mode
  ✓ wrote pouchdb-abstract-mapreduce/lib/index.es.js in vanilla mode
  ✓ wrote pouchdb-adapter-indexeddb/lib/index.js in vanilla mode
  ✓ wrote pouchdb-adapter-indexeddb/lib/index.es.js in vanilla mode
  ✓ wrote pouchdb-adapter-idb/lib/index.js in vanilla mode
  ✓ wrote pouchdb-adapter-idb/lib/index.es.js in vanilla mode
  ✓ wrote pouchdb-binary-utils/lib/index-browser.js in browser mode
  ✓ wrote pouchdb-binary-utils/lib/index-browser.es.js in browser mode
  ✓ wrote pouchdb-utils/lib/index-browser.js in browser mode
  ✓ wrote pouchdb-utils/lib/index-browser.es.js in browser mode
  ✓ wrote pouchdb-utils/lib/index.js in node mode
  ✓ wrote pouchdb-utils/lib/index.es.js in node mode
  ✓ wrote pouchdb-binary-utils/lib/index.js in node mode
  ✓ wrote pouchdb-binary-utils/lib/index.es.js in node mode
  ✓ wrote pouchdb-adapter-utils/lib/index.js in vanilla mode
  ✓ wrote pouchdb-adapter-utils/lib/index.es.js in vanilla mode
  ✓ wrote pouchdb-collections/lib/index.js in vanilla mode
  ✓ wrote pouchdb-collections/lib/index.es.js in vanilla mode
  ✓ wrote pouchdb-merge/lib/index.js in vanilla mode
  ✓ wrote pouchdb-merge/lib/index.es.js in vanilla mode
  ✓ wrote pouchdb-selector-core/lib/index.js in vanilla mode
  ✓ wrote pouchdb-selector-core/lib/index.es.js in vanilla mode
  ✓ wrote sublevel-pouchdb/lib/index.js in vanilla mode
  ✓ wrote sublevel-pouchdb/lib/index.es.js in vanilla mode
  ✓ wrote pouchdb-mapreduce/lib/index-browser.js in browser mode
  ✓ wrote pouchdb-mapreduce/lib/index-browser.es.js in browser mode
  ✓ wrote pouchdb-replication/lib/index.js in vanilla mode
  ✓ wrote pouchdb-replication/lib/index.es.js in vanilla mode
  ✓ wrote pouchdb-mapreduce/lib/index.js in node mode
  ✓ wrote pouchdb-mapreduce/lib/index.es.js in node mode
  ✓ wrote pouchdb-core/lib/index.js in vanilla mode
  ✓ wrote pouchdb-core/lib/index.es.js in vanilla mode
  ✓ wrote pouchdb-find/lib/index.js in node mode
  ✓ wrote pouchdb-find/lib/index.es.js in node mode
  ✓ wrote pouchdb-find/lib/index-browser.js in browser mode
  ✓ wrote pouchdb-find/lib/index-browser.es.js in browser mode
  ✓ wrote pouchdb-for-coverage/lib/index.js in node mode
  ✓ wrote pouchdb-for-coverage/lib/index-browser.js in browser mode
  ✓ wrote pouchdb-for-coverage/lib/index.es.js in node mode
  ✓ wrote pouchdb-for-coverage/lib/index-browser.es.js in browser mode
  ✓ wrote pouchdb-browser/lib/index.js in vanilla mode
  ✓ wrote pouchdb-browser/lib/index.es.js in vanilla mode
  ✓ wrote pouchdb-node/lib/index.js in vanilla mode
  ✓ wrote pouchdb-node/lib/index.es.js in vanilla mode
  ✓ wrote packages/node_modules/pouchdb/lib/index.js
  ✓ wrote packages/node_modules/pouchdb/lib/index.es.js
Waiting for host to start ..
Host started :)
> pouchdb-monorepo@7.0.0-prerelease test-node
> bash bin/test-node.sh

Down server listening on port 3010
Seeded with: 1660143235421


  DB Setup
    ✓ PouchDB has a version
    ✓ PouchDB version matches package.json

  test.active_tasks.js
    ✓ Can add a task
    ✓ Can get tasks by id
    ✓ Can get all tasks
    ✓ Can update a task
    ✓ Can remove a task

  test.all_docs.js-http
    ✓ Testing all docs (148ms)
    ✓ Testing allDocs opts.keys (64ms)
    ✓ Testing allDocs opts.keys with skip
    ✓ Testing allDocs opts.keys with limit
    ✓ Testing allDocs invalid opts.keys
    ✓ Testing deleting in changes (46ms)
    ✓ Testing updating in changes (47ms)
    ✓ Testing include docs
    ✓ Testing conflicts (47ms)
    ✓ test basic collation
    ✓ 3883 start_key end_key aliases
    ✓ test total_rows with a variety of criteria (114ms)
    ✓ test total_rows with both skip and limit (42ms)
    ✓ test limit option and total_rows
    ✓ test escaped startkey/endkey
    ✓ test "key" option
    ✓ test inclusive_end=false (70ms)
    ✓ test descending with startkey/endkey (63ms)
    ✓ #3082 test wrong num results returned (263ms)
    ✓ test empty db
    ✓ test after db close
    ✓ 5793 _conflicts should not exist if no conflicts
    ✓ #6230 Test allDocs opts update_seq: false
    ✓ #6230 Test allDocs opts update_seq: true
    ✓ #6230 Test allDocs opts with update_seq missing

  test.all_docs.js-local
    ✓ Testing all docs
    ✓ Testing allDocs opts.keys
    ✓ Testing allDocs opts.keys with skip
    ✓ Testing allDocs opts.keys with limit
    ✓ Testing allDocs invalid opts.keys
    ✓ Testing deleting in changes
    ✓ Testing updating in changes
    ✓ Testing include docs
    ✓ Testing conflicts
    ✓ test basic collation
    ✓ 3883 start_key end_key aliases
    ✓ test total_rows with a variety of criteria
    ✓ test total_rows with both skip and limit
    ✓ test limit option and total_rows
    ✓ test escaped startkey/endkey
    ✓ test "key" option
    ✓ test inclusive_end=false
    ✓ test descending with startkey/endkey
    ✓ #3082 test wrong num results returned (205ms)
    ✓ test empty db
    ✓ test after db close
    ✓ test unicode ids and revs
    ✓ 5793 _conflicts should not exist if no conflicts
    ✓ #6230 Test allDocs opts update_seq: false
    ✓ #6230 Test allDocs opts update_seq: true
    ✓ #6230 Test allDocs opts with update_seq missing

  suite2 test.attachments.js-local
    ✓ 3357 Attachment names cant start with _
    ✓ 5736 warning for putAttachment without content_type
    ✓ 5736 warning for bulkDocs attachments without content_type
    ✓ fetch atts with open_revs and missing
    ✓ issue 2803 should throw 412
    ✓ issue 2803 should throw 412 part 2
    ✓ issue 2803 should throw 412 part 3
    ✓ issue 2803 should throw 412 part 4
    ✓ #2858 {binary: true} in get()
    ✓ #2858 {binary: true} in allDocs() 1
    ✓ #2858 {binary: true} in allDocs() 2
    ✓ #2858 {binary: true} in allDocs() 3
    ✓ #2858 {binary: true} in allDocs() 4
    ✓ #2858 {binary: true} in allDocs() 5
    ✓ #2858 {binary: true} in allDocs(), many atts
    ✓ #2858 {binary: true} in allDocs(), mixed atts
    ✓ #2858 {binary: true} in changes() non-live
    ✓ #2858 {binary: true} in changes() non-live, many atts
    ✓ #2858 {binary: true} in changes() non-live, mixed atts
    ✓ #2858 {binary: true} non-live changes, complete event
    ✓ #2858 {binary: true} in live changes
    ✓ #2858 {binary: true} in live changes, mixed atts
    ✓ #2858 {binary: true} in live+retry changes
    ✓ #2858 {binary: true} in live changes, attachments:false
    ✓ #2858 {binary: true} in live changes, include_docs:false
    ✓ #6736 {binary: true} in bulkGet()
    ✓ Measures length correctly after put()
    ✓ #3074 non-live changes()
    ✓ #3074 live changes()
    ✓ #3074 non-live changes(), no attachments
    ✓ #3074 live changes(), no attachments
    ✓ #3881 filter extraneous keys from _attachments
    ✓ #2771 allDocs() 1, single attachment
    ✓ #2771 allDocs() 2, many docs same att
    ✓ #2771 allDocs() 3, many docs diff atts
    ✓ #2771 allDocs() 4, mix of atts and no atts
    ✓ #2771 allDocs() 5, no atts
    ✓ #2771 allDocs() 6, no docs
    ✓ #2771 allDocs() 7, revisions and deletions
    ✓ #2771 allDocs() 8, empty attachment
    ✓ No length for non-stubs
    ✓ Test some attachments
    ✓ Test getAttachment
    ✓ Test getAttachment with stubs
    ✓ Test get() with binary:true and stubs
    ✓ Test attachments in allDocs/changes
    ✓ Test putAttachment with base64 plaintext
    ✓ Test putAttachment with invalid base64
    ✓ Test getAttachment with empty text
    ✓ Test getAttachment with normal text
    ✓ Test getAttachment with PNG
    ✓ Test getAttachment with PNG using bulkDocs
    ✓ Test getAttachment with PNG using post
    ✓ Test postAttachment with PNG then bulkDocs
    ✓ proper stub behavior
    ✓ Testing with invalid docs
    ✓ Test create attachment and doc in one go
    ✓ Test create attachment and doc in one go without callback
    ✓ Test create attachment without callback
    ✓ Test put attachment on a doc without attachments
    ✓ Test put attachment with unencoded name
    ✓ 3963 length property on stubs
    ✓ Testing with invalid rev
    ✓ Test put another attachment on a doc with attachments
    ✓ Test get with attachments: true if empty attachments
    ✓ Test delete attachment from a doc
    ✓ Test a document with a json string attachment
    ✓ Test remove doc with attachment
    ✓ Try to insert a doc with unencoded attachment
    ✓ Try to get attachment of unexistent doc
    ✓ Test synchronous putAttachment with text data
    ✓ Test synchronous putAttachment with no text data
    ✓ Test put with partial stubs
    ✓ Test put with attachments and new_edits=false
    ✓ Test getAttachment with specific rev
    ✓ Test getAttachment with diff revs and content
    ✓ Test stubs
    ✓ Try to get unexistent attachment of some doc
    ✓ putAttachment and getAttachment with plaintext
    ✓ putAttachment and getAttachment with png data
    ✓ putAttachment in new doc with base64
    ✓ #2818 - save same attachment in different revs
    ✓ #2818 - save same attachment many times in parallel
    ✓ #2818 - revisions keep attachments (no compaction)
    ✓ #2818 - doesn't throw 409 if same filename
    ✓ #3008 test correct encoding/decoding of \u0000 etc.
    ✓ putAttachment and getAttachment with big png data (89ms)
    ✓ #2709 `revpos` with putAttachment
    ✓ #2709 `revpos` with inline attachment
    ✓ #2709 `revpos` with allDocs
    ✓ #7403 {attachments: true, binary: true, include_docs: true} in allDocs with one missing doc

  suite2 test.attachments.js-http
    ✓ 3357 Attachment names cant start with _
    ✓ 5736 warning for putAttachment without content_type
    ✓ 5736 warning for bulkDocs attachments without content_type
    ✓ fetch atts with open_revs and missing
    ✓ issue 2803 should throw 412
    ✓ issue 2803 should throw 412 part 2
    ✓ issue 2803 should throw 412 part 3
    ✓ issue 2803 should throw 412 part 4
    ✓ #2858 {binary: true} in get()
    ✓ #2858 {binary: true} in allDocs() 1
    ✓ #2858 {binary: true} in allDocs() 2
    ✓ #2858 {binary: true} in allDocs() 3
    ✓ #2858 {binary: true} in allDocs() 4
    ✓ #2858 {binary: true} in allDocs() 5
    ✓ #2858 {binary: true} in allDocs(), many atts
    ✓ #2858 {binary: true} in allDocs(), mixed atts
    ✓ #2858 {binary: true} in changes() non-live
    ✓ #2858 {binary: true} in changes() non-live, many atts
    ✓ #2858 {binary: true} in changes() non-live, mixed atts
    ✓ #2858 {binary: true} non-live changes, complete event
    ✓ #2858 {binary: true} in live changes
    ✓ #2858 {binary: true} in live changes, mixed atts
    ✓ #2858 {binary: true} in live+retry changes
    ✓ #2858 {binary: true} in live changes, attachments:false
    ✓ #2858 {binary: true} in live changes, include_docs:false
    ✓ #6736 {binary: true} in bulkGet()
    ✓ Measures length correctly after put()
    ✓ #3074 non-live changes()
    ✓ #3074 live changes()
    ✓ #3074 non-live changes(), no attachments
    ✓ #3074 live changes(), no attachments
    ✓ #3881 filter extraneous keys from _attachments
    ✓ #2771 allDocs() 1, single attachment
    ✓ #2771 allDocs() 2, many docs same att
    ✓ #2771 allDocs() 3, many docs diff atts
    ✓ #2771 allDocs() 4, mix of atts and no atts
    ✓ #2771 allDocs() 5, no atts
    ✓ #2771 allDocs() 6, no docs
    ✓ #2771 allDocs() 7, revisions and deletions
    ✓ #2771 allDocs() 8, empty attachment
    ✓ No length for non-stubs (56ms)
    ✓ Test some attachments (50ms)
    ✓ Test getAttachment
    ✓ Test getAttachment with stubs (46ms)
    ✓ Test get() with binary:true and stubs
    ✓ Test attachments in allDocs/changes
    ✓ Test putAttachment with base64 plaintext
    ✓ Test putAttachment with invalid base64
    ✓ Test getAttachment with empty text
    ✓ Test getAttachment with normal text
    ✓ Test getAttachment with PNG
    ✓ Test getAttachment with PNG using bulkDocs
    ✓ Test getAttachment with PNG using post
    ✓ Test postAttachment with PNG then bulkDocs
    ✓ proper stub behavior
    ✓ Testing with invalid docs
    ✓ Test create attachment and doc in one go
    ✓ Test create attachment and doc in one go without callback (41ms)
    ✓ Test create attachment without callback
    ✓ Test put attachment on a doc without attachments
    ✓ Test put attachment with unencoded name
    ✓ 3963 length property on stubs (46ms)
    ✓ Testing with invalid rev
    ✓ Test put another attachment on a doc with attachments
    ✓ Test get with attachments: true if empty attachments
    ✓ Test delete attachment from a doc (38ms)
    ✓ Test a document with a json string attachment
    ✓ Test remove doc with attachment
    ✓ Try to insert a doc with unencoded attachment
    ✓ Try to get attachment of unexistent doc
    ✓ Test synchronous putAttachment with text data (39ms)
    ✓ Test synchronous putAttachment with no text data
    ✓ Test put with partial stubs
    ✓ Test put with attachments and new_edits=false
    ✓ Test getAttachment with specific rev (43ms)
    ✓ Test getAttachment with diff revs and content
    ✓ Test stubs
    ✓ Try to get unexistent attachment of some doc
    ✓ putAttachment and getAttachment with plaintext
    ✓ putAttachment and getAttachment with png data
    ✓ putAttachment in new doc with base64
    ✓ #2818 - save same attachment in different revs (45ms)
    ✓ #2818 - save same attachment many times in parallel
    ✓ #2818 - revisions keep attachments (no compaction)
    ✓ #2818 - doesn't throw 409 if same filename
    ✓ #3008 test correct encoding/decoding of \u0000 etc.
    ✓ putAttachment and getAttachment with big png data (138ms)
    ✓ #2709 `revpos` with putAttachment (41ms)
    ✓ #2709 `revpos` with inline attachment (43ms)
    ✓ #2709 `revpos` with allDocs
    ✓ #7403 {attachments: true, binary: true, include_docs: true} in allDocs with one missing doc

  suite2 test.attachments.js- local:http
    ✓ Attachments replicate back and forth (114ms)
    ✓ Replicate same doc, same atts (116ms)
    ✓ Replicate same doc, same atts 2 (109ms)
    ✓ Attachments replicate (124ms)
    ✓ Attachment types replicate (48ms)
    ✓ Many many attachments replicate (186ms)
    ✓ Many many png attachments replicate (195ms)
    ✓ Multiple attachments replicate (77ms)
    - #3961 Many attachments on same doc
    ✓ Multiple attachments replicate, different docs (#2698) (76ms)
    ✓ Multiple attachments replicate, different docs png (#2698) (66ms)
    ✓ #3932 attachments with tricky revpos (129ms)
    ✓ replication with changing attachments (100ms)
    ✓ 3955 race condition in put
    ✓ #8456 bad attachment rev after replication (110ms)

  suite2 test.attachments.js- http:http
    ✓ Attachments replicate back and forth (164ms)
    ✓ Replicate same doc, same atts (176ms)
    ✓ Replicate same doc, same atts 2 (172ms)
    ✓ Attachments replicate (75ms)
    ✓ Attachment types replicate (139ms)
    ✓ Many many attachments replicate (348ms)
    ✓ Many many png attachments replicate (286ms)
    ✓ Multiple attachments replicate (128ms)
    - #3961 Many attachments on same doc
    ✓ Multiple attachments replicate, different docs (#2698) (123ms)
    ✓ Multiple attachments replicate, different docs png (#2698) (118ms)
    ✓ #3932 attachments with tricky revpos (218ms)
    ✓ replication with changing attachments (148ms)
    ✓ 3955 race condition in put
    ✓ #8456 bad attachment rev after replication (165ms)

  suite2 test.attachments.js- http:local
    ✓ Attachments replicate back and forth (105ms)
    ✓ Replicate same doc, same atts (116ms)
    ✓ Replicate same doc, same atts 2 (121ms)
    ✓ Attachments replicate (63ms)
    ✓ Attachment types replicate (54ms)
    ✓ Many many attachments replicate (148ms)
    ✓ Many many png attachments replicate (160ms)
    ✓ Multiple attachments replicate (83ms)
    - #3961 Many attachments on same doc
    ✓ Multiple attachments replicate, different docs (#2698) (67ms)
    ✓ Multiple attachments replicate, different docs png (#2698) (90ms)
    ✓ #3932 attachments with tricky revpos (140ms)
    ✓ replication with changing attachments (89ms)
    ✓ 3955 race condition in put
    ✓ #8456 bad attachment rev after replication (108ms)

  suite2 test.attachments.js- local:local
    ✓ Attachments replicate back and forth
    ✓ Replicate same doc, same atts
    ✓ Replicate same doc, same atts 2
    ✓ Attachments replicate
    ✓ Attachment types replicate
    ✓ Many many attachments replicate
    ✓ Many many png attachments replicate (44ms)
    ✓ Multiple attachments replicate
    - #3961 Many attachments on same doc
    ✓ Multiple attachments replicate, different docs (#2698)
    ✓ Multiple attachments replicate, different docs png (#2698)
    ✓ #3932 attachments with tricky revpos
    ✓ replication with changing attachments
    ✓ 3955 race condition in put (45ms)
    ✓ #8456 bad attachment rev after replication (40ms)

  test.basics.js-http
    ✓ Create a pouch without new keyword
    ✓ Name is accessible via instance
    ✓ 4314 Create a pouch with + in name
    ✓ Creating Pouch without name will throw
    ✓ 4314 Create a pouch with urlencoded name
    ✓ 4219 destroy a pouch
    ✓ 4339 throw useful error if method called on stale instance
    ✓ [4595] should reject xhr errors
    ✓ [4595] should emit error event on xhr error
    ✓ Add a doc
    ✓ Get invalid id
    ✓ Missing doc should contain ID in error object
    ✓ PUTed Conflicted doc should contain ID in error object
    ✓ POSTed Conflicted doc should contain ID in error object
    ✓ Add a doc with a promise
    ✓ Add a doc with opts object
    ✓ Modify a doc
    ✓ Modifying a doc that has rewritten content
    ✓ Modify a doc with a promise
    ✓ Read db id
    ✓ Read db id with promise
    ✓ Close db
    ✓ Close db with a promise
    ✓ Read db id after closing Close
    ✓ Modify a doc with incorrect rev
    ✓ Remove doc
    ✓ Remove doc with a promise
    ✓ Remove doc with new syntax
    ✓ Remove doc with new syntax and a promise
    ✓ Doc removal leaves only stub
    ✓ Remove doc twice with specified id
    ✓ Remove doc, no callback
    ✓ Delete document without id
    ✓ Delete document with many args
    ✓ Delete document with many args, callback style
    ✓ Delete doc with id + rev + no opts
    ✓ Delete doc with id + rev + no opts, callback style
    ✓ Delete doc with doc + opts
    ✓ Delete doc with doc + opts, callback style
    ✓ Delete doc with rev in opts
    ✓ Bulk docs
    ✓ Bulk docs with a promise
    ✓ Basic checks
    ✓ update with invalid rev
    ✓ Doc validation
    ✓ Replication fields (#2442)
    ✓ Testing issue #48 (54ms)
    ✓ Testing valid id
    ✓ Put doc without _id should fail
    ✓ Put doc with bad reserved id should fail
    ✓ update_seq persists
    ✓ deletions persists (69ms)
    ✓ #4126 should not store raw Dates
    ✓ Create a db with a reserved name
    ✓ Error when document is not an object
    ✓ Test instance update_seq updates correctly
    ✓ Fail to fetch a doc after db was deleted (49ms)
    ✓ Fail to fetch a doc after db was deleted (47ms)
    ✓ Cant add docs with empty ids
    ✓ Test doc with percent in ID
    ✓ db.info should give auto_compaction = false (#2744)
    ✓ db.info should give auto_compaction = true (#2744)
    ✓ db.info should give adapter name (#3567)
    ✓ db.info should give correct doc_count
    ✓ putting returns {ok: true}
    ✓ putting is override-able
    ✓ issue 2779, deleted docs, old revs COUCHDB-292
    ✓ issue 2888, successive deletes and writes
    ✓ 2 invalid puts
    ✓ Docs save "null" value
    ✓ replace PouchDB.destroy() (express-pouchdb#203)
    ✓ 3968, keeps all object fields
    ✓ 4712 invalid rev for new doc generates conflict
    ✓ test info() after db close
    ✓ test get() after db close
    ✓ test close() after db close
    ✓ 7259 should have "this" keyword properly scoped
    ✓ #5471 PouchDB.plugin() should throw error if passed wrong type or empty object

  test.basics.js-local
    ✓ Create a pouch without new keyword
    ✓ Name is accessible via instance
    ✓ 4314 Create a pouch with + in name
    ✓ Creating Pouch without name will throw
    ✓ 4314 Create a pouch with urlencoded name
    ✓ 4219 destroy a pouch
    ✓ 4339 throw useful error if method called on stale instance
    ✓ [4595] should reject xhr errors
    ✓ [4595] should emit error event on xhr error
    ✓ Add a doc
    ✓ Get invalid id
    ✓ Missing doc should contain ID in error object
    ✓ PUTed Conflicted doc should contain ID in error object
    ✓ POSTed Conflicted doc should contain ID in error object
    ✓ Add a doc with a promise
    ✓ Add a doc with opts object
    ✓ Modify a doc
    ✓ Modifying a doc that has rewritten content
    ✓ Modify a doc with a promise
    ✓ Read db id
    ✓ Read db id with promise
    ✓ Close db
    ✓ Close db with a promise
    ✓ Read db id after closing Close
    ✓ Modify a doc with incorrect rev
    ✓ Remove doc
    ✓ Remove doc with a promise
    ✓ Remove doc with new syntax
    ✓ Remove doc with new syntax and a promise
    ✓ Doc removal leaves only stub
    ✓ Remove doc twice with specified id
    ✓ Remove doc, no callback
    ✓ Delete document without id
    ✓ Delete document with many args
    ✓ Delete document with many args, callback style
    ✓ Delete doc with id + rev + no opts
    ✓ Delete doc with id + rev + no opts, callback style
    ✓ Delete doc with doc + opts
    ✓ Delete doc with doc + opts, callback style
    ✓ Delete doc with rev in opts
    ✓ Bulk docs
    ✓ Bulk docs with a promise
    ✓ Basic checks
    ✓ update with invalid rev
    ✓ Doc validation
    ✓ Replication fields (#2442)
    ✓ Allows _access field in documents (#8171)
    ✓ Testing issue #48 (51ms)
    ✓ Testing valid id
    ✓ Put doc without _id should fail
    ✓ Put doc with bad reserved id should fail
    ✓ update_seq persists
    ✓ deletions persists
    ✓ #4126 should not store raw Dates
    ✓ Create a db with a reserved name
    ✓ Error when document is not an object
    ✓ Test instance update_seq updates correctly
    ✓ Fail to fetch a doc after db was deleted (38ms)
    ✓ Fail to fetch a doc after db was deleted
    ✓ Cant add docs with empty ids
    ✓ Test doc with percent in ID
    ✓ db.info should give auto_compaction = false (#2744)
    ✓ db.info should give auto_compaction = true (#2744)
    ✓ db.info should give adapter name (#3567)
    ✓ db.info should give correct doc_count
    ✓ putting returns {ok: true}
    ✓ putting is override-able
    ✓ issue 2779, deleted docs, old revs COUCHDB-292
    ✓ issue 2888, successive deletes and writes
    ✓ 2 invalid puts
    ✓ Docs save "null" value
    ✓ replace PouchDB.destroy() (express-pouchdb#203)
    ✓ 3968, keeps all object fields
    ✓ 4712 invalid rev for new doc generates conflict
    ✓ test info() after db close
    ✓ test get() after db close
    ✓ test close() after db close
    ✓ 7259 should have "this" keyword properly scoped
    ✓ should allow unicode doc ids
    ✓ should have same blob support for 2 dbs
    ✓ 6053, PouchDB.plugin() resets defaults
    ✓ #5471 PouchDB.plugin() should throw error if passed wrong type or empty object

  test.bulk_docs.js-local
    ✓ Testing bulk docs
    ✓ #6039 test id in bulk docs for conflict
    ✓ No id in bulk docs
    ✓ No _rev and new_edits=false
    ✓ 7829 bare rev 1- with new_edits=false
    ✓ Test empty bulkDocs
    ✓ Test many bulkDocs
    ✓ Test errors on invalid doc id
    ✓ Test two errors on invalid doc id
    ✓ No docs
    ✓ Jira 911
    ✓ Test multiple bulkdocs
    ✓ #2935 new_edits=false correct number
    ✓ #2935 new_edits=false correct number 2
    ✓ bulk docs update then delete then conflict
    ✓ bulk_docs delete then undelete
    ✓ #2935 new_edits=false with single unauthorized
    ✓ Deleting _local docs with bulkDocs
    ✓ Deleting _local docs with bulkDocs, not found
    ✓ Deleting _local docs with bulkDocs, wrong rev
    ✓ Bulk with new_edits=false
    ✓ Testing successive new_edits to the same doc
    ✓ #3062 bulkDocs with staggered seqs
    ✓ Testing successive new_edits to the same doc, different content
    ✓ Testing successive new_edits to two doc
    ✓ Deletion with new_edits=false
    ✓ Deletion with new_edits=false, no history
    ✓ Modification with new_edits=false, no history
    ✓ Deletion with new_edits=false, no history, no revisions
    ✓ Testing new_edits=false in req body
    ✓ 656 regression in handling deleted docs
    ✓ Test quotes in doc ids
    ✓ Bulk docs empty list
    ✓ handles simultaneous writes
    ✓ bulk docs input by array
    ✓ Bulk empty list
    ✓ Bulk docs not an array
    ✓ Bulk docs not an object
    ✓ Bulk docs two different revisions to same document id
    ✓ 4204 respect revs_limit (265ms)
    ✓ 2839 implement revs_limit (177ms)
    ✓ 4372 revs_limit deletes old revisions of the doc
    ✓ 4372 revs_limit with auto_compaction deletes old revisions of the doc
    ✓ 4712 invalid rev for new doc generates conflict
    ✓ 5793 bulk docs accepts _conflicts when new_edits=false

  test.bulk_docs.js-http
    ✓ Testing bulk docs
    ✓ #6039 test id in bulk docs for conflict
    ✓ No id in bulk docs
    ✓ No _rev and new_edits=false
    ✓ 7829 bare rev 1- with new_edits=false
    ✓ Test empty bulkDocs
    ✓ Test many bulkDocs (39ms)
    ✓ Test errors on invalid doc id
    ✓ Test two errors on invalid doc id
    ✓ No docs
    ✓ Jira 911
    ✓ Test multiple bulkdocs
    ✓ #2935 new_edits=false correct number
    ✓ #2935 new_edits=false correct number 2
    ✓ bulk docs update then delete then conflict
    ✓ bulk_docs delete then undelete
    ✓ #2935 new_edits=false with single unauthorized
    ✓ Deleting _local docs with bulkDocs (39ms)
    ✓ Bulk with new_edits=false
    ✓ Testing successive new_edits to the same doc
    ✓ #3062 bulkDocs with staggered seqs
    ✓ Testing successive new_edits to the same doc, different content
    ✓ Testing successive new_edits to two doc
    ✓ Deletion with new_edits=false
    ✓ Deletion with new_edits=false, no history
    ✓ Modification with new_edits=false, no history
    ✓ Deletion with new_edits=false, no history, no revisions
    ✓ Testing new_edits=false in req body
    ✓ 656 regression in handling deleted docs
    ✓ Test quotes in doc ids
    ✓ Bulk docs empty list
    ✓ handles simultaneous writes
    ✓ bulk docs input by array
    ✓ Bulk empty list
    ✓ Bulk docs not an array
    ✓ Bulk docs not an object
    ✓ Bulk docs two different revisions to same document id
    ✓ 4204 respect revs_limit (261ms)
    ✓ 2839 implement revs_limit
    ✓ 4372 revs_limit deletes old revisions of the doc
    ✓ 4372 revs_limit with auto_compaction deletes old revisions of the doc
    ✓ 4712 invalid rev for new doc generates conflict
    ✓ 5793 bulk docs accepts _conflicts when new_edits=false (42ms)

  test.bulk_get.js-http
    ✓ test bulk get with rev specified
    ✓ test bulk get with latest=true
    ✓ test bulk get with no rev specified
    ✓ _revisions is not returned by default
    ✓ #5886 bulkGet with reserved id
    ✓ _revisions is returned when specified
    ✓ _revisions is returned when specified, using implicit rev
    ✓ attachments are not included by default
    ✓ attachments are included when specified
    ✓ attachments are included when specified, using implicit rev

  test.bulk_get.js-local
    ✓ test bulk get with rev specified
    ✓ test bulk get with latest=true
    ✓ test bulk get with no rev specified
    ✓ _revisions is not returned by default
    ✓ #5886 bulkGet with reserved id
    ✓ _revisions is returned when specified
    ✓ _revisions is returned when specified, using implicit rev
    ✓ attachments are not included by default
    ✓ attachments are included when specified
    ✓ attachments are included when specified, using implicit rev

  test.changes.js-http
    ✓ All changes
    ✓ Changes with complete callback as param
    ✓ Promise resolved when changes cancelled
    - Live changes should clean listener when cancelled
    ✓ Changes Since
    ✓ Changes Since and limit limit 1
    ✓ Changes Since and limit limit 0
    ✓ Changes limit
    ✓ Changes with filter not present in ddoc
    ✓ Changes with `filters` key not present in ddoc
    ✓ Changes limit and filter
    ✓ Changes with shorthand function name
    ✓ Changes with filter from nonexistent ddoc
    ✓ Changes with view not present in ddoc
    ✓ Changes with `views` key not present in ddoc
    ✓ #4451 Changes with invalid view filter
    ✓ 3356 throw inside a filter
    ✓ Changes with missing param `view` in request
    ✓ Changes limit and view instead of filter
    ✓ #3609 view option implies filter: _view
    ✓ Immediately cancel changes
    ✓ Changes with invalid ddoc view name
    ✓ Changes with invalid ddoc view name 2
    ✓ Changes with style = all_docs (66ms)
    ✓ Changes with style = all_docs and a callback for complete (56ms)
    ✓ Changes limit = 0
    ✓ Changes doc
    - Descending many changes
    ✓ live-changes
    ✓ Multiple watchers
    ✓ Continuous changes doc
    ✓ Cancel changes (325ms)
    ✓ #3579 changes firing 1 too many times (71ms)
    ✓ Kill database while listening to live changes
    ✓ #3136 style=all_docs (62ms)
    ✓ #4191 revs_diff causes endless loop
    ✓ #3136 style=all_docs & include_docs
    ✓ changes-filter with query params
    ✓ Non-live changes filter
    ✓ Non-live changes filter, descending
    ✓ #2569 Non-live doc_ids filter
    ✓ #2569 Big non-live doc_ids filter
    ✓ #2569 Live doc_ids filter
    ✓ #2569 Big live doc_ids filter
    ✓ #2569 Non-live doc_ids filter with filter=_doc_ids
    ✓ #2569 Live doc_ids filter with filter=_doc_ids
    ✓ Changes to same doc are grouped
    ✓ Changes with conflicts are handled correctly (124ms)
    ✓ Change entry for a deleted doc
    ✓ changes large number of docs (50ms)
    ✓ Calling db.changes({since: 'now'})
    ✓ Calling db.changes({since: 'latest'})
    ✓ Closing db does not cause a crash if changes cancelled
    ✓ fire-complete-on-cancel (101ms)
    ✓ changes are not duplicated (1025ms)
    ✓ supports return_docs=false (45ms)
    ✓ should respects limit (74ms)
    ✓ doesn't throw if opts.complete is undefined
    ✓ handle individual changes in live replication (200ms)
    ✓ changes-filter without filter
    ✓ #3539 - Exception in changes is fine
    ✓ Changes with selector
    ✓ Changes with selector, explicit filter
    ✓ Changes with selector and mismatched filter
    ✓ Changes with limit and selector

  test.changes.js-local
    ✓ All changes
    ✓ Changes with complete callback as param
    ✓ Promise resolved when changes cancelled
    - Live changes should clean listener when cancelled
    ✓ Changes Since
    ✓ Changes Since and limit limit 1
    ✓ Changes Since and limit limit 0
    ✓ Changes limit
    ✓ Changes with filter not present in ddoc
    ✓ Changes with `filters` key not present in ddoc
    ✓ Changes limit and filter
    ✓ Changes with shorthand function name
    ✓ Changes with filter from nonexistent ddoc
    ✓ Changes with view not present in ddoc
    ✓ Changes with `views` key not present in ddoc
    ✓ #4451 Changes with invalid view filter
    ✓ 3356 throw inside a filter
    ✓ Changes with missing param `view` in request
    ✓ Changes limit and view instead of filter
    ✓ #3609 view option implies filter: _view
    ✓ Immediately cancel changes
    ✓ Changes with invalid ddoc view name
    ✓ Changes with invalid ddoc view name 2
    ✓ Changes with style = all_docs
    ✓ Changes with style = all_docs and a callback for complete
    ✓ Changes limit = 0
    ✓ Changes doc
    - Descending many changes
    ✓ live-changes
    ✓ Multiple watchers
    ✓ Continuous changes doc
    ✓ Cancel changes (316ms)
    ✓ #3579 changes firing 1 too many times (65ms)
    ✓ Kill database while listening to live changes
    ✓ #3136 style=all_docs
    ✓ #4191 revs_diff causes endless loop
    ✓ #3136 style=all_docs & include_docs
    ✓ changes-filter with query params
    ✓ Non-live changes filter
    ✓ Non-live changes filter, descending
    ✓ #2569 Non-live doc_ids filter
    ✓ #2569 Big non-live doc_ids filter
    ✓ #2569 Live doc_ids filter
    ✓ #2569 Big live doc_ids filter
    ✓ #2569 Non-live doc_ids filter with filter=_doc_ids
    ✓ #2569 Live doc_ids filter with filter=_doc_ids
    ✓ Changes to same doc are grouped
    ✓ Changes with conflicts are handled correctly
    ✓ Change entry for a deleted doc
    ✓ changes large number of docs
    ✓ Calling db.changes({since: 'now'})
    ✓ Calling db.changes({since: 'latest'})
    ✓ Closing db does not cause a crash if changes cancelled
    ✓ fire-complete-on-cancel (100ms)
    ✓ changes are not duplicated (1015ms)
    ✓ supports return_docs=false
    ✓ should respects limit (64ms)
    ✓ doesn't throw if opts.complete is undefined
    ✓ handle individual changes in live replication (99ms)
    ✓ changes-filter without filter
    ✓ #3539 - Exception in changes is fine
    ✓ Changes with selector
    ✓ Changes with selector, explicit filter
    ✓ Changes with selector and mismatched filter
    ✓ Changes with limit and selector

  changes-standalone
    - Changes reports errors

  test.close.js-local
    ✓ should emit destroyed even when closed (sync)
    ✓ should emit destroyed even when closed (async)
precondition_failed: Database not open
    at Object.<anonymous> (/data/js-variants/multee/Clients/levelup/pouchdb/packages/node_modules/pouchdb/lib/index.js:614:16)
    at Module._compile (node:internal/modules/cjs/loader:1105:14)
    at Module._extensions..js (node:internal/modules/cjs/loader:1159:10)
    at Module.load (node:internal/modules/cjs/loader:981:32)
    at Module._load (node:internal/modules/cjs/loader:827:12)
    at Module.require (node:internal/modules/cjs/loader:1005:19)
    at require (node:internal/modules/cjs/helpers:102:18)
    at commonUtils.loadPouchDBForNode (/data/js-variants/multee/Clients/levelup/pouchdb/tests/common-utils.js:92:17)
    at commonUtils.loadPouchDB (/data/js-variants/multee/Clients/levelup/pouchdb/tests/common-utils.js:78:39)
    at Object.<anonymous> (/data/js-variants/multee/Clients/levelup/pouchdb/tests/integration/node.setup.js:21:28)
    at Module._compile (node:internal/modules/cjs/loader:1105:14)
    at Module._extensions..js (node:internal/modules/cjs/loader:1159:10)
    at Module.load (node:internal/modules/cjs/loader:981:32)
    at Module._load (node:internal/modules/cjs/loader:827:12)
    at Module.require (node:internal/modules/cjs/loader:1005:19)
    at require (node:internal/modules/cjs/helpers:102:18)
    at /data/js-variants/multee/Clients/levelup/pouchdb/node_modules/mocha/bin/_mocha:366:3
    at Array.forEach (<anonymous>)
    at Object.<anonymous> (/data/js-variants/multee/Clients/levelup/pouchdb/node_modules/mocha/bin/_mocha:365:10)
    at Module._compile (node:internal/modules/cjs/loader:1105:14)
    at Module._extensions..js (node:internal/modules/cjs/loader:1159:10)
    at Module.load (node:internal/modules/cjs/loader:981:32)
    at Module._load (node:internal/modules/cjs/loader:827:12)
    at Function.executeUserEntryPoint [as runMain] (node:internal/modules/run_main:77:12)
    at node:internal/main/run_main_module:17:47
    ✓ should emit closed even when destroyed (async #2)
precondition_failed: Database not open
    at Object.<anonymous> (/data/js-variants/multee/Clients/levelup/pouchdb/packages/node_modules/pouchdb/lib/index.js:614:16)
    at Module._compile (node:internal/modules/cjs/loader:1105:14)
    at Module._extensions..js (node:internal/modules/cjs/loader:1159:10)
    at Module.load (node:internal/modules/cjs/loader:981:32)
    at Module._load (node:internal/modules/cjs/loader:827:12)
    at Module.require (node:internal/modules/cjs/loader:1005:19)
    at require (node:internal/modules/cjs/helpers:102:18)
    at commonUtils.loadPouchDBForNode (/data/js-variants/multee/Clients/levelup/pouchdb/tests/common-utils.js:92:17)
    at commonUtils.loadPouchDB (/data/js-variants/multee/Clients/levelup/pouchdb/tests/common-utils.js:78:39)
    at Object.<anonymous> (/data/js-variants/multee/Clients/levelup/pouchdb/tests/integration/node.setup.js:21:28)
    at Module._compile (node:internal/modules/cjs/loader:1105:14)
    at Module._extensions..js (node:internal/modules/cjs/loader:1159:10)
    at Module.load (node:internal/modules/cjs/loader:981:32)
    at Module._load (node:internal/modules/cjs/loader:827:12)
    at Module.require (node:internal/modules/cjs/loader:1005:19)
    at require (node:internal/modules/cjs/helpers:102:18)
    at /data/js-variants/multee/Clients/levelup/pouchdb/node_modules/mocha/bin/_mocha:366:3
    at Array.forEach (<anonymous>)
    at Object.<anonymous> (/data/js-variants/multee/Clients/levelup/pouchdb/node_modules/mocha/bin/_mocha:365:10)
    at Module._compile (node:internal/modules/cjs/loader:1105:14)
    at Module._extensions..js (node:internal/modules/cjs/loader:1159:10)
    at Module.load (node:internal/modules/cjs/loader:981:32)
    at Module._load (node:internal/modules/cjs/loader:827:12)
    at Function.executeUserEntryPoint [as runMain] (node:internal/modules/run_main:77:12)
    at node:internal/main/run_main_module:17:47
    ✓ test unref for coverage
    ✓ test double unref for coverage
precondition_failed: Database not open
    at Object.<anonymous> (/data/js-variants/multee/Clients/levelup/pouchdb/packages/node_modules/pouchdb/lib/index.js:614:16)
    at Module._compile (node:internal/modules/cjs/loader:1105:14)
    at Module._extensions..js (node:internal/modules/cjs/loader:1159:10)
    at Module.load (node:internal/modules/cjs/loader:981:32)
    at Module._load (node:internal/modules/cjs/loader:827:12)
    at Module.require (node:internal/modules/cjs/loader:1005:19)
    at require (node:internal/modules/cjs/helpers:102:18)
    at commonUtils.loadPouchDBForNode (/data/js-variants/multee/Clients/levelup/pouchdb/tests/common-utils.js:92:17)
    at commonUtils.loadPouchDB (/data/js-variants/multee/Clients/levelup/pouchdb/tests/common-utils.js:78:39)
    at Object.<anonymous> (/data/js-variants/multee/Clients/levelup/pouchdb/tests/integration/node.setup.js:21:28)
    at Module._compile (node:internal/modules/cjs/loader:1105:14)
    at Module._extensions..js (node:internal/modules/cjs/loader:1159:10)
    at Module.load (node:internal/modules/cjs/loader:981:32)
    at Module._load (node:internal/modules/cjs/loader:827:12)
    at Module.require (node:internal/modules/cjs/loader:1005:19)
    at require (node:internal/modules/cjs/helpers:102:18)
    at /data/js-variants/multee/Clients/levelup/pouchdb/node_modules/mocha/bin/_mocha:366:3
    at Array.forEach (<anonymous>)
    at Object.<anonymous> (/data/js-variants/multee/Clients/levelup/pouchdb/node_modules/mocha/bin/_mocha:365:10)
    at Module._compile (node:internal/modules/cjs/loader:1105:14)
    at Module._extensions..js (node:internal/modules/cjs/loader:1159:10)
    at Module.load (node:internal/modules/cjs/loader:981:32)
    at Module._load (node:internal/modules/cjs/loader:827:12)
    at Function.executeUserEntryPoint [as runMain] (node:internal/modules/run_main:77:12)
    at node:internal/main/run_main_module:17:47
    ✓ test close-then-destroyed for coverage
************* run test done *************
pouchdb is testing ./Variants/levelup/variant3/levelup
/data/js-variants/multee
************* npm unlink module *************

removed 1 package, changed 1 package, and audited 1032 packages in 4s

64 packages are looking for funding
  run `npm fund` for details

41 vulnerabilities (1 low, 9 moderate, 25 high, 6 critical)

To address issues that do not require attention, run:
  npm audit fix

To address all issues possible (including breaking changes), run:
  npm audit fix --force

Some issues need review, and may require choosing
a different dependency.

Run `npm audit` for details.
************* npm unlink module done *************
************* npm unlink globally *************

removed 1 package, and audited 1 package in 1s

found 0 vulnerabilities
************* npm unlink globally done *************
************* npm link globally *************

added 1 package, and audited 3 packages in 393ms

found 0 vulnerabilities
************* npm link globally done *************
************* npm link module *************

added 1 package, changed 1 package, and audited 1034 packages in 4s

64 packages are looking for funding
  run `npm fund` for details

41 vulnerabilities (1 low, 9 moderate, 25 high, 6 critical)

To address issues that do not require attention, run:
  npm audit fix

To address all issues possible (including breaking changes), run:
  npm audit fix --force

Some issues need review, and may require choosing
a different dependency.

Run `npm audit` for details.
************* npm link module done *************
************* start run test *************

> pouchdb-monorepo@7.0.0-prerelease test
> bash bin/run-test.sh


> pouchdb-monorepo@7.0.0-prerelease build-node
> bash bin/build-node.sh


> pouchdb-monorepo@7.0.0-prerelease build-modules
> node bin/build-modules.js

Building pouchdb...
Building pouchdb-abstract-mapreduce...
Building pouchdb-adapter-http...
Building pouchdb-adapter-idb...
Building pouchdb-adapter-indexeddb...
Building pouchdb-adapter-leveldb...
Building pouchdb-adapter-leveldb-core...
Building pouchdb-adapter-localstorage...
Building pouchdb-adapter-memory...
Building pouchdb-adapter-utils...
Building pouchdb-binary-utils...
Building pouchdb-browser...
Building pouchdb-changes-filter...
Building pouchdb-checkpointer...
Building pouchdb-collate...
Building pouchdb-collections...
Building pouchdb-core...
Building pouchdb-errors...
Building pouchdb-fetch...
Building pouchdb-find...
Building pouchdb-for-coverage...
Building pouchdb-generate-replication-id...
Building pouchdb-json...
Building pouchdb-mapreduce...
Building pouchdb-mapreduce-utils...
Building pouchdb-md5...
Building pouchdb-merge...
Building pouchdb-node...
Building pouchdb-replication...
Building pouchdb-selector-core...
Building pouchdb-utils...
Building sublevel-pouchdb...
  ✓ wrote pouchdb-adapter-localstorage/lib/index.js in vanilla mode
  ✓ wrote pouchdb-adapter-localstorage/lib/index.es.js in vanilla mode
  ✓ wrote pouchdb-adapter-memory/lib/index.js in vanilla mode
  ✓ wrote pouchdb-adapter-memory/lib/index.es.js in vanilla mode
  ✓ wrote pouchdb-checkpointer/lib/index.js in vanilla mode
  ✓ wrote pouchdb-checkpointer/lib/index.es.js in vanilla mode
  ✓ wrote pouchdb-errors/lib/index.js in vanilla mode
  ✓ wrote pouchdb-errors/lib/index.es.js in vanilla mode
  ✓ wrote pouchdb-generate-replication-id/lib/index.js in vanilla mode
  ✓ wrote pouchdb-generate-replication-id/lib/index.es.js in vanilla mode
  ✓ wrote pouchdb-adapter-http/lib/index.js in vanilla mode
  ✓ wrote pouchdb-adapter-http/lib/index.es.js in vanilla mode
  ✓ wrote pouchdb-adapter-leveldb-core/lib/index.js in node mode
  ✓ wrote pouchdb-adapter-leveldb-core/lib/index.es.js in node mode
  ✓ wrote pouchdb-adapter-leveldb-core/lib/index-browser.js in browser mode
  ✓ wrote pouchdb-adapter-leveldb-core/lib/index-browser.es.js in browser mode
  ✓ wrote pouchdb-adapter-leveldb/lib/index.js in node mode
  ✓ wrote pouchdb-adapter-leveldb/lib/index.es.js in node mode
  ✓ wrote pouchdb-adapter-leveldb/lib/index-browser.js in browser mode
  ✓ wrote pouchdb-adapter-leveldb/lib/index-browser.es.js in browser mode
  ✓ wrote pouchdb-changes-filter/lib/index-browser.js in browser mode
  ✓ wrote pouchdb-changes-filter/lib/index-browser.es.js in browser mode
  ✓ wrote pouchdb-fetch/lib/index-browser.js in browser mode
  ✓ wrote pouchdb-fetch/lib/index-browser.es.js in browser mode
  ✓ wrote pouchdb-md5/lib/index-browser.js in browser mode
  ✓ wrote pouchdb-md5/lib/index-browser.es.js in browser mode
  ✓ wrote pouchdb-changes-filter/lib/index.js in node mode
  ✓ wrote pouchdb-changes-filter/lib/index.es.js in node mode
  ✓ wrote pouchdb-collate/lib/index.js in vanilla mode
  ✓ wrote pouchdb-collate/lib/index.es.js in vanilla mode
  ✓ wrote pouchdb-fetch/lib/index.js in node mode
  ✓ wrote pouchdb-fetch/lib/index.es.js in node mode
  ✓ wrote pouchdb-json/lib/index.js in vanilla mode
  ✓ wrote pouchdb-json/lib/index.es.js in vanilla mode
  ✓ wrote pouchdb-mapreduce-utils/lib/index.js in vanilla mode
  ✓ wrote pouchdb-mapreduce-utils/lib/index.es.js in vanilla mode
  ✓ wrote pouchdb-md5/lib/index.js in node mode
  ✓ wrote pouchdb-md5/lib/index.es.js in node mode
  ✓ wrote pouchdb-abstract-mapreduce/lib/index.js in vanilla mode
  ✓ wrote pouchdb-abstract-mapreduce/lib/index.es.js in vanilla mode
  ✓ wrote pouchdb-adapter-indexeddb/lib/index.js in vanilla mode
  ✓ wrote pouchdb-adapter-indexeddb/lib/index.es.js in vanilla mode
  ✓ wrote pouchdb-adapter-idb/lib/index.js in vanilla mode
  ✓ wrote pouchdb-adapter-idb/lib/index.es.js in vanilla mode
  ✓ wrote pouchdb-binary-utils/lib/index-browser.js in browser mode
  ✓ wrote pouchdb-binary-utils/lib/index-browser.es.js in browser mode
  ✓ wrote pouchdb-utils/lib/index-browser.js in browser mode
  ✓ wrote pouchdb-utils/lib/index-browser.es.js in browser mode
  ✓ wrote pouchdb-utils/lib/index.js in node mode
  ✓ wrote pouchdb-utils/lib/index.es.js in node mode
  ✓ wrote pouchdb-adapter-utils/lib/index.js in vanilla mode
  ✓ wrote pouchdb-binary-utils/lib/index.js in node mode
  ✓ wrote pouchdb-binary-utils/lib/index.es.js in node mode
  ✓ wrote pouchdb-adapter-utils/lib/index.es.js in vanilla mode
  ✓ wrote pouchdb-collections/lib/index.js in vanilla mode
  ✓ wrote pouchdb-collections/lib/index.es.js in vanilla mode
  ✓ wrote pouchdb-merge/lib/index.js in vanilla mode
  ✓ wrote pouchdb-merge/lib/index.es.js in vanilla mode
  ✓ wrote pouchdb-selector-core/lib/index.js in vanilla mode
  ✓ wrote pouchdb-selector-core/lib/index.es.js in vanilla mode
  ✓ wrote sublevel-pouchdb/lib/index.js in vanilla mode
  ✓ wrote sublevel-pouchdb/lib/index.es.js in vanilla mode
  ✓ wrote pouchdb-mapreduce/lib/index-browser.js in browser mode
  ✓ wrote pouchdb-mapreduce/lib/index-browser.es.js in browser mode
  ✓ wrote pouchdb-replication/lib/index.js in vanilla mode
  ✓ wrote pouchdb-replication/lib/index.es.js in vanilla mode
  ✓ wrote pouchdb-mapreduce/lib/index.js in node mode
  ✓ wrote pouchdb-mapreduce/lib/index.es.js in node mode
  ✓ wrote pouchdb-core/lib/index.js in vanilla mode
  ✓ wrote pouchdb-core/lib/index.es.js in vanilla mode
  ✓ wrote pouchdb-find/lib/index.js in node mode
  ✓ wrote pouchdb-find/lib/index.es.js in node mode
  ✓ wrote pouchdb-find/lib/index-browser.js in browser mode
  ✓ wrote pouchdb-find/lib/index-browser.es.js in browser mode
  ✓ wrote pouchdb-for-coverage/lib/index.js in node mode
  ✓ wrote pouchdb-for-coverage/lib/index.es.js in node mode
  ✓ wrote pouchdb-for-coverage/lib/index-browser.js in browser mode
  ✓ wrote pouchdb-for-coverage/lib/index-browser.es.js in browser mode
  ✓ wrote pouchdb-browser/lib/index.es.js in vanilla mode
  ✓ wrote pouchdb-node/lib/index.js in vanilla mode
  ✓ wrote pouchdb-node/lib/index.es.js in vanilla mode
  ✓ wrote packages/node_modules/pouchdb/lib/index.js
  ✓ wrote packages/node_modules/pouchdb/lib/index.es.js
  ✓ wrote pouchdb-browser/lib/index.js in vanilla mode
Waiting for host to start ..
Host started :)
> pouchdb-monorepo@7.0.0-prerelease test-node
> bash bin/test-node.sh

Down server listening on port 3010
Seeded with: 1660143287998


  DB Setup
    ✓ PouchDB has a version
    ✓ PouchDB version matches package.json

  test.active_tasks.js
    ✓ Can add a task
    ✓ Can get tasks by id
    ✓ Can get all tasks
    ✓ Can update a task
    ✓ Can remove a task

  test.all_docs.js-http
    ✓ Testing all docs (160ms)
    ✓ Testing allDocs opts.keys (119ms)
    ✓ Testing allDocs opts.keys with skip
    ✓ Testing allDocs opts.keys with limit
    ✓ Testing allDocs invalid opts.keys
    ✓ Testing deleting in changes (41ms)
    ✓ Testing updating in changes (43ms)
    ✓ Testing include docs
    ✓ Testing conflicts (48ms)
    ✓ test basic collation
    ✓ 3883 start_key end_key aliases
    ✓ test total_rows with a variety of criteria (129ms)
    ✓ test total_rows with both skip and limit
    ✓ test limit option and total_rows
    ✓ test escaped startkey/endkey
    ✓ test "key" option
    ✓ test inclusive_end=false (51ms)
    ✓ test descending with startkey/endkey
    ✓ #3082 test wrong num results returned (250ms)
    ✓ test empty db
    ✓ test after db close
    ✓ 5793 _conflicts should not exist if no conflicts
    ✓ #6230 Test allDocs opts update_seq: false
    ✓ #6230 Test allDocs opts update_seq: true
    ✓ #6230 Test allDocs opts with update_seq missing

  test.all_docs.js-local
    ✓ Testing all docs
    ✓ Testing allDocs opts.keys
    ✓ Testing allDocs opts.keys with skip
    ✓ Testing allDocs opts.keys with limit
    ✓ Testing allDocs invalid opts.keys
    ✓ Testing deleting in changes
    ✓ Testing updating in changes
    ✓ Testing include docs
    ✓ Testing conflicts
    ✓ test basic collation
    ✓ 3883 start_key end_key aliases
    ✓ test total_rows with a variety of criteria
    ✓ test total_rows with both skip and limit
    ✓ test limit option and total_rows
    ✓ test escaped startkey/endkey
    ✓ test "key" option
    ✓ test inclusive_end=false
    ✓ test descending with startkey/endkey
    ✓ #3082 test wrong num results returned (196ms)
    ✓ test empty db
    ✓ test after db close
    ✓ test unicode ids and revs
    ✓ 5793 _conflicts should not exist if no conflicts
    ✓ #6230 Test allDocs opts update_seq: false
    ✓ #6230 Test allDocs opts update_seq: true
    ✓ #6230 Test allDocs opts with update_seq missing

  suite2 test.attachments.js-local
    ✓ 3357 Attachment names cant start with _
    ✓ 5736 warning for putAttachment without content_type
    ✓ 5736 warning for bulkDocs attachments without content_type
    ✓ fetch atts with open_revs and missing
    ✓ issue 2803 should throw 412
    ✓ issue 2803 should throw 412 part 2
    ✓ issue 2803 should throw 412 part 3
    ✓ issue 2803 should throw 412 part 4
    ✓ #2858 {binary: true} in get()
    ✓ #2858 {binary: true} in allDocs() 1
    ✓ #2858 {binary: true} in allDocs() 2
    ✓ #2858 {binary: true} in allDocs() 3
    ✓ #2858 {binary: true} in allDocs() 4
    ✓ #2858 {binary: true} in allDocs() 5
    ✓ #2858 {binary: true} in allDocs(), many atts
    ✓ #2858 {binary: true} in allDocs(), mixed atts
    ✓ #2858 {binary: true} in changes() non-live
    ✓ #2858 {binary: true} in changes() non-live, many atts
    ✓ #2858 {binary: true} in changes() non-live, mixed atts
    ✓ #2858 {binary: true} non-live changes, complete event
    ✓ #2858 {binary: true} in live changes
    ✓ #2858 {binary: true} in live changes, mixed atts
    ✓ #2858 {binary: true} in live+retry changes
    ✓ #2858 {binary: true} in live changes, attachments:false
    ✓ #2858 {binary: true} in live changes, include_docs:false
    ✓ #6736 {binary: true} in bulkGet()
    ✓ Measures length correctly after put()
    ✓ #3074 non-live changes()
    ✓ #3074 live changes()
    ✓ #3074 non-live changes(), no attachments
    ✓ #3074 live changes(), no attachments
    ✓ #3881 filter extraneous keys from _attachments
    ✓ #2771 allDocs() 1, single attachment
    ✓ #2771 allDocs() 2, many docs same att
    ✓ #2771 allDocs() 3, many docs diff atts
    ✓ #2771 allDocs() 4, mix of atts and no atts
    ✓ #2771 allDocs() 5, no atts
    ✓ #2771 allDocs() 6, no docs
    ✓ #2771 allDocs() 7, revisions and deletions
    ✓ #2771 allDocs() 8, empty attachment
    ✓ No length for non-stubs
    ✓ Test some attachments
    ✓ Test getAttachment
    ✓ Test getAttachment with stubs
    ✓ Test get() with binary:true and stubs
    ✓ Test attachments in allDocs/changes
    ✓ Test putAttachment with base64 plaintext
    ✓ Test putAttachment with invalid base64
    ✓ Test getAttachment with empty text
    ✓ Test getAttachment with normal text
    ✓ Test getAttachment with PNG
    ✓ Test getAttachment with PNG using bulkDocs
    ✓ Test getAttachment with PNG using post
    ✓ Test postAttachment with PNG then bulkDocs
    ✓ proper stub behavior
    ✓ Testing with invalid docs
    ✓ Test create attachment and doc in one go
    ✓ Test create attachment and doc in one go without callback
    ✓ Test create attachment without callback
    ✓ Test put attachment on a doc without attachments
    ✓ Test put attachment with unencoded name
    ✓ 3963 length property on stubs
    ✓ Testing with invalid rev
    ✓ Test put another attachment on a doc with attachments
    ✓ Test get with attachments: true if empty attachments
    ✓ Test delete attachment from a doc
    ✓ Test a document with a json string attachment
    ✓ Test remove doc with attachment
    ✓ Try to insert a doc with unencoded attachment
    ✓ Try to get attachment of unexistent doc
    ✓ Test synchronous putAttachment with text data
    ✓ Test synchronous putAttachment with no text data
    ✓ Test put with partial stubs
    ✓ Test put with attachments and new_edits=false
    ✓ Test getAttachment with specific rev
    ✓ Test getAttachment with diff revs and content
    ✓ Test stubs
    ✓ Try to get unexistent attachment of some doc
    ✓ putAttachment and getAttachment with plaintext
    ✓ putAttachment and getAttachment with png data
    ✓ putAttachment in new doc with base64
    ✓ #2818 - save same attachment in different revs
    ✓ #2818 - save same attachment many times in parallel
    ✓ #2818 - revisions keep attachments (no compaction)
    ✓ #2818 - doesn't throw 409 if same filename
    ✓ #3008 test correct encoding/decoding of \u0000 etc.
    ✓ putAttachment and getAttachment with big png data (90ms)
    ✓ #2709 `revpos` with putAttachment
    ✓ #2709 `revpos` with inline attachment
    ✓ #2709 `revpos` with allDocs
    ✓ #7403 {attachments: true, binary: true, include_docs: true} in allDocs with one missing doc

  suite2 test.attachments.js-http
    ✓ 3357 Attachment names cant start with _
    ✓ 5736 warning for putAttachment without content_type
    ✓ 5736 warning for bulkDocs attachments without content_type
    ✓ fetch atts with open_revs and missing
    ✓ issue 2803 should throw 412
    ✓ issue 2803 should throw 412 part 2
    ✓ issue 2803 should throw 412 part 3
    ✓ issue 2803 should throw 412 part 4
    ✓ #2858 {binary: true} in get()
    ✓ #2858 {binary: true} in allDocs() 1
    ✓ #2858 {binary: true} in allDocs() 2
    ✓ #2858 {binary: true} in allDocs() 3 (40ms)
    ✓ #2858 {binary: true} in allDocs() 4
    ✓ #2858 {binary: true} in allDocs() 5
    ✓ #2858 {binary: true} in allDocs(), many atts
    ✓ #2858 {binary: true} in allDocs(), mixed atts
    ✓ #2858 {binary: true} in changes() non-live
    ✓ #2858 {binary: true} in changes() non-live, many atts
    ✓ #2858 {binary: true} in changes() non-live, mixed atts
    ✓ #2858 {binary: true} non-live changes, complete event
    ✓ #2858 {binary: true} in live changes
    ✓ #2858 {binary: true} in live changes, mixed atts
    ✓ #2858 {binary: true} in live+retry changes
    ✓ #2858 {binary: true} in live changes, attachments:false
    ✓ #2858 {binary: true} in live changes, include_docs:false
    ✓ #6736 {binary: true} in bulkGet()
    ✓ Measures length correctly after put()
    ✓ #3074 non-live changes() (38ms)
    ✓ #3074 live changes() (39ms)
    ✓ #3074 non-live changes(), no attachments (40ms)
    ✓ #3074 live changes(), no attachments
    ✓ #3881 filter extraneous keys from _attachments
    ✓ #2771 allDocs() 1, single attachment (38ms)
    ✓ #2771 allDocs() 2, many docs same att
    ✓ #2771 allDocs() 3, many docs diff atts
    ✓ #2771 allDocs() 4, mix of atts and no atts
    ✓ #2771 allDocs() 5, no atts
    ✓ #2771 allDocs() 6, no docs
    ✓ #2771 allDocs() 7, revisions and deletions
    ✓ #2771 allDocs() 8, empty attachment
    ✓ No length for non-stubs
    ✓ Test some attachments (46ms)
    ✓ Test getAttachment
    ✓ Test getAttachment with stubs
    ✓ Test get() with binary:true and stubs
    ✓ Test attachments in allDocs/changes
    ✓ Test putAttachment with base64 plaintext
    ✓ Test putAttachment with invalid base64
    ✓ Test getAttachment with empty text
    ✓ Test getAttachment with normal text
    ✓ Test getAttachment with PNG
    ✓ Test getAttachment with PNG using bulkDocs
    ✓ Test getAttachment with PNG using post
    ✓ Test postAttachment with PNG then bulkDocs
    ✓ proper stub behavior
    ✓ Testing with invalid docs
    ✓ Test create attachment and doc in one go
    ✓ Test create attachment and doc in one go without callback
    ✓ Test create attachment without callback (39ms)
    ✓ Test put attachment on a doc without attachments (43ms)
    ✓ Test put attachment with unencoded name
    ✓ 3963 length property on stubs (45ms)
    ✓ Testing with invalid rev
    ✓ Test put another attachment on a doc with attachments
    ✓ Test get with attachments: true if empty attachments
    ✓ Test delete attachment from a doc (41ms)
    ✓ Test a document with a json string attachment
    ✓ Test remove doc with attachment
    ✓ Try to insert a doc with unencoded attachment
    ✓ Try to get attachment of unexistent doc
    ✓ Test synchronous putAttachment with text data
    ✓ Test synchronous putAttachment with no text data
    ✓ Test put with partial stubs
    ✓ Test put with attachments and new_edits=false
    ✓ Test getAttachment with specific rev
    ✓ Test getAttachment with diff revs and content (38ms)
    ✓ Test stubs
    ✓ Try to get unexistent attachment of some doc
    ✓ putAttachment and getAttachment with plaintext
    ✓ putAttachment and getAttachment with png data
    ✓ putAttachment in new doc with base64
    ✓ #2818 - save same attachment in different revs (53ms)
    ✓ #2818 - save same attachment many times in parallel
    ✓ #2818 - revisions keep attachments (no compaction) (39ms)
    ✓ #2818 - doesn't throw 409 if same filename
    ✓ #3008 test correct encoding/decoding of \u0000 etc.
    ✓ putAttachment and getAttachment with big png data (125ms)
    ✓ #2709 `revpos` with putAttachment (40ms)
    ✓ #2709 `revpos` with inline attachment
    ✓ #2709 `revpos` with allDocs
    ✓ #7403 {attachments: true, binary: true, include_docs: true} in allDocs with one missing doc (73ms)

  suite2 test.attachments.js- local:http
    ✓ Attachments replicate back and forth (173ms)
    ✓ Replicate same doc, same atts (112ms)
    ✓ Replicate same doc, same atts 2 (108ms)
    ✓ Attachments replicate (67ms)
    ✓ Attachment types replicate (55ms)
    ✓ Many many attachments replicate (219ms)
    ✓ Many many png attachments replicate (195ms)
    ✓ Multiple attachments replicate (76ms)
    - #3961 Many attachments on same doc
    ✓ Multiple attachments replicate, different docs (#2698) (75ms)
    ✓ Multiple attachments replicate, different docs png (#2698) (75ms)
    ✓ #3932 attachments with tricky revpos (144ms)
    ✓ replication with changing attachments (96ms)
    ✓ 3955 race condition in put
    ✓ #8456 bad attachment rev after replication (118ms)

  suite2 test.attachments.js- http:http
    ✓ Attachments replicate back and forth (163ms)
    ✓ Replicate same doc, same atts (234ms)
    ✓ Replicate same doc, same atts 2 (172ms)
    ✓ Attachments replicate (75ms)
    ✓ Attachment types replicate (94ms)
    ✓ Many many attachments replicate (361ms)
    ✓ Many many png attachments replicate (294ms)
    ✓ Multiple attachments replicate (121ms)
    - #3961 Many attachments on same doc
    ✓ Multiple attachments replicate, different docs (#2698) (127ms)
    ✓ Multiple attachments replicate, different docs png (#2698) (126ms)
    ✓ #3932 attachments with tricky revpos (251ms)
    ✓ replication with changing attachments (231ms)
    ✓ 3955 race condition in put
    ✓ #8456 bad attachment rev after replication (170ms)

  suite2 test.attachments.js- http:local
    ✓ Attachments replicate back and forth (105ms)
    ✓ Replicate same doc, same atts (93ms)
    ✓ Replicate same doc, same atts 2 (103ms)
    ✓ Attachments replicate (66ms)
    ✓ Attachment types replicate (65ms)
    ✓ Many many attachments replicate (141ms)
    ✓ Many many png attachments replicate (178ms)
    ✓ Multiple attachments replicate (82ms)
    - #3961 Many attachments on same doc
    ✓ Multiple attachments replicate, different docs (#2698) (71ms)
    ✓ Multiple attachments replicate, different docs png (#2698) (98ms)
    ✓ #3932 attachments with tricky revpos (166ms)
    ✓ replication with changing attachments (97ms)
    ✓ 3955 race condition in put
    ✓ #8456 bad attachment rev after replication (174ms)

  suite2 test.attachments.js- local:local
    ✓ Attachments replicate back and forth
    ✓ Replicate same doc, same atts
    ✓ Replicate same doc, same atts 2
    ✓ Attachments replicate
    ✓ Attachment types replicate
    ✓ Many many attachments replicate
    ✓ Many many png attachments replicate
    ✓ Multiple attachments replicate
    - #3961 Many attachments on same doc
    ✓ Multiple attachments replicate, different docs (#2698)
    ✓ Multiple attachments replicate, different docs png (#2698)
    ✓ #3932 attachments with tricky revpos
    ✓ replication with changing attachments
    ✓ 3955 race condition in put
    ✓ #8456 bad attachment rev after replication

  test.basics.js-http
    ✓ Create a pouch without new keyword
    ✓ Name is accessible via instance
    ✓ 4314 Create a pouch with + in name
    ✓ Creating Pouch without name will throw
    ✓ 4314 Create a pouch with urlencoded name
    ✓ 4219 destroy a pouch
    ✓ 4339 throw useful error if method called on stale instance
    ✓ [4595] should reject xhr errors
    ✓ [4595] should emit error event on xhr error
    ✓ Add a doc
    ✓ Get invalid id
    ✓ Missing doc should contain ID in error object
    ✓ PUTed Conflicted doc should contain ID in error object
    ✓ POSTed Conflicted doc should contain ID in error object
    ✓ Add a doc with a promise
    ✓ Add a doc with opts object
    ✓ Modify a doc
    ✓ Modifying a doc that has rewritten content
    ✓ Modify a doc with a promise
    ✓ Read db id
    ✓ Read db id with promise
    ✓ Close db
    ✓ Close db with a promise
    ✓ Read db id after closing Close
    ✓ Modify a doc with incorrect rev
    ✓ Remove doc
    ✓ Remove doc with a promise
    ✓ Remove doc with new syntax
    ✓ Remove doc with new syntax and a promise
    ✓ Doc removal leaves only stub
    ✓ Remove doc twice with specified id (39ms)
    ✓ Remove doc, no callback
    ✓ Delete document without id
    ✓ Delete document with many args
    ✓ Delete document with many args, callback style
    ✓ Delete doc with id + rev + no opts
    ✓ Delete doc with id + rev + no opts, callback style
    ✓ Delete doc with doc + opts
    ✓ Delete doc with doc + opts, callback style
    ✓ Delete doc with rev in opts
    ✓ Bulk docs
    ✓ Bulk docs with a promise
    ✓ Basic checks
    ✓ update with invalid rev
    ✓ Doc validation
    ✓ Replication fields (#2442)
    ✓ Testing issue #48 (54ms)
    ✓ Testing valid id
    ✓ Put doc without _id should fail
    ✓ Put doc with bad reserved id should fail
    ✓ update_seq persists
    ✓ deletions persists
    ✓ #4126 should not store raw Dates
    ✓ Create a db with a reserved name
    ✓ Error when document is not an object
    ✓ Test instance update_seq updates correctly
    ✓ Fail to fetch a doc after db was deleted (50ms)
    ✓ Fail to fetch a doc after db was deleted (45ms)
    ✓ Cant add docs with empty ids
    ✓ Test doc with percent in ID
    ✓ db.info should give auto_compaction = false (#2744)
    ✓ db.info should give auto_compaction = true (#2744)
    ✓ db.info should give adapter name (#3567)
    ✓ db.info should give correct doc_count
    ✓ putting returns {ok: true}
    ✓ putting is override-able
    ✓ issue 2779, deleted docs, old revs COUCHDB-292
    ✓ issue 2888, successive deletes and writes
    ✓ 2 invalid puts
    ✓ Docs save "null" value
    ✓ replace PouchDB.destroy() (express-pouchdb#203)
    ✓ 3968, keeps all object fields
    ✓ 4712 invalid rev for new doc generates conflict
    ✓ test info() after db close
    ✓ test get() after db close
    ✓ test close() after db close
    ✓ 7259 should have "this" keyword properly scoped
    ✓ #5471 PouchDB.plugin() should throw error if passed wrong type or empty object

  test.basics.js-local
    ✓ Create a pouch without new keyword
    ✓ Name is accessible via instance
    ✓ 4314 Create a pouch with + in name
    ✓ Creating Pouch without name will throw
    ✓ 4314 Create a pouch with urlencoded name
    ✓ 4219 destroy a pouch
    ✓ 4339 throw useful error if method called on stale instance
    ✓ [4595] should reject xhr errors
    ✓ [4595] should emit error event on xhr error
    ✓ Add a doc
    ✓ Get invalid id
    ✓ Missing doc should contain ID in error object
    ✓ PUTed Conflicted doc should contain ID in error object
    ✓ POSTed Conflicted doc should contain ID in error object
    ✓ Add a doc with a promise
    ✓ Add a doc with opts object
    ✓ Modify a doc
    ✓ Modifying a doc that has rewritten content
    ✓ Modify a doc with a promise
    ✓ Read db id
    ✓ Read db id with promise
    ✓ Close db
    ✓ Close db with a promise
    ✓ Read db id after closing Close
    ✓ Modify a doc with incorrect rev
    ✓ Remove doc
    ✓ Remove doc with a promise
    ✓ Remove doc with new syntax
    ✓ Remove doc with new syntax and a promise
    ✓ Doc removal leaves only stub
    ✓ Remove doc twice with specified id
    ✓ Remove doc, no callback
    ✓ Delete document without id
    ✓ Delete document with many args
    ✓ Delete document with many args, callback style
    ✓ Delete doc with id + rev + no opts
    ✓ Delete doc with id + rev + no opts, callback style
    ✓ Delete doc with doc + opts
    ✓ Delete doc with doc + opts, callback style
    ✓ Delete doc with rev in opts
    ✓ Bulk docs
    ✓ Bulk docs with a promise
    ✓ Basic checks
    ✓ update with invalid rev
    ✓ Doc validation
    ✓ Replication fields (#2442)
    ✓ Allows _access field in documents (#8171)
    ✓ Testing issue #48 (52ms)
    ✓ Testing valid id
    ✓ Put doc without _id should fail
    ✓ Put doc with bad reserved id should fail
    ✓ update_seq persists
    ✓ deletions persists
    ✓ #4126 should not store raw Dates
    ✓ Create a db with a reserved name
    ✓ Error when document is not an object
    ✓ Test instance update_seq updates correctly
    ✓ Fail to fetch a doc after db was deleted
    ✓ Fail to fetch a doc after db was deleted
    ✓ Cant add docs with empty ids
    ✓ Test doc with percent in ID
    ✓ db.info should give auto_compaction = false (#2744)
    ✓ db.info should give auto_compaction = true (#2744)
    ✓ db.info should give adapter name (#3567)
    ✓ db.info should give correct doc_count
    ✓ putting returns {ok: true}
    ✓ putting is override-able
    ✓ issue 2779, deleted docs, old revs COUCHDB-292
    ✓ issue 2888, successive deletes and writes
    ✓ 2 invalid puts
    ✓ Docs save "null" value
    ✓ replace PouchDB.destroy() (express-pouchdb#203)
    ✓ 3968, keeps all object fields
    ✓ 4712 invalid rev for new doc generates conflict
    ✓ test info() after db close
    ✓ test get() after db close
    ✓ test close() after db close
    ✓ 7259 should have "this" keyword properly scoped
    ✓ should allow unicode doc ids
    ✓ should have same blob support for 2 dbs
    ✓ 6053, PouchDB.plugin() resets defaults
    ✓ #5471 PouchDB.plugin() should throw error if passed wrong type or empty object

  test.bulk_docs.js-local
    ✓ Testing bulk docs
    ✓ #6039 test id in bulk docs for conflict
    ✓ No id in bulk docs
    ✓ No _rev and new_edits=false
    ✓ 7829 bare rev 1- with new_edits=false
    ✓ Test empty bulkDocs
    ✓ Test many bulkDocs
    ✓ Test errors on invalid doc id
    ✓ Test two errors on invalid doc id
    ✓ No docs
    ✓ Jira 911
    ✓ Test multiple bulkdocs
    ✓ #2935 new_edits=false correct number
    ✓ #2935 new_edits=false correct number 2
    ✓ bulk docs update then delete then conflict
    ✓ bulk_docs delete then undelete
    ✓ #2935 new_edits=false with single unauthorized
    ✓ Deleting _local docs with bulkDocs
    ✓ Deleting _local docs with bulkDocs, not found
    ✓ Deleting _local docs with bulkDocs, wrong rev
    ✓ Bulk with new_edits=false
    ✓ Testing successive new_edits to the same doc
    ✓ #3062 bulkDocs with staggered seqs
    ✓ Testing successive new_edits to the same doc, different content
    ✓ Testing successive new_edits to two doc
    ✓ Deletion with new_edits=false
    ✓ Deletion with new_edits=false, no history
    ✓ Modification with new_edits=false, no history
    ✓ Deletion with new_edits=false, no history, no revisions
    ✓ Testing new_edits=false in req body
    ✓ 656 regression in handling deleted docs
    ✓ Test quotes in doc ids
    ✓ Bulk docs empty list
    ✓ handles simultaneous writes
    ✓ bulk docs input by array
    ✓ Bulk empty list
    ✓ Bulk docs not an array
    ✓ Bulk docs not an object
    ✓ Bulk docs two different revisions to same document id
    ✓ 4204 respect revs_limit (264ms)
    ✓ 2839 implement revs_limit (185ms)
    ✓ 4372 revs_limit deletes old revisions of the doc
    ✓ 4372 revs_limit with auto_compaction deletes old revisions of the doc
    ✓ 4712 invalid rev for new doc generates conflict
    ✓ 5793 bulk docs accepts _conflicts when new_edits=false

  test.bulk_docs.js-http
    ✓ Testing bulk docs
    ✓ #6039 test id in bulk docs for conflict
    ✓ No id in bulk docs
    ✓ No _rev and new_edits=false
    ✓ 7829 bare rev 1- with new_edits=false
    ✓ Test empty bulkDocs
    ✓ Test many bulkDocs (39ms)
    ✓ Test errors on invalid doc id
    ✓ Test two errors on invalid doc id
    ✓ No docs
    ✓ Jira 911
    ✓ Test multiple bulkdocs
    ✓ #2935 new_edits=false correct number
    ✓ #2935 new_edits=false correct number 2
    ✓ bulk docs update then delete then conflict
    ✓ bulk_docs delete then undelete
    ✓ #2935 new_edits=false with single unauthorized
    ✓ Deleting _local docs with bulkDocs
    ✓ Bulk with new_edits=false
    ✓ Testing successive new_edits to the same doc
    ✓ #3062 bulkDocs with staggered seqs
    ✓ Testing successive new_edits to the same doc, different content
    ✓ Testing successive new_edits to two doc
    ✓ Deletion with new_edits=false
    ✓ Deletion with new_edits=false, no history
    ✓ Modification with new_edits=false, no history
    ✓ Deletion with new_edits=false, no history, no revisions
    ✓ Testing new_edits=false in req body
    ✓ 656 regression in handling deleted docs
    ✓ Test quotes in doc ids
    ✓ Bulk docs empty list
    ✓ handles simultaneous writes
    ✓ bulk docs input by array
    ✓ Bulk empty list
    ✓ Bulk docs not an array
    ✓ Bulk docs not an object
    ✓ Bulk docs two different revisions to same document id
    ✓ 4204 respect revs_limit (283ms)
    ✓ 2839 implement revs_limit
    ✓ 4372 revs_limit deletes old revisions of the doc
    ✓ 4372 revs_limit with auto_compaction deletes old revisions of the doc
    ✓ 4712 invalid rev for new doc generates conflict
    ✓ 5793 bulk docs accepts _conflicts when new_edits=false (41ms)

  test.bulk_get.js-http
    ✓ test bulk get with rev specified
    ✓ test bulk get with latest=true
    ✓ test bulk get with no rev specified
    ✓ _revisions is not returned by default
    ✓ #5886 bulkGet with reserved id
    ✓ _revisions is returned when specified
    ✓ _revisions is returned when specified, using implicit rev
    ✓ attachments are not included by default
    ✓ attachments are included when specified
    ✓ attachments are included when specified, using implicit rev

  test.bulk_get.js-local
    ✓ test bulk get with rev specified
    ✓ test bulk get with latest=true
    ✓ test bulk get with no rev specified
    ✓ _revisions is not returned by default
    ✓ #5886 bulkGet with reserved id
    ✓ _revisions is returned when specified
    ✓ _revisions is returned when specified, using implicit rev
    ✓ attachments are not included by default
    ✓ attachments are included when specified
    ✓ attachments are included when specified, using implicit rev

  test.changes.js-http
    ✓ All changes
    ✓ Changes with complete callback as param
    ✓ Promise resolved when changes cancelled
    - Live changes should clean listener when cancelled
    ✓ Changes Since
    ✓ Changes Since and limit limit 1
    ✓ Changes Since and limit limit 0
    ✓ Changes limit
    ✓ Changes with filter not present in ddoc
    ✓ Changes with `filters` key not present in ddoc
    ✓ Changes limit and filter (52ms)
    ✓ Changes with shorthand function name
    ✓ Changes with filter from nonexistent ddoc
    ✓ Changes with view not present in ddoc
    ✓ Changes with `views` key not present in ddoc
    ✓ #4451 Changes with invalid view filter
    ✓ 3356 throw inside a filter
    ✓ Changes with missing param `view` in request
    ✓ Changes limit and view instead of filter
    ✓ #3609 view option implies filter: _view
    ✓ Immediately cancel changes
    ✓ Changes with invalid ddoc view name
    ✓ Changes with invalid ddoc view name 2
    ✓ Changes with style = all_docs (68ms)
    ✓ Changes with style = all_docs and a callback for complete (58ms)
    ✓ Changes limit = 0
    ✓ Changes doc
    - Descending many changes
    ✓ live-changes
    ✓ Multiple watchers
    ✓ Continuous changes doc (45ms)
    ✓ Cancel changes (322ms)
    ✓ #3579 changes firing 1 too many times (71ms)
    ✓ Kill database while listening to live changes
    ✓ #3136 style=all_docs
    ✓ #4191 revs_diff causes endless loop
    ✓ #3136 style=all_docs & include_docs
    ✓ changes-filter with query params
    ✓ Non-live changes filter
    ✓ Non-live changes filter, descending
    ✓ #2569 Non-live doc_ids filter
    ✓ #2569 Big non-live doc_ids filter
    ✓ #2569 Live doc_ids filter
    ✓ #2569 Big live doc_ids filter
    ✓ #2569 Non-live doc_ids filter with filter=_doc_ids
    ✓ #2569 Live doc_ids filter with filter=_doc_ids
    ✓ Changes to same doc are grouped
    ✓ Changes with conflicts are handled correctly (130ms)
    ✓ Change entry for a deleted doc
    ✓ changes large number of docs (44ms)
    ✓ Calling db.changes({since: 'now'})
    ✓ Calling db.changes({since: 'latest'})
    ✓ Closing db does not cause a crash if changes cancelled
    ✓ fire-complete-on-cancel (102ms)
    ✓ changes are not duplicated (1024ms)
    ✓ supports return_docs=false
    ✓ should respects limit (91ms)
    ✓ doesn't throw if opts.complete is undefined
    ✓ handle individual changes in live replication (196ms)
    ✓ changes-filter without filter
    ✓ #3539 - Exception in changes is fine (38ms)
    ✓ Changes with selector
    ✓ Changes with selector, explicit filter
    ✓ Changes with selector and mismatched filter
    ✓ Changes with limit and selector

  test.changes.js-local
    ✓ All changes
    ✓ Changes with complete callback as param
    ✓ Promise resolved when changes cancelled
    - Live changes should clean listener when cancelled
    ✓ Changes Since
    ✓ Changes Since and limit limit 1
    ✓ Changes Since and limit limit 0
    ✓ Changes limit
    ✓ Changes with filter not present in ddoc
    ✓ Changes with `filters` key not present in ddoc
    ✓ Changes limit and filter
    ✓ Changes with shorthand function name
    ✓ Changes with filter from nonexistent ddoc
    ✓ Changes with view not present in ddoc
    ✓ Changes with `views` key not present in ddoc
    ✓ #4451 Changes with invalid view filter
    ✓ 3356 throw inside a filter
    ✓ Changes with missing param `view` in request
    ✓ Changes limit and view instead of filter
    ✓ #3609 view option implies filter: _view
    ✓ Immediately cancel changes
    ✓ Changes with invalid ddoc view name
    ✓ Changes with invalid ddoc view name 2
    ✓ Changes with style = all_docs
    ✓ Changes with style = all_docs and a callback for complete
    ✓ Changes limit = 0
    ✓ Changes doc
    - Descending many changes
    ✓ live-changes
    ✓ Multiple watchers
    ✓ Continuous changes doc
    ✓ Cancel changes (320ms)
    ✓ #3579 changes firing 1 too many times (66ms)
    ✓ Kill database while listening to live changes
    ✓ #3136 style=all_docs
    ✓ #4191 revs_diff causes endless loop
    ✓ #3136 style=all_docs & include_docs
    ✓ changes-filter with query params
    ✓ Non-live changes filter
    ✓ Non-live changes filter, descending
    ✓ #2569 Non-live doc_ids filter
    ✓ #2569 Big non-live doc_ids filter
    ✓ #2569 Live doc_ids filter
    ✓ #2569 Big live doc_ids filter
    ✓ #2569 Non-live doc_ids filter with filter=_doc_ids
    ✓ #2569 Live doc_ids filter with filter=_doc_ids
    ✓ Changes to same doc are grouped
    ✓ Changes with conflicts are handled correctly
    ✓ Change entry for a deleted doc
    ✓ changes large number of docs
    ✓ Calling db.changes({since: 'now'})
    ✓ Calling db.changes({since: 'latest'})
    ✓ Closing db does not cause a crash if changes cancelled
    ✓ fire-complete-on-cancel (101ms)
    ✓ changes are not duplicated (1016ms)
    ✓ supports return_docs=false
    ✓ should respects limit (63ms)
    ✓ doesn't throw if opts.complete is undefined
    ✓ handle individual changes in live replication (69ms)
    ✓ changes-filter without filter
    ✓ #3539 - Exception in changes is fine
    ✓ Changes with selector
    ✓ Changes with selector, explicit filter
    ✓ Changes with selector and mismatched filter
    ✓ Changes with limit and selector

  changes-standalone
    - Changes reports errors

  test.close.js-local
    ✓ should emit destroyed even when closed (sync)
    ✓ should emit destroyed even when closed (async)
precondition_failed: Database not open
    at Object.<anonymous> (/data/js-variants/multee/Clients/levelup/pouchdb/packages/node_modules/pouchdb/lib/index.js:614:16)
    at Module._compile (node:internal/modules/cjs/loader:1105:14)
    at Module._extensions..js (node:internal/modules/cjs/loader:1159:10)
    at Module.load (node:internal/modules/cjs/loader:981:32)
    at Module._load (node:internal/modules/cjs/loader:827:12)
    at Module.require (node:internal/modules/cjs/loader:1005:19)
    at require (node:internal/modules/cjs/helpers:102:18)
    at commonUtils.loadPouchDBForNode (/data/js-variants/multee/Clients/levelup/pouchdb/tests/common-utils.js:92:17)
    at commonUtils.loadPouchDB (/data/js-variants/multee/Clients/levelup/pouchdb/tests/common-utils.js:78:39)
    at Object.<anonymous> (/data/js-variants/multee/Clients/levelup/pouchdb/tests/integration/node.setup.js:21:28)
    at Module._compile (node:internal/modules/cjs/loader:1105:14)
    at Module._extensions..js (node:internal/modules/cjs/loader:1159:10)
    at Module.load (node:internal/modules/cjs/loader:981:32)
    at Module._load (node:internal/modules/cjs/loader:827:12)
    at Module.require (node:internal/modules/cjs/loader:1005:19)
    at require (node:internal/modules/cjs/helpers:102:18)
    at /data/js-variants/multee/Clients/levelup/pouchdb/node_modules/mocha/bin/_mocha:366:3
    at Array.forEach (<anonymous>)
    at Object.<anonymous> (/data/js-variants/multee/Clients/levelup/pouchdb/node_modules/mocha/bin/_mocha:365:10)
    at Module._compile (node:internal/modules/cjs/loader:1105:14)
    at Module._extensions..js (node:internal/modules/cjs/loader:1159:10)
    at Module.load (node:internal/modules/cjs/loader:981:32)
    at Module._load (node:internal/modules/cjs/loader:827:12)
    at Function.executeUserEntryPoint [as runMain] (node:internal/modules/run_main:77:12)
    at node:internal/main/run_main_module:17:47
    ✓ should emit closed even when destroyed (async #2)
precondition_failed: Database not open
    at Object.<anonymous> (/data/js-variants/multee/Clients/levelup/pouchdb/packages/node_modules/pouchdb/lib/index.js:614:16)
    at Module._compile (node:internal/modules/cjs/loader:1105:14)
    at Module._extensions..js (node:internal/modules/cjs/loader:1159:10)
    at Module.load (node:internal/modules/cjs/loader:981:32)
    at Module._load (node:internal/modules/cjs/loader:827:12)
    at Module.require (node:internal/modules/cjs/loader:1005:19)
    at require (node:internal/modules/cjs/helpers:102:18)
    at commonUtils.loadPouchDBForNode (/data/js-variants/multee/Clients/levelup/pouchdb/tests/common-utils.js:92:17)
    at commonUtils.loadPouchDB (/data/js-variants/multee/Clients/levelup/pouchdb/tests/common-utils.js:78:39)
    at Object.<anonymous> (/data/js-variants/multee/Clients/levelup/pouchdb/tests/integration/node.setup.js:21:28)
    at Module._compile (node:internal/modules/cjs/loader:1105:14)
    at Module._extensions..js (node:internal/modules/cjs/loader:1159:10)
    at Module.load (node:internal/modules/cjs/loader:981:32)
    at Module._load (node:internal/modules/cjs/loader:827:12)
    at Module.require (node:internal/modules/cjs/loader:1005:19)
    at require (node:internal/modules/cjs/helpers:102:18)
    at /data/js-variants/multee/Clients/levelup/pouchdb/node_modules/mocha/bin/_mocha:366:3
    at Array.forEach (<anonymous>)
    at Object.<anonymous> (/data/js-variants/multee/Clients/levelup/pouchdb/node_modules/mocha/bin/_mocha:365:10)
    at Module._compile (node:internal/modules/cjs/loader:1105:14)
    at Module._extensions..js (node:internal/modules/cjs/loader:1159:10)
    at Module.load (node:internal/modules/cjs/loader:981:32)
    at Module._load (node:internal/modules/cjs/loader:827:12)
    at Function.executeUserEntryPoint [as runMain] (node:internal/modules/run_main:77:12)
    at node:internal/main/run_main_module:17:47
    ✓ test unref for coverage
    ✓ test double unref for coverage
precondition_failed: Database not open
    at Object.<anonymous> (/data/js-variants/multee/Clients/levelup/pouchdb/packages/node_modules/pouchdb/lib/index.js:614:16)
    at Module._compile (node:internal/modules/cjs/loader:1105:14)
    at Module._extensions..js (node:internal/modules/cjs/loader:1159:10)
    at Module.load (node:internal/modules/cjs/loader:981:32)
    at Module._load (node:internal/modules/cjs/loader:827:12)
    at Module.require (node:internal/modules/cjs/loader:1005:19)
    at require (node:internal/modules/cjs/helpers:102:18)
    at commonUtils.loadPouchDBForNode (/data/js-variants/multee/Clients/levelup/pouchdb/tests/common-utils.js:92:17)
    at commonUtils.loadPouchDB (/data/js-variants/multee/Clients/levelup/pouchdb/tests/common-utils.js:78:39)
    at Object.<anonymous> (/data/js-variants/multee/Clients/levelup/pouchdb/tests/integration/node.setup.js:21:28)
    at Module._compile (node:internal/modules/cjs/loader:1105:14)
    at Module._extensions..js (node:internal/modules/cjs/loader:1159:10)
    at Module.load (node:internal/modules/cjs/loader:981:32)
    at Module._load (node:internal/modules/cjs/loader:827:12)
    at Module.require (node:internal/modules/cjs/loader:1005:19)
    at require (node:internal/modules/cjs/helpers:102:18)
    at /data/js-variants/multee/Clients/levelup/pouchdb/node_modules/mocha/bin/_mocha:366:3
    at Array.forEach (<anonymous>)
    at Object.<anonymous> (/data/js-variants/multee/Clients/levelup/pouchdb/node_modules/mocha/bin/_mocha:365:10)
    at Module._compile (node:internal/modules/cjs/loader:1105:14)
    at Module._extensions..js (node:internal/modules/cjs/loader:1159:10)
    at Module.load (node:internal/modules/cjs/loader:981:32)
    at Module._load (node:internal/modules/cjs/loader:827:12)
    at Function.executeUserEntryPoint [as runMain] (node:internal/modules/run_main:77:12)
    at node:internal/main/run_main_module:17:47
    ✓ test close-then-destroyed for coverage
************* run test done *************
pouchdb is testing ./Variants/levelup/variant2/levelup
/data/js-variants/multee
************* npm unlink module *************

removed 1 package, changed 1 package, and audited 1032 packages in 6s

64 packages are looking for funding
  run `npm fund` for details

41 vulnerabilities (1 low, 9 moderate, 25 high, 6 critical)

To address issues that do not require attention, run:
  npm audit fix

To address all issues possible (including breaking changes), run:
  npm audit fix --force

Some issues need review, and may require choosing
a different dependency.

Run `npm audit` for details.
************* npm unlink module done *************
************* npm unlink globally *************

removed 1 package, and audited 1 package in 1s

found 0 vulnerabilities
************* npm unlink globally done *************
************* npm link globally *************

added 1 package, and audited 3 packages in 438ms

found 0 vulnerabilities
************* npm link globally done *************
************* npm link module *************

added 1 package, changed 1 package, and audited 1034 packages in 4s

64 packages are looking for funding
  run `npm fund` for details

41 vulnerabilities (1 low, 9 moderate, 25 high, 6 critical)

To address issues that do not require attention, run:
  npm audit fix

To address all issues possible (including breaking changes), run:
  npm audit fix --force

Some issues need review, and may require choosing
a different dependency.

Run `npm audit` for details.
************* npm link module done *************
************* start run test *************

> pouchdb-monorepo@7.0.0-prerelease test
> bash bin/run-test.sh


> pouchdb-monorepo@7.0.0-prerelease build-node
> bash bin/build-node.sh


> pouchdb-monorepo@7.0.0-prerelease build-modules
> node bin/build-modules.js

Building pouchdb...
Building pouchdb-abstract-mapreduce...
Building pouchdb-adapter-http...
Building pouchdb-adapter-idb...
Building pouchdb-adapter-indexeddb...
Building pouchdb-adapter-leveldb...
Building pouchdb-adapter-leveldb-core...
Building pouchdb-adapter-localstorage...
Building pouchdb-adapter-memory...
Building pouchdb-adapter-utils...
Building pouchdb-binary-utils...
Building pouchdb-browser...
Building pouchdb-changes-filter...
Building pouchdb-checkpointer...
Building pouchdb-collate...
Building pouchdb-collections...
Building pouchdb-core...
Building pouchdb-errors...
Building pouchdb-fetch...
Building pouchdb-find...
Building pouchdb-for-coverage...
Building pouchdb-generate-replication-id...
Building pouchdb-json...
Building pouchdb-mapreduce...
Building pouchdb-mapreduce-utils...
Building pouchdb-md5...
Building pouchdb-merge...
Building pouchdb-node...
Building pouchdb-replication...
Building pouchdb-selector-core...
Building pouchdb-utils...
Building sublevel-pouchdb...
  ✓ wrote pouchdb-adapter-localstorage/lib/index.js in vanilla mode
  ✓ wrote pouchdb-adapter-localstorage/lib/index.es.js in vanilla mode
  ✓ wrote pouchdb-adapter-memory/lib/index.js in vanilla mode
  ✓ wrote pouchdb-adapter-memory/lib/index.es.js in vanilla mode
  ✓ wrote pouchdb-checkpointer/lib/index.js in vanilla mode
  ✓ wrote pouchdb-checkpointer/lib/index.es.js in vanilla mode
  ✓ wrote pouchdb-errors/lib/index.js in vanilla mode
  ✓ wrote pouchdb-errors/lib/index.es.js in vanilla mode
  ✓ wrote pouchdb-generate-replication-id/lib/index.js in vanilla mode
  ✓ wrote pouchdb-generate-replication-id/lib/index.es.js in vanilla mode
  ✓ wrote pouchdb-adapter-http/lib/index.js in vanilla mode
  ✓ wrote pouchdb-adapter-http/lib/index.es.js in vanilla mode
  ✓ wrote pouchdb-adapter-leveldb-core/lib/index.js in node mode
  ✓ wrote pouchdb-adapter-leveldb-core/lib/index.es.js in node mode
  ✓ wrote pouchdb-adapter-leveldb-core/lib/index-browser.js in browser mode
  ✓ wrote pouchdb-adapter-leveldb-core/lib/index-browser.es.js in browser mode
  ✓ wrote pouchdb-adapter-leveldb/lib/index.js in node mode
  ✓ wrote pouchdb-adapter-leveldb/lib/index.es.js in node mode
  ✓ wrote pouchdb-adapter-leveldb/lib/index-browser.js in browser mode
  ✓ wrote pouchdb-adapter-leveldb/lib/index-browser.es.js in browser mode
  ✓ wrote pouchdb-changes-filter/lib/index-browser.js in browser mode
  ✓ wrote pouchdb-changes-filter/lib/index-browser.es.js in browser mode
  ✓ wrote pouchdb-fetch/lib/index-browser.js in browser mode
  ✓ wrote pouchdb-fetch/lib/index-browser.es.js in browser mode
  ✓ wrote pouchdb-md5/lib/index-browser.js in browser mode
  ✓ wrote pouchdb-md5/lib/index-browser.es.js in browser mode
  ✓ wrote pouchdb-changes-filter/lib/index.js in node mode
  ✓ wrote pouchdb-changes-filter/lib/index.es.js in node mode
  ✓ wrote pouchdb-collate/lib/index.js in vanilla mode
  ✓ wrote pouchdb-collate/lib/index.es.js in vanilla mode
  ✓ wrote pouchdb-fetch/lib/index.es.js in node mode
  ✓ wrote pouchdb-fetch/lib/index.js in node mode
  ✓ wrote pouchdb-json/lib/index.js in vanilla mode
  ✓ wrote pouchdb-json/lib/index.es.js in vanilla mode
  ✓ wrote pouchdb-mapreduce-utils/lib/index.js in vanilla mode
  ✓ wrote pouchdb-mapreduce-utils/lib/index.es.js in vanilla mode
  ✓ wrote pouchdb-md5/lib/index.js in node mode
  ✓ wrote pouchdb-md5/lib/index.es.js in node mode
  ✓ wrote pouchdb-abstract-mapreduce/lib/index.js in vanilla mode
  ✓ wrote pouchdb-abstract-mapreduce/lib/index.es.js in vanilla mode
  ✓ wrote pouchdb-adapter-indexeddb/lib/index.js in vanilla mode
  ✓ wrote pouchdb-adapter-indexeddb/lib/index.es.js in vanilla mode
  ✓ wrote pouchdb-adapter-idb/lib/index.js in vanilla mode
  ✓ wrote pouchdb-adapter-idb/lib/index.es.js in vanilla mode
  ✓ wrote pouchdb-binary-utils/lib/index-browser.js in browser mode
  ✓ wrote pouchdb-binary-utils/lib/index-browser.es.js in browser mode
  ✓ wrote pouchdb-utils/lib/index-browser.js in browser mode
  ✓ wrote pouchdb-utils/lib/index-browser.es.js in browser mode
  ✓ wrote pouchdb-utils/lib/index.js in node mode
  ✓ wrote pouchdb-utils/lib/index.es.js in node mode
  ✓ wrote pouchdb-binary-utils/lib/index.js in node mode
  ✓ wrote pouchdb-binary-utils/lib/index.es.js in node mode
  ✓ wrote pouchdb-adapter-utils/lib/index.js in vanilla mode
  ✓ wrote pouchdb-adapter-utils/lib/index.es.js in vanilla mode
  ✓ wrote pouchdb-collections/lib/index.js in vanilla mode
  ✓ wrote pouchdb-collections/lib/index.es.js in vanilla mode
  ✓ wrote pouchdb-merge/lib/index.js in vanilla mode
  ✓ wrote pouchdb-merge/lib/index.es.js in vanilla mode
  ✓ wrote pouchdb-selector-core/lib/index.js in vanilla mode
  ✓ wrote pouchdb-selector-core/lib/index.es.js in vanilla mode
  ✓ wrote sublevel-pouchdb/lib/index.js in vanilla mode
  ✓ wrote sublevel-pouchdb/lib/index.es.js in vanilla mode
  ✓ wrote pouchdb-mapreduce/lib/index-browser.js in browser mode
  ✓ wrote pouchdb-mapreduce/lib/index-browser.es.js in browser mode
  ✓ wrote pouchdb-replication/lib/index.js in vanilla mode
  ✓ wrote pouchdb-replication/lib/index.es.js in vanilla mode
  ✓ wrote pouchdb-mapreduce/lib/index.js in node mode
  ✓ wrote pouchdb-mapreduce/lib/index.es.js in node mode
  ✓ wrote pouchdb-core/lib/index.js in vanilla mode
  ✓ wrote pouchdb-core/lib/index.es.js in vanilla mode
  ✓ wrote pouchdb-find/lib/index.js in node mode
  ✓ wrote pouchdb-find/lib/index.es.js in node mode
  ✓ wrote pouchdb-find/lib/index-browser.js in browser mode
  ✓ wrote pouchdb-find/lib/index-browser.es.js in browser mode
  ✓ wrote pouchdb-for-coverage/lib/index.js in node mode
  ✓ wrote pouchdb-for-coverage/lib/index.es.js in node mode
  ✓ wrote pouchdb-for-coverage/lib/index-browser.js in browser mode
  ✓ wrote pouchdb-for-coverage/lib/index-browser.es.js in browser mode
  ✓ wrote pouchdb-browser/lib/index.js in vanilla mode
  ✓ wrote pouchdb-browser/lib/index.es.js in vanilla mode
  ✓ wrote pouchdb-node/lib/index.js in vanilla mode
  ✓ wrote pouchdb-node/lib/index.es.js in vanilla mode
  ✓ wrote packages/node_modules/pouchdb/lib/index.js
  ✓ wrote packages/node_modules/pouchdb/lib/index.es.js
Waiting for host to start ..
Host started :)
> pouchdb-monorepo@7.0.0-prerelease test-node
> bash bin/test-node.sh

Down server listening on port 3010
Seeded with: 1660143342992


  DB Setup
    ✓ PouchDB has a version
    ✓ PouchDB version matches package.json

  test.active_tasks.js
    ✓ Can add a task
    ✓ Can get tasks by id
    ✓ Can get all tasks
    ✓ Can update a task
    ✓ Can remove a task

  test.all_docs.js-http
    ✓ Testing all docs (165ms)
    ✓ Testing allDocs opts.keys (59ms)
    ✓ Testing allDocs opts.keys with skip
    ✓ Testing allDocs opts.keys with limit
    ✓ Testing allDocs invalid opts.keys
    ✓ Testing deleting in changes (42ms)
    ✓ Testing updating in changes (46ms)
    ✓ Testing include docs
    ✓ Testing conflicts (49ms)
    ✓ test basic collation
    ✓ 3883 start_key end_key aliases
    ✓ test total_rows with a variety of criteria (133ms)
    ✓ test total_rows with both skip and limit
    ✓ test limit option and total_rows
    ✓ test escaped startkey/endkey
    ✓ test "key" option
    ✓ test inclusive_end=false (55ms)
    ✓ test descending with startkey/endkey
    ✓ #3082 test wrong num results returned (254ms)
    ✓ test empty db
    ✓ test after db close
    ✓ 5793 _conflicts should not exist if no conflicts
    ✓ #6230 Test allDocs opts update_seq: false
    ✓ #6230 Test allDocs opts update_seq: true
    ✓ #6230 Test allDocs opts with update_seq missing

  test.all_docs.js-local
    ✓ Testing all docs
    ✓ Testing allDocs opts.keys
    ✓ Testing allDocs opts.keys with skip
    ✓ Testing allDocs opts.keys with limit
    ✓ Testing allDocs invalid opts.keys
    ✓ Testing deleting in changes
    ✓ Testing updating in changes
    ✓ Testing include docs
    ✓ Testing conflicts
    ✓ test basic collation
    ✓ 3883 start_key end_key aliases
    ✓ test total_rows with a variety of criteria
    ✓ test total_rows with both skip and limit
    ✓ test limit option and total_rows
    ✓ test escaped startkey/endkey
    ✓ test "key" option
    ✓ test inclusive_end=false
    ✓ test descending with startkey/endkey
    ✓ #3082 test wrong num results returned (186ms)
    ✓ test empty db
    ✓ test after db close
    ✓ test unicode ids and revs
    ✓ 5793 _conflicts should not exist if no conflicts
    ✓ #6230 Test allDocs opts update_seq: false
    ✓ #6230 Test allDocs opts update_seq: true
    ✓ #6230 Test allDocs opts with update_seq missing

  suite2 test.attachments.js-local
    ✓ 3357 Attachment names cant start with _
    ✓ 5736 warning for putAttachment without content_type
    ✓ 5736 warning for bulkDocs attachments without content_type
    ✓ fetch atts with open_revs and missing
    ✓ issue 2803 should throw 412
    ✓ issue 2803 should throw 412 part 2
    ✓ issue 2803 should throw 412 part 3
    ✓ issue 2803 should throw 412 part 4
    ✓ #2858 {binary: true} in get()
    ✓ #2858 {binary: true} in allDocs() 1
    ✓ #2858 {binary: true} in allDocs() 2
    ✓ #2858 {binary: true} in allDocs() 3
    ✓ #2858 {binary: true} in allDocs() 4
    ✓ #2858 {binary: true} in allDocs() 5
    ✓ #2858 {binary: true} in allDocs(), many atts
    ✓ #2858 {binary: true} in allDocs(), mixed atts
    ✓ #2858 {binary: true} in changes() non-live
    ✓ #2858 {binary: true} in changes() non-live, many atts
    ✓ #2858 {binary: true} in changes() non-live, mixed atts
    ✓ #2858 {binary: true} non-live changes, complete event
    ✓ #2858 {binary: true} in live changes
    ✓ #2858 {binary: true} in live changes, mixed atts
    ✓ #2858 {binary: true} in live+retry changes
    ✓ #2858 {binary: true} in live changes, attachments:false
    ✓ #2858 {binary: true} in live changes, include_docs:false
    ✓ #6736 {binary: true} in bulkGet()
    ✓ Measures length correctly after put()
    ✓ #3074 non-live changes()
    ✓ #3074 live changes()
    ✓ #3074 non-live changes(), no attachments
    ✓ #3074 live changes(), no attachments
    ✓ #3881 filter extraneous keys from _attachments
    ✓ #2771 allDocs() 1, single attachment
    ✓ #2771 allDocs() 2, many docs same att
    ✓ #2771 allDocs() 3, many docs diff atts
    ✓ #2771 allDocs() 4, mix of atts and no atts
    ✓ #2771 allDocs() 5, no atts
    ✓ #2771 allDocs() 6, no docs
    ✓ #2771 allDocs() 7, revisions and deletions
    ✓ #2771 allDocs() 8, empty attachment
    ✓ No length for non-stubs
    ✓ Test some attachments
    ✓ Test getAttachment
    ✓ Test getAttachment with stubs
    ✓ Test get() with binary:true and stubs
    ✓ Test attachments in allDocs/changes
    ✓ Test putAttachment with base64 plaintext
    ✓ Test putAttachment with invalid base64
    ✓ Test getAttachment with empty text
    ✓ Test getAttachment with normal text
    ✓ Test getAttachment with PNG
    ✓ Test getAttachment with PNG using bulkDocs
    ✓ Test getAttachment with PNG using post
    ✓ Test postAttachment with PNG then bulkDocs
    ✓ proper stub behavior
    ✓ Testing with invalid docs
    ✓ Test create attachment and doc in one go
    ✓ Test create attachment and doc in one go without callback
    ✓ Test create attachment without callback
    ✓ Test put attachment on a doc without attachments
    ✓ Test put attachment with unencoded name
    ✓ 3963 length property on stubs
    ✓ Testing with invalid rev
    ✓ Test put another attachment on a doc with attachments
    ✓ Test get with attachments: true if empty attachments
    ✓ Test delete attachment from a doc
    ✓ Test a document with a json string attachment
    ✓ Test remove doc with attachment
    ✓ Try to insert a doc with unencoded attachment
    ✓ Try to get attachment of unexistent doc
    ✓ Test synchronous putAttachment with text data
    ✓ Test synchronous putAttachment with no text data
    ✓ Test put with partial stubs
    ✓ Test put with attachments and new_edits=false
    ✓ Test getAttachment with specific rev
    ✓ Test getAttachment with diff revs and content
    ✓ Test stubs
    ✓ Try to get unexistent attachment of some doc
    ✓ putAttachment and getAttachment with plaintext
    ✓ putAttachment and getAttachment with png data
    ✓ putAttachment in new doc with base64
    ✓ #2818 - save same attachment in different revs
    ✓ #2818 - save same attachment many times in parallel
    ✓ #2818 - revisions keep attachments (no compaction)
    ✓ #2818 - doesn't throw 409 if same filename
    ✓ #3008 test correct encoding/decoding of \u0000 etc.
    ✓ putAttachment and getAttachment with big png data (98ms)
    ✓ #2709 `revpos` with putAttachment
    ✓ #2709 `revpos` with inline attachment
    ✓ #2709 `revpos` with allDocs
    ✓ #7403 {attachments: true, binary: true, include_docs: true} in allDocs with one missing doc

  suite2 test.attachments.js-http
    ✓ 3357 Attachment names cant start with _
    ✓ 5736 warning for putAttachment without content_type
    ✓ 5736 warning for bulkDocs attachments without content_type
    ✓ fetch atts with open_revs and missing
    ✓ issue 2803 should throw 412
    ✓ issue 2803 should throw 412 part 2
    ✓ issue 2803 should throw 412 part 3
    ✓ issue 2803 should throw 412 part 4
    ✓ #2858 {binary: true} in get()
    ✓ #2858 {binary: true} in allDocs() 1
    ✓ #2858 {binary: true} in allDocs() 2
    ✓ #2858 {binary: true} in allDocs() 3
    ✓ #2858 {binary: true} in allDocs() 4
    ✓ #2858 {binary: true} in allDocs() 5
    ✓ #2858 {binary: true} in allDocs(), many atts
    ✓ #2858 {binary: true} in allDocs(), mixed atts
    ✓ #2858 {binary: true} in changes() non-live
    ✓ #2858 {binary: true} in changes() non-live, many atts
    ✓ #2858 {binary: true} in changes() non-live, mixed atts
    ✓ #2858 {binary: true} non-live changes, complete event
    ✓ #2858 {binary: true} in live changes
    ✓ #2858 {binary: true} in live changes, mixed atts
    ✓ #2858 {binary: true} in live+retry changes
    ✓ #2858 {binary: true} in live changes, attachments:false
    ✓ #2858 {binary: true} in live changes, include_docs:false
    ✓ #6736 {binary: true} in bulkGet()
    ✓ Measures length correctly after put()
    ✓ #3074 non-live changes() (39ms)
    ✓ #3074 live changes() (53ms)
    ✓ #3074 non-live changes(), no attachments
    ✓ #3074 live changes(), no attachments
    ✓ #3881 filter extraneous keys from _attachments
    ✓ #2771 allDocs() 1, single attachment
    ✓ #2771 allDocs() 2, many docs same att
    ✓ #2771 allDocs() 3, many docs diff atts
    ✓ #2771 allDocs() 4, mix of atts and no atts
    ✓ #2771 allDocs() 5, no atts
    ✓ #2771 allDocs() 6, no docs
    ✓ #2771 allDocs() 7, revisions and deletions
    ✓ #2771 allDocs() 8, empty attachment (52ms)
    ✓ No length for non-stubs
    ✓ Test some attachments (40ms)
    ✓ Test getAttachment
    ✓ Test getAttachment with stubs
    ✓ Test get() with binary:true and stubs
    ✓ Test attachments in allDocs/changes
    ✓ Test putAttachment with base64 plaintext
    ✓ Test putAttachment with invalid base64
    ✓ Test getAttachment with empty text
    ✓ Test getAttachment with normal text
    ✓ Test getAttachment with PNG
    ✓ Test getAttachment with PNG using bulkDocs
    ✓ Test getAttachment with PNG using post
    ✓ Test postAttachment with PNG then bulkDocs
    ✓ proper stub behavior
    ✓ Testing with invalid docs
    ✓ Test create attachment and doc in one go
    ✓ Test create attachment and doc in one go without callback
    ✓ Test create attachment without callback
    ✓ Test put attachment on a doc without attachments
    ✓ Test put attachment with unencoded name
    ✓ 3963 length property on stubs (112ms)
    ✓ Testing with invalid rev
    ✓ Test put another attachment on a doc with attachments
    ✓ Test get with attachments: true if empty attachments
    ✓ Test delete attachment from a doc (38ms)
    ✓ Test a document with a json string attachment
    ✓ Test remove doc with attachment
    ✓ Try to insert a doc with unencoded attachment
    ✓ Try to get attachment of unexistent doc
    ✓ Test synchronous putAttachment with text data
    ✓ Test synchronous putAttachment with no text data
    ✓ Test put with partial stubs
    ✓ Test put with attachments and new_edits=false
    ✓ Test getAttachment with specific rev
    ✓ Test getAttachment with diff revs and content
    ✓ Test stubs
    ✓ Try to get unexistent attachment of some doc
    ✓ putAttachment and getAttachment with plaintext
    ✓ putAttachment and getAttachment with png data
    ✓ putAttachment in new doc with base64
    ✓ #2818 - save same attachment in different revs (46ms)
    ✓ #2818 - save same attachment many times in parallel
    ✓ #2818 - revisions keep attachments (no compaction) (38ms)
    ✓ #2818 - doesn't throw 409 if same filename
    ✓ #3008 test correct encoding/decoding of \u0000 etc.
    ✓ putAttachment and getAttachment with big png data (131ms)
    ✓ #2709 `revpos` with putAttachment (42ms)
    ✓ #2709 `revpos` with inline attachment
    ✓ #2709 `revpos` with allDocs
    ✓ #7403 {attachments: true, binary: true, include_docs: true} in allDocs with one missing doc

  suite2 test.attachments.js- local:http
    ✓ Attachments replicate back and forth (108ms)
    ✓ Replicate same doc, same atts (109ms)
    ✓ Replicate same doc, same atts 2 (109ms)
    ✓ Attachments replicate (66ms)
    ✓ Attachment types replicate (51ms)
    ✓ Many many attachments replicate (207ms)
    ✓ Many many png attachments replicate (263ms)
    ✓ Multiple attachments replicate (80ms)
    - #3961 Many attachments on same doc
    ✓ Multiple attachments replicate, different docs (#2698) (76ms)
    ✓ Multiple attachments replicate, different docs png (#2698) (92ms)
    ✓ #3932 attachments with tricky revpos (127ms)
    ✓ replication with changing attachments (102ms)
    ✓ 3955 race condition in put
    ✓ #8456 bad attachment rev after replication (119ms)

  suite2 test.attachments.js- http:http
    ✓ Attachments replicate back and forth (160ms)
    ✓ Replicate same doc, same atts (173ms)
    ✓ Replicate same doc, same atts 2 (170ms)
    ✓ Attachments replicate (76ms)
    ✓ Attachment types replicate (94ms)
    ✓ Many many attachments replicate (385ms)
    ✓ Many many png attachments replicate (328ms)
    ✓ Multiple attachments replicate (127ms)
    - #3961 Many attachments on same doc
    ✓ Multiple attachments replicate, different docs (#2698) (120ms)
    ✓ Multiple attachments replicate, different docs png (#2698) (179ms)
    ✓ #3932 attachments with tricky revpos (223ms)
    ✓ replication with changing attachments (155ms)
    ✓ 3955 race condition in put
    ✓ #8456 bad attachment rev after replication (173ms)

  suite2 test.attachments.js- http:local
    ✓ Attachments replicate back and forth (114ms)
    ✓ Replicate same doc, same atts (97ms)
    ✓ Replicate same doc, same atts 2 (99ms)
    ✓ Attachments replicate (51ms)
    ✓ Attachment types replicate (50ms)
    ✓ Many many attachments replicate (243ms)
    ✓ Many many png attachments replicate (151ms)
    ✓ Multiple attachments replicate (118ms)
    - #3961 Many attachments on same doc
    ✓ Multiple attachments replicate, different docs (#2698) (74ms)
    ✓ Multiple attachments replicate, different docs png (#2698) (86ms)
    ✓ #3932 attachments with tricky revpos (152ms)
    ✓ replication with changing attachments (88ms)
    ✓ 3955 race condition in put
    ✓ #8456 bad attachment rev after replication (119ms)

  suite2 test.attachments.js- local:local
    ✓ Attachments replicate back and forth
    ✓ Replicate same doc, same atts
    ✓ Replicate same doc, same atts 2
    ✓ Attachments replicate
    ✓ Attachment types replicate
    ✓ Many many attachments replicate
    ✓ Many many png attachments replicate
    ✓ Multiple attachments replicate
    - #3961 Many attachments on same doc
    ✓ Multiple attachments replicate, different docs (#2698)
    ✓ Multiple attachments replicate, different docs png (#2698)
    ✓ #3932 attachments with tricky revpos
    ✓ replication with changing attachments
    ✓ 3955 race condition in put
    ✓ #8456 bad attachment rev after replication

  test.basics.js-http
    ✓ Create a pouch without new keyword
    ✓ Name is accessible via instance
    ✓ 4314 Create a pouch with + in name
    ✓ Creating Pouch without name will throw
    ✓ 4314 Create a pouch with urlencoded name
    ✓ 4219 destroy a pouch
    ✓ 4339 throw useful error if method called on stale instance (38ms)
    ✓ [4595] should reject xhr errors
    ✓ [4595] should emit error event on xhr error
    ✓ Add a doc
    ✓ Get invalid id
    ✓ Missing doc should contain ID in error object
    ✓ PUTed Conflicted doc should contain ID in error object
    ✓ POSTed Conflicted doc should contain ID in error object
    ✓ Add a doc with a promise
    ✓ Add a doc with opts object
    ✓ Modify a doc
    ✓ Modifying a doc that has rewritten content
    ✓ Modify a doc with a promise
    ✓ Read db id
    ✓ Read db id with promise
    ✓ Close db
    ✓ Close db with a promise
    ✓ Read db id after closing Close
    ✓ Modify a doc with incorrect rev
    ✓ Remove doc
    ✓ Remove doc with a promise
    ✓ Remove doc with new syntax
    ✓ Remove doc with new syntax and a promise
    ✓ Doc removal leaves only stub
    ✓ Remove doc twice with specified id
    ✓ Remove doc, no callback
    ✓ Delete document without id
    ✓ Delete document with many args
    ✓ Delete document with many args, callback style
    ✓ Delete doc with id + rev + no opts
    ✓ Delete doc with id + rev + no opts, callback style
    ✓ Delete doc with doc + opts
    ✓ Delete doc with doc + opts, callback style
    ✓ Delete doc with rev in opts
    ✓ Bulk docs
    ✓ Bulk docs with a promise
    ✓ Basic checks
    ✓ update with invalid rev
    ✓ Doc validation
    ✓ Replication fields (#2442)
    ✓ Testing issue #48 (54ms)
    ✓ Testing valid id
    ✓ Put doc without _id should fail
    ✓ Put doc with bad reserved id should fail
    ✓ update_seq persists
    ✓ deletions persists
    ✓ #4126 should not store raw Dates
    ✓ Create a db with a reserved name
    ✓ Error when document is not an object
    ✓ Test instance update_seq updates correctly
    ✓ Fail to fetch a doc after db was deleted (51ms)
    ✓ Fail to fetch a doc after db was deleted (50ms)
    ✓ Cant add docs with empty ids
    ✓ Test doc with percent in ID
    ✓ db.info should give auto_compaction = false (#2744)
    ✓ db.info should give auto_compaction = true (#2744)
    ✓ db.info should give adapter name (#3567)
    ✓ db.info should give correct doc_count
    ✓ putting returns {ok: true}
    ✓ putting is override-able
    ✓ issue 2779, deleted docs, old revs COUCHDB-292
    ✓ issue 2888, successive deletes and writes
    ✓ 2 invalid puts
    ✓ Docs save "null" value
    ✓ replace PouchDB.destroy() (express-pouchdb#203)
    ✓ 3968, keeps all object fields
    ✓ 4712 invalid rev for new doc generates conflict
    ✓ test info() after db close
    ✓ test get() after db close
    ✓ test close() after db close
    ✓ 7259 should have "this" keyword properly scoped
    ✓ #5471 PouchDB.plugin() should throw error if passed wrong type or empty object

  test.basics.js-local
    ✓ Create a pouch without new keyword
    ✓ Name is accessible via instance
    ✓ 4314 Create a pouch with + in name
    ✓ Creating Pouch without name will throw
    ✓ 4314 Create a pouch with urlencoded name
    ✓ 4219 destroy a pouch
    ✓ 4339 throw useful error if method called on stale instance
    ✓ [4595] should reject xhr errors
    ✓ [4595] should emit error event on xhr error
    ✓ Add a doc
    ✓ Get invalid id
    ✓ Missing doc should contain ID in error object
    ✓ PUTed Conflicted doc should contain ID in error object
    ✓ POSTed Conflicted doc should contain ID in error object
    ✓ Add a doc with a promise
    ✓ Add a doc with opts object
    ✓ Modify a doc
    ✓ Modifying a doc that has rewritten content
    ✓ Modify a doc with a promise
    ✓ Read db id
    ✓ Read db id with promise
    ✓ Close db
    ✓ Close db with a promise
    ✓ Read db id after closing Close
    ✓ Modify a doc with incorrect rev
    ✓ Remove doc
    ✓ Remove doc with a promise
    ✓ Remove doc with new syntax
    ✓ Remove doc with new syntax and a promise
    ✓ Doc removal leaves only stub
    ✓ Remove doc twice with specified id
    ✓ Remove doc, no callback
    ✓ Delete document without id
    ✓ Delete document with many args
    ✓ Delete document with many args, callback style
    ✓ Delete doc with id + rev + no opts
    ✓ Delete doc with id + rev + no opts, callback style
    ✓ Delete doc with doc + opts
    ✓ Delete doc with doc + opts, callback style
    ✓ Delete doc with rev in opts
    ✓ Bulk docs
    ✓ Bulk docs with a promise
    ✓ Basic checks
    ✓ update with invalid rev
    ✓ Doc validation
    ✓ Replication fields (#2442)
    ✓ Allows _access field in documents (#8171)
    ✓ Testing issue #48 (54ms)
    ✓ Testing valid id
    ✓ Put doc without _id should fail
    ✓ Put doc with bad reserved id should fail
    ✓ update_seq persists
    ✓ deletions persists
    ✓ #4126 should not store raw Dates
    ✓ Create a db with a reserved name
    ✓ Error when document is not an object
    ✓ Test instance update_seq updates correctly
    ✓ Fail to fetch a doc after db was deleted
    ✓ Fail to fetch a doc after db was deleted
    ✓ Cant add docs with empty ids
    ✓ Test doc with percent in ID
    ✓ db.info should give auto_compaction = false (#2744)
    ✓ db.info should give auto_compaction = true (#2744)
    ✓ db.info should give adapter name (#3567)
    ✓ db.info should give correct doc_count
    ✓ putting returns {ok: true}
    ✓ putting is override-able
    ✓ issue 2779, deleted docs, old revs COUCHDB-292
    ✓ issue 2888, successive deletes and writes
    ✓ 2 invalid puts
    ✓ Docs save "null" value
    ✓ replace PouchDB.destroy() (express-pouchdb#203)
    ✓ 3968, keeps all object fields
    ✓ 4712 invalid rev for new doc generates conflict
    ✓ test info() after db close
    ✓ test get() after db close
    ✓ test close() after db close
    ✓ 7259 should have "this" keyword properly scoped
    ✓ should allow unicode doc ids
    ✓ should have same blob support for 2 dbs
    ✓ 6053, PouchDB.plugin() resets defaults
    ✓ #5471 PouchDB.plugin() should throw error if passed wrong type or empty object

  test.bulk_docs.js-local
    ✓ Testing bulk docs
    ✓ #6039 test id in bulk docs for conflict
    ✓ No id in bulk docs
    ✓ No _rev and new_edits=false
    ✓ 7829 bare rev 1- with new_edits=false
    ✓ Test empty bulkDocs
    ✓ Test many bulkDocs (46ms)
    ✓ Test errors on invalid doc id
    ✓ Test two errors on invalid doc id
    ✓ No docs
    ✓ Jira 911
    ✓ Test multiple bulkdocs
    ✓ #2935 new_edits=false correct number
    ✓ #2935 new_edits=false correct number 2
    ✓ bulk docs update then delete then conflict
    ✓ bulk_docs delete then undelete
    ✓ #2935 new_edits=false with single unauthorized
    ✓ Deleting _local docs with bulkDocs
    ✓ Deleting _local docs with bulkDocs, not found
    ✓ Deleting _local docs with bulkDocs, wrong rev
    ✓ Bulk with new_edits=false
    ✓ Testing successive new_edits to the same doc
    ✓ #3062 bulkDocs with staggered seqs
    ✓ Testing successive new_edits to the same doc, different content
    ✓ Testing successive new_edits to two doc
    ✓ Deletion with new_edits=false
    ✓ Deletion with new_edits=false, no history
    ✓ Modification with new_edits=false, no history
    ✓ Deletion with new_edits=false, no history, no revisions
    ✓ Testing new_edits=false in req body
    ✓ 656 regression in handling deleted docs
    ✓ Test quotes in doc ids
    ✓ Bulk docs empty list
    ✓ handles simultaneous writes
    ✓ bulk docs input by array
    ✓ Bulk empty list
    ✓ Bulk docs not an array
    ✓ Bulk docs not an object
    ✓ Bulk docs two different revisions to same document id
    ✓ 4204 respect revs_limit (319ms)
    ✓ 2839 implement revs_limit (177ms)
    ✓ 4372 revs_limit deletes old revisions of the doc
    ✓ 4372 revs_limit with auto_compaction deletes old revisions of the doc
    ✓ 4712 invalid rev for new doc generates conflict
    ✓ 5793 bulk docs accepts _conflicts when new_edits=false

  test.bulk_docs.js-http
    ✓ Testing bulk docs
    ✓ #6039 test id in bulk docs for conflict
    ✓ No id in bulk docs
    ✓ No _rev and new_edits=false
    ✓ 7829 bare rev 1- with new_edits=false
    ✓ Test empty bulkDocs
    ✓ Test many bulkDocs
    ✓ Test errors on invalid doc id
    ✓ Test two errors on invalid doc id
    ✓ No docs
    ✓ Jira 911
    ✓ Test multiple bulkdocs
    ✓ #2935 new_edits=false correct number
    ✓ #2935 new_edits=false correct number 2
    ✓ bulk docs update then delete then conflict
    ✓ bulk_docs delete then undelete (43ms)
    ✓ #2935 new_edits=false with single unauthorized
    ✓ Deleting _local docs with bulkDocs
    ✓ Bulk with new_edits=false
    ✓ Testing successive new_edits to the same doc
    ✓ #3062 bulkDocs with staggered seqs
    ✓ Testing successive new_edits to the same doc, different content
    ✓ Testing successive new_edits to two doc
    ✓ Deletion with new_edits=false
    ✓ Deletion with new_edits=false, no history
    ✓ Modification with new_edits=false, no history
    ✓ Deletion with new_edits=false, no history, no revisions
    ✓ Testing new_edits=false in req body
    ✓ 656 regression in handling deleted docs
    ✓ Test quotes in doc ids
    ✓ Bulk docs empty list
    ✓ handles simultaneous writes
    ✓ bulk docs input by array
    ✓ Bulk empty list
    ✓ Bulk docs not an array
    ✓ Bulk docs not an object
    ✓ Bulk docs two different revisions to same document id
    ✓ 4204 respect revs_limit (288ms)
    ✓ 2839 implement revs_limit
    ✓ 4372 revs_limit deletes old revisions of the doc
    ✓ 4372 revs_limit with auto_compaction deletes old revisions of the doc
    ✓ 4712 invalid rev for new doc generates conflict
    ✓ 5793 bulk docs accepts _conflicts when new_edits=false (42ms)

  test.bulk_get.js-http
    ✓ test bulk get with rev specified
    ✓ test bulk get with latest=true
    ✓ test bulk get with no rev specified
    ✓ _revisions is not returned by default
    ✓ #5886 bulkGet with reserved id
    ✓ _revisions is returned when specified
    ✓ _revisions is returned when specified, using implicit rev
    ✓ attachments are not included by default
    ✓ attachments are included when specified
    ✓ attachments are included when specified, using implicit rev

  test.bulk_get.js-local
    ✓ test bulk get with rev specified
    ✓ test bulk get with latest=true
    ✓ test bulk get with no rev specified
    ✓ _revisions is not returned by default
    ✓ #5886 bulkGet with reserved id
    ✓ _revisions is returned when specified
    ✓ _revisions is returned when specified, using implicit rev
    ✓ attachments are not included by default
    ✓ attachments are included when specified
    ✓ attachments are included when specified, using implicit rev

  test.changes.js-http
    ✓ All changes
    ✓ Changes with complete callback as param
    ✓ Promise resolved when changes cancelled
    - Live changes should clean listener when cancelled
    ✓ Changes Since
    ✓ Changes Since and limit limit 1
    ✓ Changes Since and limit limit 0
    ✓ Changes limit
    ✓ Changes with filter not present in ddoc
    ✓ Changes with `filters` key not present in ddoc
    ✓ Changes limit and filter
    ✓ Changes with shorthand function name
    ✓ Changes with filter from nonexistent ddoc
    ✓ Changes with view not present in ddoc
    ✓ Changes with `views` key not present in ddoc
    ✓ #4451 Changes with invalid view filter
    ✓ 3356 throw inside a filter
    ✓ Changes with missing param `view` in request
    ✓ Changes limit and view instead of filter
    ✓ #3609 view option implies filter: _view
    ✓ Immediately cancel changes
    ✓ Changes with invalid ddoc view name
    ✓ Changes with invalid ddoc view name 2
    ✓ Changes with style = all_docs (61ms)
    ✓ Changes with style = all_docs and a callback for complete (57ms)
    ✓ Changes limit = 0
    ✓ Changes doc
    - Descending many changes
    ✓ live-changes
    ✓ Multiple watchers
    ✓ Continuous changes doc
    ✓ Cancel changes (322ms)
    ✓ #3579 changes firing 1 too many times (73ms)
    ✓ Kill database while listening to live changes
    ✓ #3136 style=all_docs
    ✓ #4191 revs_diff causes endless loop
    ✓ #3136 style=all_docs & include_docs
    ✓ changes-filter with query params
    ✓ Non-live changes filter
    ✓ Non-live changes filter, descending
    ✓ #2569 Non-live doc_ids filter
    ✓ #2569 Big non-live doc_ids filter
    ✓ #2569 Live doc_ids filter
    ✓ #2569 Big live doc_ids filter
    ✓ #2569 Non-live doc_ids filter with filter=_doc_ids
    ✓ #2569 Live doc_ids filter with filter=_doc_ids
    ✓ Changes to same doc are grouped
    ✓ Changes with conflicts are handled correctly (145ms)
    ✓ Change entry for a deleted doc
    ✓ changes large number of docs (48ms)
    ✓ Calling db.changes({since: 'now'})
    ✓ Calling db.changes({since: 'latest'})
    ✓ Closing db does not cause a crash if changes cancelled
    ✓ fire-complete-on-cancel (100ms)
    ✓ changes are not duplicated (1028ms)
    ✓ supports return_docs=false
    ✓ should respects limit (70ms)
    ✓ doesn't throw if opts.complete is undefined
    ✓ handle individual changes in live replication (265ms)
    ✓ changes-filter without filter
    ✓ #3539 - Exception in changes is fine
    ✓ Changes with selector
    ✓ Changes with selector, explicit filter
    ✓ Changes with selector and mismatched filter
    ✓ Changes with limit and selector

  test.changes.js-local
    ✓ All changes
    ✓ Changes with complete callback as param
    ✓ Promise resolved when changes cancelled
    - Live changes should clean listener when cancelled
    ✓ Changes Since
    ✓ Changes Since and limit limit 1
    ✓ Changes Since and limit limit 0
    ✓ Changes limit
    ✓ Changes with filter not present in ddoc
    ✓ Changes with `filters` key not present in ddoc
    ✓ Changes limit and filter
    ✓ Changes with shorthand function name
    ✓ Changes with filter from nonexistent ddoc
    ✓ Changes with view not present in ddoc
    ✓ Changes with `views` key not present in ddoc
    ✓ #4451 Changes with invalid view filter
    ✓ 3356 throw inside a filter
    ✓ Changes with missing param `view` in request
    ✓ Changes limit and view instead of filter
    ✓ #3609 view option implies filter: _view
    ✓ Immediately cancel changes
    ✓ Changes with invalid ddoc view name
    ✓ Changes with invalid ddoc view name 2
    ✓ Changes with style = all_docs
    ✓ Changes with style = all_docs and a callback for complete
    ✓ Changes limit = 0
    ✓ Changes doc
    - Descending many changes
    ✓ live-changes
    ✓ Multiple watchers
    ✓ Continuous changes doc
    ✓ Cancel changes (315ms)
    ✓ #3579 changes firing 1 too many times (65ms)
    ✓ Kill database while listening to live changes
    ✓ #3136 style=all_docs
    ✓ #4191 revs_diff causes endless loop
    ✓ #3136 style=all_docs & include_docs
    ✓ changes-filter with query params
    ✓ Non-live changes filter
    ✓ Non-live changes filter, descending
    ✓ #2569 Non-live doc_ids filter
    ✓ #2569 Big non-live doc_ids filter
    ✓ #2569 Live doc_ids filter
    ✓ #2569 Big live doc_ids filter
    ✓ #2569 Non-live doc_ids filter with filter=_doc_ids
    ✓ #2569 Live doc_ids filter with filter=_doc_ids
    ✓ Changes to same doc are grouped
    ✓ Changes with conflicts are handled correctly
    ✓ Change entry for a deleted doc
    ✓ changes large number of docs
    ✓ Calling db.changes({since: 'now'})
    ✓ Calling db.changes({since: 'latest'})
    ✓ Closing db does not cause a crash if changes cancelled
    ✓ fire-complete-on-cancel (100ms)
    ✓ changes are not duplicated (1016ms)
    ✓ supports return_docs=false
    ✓ should respects limit (67ms)
    ✓ doesn't throw if opts.complete is undefined
    ✓ handle individual changes in live replication (75ms)
    ✓ changes-filter without filter
    ✓ #3539 - Exception in changes is fine
    ✓ Changes with selector
    ✓ Changes with selector, explicit filter
    ✓ Changes with selector and mismatched filter
    ✓ Changes with limit and selector

  changes-standalone
    - Changes reports errors

  test.close.js-local
    ✓ should emit destroyed even when closed (sync)
    ✓ should emit destroyed even when closed (async)
precondition_failed: Database not open
    at Object.<anonymous> (/data/js-variants/multee/Clients/levelup/pouchdb/packages/node_modules/pouchdb/lib/index.js:614:16)
    at Module._compile (node:internal/modules/cjs/loader:1105:14)
    at Module._extensions..js (node:internal/modules/cjs/loader:1159:10)
    at Module.load (node:internal/modules/cjs/loader:981:32)
    at Module._load (node:internal/modules/cjs/loader:827:12)
    at Module.require (node:internal/modules/cjs/loader:1005:19)
    at require (node:internal/modules/cjs/helpers:102:18)
    at commonUtils.loadPouchDBForNode (/data/js-variants/multee/Clients/levelup/pouchdb/tests/common-utils.js:92:17)
    at commonUtils.loadPouchDB (/data/js-variants/multee/Clients/levelup/pouchdb/tests/common-utils.js:78:39)
    at Object.<anonymous> (/data/js-variants/multee/Clients/levelup/pouchdb/tests/integration/node.setup.js:21:28)
    at Module._compile (node:internal/modules/cjs/loader:1105:14)
    at Module._extensions..js (node:internal/modules/cjs/loader:1159:10)
    at Module.load (node:internal/modules/cjs/loader:981:32)
    at Module._load (node:internal/modules/cjs/loader:827:12)
    at Module.require (node:internal/modules/cjs/loader:1005:19)
    at require (node:internal/modules/cjs/helpers:102:18)
    at /data/js-variants/multee/Clients/levelup/pouchdb/node_modules/mocha/bin/_mocha:366:3
    at Array.forEach (<anonymous>)
    at Object.<anonymous> (/data/js-variants/multee/Clients/levelup/pouchdb/node_modules/mocha/bin/_mocha:365:10)
    at Module._compile (node:internal/modules/cjs/loader:1105:14)
    at Module._extensions..js (node:internal/modules/cjs/loader:1159:10)
    at Module.load (node:internal/modules/cjs/loader:981:32)
    at Module._load (node:internal/modules/cjs/loader:827:12)
    at Function.executeUserEntryPoint [as runMain] (node:internal/modules/run_main:77:12)
    at node:internal/main/run_main_module:17:47
    ✓ should emit closed even when destroyed (async #2)
precondition_failed: Database not open
    at Object.<anonymous> (/data/js-variants/multee/Clients/levelup/pouchdb/packages/node_modules/pouchdb/lib/index.js:614:16)
    at Module._compile (node:internal/modules/cjs/loader:1105:14)
    at Module._extensions..js (node:internal/modules/cjs/loader:1159:10)
    at Module.load (node:internal/modules/cjs/loader:981:32)
    at Module._load (node:internal/modules/cjs/loader:827:12)
    at Module.require (node:internal/modules/cjs/loader:1005:19)
    at require (node:internal/modules/cjs/helpers:102:18)
    at commonUtils.loadPouchDBForNode (/data/js-variants/multee/Clients/levelup/pouchdb/tests/common-utils.js:92:17)
    at commonUtils.loadPouchDB (/data/js-variants/multee/Clients/levelup/pouchdb/tests/common-utils.js:78:39)
    at Object.<anonymous> (/data/js-variants/multee/Clients/levelup/pouchdb/tests/integration/node.setup.js:21:28)
    at Module._compile (node:internal/modules/cjs/loader:1105:14)
    at Module._extensions..js (node:internal/modules/cjs/loader:1159:10)
    at Module.load (node:internal/modules/cjs/loader:981:32)
    at Module._load (node:internal/modules/cjs/loader:827:12)
    at Module.require (node:internal/modules/cjs/loader:1005:19)
    at require (node:internal/modules/cjs/helpers:102:18)
    at /data/js-variants/multee/Clients/levelup/pouchdb/node_modules/mocha/bin/_mocha:366:3
    at Array.forEach (<anonymous>)
    at Object.<anonymous> (/data/js-variants/multee/Clients/levelup/pouchdb/node_modules/mocha/bin/_mocha:365:10)
    at Module._compile (node:internal/modules/cjs/loader:1105:14)
    at Module._extensions..js (node:internal/modules/cjs/loader:1159:10)
    at Module.load (node:internal/modules/cjs/loader:981:32)
    at Module._load (node:internal/modules/cjs/loader:827:12)
    at Function.executeUserEntryPoint [as runMain] (node:internal/modules/run_main:77:12)
    at node:internal/main/run_main_module:17:47
    ✓ test unref for coverage
    ✓ test double unref for coverage
precondition_failed: Database not open
    at Object.<anonymous> (/data/js-variants/multee/Clients/levelup/pouchdb/packages/node_modules/pouchdb/lib/index.js:614:16)
    at Module._compile (node:internal/modules/cjs/loader:1105:14)
    at Module._extensions..js (node:internal/modules/cjs/loader:1159:10)
    at Module.load (node:internal/modules/cjs/loader:981:32)
    at Module._load (node:internal/modules/cjs/loader:827:12)
    at Module.require (node:internal/modules/cjs/loader:1005:19)
    at require (node:internal/modules/cjs/helpers:102:18)
    at commonUtils.loadPouchDBForNode (/data/js-variants/multee/Clients/levelup/pouchdb/tests/common-utils.js:92:17)
    at commonUtils.loadPouchDB (/data/js-variants/multee/Clients/levelup/pouchdb/tests/common-utils.js:78:39)
    at Object.<anonymous> (/data/js-variants/multee/Clients/levelup/pouchdb/tests/integration/node.setup.js:21:28)
    at Module._compile (node:internal/modules/cjs/loader:1105:14)
    at Module._extensions..js (node:internal/modules/cjs/loader:1159:10)
    at Module.load (node:internal/modules/cjs/loader:981:32)
    at Module._load (node:internal/modules/cjs/loader:827:12)
    at Module.require (node:internal/modules/cjs/loader:1005:19)
    at require (node:internal/modules/cjs/helpers:102:18)
    at /data/js-variants/multee/Clients/levelup/pouchdb/node_modules/mocha/bin/_mocha:366:3
    at Array.forEach (<anonymous>)
    at Object.<anonymous> (/data/js-variants/multee/Clients/levelup/pouchdb/node_modules/mocha/bin/_mocha:365:10)
    at Module._compile (node:internal/modules/cjs/loader:1105:14)
    at Module._extensions..js (node:internal/modules/cjs/loader:1159:10)
    at Module.load (node:internal/modules/cjs/loader:981:32)
    at Module._load (node:internal/modules/cjs/loader:827:12)
    at Function.executeUserEntryPoint [as runMain] (node:internal/modules/run_main:77:12)
    at node:internal/main/run_main_module:17:47
    ✓ test close-then-destroyed for coverage
************* run test done *************
pouchdb is testing ./Variants/levelup/variant1/levelup
/data/js-variants/multee
************* npm unlink module *************

removed 1 package, changed 1 package, and audited 1032 packages in 4s

64 packages are looking for funding
  run `npm fund` for details

41 vulnerabilities (1 low, 9 moderate, 25 high, 6 critical)

To address issues that do not require attention, run:
  npm audit fix

To address all issues possible (including breaking changes), run:
  npm audit fix --force

Some issues need review, and may require choosing
a different dependency.

Run `npm audit` for details.
************* npm unlink module done *************
************* npm unlink globally *************

removed 1 package, and audited 1 package in 1s

found 0 vulnerabilities
************* npm unlink globally done *************
************* npm link globally *************

added 1 package, and audited 3 packages in 396ms

found 0 vulnerabilities
************* npm link globally done *************
************* npm link module *************

added 1 package, changed 1 package, and audited 1034 packages in 4s

64 packages are looking for funding
  run `npm fund` for details

41 vulnerabilities (1 low, 9 moderate, 25 high, 6 critical)

To address issues that do not require attention, run:
  npm audit fix

To address all issues possible (including breaking changes), run:
  npm audit fix --force

Some issues need review, and may require choosing
a different dependency.

Run `npm audit` for details.
************* npm link module done *************
************* start run test *************

> pouchdb-monorepo@7.0.0-prerelease test
> bash bin/run-test.sh


> pouchdb-monorepo@7.0.0-prerelease build-node
> bash bin/build-node.sh


> pouchdb-monorepo@7.0.0-prerelease build-modules
> node bin/build-modules.js

Building pouchdb...
Building pouchdb-abstract-mapreduce...
Building pouchdb-adapter-http...
Building pouchdb-adapter-idb...
Building pouchdb-adapter-indexeddb...
Building pouchdb-adapter-leveldb...
Building pouchdb-adapter-leveldb-core...
Building pouchdb-adapter-localstorage...
Building pouchdb-adapter-memory...
Building pouchdb-adapter-utils...
Building pouchdb-binary-utils...
Building pouchdb-browser...
Building pouchdb-changes-filter...
Building pouchdb-checkpointer...
Building pouchdb-collate...
Building pouchdb-collections...
Building pouchdb-core...
Building pouchdb-errors...
Building pouchdb-fetch...
Building pouchdb-find...
Building pouchdb-for-coverage...
Building pouchdb-generate-replication-id...
Building pouchdb-json...
Building pouchdb-mapreduce...
Building pouchdb-mapreduce-utils...
Building pouchdb-md5...
Building pouchdb-merge...
Building pouchdb-node...
Building pouchdb-replication...
Building pouchdb-selector-core...
Building pouchdb-utils...
Building sublevel-pouchdb...
  ✓ wrote pouchdb-adapter-localstorage/lib/index.js in vanilla mode
  ✓ wrote pouchdb-adapter-localstorage/lib/index.es.js in vanilla mode
  ✓ wrote pouchdb-adapter-memory/lib/index.js in vanilla mode
  ✓ wrote pouchdb-adapter-memory/lib/index.es.js in vanilla mode
  ✓ wrote pouchdb-checkpointer/lib/index.js in vanilla mode
  ✓ wrote pouchdb-checkpointer/lib/index.es.js in vanilla mode
  ✓ wrote pouchdb-errors/lib/index.js in vanilla mode
  ✓ wrote pouchdb-errors/lib/index.es.js in vanilla mode
  ✓ wrote pouchdb-generate-replication-id/lib/index.js in vanilla mode
  ✓ wrote pouchdb-generate-replication-id/lib/index.es.js in vanilla mode
  ✓ wrote pouchdb-adapter-http/lib/index.js in vanilla mode
  ✓ wrote pouchdb-adapter-http/lib/index.es.js in vanilla mode
  ✓ wrote pouchdb-adapter-leveldb/lib/index.js in node mode
  ✓ wrote pouchdb-adapter-leveldb/lib/index.es.js in node mode
  ✓ wrote pouchdb-adapter-leveldb/lib/index-browser.js in browser mode
  ✓ wrote pouchdb-adapter-leveldb/lib/index-browser.es.js in browser mode
  ✓ wrote pouchdb-adapter-leveldb-core/lib/index.js in node mode
  ✓ wrote pouchdb-adapter-leveldb-core/lib/index.es.js in node mode
  ✓ wrote pouchdb-adapter-leveldb-core/lib/index-browser.js in browser mode
  ✓ wrote pouchdb-adapter-leveldb-core/lib/index-browser.es.js in browser mode
  ✓ wrote pouchdb-changes-filter/lib/index-browser.js in browser mode
  ✓ wrote pouchdb-changes-filter/lib/index-browser.es.js in browser mode
  ✓ wrote pouchdb-fetch/lib/index-browser.js in browser mode
  ✓ wrote pouchdb-fetch/lib/index-browser.es.js in browser mode
  ✓ wrote pouchdb-md5/lib/index-browser.js in browser mode
  ✓ wrote pouchdb-md5/lib/index-browser.es.js in browser mode
  ✓ wrote pouchdb-changes-filter/lib/index.js in node mode
  ✓ wrote pouchdb-changes-filter/lib/index.es.js in node mode
  ✓ wrote pouchdb-collate/lib/index.js in vanilla mode
  ✓ wrote pouchdb-collate/lib/index.es.js in vanilla mode
  ✓ wrote pouchdb-fetch/lib/index.js in node mode
  ✓ wrote pouchdb-fetch/lib/index.es.js in node mode
  ✓ wrote pouchdb-json/lib/index.js in vanilla mode
  ✓ wrote pouchdb-json/lib/index.es.js in vanilla mode
  ✓ wrote pouchdb-mapreduce-utils/lib/index.js in vanilla mode
  ✓ wrote pouchdb-mapreduce-utils/lib/index.es.js in vanilla mode
  ✓ wrote pouchdb-md5/lib/index.js in node mode
  ✓ wrote pouchdb-md5/lib/index.es.js in node mode
  ✓ wrote pouchdb-abstract-mapreduce/lib/index.js in vanilla mode
  ✓ wrote pouchdb-abstract-mapreduce/lib/index.es.js in vanilla mode
  ✓ wrote pouchdb-adapter-idb/lib/index.js in vanilla mode
  ✓ wrote pouchdb-adapter-idb/lib/index.es.js in vanilla mode
  ✓ wrote pouchdb-adapter-indexeddb/lib/index.js in vanilla mode
  ✓ wrote pouchdb-adapter-indexeddb/lib/index.es.js in vanilla mode
  ✓ wrote pouchdb-binary-utils/lib/index-browser.js in browser mode
  ✓ wrote pouchdb-binary-utils/lib/index-browser.es.js in browser mode
  ✓ wrote pouchdb-utils/lib/index-browser.js in browser mode
  ✓ wrote pouchdb-utils/lib/index-browser.es.js in browser mode
  ✓ wrote pouchdb-utils/lib/index.js in node mode
  ✓ wrote pouchdb-utils/lib/index.es.js in node mode
  ✓ wrote pouchdb-adapter-utils/lib/index.js in vanilla mode
  ✓ wrote pouchdb-adapter-utils/lib/index.es.js in vanilla mode
  ✓ wrote pouchdb-binary-utils/lib/index.js in node mode
  ✓ wrote pouchdb-binary-utils/lib/index.es.js in node mode
  ✓ wrote pouchdb-collections/lib/index.js in vanilla mode
  ✓ wrote pouchdb-collections/lib/index.es.js in vanilla mode
  ✓ wrote pouchdb-selector-core/lib/index.js in vanilla mode
  ✓ wrote pouchdb-selector-core/lib/index.es.js in vanilla mode
  ✓ wrote sublevel-pouchdb/lib/index.js in vanilla mode
  ✓ wrote sublevel-pouchdb/lib/index.es.js in vanilla mode
  ✓ wrote pouchdb-merge/lib/index.js in vanilla mode
  ✓ wrote pouchdb-merge/lib/index.es.js in vanilla mode
  ✓ wrote pouchdb-mapreduce/lib/index-browser.js in browser mode
  ✓ wrote pouchdb-mapreduce/lib/index-browser.es.js in browser mode
  ✓ wrote pouchdb-replication/lib/index.js in vanilla mode
  ✓ wrote pouchdb-replication/lib/index.es.js in vanilla mode
  ✓ wrote pouchdb-mapreduce/lib/index.js in node mode
  ✓ wrote pouchdb-mapreduce/lib/index.es.js in node mode
  ✓ wrote pouchdb-core/lib/index.js in vanilla mode
  ✓ wrote pouchdb-core/lib/index.es.js in vanilla mode
  ✓ wrote pouchdb-find/lib/index.js in node mode
  ✓ wrote pouchdb-find/lib/index.es.js in node mode
  ✓ wrote pouchdb-find/lib/index-browser.js in browser mode
  ✓ wrote pouchdb-find/lib/index-browser.es.js in browser mode
  ✓ wrote pouchdb-for-coverage/lib/index.js in node mode
  ✓ wrote pouchdb-for-coverage/lib/index.es.js in node mode
  ✓ wrote pouchdb-for-coverage/lib/index-browser.js in browser mode
  ✓ wrote pouchdb-for-coverage/lib/index-browser.es.js in browser mode
  ✓ wrote pouchdb-browser/lib/index.js in vanilla mode
  ✓ wrote pouchdb-node/lib/index.js in vanilla mode
  ✓ wrote pouchdb-browser/lib/index.es.js in vanilla mode
  ✓ wrote pouchdb-node/lib/index.es.js in vanilla mode
  ✓ wrote packages/node_modules/pouchdb/lib/index.js
  ✓ wrote packages/node_modules/pouchdb/lib/index.es.js
Waiting for host to start ..
Host started :)
> pouchdb-monorepo@7.0.0-prerelease test-node
> bash bin/test-node.sh

Down server listening on port 3010
Seeded with: 1660143395947


  DB Setup
    ✓ PouchDB has a version
    ✓ PouchDB version matches package.json

  test.active_tasks.js
    ✓ Can add a task
    ✓ Can get tasks by id
    ✓ Can get all tasks
    ✓ Can update a task
    ✓ Can remove a task

  test.all_docs.js-http
    ✓ Testing all docs (162ms)
    ✓ Testing allDocs opts.keys (62ms)
    ✓ Testing allDocs opts.keys with skip (42ms)
    ✓ Testing allDocs opts.keys with limit (51ms)
    ✓ Testing allDocs invalid opts.keys
    ✓ Testing deleting in changes (52ms)
    ✓ Testing updating in changes (50ms)
    ✓ Testing include docs
    ✓ Testing conflicts (49ms)
    ✓ test basic collation
    ✓ 3883 start_key end_key aliases
    ✓ test total_rows with a variety of criteria (139ms)
    ✓ test total_rows with both skip and limit
    ✓ test limit option and total_rows
    ✓ test escaped startkey/endkey
    ✓ test "key" option
    ✓ test inclusive_end=false (54ms)
    ✓ test descending with startkey/endkey
    ✓ #3082 test wrong num results returned (251ms)
    ✓ test empty db
    ✓ test after db close
    ✓ 5793 _conflicts should not exist if no conflicts
    ✓ #6230 Test allDocs opts update_seq: false
    ✓ #6230 Test allDocs opts update_seq: true
    ✓ #6230 Test allDocs opts with update_seq missing

  test.all_docs.js-local
    ✓ Testing all docs
    ✓ Testing allDocs opts.keys
    ✓ Testing allDocs opts.keys with skip
    ✓ Testing allDocs opts.keys with limit
    ✓ Testing allDocs invalid opts.keys
    ✓ Testing deleting in changes
    ✓ Testing updating in changes
    ✓ Testing include docs
    ✓ Testing conflicts
    ✓ test basic collation
    ✓ 3883 start_key end_key aliases
    ✓ test total_rows with a variety of criteria
    ✓ test total_rows with both skip and limit
    ✓ test limit option and total_rows
    ✓ test escaped startkey/endkey
    ✓ test "key" option
    ✓ test inclusive_end=false
    ✓ test descending with startkey/endkey
    ✓ #3082 test wrong num results returned (199ms)
    ✓ test empty db
    ✓ test after db close
    ✓ test unicode ids and revs
    ✓ 5793 _conflicts should not exist if no conflicts
    ✓ #6230 Test allDocs opts update_seq: false
    ✓ #6230 Test allDocs opts update_seq: true
    ✓ #6230 Test allDocs opts with update_seq missing

  suite2 test.attachments.js-local
    ✓ 3357 Attachment names cant start with _
    ✓ 5736 warning for putAttachment without content_type
    ✓ 5736 warning for bulkDocs attachments without content_type
    ✓ fetch atts with open_revs and missing
    ✓ issue 2803 should throw 412
    ✓ issue 2803 should throw 412 part 2
    ✓ issue 2803 should throw 412 part 3
    ✓ issue 2803 should throw 412 part 4
    ✓ #2858 {binary: true} in get()
    ✓ #2858 {binary: true} in allDocs() 1
    ✓ #2858 {binary: true} in allDocs() 2
    ✓ #2858 {binary: true} in allDocs() 3
    ✓ #2858 {binary: true} in allDocs() 4
    ✓ #2858 {binary: true} in allDocs() 5
    ✓ #2858 {binary: true} in allDocs(), many atts
    ✓ #2858 {binary: true} in allDocs(), mixed atts
    ✓ #2858 {binary: true} in changes() non-live
    ✓ #2858 {binary: true} in changes() non-live, many atts
    ✓ #2858 {binary: true} in changes() non-live, mixed atts
    ✓ #2858 {binary: true} non-live changes, complete event
    ✓ #2858 {binary: true} in live changes
    ✓ #2858 {binary: true} in live changes, mixed atts
    ✓ #2858 {binary: true} in live+retry changes
    ✓ #2858 {binary: true} in live changes, attachments:false
    ✓ #2858 {binary: true} in live changes, include_docs:false
    ✓ #6736 {binary: true} in bulkGet()
    ✓ Measures length correctly after put()
    ✓ #3074 non-live changes()
    ✓ #3074 live changes()
    ✓ #3074 non-live changes(), no attachments
    ✓ #3074 live changes(), no attachments
    ✓ #3881 filter extraneous keys from _attachments
    ✓ #2771 allDocs() 1, single attachment
    ✓ #2771 allDocs() 2, many docs same att
    ✓ #2771 allDocs() 3, many docs diff atts
    ✓ #2771 allDocs() 4, mix of atts and no atts
    ✓ #2771 allDocs() 5, no atts
    ✓ #2771 allDocs() 6, no docs
    ✓ #2771 allDocs() 7, revisions and deletions
    ✓ #2771 allDocs() 8, empty attachment
    ✓ No length for non-stubs
    ✓ Test some attachments
    ✓ Test getAttachment
    ✓ Test getAttachment with stubs
    ✓ Test get() with binary:true and stubs
    ✓ Test attachments in allDocs/changes
    ✓ Test putAttachment with base64 plaintext
    ✓ Test putAttachment with invalid base64
    ✓ Test getAttachment with empty text
    ✓ Test getAttachment with normal text
    ✓ Test getAttachment with PNG
    ✓ Test getAttachment with PNG using bulkDocs
    ✓ Test getAttachment with PNG using post
    ✓ Test postAttachment with PNG then bulkDocs
    ✓ proper stub behavior
    ✓ Testing with invalid docs
    ✓ Test create attachment and doc in one go
    ✓ Test create attachment and doc in one go without callback
    ✓ Test create attachment without callback
    ✓ Test put attachment on a doc without attachments
    ✓ Test put attachment with unencoded name
    ✓ 3963 length property on stubs
    ✓ Testing with invalid rev
    ✓ Test put another attachment on a doc with attachments
    ✓ Test get with attachments: true if empty attachments
    ✓ Test delete attachment from a doc
    ✓ Test a document with a json string attachment
    ✓ Test remove doc with attachment
    ✓ Try to insert a doc with unencoded attachment
    ✓ Try to get attachment of unexistent doc
    ✓ Test synchronous putAttachment with text data
    ✓ Test synchronous putAttachment with no text data
    ✓ Test put with partial stubs
    ✓ Test put with attachments and new_edits=false
    ✓ Test getAttachment with specific rev
    ✓ Test getAttachment with diff revs and content
    ✓ Test stubs
    ✓ Try to get unexistent attachment of some doc
    ✓ putAttachment and getAttachment with plaintext
    ✓ putAttachment and getAttachment with png data
    ✓ putAttachment in new doc with base64
    ✓ #2818 - save same attachment in different revs
    ✓ #2818 - save same attachment many times in parallel
    ✓ #2818 - revisions keep attachments (no compaction)
    ✓ #2818 - doesn't throw 409 if same filename
    ✓ #3008 test correct encoding/decoding of \u0000 etc.
    ✓ putAttachment and getAttachment with big png data (95ms)
    ✓ #2709 `revpos` with putAttachment
    ✓ #2709 `revpos` with inline attachment
    ✓ #2709 `revpos` with allDocs
    ✓ #7403 {attachments: true, binary: true, include_docs: true} in allDocs with one missing doc

  suite2 test.attachments.js-http
    ✓ 3357 Attachment names cant start with _
    ✓ 5736 warning for putAttachment without content_type
    ✓ 5736 warning for bulkDocs attachments without content_type
    ✓ fetch atts with open_revs and missing
    ✓ issue 2803 should throw 412
    ✓ issue 2803 should throw 412 part 2
    ✓ issue 2803 should throw 412 part 3
    ✓ issue 2803 should throw 412 part 4
    ✓ #2858 {binary: true} in get()
    ✓ #2858 {binary: true} in allDocs() 1
    ✓ #2858 {binary: true} in allDocs() 2
    ✓ #2858 {binary: true} in allDocs() 3
    ✓ #2858 {binary: true} in allDocs() 4
    ✓ #2858 {binary: true} in allDocs() 5
    ✓ #2858 {binary: true} in allDocs(), many atts
    ✓ #2858 {binary: true} in allDocs(), mixed atts
    ✓ #2858 {binary: true} in changes() non-live
    ✓ #2858 {binary: true} in changes() non-live, many atts
    ✓ #2858 {binary: true} in changes() non-live, mixed atts
    ✓ #2858 {binary: true} non-live changes, complete event
    ✓ #2858 {binary: true} in live changes
    ✓ #2858 {binary: true} in live changes, mixed atts
    ✓ #2858 {binary: true} in live+retry changes
    ✓ #2858 {binary: true} in live changes, attachments:false
    ✓ #2858 {binary: true} in live changes, include_docs:false
    ✓ #6736 {binary: true} in bulkGet()
    ✓ Measures length correctly after put()
    ✓ #3074 non-live changes()
    ✓ #3074 live changes() (40ms)
    ✓ #3074 non-live changes(), no attachments
    ✓ #3074 live changes(), no attachments
    ✓ #3881 filter extraneous keys from _attachments
    ✓ #2771 allDocs() 1, single attachment
    ✓ #2771 allDocs() 2, many docs same att
    ✓ #2771 allDocs() 3, many docs diff atts
    ✓ #2771 allDocs() 4, mix of atts and no atts
    ✓ #2771 allDocs() 5, no atts
    ✓ #2771 allDocs() 6, no docs
    ✓ #2771 allDocs() 7, revisions and deletions
    ✓ #2771 allDocs() 8, empty attachment (41ms)
    ✓ No length for non-stubs
    ✓ Test some attachments (42ms)
    ✓ Test getAttachment
    ✓ Test getAttachment with stubs
    ✓ Test get() with binary:true and stubs (38ms)
    ✓ Test attachments in allDocs/changes
    ✓ Test putAttachment with base64 plaintext
    ✓ Test putAttachment with invalid base64
    ✓ Test getAttachment with empty text
    ✓ Test getAttachment with normal text
    ✓ Test getAttachment with PNG
    ✓ Test getAttachment with PNG using bulkDocs
    ✓ Test getAttachment with PNG using post
    ✓ Test postAttachment with PNG then bulkDocs
    ✓ proper stub behavior
    ✓ Testing with invalid docs
    ✓ Test create attachment and doc in one go
    ✓ Test create attachment and doc in one go without callback
    ✓ Test create attachment without callback
    ✓ Test put attachment on a doc without attachments
    ✓ Test put attachment with unencoded name
    ✓ 3963 length property on stubs (45ms)
    ✓ Testing with invalid rev
    ✓ Test put another attachment on a doc with attachments
    ✓ Test get with attachments: true if empty attachments
    ✓ Test delete attachment from a doc (44ms)
    ✓ Test a document with a json string attachment
    ✓ Test remove doc with attachment
    ✓ Try to insert a doc with unencoded attachment
    ✓ Try to get attachment of unexistent doc
    ✓ Test synchronous putAttachment with text data (42ms)
    ✓ Test synchronous putAttachment with no text data
    ✓ Test put with partial stubs (39ms)
    ✓ Test put with attachments and new_edits=false (38ms)
    ✓ Test getAttachment with specific rev (47ms)
    ✓ Test getAttachment with diff revs and content (41ms)
    ✓ Test stubs
    ✓ Try to get unexistent attachment of some doc
    ✓ putAttachment and getAttachment with plaintext
    ✓ putAttachment and getAttachment with png data
    ✓ putAttachment in new doc with base64
    ✓ #2818 - save same attachment in different revs (52ms)
    ✓ #2818 - save same attachment many times in parallel
    ✓ #2818 - revisions keep attachments (no compaction) (55ms)
    ✓ #2818 - doesn't throw 409 if same filename (49ms)
    ✓ #3008 test correct encoding/decoding of \u0000 etc. (43ms)
    ✓ putAttachment and getAttachment with big png data (148ms)
    ✓ #2709 `revpos` with putAttachment (38ms)
    ✓ #2709 `revpos` with inline attachment
    ✓ #2709 `revpos` with allDocs
    ✓ #7403 {attachments: true, binary: true, include_docs: true} in allDocs with one missing doc

  suite2 test.attachments.js- local:http
    ✓ Attachments replicate back and forth (117ms)
    ✓ Replicate same doc, same atts (109ms)
    ✓ Replicate same doc, same atts 2 (101ms)
    ✓ Attachments replicate (78ms)
    ✓ Attachment types replicate (51ms)
    ✓ Many many attachments replicate (181ms)
    ✓ Many many png attachments replicate (195ms)
    ✓ Multiple attachments replicate (79ms)
    - #3961 Many attachments on same doc
    ✓ Multiple attachments replicate, different docs (#2698) (80ms)
    ✓ Multiple attachments replicate, different docs png (#2698) (81ms)
    ✓ #3932 attachments with tricky revpos (125ms)
    ✓ replication with changing attachments (94ms)
    ✓ 3955 race condition in put
    ✓ #8456 bad attachment rev after replication (184ms)

  suite2 test.attachments.js- http:http
    ✓ Attachments replicate back and forth (170ms)
    ✓ Replicate same doc, same atts (173ms)
    ✓ Replicate same doc, same atts 2 (177ms)
    ✓ Attachments replicate (79ms)
    ✓ Attachment types replicate (105ms)
    ✓ Many many attachments replicate (369ms)
    ✓ Many many png attachments replicate (306ms)
    ✓ Multiple attachments replicate (122ms)
    - #3961 Many attachments on same doc
    ✓ Multiple attachments replicate, different docs (#2698) (122ms)
    ✓ Multiple attachments replicate, different docs png (#2698) (142ms)
    ✓ #3932 attachments with tricky revpos (259ms)
    ✓ replication with changing attachments (152ms)
    ✓ 3955 race condition in put
    ✓ #8456 bad attachment rev after replication (174ms)

  suite2 test.attachments.js- http:local
    ✓ Attachments replicate back and forth (117ms)
    ✓ Replicate same doc, same atts (99ms)
    ✓ Replicate same doc, same atts 2 (99ms)
    ✓ Attachments replicate (48ms)
    ✓ Attachment types replicate (49ms)
    ✓ Many many attachments replicate (147ms)
    ✓ Many many png attachments replicate (153ms)
    ✓ Multiple attachments replicate (116ms)
    - #3961 Many attachments on same doc
    ✓ Multiple attachments replicate, different docs (#2698) (72ms)
    ✓ Multiple attachments replicate, different docs png (#2698) (84ms)
    ✓ #3932 attachments with tricky revpos (154ms)
    ✓ replication with changing attachments (122ms)
    ✓ 3955 race condition in put
    ✓ #8456 bad attachment rev after replication (122ms)

  suite2 test.attachments.js- local:local
    ✓ Attachments replicate back and forth
    ✓ Replicate same doc, same atts
    ✓ Replicate same doc, same atts 2
    ✓ Attachments replicate
    ✓ Attachment types replicate
    ✓ Many many attachments replicate
    ✓ Many many png attachments replicate
    ✓ Multiple attachments replicate
    - #3961 Many attachments on same doc
    ✓ Multiple attachments replicate, different docs (#2698)
    ✓ Multiple attachments replicate, different docs png (#2698)
    ✓ #3932 attachments with tricky revpos (38ms)
    ✓ replication with changing attachments
    ✓ 3955 race condition in put
    ✓ #8456 bad attachment rev after replication

  test.basics.js-http
    ✓ Create a pouch without new keyword
    ✓ Name is accessible via instance
    ✓ 4314 Create a pouch with + in name
    ✓ Creating Pouch without name will throw
    ✓ 4314 Create a pouch with urlencoded name
    ✓ 4219 destroy a pouch
    ✓ 4339 throw useful error if method called on stale instance
    ✓ [4595] should reject xhr errors
    ✓ [4595] should emit error event on xhr error
    ✓ Add a doc
    ✓ Get invalid id
    ✓ Missing doc should contain ID in error object
    ✓ PUTed Conflicted doc should contain ID in error object
    ✓ POSTed Conflicted doc should contain ID in error object
    ✓ Add a doc with a promise
    ✓ Add a doc with opts object
    ✓ Modify a doc
    ✓ Modifying a doc that has rewritten content
    ✓ Modify a doc with a promise
    ✓ Read db id
    ✓ Read db id with promise
    ✓ Close db
    ✓ Close db with a promise
    ✓ Read db id after closing Close
    ✓ Modify a doc with incorrect rev
    ✓ Remove doc
    ✓ Remove doc with a promise
    ✓ Remove doc with new syntax
    ✓ Remove doc with new syntax and a promise
    ✓ Doc removal leaves only stub
    ✓ Remove doc twice with specified id
    ✓ Remove doc, no callback
    ✓ Delete document without id
    ✓ Delete document with many args
    ✓ Delete document with many args, callback style
    ✓ Delete doc with id + rev + no opts
    ✓ Delete doc with id + rev + no opts, callback style
    ✓ Delete doc with doc + opts
    ✓ Delete doc with doc + opts, callback style
    ✓ Delete doc with rev in opts
    ✓ Bulk docs (44ms)
    ✓ Bulk docs with a promise
    ✓ Basic checks
    ✓ update with invalid rev
    ✓ Doc validation
    ✓ Replication fields (#2442)
    ✓ Testing issue #48 (55ms)
    ✓ Testing valid id
    ✓ Put doc without _id should fail
    ✓ Put doc with bad reserved id should fail
    ✓ update_seq persists
    ✓ deletions persists (38ms)
    ✓ #4126 should not store raw Dates
    ✓ Create a db with a reserved name
    ✓ Error when document is not an object
    ✓ Test instance update_seq updates correctly
    ✓ Fail to fetch a doc after db was deleted (50ms)
    ✓ Fail to fetch a doc after db was deleted (52ms)
    ✓ Cant add docs with empty ids
    ✓ Test doc with percent in ID
    ✓ db.info should give auto_compaction = false (#2744)
    ✓ db.info should give auto_compaction = true (#2744)
    ✓ db.info should give adapter name (#3567)
    ✓ db.info should give correct doc_count
    ✓ putting returns {ok: true}
    ✓ putting is override-able
    ✓ issue 2779, deleted docs, old revs COUCHDB-292
    ✓ issue 2888, successive deletes and writes
    ✓ 2 invalid puts
    ✓ Docs save "null" value
    ✓ replace PouchDB.destroy() (express-pouchdb#203)
    ✓ 3968, keeps all object fields
    ✓ 4712 invalid rev for new doc generates conflict
    ✓ test info() after db close
    ✓ test get() after db close
    ✓ test close() after db close
    ✓ 7259 should have "this" keyword properly scoped
    ✓ #5471 PouchDB.plugin() should throw error if passed wrong type or empty object

  test.basics.js-local
    ✓ Create a pouch without new keyword
    ✓ Name is accessible via instance
    ✓ 4314 Create a pouch with + in name
    ✓ Creating Pouch without name will throw
    ✓ 4314 Create a pouch with urlencoded name
    ✓ 4219 destroy a pouch
    ✓ 4339 throw useful error if method called on stale instance
    ✓ [4595] should reject xhr errors
    ✓ [4595] should emit error event on xhr error
    ✓ Add a doc
    ✓ Get invalid id
    ✓ Missing doc should contain ID in error object
    ✓ PUTed Conflicted doc should contain ID in error object
    ✓ POSTed Conflicted doc should contain ID in error object
    ✓ Add a doc with a promise
    ✓ Add a doc with opts object
    ✓ Modify a doc
    ✓ Modifying a doc that has rewritten content
    ✓ Modify a doc with a promise
    ✓ Read db id
    ✓ Read db id with promise
    ✓ Close db
    ✓ Close db with a promise
    ✓ Read db id after closing Close
    ✓ Modify a doc with incorrect rev
    ✓ Remove doc
    ✓ Remove doc with a promise
    ✓ Remove doc with new syntax
    ✓ Remove doc with new syntax and a promise
    ✓ Doc removal leaves only stub
    ✓ Remove doc twice with specified id
    ✓ Remove doc, no callback
    ✓ Delete document without id
    ✓ Delete document with many args
    ✓ Delete document with many args, callback style
    ✓ Delete doc with id + rev + no opts
    ✓ Delete doc with id + rev + no opts, callback style
    ✓ Delete doc with doc + opts
    ✓ Delete doc with doc + opts, callback style
    ✓ Delete doc with rev in opts
    ✓ Bulk docs
    ✓ Bulk docs with a promise
    ✓ Basic checks
    ✓ update with invalid rev
    ✓ Doc validation
    ✓ Replication fields (#2442)
    ✓ Allows _access field in documents (#8171)
    ✓ Testing issue #48 (51ms)
    ✓ Testing valid id
    ✓ Put doc without _id should fail
    ✓ Put doc with bad reserved id should fail
    ✓ update_seq persists
    ✓ deletions persists
    ✓ #4126 should not store raw Dates
    ✓ Create a db with a reserved name
    ✓ Error when document is not an object
    ✓ Test instance update_seq updates correctly
    ✓ Fail to fetch a doc after db was deleted
    ✓ Fail to fetch a doc after db was deleted (41ms)
    ✓ Cant add docs with empty ids
    ✓ Test doc with percent in ID
    ✓ db.info should give auto_compaction = false (#2744)
    ✓ db.info should give auto_compaction = true (#2744)
    ✓ db.info should give adapter name (#3567)
    ✓ db.info should give correct doc_count
    ✓ putting returns {ok: true}
    ✓ putting is override-able
    ✓ issue 2779, deleted docs, old revs COUCHDB-292
    ✓ issue 2888, successive deletes and writes
    ✓ 2 invalid puts
    ✓ Docs save "null" value
    ✓ replace PouchDB.destroy() (express-pouchdb#203)
    ✓ 3968, keeps all object fields
    ✓ 4712 invalid rev for new doc generates conflict
    ✓ test info() after db close
    ✓ test get() after db close
    ✓ test close() after db close
    ✓ 7259 should have "this" keyword properly scoped
    ✓ should allow unicode doc ids
    ✓ should have same blob support for 2 dbs
    ✓ 6053, PouchDB.plugin() resets defaults
    ✓ #5471 PouchDB.plugin() should throw error if passed wrong type or empty object

  test.bulk_docs.js-local
    ✓ Testing bulk docs
    ✓ #6039 test id in bulk docs for conflict
    ✓ No id in bulk docs
    ✓ No _rev and new_edits=false
    ✓ 7829 bare rev 1- with new_edits=false
    ✓ Test empty bulkDocs
    ✓ Test many bulkDocs
    ✓ Test errors on invalid doc id
    ✓ Test two errors on invalid doc id
    ✓ No docs
    ✓ Jira 911
    ✓ Test multiple bulkdocs
    ✓ #2935 new_edits=false correct number
    ✓ #2935 new_edits=false correct number 2
    ✓ bulk docs update then delete then conflict
    ✓ bulk_docs delete then undelete
    ✓ #2935 new_edits=false with single unauthorized
    ✓ Deleting _local docs with bulkDocs
    ✓ Deleting _local docs with bulkDocs, not found
    ✓ Deleting _local docs with bulkDocs, wrong rev
    ✓ Bulk with new_edits=false
    ✓ Testing successive new_edits to the same doc
    ✓ #3062 bulkDocs with staggered seqs
    ✓ Testing successive new_edits to the same doc, different content
    ✓ Testing successive new_edits to two doc
    ✓ Deletion with new_edits=false
    ✓ Deletion with new_edits=false, no history
    ✓ Modification with new_edits=false, no history
    ✓ Deletion with new_edits=false, no history, no revisions
    ✓ Testing new_edits=false in req body
    ✓ 656 regression in handling deleted docs
    ✓ Test quotes in doc ids
    ✓ Bulk docs empty list
    ✓ handles simultaneous writes
    ✓ bulk docs input by array
    ✓ Bulk empty list
    ✓ Bulk docs not an array
    ✓ Bulk docs not an object
    ✓ Bulk docs two different revisions to same document id
    ✓ 4204 respect revs_limit (260ms)
    ✓ 2839 implement revs_limit (184ms)
    ✓ 4372 revs_limit deletes old revisions of the doc
    ✓ 4372 revs_limit with auto_compaction deletes old revisions of the doc
    ✓ 4712 invalid rev for new doc generates conflict
    ✓ 5793 bulk docs accepts _conflicts when new_edits=false

  test.bulk_docs.js-http
    ✓ Testing bulk docs
    ✓ #6039 test id in bulk docs for conflict
    ✓ No id in bulk docs
    ✓ No _rev and new_edits=false
    ✓ 7829 bare rev 1- with new_edits=false
    ✓ Test empty bulkDocs
    ✓ Test many bulkDocs
    ✓ Test errors on invalid doc id
    ✓ Test two errors on invalid doc id
    ✓ No docs
    ✓ Jira 911
    ✓ Test multiple bulkdocs
    ✓ #2935 new_edits=false correct number
    ✓ #2935 new_edits=false correct number 2
    ✓ bulk docs update then delete then conflict
    ✓ bulk_docs delete then undelete (38ms)
    ✓ #2935 new_edits=false with single unauthorized
    ✓ Deleting _local docs with bulkDocs (43ms)
    ✓ Bulk with new_edits=false
    ✓ Testing successive new_edits to the same doc
    ✓ #3062 bulkDocs with staggered seqs
    ✓ Testing successive new_edits to the same doc, different content
    ✓ Testing successive new_edits to two doc
    ✓ Deletion with new_edits=false
    ✓ Deletion with new_edits=false, no history
    ✓ Modification with new_edits=false, no history
    ✓ Deletion with new_edits=false, no history, no revisions
    ✓ Testing new_edits=false in req body
    ✓ 656 regression in handling deleted docs
    ✓ Test quotes in doc ids
    ✓ Bulk docs empty list
    ✓ handles simultaneous writes
    ✓ bulk docs input by array
    ✓ Bulk empty list
    ✓ Bulk docs not an array
    ✓ Bulk docs not an object
    ✓ Bulk docs two different revisions to same document id
    ✓ 4204 respect revs_limit (277ms)
    ✓ 2839 implement revs_limit
    ✓ 4372 revs_limit deletes old revisions of the doc
    ✓ 4372 revs_limit with auto_compaction deletes old revisions of the doc
    ✓ 4712 invalid rev for new doc generates conflict
    ✓ 5793 bulk docs accepts _conflicts when new_edits=false (41ms)

  test.bulk_get.js-http
    ✓ test bulk get with rev specified
    ✓ test bulk get with latest=true
    ✓ test bulk get with no rev specified (45ms)
    ✓ _revisions is not returned by default
    ✓ #5886 bulkGet with reserved id
    ✓ _revisions is returned when specified
    ✓ _revisions is returned when specified, using implicit rev
    ✓ attachments are not included by default
    ✓ attachments are included when specified
    ✓ attachments are included when specified, using implicit rev

  test.bulk_get.js-local
    ✓ test bulk get with rev specified
    ✓ test bulk get with latest=true
    ✓ test bulk get with no rev specified
    ✓ _revisions is not returned by default
    ✓ #5886 bulkGet with reserved id
    ✓ _revisions is returned when specified
    ✓ _revisions is returned when specified, using implicit rev
    ✓ attachments are not included by default
    ✓ attachments are included when specified
    ✓ attachments are included when specified, using implicit rev

  test.changes.js-http
    ✓ All changes
    ✓ Changes with complete callback as param
    ✓ Promise resolved when changes cancelled
    - Live changes should clean listener when cancelled
    ✓ Changes Since
    ✓ Changes Since and limit limit 1
    ✓ Changes Since and limit limit 0
    ✓ Changes limit (39ms)
    ✓ Changes with filter not present in ddoc
    ✓ Changes with `filters` key not present in ddoc
    ✓ Changes limit and filter
    ✓ Changes with shorthand function name
    ✓ Changes with filter from nonexistent ddoc
    ✓ Changes with view not present in ddoc
    ✓ Changes with `views` key not present in ddoc
    ✓ #4451 Changes with invalid view filter
    ✓ 3356 throw inside a filter
    ✓ Changes with missing param `view` in request (44ms)
    ✓ Changes limit and view instead of filter
    ✓ #3609 view option implies filter: _view
    ✓ Immediately cancel changes
    ✓ Changes with invalid ddoc view name
    ✓ Changes with invalid ddoc view name 2
    ✓ Changes with style = all_docs (62ms)
    ✓ Changes with style = all_docs and a callback for complete (59ms)
    ✓ Changes limit = 0
    ✓ Changes doc
    - Descending many changes
    ✓ live-changes
    ✓ Multiple watchers
    ✓ Continuous changes doc
    ✓ Cancel changes (323ms)
    ✓ #3579 changes firing 1 too many times (72ms)
    ✓ Kill database while listening to live changes
    ✓ #3136 style=all_docs (40ms)
    ✓ #4191 revs_diff causes endless loop
    ✓ #3136 style=all_docs & include_docs
    ✓ changes-filter with query params
    ✓ Non-live changes filter
    ✓ Non-live changes filter, descending
    ✓ #2569 Non-live doc_ids filter
    ✓ #2569 Big non-live doc_ids filter
    ✓ #2569 Live doc_ids filter
    ✓ #2569 Big live doc_ids filter
    ✓ #2569 Non-live doc_ids filter with filter=_doc_ids
    ✓ #2569 Live doc_ids filter with filter=_doc_ids
    ✓ Changes to same doc are grouped
    ✓ Changes with conflicts are handled correctly (138ms)
    ✓ Change entry for a deleted doc
    ✓ changes large number of docs
    ✓ Calling db.changes({since: 'now'})
    ✓ Calling db.changes({since: 'latest'})
    ✓ Closing db does not cause a crash if changes cancelled
    ✓ fire-complete-on-cancel (100ms)
    ✓ changes are not duplicated (1024ms)
    ✓ supports return_docs=false
    ✓ should respects limit (74ms)
    ✓ doesn't throw if opts.complete is undefined
    ✓ handle individual changes in live replication (195ms)
    ✓ changes-filter without filter
    ✓ #3539 - Exception in changes is fine
    ✓ Changes with selector
    ✓ Changes with selector, explicit filter
    ✓ Changes with selector and mismatched filter
    ✓ Changes with limit and selector

  test.changes.js-local
    ✓ All changes
    ✓ Changes with complete callback as param
    ✓ Promise resolved when changes cancelled
    - Live changes should clean listener when cancelled
    ✓ Changes Since
    ✓ Changes Since and limit limit 1
    ✓ Changes Since and limit limit 0
    ✓ Changes limit
    ✓ Changes with filter not present in ddoc
    ✓ Changes with `filters` key not present in ddoc
    ✓ Changes limit and filter
    ✓ Changes with shorthand function name
    ✓ Changes with filter from nonexistent ddoc
    ✓ Changes with view not present in ddoc
    ✓ Changes with `views` key not present in ddoc
    ✓ #4451 Changes with invalid view filter
    ✓ 3356 throw inside a filter
    ✓ Changes with missing param `view` in request
    ✓ Changes limit and view instead of filter
    ✓ #3609 view option implies filter: _view
    ✓ Immediately cancel changes
    ✓ Changes with invalid ddoc view name
    ✓ Changes with invalid ddoc view name 2
    ✓ Changes with style = all_docs
    ✓ Changes with style = all_docs and a callback for complete
    ✓ Changes limit = 0
    ✓ Changes doc
    - Descending many changes
    ✓ live-changes
    ✓ Multiple watchers
    ✓ Continuous changes doc
    ✓ Cancel changes (317ms)
    ✓ #3579 changes firing 1 too many times (67ms)
    ✓ Kill database while listening to live changes
    ✓ #3136 style=all_docs
    ✓ #4191 revs_diff causes endless loop
    ✓ #3136 style=all_docs & include_docs
    ✓ changes-filter with query params
    ✓ Non-live changes filter
    ✓ Non-live changes filter, descending
    ✓ #2569 Non-live doc_ids filter
    ✓ #2569 Big non-live doc_ids filter
    ✓ #2569 Live doc_ids filter
    ✓ #2569 Big live doc_ids filter
    ✓ #2569 Non-live doc_ids filter with filter=_doc_ids
    ✓ #2569 Live doc_ids filter with filter=_doc_ids
    ✓ Changes to same doc are grouped
    ✓ Changes with conflicts are handled correctly
    ✓ Change entry for a deleted doc
    ✓ changes large number of docs
    ✓ Calling db.changes({since: 'now'})
    ✓ Calling db.changes({since: 'latest'})
    ✓ Closing db does not cause a crash if changes cancelled
    ✓ fire-complete-on-cancel (100ms)
    ✓ changes are not duplicated (1016ms)
    ✓ supports return_docs=false
    ✓ should respects limit (64ms)
    ✓ doesn't throw if opts.complete is undefined
    ✓ handle individual changes in live replication (69ms)
    ✓ changes-filter without filter
    ✓ #3539 - Exception in changes is fine
    ✓ Changes with selector
    ✓ Changes with selector, explicit filter
    ✓ Changes with selector and mismatched filter
    ✓ Changes with limit and selector

  changes-standalone
    - Changes reports errors

  test.close.js-local
    ✓ should emit destroyed even when closed (sync)
    ✓ should emit destroyed even when closed (async)
precondition_failed: Database not open
    at Object.<anonymous> (/data/js-variants/multee/Clients/levelup/pouchdb/packages/node_modules/pouchdb/lib/index.js:614:16)
    at Module._compile (node:internal/modules/cjs/loader:1105:14)
    at Module._extensions..js (node:internal/modules/cjs/loader:1159:10)
    at Module.load (node:internal/modules/cjs/loader:981:32)
    at Module._load (node:internal/modules/cjs/loader:827:12)
    at Module.require (node:internal/modules/cjs/loader:1005:19)
    at require (node:internal/modules/cjs/helpers:102:18)
    at commonUtils.loadPouchDBForNode (/data/js-variants/multee/Clients/levelup/pouchdb/tests/common-utils.js:92:17)
    at commonUtils.loadPouchDB (/data/js-variants/multee/Clients/levelup/pouchdb/tests/common-utils.js:78:39)
    at Object.<anonymous> (/data/js-variants/multee/Clients/levelup/pouchdb/tests/integration/node.setup.js:21:28)
    at Module._compile (node:internal/modules/cjs/loader:1105:14)
    at Module._extensions..js (node:internal/modules/cjs/loader:1159:10)
    at Module.load (node:internal/modules/cjs/loader:981:32)
    at Module._load (node:internal/modules/cjs/loader:827:12)
    at Module.require (node:internal/modules/cjs/loader:1005:19)
    at require (node:internal/modules/cjs/helpers:102:18)
    at /data/js-variants/multee/Clients/levelup/pouchdb/node_modules/mocha/bin/_mocha:366:3
    at Array.forEach (<anonymous>)
    at Object.<anonymous> (/data/js-variants/multee/Clients/levelup/pouchdb/node_modules/mocha/bin/_mocha:365:10)
    at Module._compile (node:internal/modules/cjs/loader:1105:14)
    at Module._extensions..js (node:internal/modules/cjs/loader:1159:10)
    at Module.load (node:internal/modules/cjs/loader:981:32)
    at Module._load (node:internal/modules/cjs/loader:827:12)
    at Function.executeUserEntryPoint [as runMain] (node:internal/modules/run_main:77:12)
    at node:internal/main/run_main_module:17:47
    ✓ should emit closed even when destroyed (async #2)
precondition_failed: Database not open
    at Object.<anonymous> (/data/js-variants/multee/Clients/levelup/pouchdb/packages/node_modules/pouchdb/lib/index.js:614:16)
    at Module._compile (node:internal/modules/cjs/loader:1105:14)
    at Module._extensions..js (node:internal/modules/cjs/loader:1159:10)
    at Module.load (node:internal/modules/cjs/loader:981:32)
    at Module._load (node:internal/modules/cjs/loader:827:12)
    at Module.require (node:internal/modules/cjs/loader:1005:19)
    at require (node:internal/modules/cjs/helpers:102:18)
    at commonUtils.loadPouchDBForNode (/data/js-variants/multee/Clients/levelup/pouchdb/tests/common-utils.js:92:17)
    at commonUtils.loadPouchDB (/data/js-variants/multee/Clients/levelup/pouchdb/tests/common-utils.js:78:39)
    at Object.<anonymous> (/data/js-variants/multee/Clients/levelup/pouchdb/tests/integration/node.setup.js:21:28)
    at Module._compile (node:internal/modules/cjs/loader:1105:14)
    at Module._extensions..js (node:internal/modules/cjs/loader:1159:10)
    at Module.load (node:internal/modules/cjs/loader:981:32)
    at Module._load (node:internal/modules/cjs/loader:827:12)
    at Module.require (node:internal/modules/cjs/loader:1005:19)
    at require (node:internal/modules/cjs/helpers:102:18)
    at /data/js-variants/multee/Clients/levelup/pouchdb/node_modules/mocha/bin/_mocha:366:3
    at Array.forEach (<anonymous>)
    at Object.<anonymous> (/data/js-variants/multee/Clients/levelup/pouchdb/node_modules/mocha/bin/_mocha:365:10)
    at Module._compile (node:internal/modules/cjs/loader:1105:14)
    at Module._extensions..js (node:internal/modules/cjs/loader:1159:10)
    at Module.load (node:internal/modules/cjs/loader:981:32)
    at Module._load (node:internal/modules/cjs/loader:827:12)
    at Function.executeUserEntryPoint [as runMain] (node:internal/modules/run_main:77:12)
    at node:internal/main/run_main_module:17:47
    ✓ test unref for coverage
    ✓ test double unref for coverage
precondition_failed: Database not open
    at Object.<anonymous> (/data/js-variants/multee/Clients/levelup/pouchdb/packages/node_modules/pouchdb/lib/index.js:614:16)
    at Module._compile (node:internal/modules/cjs/loader:1105:14)
    at Module._extensions..js (node:internal/modules/cjs/loader:1159:10)
    at Module.load (node:internal/modules/cjs/loader:981:32)
    at Module._load (node:internal/modules/cjs/loader:827:12)
    at Module.require (node:internal/modules/cjs/loader:1005:19)
    at require (node:internal/modules/cjs/helpers:102:18)
    at commonUtils.loadPouchDBForNode (/data/js-variants/multee/Clients/levelup/pouchdb/tests/common-utils.js:92:17)
    at commonUtils.loadPouchDB (/data/js-variants/multee/Clients/levelup/pouchdb/tests/common-utils.js:78:39)
    at Object.<anonymous> (/data/js-variants/multee/Clients/levelup/pouchdb/tests/integration/node.setup.js:21:28)
    at Module._compile (node:internal/modules/cjs/loader:1105:14)
    at Module._extensions..js (node:internal/modules/cjs/loader:1159:10)
    at Module.load (node:internal/modules/cjs/loader:981:32)
    at Module._load (node:internal/modules/cjs/loader:827:12)
    at Module.require (node:internal/modules/cjs/loader:1005:19)
    at require (node:internal/modules/cjs/helpers:102:18)
    at /data/js-variants/multee/Clients/levelup/pouchdb/node_modules/mocha/bin/_mocha:366:3
    at Array.forEach (<anonymous>)
    at Object.<anonymous> (/data/js-variants/multee/Clients/levelup/pouchdb/node_modules/mocha/bin/_mocha:365:10)
    at Module._compile (node:internal/modules/cjs/loader:1105:14)
    at Module._extensions..js (node:internal/modules/cjs/loader:1159:10)
    at Module.load (node:internal/modules/cjs/loader:981:32)
    at Module._load (node:internal/modules/cjs/loader:827:12)
    at Function.executeUserEntryPoint [as runMain] (node:internal/modules/run_main:77:12)
    at node:internal/main/run_main_module:17:47
    ✓ test close-then-destroyed for coverage
************* run test done *************
variantsDepsNum: 6
/data/js-variants/multee
6
pouchdb is testing ./VariantsDeps/levelup/variant6/levelup
************* npm unlink module *************

removed 1 package, changed 1 package, and audited 1032 packages in 6s

64 packages are looking for funding
  run `npm fund` for details

41 vulnerabilities (1 low, 9 moderate, 25 high, 6 critical)

To address issues that do not require attention, run:
  npm audit fix

To address all issues possible (including breaking changes), run:
  npm audit fix --force

Some issues need review, and may require choosing
a different dependency.

Run `npm audit` for details.
************* npm unlink module done *************
************* npm unlink globally *************

removed 1 package, and audited 1 package in 1s

found 0 vulnerabilities
************* npm unlink module done *************
************* npm link globally *************

added 1 package, and audited 3 packages in 422ms

found 0 vulnerabilities
************* npm link globally done *************
************* npm link module *************

added 1 package, changed 1 package, and audited 1034 packages in 5s

64 packages are looking for funding
  run `npm fund` for details

41 vulnerabilities (1 low, 9 moderate, 25 high, 6 critical)

To address issues that do not require attention, run:
  npm audit fix

To address all issues possible (including breaking changes), run:
  npm audit fix --force

Some issues need review, and may require choosing
a different dependency.

Run `npm audit` for details.
************* npm link module done *************
************* start run test *************

> pouchdb-monorepo@7.0.0-prerelease test
> bash bin/run-test.sh


> pouchdb-monorepo@7.0.0-prerelease build-node
> bash bin/build-node.sh


> pouchdb-monorepo@7.0.0-prerelease build-modules
> node bin/build-modules.js

Building pouchdb...
Building pouchdb-abstract-mapreduce...
Building pouchdb-adapter-http...
Building pouchdb-adapter-idb...
Building pouchdb-adapter-indexeddb...
Building pouchdb-adapter-leveldb...
Building pouchdb-adapter-leveldb-core...
Building pouchdb-adapter-localstorage...
Building pouchdb-adapter-memory...
Building pouchdb-adapter-utils...
Building pouchdb-binary-utils...
Building pouchdb-changes-filter...
Building pouchdb-checkpointer...
Building pouchdb-collate...
Building pouchdb-browser...
Building pouchdb-collections...
Building pouchdb-core...
Building pouchdb-errors...
Building pouchdb-fetch...
Building pouchdb-find...
Building pouchdb-for-coverage...
Building pouchdb-generate-replication-id...
Building pouchdb-json...
Building pouchdb-mapreduce...
Building pouchdb-mapreduce-utils...
Building pouchdb-md5...
Building pouchdb-merge...
Building pouchdb-node...
Building pouchdb-replication...
Building pouchdb-selector-core...
Building pouchdb-utils...
Building sublevel-pouchdb...
  ✓ wrote pouchdb-adapter-localstorage/lib/index.es.js in vanilla mode
  ✓ wrote pouchdb-adapter-localstorage/lib/index.js in vanilla mode
  ✓ wrote pouchdb-adapter-memory/lib/index.js in vanilla mode
  ✓ wrote pouchdb-adapter-memory/lib/index.es.js in vanilla mode
  ✓ wrote pouchdb-checkpointer/lib/index.js in vanilla mode
  ✓ wrote pouchdb-checkpointer/lib/index.es.js in vanilla mode
  ✓ wrote pouchdb-errors/lib/index.js in vanilla mode
  ✓ wrote pouchdb-errors/lib/index.es.js in vanilla mode
  ✓ wrote pouchdb-generate-replication-id/lib/index.js in vanilla mode
  ✓ wrote pouchdb-generate-replication-id/lib/index.es.js in vanilla mode
  ✓ wrote pouchdb-adapter-http/lib/index.js in vanilla mode
  ✓ wrote pouchdb-adapter-http/lib/index.es.js in vanilla mode
  ✓ wrote pouchdb-adapter-leveldb-core/lib/index.js in node mode
  ✓ wrote pouchdb-adapter-leveldb-core/lib/index.es.js in node mode
  ✓ wrote pouchdb-adapter-leveldb-core/lib/index-browser.js in browser mode
  ✓ wrote pouchdb-adapter-leveldb-core/lib/index-browser.es.js in browser mode
  ✓ wrote pouchdb-changes-filter/lib/index-browser.js in browser mode
  ✓ wrote pouchdb-changes-filter/lib/index-browser.es.js in browser mode
  ✓ wrote pouchdb-fetch/lib/index-browser.js in browser mode
  ✓ wrote pouchdb-fetch/lib/index-browser.es.js in browser mode
  ✓ wrote pouchdb-md5/lib/index-browser.js in browser mode
  ✓ wrote pouchdb-md5/lib/index-browser.es.js in browser mode
  ✓ wrote pouchdb-adapter-leveldb/lib/index.js in node mode
  ✓ wrote pouchdb-adapter-leveldb/lib/index.es.js in node mode
  ✓ wrote pouchdb-adapter-leveldb/lib/index-browser.js in browser mode
  ✓ wrote pouchdb-adapter-leveldb/lib/index-browser.es.js in browser mode
  ✓ wrote pouchdb-collate/lib/index.js in vanilla mode
  ✓ wrote pouchdb-collate/lib/index.es.js in vanilla mode
  ✓ wrote pouchdb-changes-filter/lib/index.js in node mode
  ✓ wrote pouchdb-changes-filter/lib/index.es.js in node mode
  ✓ wrote pouchdb-fetch/lib/index.js in node mode
  ✓ wrote pouchdb-fetch/lib/index.es.js in node mode
  ✓ wrote pouchdb-mapreduce-utils/lib/index.js in vanilla mode
  ✓ wrote pouchdb-mapreduce-utils/lib/index.es.js in vanilla mode
  ✓ wrote pouchdb-json/lib/index.js in vanilla mode
  ✓ wrote pouchdb-json/lib/index.es.js in vanilla mode
  ✓ wrote pouchdb-md5/lib/index.js in node mode
  ✓ wrote pouchdb-md5/lib/index.es.js in node mode
  ✓ wrote pouchdb-abstract-mapreduce/lib/index.js in vanilla mode
  ✓ wrote pouchdb-abstract-mapreduce/lib/index.es.js in vanilla mode
  ✓ wrote pouchdb-adapter-idb/lib/index.js in vanilla mode
  ✓ wrote pouchdb-adapter-idb/lib/index.es.js in vanilla mode
  ✓ wrote pouchdb-adapter-indexeddb/lib/index.js in vanilla mode
  ✓ wrote pouchdb-adapter-indexeddb/lib/index.es.js in vanilla mode
  ✓ wrote pouchdb-binary-utils/lib/index-browser.js in browser mode
  ✓ wrote pouchdb-binary-utils/lib/index-browser.es.js in browser mode
  ✓ wrote pouchdb-adapter-utils/lib/index.js in vanilla mode
  ✓ wrote pouchdb-adapter-utils/lib/index.es.js in vanilla mode
  ✓ wrote pouchdb-binary-utils/lib/index.js in node mode
  ✓ wrote pouchdb-binary-utils/lib/index.es.js in node mode
  ✓ wrote pouchdb-collections/lib/index.js in vanilla mode
  ✓ wrote pouchdb-collections/lib/index.es.js in vanilla mode
  ✓ wrote pouchdb-utils/lib/index-browser.js in browser mode
  ✓ wrote pouchdb-utils/lib/index-browser.es.js in browser mode
  ✓ wrote pouchdb-utils/lib/index.js in node mode
  ✓ wrote pouchdb-utils/lib/index.es.js in node mode
  ✓ wrote pouchdb-merge/lib/index.js in vanilla mode
  ✓ wrote pouchdb-merge/lib/index.es.js in vanilla mode
  ✓ wrote sublevel-pouchdb/lib/index.js in vanilla mode
  ✓ wrote sublevel-pouchdb/lib/index.es.js in vanilla mode
  ✓ wrote pouchdb-selector-core/lib/index.js in vanilla mode
  ✓ wrote pouchdb-selector-core/lib/index.es.js in vanilla mode
  ✓ wrote pouchdb-mapreduce/lib/index-browser.js in browser mode
  ✓ wrote pouchdb-mapreduce/lib/index-browser.es.js in browser mode
  ✓ wrote pouchdb-mapreduce/lib/index.js in node mode
  ✓ wrote pouchdb-mapreduce/lib/index.es.js in node mode
  ✓ wrote pouchdb-replication/lib/index.js in vanilla mode
  ✓ wrote pouchdb-replication/lib/index.es.js in vanilla mode
  ✓ wrote pouchdb-core/lib/index.js in vanilla mode
  ✓ wrote pouchdb-core/lib/index.es.js in vanilla mode
  ✓ wrote pouchdb-find/lib/index.js in node mode
  ✓ wrote pouchdb-find/lib/index.es.js in node mode
  ✓ wrote pouchdb-find/lib/index-browser.js in browser mode
  ✓ wrote pouchdb-find/lib/index-browser.es.js in browser mode
  ✓ wrote pouchdb-browser/lib/index.js in vanilla mode
  ✓ wrote pouchdb-browser/lib/index.es.js in vanilla mode
  ✓ wrote pouchdb-node/lib/index.js in vanilla mode
  ✓ wrote pouchdb-node/lib/index.es.js in vanilla mode
  ✓ wrote pouchdb-for-coverage/lib/index.js in node mode
  ✓ wrote pouchdb-for-coverage/lib/index.es.js in node mode
  ✓ wrote pouchdb-for-coverage/lib/index-browser.js in browser mode
  ✓ wrote pouchdb-for-coverage/lib/index-browser.es.js in browser mode
  ✓ wrote packages/node_modules/pouchdb/lib/index.js
  ✓ wrote packages/node_modules/pouchdb/lib/index.es.js
Waiting for host to start ..
Host started :)
> pouchdb-monorepo@7.0.0-prerelease test-node
> bash bin/test-node.sh

Down server listening on port 3010
Seeded with: 1660146407302


  DB Setup
    ✓ PouchDB has a version
    ✓ PouchDB version matches package.json

  test.active_tasks.js
    ✓ Can add a task
    ✓ Can get tasks by id
    ✓ Can get all tasks
    ✓ Can update a task
    ✓ Can remove a task

  test.all_docs.js-http
    ✓ Testing all docs (156ms)
    ✓ Testing allDocs opts.keys (63ms)
    ✓ Testing allDocs opts.keys with skip
    ✓ Testing allDocs opts.keys with limit
    ✓ Testing allDocs invalid opts.keys
    ✓ Testing deleting in changes (47ms)
    ✓ Testing updating in changes (46ms)
    ✓ Testing include docs
    ✓ Testing conflicts (50ms)
    ✓ test basic collation
    ✓ 3883 start_key end_key aliases
    ✓ test total_rows with a variety of criteria (143ms)
    ✓ test total_rows with both skip and limit (42ms)
    ✓ test limit option and total_rows
    ✓ test escaped startkey/endkey
    ✓ test "key" option (41ms)
    ✓ test inclusive_end=false (61ms)
    ✓ test descending with startkey/endkey (42ms)
    ✓ #3082 test wrong num results returned (290ms)
    ✓ test empty db
    ✓ test after db close
    ✓ 5793 _conflicts should not exist if no conflicts
    ✓ #6230 Test allDocs opts update_seq: false
    ✓ #6230 Test allDocs opts update_seq: true
    ✓ #6230 Test allDocs opts with update_seq missing

  test.all_docs.js-local
    ✓ Testing all docs
    ✓ Testing allDocs opts.keys
    ✓ Testing allDocs opts.keys with skip
    ✓ Testing allDocs opts.keys with limit
    ✓ Testing allDocs invalid opts.keys
    ✓ Testing deleting in changes
    ✓ Testing updating in changes
    ✓ Testing include docs
    ✓ Testing conflicts
    ✓ test basic collation
    ✓ 3883 start_key end_key aliases
    ✓ test total_rows with a variety of criteria
    ✓ test total_rows with both skip and limit
    ✓ test limit option and total_rows
    ✓ test escaped startkey/endkey
    ✓ test "key" option
    ✓ test inclusive_end=false
    ✓ test descending with startkey/endkey
    ✓ #3082 test wrong num results returned (185ms)
    ✓ test empty db
    ✓ test after db close
    ✓ test unicode ids and revs
    ✓ 5793 _conflicts should not exist if no conflicts
    ✓ #6230 Test allDocs opts update_seq: false
    ✓ #6230 Test allDocs opts update_seq: true
    ✓ #6230 Test allDocs opts with update_seq missing

  suite2 test.attachments.js-local
    ✓ 3357 Attachment names cant start with _
    ✓ 5736 warning for putAttachment without content_type
    ✓ 5736 warning for bulkDocs attachments without content_type
    ✓ fetch atts with open_revs and missing
    ✓ issue 2803 should throw 412
    ✓ issue 2803 should throw 412 part 2
    ✓ issue 2803 should throw 412 part 3
    ✓ issue 2803 should throw 412 part 4
    ✓ #2858 {binary: true} in get()
    ✓ #2858 {binary: true} in allDocs() 1
    ✓ #2858 {binary: true} in allDocs() 2
    ✓ #2858 {binary: true} in allDocs() 3
    ✓ #2858 {binary: true} in allDocs() 4
    ✓ #2858 {binary: true} in allDocs() 5
    ✓ #2858 {binary: true} in allDocs(), many atts
    ✓ #2858 {binary: true} in allDocs(), mixed atts
    ✓ #2858 {binary: true} in changes() non-live
    ✓ #2858 {binary: true} in changes() non-live, many atts
    ✓ #2858 {binary: true} in changes() non-live, mixed atts
    ✓ #2858 {binary: true} non-live changes, complete event
    ✓ #2858 {binary: true} in live changes
    ✓ #2858 {binary: true} in live changes, mixed atts
    ✓ #2858 {binary: true} in live+retry changes
    ✓ #2858 {binary: true} in live changes, attachments:false
    ✓ #2858 {binary: true} in live changes, include_docs:false
    ✓ #6736 {binary: true} in bulkGet()
    ✓ Measures length correctly after put()
    ✓ #3074 non-live changes()
    ✓ #3074 live changes()
    ✓ #3074 non-live changes(), no attachments
    ✓ #3074 live changes(), no attachments
    ✓ #3881 filter extraneous keys from _attachments
    ✓ #2771 allDocs() 1, single attachment
    ✓ #2771 allDocs() 2, many docs same att
    ✓ #2771 allDocs() 3, many docs diff atts
    ✓ #2771 allDocs() 4, mix of atts and no atts
    ✓ #2771 allDocs() 5, no atts
    ✓ #2771 allDocs() 6, no docs
    ✓ #2771 allDocs() 7, revisions and deletions
    ✓ #2771 allDocs() 8, empty attachment
    ✓ No length for non-stubs
    ✓ Test some attachments
    ✓ Test getAttachment
    ✓ Test getAttachment with stubs
    ✓ Test get() with binary:true and stubs
    ✓ Test attachments in allDocs/changes
    ✓ Test putAttachment with base64 plaintext
    ✓ Test putAttachment with invalid base64
    ✓ Test getAttachment with empty text
    ✓ Test getAttachment with normal text
    ✓ Test getAttachment with PNG
    ✓ Test getAttachment with PNG using bulkDocs
    ✓ Test getAttachment with PNG using post
    ✓ Test postAttachment with PNG then bulkDocs
    ✓ proper stub behavior
    ✓ Testing with invalid docs
    ✓ Test create attachment and doc in one go
    ✓ Test create attachment and doc in one go without callback
    ✓ Test create attachment without callback
    ✓ Test put attachment on a doc without attachments
    ✓ Test put attachment with unencoded name
    ✓ 3963 length property on stubs
    ✓ Testing with invalid rev
    ✓ Test put another attachment on a doc with attachments
    ✓ Test get with attachments: true if empty attachments
    ✓ Test delete attachment from a doc
    ✓ Test a document with a json string attachment
    ✓ Test remove doc with attachment
    ✓ Try to insert a doc with unencoded attachment
    ✓ Try to get attachment of unexistent doc
    ✓ Test synchronous putAttachment with text data
    ✓ Test synchronous putAttachment with no text data
    ✓ Test put with partial stubs
    ✓ Test put with attachments and new_edits=false
    ✓ Test getAttachment with specific rev
    ✓ Test getAttachment with diff revs and content
    ✓ Test stubs
    ✓ Try to get unexistent attachment of some doc
    ✓ putAttachment and getAttachment with plaintext
    ✓ putAttachment and getAttachment with png data
    ✓ putAttachment in new doc with base64
    ✓ #2818 - save same attachment in different revs
    ✓ #2818 - save same attachment many times in parallel
    ✓ #2818 - revisions keep attachments (no compaction)
    ✓ #2818 - doesn't throw 409 if same filename
    ✓ #3008 test correct encoding/decoding of \u0000 etc.
    ✓ putAttachment and getAttachment with big png data (87ms)
    ✓ #2709 `revpos` with putAttachment
    ✓ #2709 `revpos` with inline attachment
    ✓ #2709 `revpos` with allDocs
    ✓ #7403 {attachments: true, binary: true, include_docs: true} in allDocs with one missing doc

  suite2 test.attachments.js-http
    ✓ 3357 Attachment names cant start with _
    ✓ 5736 warning for putAttachment without content_type
    ✓ 5736 warning for bulkDocs attachments without content_type
    ✓ fetch atts with open_revs and missing
    ✓ issue 2803 should throw 412 (38ms)
    ✓ issue 2803 should throw 412 part 2
    ✓ issue 2803 should throw 412 part 3
    ✓ issue 2803 should throw 412 part 4
    ✓ #2858 {binary: true} in get()
    ✓ #2858 {binary: true} in allDocs() 1
    ✓ #2858 {binary: true} in allDocs() 2
    ✓ #2858 {binary: true} in allDocs() 3
    ✓ #2858 {binary: true} in allDocs() 4
    ✓ #2858 {binary: true} in allDocs() 5
    ✓ #2858 {binary: true} in allDocs(), many atts
    ✓ #2858 {binary: true} in allDocs(), mixed atts
    ✓ #2858 {binary: true} in changes() non-live
    ✓ #2858 {binary: true} in changes() non-live, many atts
    ✓ #2858 {binary: true} in changes() non-live, mixed atts
    ✓ #2858 {binary: true} non-live changes, complete event
    ✓ #2858 {binary: true} in live changes
    ✓ #2858 {binary: true} in live changes, mixed atts
    ✓ #2858 {binary: true} in live+retry changes
    ✓ #2858 {binary: true} in live changes, attachments:false
    ✓ #2858 {binary: true} in live changes, include_docs:false
    ✓ #6736 {binary: true} in bulkGet()
    ✓ Measures length correctly after put()
    ✓ #3074 non-live changes() (41ms)
    ✓ #3074 live changes() (42ms)
    ✓ #3074 non-live changes(), no attachments
    ✓ #3074 live changes(), no attachments
    ✓ #3881 filter extraneous keys from _attachments
    ✓ #2771 allDocs() 1, single attachment
    ✓ #2771 allDocs() 2, many docs same att
    ✓ #2771 allDocs() 3, many docs diff atts
    ✓ #2771 allDocs() 4, mix of atts and no atts
    ✓ #2771 allDocs() 5, no atts
    ✓ #2771 allDocs() 6, no docs
    ✓ #2771 allDocs() 7, revisions and deletions
    ✓ #2771 allDocs() 8, empty attachment
    ✓ No length for non-stubs
    ✓ Test some attachments (44ms)
    ✓ Test getAttachment
    ✓ Test getAttachment with stubs
    ✓ Test get() with binary:true and stubs
    ✓ Test attachments in allDocs/changes
    ✓ Test putAttachment with base64 plaintext
    ✓ Test putAttachment with invalid base64
    ✓ Test getAttachment with empty text
    ✓ Test getAttachment with normal text
    ✓ Test getAttachment with PNG
    ✓ Test getAttachment with PNG using bulkDocs
    ✓ Test getAttachment with PNG using post
    ✓ Test postAttachment with PNG then bulkDocs
    ✓ proper stub behavior (39ms)
    ✓ Testing with invalid docs
    ✓ Test create attachment and doc in one go
    ✓ Test create attachment and doc in one go without callback
    ✓ Test create attachment without callback
    ✓ Test put attachment on a doc without attachments
    ✓ Test put attachment with unencoded name
    ✓ 3963 length property on stubs (58ms)
    ✓ Testing with invalid rev
    ✓ Test put another attachment on a doc with attachments
    ✓ Test get with attachments: true if empty attachments
    ✓ Test delete attachment from a doc (40ms)
    ✓ Test a document with a json string attachment
    ✓ Test remove doc with attachment
    ✓ Try to insert a doc with unencoded attachment
    ✓ Try to get attachment of unexistent doc
    ✓ Test synchronous putAttachment with text data
    ✓ Test synchronous putAttachment with no text data
    ✓ Test put with partial stubs
    ✓ Test put with attachments and new_edits=false
    ✓ Test getAttachment with specific rev (43ms)
    ✓ Test getAttachment with diff revs and content
    ✓ Test stubs
    ✓ Try to get unexistent attachment of some doc
    ✓ putAttachment and getAttachment with plaintext
    ✓ putAttachment and getAttachment with png data
    ✓ putAttachment in new doc with base64
    ✓ #2818 - save same attachment in different revs (49ms)
    ✓ #2818 - save same attachment many times in parallel
    ✓ #2818 - revisions keep attachments (no compaction) (41ms)
    ✓ #2818 - doesn't throw 409 if same filename
    ✓ #3008 test correct encoding/decoding of \u0000 etc.
    ✓ putAttachment and getAttachment with big png data (127ms)
    ✓ #2709 `revpos` with putAttachment (42ms)
    ✓ #2709 `revpos` with inline attachment
    ✓ #2709 `revpos` with allDocs
    ✓ #7403 {attachments: true, binary: true, include_docs: true} in allDocs with one missing doc

  suite2 test.attachments.js- local:http
    ✓ Attachments replicate back and forth (111ms)
    ✓ Replicate same doc, same atts (111ms)
    ✓ Replicate same doc, same atts 2 (108ms)
    ✓ Attachments replicate (104ms)
    ✓ Attachment types replicate (68ms)
    ✓ Many many attachments replicate (185ms)
    ✓ Many many png attachments replicate (210ms)
    ✓ Multiple attachments replicate (81ms)
    - #3961 Many attachments on same doc
    ✓ Multiple attachments replicate, different docs (#2698) (82ms)
    ✓ Multiple attachments replicate, different docs png (#2698) (68ms)
    ✓ #3932 attachments with tricky revpos (125ms)
    ✓ replication with changing attachments (98ms)
    ✓ 3955 race condition in put
    ✓ #8456 bad attachment rev after replication (125ms)

  suite2 test.attachments.js- http:http
    ✓ Attachments replicate back and forth (164ms)
    ✓ Replicate same doc, same atts (174ms)
    ✓ Replicate same doc, same atts 2 (176ms)
    ✓ Attachments replicate (80ms)
    ✓ Attachment types replicate (108ms)
    ✓ Many many attachments replicate (375ms)
    ✓ Many many png attachments replicate (282ms)
    ✓ Multiple attachments replicate (120ms)
    - #3961 Many attachments on same doc
    ✓ Multiple attachments replicate, different docs (#2698) (123ms)
    ✓ Multiple attachments replicate, different docs png (#2698) (130ms)
    ✓ #3932 attachments with tricky revpos (227ms)
    ✓ replication with changing attachments (155ms)
    ✓ 3955 race condition in put
    ✓ #8456 bad attachment rev after replication (177ms)

  suite2 test.attachments.js- http:local
    ✓ Attachments replicate back and forth (120ms)
    ✓ Replicate same doc, same atts (145ms)
    ✓ Replicate same doc, same atts 2 (100ms)
    ✓ Attachments replicate (67ms)
    ✓ Attachment types replicate (57ms)
    ✓ Many many attachments replicate (143ms)
    ✓ Many many png attachments replicate (154ms)
    ✓ Multiple attachments replicate (84ms)
    - #3961 Many attachments on same doc
    ✓ Multiple attachments replicate, different docs (#2698) (71ms)
    ✓ Multiple attachments replicate, different docs png (#2698) (87ms)
    ✓ #3932 attachments with tricky revpos (147ms)
    ✓ replication with changing attachments (97ms)
    ✓ 3955 race condition in put
    ✓ #8456 bad attachment rev after replication (114ms)

  suite2 test.attachments.js- local:local
    ✓ Attachments replicate back and forth
    ✓ Replicate same doc, same atts
    ✓ Replicate same doc, same atts 2
    ✓ Attachments replicate
    ✓ Attachment types replicate
    ✓ Many many attachments replicate
    ✓ Many many png attachments replicate
    ✓ Multiple attachments replicate
    - #3961 Many attachments on same doc
    ✓ Multiple attachments replicate, different docs (#2698)
    ✓ Multiple attachments replicate, different docs png (#2698)
    ✓ #3932 attachments with tricky revpos (73ms)
    ✓ replication with changing attachments
    ✓ 3955 race condition in put
    ✓ #8456 bad attachment rev after replication

  test.basics.js-http
    ✓ Create a pouch without new keyword
    ✓ Name is accessible via instance
    ✓ 4314 Create a pouch with + in name
    ✓ Creating Pouch without name will throw
    ✓ 4314 Create a pouch with urlencoded name (39ms)
    ✓ 4219 destroy a pouch
    ✓ 4339 throw useful error if method called on stale instance
    ✓ [4595] should reject xhr errors
    ✓ [4595] should emit error event on xhr error
    ✓ Add a doc
    ✓ Get invalid id
    ✓ Missing doc should contain ID in error object
    ✓ PUTed Conflicted doc should contain ID in error object
    ✓ POSTed Conflicted doc should contain ID in error object
    ✓ Add a doc with a promise
    ✓ Add a doc with opts object
    ✓ Modify a doc
    ✓ Modifying a doc that has rewritten content
    ✓ Modify a doc with a promise
    ✓ Read db id
    ✓ Read db id with promise
    ✓ Close db
    ✓ Close db with a promise
    ✓ Read db id after closing Close
    ✓ Modify a doc with incorrect rev
    ✓ Remove doc
    ✓ Remove doc with a promise
    ✓ Remove doc with new syntax
    ✓ Remove doc with new syntax and a promise
    ✓ Doc removal leaves only stub
    ✓ Remove doc twice with specified id
    ✓ Remove doc, no callback
    ✓ Delete document without id
    ✓ Delete document with many args
    ✓ Delete document with many args, callback style
    ✓ Delete doc with id + rev + no opts
    ✓ Delete doc with id + rev + no opts, callback style
    ✓ Delete doc with doc + opts
    ✓ Delete doc with doc + opts, callback style
    ✓ Delete doc with rev in opts
    ✓ Bulk docs
    ✓ Bulk docs with a promise
    ✓ Basic checks
    ✓ update with invalid rev
    ✓ Doc validation
    ✓ Replication fields (#2442)
    ✓ Testing issue #48 (54ms)
    ✓ Testing valid id
    ✓ Put doc without _id should fail
    ✓ Put doc with bad reserved id should fail
    ✓ update_seq persists
    ✓ deletions persists
    ✓ #4126 should not store raw Dates
    ✓ Create a db with a reserved name
    ✓ Error when document is not an object
    ✓ Test instance update_seq updates correctly
    ✓ Fail to fetch a doc after db was deleted (52ms)
    ✓ Fail to fetch a doc after db was deleted (58ms)
    ✓ Cant add docs with empty ids
    ✓ Test doc with percent in ID
    ✓ db.info should give auto_compaction = false (#2744)
    ✓ db.info should give auto_compaction = true (#2744)
    ✓ db.info should give adapter name (#3567)
    ✓ db.info should give correct doc_count (53ms)
    ✓ putting returns {ok: true}
    ✓ putting is override-able
    ✓ issue 2779, deleted docs, old revs COUCHDB-292
    ✓ issue 2888, successive deletes and writes (40ms)
    ✓ 2 invalid puts
    ✓ Docs save "null" value
    ✓ replace PouchDB.destroy() (express-pouchdb#203)
    ✓ 3968, keeps all object fields (46ms)
    ✓ 4712 invalid rev for new doc generates conflict
    ✓ test info() after db close
    ✓ test get() after db close
    ✓ test close() after db close
    ✓ 7259 should have "this" keyword properly scoped
    ✓ #5471 PouchDB.plugin() should throw error if passed wrong type or empty object

  test.basics.js-local
    ✓ Create a pouch without new keyword
    ✓ Name is accessible via instance
    ✓ 4314 Create a pouch with + in name
    ✓ Creating Pouch without name will throw
    ✓ 4314 Create a pouch with urlencoded name
    ✓ 4219 destroy a pouch
    ✓ 4339 throw useful error if method called on stale instance
    ✓ [4595] should reject xhr errors
    ✓ [4595] should emit error event on xhr error
    ✓ Add a doc
    ✓ Get invalid id
    ✓ Missing doc should contain ID in error object
    ✓ PUTed Conflicted doc should contain ID in error object
    ✓ POSTed Conflicted doc should contain ID in error object
    ✓ Add a doc with a promise
    ✓ Add a doc with opts object
    ✓ Modify a doc
    ✓ Modifying a doc that has rewritten content
    ✓ Modify a doc with a promise
    ✓ Read db id
    ✓ Read db id with promise
    ✓ Close db
    ✓ Close db with a promise
    ✓ Read db id after closing Close
    ✓ Modify a doc with incorrect rev
    ✓ Remove doc
    ✓ Remove doc with a promise
    ✓ Remove doc with new syntax
    ✓ Remove doc with new syntax and a promise
    ✓ Doc removal leaves only stub
    ✓ Remove doc twice with specified id
    ✓ Remove doc, no callback
    ✓ Delete document without id
    ✓ Delete document with many args
    ✓ Delete document with many args, callback style
    ✓ Delete doc with id + rev + no opts
    ✓ Delete doc with id + rev + no opts, callback style
    ✓ Delete doc with doc + opts
    ✓ Delete doc with doc + opts, callback style
    ✓ Delete doc with rev in opts
    ✓ Bulk docs
    ✓ Bulk docs with a promise
    ✓ Basic checks
    ✓ update with invalid rev
    ✓ Doc validation
    ✓ Replication fields (#2442)
    ✓ Allows _access field in documents (#8171)
    ✓ Testing issue #48 (52ms)
    ✓ Testing valid id
    ✓ Put doc without _id should fail
    ✓ Put doc with bad reserved id should fail
    ✓ update_seq persists
    ✓ deletions persists
    ✓ #4126 should not store raw Dates
    ✓ Create a db with a reserved name
    ✓ Error when document is not an object
    ✓ Test instance update_seq updates correctly
    ✓ Fail to fetch a doc after db was deleted
    ✓ Fail to fetch a doc after db was deleted
    ✓ Cant add docs with empty ids
    ✓ Test doc with percent in ID
    ✓ db.info should give auto_compaction = false (#2744)
    ✓ db.info should give auto_compaction = true (#2744)
    ✓ db.info should give adapter name (#3567)
    ✓ db.info should give correct doc_count
    ✓ putting returns {ok: true}
    ✓ putting is override-able
    ✓ issue 2779, deleted docs, old revs COUCHDB-292
    ✓ issue 2888, successive deletes and writes
    ✓ 2 invalid puts
    ✓ Docs save "null" value
    ✓ replace PouchDB.destroy() (express-pouchdb#203)
    ✓ 3968, keeps all object fields
    ✓ 4712 invalid rev for new doc generates conflict
    ✓ test info() after db close
    ✓ test get() after db close
    ✓ test close() after db close
    ✓ 7259 should have "this" keyword properly scoped
    ✓ should allow unicode doc ids
    ✓ should have same blob support for 2 dbs
    ✓ 6053, PouchDB.plugin() resets defaults
    ✓ #5471 PouchDB.plugin() should throw error if passed wrong type or empty object

  test.bulk_docs.js-local
    ✓ Testing bulk docs
    ✓ #6039 test id in bulk docs for conflict
    ✓ No id in bulk docs
    ✓ No _rev and new_edits=false
    ✓ 7829 bare rev 1- with new_edits=false
    ✓ Test empty bulkDocs
    ✓ Test many bulkDocs
    ✓ Test errors on invalid doc id
    ✓ Test two errors on invalid doc id
    ✓ No docs
    ✓ Jira 911
    ✓ Test multiple bulkdocs
    ✓ #2935 new_edits=false correct number
    ✓ #2935 new_edits=false correct number 2
    ✓ bulk docs update then delete then conflict
    ✓ bulk_docs delete then undelete
    ✓ #2935 new_edits=false with single unauthorized
    ✓ Deleting _local docs with bulkDocs
    ✓ Deleting _local docs with bulkDocs, not found
    ✓ Deleting _local docs with bulkDocs, wrong rev
    ✓ Bulk with new_edits=false
    ✓ Testing successive new_edits to the same doc
    ✓ #3062 bulkDocs with staggered seqs
    ✓ Testing successive new_edits to the same doc, different content
    ✓ Testing successive new_edits to two doc
    ✓ Deletion with new_edits=false
    ✓ Deletion with new_edits=false, no history
    ✓ Modification with new_edits=false, no history
    ✓ Deletion with new_edits=false, no history, no revisions
    ✓ Testing new_edits=false in req body
    ✓ 656 regression in handling deleted docs
    ✓ Test quotes in doc ids
    ✓ Bulk docs empty list
    ✓ handles simultaneous writes
    ✓ bulk docs input by array
    ✓ Bulk empty list
    ✓ Bulk docs not an array
    ✓ Bulk docs not an object
    ✓ Bulk docs two different revisions to same document id
    ✓ 4204 respect revs_limit (264ms)
    ✓ 2839 implement revs_limit (190ms)
    ✓ 4372 revs_limit deletes old revisions of the doc
    ✓ 4372 revs_limit with auto_compaction deletes old revisions of the doc
    ✓ 4712 invalid rev for new doc generates conflict
    ✓ 5793 bulk docs accepts _conflicts when new_edits=false

  test.bulk_docs.js-http
    ✓ Testing bulk docs
    ✓ #6039 test id in bulk docs for conflict
    ✓ No id in bulk docs
    ✓ No _rev and new_edits=false
    ✓ 7829 bare rev 1- with new_edits=false
    ✓ Test empty bulkDocs
    ✓ Test many bulkDocs
    ✓ Test errors on invalid doc id
    ✓ Test two errors on invalid doc id
    ✓ No docs
    ✓ Jira 911
    ✓ Test multiple bulkdocs
    ✓ #2935 new_edits=false correct number
    ✓ #2935 new_edits=false correct number 2
    ✓ bulk docs update then delete then conflict
    ✓ bulk_docs delete then undelete
    ✓ #2935 new_edits=false with single unauthorized
    ✓ Deleting _local docs with bulkDocs (40ms)
    ✓ Bulk with new_edits=false
    ✓ Testing successive new_edits to the same doc
    ✓ #3062 bulkDocs with staggered seqs
    ✓ Testing successive new_edits to the same doc, different content
    ✓ Testing successive new_edits to two doc
    ✓ Deletion with new_edits=false
    ✓ Deletion with new_edits=false, no history
    ✓ Modification with new_edits=false, no history
    ✓ Deletion with new_edits=false, no history, no revisions
    ✓ Testing new_edits=false in req body
    ✓ 656 regression in handling deleted docs
    ✓ Test quotes in doc ids
    ✓ Bulk docs empty list
    ✓ handles simultaneous writes
    ✓ bulk docs input by array
    ✓ Bulk empty list
    ✓ Bulk docs not an array
    ✓ Bulk docs not an object
    ✓ Bulk docs two different revisions to same document id
    ✓ 4204 respect revs_limit (253ms)
    ✓ 2839 implement revs_limit
    ✓ 4372 revs_limit deletes old revisions of the doc
    ✓ 4372 revs_limit with auto_compaction deletes old revisions of the doc
    ✓ 4712 invalid rev for new doc generates conflict
    ✓ 5793 bulk docs accepts _conflicts when new_edits=false (71ms)

  test.bulk_get.js-http
    ✓ test bulk get with rev specified
    ✓ test bulk get with latest=true
    ✓ test bulk get with no rev specified
    ✓ _revisions is not returned by default
    ✓ #5886 bulkGet with reserved id
    ✓ _revisions is returned when specified
    ✓ _revisions is returned when specified, using implicit rev
    ✓ attachments are not included by default
    ✓ attachments are included when specified
    ✓ attachments are included when specified, using implicit rev

  test.bulk_get.js-local
    ✓ test bulk get with rev specified
    ✓ test bulk get with latest=true
    ✓ test bulk get with no rev specified
    ✓ _revisions is not returned by default
    ✓ #5886 bulkGet with reserved id
    ✓ _revisions is returned when specified
    ✓ _revisions is returned when specified, using implicit rev
    ✓ attachments are not included by default
    ✓ attachments are included when specified
    ✓ attachments are included when specified, using implicit rev

  test.changes.js-http
    ✓ All changes
    ✓ Changes with complete callback as param
    ✓ Promise resolved when changes cancelled
    - Live changes should clean listener when cancelled
    ✓ Changes Since
    ✓ Changes Since and limit limit 1
    ✓ Changes Since and limit limit 0
    ✓ Changes limit
    ✓ Changes with filter not present in ddoc
    ✓ Changes with `filters` key not present in ddoc
    ✓ Changes limit and filter
    ✓ Changes with shorthand function name
    ✓ Changes with filter from nonexistent ddoc
    ✓ Changes with view not present in ddoc
    ✓ Changes with `views` key not present in ddoc
    ✓ #4451 Changes with invalid view filter
    ✓ 3356 throw inside a filter
    ✓ Changes with missing param `view` in request
    ✓ Changes limit and view instead of filter (48ms)
    ✓ #3609 view option implies filter: _view
    ✓ Immediately cancel changes
    ✓ Changes with invalid ddoc view name
    ✓ Changes with invalid ddoc view name 2
    ✓ Changes with style = all_docs (62ms)
    ✓ Changes with style = all_docs and a callback for complete (58ms)
    ✓ Changes limit = 0
    ✓ Changes doc
    - Descending many changes
    ✓ live-changes
    ✓ Multiple watchers
    ✓ Continuous changes doc
    ✓ Cancel changes (321ms)
    ✓ #3579 changes firing 1 too many times (76ms)
    ✓ Kill database while listening to live changes
    ✓ #3136 style=all_docs
    ✓ #4191 revs_diff causes endless loop
    ✓ #3136 style=all_docs & include_docs
    ✓ changes-filter with query params
    ✓ Non-live changes filter
    ✓ Non-live changes filter, descending
    ✓ #2569 Non-live doc_ids filter
    ✓ #2569 Big non-live doc_ids filter
    ✓ #2569 Live doc_ids filter
    ✓ #2569 Big live doc_ids filter
    ✓ #2569 Non-live doc_ids filter with filter=_doc_ids
    ✓ #2569 Live doc_ids filter with filter=_doc_ids
    ✓ Changes to same doc are grouped
    ✓ Changes with conflicts are handled correctly (143ms)
    ✓ Change entry for a deleted doc
    ✓ changes large number of docs
    ✓ Calling db.changes({since: 'now'})
    ✓ Calling db.changes({since: 'latest'})
    ✓ Closing db does not cause a crash if changes cancelled
    ✓ fire-complete-on-cancel (101ms)
    ✓ changes are not duplicated (1025ms)
    ✓ supports return_docs=false
    ✓ should respects limit (72ms)
    ✓ doesn't throw if opts.complete is undefined
    ✓ handle individual changes in live replication (193ms)
    ✓ changes-filter without filter
    ✓ #3539 - Exception in changes is fine
    ✓ Changes with selector
    ✓ Changes with selector, explicit filter
    ✓ Changes with selector and mismatched filter
    ✓ Changes with limit and selector

  test.changes.js-local
    ✓ All changes
    ✓ Changes with complete callback as param
    ✓ Promise resolved when changes cancelled
    - Live changes should clean listener when cancelled
    ✓ Changes Since
    ✓ Changes Since and limit limit 1
    ✓ Changes Since and limit limit 0
    ✓ Changes limit
    ✓ Changes with filter not present in ddoc
    ✓ Changes with `filters` key not present in ddoc
    ✓ Changes limit and filter
    ✓ Changes with shorthand function name
    ✓ Changes with filter from nonexistent ddoc
    ✓ Changes with view not present in ddoc
    ✓ Changes with `views` key not present in ddoc
    ✓ #4451 Changes with invalid view filter
    ✓ 3356 throw inside a filter
    ✓ Changes with missing param `view` in request
    ✓ Changes limit and view instead of filter
    ✓ #3609 view option implies filter: _view
    ✓ Immediately cancel changes
    ✓ Changes with invalid ddoc view name
    ✓ Changes with invalid ddoc view name 2
    ✓ Changes with style = all_docs
    ✓ Changes with style = all_docs and a callback for complete
    ✓ Changes limit = 0
    ✓ Changes doc
    - Descending many changes
    ✓ live-changes
    ✓ Multiple watchers
    ✓ Continuous changes doc
    ✓ Cancel changes (319ms)
    ✓ #3579 changes firing 1 too many times (66ms)
    ✓ Kill database while listening to live changes
    ✓ #3136 style=all_docs
    ✓ #4191 revs_diff causes endless loop
    ✓ #3136 style=all_docs & include_docs
    ✓ changes-filter with query params
    ✓ Non-live changes filter
    ✓ Non-live changes filter, descending
    ✓ #2569 Non-live doc_ids filter
    ✓ #2569 Big non-live doc_ids filter
    ✓ #2569 Live doc_ids filter
    ✓ #2569 Big live doc_ids filter
    ✓ #2569 Non-live doc_ids filter with filter=_doc_ids
    ✓ #2569 Live doc_ids filter with filter=_doc_ids
    ✓ Changes to same doc are grouped
    ✓ Changes with conflicts are handled correctly
    ✓ Change entry for a deleted doc
    ✓ changes large number of docs
    ✓ Calling db.changes({since: 'now'})
    ✓ Calling db.changes({since: 'latest'})
    ✓ Closing db does not cause a crash if changes cancelled
    ✓ fire-complete-on-cancel (101ms)
    ✓ changes are not duplicated (1017ms)
    ✓ supports return_docs=false
    ✓ should respects limit (71ms)
    ✓ doesn't throw if opts.complete is undefined
    ✓ handle individual changes in live replication (69ms)
    ✓ changes-filter without filter
    ✓ #3539 - Exception in changes is fine
    ✓ Changes with selector
    ✓ Changes with selector, explicit filter
    ✓ Changes with selector and mismatched filter
    ✓ Changes with limit and selector

  changes-standalone
    - Changes reports errors

  test.close.js-local
    ✓ should emit destroyed even when closed (sync)
    ✓ should emit destroyed even when closed (async)
precondition_failed: Database not open
    at Object.<anonymous> (/data/js-variants/multee/Clients/levelup/pouchdb/packages/node_modules/pouchdb/lib/index.js:614:16)
    at Module._compile (node:internal/modules/cjs/loader:1105:14)
    at Module._extensions..js (node:internal/modules/cjs/loader:1159:10)
    at Module.load (node:internal/modules/cjs/loader:981:32)
    at Module._load (node:internal/modules/cjs/loader:827:12)
    at Module.require (node:internal/modules/cjs/loader:1005:19)
    at require (node:internal/modules/cjs/helpers:102:18)
    at commonUtils.loadPouchDBForNode (/data/js-variants/multee/Clients/levelup/pouchdb/tests/common-utils.js:92:17)
    at commonUtils.loadPouchDB (/data/js-variants/multee/Clients/levelup/pouchdb/tests/common-utils.js:78:39)
    at Object.<anonymous> (/data/js-variants/multee/Clients/levelup/pouchdb/tests/integration/node.setup.js:21:28)
    at Module._compile (node:internal/modules/cjs/loader:1105:14)
    at Module._extensions..js (node:internal/modules/cjs/loader:1159:10)
    at Module.load (node:internal/modules/cjs/loader:981:32)
    at Module._load (node:internal/modules/cjs/loader:827:12)
    at Module.require (node:internal/modules/cjs/loader:1005:19)
    at require (node:internal/modules/cjs/helpers:102:18)
    at /data/js-variants/multee/Clients/levelup/pouchdb/node_modules/mocha/bin/_mocha:366:3
    at Array.forEach (<anonymous>)
    at Object.<anonymous> (/data/js-variants/multee/Clients/levelup/pouchdb/node_modules/mocha/bin/_mocha:365:10)
    at Module._compile (node:internal/modules/cjs/loader:1105:14)
    at Module._extensions..js (node:internal/modules/cjs/loader:1159:10)
    at Module.load (node:internal/modules/cjs/loader:981:32)
    at Module._load (node:internal/modules/cjs/loader:827:12)
    at Function.executeUserEntryPoint [as runMain] (node:internal/modules/run_main:77:12)
    at node:internal/main/run_main_module:17:47
    ✓ should emit closed even when destroyed (async #2)
precondition_failed: Database not open
    at Object.<anonymous> (/data/js-variants/multee/Clients/levelup/pouchdb/packages/node_modules/pouchdb/lib/index.js:614:16)
    at Module._compile (node:internal/modules/cjs/loader:1105:14)
    at Module._extensions..js (node:internal/modules/cjs/loader:1159:10)
    at Module.load (node:internal/modules/cjs/loader:981:32)
    at Module._load (node:internal/modules/cjs/loader:827:12)
    at Module.require (node:internal/modules/cjs/loader:1005:19)
    at require (node:internal/modules/cjs/helpers:102:18)
    at commonUtils.loadPouchDBForNode (/data/js-variants/multee/Clients/levelup/pouchdb/tests/common-utils.js:92:17)
    at commonUtils.loadPouchDB (/data/js-variants/multee/Clients/levelup/pouchdb/tests/common-utils.js:78:39)
    at Object.<anonymous> (/data/js-variants/multee/Clients/levelup/pouchdb/tests/integration/node.setup.js:21:28)
    at Module._compile (node:internal/modules/cjs/loader:1105:14)
    at Module._extensions..js (node:internal/modules/cjs/loader:1159:10)
    at Module.load (node:internal/modules/cjs/loader:981:32)
    at Module._load (node:internal/modules/cjs/loader:827:12)
    at Module.require (node:internal/modules/cjs/loader:1005:19)
    at require (node:internal/modules/cjs/helpers:102:18)
    at /data/js-variants/multee/Clients/levelup/pouchdb/node_modules/mocha/bin/_mocha:366:3
    at Array.forEach (<anonymous>)
    at Object.<anonymous> (/data/js-variants/multee/Clients/levelup/pouchdb/node_modules/mocha/bin/_mocha:365:10)
    at Module._compile (node:internal/modules/cjs/loader:1105:14)
    at Module._extensions..js (node:internal/modules/cjs/loader:1159:10)
    at Module.load (node:internal/modules/cjs/loader:981:32)
    at Module._load (node:internal/modules/cjs/loader:827:12)
    at Function.executeUserEntryPoint [as runMain] (node:internal/modules/run_main:77:12)
    at node:internal/main/run_main_module:17:47
    ✓ test unref for coverage
    ✓ test double unref for coverage
precondition_failed: Database not open
    at Object.<anonymous> (/data/js-variants/multee/Clients/levelup/pouchdb/packages/node_modules/pouchdb/lib/index.js:614:16)
    at Module._compile (node:internal/modules/cjs/loader:1105:14)
    at Module._extensions..js (node:internal/modules/cjs/loader:1159:10)
    at Module.load (node:internal/modules/cjs/loader:981:32)
    at Module._load (node:internal/modules/cjs/loader:827:12)
    at Module.require (node:internal/modules/cjs/loader:1005:19)
    at require (node:internal/modules/cjs/helpers:102:18)
    at commonUtils.loadPouchDBForNode (/data/js-variants/multee/Clients/levelup/pouchdb/tests/common-utils.js:92:17)
    at commonUtils.loadPouchDB (/data/js-variants/multee/Clients/levelup/pouchdb/tests/common-utils.js:78:39)
    at Object.<anonymous> (/data/js-variants/multee/Clients/levelup/pouchdb/tests/integration/node.setup.js:21:28)
    at Module._compile (node:internal/modules/cjs/loader:1105:14)
    at Module._extensions..js (node:internal/modules/cjs/loader:1159:10)
    at Module.load (node:internal/modules/cjs/loader:981:32)
    at Module._load (node:internal/modules/cjs/loader:827:12)
    at Module.require (node:internal/modules/cjs/loader:1005:19)
    at require (node:internal/modules/cjs/helpers:102:18)
    at /data/js-variants/multee/Clients/levelup/pouchdb/node_modules/mocha/bin/_mocha:366:3
    at Array.forEach (<anonymous>)
    at Object.<anonymous> (/data/js-variants/multee/Clients/levelup/pouchdb/node_modules/mocha/bin/_mocha:365:10)
    at Module._compile (node:internal/modules/cjs/loader:1105:14)
    at Module._extensions..js (node:internal/modules/cjs/loader:1159:10)
    at Module.load (node:internal/modules/cjs/loader:981:32)
    at Module._load (node:internal/modules/cjs/loader:827:12)
    at Function.executeUserEntryPoint [as runMain] (node:internal/modules/run_main:77:12)
    at node:internal/main/run_main_module:17:47
    ✓ test close-then-destroyed for coverage
************* run test done *************
pouchdb is testing ./VariantsDeps/levelup/variant5/levelup
************* npm unlink module *************

removed 1 package, changed 1 package, and audited 1032 packages in 3s

64 packages are looking for funding
  run `npm fund` for details

41 vulnerabilities (1 low, 9 moderate, 25 high, 6 critical)

To address issues that do not require attention, run:
  npm audit fix

To address all issues possible (including breaking changes), run:
  npm audit fix --force

Some issues need review, and may require choosing
a different dependency.

Run `npm audit` for details.
************* npm unlink module done *************
************* npm unlink globally *************

removed 1 package, and audited 1 package in 1s

found 0 vulnerabilities
************* npm unlink module done *************
************* npm link globally *************

added 1 package, and audited 3 packages in 410ms

found 0 vulnerabilities
************* npm link globally done *************
************* npm link module *************

added 1 package, changed 1 package, and audited 1034 packages in 4s

64 packages are looking for funding
  run `npm fund` for details

41 vulnerabilities (1 low, 9 moderate, 25 high, 6 critical)

To address issues that do not require attention, run:
  npm audit fix

To address all issues possible (including breaking changes), run:
  npm audit fix --force

Some issues need review, and may require choosing
a different dependency.

Run `npm audit` for details.
************* npm link module done *************
************* start run test *************

> pouchdb-monorepo@7.0.0-prerelease test
> bash bin/run-test.sh


> pouchdb-monorepo@7.0.0-prerelease build-node
> bash bin/build-node.sh


> pouchdb-monorepo@7.0.0-prerelease build-modules
> node bin/build-modules.js

Building pouchdb...
Building pouchdb-abstract-mapreduce...
Building pouchdb-adapter-http...
Building pouchdb-adapter-idb...
Building pouchdb-adapter-indexeddb...
Building pouchdb-adapter-leveldb...
Building pouchdb-adapter-leveldb-core...
Building pouchdb-adapter-localstorage...
Building pouchdb-adapter-memory...
Building pouchdb-adapter-utils...
Building pouchdb-binary-utils...
Building pouchdb-browser...
Building pouchdb-changes-filter...
Building pouchdb-checkpointer...
Building pouchdb-collate...
Building pouchdb-collections...
Building pouchdb-core...
Building pouchdb-errors...
Building pouchdb-fetch...
Building pouchdb-find...
Building pouchdb-for-coverage...
Building pouchdb-generate-replication-id...
Building pouchdb-json...
Building pouchdb-mapreduce...
Building pouchdb-mapreduce-utils...
Building pouchdb-md5...
Building pouchdb-merge...
Building pouchdb-node...
Building pouchdb-replication...
Building pouchdb-selector-core...
Building pouchdb-utils...
Building sublevel-pouchdb...
  ✓ wrote pouchdb-adapter-localstorage/lib/index.js in vanilla mode
  ✓ wrote pouchdb-adapter-localstorage/lib/index.es.js in vanilla mode
  ✓ wrote pouchdb-adapter-memory/lib/index.js in vanilla mode
  ✓ wrote pouchdb-adapter-memory/lib/index.es.js in vanilla mode
  ✓ wrote pouchdb-checkpointer/lib/index.js in vanilla mode
  ✓ wrote pouchdb-checkpointer/lib/index.es.js in vanilla mode
  ✓ wrote pouchdb-errors/lib/index.js in vanilla mode
  ✓ wrote pouchdb-errors/lib/index.es.js in vanilla mode
  ✓ wrote pouchdb-generate-replication-id/lib/index.js in vanilla mode
  ✓ wrote pouchdb-generate-replication-id/lib/index.es.js in vanilla mode
  ✓ wrote pouchdb-adapter-http/lib/index.js in vanilla mode
  ✓ wrote pouchdb-adapter-http/lib/index.es.js in vanilla mode
  ✓ wrote pouchdb-adapter-leveldb/lib/index.js in node mode
  ✓ wrote pouchdb-adapter-leveldb/lib/index.es.js in node mode
  ✓ wrote pouchdb-adapter-leveldb/lib/index-browser.js in browser mode
  ✓ wrote pouchdb-adapter-leveldb/lib/index-browser.es.js in browser mode
  ✓ wrote pouchdb-fetch/lib/index-browser.js in browser mode
  ✓ wrote pouchdb-fetch/lib/index-browser.es.js in browser mode
  ✓ wrote pouchdb-md5/lib/index-browser.js in browser mode
  ✓ wrote pouchdb-md5/lib/index-browser.es.js in browser mode
  ✓ wrote pouchdb-changes-filter/lib/index-browser.js in browser mode
  ✓ wrote pouchdb-changes-filter/lib/index-browser.es.js in browser mode
  ✓ wrote pouchdb-adapter-leveldb-core/lib/index.js in node mode
  ✓ wrote pouchdb-adapter-leveldb-core/lib/index.es.js in node mode
  ✓ wrote pouchdb-adapter-leveldb-core/lib/index-browser.js in browser mode
  ✓ wrote pouchdb-adapter-leveldb-core/lib/index-browser.es.js in browser mode
  ✓ wrote pouchdb-collate/lib/index.js in vanilla mode
  ✓ wrote pouchdb-collate/lib/index.es.js in vanilla mode
  ✓ wrote pouchdb-fetch/lib/index.js in node mode
  ✓ wrote pouchdb-fetch/lib/index.es.js in node mode
  ✓ wrote pouchdb-json/lib/index.js in vanilla mode
  ✓ wrote pouchdb-json/lib/index.es.js in vanilla mode
  ✓ wrote pouchdb-md5/lib/index.js in node mode
  ✓ wrote pouchdb-md5/lib/index.es.js in node mode
  ✓ wrote pouchdb-mapreduce-utils/lib/index.js in vanilla mode
  ✓ wrote pouchdb-mapreduce-utils/lib/index.es.js in vanilla mode
  ✓ wrote pouchdb-changes-filter/lib/index.js in node mode
  ✓ wrote pouchdb-changes-filter/lib/index.es.js in node mode
  ✓ wrote pouchdb-adapter-idb/lib/index.js in vanilla mode
  ✓ wrote pouchdb-adapter-idb/lib/index.es.js in vanilla mode
  ✓ wrote pouchdb-abstract-mapreduce/lib/index.js in vanilla mode
  ✓ wrote pouchdb-abstract-mapreduce/lib/index.es.js in vanilla mode
  ✓ wrote pouchdb-binary-utils/lib/index-browser.js in browser mode
  ✓ wrote pouchdb-binary-utils/lib/index-browser.es.js in browser mode
  ✓ wrote pouchdb-adapter-utils/lib/index.js in vanilla mode
  ✓ wrote pouchdb-adapter-utils/lib/index.es.js in vanilla mode
  ✓ wrote pouchdb-binary-utils/lib/index.js in node mode
  ✓ wrote pouchdb-binary-utils/lib/index.es.js in node mode
  ✓ wrote pouchdb-adapter-indexeddb/lib/index.js in vanilla mode
  ✓ wrote pouchdb-adapter-indexeddb/lib/index.es.js in vanilla mode
  ✓ wrote pouchdb-collections/lib/index.js in vanilla mode
  ✓ wrote pouchdb-collections/lib/index.es.js in vanilla mode
  ✓ wrote pouchdb-merge/lib/index.js in vanilla mode
  ✓ wrote pouchdb-merge/lib/index.es.js in vanilla mode
  ✓ wrote pouchdb-selector-core/lib/index.js in vanilla mode
  ✓ wrote pouchdb-selector-core/lib/index.es.js in vanilla mode
  ✓ wrote pouchdb-utils/lib/index-browser.js in browser mode
  ✓ wrote pouchdb-utils/lib/index-browser.es.js in browser mode
  ✓ wrote pouchdb-utils/lib/index.js in node mode
  ✓ wrote pouchdb-utils/lib/index.es.js in node mode
  ✓ wrote sublevel-pouchdb/lib/index.js in vanilla mode
  ✓ wrote sublevel-pouchdb/lib/index.es.js in vanilla mode
  ✓ wrote pouchdb-mapreduce/lib/index-browser.js in browser mode
  ✓ wrote pouchdb-mapreduce/lib/index-browser.es.js in browser mode
  ✓ wrote pouchdb-mapreduce/lib/index.js in node mode
  ✓ wrote pouchdb-mapreduce/lib/index.es.js in node mode
  ✓ wrote pouchdb-replication/lib/index.js in vanilla mode
  ✓ wrote pouchdb-replication/lib/index.es.js in vanilla mode
  ✓ wrote pouchdb-core/lib/index.js in vanilla mode
  ✓ wrote pouchdb-core/lib/index.es.js in vanilla mode
  ✓ wrote pouchdb-find/lib/index.js in node mode
  ✓ wrote pouchdb-find/lib/index.es.js in node mode
  ✓ wrote pouchdb-find/lib/index-browser.js in browser mode
  ✓ wrote pouchdb-find/lib/index-browser.es.js in browser mode
  ✓ wrote pouchdb-browser/lib/index.js in vanilla mode
  ✓ wrote pouchdb-browser/lib/index.es.js in vanilla mode
  ✓ wrote pouchdb-node/lib/index.js in vanilla mode
  ✓ wrote pouchdb-node/lib/index.es.js in vanilla mode
  ✓ wrote pouchdb-for-coverage/lib/index.js in node mode
  ✓ wrote pouchdb-for-coverage/lib/index.es.js in node mode
  ✓ wrote pouchdb-for-coverage/lib/index-browser.js in browser mode
  ✓ wrote pouchdb-for-coverage/lib/index-browser.es.js in browser mode
  ✓ wrote packages/node_modules/pouchdb/lib/index.es.js
  ✓ wrote packages/node_modules/pouchdb/lib/index.js
Waiting for host to start ..
Host started :)
> pouchdb-monorepo@7.0.0-prerelease test-node
> bash bin/test-node.sh

Down server listening on port 3010
Seeded with: 1660146460051


  DB Setup
    ✓ PouchDB has a version
    ✓ PouchDB version matches package.json

  test.active_tasks.js
    ✓ Can add a task
    ✓ Can get tasks by id
    ✓ Can get all tasks
    ✓ Can update a task
    ✓ Can remove a task

  test.all_docs.js-http
    ✓ Testing all docs (152ms)
    ✓ Testing allDocs opts.keys (64ms)
    ✓ Testing allDocs opts.keys with skip
    ✓ Testing allDocs opts.keys with limit
    ✓ Testing allDocs invalid opts.keys
    ✓ Testing deleting in changes (45ms)
    ✓ Testing updating in changes (50ms)
    ✓ Testing include docs (39ms)
    ✓ Testing conflicts (62ms)
    ✓ test basic collation (49ms)
    ✓ 3883 start_key end_key aliases
    ✓ test total_rows with a variety of criteria (150ms)
    ✓ test total_rows with both skip and limit
    ✓ test limit option and total_rows
    ✓ test escaped startkey/endkey
    ✓ test "key" option
    ✓ test inclusive_end=false (55ms)
    ✓ test descending with startkey/endkey
    ✓ #3082 test wrong num results returned (253ms)
    ✓ test empty db
    ✓ test after db close
    ✓ 5793 _conflicts should not exist if no conflicts
    ✓ #6230 Test allDocs opts update_seq: false
    ✓ #6230 Test allDocs opts update_seq: true
    ✓ #6230 Test allDocs opts with update_seq missing

  test.all_docs.js-local
    ✓ Testing all docs
    ✓ Testing allDocs opts.keys
    ✓ Testing allDocs opts.keys with skip
    ✓ Testing allDocs opts.keys with limit
    ✓ Testing allDocs invalid opts.keys
    ✓ Testing deleting in changes
    ✓ Testing updating in changes
    ✓ Testing include docs
    ✓ Testing conflicts
    ✓ test basic collation
    ✓ 3883 start_key end_key aliases
    ✓ test total_rows with a variety of criteria
    ✓ test total_rows with both skip and limit
    ✓ test limit option and total_rows
    ✓ test escaped startkey/endkey
    ✓ test "key" option
    ✓ test inclusive_end=false
    ✓ test descending with startkey/endkey
    ✓ #3082 test wrong num results returned (187ms)
    ✓ test empty db
    ✓ test after db close
    ✓ test unicode ids and revs
    ✓ 5793 _conflicts should not exist if no conflicts
    ✓ #6230 Test allDocs opts update_seq: false
    ✓ #6230 Test allDocs opts update_seq: true
    ✓ #6230 Test allDocs opts with update_seq missing

  suite2 test.attachments.js-local
    ✓ 3357 Attachment names cant start with _
    ✓ 5736 warning for putAttachment without content_type
    ✓ 5736 warning for bulkDocs attachments without content_type
    ✓ fetch atts with open_revs and missing
    ✓ issue 2803 should throw 412
    ✓ issue 2803 should throw 412 part 2
    ✓ issue 2803 should throw 412 part 3
    ✓ issue 2803 should throw 412 part 4
    ✓ #2858 {binary: true} in get()
    ✓ #2858 {binary: true} in allDocs() 1
    ✓ #2858 {binary: true} in allDocs() 2
    ✓ #2858 {binary: true} in allDocs() 3
    ✓ #2858 {binary: true} in allDocs() 4
    ✓ #2858 {binary: true} in allDocs() 5
    ✓ #2858 {binary: true} in allDocs(), many atts
    ✓ #2858 {binary: true} in allDocs(), mixed atts
    ✓ #2858 {binary: true} in changes() non-live
    ✓ #2858 {binary: true} in changes() non-live, many atts
    ✓ #2858 {binary: true} in changes() non-live, mixed atts
    ✓ #2858 {binary: true} non-live changes, complete event
    ✓ #2858 {binary: true} in live changes
    ✓ #2858 {binary: true} in live changes, mixed atts
    ✓ #2858 {binary: true} in live+retry changes
    ✓ #2858 {binary: true} in live changes, attachments:false
    ✓ #2858 {binary: true} in live changes, include_docs:false
    ✓ #6736 {binary: true} in bulkGet()
    ✓ Measures length correctly after put()
    ✓ #3074 non-live changes()
    ✓ #3074 live changes()
    ✓ #3074 non-live changes(), no attachments
    ✓ #3074 live changes(), no attachments
    ✓ #3881 filter extraneous keys from _attachments
    ✓ #2771 allDocs() 1, single attachment
    ✓ #2771 allDocs() 2, many docs same att
    ✓ #2771 allDocs() 3, many docs diff atts
    ✓ #2771 allDocs() 4, mix of atts and no atts
    ✓ #2771 allDocs() 5, no atts
    ✓ #2771 allDocs() 6, no docs
    ✓ #2771 allDocs() 7, revisions and deletions
    ✓ #2771 allDocs() 8, empty attachment
    ✓ No length for non-stubs
    ✓ Test some attachments
    ✓ Test getAttachment
    ✓ Test getAttachment with stubs
    ✓ Test get() with binary:true and stubs
    ✓ Test attachments in allDocs/changes
    ✓ Test putAttachment with base64 plaintext
    ✓ Test putAttachment with invalid base64
    ✓ Test getAttachment with empty text
    ✓ Test getAttachment with normal text
    ✓ Test getAttachment with PNG
    ✓ Test getAttachment with PNG using bulkDocs
    ✓ Test getAttachment with PNG using post
    ✓ Test postAttachment with PNG then bulkDocs
    ✓ proper stub behavior
    ✓ Testing with invalid docs
    ✓ Test create attachment and doc in one go
    ✓ Test create attachment and doc in one go without callback
    ✓ Test create attachment without callback
    ✓ Test put attachment on a doc without attachments
    ✓ Test put attachment with unencoded name
    ✓ 3963 length property on stubs
    ✓ Testing with invalid rev
    ✓ Test put another attachment on a doc with attachments
    ✓ Test get with attachments: true if empty attachments
    ✓ Test delete attachment from a doc
    ✓ Test a document with a json string attachment
    ✓ Test remove doc with attachment
    ✓ Try to insert a doc with unencoded attachment
    ✓ Try to get attachment of unexistent doc
    ✓ Test synchronous putAttachment with text data
    ✓ Test synchronous putAttachment with no text data
    ✓ Test put with partial stubs
    ✓ Test put with attachments and new_edits=false
    ✓ Test getAttachment with specific rev
    ✓ Test getAttachment with diff revs and content
    ✓ Test stubs
    ✓ Try to get unexistent attachment of some doc
    ✓ putAttachment and getAttachment with plaintext
    ✓ putAttachment and getAttachment with png data
    ✓ putAttachment in new doc with base64
    ✓ #2818 - save same attachment in different revs
    ✓ #2818 - save same attachment many times in parallel
    ✓ #2818 - revisions keep attachments (no compaction)
    ✓ #2818 - doesn't throw 409 if same filename
    ✓ #3008 test correct encoding/decoding of \u0000 etc.
    ✓ putAttachment and getAttachment with big png data (92ms)
    ✓ #2709 `revpos` with putAttachment
    ✓ #2709 `revpos` with inline attachment
    ✓ #2709 `revpos` with allDocs
    ✓ #7403 {attachments: true, binary: true, include_docs: true} in allDocs with one missing doc

  suite2 test.attachments.js-http
    ✓ 3357 Attachment names cant start with _
    ✓ 5736 warning for putAttachment without content_type
    ✓ 5736 warning for bulkDocs attachments without content_type
    ✓ fetch atts with open_revs and missing
    ✓ issue 2803 should throw 412
    ✓ issue 2803 should throw 412 part 2
    ✓ issue 2803 should throw 412 part 3
    ✓ issue 2803 should throw 412 part 4
    ✓ #2858 {binary: true} in get() (43ms)
    ✓ #2858 {binary: true} in allDocs() 1
    ✓ #2858 {binary: true} in allDocs() 2
    ✓ #2858 {binary: true} in allDocs() 3
    ✓ #2858 {binary: true} in allDocs() 4
    ✓ #2858 {binary: true} in allDocs() 5
    ✓ #2858 {binary: true} in allDocs(), many atts
    ✓ #2858 {binary: true} in allDocs(), mixed atts
    ✓ #2858 {binary: true} in changes() non-live
    ✓ #2858 {binary: true} in changes() non-live, many atts
    ✓ #2858 {binary: true} in changes() non-live, mixed atts
    ✓ #2858 {binary: true} non-live changes, complete event
    ✓ #2858 {binary: true} in live changes
    ✓ #2858 {binary: true} in live changes, mixed atts
    ✓ #2858 {binary: true} in live+retry changes
    ✓ #2858 {binary: true} in live changes, attachments:false
    ✓ #2858 {binary: true} in live changes, include_docs:false
    ✓ #6736 {binary: true} in bulkGet()
    ✓ Measures length correctly after put()
    ✓ #3074 non-live changes() (39ms)
    ✓ #3074 live changes() (41ms)
    ✓ #3074 non-live changes(), no attachments
    ✓ #3074 live changes(), no attachments
    ✓ #3881 filter extraneous keys from _attachments
    ✓ #2771 allDocs() 1, single attachment (55ms)
    ✓ #2771 allDocs() 2, many docs same att (46ms)
    ✓ #2771 allDocs() 3, many docs diff atts
    ✓ #2771 allDocs() 4, mix of atts and no atts
    ✓ #2771 allDocs() 5, no atts
    ✓ #2771 allDocs() 6, no docs
    ✓ #2771 allDocs() 7, revisions and deletions
    ✓ #2771 allDocs() 8, empty attachment (43ms)
    ✓ No length for non-stubs
    ✓ Test some attachments (43ms)
    ✓ Test getAttachment
    ✓ Test getAttachment with stubs
    ✓ Test get() with binary:true and stubs
    ✓ Test attachments in allDocs/changes
    ✓ Test putAttachment with base64 plaintext
    ✓ Test putAttachment with invalid base64
    ✓ Test getAttachment with empty text
    ✓ Test getAttachment with normal text
    ✓ Test getAttachment with PNG
    ✓ Test getAttachment with PNG using bulkDocs
    ✓ Test getAttachment with PNG using post
    ✓ Test postAttachment with PNG then bulkDocs
    ✓ proper stub behavior
    ✓ Testing with invalid docs
    ✓ Test create attachment and doc in one go
    ✓ Test create attachment and doc in one go without callback
    ✓ Test create attachment without callback (40ms)
    ✓ Test put attachment on a doc without attachments
    ✓ Test put attachment with unencoded name
    ✓ 3963 length property on stubs (45ms)
    ✓ Testing with invalid rev
    ✓ Test put another attachment on a doc with attachments
    ✓ Test get with attachments: true if empty attachments
    ✓ Test delete attachment from a doc (41ms)
    ✓ Test a document with a json string attachment
    ✓ Test remove doc with attachment
    ✓ Try to insert a doc with unencoded attachment
    ✓ Try to get attachment of unexistent doc
    ✓ Test synchronous putAttachment with text data
    ✓ Test synchronous putAttachment with no text data
    ✓ Test put with partial stubs
    ✓ Test put with attachments and new_edits=false
    ✓ Test getAttachment with specific rev (40ms)
    ✓ Test getAttachment with diff revs and content
    ✓ Test stubs
    ✓ Try to get unexistent attachment of some doc
    ✓ putAttachment and getAttachment with plaintext
    ✓ putAttachment and getAttachment with png data
    ✓ putAttachment in new doc with base64
    ✓ #2818 - save same attachment in different revs (48ms)
    ✓ #2818 - save same attachment many times in parallel
    ✓ #2818 - revisions keep attachments (no compaction)
    ✓ #2818 - doesn't throw 409 if same filename
    ✓ #3008 test correct encoding/decoding of \u0000 etc.
    ✓ putAttachment and getAttachment with big png data (135ms)
    ✓ #2709 `revpos` with putAttachment (41ms)
    ✓ #2709 `revpos` with inline attachment
    ✓ #2709 `revpos` with allDocs
    ✓ #7403 {attachments: true, binary: true, include_docs: true} in allDocs with one missing doc

  suite2 test.attachments.js- local:http
    ✓ Attachments replicate back and forth (207ms)
    ✓ Replicate same doc, same atts (115ms)
    ✓ Replicate same doc, same atts 2 (108ms)
    ✓ Attachments replicate (81ms)
    ✓ Attachment types replicate (52ms)
    ✓ Many many attachments replicate (184ms)
    ✓ Many many png attachments replicate (196ms)
    ✓ Multiple attachments replicate (92ms)
    - #3961 Many attachments on same doc
    ✓ Multiple attachments replicate, different docs (#2698) (88ms)
    ✓ Multiple attachments replicate, different docs png (#2698) (70ms)
    ✓ #3932 attachments with tricky revpos (133ms)
    ✓ replication with changing attachments (96ms)
    ✓ 3955 race condition in put
    ✓ #8456 bad attachment rev after replication (118ms)

  suite2 test.attachments.js- http:http
    ✓ Attachments replicate back and forth (158ms)
    ✓ Replicate same doc, same atts (279ms)
    ✓ Replicate same doc, same atts 2 (180ms)
    ✓ Attachments replicate (78ms)
    ✓ Attachment types replicate (118ms)
    ✓ Many many attachments replicate (357ms)
    ✓ Many many png attachments replicate (292ms)
    ✓ Multiple attachments replicate (122ms)
    - #3961 Many attachments on same doc
    ✓ Multiple attachments replicate, different docs (#2698) (122ms)
    ✓ Multiple attachments replicate, different docs png (#2698) (120ms)
    ✓ #3932 attachments with tricky revpos (227ms)
    ✓ replication with changing attachments (210ms)
    ✓ 3955 race condition in put
    ✓ #8456 bad attachment rev after replication (197ms)

  suite2 test.attachments.js- http:local
    ✓ Attachments replicate back and forth (106ms)
    ✓ Replicate same doc, same atts (92ms)
    ✓ Replicate same doc, same atts 2 (96ms)
    ✓ Attachments replicate (65ms)
    ✓ Attachment types replicate (55ms)
    ✓ Many many attachments replicate (143ms)
    ✓ Many many png attachments replicate (154ms)
    ✓ Multiple attachments replicate (81ms)
    - #3961 Many attachments on same doc
    ✓ Multiple attachments replicate, different docs (#2698) (70ms)
    ✓ Multiple attachments replicate, different docs png (#2698) (86ms)
    ✓ #3932 attachments with tricky revpos (147ms)
    ✓ replication with changing attachments (99ms)
    ✓ 3955 race condition in put
    ✓ #8456 bad attachment rev after replication (112ms)

  suite2 test.attachments.js- local:local
    ✓ Attachments replicate back and forth
    ✓ Replicate same doc, same atts (63ms)
    ✓ Replicate same doc, same atts 2 (38ms)
    ✓ Attachments replicate
    ✓ Attachment types replicate
    ✓ Many many attachments replicate
    ✓ Many many png attachments replicate
    ✓ Multiple attachments replicate
    - #3961 Many attachments on same doc
    ✓ Multiple attachments replicate, different docs (#2698)
    ✓ Multiple attachments replicate, different docs png (#2698)
    ✓ #3932 attachments with tricky revpos
    ✓ replication with changing attachments
    ✓ 3955 race condition in put
    ✓ #8456 bad attachment rev after replication

  test.basics.js-http
    ✓ Create a pouch without new keyword
    ✓ Name is accessible via instance
    ✓ 4314 Create a pouch with + in name
    ✓ Creating Pouch without name will throw
    ✓ 4314 Create a pouch with urlencoded name
    ✓ 4219 destroy a pouch
    ✓ 4339 throw useful error if method called on stale instance
    ✓ [4595] should reject xhr errors
    ✓ [4595] should emit error event on xhr error
    ✓ Add a doc
    ✓ Get invalid id
    ✓ Missing doc should contain ID in error object
    ✓ PUTed Conflicted doc should contain ID in error object
    ✓ POSTed Conflicted doc should contain ID in error object
    ✓ Add a doc with a promise
    ✓ Add a doc with opts object
    ✓ Modify a doc
    ✓ Modifying a doc that has rewritten content
    ✓ Modify a doc with a promise
    ✓ Read db id
    ✓ Read db id with promise
    ✓ Close db
    ✓ Close db with a promise
    ✓ Read db id after closing Close
    ✓ Modify a doc with incorrect rev
    ✓ Remove doc
    ✓ Remove doc with a promise
    ✓ Remove doc with new syntax
    ✓ Remove doc with new syntax and a promise
    ✓ Doc removal leaves only stub
    ✓ Remove doc twice with specified id (43ms)
    ✓ Remove doc, no callback
    ✓ Delete document without id
    ✓ Delete document with many args
    ✓ Delete document with many args, callback style
    ✓ Delete doc with id + rev + no opts
    ✓ Delete doc with id + rev + no opts, callback style
    ✓ Delete doc with doc + opts
    ✓ Delete doc with doc + opts, callback style
    ✓ Delete doc with rev in opts
    ✓ Bulk docs
    ✓ Bulk docs with a promise
    ✓ Basic checks
    ✓ update with invalid rev
    ✓ Doc validation
    ✓ Replication fields (#2442)
    ✓ Testing issue #48 (55ms)
    ✓ Testing valid id
    ✓ Put doc without _id should fail
    ✓ Put doc with bad reserved id should fail
    ✓ update_seq persists
    ✓ deletions persists
    ✓ #4126 should not store raw Dates
    ✓ Create a db with a reserved name
    ✓ Error when document is not an object
    ✓ Test instance update_seq updates correctly
    ✓ Fail to fetch a doc after db was deleted (67ms)
    ✓ Fail to fetch a doc after db was deleted (61ms)
    ✓ Cant add docs with empty ids
    ✓ Test doc with percent in ID
    ✓ db.info should give auto_compaction = false (#2744)
    ✓ db.info should give auto_compaction = true (#2744)
    ✓ db.info should give adapter name (#3567)
    ✓ db.info should give correct doc_count
    ✓ putting returns {ok: true}
    ✓ putting is override-able
    ✓ issue 2779, deleted docs, old revs COUCHDB-292
    ✓ issue 2888, successive deletes and writes (41ms)
    ✓ 2 invalid puts
    ✓ Docs save "null" value
    ✓ replace PouchDB.destroy() (express-pouchdb#203)
    ✓ 3968, keeps all object fields
    ✓ 4712 invalid rev for new doc generates conflict
    ✓ test info() after db close
    ✓ test get() after db close
    ✓ test close() after db close
    ✓ 7259 should have "this" keyword properly scoped
    ✓ #5471 PouchDB.plugin() should throw error if passed wrong type or empty object

  test.basics.js-local
    ✓ Create a pouch without new keyword
    ✓ Name is accessible via instance
    ✓ 4314 Create a pouch with + in name
    ✓ Creating Pouch without name will throw
    ✓ 4314 Create a pouch with urlencoded name
    ✓ 4219 destroy a pouch
    ✓ 4339 throw useful error if method called on stale instance
    ✓ [4595] should reject xhr errors
    ✓ [4595] should emit error event on xhr error
    ✓ Add a doc
    ✓ Get invalid id
    ✓ Missing doc should contain ID in error object
    ✓ PUTed Conflicted doc should contain ID in error object
    ✓ POSTed Conflicted doc should contain ID in error object
    ✓ Add a doc with a promise
    ✓ Add a doc with opts object
    ✓ Modify a doc
    ✓ Modifying a doc that has rewritten content
    ✓ Modify a doc with a promise
    ✓ Read db id
    ✓ Read db id with promise
    ✓ Close db
    ✓ Close db with a promise
    ✓ Read db id after closing Close
    ✓ Modify a doc with incorrect rev
    ✓ Remove doc
    ✓ Remove doc with a promise
    ✓ Remove doc with new syntax
    ✓ Remove doc with new syntax and a promise
    ✓ Doc removal leaves only stub
    ✓ Remove doc twice with specified id
    ✓ Remove doc, no callback
    ✓ Delete document without id
    ✓ Delete document with many args
    ✓ Delete document with many args, callback style
    ✓ Delete doc with id + rev + no opts
    ✓ Delete doc with id + rev + no opts, callback style
    ✓ Delete doc with doc + opts
    ✓ Delete doc with doc + opts, callback style
    ✓ Delete doc with rev in opts
    ✓ Bulk docs
    ✓ Bulk docs with a promise
    ✓ Basic checks
    ✓ update with invalid rev
    ✓ Doc validation
    ✓ Replication fields (#2442)
    ✓ Allows _access field in documents (#8171)
    ✓ Testing issue #48 (53ms)
    ✓ Testing valid id
    ✓ Put doc without _id should fail
    ✓ Put doc with bad reserved id should fail
    ✓ update_seq persists
    ✓ deletions persists
    ✓ #4126 should not store raw Dates
    ✓ Create a db with a reserved name
    ✓ Error when document is not an object
    ✓ Test instance update_seq updates correctly
    ✓ Fail to fetch a doc after db was deleted
    ✓ Fail to fetch a doc after db was deleted
    ✓ Cant add docs with empty ids
    ✓ Test doc with percent in ID
    ✓ db.info should give auto_compaction = false (#2744)
    ✓ db.info should give auto_compaction = true (#2744)
    ✓ db.info should give adapter name (#3567)
    ✓ db.info should give correct doc_count
    ✓ putting returns {ok: true}
    ✓ putting is override-able
    ✓ issue 2779, deleted docs, old revs COUCHDB-292
    ✓ issue 2888, successive deletes and writes
    ✓ 2 invalid puts
    ✓ Docs save "null" value
    ✓ replace PouchDB.destroy() (express-pouchdb#203)
    ✓ 3968, keeps all object fields
    ✓ 4712 invalid rev for new doc generates conflict
    ✓ test info() after db close
    ✓ test get() after db close
    ✓ test close() after db close
    ✓ 7259 should have "this" keyword properly scoped
    ✓ should allow unicode doc ids
    ✓ should have same blob support for 2 dbs
    ✓ 6053, PouchDB.plugin() resets defaults
    ✓ #5471 PouchDB.plugin() should throw error if passed wrong type or empty object

  test.bulk_docs.js-local
    ✓ Testing bulk docs
    ✓ #6039 test id in bulk docs for conflict
    ✓ No id in bulk docs
    ✓ No _rev and new_edits=false
    ✓ 7829 bare rev 1- with new_edits=false
    ✓ Test empty bulkDocs
    ✓ Test many bulkDocs
    ✓ Test errors on invalid doc id
    ✓ Test two errors on invalid doc id
    ✓ No docs
    ✓ Jira 911
    ✓ Test multiple bulkdocs
    ✓ #2935 new_edits=false correct number
    ✓ #2935 new_edits=false correct number 2
    ✓ bulk docs update then delete then conflict
    ✓ bulk_docs delete then undelete
    ✓ #2935 new_edits=false with single unauthorized
    ✓ Deleting _local docs with bulkDocs
    ✓ Deleting _local docs with bulkDocs, not found
    ✓ Deleting _local docs with bulkDocs, wrong rev
    ✓ Bulk with new_edits=false
    ✓ Testing successive new_edits to the same doc
    ✓ #3062 bulkDocs with staggered seqs
    ✓ Testing successive new_edits to the same doc, different content
    ✓ Testing successive new_edits to two doc
    ✓ Deletion with new_edits=false
    ✓ Deletion with new_edits=false, no history
    ✓ Modification with new_edits=false, no history
    ✓ Deletion with new_edits=false, no history, no revisions
    ✓ Testing new_edits=false in req body
    ✓ 656 regression in handling deleted docs
    ✓ Test quotes in doc ids
    ✓ Bulk docs empty list
    ✓ handles simultaneous writes
    ✓ bulk docs input by array
    ✓ Bulk empty list
    ✓ Bulk docs not an array
    ✓ Bulk docs not an object
    ✓ Bulk docs two different revisions to same document id
    ✓ 4204 respect revs_limit (258ms)
    ✓ 2839 implement revs_limit (195ms)
    ✓ 4372 revs_limit deletes old revisions of the doc
    ✓ 4372 revs_limit with auto_compaction deletes old revisions of the doc
    ✓ 4712 invalid rev for new doc generates conflict
    ✓ 5793 bulk docs accepts _conflicts when new_edits=false

  test.bulk_docs.js-http
    ✓ Testing bulk docs
    ✓ #6039 test id in bulk docs for conflict
    ✓ No id in bulk docs
    ✓ No _rev and new_edits=false
    ✓ 7829 bare rev 1- with new_edits=false
    ✓ Test empty bulkDocs
    ✓ Test many bulkDocs
    ✓ Test errors on invalid doc id
    ✓ Test two errors on invalid doc id
    ✓ No docs
    ✓ Jira 911
    ✓ Test multiple bulkdocs
    ✓ #2935 new_edits=false correct number
    ✓ #2935 new_edits=false correct number 2
    ✓ bulk docs update then delete then conflict
    ✓ bulk_docs delete then undelete
    ✓ #2935 new_edits=false with single unauthorized
    ✓ Deleting _local docs with bulkDocs
    ✓ Bulk with new_edits=false
    ✓ Testing successive new_edits to the same doc
    ✓ #3062 bulkDocs with staggered seqs
    ✓ Testing successive new_edits to the same doc, different content
    ✓ Testing successive new_edits to two doc
    ✓ Deletion with new_edits=false
    ✓ Deletion with new_edits=false, no history
    ✓ Modification with new_edits=false, no history
    ✓ Deletion with new_edits=false, no history, no revisions
    ✓ Testing new_edits=false in req body
    ✓ 656 regression in handling deleted docs
    ✓ Test quotes in doc ids
    ✓ Bulk docs empty list
    ✓ handles simultaneous writes
    ✓ bulk docs input by array (45ms)
    ✓ Bulk empty list
    ✓ Bulk docs not an array
    ✓ Bulk docs not an object
    ✓ Bulk docs two different revisions to same document id
    ✓ 4204 respect revs_limit (251ms)
    ✓ 2839 implement revs_limit
    ✓ 4372 revs_limit deletes old revisions of the doc
    ✓ 4372 revs_limit with auto_compaction deletes old revisions of the doc
    ✓ 4712 invalid rev for new doc generates conflict
    ✓ 5793 bulk docs accepts _conflicts when new_edits=false (41ms)

  test.bulk_get.js-http
    ✓ test bulk get with rev specified
    ✓ test bulk get with latest=true
    ✓ test bulk get with no rev specified
    ✓ _revisions is not returned by default
    ✓ #5886 bulkGet with reserved id
    ✓ _revisions is returned when specified
    ✓ _revisions is returned when specified, using implicit rev
    ✓ attachments are not included by default
    ✓ attachments are included when specified
    ✓ attachments are included when specified, using implicit rev (43ms)

  test.bulk_get.js-local
    ✓ test bulk get with rev specified
    ✓ test bulk get with latest=true
    ✓ test bulk get with no rev specified
    ✓ _revisions is not returned by default
    ✓ #5886 bulkGet with reserved id
    ✓ _revisions is returned when specified
    ✓ _revisions is returned when specified, using implicit rev
    ✓ attachments are not included by default
    ✓ attachments are included when specified
    ✓ attachments are included when specified, using implicit rev

  test.changes.js-http
    ✓ All changes
    ✓ Changes with complete callback as param
    ✓ Promise resolved when changes cancelled
    - Live changes should clean listener when cancelled
    ✓ Changes Since
    ✓ Changes Since and limit limit 1
    ✓ Changes Since and limit limit 0
    ✓ Changes limit
    ✓ Changes with filter not present in ddoc
    ✓ Changes with `filters` key not present in ddoc
    ✓ Changes limit and filter
    ✓ Changes with shorthand function name
    ✓ Changes with filter from nonexistent ddoc
    ✓ Changes with view not present in ddoc
    ✓ Changes with `views` key not present in ddoc
    ✓ #4451 Changes with invalid view filter
    ✓ 3356 throw inside a filter
    ✓ Changes with missing param `view` in request
    ✓ Changes limit and view instead of filter
    ✓ #3609 view option implies filter: _view
    ✓ Immediately cancel changes
    ✓ Changes with invalid ddoc view name
    ✓ Changes with invalid ddoc view name 2
    ✓ Changes with style = all_docs (66ms)
    ✓ Changes with style = all_docs and a callback for complete (61ms)
    ✓ Changes limit = 0
    ✓ Changes doc
    - Descending many changes
    ✓ live-changes
    ✓ Multiple watchers
    ✓ Continuous changes doc (45ms)
    ✓ Cancel changes (333ms)
    ✓ #3579 changes firing 1 too many times (75ms)
    ✓ Kill database while listening to live changes
    ✓ #3136 style=all_docs
    ✓ #4191 revs_diff causes endless loop
    ✓ #3136 style=all_docs & include_docs
    ✓ changes-filter with query params
    ✓ Non-live changes filter
    ✓ Non-live changes filter, descending
    ✓ #2569 Non-live doc_ids filter
    ✓ #2569 Big non-live doc_ids filter
    ✓ #2569 Live doc_ids filter
    ✓ #2569 Big live doc_ids filter
    ✓ #2569 Non-live doc_ids filter with filter=_doc_ids
    ✓ #2569 Live doc_ids filter with filter=_doc_ids
    ✓ Changes to same doc are grouped
    ✓ Changes with conflicts are handled correctly (130ms)
    ✓ Change entry for a deleted doc
    ✓ changes large number of docs
    ✓ Calling db.changes({since: 'now'})
    ✓ Calling db.changes({since: 'latest'})
    ✓ Closing db does not cause a crash if changes cancelled
    ✓ fire-complete-on-cancel (102ms)
    ✓ changes are not duplicated (1024ms)
    ✓ supports return_docs=false
    ✓ should respects limit (70ms)
    ✓ doesn't throw if opts.complete is undefined
    ✓ handle individual changes in live replication (200ms)
    ✓ changes-filter without filter
    ✓ #3539 - Exception in changes is fine
    ✓ Changes with selector
    ✓ Changes with selector, explicit filter
    ✓ Changes with selector and mismatched filter
    ✓ Changes with limit and selector

  test.changes.js-local
    ✓ All changes
    ✓ Changes with complete callback as param
    ✓ Promise resolved when changes cancelled
    - Live changes should clean listener when cancelled
    ✓ Changes Since
    ✓ Changes Since and limit limit 1
    ✓ Changes Since and limit limit 0
    ✓ Changes limit
    ✓ Changes with filter not present in ddoc
    ✓ Changes with `filters` key not present in ddoc
    ✓ Changes limit and filter
    ✓ Changes with shorthand function name
    ✓ Changes with filter from nonexistent ddoc
    ✓ Changes with view not present in ddoc
    ✓ Changes with `views` key not present in ddoc
    ✓ #4451 Changes with invalid view filter
    ✓ 3356 throw inside a filter
    ✓ Changes with missing param `view` in request
    ✓ Changes limit and view instead of filter
    ✓ #3609 view option implies filter: _view
    ✓ Immediately cancel changes
    ✓ Changes with invalid ddoc view name
    ✓ Changes with invalid ddoc view name 2
    ✓ Changes with style = all_docs
    ✓ Changes with style = all_docs and a callback for complete
    ✓ Changes limit = 0
    ✓ Changes doc
    - Descending many changes
    ✓ live-changes
    ✓ Multiple watchers
    ✓ Continuous changes doc
    ✓ Cancel changes (318ms)
    ✓ #3579 changes firing 1 too many times (65ms)
    ✓ Kill database while listening to live changes
    ✓ #3136 style=all_docs
    ✓ #4191 revs_diff causes endless loop
    ✓ #3136 style=all_docs & include_docs
    ✓ changes-filter with query params
    ✓ Non-live changes filter
    ✓ Non-live changes filter, descending
    ✓ #2569 Non-live doc_ids filter
    ✓ #2569 Big non-live doc_ids filter
    ✓ #2569 Live doc_ids filter
    ✓ #2569 Big live doc_ids filter
    ✓ #2569 Non-live doc_ids filter with filter=_doc_ids
    ✓ #2569 Live doc_ids filter with filter=_doc_ids
    ✓ Changes to same doc are grouped
    ✓ Changes with conflicts are handled correctly
    ✓ Change entry for a deleted doc
    ✓ changes large number of docs (61ms)
    ✓ Calling db.changes({since: 'now'})
    ✓ Calling db.changes({since: 'latest'})
    ✓ Closing db does not cause a crash if changes cancelled
    ✓ fire-complete-on-cancel (101ms)
    ✓ changes are not duplicated (1015ms)
    ✓ supports return_docs=false
    ✓ should respects limit (69ms)
    ✓ doesn't throw if opts.complete is undefined
    ✓ handle individual changes in live replication (139ms)
    ✓ changes-filter without filter
    ✓ #3539 - Exception in changes is fine
    ✓ Changes with selector
    ✓ Changes with selector, explicit filter
    ✓ Changes with selector and mismatched filter
    ✓ Changes with limit and selector

  changes-standalone
    - Changes reports errors

  test.close.js-local
    ✓ should emit destroyed even when closed (sync)
    ✓ should emit destroyed even when closed (async)
precondition_failed: Database not open
    at Object.<anonymous> (/data/js-variants/multee/Clients/levelup/pouchdb/packages/node_modules/pouchdb/lib/index.js:614:16)
    at Module._compile (node:internal/modules/cjs/loader:1105:14)
    at Module._extensions..js (node:internal/modules/cjs/loader:1159:10)
    at Module.load (node:internal/modules/cjs/loader:981:32)
    at Module._load (node:internal/modules/cjs/loader:827:12)
    at Module.require (node:internal/modules/cjs/loader:1005:19)
    at require (node:internal/modules/cjs/helpers:102:18)
    at commonUtils.loadPouchDBForNode (/data/js-variants/multee/Clients/levelup/pouchdb/tests/common-utils.js:92:17)
    at commonUtils.loadPouchDB (/data/js-variants/multee/Clients/levelup/pouchdb/tests/common-utils.js:78:39)
    at Object.<anonymous> (/data/js-variants/multee/Clients/levelup/pouchdb/tests/integration/node.setup.js:21:28)
    at Module._compile (node:internal/modules/cjs/loader:1105:14)
    at Module._extensions..js (node:internal/modules/cjs/loader:1159:10)
    at Module.load (node:internal/modules/cjs/loader:981:32)
    at Module._load (node:internal/modules/cjs/loader:827:12)
    at Module.require (node:internal/modules/cjs/loader:1005:19)
    at require (node:internal/modules/cjs/helpers:102:18)
    at /data/js-variants/multee/Clients/levelup/pouchdb/node_modules/mocha/bin/_mocha:366:3
    at Array.forEach (<anonymous>)
    at Object.<anonymous> (/data/js-variants/multee/Clients/levelup/pouchdb/node_modules/mocha/bin/_mocha:365:10)
    at Module._compile (node:internal/modules/cjs/loader:1105:14)
    at Module._extensions..js (node:internal/modules/cjs/loader:1159:10)
    at Module.load (node:internal/modules/cjs/loader:981:32)
    at Module._load (node:internal/modules/cjs/loader:827:12)
    at Function.executeUserEntryPoint [as runMain] (node:internal/modules/run_main:77:12)
    at node:internal/main/run_main_module:17:47
    ✓ should emit closed even when destroyed (async #2)
precondition_failed: Database not open
    at Object.<anonymous> (/data/js-variants/multee/Clients/levelup/pouchdb/packages/node_modules/pouchdb/lib/index.js:614:16)
    at Module._compile (node:internal/modules/cjs/loader:1105:14)
    at Module._extensions..js (node:internal/modules/cjs/loader:1159:10)
    at Module.load (node:internal/modules/cjs/loader:981:32)
    at Module._load (node:internal/modules/cjs/loader:827:12)
    at Module.require (node:internal/modules/cjs/loader:1005:19)
    at require (node:internal/modules/cjs/helpers:102:18)
    at commonUtils.loadPouchDBForNode (/data/js-variants/multee/Clients/levelup/pouchdb/tests/common-utils.js:92:17)
    at commonUtils.loadPouchDB (/data/js-variants/multee/Clients/levelup/pouchdb/tests/common-utils.js:78:39)
    at Object.<anonymous> (/data/js-variants/multee/Clients/levelup/pouchdb/tests/integration/node.setup.js:21:28)
    at Module._compile (node:internal/modules/cjs/loader:1105:14)
    at Module._extensions..js (node:internal/modules/cjs/loader:1159:10)
    at Module.load (node:internal/modules/cjs/loader:981:32)
    at Module._load (node:internal/modules/cjs/loader:827:12)
    at Module.require (node:internal/modules/cjs/loader:1005:19)
    at require (node:internal/modules/cjs/helpers:102:18)
    at /data/js-variants/multee/Clients/levelup/pouchdb/node_modules/mocha/bin/_mocha:366:3
    at Array.forEach (<anonymous>)
    at Object.<anonymous> (/data/js-variants/multee/Clients/levelup/pouchdb/node_modules/mocha/bin/_mocha:365:10)
    at Module._compile (node:internal/modules/cjs/loader:1105:14)
    at Module._extensions..js (node:internal/modules/cjs/loader:1159:10)
    at Module.load (node:internal/modules/cjs/loader:981:32)
    at Module._load (node:internal/modules/cjs/loader:827:12)
    at Function.executeUserEntryPoint [as runMain] (node:internal/modules/run_main:77:12)
    at node:internal/main/run_main_module:17:47
    ✓ test unref for coverage
    ✓ test double unref for coverage
precondition_failed: Database not open
    at Object.<anonymous> (/data/js-variants/multee/Clients/levelup/pouchdb/packages/node_modules/pouchdb/lib/index.js:614:16)
    at Module._compile (node:internal/modules/cjs/loader:1105:14)
    at Module._extensions..js (node:internal/modules/cjs/loader:1159:10)
    at Module.load (node:internal/modules/cjs/loader:981:32)
    at Module._load (node:internal/modules/cjs/loader:827:12)
    at Module.require (node:internal/modules/cjs/loader:1005:19)
    at require (node:internal/modules/cjs/helpers:102:18)
    at commonUtils.loadPouchDBForNode (/data/js-variants/multee/Clients/levelup/pouchdb/tests/common-utils.js:92:17)
    at commonUtils.loadPouchDB (/data/js-variants/multee/Clients/levelup/pouchdb/tests/common-utils.js:78:39)
    at Object.<anonymous> (/data/js-variants/multee/Clients/levelup/pouchdb/tests/integration/node.setup.js:21:28)
    at Module._compile (node:internal/modules/cjs/loader:1105:14)
    at Module._extensions..js (node:internal/modules/cjs/loader:1159:10)
    at Module.load (node:internal/modules/cjs/loader:981:32)
    at Module._load (node:internal/modules/cjs/loader:827:12)
    at Module.require (node:internal/modules/cjs/loader:1005:19)
    at require (node:internal/modules/cjs/helpers:102:18)
    at /data/js-variants/multee/Clients/levelup/pouchdb/node_modules/mocha/bin/_mocha:366:3
    at Array.forEach (<anonymous>)
    at Object.<anonymous> (/data/js-variants/multee/Clients/levelup/pouchdb/node_modules/mocha/bin/_mocha:365:10)
    at Module._compile (node:internal/modules/cjs/loader:1105:14)
    at Module._extensions..js (node:internal/modules/cjs/loader:1159:10)
    at Module.load (node:internal/modules/cjs/loader:981:32)
    at Module._load (node:internal/modules/cjs/loader:827:12)
    at Function.executeUserEntryPoint [as runMain] (node:internal/modules/run_main:77:12)
    at node:internal/main/run_main_module:17:47
    ✓ test close-then-destroyed for coverage
************* run test done *************
pouchdb is testing ./VariantsDeps/levelup/variant4/levelup
************* npm unlink module *************

removed 1 package, changed 1 package, and audited 1032 packages in 3s

64 packages are looking for funding
  run `npm fund` for details

41 vulnerabilities (1 low, 9 moderate, 25 high, 6 critical)

To address issues that do not require attention, run:
  npm audit fix

To address all issues possible (including breaking changes), run:
  npm audit fix --force

Some issues need review, and may require choosing
a different dependency.

Run `npm audit` for details.
************* npm unlink module done *************
************* npm unlink globally *************

removed 1 package, and audited 1 package in 1s

found 0 vulnerabilities
************* npm unlink module done *************
************* npm link globally *************

added 1 package, and audited 3 packages in 428ms

found 0 vulnerabilities
************* npm link globally done *************
************* npm link module *************

added 1 package, changed 1 package, and audited 1034 packages in 4s

64 packages are looking for funding
  run `npm fund` for details

41 vulnerabilities (1 low, 9 moderate, 25 high, 6 critical)

To address issues that do not require attention, run:
  npm audit fix

To address all issues possible (including breaking changes), run:
  npm audit fix --force

Some issues need review, and may require choosing
a different dependency.

Run `npm audit` for details.
************* npm link module done *************
************* start run test *************

> pouchdb-monorepo@7.0.0-prerelease test
> bash bin/run-test.sh


> pouchdb-monorepo@7.0.0-prerelease build-node
> bash bin/build-node.sh


> pouchdb-monorepo@7.0.0-prerelease build-modules
> node bin/build-modules.js

Building pouchdb...
Building pouchdb-abstract-mapreduce...
Building pouchdb-adapter-http...
Building pouchdb-adapter-idb...
Building pouchdb-adapter-indexeddb...
Building pouchdb-adapter-leveldb...
Building pouchdb-adapter-leveldb-core...
Building pouchdb-adapter-localstorage...
Building pouchdb-adapter-memory...
Building pouchdb-adapter-utils...
Building pouchdb-binary-utils...
Building pouchdb-browser...
Building pouchdb-changes-filter...
Building pouchdb-checkpointer...
Building pouchdb-collate...
Building pouchdb-collections...
Building pouchdb-core...
Building pouchdb-errors...
Building pouchdb-fetch...
Building pouchdb-find...
Building pouchdb-for-coverage...
Building pouchdb-generate-replication-id...
Building pouchdb-json...
Building pouchdb-mapreduce...
Building pouchdb-mapreduce-utils...
Building pouchdb-md5...
Building pouchdb-merge...
Building pouchdb-node...
Building pouchdb-replication...
Building pouchdb-selector-core...
Building pouchdb-utils...
Building sublevel-pouchdb...
  ✓ wrote pouchdb-adapter-localstorage/lib/index.js in vanilla mode
  ✓ wrote pouchdb-adapter-localstorage/lib/index.es.js in vanilla mode
  ✓ wrote pouchdb-adapter-memory/lib/index.js in vanilla mode
  ✓ wrote pouchdb-adapter-memory/lib/index.es.js in vanilla mode
  ✓ wrote pouchdb-checkpointer/lib/index.js in vanilla mode
  ✓ wrote pouchdb-checkpointer/lib/index.es.js in vanilla mode
  ✓ wrote pouchdb-errors/lib/index.js in vanilla mode
  ✓ wrote pouchdb-errors/lib/index.es.js in vanilla mode
  ✓ wrote pouchdb-generate-replication-id/lib/index.js in vanilla mode
  ✓ wrote pouchdb-generate-replication-id/lib/index.es.js in vanilla mode
  ✓ wrote pouchdb-adapter-http/lib/index.js in vanilla mode
  ✓ wrote pouchdb-adapter-http/lib/index.es.js in vanilla mode
  ✓ wrote pouchdb-adapter-leveldb/lib/index.js in node mode
  ✓ wrote pouchdb-adapter-leveldb/lib/index.es.js in node mode
  ✓ wrote pouchdb-adapter-leveldb/lib/index-browser.js in browser mode
  ✓ wrote pouchdb-adapter-leveldb/lib/index-browser.es.js in browser mode
  ✓ wrote pouchdb-adapter-leveldb-core/lib/index.js in node mode
  ✓ wrote pouchdb-adapter-leveldb-core/lib/index.es.js in node mode
  ✓ wrote pouchdb-adapter-leveldb-core/lib/index-browser.js in browser mode
  ✓ wrote pouchdb-adapter-leveldb-core/lib/index-browser.es.js in browser mode
  ✓ wrote pouchdb-changes-filter/lib/index-browser.js in browser mode
  ✓ wrote pouchdb-changes-filter/lib/index-browser.es.js in browser mode
  ✓ wrote pouchdb-fetch/lib/index-browser.js in browser mode
  ✓ wrote pouchdb-fetch/lib/index-browser.es.js in browser mode
  ✓ wrote pouchdb-md5/lib/index-browser.js in browser mode
  ✓ wrote pouchdb-md5/lib/index-browser.es.js in browser mode
  ✓ wrote pouchdb-changes-filter/lib/index.js in node mode
  ✓ wrote pouchdb-changes-filter/lib/index.es.js in node mode
  ✓ wrote pouchdb-collate/lib/index.js in vanilla mode
  ✓ wrote pouchdb-collate/lib/index.es.js in vanilla mode
  ✓ wrote pouchdb-fetch/lib/index.js in node mode
  ✓ wrote pouchdb-fetch/lib/index.es.js in node mode
  ✓ wrote pouchdb-json/lib/index.js in vanilla mode
  ✓ wrote pouchdb-json/lib/index.es.js in vanilla mode
  ✓ wrote pouchdb-mapreduce-utils/lib/index.js in vanilla mode
  ✓ wrote pouchdb-mapreduce-utils/lib/index.es.js in vanilla mode
  ✓ wrote pouchdb-md5/lib/index.js in node mode
  ✓ wrote pouchdb-md5/lib/index.es.js in node mode
  ✓ wrote pouchdb-abstract-mapreduce/lib/index.js in vanilla mode
  ✓ wrote pouchdb-abstract-mapreduce/lib/index.es.js in vanilla mode
  ✓ wrote pouchdb-adapter-idb/lib/index.js in vanilla mode
  ✓ wrote pouchdb-adapter-idb/lib/index.es.js in vanilla mode
  ✓ wrote pouchdb-adapter-indexeddb/lib/index.js in vanilla mode
  ✓ wrote pouchdb-adapter-indexeddb/lib/index.es.js in vanilla mode
  ✓ wrote pouchdb-binary-utils/lib/index-browser.js in browser mode
  ✓ wrote pouchdb-binary-utils/lib/index-browser.es.js in browser mode
  ✓ wrote pouchdb-utils/lib/index-browser.js in browser mode
  ✓ wrote pouchdb-utils/lib/index-browser.es.js in browser mode
  ✓ wrote pouchdb-utils/lib/index.js in node mode
  ✓ wrote pouchdb-utils/lib/index.es.js in node mode
  ✓ wrote pouchdb-binary-utils/lib/index.js in node mode
  ✓ wrote pouchdb-binary-utils/lib/index.es.js in node mode
  ✓ wrote pouchdb-adapter-utils/lib/index.js in vanilla mode
  ✓ wrote pouchdb-adapter-utils/lib/index.es.js in vanilla mode
  ✓ wrote pouchdb-collections/lib/index.js in vanilla mode
  ✓ wrote pouchdb-collections/lib/index.es.js in vanilla mode
  ✓ wrote pouchdb-merge/lib/index.js in vanilla mode
  ✓ wrote pouchdb-merge/lib/index.es.js in vanilla mode
  ✓ wrote pouchdb-selector-core/lib/index.js in vanilla mode
  ✓ wrote pouchdb-selector-core/lib/index.es.js in vanilla mode
  ✓ wrote sublevel-pouchdb/lib/index.js in vanilla mode
  ✓ wrote sublevel-pouchdb/lib/index.es.js in vanilla mode
  ✓ wrote pouchdb-mapreduce/lib/index-browser.js in browser mode
  ✓ wrote pouchdb-mapreduce/lib/index-browser.es.js in browser mode
  ✓ wrote pouchdb-replication/lib/index.js in vanilla mode
  ✓ wrote pouchdb-replication/lib/index.es.js in vanilla mode
  ✓ wrote pouchdb-mapreduce/lib/index.js in node mode
  ✓ wrote pouchdb-mapreduce/lib/index.es.js in node mode
  ✓ wrote pouchdb-core/lib/index.js in vanilla mode
  ✓ wrote pouchdb-core/lib/index.es.js in vanilla mode
  ✓ wrote pouchdb-find/lib/index.js in node mode
  ✓ wrote pouchdb-find/lib/index.es.js in node mode
  ✓ wrote pouchdb-find/lib/index-browser.js in browser mode
  ✓ wrote pouchdb-find/lib/index-browser.es.js in browser mode
  ✓ wrote pouchdb-node/lib/index.js in vanilla mode
  ✓ wrote pouchdb-node/lib/index.es.js in vanilla mode
  ✓ wrote pouchdb-browser/lib/index.js in vanilla mode
  ✓ wrote pouchdb-browser/lib/index.es.js in vanilla mode
  ✓ wrote packages/node_modules/pouchdb/lib/index.js
  ✓ wrote packages/node_modules/pouchdb/lib/index.es.js
  ✓ wrote pouchdb-for-coverage/lib/index-browser.js in browser mode
  ✓ wrote pouchdb-for-coverage/lib/index-browser.es.js in browser mode
  ✓ wrote pouchdb-for-coverage/lib/index.js in node mode
  ✓ wrote pouchdb-for-coverage/lib/index.es.js in node mode
Waiting for host to start ..
Host started :)
> pouchdb-monorepo@7.0.0-prerelease test-node
> bash bin/test-node.sh

Down server listening on port 3010
Seeded with: 1660146513168


  DB Setup
    ✓ PouchDB has a version
    ✓ PouchDB version matches package.json

  test.active_tasks.js
    ✓ Can add a task
    ✓ Can get tasks by id
    ✓ Can get all tasks
    ✓ Can update a task
    ✓ Can remove a task

  test.all_docs.js-http
    ✓ Testing all docs (226ms)
    ✓ Testing allDocs opts.keys (63ms)
    ✓ Testing allDocs opts.keys with skip
    ✓ Testing allDocs opts.keys with limit
    ✓ Testing allDocs invalid opts.keys
    ✓ Testing deleting in changes (55ms)
    ✓ Testing updating in changes (45ms)
    ✓ Testing include docs
    ✓ Testing conflicts (47ms)
    ✓ test basic collation
    ✓ 3883 start_key end_key aliases
    ✓ test total_rows with a variety of criteria (137ms)
    ✓ test total_rows with both skip and limit
    ✓ test limit option and total_rows
    ✓ test escaped startkey/endkey
    ✓ test "key" option
    ✓ test inclusive_end=false (53ms)
    ✓ test descending with startkey/endkey
    ✓ #3082 test wrong num results returned (252ms)
    ✓ test empty db
    ✓ test after db close
    ✓ 5793 _conflicts should not exist if no conflicts
    ✓ #6230 Test allDocs opts update_seq: false
    ✓ #6230 Test allDocs opts update_seq: true
    ✓ #6230 Test allDocs opts with update_seq missing

  test.all_docs.js-local
    ✓ Testing all docs
    ✓ Testing allDocs opts.keys
    ✓ Testing allDocs opts.keys with skip
    ✓ Testing allDocs opts.keys with limit
    ✓ Testing allDocs invalid opts.keys
    ✓ Testing deleting in changes
    ✓ Testing updating in changes
    ✓ Testing include docs
    ✓ Testing conflicts
    ✓ test basic collation
    ✓ 3883 start_key end_key aliases
    ✓ test total_rows with a variety of criteria
    ✓ test total_rows with both skip and limit
    ✓ test limit option and total_rows
    ✓ test escaped startkey/endkey
    ✓ test "key" option
    ✓ test inclusive_end=false
    ✓ test descending with startkey/endkey
    ✓ #3082 test wrong num results returned (183ms)
    ✓ test empty db
    ✓ test after db close
    ✓ test unicode ids and revs
    ✓ 5793 _conflicts should not exist if no conflicts
    ✓ #6230 Test allDocs opts update_seq: false
    ✓ #6230 Test allDocs opts update_seq: true
    ✓ #6230 Test allDocs opts with update_seq missing

  suite2 test.attachments.js-local
    ✓ 3357 Attachment names cant start with _
    ✓ 5736 warning for putAttachment without content_type
    ✓ 5736 warning for bulkDocs attachments without content_type
    ✓ fetch atts with open_revs and missing
    ✓ issue 2803 should throw 412
    ✓ issue 2803 should throw 412 part 2
    ✓ issue 2803 should throw 412 part 3
    ✓ issue 2803 should throw 412 part 4
    ✓ #2858 {binary: true} in get()
    ✓ #2858 {binary: true} in allDocs() 1
    ✓ #2858 {binary: true} in allDocs() 2
    ✓ #2858 {binary: true} in allDocs() 3
    ✓ #2858 {binary: true} in allDocs() 4
    ✓ #2858 {binary: true} in allDocs() 5
    ✓ #2858 {binary: true} in allDocs(), many atts
    ✓ #2858 {binary: true} in allDocs(), mixed atts
    ✓ #2858 {binary: true} in changes() non-live
    ✓ #2858 {binary: true} in changes() non-live, many atts
    ✓ #2858 {binary: true} in changes() non-live, mixed atts
    ✓ #2858 {binary: true} non-live changes, complete event
    ✓ #2858 {binary: true} in live changes
    ✓ #2858 {binary: true} in live changes, mixed atts
    ✓ #2858 {binary: true} in live+retry changes
    ✓ #2858 {binary: true} in live changes, attachments:false
    ✓ #2858 {binary: true} in live changes, include_docs:false
    ✓ #6736 {binary: true} in bulkGet()
    ✓ Measures length correctly after put()
    ✓ #3074 non-live changes()
    ✓ #3074 live changes()
    ✓ #3074 non-live changes(), no attachments
    ✓ #3074 live changes(), no attachments
    ✓ #3881 filter extraneous keys from _attachments
    ✓ #2771 allDocs() 1, single attachment
    ✓ #2771 allDocs() 2, many docs same att
    ✓ #2771 allDocs() 3, many docs diff atts
    ✓ #2771 allDocs() 4, mix of atts and no atts
    ✓ #2771 allDocs() 5, no atts
    ✓ #2771 allDocs() 6, no docs
    ✓ #2771 allDocs() 7, revisions and deletions
    ✓ #2771 allDocs() 8, empty attachment
    ✓ No length for non-stubs
    ✓ Test some attachments
    ✓ Test getAttachment
    ✓ Test getAttachment with stubs
    ✓ Test get() with binary:true and stubs
    ✓ Test attachments in allDocs/changes
    ✓ Test putAttachment with base64 plaintext
    ✓ Test putAttachment with invalid base64
    ✓ Test getAttachment with empty text
    ✓ Test getAttachment with normal text
    ✓ Test getAttachment with PNG
    ✓ Test getAttachment with PNG using bulkDocs
    ✓ Test getAttachment with PNG using post
    ✓ Test postAttachment with PNG then bulkDocs
    ✓ proper stub behavior
    ✓ Testing with invalid docs
    ✓ Test create attachment and doc in one go
    ✓ Test create attachment and doc in one go without callback
    ✓ Test create attachment without callback
    ✓ Test put attachment on a doc without attachments
    ✓ Test put attachment with unencoded name
    ✓ 3963 length property on stubs
    ✓ Testing with invalid rev
    ✓ Test put another attachment on a doc with attachments
    ✓ Test get with attachments: true if empty attachments
    ✓ Test delete attachment from a doc
    ✓ Test a document with a json string attachment
    ✓ Test remove doc with attachment
    ✓ Try to insert a doc with unencoded attachment
    ✓ Try to get attachment of unexistent doc
    ✓ Test synchronous putAttachment with text data
    ✓ Test synchronous putAttachment with no text data
    ✓ Test put with partial stubs
    ✓ Test put with attachments and new_edits=false
    ✓ Test getAttachment with specific rev
    ✓ Test getAttachment with diff revs and content
    ✓ Test stubs
    ✓ Try to get unexistent attachment of some doc
    ✓ putAttachment and getAttachment with plaintext
    ✓ putAttachment and getAttachment with png data
    ✓ putAttachment in new doc with base64
    ✓ #2818 - save same attachment in different revs
    ✓ #2818 - save same attachment many times in parallel
    ✓ #2818 - revisions keep attachments (no compaction)
    ✓ #2818 - doesn't throw 409 if same filename
    ✓ #3008 test correct encoding/decoding of \u0000 etc.
    ✓ putAttachment and getAttachment with big png data (97ms)
    ✓ #2709 `revpos` with putAttachment
    ✓ #2709 `revpos` with inline attachment
    ✓ #2709 `revpos` with allDocs
    ✓ #7403 {attachments: true, binary: true, include_docs: true} in allDocs with one missing doc

  suite2 test.attachments.js-http
    ✓ 3357 Attachment names cant start with _
    ✓ 5736 warning for putAttachment without content_type
    ✓ 5736 warning for bulkDocs attachments without content_type
    ✓ fetch atts with open_revs and missing
    ✓ issue 2803 should throw 412
    ✓ issue 2803 should throw 412 part 2
    ✓ issue 2803 should throw 412 part 3
    ✓ issue 2803 should throw 412 part 4
    ✓ #2858 {binary: true} in get()
    ✓ #2858 {binary: true} in allDocs() 1
    ✓ #2858 {binary: true} in allDocs() 2
    ✓ #2858 {binary: true} in allDocs() 3
    ✓ #2858 {binary: true} in allDocs() 4
    ✓ #2858 {binary: true} in allDocs() 5
    ✓ #2858 {binary: true} in allDocs(), many atts
    ✓ #2858 {binary: true} in allDocs(), mixed atts
    ✓ #2858 {binary: true} in changes() non-live
    ✓ #2858 {binary: true} in changes() non-live, many atts
    ✓ #2858 {binary: true} in changes() non-live, mixed atts
    ✓ #2858 {binary: true} non-live changes, complete event (41ms)
    ✓ #2858 {binary: true} in live changes
    ✓ #2858 {binary: true} in live changes, mixed atts (48ms)
    ✓ #2858 {binary: true} in live+retry changes
    ✓ #2858 {binary: true} in live changes, attachments:false
    ✓ #2858 {binary: true} in live changes, include_docs:false
    ✓ #6736 {binary: true} in bulkGet()
    ✓ Measures length correctly after put()
    ✓ #3074 non-live changes()
    ✓ #3074 live changes() (41ms)
    ✓ #3074 non-live changes(), no attachments
    ✓ #3074 live changes(), no attachments
    ✓ #3881 filter extraneous keys from _attachments
    ✓ #2771 allDocs() 1, single attachment
    ✓ #2771 allDocs() 2, many docs same att
    ✓ #2771 allDocs() 3, many docs diff atts
    ✓ #2771 allDocs() 4, mix of atts and no atts
    ✓ #2771 allDocs() 5, no atts
    ✓ #2771 allDocs() 6, no docs
    ✓ #2771 allDocs() 7, revisions and deletions (54ms)
    ✓ #2771 allDocs() 8, empty attachment
    ✓ No length for non-stubs
    ✓ Test some attachments (43ms)
    ✓ Test getAttachment
    ✓ Test getAttachment with stubs
    ✓ Test get() with binary:true and stubs
    ✓ Test attachments in allDocs/changes
    ✓ Test putAttachment with base64 plaintext
    ✓ Test putAttachment with invalid base64
    ✓ Test getAttachment with empty text
    ✓ Test getAttachment with normal text
    ✓ Test getAttachment with PNG
    ✓ Test getAttachment with PNG using bulkDocs
    ✓ Test getAttachment with PNG using post
    ✓ Test postAttachment with PNG then bulkDocs
    ✓ proper stub behavior
    ✓ Testing with invalid docs
    ✓ Test create attachment and doc in one go
    ✓ Test create attachment and doc in one go without callback
    ✓ Test create attachment without callback (40ms)
    ✓ Test put attachment on a doc without attachments
    ✓ Test put attachment with unencoded name
    ✓ 3963 length property on stubs (46ms)
    ✓ Testing with invalid rev
    ✓ Test put another attachment on a doc with attachments
    ✓ Test get with attachments: true if empty attachments
    ✓ Test delete attachment from a doc
    ✓ Test a document with a json string attachment
    ✓ Test remove doc with attachment
    ✓ Try to insert a doc with unencoded attachment
    ✓ Try to get attachment of unexistent doc
    ✓ Test synchronous putAttachment with text data
    ✓ Test synchronous putAttachment with no text data
    ✓ Test put with partial stubs
    ✓ Test put with attachments and new_edits=false
    ✓ Test getAttachment with specific rev (38ms)
    ✓ Test getAttachment with diff revs and content
    ✓ Test stubs
    ✓ Try to get unexistent attachment of some doc
    ✓ putAttachment and getAttachment with plaintext
    ✓ putAttachment and getAttachment with png data
    ✓ putAttachment in new doc with base64
    ✓ #2818 - save same attachment in different revs (49ms)
    ✓ #2818 - save same attachment many times in parallel
    ✓ #2818 - revisions keep attachments (no compaction)
    ✓ #2818 - doesn't throw 409 if same filename
    ✓ #3008 test correct encoding/decoding of \u0000 etc. (51ms)
    ✓ putAttachment and getAttachment with big png data (161ms)
    ✓ #2709 `revpos` with putAttachment (39ms)
    ✓ #2709 `revpos` with inline attachment
    ✓ #2709 `revpos` with allDocs
    ✓ #7403 {attachments: true, binary: true, include_docs: true} in allDocs with one missing doc

  suite2 test.attachments.js- local:http
    ✓ Attachments replicate back and forth (117ms)
    ✓ Replicate same doc, same atts (116ms)
    ✓ Replicate same doc, same atts 2 (111ms)
    ✓ Attachments replicate (67ms)
    ✓ Attachment types replicate (52ms)
    ✓ Many many attachments replicate (199ms)
    ✓ Many many png attachments replicate (194ms)
    ✓ Multiple attachments replicate (78ms)
    - #3961 Many attachments on same doc
    ✓ Multiple attachments replicate, different docs (#2698) (83ms)
    ✓ Multiple attachments replicate, different docs png (#2698) (69ms)
    ✓ #3932 attachments with tricky revpos (130ms)
    ✓ replication with changing attachments (97ms)
    ✓ 3955 race condition in put
    ✓ #8456 bad attachment rev after replication (123ms)

  suite2 test.attachments.js- http:http
    ✓ Attachments replicate back and forth (226ms)
    ✓ Replicate same doc, same atts (173ms)
    ✓ Replicate same doc, same atts 2 (170ms)
    ✓ Attachments replicate (79ms)
    ✓ Attachment types replicate (115ms)
    ✓ Many many attachments replicate (351ms)
    ✓ Many many png attachments replicate (429ms)
    ✓ Multiple attachments replicate (122ms)
    - #3961 Many attachments on same doc
    ✓ Multiple attachments replicate, different docs (#2698) (127ms)
    ✓ Multiple attachments replicate, different docs png (#2698) (175ms)
    ✓ #3932 attachments with tricky revpos (234ms)
    ✓ replication with changing attachments (148ms)
    ✓ 3955 race condition in put
    ✓ #8456 bad attachment rev after replication (177ms)

  suite2 test.attachments.js- http:local
    ✓ Attachments replicate back and forth (106ms)
    ✓ Replicate same doc, same atts (96ms)
    ✓ Replicate same doc, same atts 2 (97ms)
    ✓ Attachments replicate (68ms)
    ✓ Attachment types replicate (53ms)
    ✓ Many many attachments replicate (171ms)
    ✓ Many many png attachments replicate (142ms)
    ✓ Multiple attachments replicate (93ms)
    - #3961 Many attachments on same doc
    ✓ Multiple attachments replicate, different docs (#2698) (75ms)
    ✓ Multiple attachments replicate, different docs png (#2698) (91ms)
    ✓ #3932 attachments with tricky revpos (154ms)
    ✓ replication with changing attachments (146ms)
    ✓ 3955 race condition in put
    ✓ #8456 bad attachment rev after replication (115ms)

  suite2 test.attachments.js- local:local
    ✓ Attachments replicate back and forth
    ✓ Replicate same doc, same atts
    ✓ Replicate same doc, same atts 2
    ✓ Attachments replicate
    ✓ Attachment types replicate
    ✓ Many many attachments replicate
    ✓ Many many png attachments replicate
    ✓ Multiple attachments replicate
    - #3961 Many attachments on same doc
    ✓ Multiple attachments replicate, different docs (#2698)
    ✓ Multiple attachments replicate, different docs png (#2698)
    ✓ #3932 attachments with tricky revpos
    ✓ replication with changing attachments
    ✓ 3955 race condition in put
    ✓ #8456 bad attachment rev after replication

  test.basics.js-http
    ✓ Create a pouch without new keyword
    ✓ Name is accessible via instance
    ✓ 4314 Create a pouch with + in name
    ✓ Creating Pouch without name will throw
    ✓ 4314 Create a pouch with urlencoded name
    ✓ 4219 destroy a pouch
    ✓ 4339 throw useful error if method called on stale instance
    ✓ [4595] should reject xhr errors
    ✓ [4595] should emit error event on xhr error
    ✓ Add a doc
    ✓ Get invalid id
    ✓ Missing doc should contain ID in error object
    ✓ PUTed Conflicted doc should contain ID in error object
    ✓ POSTed Conflicted doc should contain ID in error object
    ✓ Add a doc with a promise
    ✓ Add a doc with opts object
    ✓ Modify a doc
    ✓ Modifying a doc that has rewritten content
    ✓ Modify a doc with a promise
    ✓ Read db id
    ✓ Read db id with promise
    ✓ Close db
    ✓ Close db with a promise
    ✓ Read db id after closing Close
    ✓ Modify a doc with incorrect rev
    ✓ Remove doc
    ✓ Remove doc with a promise
    ✓ Remove doc with new syntax
    ✓ Remove doc with new syntax and a promise
    ✓ Doc removal leaves only stub
    ✓ Remove doc twice with specified id
    ✓ Remove doc, no callback
    ✓ Delete document without id
    ✓ Delete document with many args
    ✓ Delete document with many args, callback style
    ✓ Delete doc with id + rev + no opts
    ✓ Delete doc with id + rev + no opts, callback style
    ✓ Delete doc with doc + opts
    ✓ Delete doc with doc + opts, callback style
    ✓ Delete doc with rev in opts
    ✓ Bulk docs
    ✓ Bulk docs with a promise
    ✓ Basic checks
    ✓ update with invalid rev
    ✓ Doc validation
    ✓ Replication fields (#2442)
    ✓ Testing issue #48 (55ms)
    ✓ Testing valid id
    ✓ Put doc without _id should fail
    ✓ Put doc with bad reserved id should fail
    ✓ update_seq persists
    ✓ deletions persists
    ✓ #4126 should not store raw Dates
    ✓ Create a db with a reserved name
    ✓ Error when document is not an object
    ✓ Test instance update_seq updates correctly
    ✓ Fail to fetch a doc after db was deleted (50ms)
    ✓ Fail to fetch a doc after db was deleted (58ms)
    ✓ Cant add docs with empty ids
    ✓ Test doc with percent in ID
    ✓ db.info should give auto_compaction = false (#2744)
    ✓ db.info should give auto_compaction = true (#2744)
    ✓ db.info should give adapter name (#3567)
    ✓ db.info should give correct doc_count
    ✓ putting returns {ok: true}
    ✓ putting is override-able
    ✓ issue 2779, deleted docs, old revs COUCHDB-292
    ✓ issue 2888, successive deletes and writes (38ms)
    ✓ 2 invalid puts
    ✓ Docs save "null" value
    ✓ replace PouchDB.destroy() (express-pouchdb#203)
    ✓ 3968, keeps all object fields
    ✓ 4712 invalid rev for new doc generates conflict
    ✓ test info() after db close
    ✓ test get() after db close
    ✓ test close() after db close
    ✓ 7259 should have "this" keyword properly scoped
    ✓ #5471 PouchDB.plugin() should throw error if passed wrong type or empty object

  test.basics.js-local
    ✓ Create a pouch without new keyword
    ✓ Name is accessible via instance
    ✓ 4314 Create a pouch with + in name
    ✓ Creating Pouch without name will throw
    ✓ 4314 Create a pouch with urlencoded name
    ✓ 4219 destroy a pouch
    ✓ 4339 throw useful error if method called on stale instance
    ✓ [4595] should reject xhr errors
    ✓ [4595] should emit error event on xhr error
    ✓ Add a doc
    ✓ Get invalid id
    ✓ Missing doc should contain ID in error object
    ✓ PUTed Conflicted doc should contain ID in error object
    ✓ POSTed Conflicted doc should contain ID in error object
    ✓ Add a doc with a promise
    ✓ Add a doc with opts object
    ✓ Modify a doc
    ✓ Modifying a doc that has rewritten content
    ✓ Modify a doc with a promise
    ✓ Read db id
    ✓ Read db id with promise
    ✓ Close db
    ✓ Close db with a promise
    ✓ Read db id after closing Close
    ✓ Modify a doc with incorrect rev
    ✓ Remove doc
    ✓ Remove doc with a promise
    ✓ Remove doc with new syntax
    ✓ Remove doc with new syntax and a promise
    ✓ Doc removal leaves only stub
    ✓ Remove doc twice with specified id
    ✓ Remove doc, no callback
    ✓ Delete document without id
    ✓ Delete document with many args
    ✓ Delete document with many args, callback style
    ✓ Delete doc with id + rev + no opts
    ✓ Delete doc with id + rev + no opts, callback style
    ✓ Delete doc with doc + opts
    ✓ Delete doc with doc + opts, callback style
    ✓ Delete doc with rev in opts
    ✓ Bulk docs
    ✓ Bulk docs with a promise
    ✓ Basic checks
    ✓ update with invalid rev
    ✓ Doc validation
    ✓ Replication fields (#2442)
    ✓ Allows _access field in documents (#8171)
    ✓ Testing issue #48 (52ms)
    ✓ Testing valid id
    ✓ Put doc without _id should fail
    ✓ Put doc with bad reserved id should fail
    ✓ update_seq persists
    ✓ deletions persists
    ✓ #4126 should not store raw Dates
    ✓ Create a db with a reserved name
    ✓ Error when document is not an object
    ✓ Test instance update_seq updates correctly
    ✓ Fail to fetch a doc after db was deleted
    ✓ Fail to fetch a doc after db was deleted
    ✓ Cant add docs with empty ids
    ✓ Test doc with percent in ID
    ✓ db.info should give auto_compaction = false (#2744)
    ✓ db.info should give auto_compaction = true (#2744)
    ✓ db.info should give adapter name (#3567)
    ✓ db.info should give correct doc_count
    ✓ putting returns {ok: true}
    ✓ putting is override-able
    ✓ issue 2779, deleted docs, old revs COUCHDB-292 (46ms)
    ✓ issue 2888, successive deletes and writes
    ✓ 2 invalid puts
    ✓ Docs save "null" value
    ✓ replace PouchDB.destroy() (express-pouchdb#203)
    ✓ 3968, keeps all object fields
    ✓ 4712 invalid rev for new doc generates conflict
    ✓ test info() after db close
    ✓ test get() after db close
    ✓ test close() after db close
    ✓ 7259 should have "this" keyword properly scoped
    ✓ should allow unicode doc ids
    ✓ should have same blob support for 2 dbs
    ✓ 6053, PouchDB.plugin() resets defaults
    ✓ #5471 PouchDB.plugin() should throw error if passed wrong type or empty object

  test.bulk_docs.js-local
    ✓ Testing bulk docs
    ✓ #6039 test id in bulk docs for conflict
    ✓ No id in bulk docs
    ✓ No _rev and new_edits=false
    ✓ 7829 bare rev 1- with new_edits=false
    ✓ Test empty bulkDocs
    ✓ Test many bulkDocs
    ✓ Test errors on invalid doc id
    ✓ Test two errors on invalid doc id
    ✓ No docs
    ✓ Jira 911
    ✓ Test multiple bulkdocs
    ✓ #2935 new_edits=false correct number
    ✓ #2935 new_edits=false correct number 2
    ✓ bulk docs update then delete then conflict
    ✓ bulk_docs delete then undelete
    ✓ #2935 new_edits=false with single unauthorized
    ✓ Deleting _local docs with bulkDocs
    ✓ Deleting _local docs with bulkDocs, not found
    ✓ Deleting _local docs with bulkDocs, wrong rev
    ✓ Bulk with new_edits=false
    ✓ Testing successive new_edits to the same doc
    ✓ #3062 bulkDocs with staggered seqs
    ✓ Testing successive new_edits to the same doc, different content
    ✓ Testing successive new_edits to two doc
    ✓ Deletion with new_edits=false
    ✓ Deletion with new_edits=false, no history
    ✓ Modification with new_edits=false, no history
    ✓ Deletion with new_edits=false, no history, no revisions
    ✓ Testing new_edits=false in req body
    ✓ 656 regression in handling deleted docs
    ✓ Test quotes in doc ids
    ✓ Bulk docs empty list
    ✓ handles simultaneous writes
    ✓ bulk docs input by array
    ✓ Bulk empty list
    ✓ Bulk docs not an array
    ✓ Bulk docs not an object
    ✓ Bulk docs two different revisions to same document id
    ✓ 4204 respect revs_limit (259ms)
    ✓ 2839 implement revs_limit (180ms)
    ✓ 4372 revs_limit deletes old revisions of the doc
    ✓ 4372 revs_limit with auto_compaction deletes old revisions of the doc
    ✓ 4712 invalid rev for new doc generates conflict
    ✓ 5793 bulk docs accepts _conflicts when new_edits=false

  test.bulk_docs.js-http
    ✓ Testing bulk docs
    ✓ #6039 test id in bulk docs for conflict
    ✓ No id in bulk docs
    ✓ No _rev and new_edits=false
    ✓ 7829 bare rev 1- with new_edits=false
    ✓ Test empty bulkDocs
    ✓ Test many bulkDocs
    ✓ Test errors on invalid doc id
    ✓ Test two errors on invalid doc id
    ✓ No docs
    ✓ Jira 911
    ✓ Test multiple bulkdocs
    ✓ #2935 new_edits=false correct number
    ✓ #2935 new_edits=false correct number 2
    ✓ bulk docs update then delete then conflict
    ✓ bulk_docs delete then undelete
    ✓ #2935 new_edits=false with single unauthorized
    ✓ Deleting _local docs with bulkDocs
    ✓ Bulk with new_edits=false
    ✓ Testing successive new_edits to the same doc
    ✓ #3062 bulkDocs with staggered seqs
    ✓ Testing successive new_edits to the same doc, different content
    ✓ Testing successive new_edits to two doc
    ✓ Deletion with new_edits=false
    ✓ Deletion with new_edits=false, no history
    ✓ Modification with new_edits=false, no history
    ✓ Deletion with new_edits=false, no history, no revisions
    ✓ Testing new_edits=false in req body
    ✓ 656 regression in handling deleted docs (44ms)
    ✓ Test quotes in doc ids
    ✓ Bulk docs empty list
    ✓ handles simultaneous writes
    ✓ bulk docs input by array
    ✓ Bulk empty list
    ✓ Bulk docs not an array
    ✓ Bulk docs not an object
    ✓ Bulk docs two different revisions to same document id
    ✓ 4204 respect revs_limit (266ms)
    ✓ 2839 implement revs_limit
    ✓ 4372 revs_limit deletes old revisions of the doc
    ✓ 4372 revs_limit with auto_compaction deletes old revisions of the doc
    ✓ 4712 invalid rev for new doc generates conflict
    ✓ 5793 bulk docs accepts _conflicts when new_edits=false (39ms)

  test.bulk_get.js-http
    ✓ test bulk get with rev specified
    ✓ test bulk get with latest=true
    ✓ test bulk get with no rev specified
    ✓ _revisions is not returned by default
    ✓ #5886 bulkGet with reserved id
    ✓ _revisions is returned when specified
    ✓ _revisions is returned when specified, using implicit rev
    ✓ attachments are not included by default
    ✓ attachments are included when specified
    ✓ attachments are included when specified, using implicit rev

  test.bulk_get.js-local
    ✓ test bulk get with rev specified
    ✓ test bulk get with latest=true
    ✓ test bulk get with no rev specified
    ✓ _revisions is not returned by default
    ✓ #5886 bulkGet with reserved id
    ✓ _revisions is returned when specified
    ✓ _revisions is returned when specified, using implicit rev
    ✓ attachments are not included by default
    ✓ attachments are included when specified
    ✓ attachments are included when specified, using implicit rev

  test.changes.js-http
    ✓ All changes
    ✓ Changes with complete callback as param
    ✓ Promise resolved when changes cancelled
    - Live changes should clean listener when cancelled
    ✓ Changes Since
    ✓ Changes Since and limit limit 1
    ✓ Changes Since and limit limit 0
    ✓ Changes limit (39ms)
    ✓ Changes with filter not present in ddoc
    ✓ Changes with `filters` key not present in ddoc
    ✓ Changes limit and filter
    ✓ Changes with shorthand function name
    ✓ Changes with filter from nonexistent ddoc
    ✓ Changes with view not present in ddoc
    ✓ Changes with `views` key not present in ddoc
    ✓ #4451 Changes with invalid view filter
    ✓ 3356 throw inside a filter
    ✓ Changes with missing param `view` in request
    ✓ Changes limit and view instead of filter
    ✓ #3609 view option implies filter: _view
    ✓ Immediately cancel changes
    ✓ Changes with invalid ddoc view name
    ✓ Changes with invalid ddoc view name 2
    ✓ Changes with style = all_docs (60ms)
    ✓ Changes with style = all_docs and a callback for complete (63ms)
    ✓ Changes limit = 0 (43ms)
    ✓ Changes doc
    - Descending many changes
    ✓ live-changes
    ✓ Multiple watchers
    ✓ Continuous changes doc
    ✓ Cancel changes (324ms)
    ✓ #3579 changes firing 1 too many times (73ms)
    ✓ Kill database while listening to live changes
    ✓ #3136 style=all_docs
    ✓ #4191 revs_diff causes endless loop
    ✓ #3136 style=all_docs & include_docs (38ms)
    ✓ changes-filter with query params
    ✓ Non-live changes filter
    ✓ Non-live changes filter, descending
    ✓ #2569 Non-live doc_ids filter
    ✓ #2569 Big non-live doc_ids filter
    ✓ #2569 Live doc_ids filter
    ✓ #2569 Big live doc_ids filter
    ✓ #2569 Non-live doc_ids filter with filter=_doc_ids
    ✓ #2569 Live doc_ids filter with filter=_doc_ids
    ✓ Changes to same doc are grouped
    ✓ Changes with conflicts are handled correctly (148ms)
    ✓ Change entry for a deleted doc
    ✓ changes large number of docs
    ✓ Calling db.changes({since: 'now'})
    ✓ Calling db.changes({since: 'latest'})
    ✓ Closing db does not cause a crash if changes cancelled
    ✓ fire-complete-on-cancel (102ms)
    ✓ changes are not duplicated (1023ms)
    ✓ supports return_docs=false
    ✓ should respects limit (70ms)
    ✓ doesn't throw if opts.complete is undefined
    ✓ handle individual changes in live replication (193ms)
    ✓ changes-filter without filter
    ✓ #3539 - Exception in changes is fine
    ✓ Changes with selector
    ✓ Changes with selector, explicit filter
    ✓ Changes with selector and mismatched filter
    ✓ Changes with limit and selector

  test.changes.js-local
    ✓ All changes
    ✓ Changes with complete callback as param
    ✓ Promise resolved when changes cancelled
    - Live changes should clean listener when cancelled
    ✓ Changes Since
    ✓ Changes Since and limit limit 1
    ✓ Changes Since and limit limit 0
    ✓ Changes limit
    ✓ Changes with filter not present in ddoc
    ✓ Changes with `filters` key not present in ddoc
    ✓ Changes limit and filter
    ✓ Changes with shorthand function name
    ✓ Changes with filter from nonexistent ddoc
    ✓ Changes with view not present in ddoc
    ✓ Changes with `views` key not present in ddoc
    ✓ #4451 Changes with invalid view filter
    ✓ 3356 throw inside a filter
    ✓ Changes with missing param `view` in request
    ✓ Changes limit and view instead of filter
    ✓ #3609 view option implies filter: _view
    ✓ Immediately cancel changes
    ✓ Changes with invalid ddoc view name
    ✓ Changes with invalid ddoc view name 2
    ✓ Changes with style = all_docs
    ✓ Changes with style = all_docs and a callback for complete
    ✓ Changes limit = 0
    ✓ Changes doc
    - Descending many changes
    ✓ live-changes
    ✓ Multiple watchers
    ✓ Continuous changes doc
    ✓ Cancel changes (317ms)
    ✓ #3579 changes firing 1 too many times (65ms)
    ✓ Kill database while listening to live changes
    ✓ #3136 style=all_docs
    ✓ #4191 revs_diff causes endless loop
    ✓ #3136 style=all_docs & include_docs
    ✓ changes-filter with query params
    ✓ Non-live changes filter
    ✓ Non-live changes filter, descending
    ✓ #2569 Non-live doc_ids filter
    ✓ #2569 Big non-live doc_ids filter
    ✓ #2569 Live doc_ids filter
    ✓ #2569 Big live doc_ids filter
    ✓ #2569 Non-live doc_ids filter with filter=_doc_ids
    ✓ #2569 Live doc_ids filter with filter=_doc_ids
    ✓ Changes to same doc are grouped
    ✓ Changes with conflicts are handled correctly
    ✓ Change entry for a deleted doc
    ✓ changes large number of docs
    ✓ Calling db.changes({since: 'now'})
    ✓ Calling db.changes({since: 'latest'})
    ✓ Closing db does not cause a crash if changes cancelled
    ✓ fire-complete-on-cancel (100ms)
    ✓ changes are not duplicated (1015ms)
    ✓ supports return_docs=false
    ✓ should respects limit (64ms)
    ✓ doesn't throw if opts.complete is undefined
    ✓ handle individual changes in live replication (96ms)
    ✓ changes-filter without filter
    ✓ #3539 - Exception in changes is fine
    ✓ Changes with selector
    ✓ Changes with selector, explicit filter
    ✓ Changes with selector and mismatched filter
    ✓ Changes with limit and selector

  changes-standalone
    - Changes reports errors

  test.close.js-local
    ✓ should emit destroyed even when closed (sync)
    ✓ should emit destroyed even when closed (async)
    ✓ should emit closed even when destroyed (async #2)
precondition_failed: Database not open
    at Object.<anonymous> (/data/js-variants/multee/Clients/levelup/pouchdb/packages/node_modules/pouchdb/lib/index.js:614:16)
    at Module._compile (node:internal/modules/cjs/loader:1105:14)
    at Module._extensions..js (node:internal/modules/cjs/loader:1159:10)
    at Module.load (node:internal/modules/cjs/loader:981:32)
    at Module._load (node:internal/modules/cjs/loader:827:12)
    at Module.require (node:internal/modules/cjs/loader:1005:19)
    at require (node:internal/modules/cjs/helpers:102:18)
    at commonUtils.loadPouchDBForNode (/data/js-variants/multee/Clients/levelup/pouchdb/tests/common-utils.js:92:17)
    at commonUtils.loadPouchDB (/data/js-variants/multee/Clients/levelup/pouchdb/tests/common-utils.js:78:39)
    at Object.<anonymous> (/data/js-variants/multee/Clients/levelup/pouchdb/tests/integration/node.setup.js:21:28)
    at Module._compile (node:internal/modules/cjs/loader:1105:14)
    at Module._extensions..js (node:internal/modules/cjs/loader:1159:10)
    at Module.load (node:internal/modules/cjs/loader:981:32)
    at Module._load (node:internal/modules/cjs/loader:827:12)
    at Module.require (node:internal/modules/cjs/loader:1005:19)
    at require (node:internal/modules/cjs/helpers:102:18)
    at /data/js-variants/multee/Clients/levelup/pouchdb/node_modules/mocha/bin/_mocha:366:3
    at Array.forEach (<anonymous>)
    at Object.<anonymous> (/data/js-variants/multee/Clients/levelup/pouchdb/node_modules/mocha/bin/_mocha:365:10)
    at Module._compile (node:internal/modules/cjs/loader:1105:14)
    at Module._extensions..js (node:internal/modules/cjs/loader:1159:10)
    at Module.load (node:internal/modules/cjs/loader:981:32)
    at Module._load (node:internal/modules/cjs/loader:827:12)
    at Function.executeUserEntryPoint [as runMain] (node:internal/modules/run_main:77:12)
    at node:internal/main/run_main_module:17:47
    ✓ test unref for coverage
    ✓ test double unref for coverage
precondition_failed: Database not open
    at Object.<anonymous> (/data/js-variants/multee/Clients/levelup/pouchdb/packages/node_modules/pouchdb/lib/index.js:614:16)
    at Module._compile (node:internal/modules/cjs/loader:1105:14)
    at Module._extensions..js (node:internal/modules/cjs/loader:1159:10)
    at Module.load (node:internal/modules/cjs/loader:981:32)
    at Module._load (node:internal/modules/cjs/loader:827:12)
    at Module.require (node:internal/modules/cjs/loader:1005:19)
    at require (node:internal/modules/cjs/helpers:102:18)
    at commonUtils.loadPouchDBForNode (/data/js-variants/multee/Clients/levelup/pouchdb/tests/common-utils.js:92:17)
    at commonUtils.loadPouchDB (/data/js-variants/multee/Clients/levelup/pouchdb/tests/common-utils.js:78:39)
    at Object.<anonymous> (/data/js-variants/multee/Clients/levelup/pouchdb/tests/integration/node.setup.js:21:28)
    at Module._compile (node:internal/modules/cjs/loader:1105:14)
    at Module._extensions..js (node:internal/modules/cjs/loader:1159:10)
    at Module.load (node:internal/modules/cjs/loader:981:32)
    at Module._load (node:internal/modules/cjs/loader:827:12)
    at Module.require (node:internal/modules/cjs/loader:1005:19)
    at require (node:internal/modules/cjs/helpers:102:18)
    at /data/js-variants/multee/Clients/levelup/pouchdb/node_modules/mocha/bin/_mocha:366:3
    at Array.forEach (<anonymous>)
    at Object.<anonymous> (/data/js-variants/multee/Clients/levelup/pouchdb/node_modules/mocha/bin/_mocha:365:10)
    at Module._compile (node:internal/modules/cjs/loader:1105:14)
    at Module._extensions..js (node:internal/modules/cjs/loader:1159:10)
    at Module.load (node:internal/modules/cjs/loader:981:32)
    at Module._load (node:internal/modules/cjs/loader:827:12)
    at Function.executeUserEntryPoint [as runMain] (node:internal/modules/run_main:77:12)
    at node:internal/main/run_main_module:17:47
    ✓ test close-then-destroyed for coverage
************* run test done *************
pouchdb is testing ./VariantsDeps/levelup/variant3/levelup
************* npm unlink module *************

removed 1 package, changed 1 package, and audited 1032 packages in 4s

64 packages are looking for funding
  run `npm fund` for details

41 vulnerabilities (1 low, 9 moderate, 25 high, 6 critical)

To address issues that do not require attention, run:
  npm audit fix

To address all issues possible (including breaking changes), run:
  npm audit fix --force

Some issues need review, and may require choosing
a different dependency.

Run `npm audit` for details.
************* npm unlink module done *************
************* npm unlink globally *************

removed 1 package, and audited 1 package in 1s

found 0 vulnerabilities
************* npm unlink module done *************
************* npm link globally *************

added 1 package, and audited 3 packages in 414ms

found 0 vulnerabilities
************* npm link globally done *************
************* npm link module *************

added 1 package, changed 1 package, and audited 1034 packages in 4s

64 packages are looking for funding
  run `npm fund` for details

41 vulnerabilities (1 low, 9 moderate, 25 high, 6 critical)

To address issues that do not require attention, run:
  npm audit fix

To address all issues possible (including breaking changes), run:
  npm audit fix --force

Some issues need review, and may require choosing
a different dependency.

Run `npm audit` for details.
************* npm link module done *************
************* start run test *************

> pouchdb-monorepo@7.0.0-prerelease test
> bash bin/run-test.sh


> pouchdb-monorepo@7.0.0-prerelease build-node
> bash bin/build-node.sh


> pouchdb-monorepo@7.0.0-prerelease build-modules
> node bin/build-modules.js

Building pouchdb...
Building pouchdb-abstract-mapreduce...
Building pouchdb-adapter-http...
Building pouchdb-adapter-idb...
Building pouchdb-adapter-indexeddb...
Building pouchdb-adapter-leveldb...
Building pouchdb-adapter-leveldb-core...
Building pouchdb-adapter-localstorage...
Building pouchdb-adapter-memory...
Building pouchdb-adapter-utils...
Building pouchdb-binary-utils...
Building pouchdb-browser...
Building pouchdb-changes-filter...
Building pouchdb-checkpointer...
Building pouchdb-collate...
Building pouchdb-collections...
Building pouchdb-core...
Building pouchdb-errors...
Building pouchdb-fetch...
Building pouchdb-find...
Building pouchdb-for-coverage...
Building pouchdb-generate-replication-id...
Building pouchdb-json...
Building pouchdb-mapreduce...
Building pouchdb-mapreduce-utils...
Building pouchdb-md5...
Building pouchdb-merge...
Building pouchdb-node...
Building pouchdb-replication...
Building pouchdb-selector-core...
Building pouchdb-utils...
Building sublevel-pouchdb...
  ✓ wrote pouchdb-adapter-localstorage/lib/index.js in vanilla mode
  ✓ wrote pouchdb-adapter-localstorage/lib/index.es.js in vanilla mode
  ✓ wrote pouchdb-adapter-memory/lib/index.js in vanilla mode
  ✓ wrote pouchdb-adapter-memory/lib/index.es.js in vanilla mode
  ✓ wrote pouchdb-checkpointer/lib/index.js in vanilla mode
  ✓ wrote pouchdb-checkpointer/lib/index.es.js in vanilla mode
  ✓ wrote pouchdb-errors/lib/index.js in vanilla mode
  ✓ wrote pouchdb-errors/lib/index.es.js in vanilla mode
  ✓ wrote pouchdb-generate-replication-id/lib/index.js in vanilla mode
  ✓ wrote pouchdb-generate-replication-id/lib/index.es.js in vanilla mode
  ✓ wrote pouchdb-adapter-http/lib/index.js in vanilla mode
  ✓ wrote pouchdb-adapter-http/lib/index.es.js in vanilla mode
  ✓ wrote pouchdb-adapter-leveldb/lib/index.js in node mode
  ✓ wrote pouchdb-adapter-leveldb/lib/index.es.js in node mode
  ✓ wrote pouchdb-adapter-leveldb/lib/index-browser.js in browser mode
  ✓ wrote pouchdb-adapter-leveldb/lib/index-browser.es.js in browser mode
  ✓ wrote pouchdb-adapter-leveldb-core/lib/index.js in node mode
  ✓ wrote pouchdb-adapter-leveldb-core/lib/index.es.js in node mode
  ✓ wrote pouchdb-adapter-leveldb-core/lib/index-browser.js in browser mode
  ✓ wrote pouchdb-adapter-leveldb-core/lib/index-browser.es.js in browser mode
  ✓ wrote pouchdb-changes-filter/lib/index-browser.js in browser mode
  ✓ wrote pouchdb-changes-filter/lib/index-browser.es.js in browser mode
  ✓ wrote pouchdb-fetch/lib/index-browser.js in browser mode
  ✓ wrote pouchdb-fetch/lib/index-browser.es.js in browser mode
  ✓ wrote pouchdb-md5/lib/index-browser.js in browser mode
  ✓ wrote pouchdb-md5/lib/index-browser.es.js in browser mode
  ✓ wrote pouchdb-changes-filter/lib/index.js in node mode
  ✓ wrote pouchdb-changes-filter/lib/index.es.js in node mode
  ✓ wrote pouchdb-collate/lib/index.js in vanilla mode
  ✓ wrote pouchdb-collate/lib/index.es.js in vanilla mode
  ✓ wrote pouchdb-fetch/lib/index.js in node mode
  ✓ wrote pouchdb-fetch/lib/index.es.js in node mode
  ✓ wrote pouchdb-json/lib/index.js in vanilla mode
  ✓ wrote pouchdb-json/lib/index.es.js in vanilla mode
  ✓ wrote pouchdb-mapreduce-utils/lib/index.js in vanilla mode
  ✓ wrote pouchdb-mapreduce-utils/lib/index.es.js in vanilla mode
  ✓ wrote pouchdb-md5/lib/index.js in node mode
  ✓ wrote pouchdb-md5/lib/index.es.js in node mode
  ✓ wrote pouchdb-abstract-mapreduce/lib/index.js in vanilla mode
  ✓ wrote pouchdb-abstract-mapreduce/lib/index.es.js in vanilla mode
  ✓ wrote pouchdb-adapter-idb/lib/index.js in vanilla mode
  ✓ wrote pouchdb-adapter-idb/lib/index.es.js in vanilla mode
  ✓ wrote pouchdb-adapter-indexeddb/lib/index.js in vanilla mode
  ✓ wrote pouchdb-adapter-indexeddb/lib/index.es.js in vanilla mode
  ✓ wrote pouchdb-binary-utils/lib/index-browser.js in browser mode
  ✓ wrote pouchdb-binary-utils/lib/index-browser.es.js in browser mode
  ✓ wrote pouchdb-utils/lib/index-browser.js in browser mode
  ✓ wrote pouchdb-utils/lib/index-browser.es.js in browser mode
  ✓ wrote pouchdb-utils/lib/index.js in node mode
  ✓ wrote pouchdb-utils/lib/index.es.js in node mode
  ✓ wrote pouchdb-adapter-utils/lib/index.js in vanilla mode
  ✓ wrote pouchdb-adapter-utils/lib/index.es.js in vanilla mode
  ✓ wrote pouchdb-binary-utils/lib/index.js in node mode
  ✓ wrote pouchdb-binary-utils/lib/index.es.js in node mode
  ✓ wrote pouchdb-collections/lib/index.js in vanilla mode
  ✓ wrote pouchdb-collections/lib/index.es.js in vanilla mode
  ✓ wrote pouchdb-merge/lib/index.js in vanilla mode
  ✓ wrote pouchdb-merge/lib/index.es.js in vanilla mode
  ✓ wrote pouchdb-selector-core/lib/index.js in vanilla mode
  ✓ wrote pouchdb-selector-core/lib/index.es.js in vanilla mode
  ✓ wrote sublevel-pouchdb/lib/index.js in vanilla mode
  ✓ wrote sublevel-pouchdb/lib/index.es.js in vanilla mode
  ✓ wrote pouchdb-mapreduce/lib/index-browser.js in browser mode
  ✓ wrote pouchdb-mapreduce/lib/index-browser.es.js in browser mode
  ✓ wrote pouchdb-replication/lib/index.js in vanilla mode
  ✓ wrote pouchdb-replication/lib/index.es.js in vanilla mode
  ✓ wrote pouchdb-mapreduce/lib/index.js in node mode
  ✓ wrote pouchdb-mapreduce/lib/index.es.js in node mode
  ✓ wrote pouchdb-core/lib/index.js in vanilla mode
  ✓ wrote pouchdb-core/lib/index.es.js in vanilla mode
  ✓ wrote pouchdb-find/lib/index.js in node mode
  ✓ wrote pouchdb-find/lib/index.es.js in node mode
  ✓ wrote pouchdb-find/lib/index-browser.js in browser mode
  ✓ wrote pouchdb-find/lib/index-browser.es.js in browser mode
  ✓ wrote pouchdb-for-coverage/lib/index.js in node mode
  ✓ wrote pouchdb-for-coverage/lib/index.es.js in node mode
  ✓ wrote pouchdb-for-coverage/lib/index-browser.js in browser mode
  ✓ wrote pouchdb-for-coverage/lib/index-browser.es.js in browser mode
  ✓ wrote pouchdb-browser/lib/index.js in vanilla mode
  ✓ wrote pouchdb-browser/lib/index.es.js in vanilla mode
  ✓ wrote pouchdb-node/lib/index.js in vanilla mode
  ✓ wrote pouchdb-node/lib/index.es.js in vanilla mode
  ✓ wrote packages/node_modules/pouchdb/lib/index.es.js
  ✓ wrote packages/node_modules/pouchdb/lib/index.js
Waiting for host to start ..
Host started :)
> pouchdb-monorepo@7.0.0-prerelease test-node
> bash bin/test-node.sh

Down server listening on port 3010
Seeded with: 1660146565895


  DB Setup
    ✓ PouchDB has a version
    ✓ PouchDB version matches package.json

  test.active_tasks.js
    ✓ Can add a task
    ✓ Can get tasks by id
    ✓ Can get all tasks
    ✓ Can update a task
    ✓ Can remove a task

  test.all_docs.js-http
    ✓ Testing all docs (222ms)
    ✓ Testing allDocs opts.keys (79ms)
    ✓ Testing allDocs opts.keys with skip
    ✓ Testing allDocs opts.keys with limit
    ✓ Testing allDocs invalid opts.keys
    ✓ Testing deleting in changes (43ms)
    ✓ Testing updating in changes (45ms)
    ✓ Testing include docs
    ✓ Testing conflicts (50ms)
    ✓ test basic collation
    ✓ 3883 start_key end_key aliases
    ✓ test total_rows with a variety of criteria (145ms)
    ✓ test total_rows with both skip and limit
    ✓ test limit option and total_rows
    ✓ test escaped startkey/endkey
    ✓ test "key" option
    ✓ test inclusive_end=false (56ms)
    ✓ test descending with startkey/endkey
    ✓ #3082 test wrong num results returned (250ms)
    ✓ test empty db
    ✓ test after db close
    ✓ 5793 _conflicts should not exist if no conflicts
    ✓ #6230 Test allDocs opts update_seq: false
    ✓ #6230 Test allDocs opts update_seq: true
    ✓ #6230 Test allDocs opts with update_seq missing

  test.all_docs.js-local
    ✓ Testing all docs
    ✓ Testing allDocs opts.keys
    ✓ Testing allDocs opts.keys with skip
    ✓ Testing allDocs opts.keys with limit
    ✓ Testing allDocs invalid opts.keys
    ✓ Testing deleting in changes
    ✓ Testing updating in changes
    ✓ Testing include docs
    ✓ Testing conflicts
    ✓ test basic collation
    ✓ 3883 start_key end_key aliases
    ✓ test total_rows with a variety of criteria
    ✓ test total_rows with both skip and limit
    ✓ test limit option and total_rows
    ✓ test escaped startkey/endkey
    ✓ test "key" option
    ✓ test inclusive_end=false
    ✓ test descending with startkey/endkey
    ✓ #3082 test wrong num results returned (186ms)
    ✓ test empty db
    ✓ test after db close
    ✓ test unicode ids and revs
    ✓ 5793 _conflicts should not exist if no conflicts
    ✓ #6230 Test allDocs opts update_seq: false
    ✓ #6230 Test allDocs opts update_seq: true
    ✓ #6230 Test allDocs opts with update_seq missing

  suite2 test.attachments.js-local
    ✓ 3357 Attachment names cant start with _
    ✓ 5736 warning for putAttachment without content_type
    ✓ 5736 warning for bulkDocs attachments without content_type
    ✓ fetch atts with open_revs and missing
    ✓ issue 2803 should throw 412
    ✓ issue 2803 should throw 412 part 2
    ✓ issue 2803 should throw 412 part 3
    ✓ issue 2803 should throw 412 part 4
    ✓ #2858 {binary: true} in get()
    ✓ #2858 {binary: true} in allDocs() 1
    ✓ #2858 {binary: true} in allDocs() 2
    ✓ #2858 {binary: true} in allDocs() 3
    ✓ #2858 {binary: true} in allDocs() 4
    ✓ #2858 {binary: true} in allDocs() 5
    ✓ #2858 {binary: true} in allDocs(), many atts
    ✓ #2858 {binary: true} in allDocs(), mixed atts
    ✓ #2858 {binary: true} in changes() non-live
    ✓ #2858 {binary: true} in changes() non-live, many atts
    ✓ #2858 {binary: true} in changes() non-live, mixed atts
    ✓ #2858 {binary: true} non-live changes, complete event
    ✓ #2858 {binary: true} in live changes
    ✓ #2858 {binary: true} in live changes, mixed atts
    ✓ #2858 {binary: true} in live+retry changes
    ✓ #2858 {binary: true} in live changes, attachments:false
    ✓ #2858 {binary: true} in live changes, include_docs:false
    ✓ #6736 {binary: true} in bulkGet()
    ✓ Measures length correctly after put()
    ✓ #3074 non-live changes()
    ✓ #3074 live changes()
    ✓ #3074 non-live changes(), no attachments
    ✓ #3074 live changes(), no attachments
    ✓ #3881 filter extraneous keys from _attachments
    ✓ #2771 allDocs() 1, single attachment
    ✓ #2771 allDocs() 2, many docs same att
    ✓ #2771 allDocs() 3, many docs diff atts
    ✓ #2771 allDocs() 4, mix of atts and no atts
    ✓ #2771 allDocs() 5, no atts
    ✓ #2771 allDocs() 6, no docs
    ✓ #2771 allDocs() 7, revisions and deletions
    ✓ #2771 allDocs() 8, empty attachment
    ✓ No length for non-stubs
    ✓ Test some attachments
    ✓ Test getAttachment
    ✓ Test getAttachment with stubs
    ✓ Test get() with binary:true and stubs
    ✓ Test attachments in allDocs/changes
    ✓ Test putAttachment with base64 plaintext
    ✓ Test putAttachment with invalid base64
    ✓ Test getAttachment with empty text
    ✓ Test getAttachment with normal text
    ✓ Test getAttachment with PNG
    ✓ Test getAttachment with PNG using bulkDocs
    ✓ Test getAttachment with PNG using post
    ✓ Test postAttachment with PNG then bulkDocs
    ✓ proper stub behavior
    ✓ Testing with invalid docs
    ✓ Test create attachment and doc in one go
    ✓ Test create attachment and doc in one go without callback
    ✓ Test create attachment without callback
    ✓ Test put attachment on a doc without attachments
    ✓ Test put attachment with unencoded name
    ✓ 3963 length property on stubs
    ✓ Testing with invalid rev
    ✓ Test put another attachment on a doc with attachments
    ✓ Test get with attachments: true if empty attachments
    ✓ Test delete attachment from a doc
    ✓ Test a document with a json string attachment
    ✓ Test remove doc with attachment
    ✓ Try to insert a doc with unencoded attachment
    ✓ Try to get attachment of unexistent doc
    ✓ Test synchronous putAttachment with text data
    ✓ Test synchronous putAttachment with no text data
    ✓ Test put with partial stubs
    ✓ Test put with attachments and new_edits=false
    ✓ Test getAttachment with specific rev
    ✓ Test getAttachment with diff revs and content
    ✓ Test stubs
    ✓ Try to get unexistent attachment of some doc
    ✓ putAttachment and getAttachment with plaintext
    ✓ putAttachment and getAttachment with png data
    ✓ putAttachment in new doc with base64
    ✓ #2818 - save same attachment in different revs
    ✓ #2818 - save same attachment many times in parallel
    ✓ #2818 - revisions keep attachments (no compaction)
    ✓ #2818 - doesn't throw 409 if same filename
    ✓ #3008 test correct encoding/decoding of \u0000 etc.
    ✓ putAttachment and getAttachment with big png data (92ms)
    ✓ #2709 `revpos` with putAttachment
    ✓ #2709 `revpos` with inline attachment
    ✓ #2709 `revpos` with allDocs
    ✓ #7403 {attachments: true, binary: true, include_docs: true} in allDocs with one missing doc

  suite2 test.attachments.js-http
    ✓ 3357 Attachment names cant start with _
    ✓ 5736 warning for putAttachment without content_type
    ✓ 5736 warning for bulkDocs attachments without content_type
    ✓ fetch atts with open_revs and missing
    ✓ issue 2803 should throw 412
    ✓ issue 2803 should throw 412 part 2
    ✓ issue 2803 should throw 412 part 3
    ✓ issue 2803 should throw 412 part 4
    ✓ #2858 {binary: true} in get()
    ✓ #2858 {binary: true} in allDocs() 1
    ✓ #2858 {binary: true} in allDocs() 2
    ✓ #2858 {binary: true} in allDocs() 3
    ✓ #2858 {binary: true} in allDocs() 4
    ✓ #2858 {binary: true} in allDocs() 5
    ✓ #2858 {binary: true} in allDocs(), many atts
    ✓ #2858 {binary: true} in allDocs(), mixed atts
    ✓ #2858 {binary: true} in changes() non-live
    ✓ #2858 {binary: true} in changes() non-live, many atts
    ✓ #2858 {binary: true} in changes() non-live, mixed atts
    ✓ #2858 {binary: true} non-live changes, complete event
    ✓ #2858 {binary: true} in live changes
    ✓ #2858 {binary: true} in live changes, mixed atts (48ms)
    ✓ #2858 {binary: true} in live+retry changes (38ms)
    ✓ #2858 {binary: true} in live changes, attachments:false
    ✓ #2858 {binary: true} in live changes, include_docs:false
    ✓ #6736 {binary: true} in bulkGet()
    ✓ Measures length correctly after put()
    ✓ #3074 non-live changes() (39ms)
    ✓ #3074 live changes()
    ✓ #3074 non-live changes(), no attachments
    ✓ #3074 live changes(), no attachments
    ✓ #3881 filter extraneous keys from _attachments
    ✓ #2771 allDocs() 1, single attachment
    ✓ #2771 allDocs() 2, many docs same att
    ✓ #2771 allDocs() 3, many docs diff atts
    ✓ #2771 allDocs() 4, mix of atts and no atts
    ✓ #2771 allDocs() 5, no atts
    ✓ #2771 allDocs() 6, no docs
    ✓ #2771 allDocs() 7, revisions and deletions
    ✓ #2771 allDocs() 8, empty attachment
    ✓ No length for non-stubs
    ✓ Test some attachments (43ms)
    ✓ Test getAttachment
    ✓ Test getAttachment with stubs (49ms)
    ✓ Test get() with binary:true and stubs
    ✓ Test attachments in allDocs/changes
    ✓ Test putAttachment with base64 plaintext
    ✓ Test putAttachment with invalid base64
    ✓ Test getAttachment with empty text
    ✓ Test getAttachment with normal text
    ✓ Test getAttachment with PNG
    ✓ Test getAttachment with PNG using bulkDocs
    ✓ Test getAttachment with PNG using post
    ✓ Test postAttachment with PNG then bulkDocs
    ✓ proper stub behavior
    ✓ Testing with invalid docs
    ✓ Test create attachment and doc in one go
    ✓ Test create attachment and doc in one go without callback
    ✓ Test create attachment without callback (38ms)
    ✓ Test put attachment on a doc without attachments
    ✓ Test put attachment with unencoded name
    ✓ 3963 length property on stubs (48ms)
    ✓ Testing with invalid rev
    ✓ Test put another attachment on a doc with attachments
    ✓ Test get with attachments: true if empty attachments
    ✓ Test delete attachment from a doc (43ms)
    ✓ Test a document with a json string attachment
    ✓ Test remove doc with attachment
    ✓ Try to insert a doc with unencoded attachment
    ✓ Try to get attachment of unexistent doc
    ✓ Test synchronous putAttachment with text data
    ✓ Test synchronous putAttachment with no text data
    ✓ Test put with partial stubs
    ✓ Test put with attachments and new_edits=false
    ✓ Test getAttachment with specific rev (40ms)
    ✓ Test getAttachment with diff revs and content
    ✓ Test stubs
    ✓ Try to get unexistent attachment of some doc
    ✓ putAttachment and getAttachment with plaintext
    ✓ putAttachment and getAttachment with png data
    ✓ putAttachment in new doc with base64
    ✓ #2818 - save same attachment in different revs (51ms)
    ✓ #2818 - save same attachment many times in parallel
    ✓ #2818 - revisions keep attachments (no compaction) (53ms)
    ✓ #2818 - doesn't throw 409 if same filename (54ms)
    ✓ #3008 test correct encoding/decoding of \u0000 etc.
    ✓ putAttachment and getAttachment with big png data (141ms)
    ✓ #2709 `revpos` with putAttachment (44ms)
    ✓ #2709 `revpos` with inline attachment (38ms)
    ✓ #2709 `revpos` with allDocs
    ✓ #7403 {attachments: true, binary: true, include_docs: true} in allDocs with one missing doc

  suite2 test.attachments.js- local:http
    ✓ Attachments replicate back and forth (117ms)
    ✓ Replicate same doc, same atts (115ms)
    ✓ Replicate same doc, same atts 2 (115ms)
    ✓ Attachments replicate (65ms)
    ✓ Attachment types replicate (56ms)
    ✓ Many many attachments replicate (204ms)
    ✓ Many many png attachments replicate (212ms)
    ✓ Multiple attachments replicate (86ms)
    - #3961 Many attachments on same doc
    ✓ Multiple attachments replicate, different docs (#2698) (90ms)
    ✓ Multiple attachments replicate, different docs png (#2698) (74ms)
    ✓ #3932 attachments with tricky revpos (147ms)
    ✓ replication with changing attachments (98ms)
    ✓ 3955 race condition in put
    ✓ #8456 bad attachment rev after replication (156ms)

  suite2 test.attachments.js- http:http
    ✓ Attachments replicate back and forth (158ms)
    ✓ Replicate same doc, same atts (174ms)
    ✓ Replicate same doc, same atts 2 (175ms)
    ✓ Attachments replicate (78ms)
    ✓ Attachment types replicate (125ms)
    ✓ Many many attachments replicate (366ms)
    ✓ Many many png attachments replicate (306ms)
    ✓ Multiple attachments replicate (126ms)
    - #3961 Many attachments on same doc
    ✓ Multiple attachments replicate, different docs (#2698) (128ms)
    ✓ Multiple attachments replicate, different docs png (#2698) (196ms)
    ✓ #3932 attachments with tricky revpos (228ms)
    ✓ replication with changing attachments (153ms)
    ✓ 3955 race condition in put
    ✓ #8456 bad attachment rev after replication (173ms)

  suite2 test.attachments.js- http:local
    ✓ Attachments replicate back and forth (102ms)
    ✓ Replicate same doc, same atts (99ms)
    ✓ Replicate same doc, same atts 2 (104ms)
    ✓ Attachments replicate (52ms)
    ✓ Attachment types replicate (56ms)
    ✓ Many many attachments replicate (144ms)
    ✓ Many many png attachments replicate (190ms)
    ✓ Multiple attachments replicate (81ms)
    - #3961 Many attachments on same doc
    ✓ Multiple attachments replicate, different docs (#2698) (72ms)
    ✓ Multiple attachments replicate, different docs png (#2698) (92ms)
    ✓ #3932 attachments with tricky revpos (248ms)
    ✓ replication with changing attachments (99ms)
    ✓ 3955 race condition in put
    ✓ #8456 bad attachment rev after replication (106ms)

  suite2 test.attachments.js- local:local
    ✓ Attachments replicate back and forth
    ✓ Replicate same doc, same atts
    ✓ Replicate same doc, same atts 2
    ✓ Attachments replicate
    ✓ Attachment types replicate
    ✓ Many many attachments replicate
    ✓ Many many png attachments replicate
    ✓ Multiple attachments replicate
    - #3961 Many attachments on same doc
    ✓ Multiple attachments replicate, different docs (#2698)
    ✓ Multiple attachments replicate, different docs png (#2698)
    ✓ #3932 attachments with tricky revpos
    ✓ replication with changing attachments
    ✓ 3955 race condition in put
    ✓ #8456 bad attachment rev after replication

  test.basics.js-http
    ✓ Create a pouch without new keyword
    ✓ Name is accessible via instance
    ✓ 4314 Create a pouch with + in name
    ✓ Creating Pouch without name will throw
    ✓ 4314 Create a pouch with urlencoded name
    ✓ 4219 destroy a pouch
    ✓ 4339 throw useful error if method called on stale instance
    ✓ [4595] should reject xhr errors
    ✓ [4595] should emit error event on xhr error
    ✓ Add a doc
    ✓ Get invalid id
    ✓ Missing doc should contain ID in error object
    ✓ PUTed Conflicted doc should contain ID in error object
    ✓ POSTed Conflicted doc should contain ID in error object
    ✓ Add a doc with a promise
    ✓ Add a doc with opts object
    ✓ Modify a doc
    ✓ Modifying a doc that has rewritten content
    ✓ Modify a doc with a promise
    ✓ Read db id
    ✓ Read db id with promise
    ✓ Close db
    ✓ Close db with a promise
    ✓ Read db id after closing Close
    ✓ Modify a doc with incorrect rev
    ✓ Remove doc
    ✓ Remove doc with a promise
    ✓ Remove doc with new syntax
    ✓ Remove doc with new syntax and a promise
    ✓ Doc removal leaves only stub
    ✓ Remove doc twice with specified id
    ✓ Remove doc, no callback
    ✓ Delete document without id
    ✓ Delete document with many args
    ✓ Delete document with many args, callback style
    ✓ Delete doc with id + rev + no opts
    ✓ Delete doc with id + rev + no opts, callback style (54ms)
    ✓ Delete doc with doc + opts
    ✓ Delete doc with doc + opts, callback style
    ✓ Delete doc with rev in opts
    ✓ Bulk docs
    ✓ Bulk docs with a promise
    ✓ Basic checks
    ✓ update with invalid rev
    ✓ Doc validation
    ✓ Replication fields (#2442)
    ✓ Testing issue #48 (54ms)
    ✓ Testing valid id
    ✓ Put doc without _id should fail
    ✓ Put doc with bad reserved id should fail
    ✓ update_seq persists
    ✓ deletions persists
    ✓ #4126 should not store raw Dates
    ✓ Create a db with a reserved name
    ✓ Error when document is not an object
    ✓ Test instance update_seq updates correctly
    ✓ Fail to fetch a doc after db was deleted (51ms)
    ✓ Fail to fetch a doc after db was deleted (46ms)
    ✓ Cant add docs with empty ids
    ✓ Test doc with percent in ID
    ✓ db.info should give auto_compaction = false (#2744)
    ✓ db.info should give auto_compaction = true (#2744)
    ✓ db.info should give adapter name (#3567)
    ✓ db.info should give correct doc_count
    ✓ putting returns {ok: true}
    ✓ putting is override-able
    ✓ issue 2779, deleted docs, old revs COUCHDB-292
    ✓ issue 2888, successive deletes and writes
    ✓ 2 invalid puts
    ✓ Docs save "null" value
    ✓ replace PouchDB.destroy() (express-pouchdb#203)
    ✓ 3968, keeps all object fields
    ✓ 4712 invalid rev for new doc generates conflict
    ✓ test info() after db close
    ✓ test get() after db close
    ✓ test close() after db close
    ✓ 7259 should have "this" keyword properly scoped
    ✓ #5471 PouchDB.plugin() should throw error if passed wrong type or empty object

  test.basics.js-local
    ✓ Create a pouch without new keyword
    ✓ Name is accessible via instance
    ✓ 4314 Create a pouch with + in name
    ✓ Creating Pouch without name will throw
    ✓ 4314 Create a pouch with urlencoded name
    ✓ 4219 destroy a pouch
    ✓ 4339 throw useful error if method called on stale instance
    ✓ [4595] should reject xhr errors
    ✓ [4595] should emit error event on xhr error
    ✓ Add a doc
    ✓ Get invalid id
    ✓ Missing doc should contain ID in error object
    ✓ PUTed Conflicted doc should contain ID in error object
    ✓ POSTed Conflicted doc should contain ID in error object
    ✓ Add a doc with a promise
    ✓ Add a doc with opts object
    ✓ Modify a doc
    ✓ Modifying a doc that has rewritten content
    ✓ Modify a doc with a promise
    ✓ Read db id
    ✓ Read db id with promise
    ✓ Close db
    ✓ Close db with a promise
    ✓ Read db id after closing Close
    ✓ Modify a doc with incorrect rev
    ✓ Remove doc
    ✓ Remove doc with a promise
    ✓ Remove doc with new syntax
    ✓ Remove doc with new syntax and a promise
    ✓ Doc removal leaves only stub
    ✓ Remove doc twice with specified id
    ✓ Remove doc, no callback
    ✓ Delete document without id
    ✓ Delete document with many args
    ✓ Delete document with many args, callback style
    ✓ Delete doc with id + rev + no opts
    ✓ Delete doc with id + rev + no opts, callback style
    ✓ Delete doc with doc + opts
    ✓ Delete doc with doc + opts, callback style
    ✓ Delete doc with rev in opts
    ✓ Bulk docs
    ✓ Bulk docs with a promise
    ✓ Basic checks
    ✓ update with invalid rev
    ✓ Doc validation
    ✓ Replication fields (#2442)
    ✓ Allows _access field in documents (#8171)
    ✓ Testing issue #48 (53ms)
    ✓ Testing valid id
    ✓ Put doc without _id should fail
    ✓ Put doc with bad reserved id should fail
    ✓ update_seq persists
    ✓ deletions persists
    ✓ #4126 should not store raw Dates
    ✓ Create a db with a reserved name
    ✓ Error when document is not an object
    ✓ Test instance update_seq updates correctly
    ✓ Fail to fetch a doc after db was deleted
    ✓ Fail to fetch a doc after db was deleted
    ✓ Cant add docs with empty ids
    ✓ Test doc with percent in ID
    ✓ db.info should give auto_compaction = false (#2744)
    ✓ db.info should give auto_compaction = true (#2744)
    ✓ db.info should give adapter name (#3567)
    ✓ db.info should give correct doc_count
    ✓ putting returns {ok: true}
    ✓ putting is override-able
    ✓ issue 2779, deleted docs, old revs COUCHDB-292
    ✓ issue 2888, successive deletes and writes
    ✓ 2 invalid puts
    ✓ Docs save "null" value
    ✓ replace PouchDB.destroy() (express-pouchdb#203)
    ✓ 3968, keeps all object fields
    ✓ 4712 invalid rev for new doc generates conflict
    ✓ test info() after db close
    ✓ test get() after db close
    ✓ test close() after db close
    ✓ 7259 should have "this" keyword properly scoped
    ✓ should allow unicode doc ids
    ✓ should have same blob support for 2 dbs
    ✓ 6053, PouchDB.plugin() resets defaults
    ✓ #5471 PouchDB.plugin() should throw error if passed wrong type or empty object

  test.bulk_docs.js-local
    ✓ Testing bulk docs
    ✓ #6039 test id in bulk docs for conflict
    ✓ No id in bulk docs
    ✓ No _rev and new_edits=false
    ✓ 7829 bare rev 1- with new_edits=false
    ✓ Test empty bulkDocs
    ✓ Test many bulkDocs
    ✓ Test errors on invalid doc id
    ✓ Test two errors on invalid doc id
    ✓ No docs
    ✓ Jira 911
    ✓ Test multiple bulkdocs
    ✓ #2935 new_edits=false correct number
    ✓ #2935 new_edits=false correct number 2
    ✓ bulk docs update then delete then conflict
    ✓ bulk_docs delete then undelete
    ✓ #2935 new_edits=false with single unauthorized
    ✓ Deleting _local docs with bulkDocs
    ✓ Deleting _local docs with bulkDocs, not found
    ✓ Deleting _local docs with bulkDocs, wrong rev
    ✓ Bulk with new_edits=false
    ✓ Testing successive new_edits to the same doc
    ✓ #3062 bulkDocs with staggered seqs
    ✓ Testing successive new_edits to the same doc, different content
    ✓ Testing successive new_edits to two doc
    ✓ Deletion with new_edits=false
    ✓ Deletion with new_edits=false, no history
    ✓ Modification with new_edits=false, no history
    ✓ Deletion with new_edits=false, no history, no revisions
    ✓ Testing new_edits=false in req body
    ✓ 656 regression in handling deleted docs
    ✓ Test quotes in doc ids
    ✓ Bulk docs empty list
    ✓ handles simultaneous writes
    ✓ bulk docs input by array
    ✓ Bulk empty list
    ✓ Bulk docs not an array
    ✓ Bulk docs not an object
    ✓ Bulk docs two different revisions to same document id
    ✓ 4204 respect revs_limit (260ms)
    ✓ 2839 implement revs_limit (188ms)
    ✓ 4372 revs_limit deletes old revisions of the doc
    ✓ 4372 revs_limit with auto_compaction deletes old revisions of the doc
    ✓ 4712 invalid rev for new doc generates conflict
    ✓ 5793 bulk docs accepts _conflicts when new_edits=false

  test.bulk_docs.js-http
    ✓ Testing bulk docs
    ✓ #6039 test id in bulk docs for conflict
    ✓ No id in bulk docs
    ✓ No _rev and new_edits=false
    ✓ 7829 bare rev 1- with new_edits=false
    ✓ Test empty bulkDocs
    ✓ Test many bulkDocs (46ms)
    ✓ Test errors on invalid doc id
    ✓ Test two errors on invalid doc id
    ✓ No docs
    ✓ Jira 911
    ✓ Test multiple bulkdocs
    ✓ #2935 new_edits=false correct number
    ✓ #2935 new_edits=false correct number 2
    ✓ bulk docs update then delete then conflict
    ✓ bulk_docs delete then undelete
    ✓ #2935 new_edits=false with single unauthorized
    ✓ Deleting _local docs with bulkDocs
    ✓ Bulk with new_edits=false
    ✓ Testing successive new_edits to the same doc
    ✓ #3062 bulkDocs with staggered seqs
    ✓ Testing successive new_edits to the same doc, different content
    ✓ Testing successive new_edits to two doc
    ✓ Deletion with new_edits=false
    ✓ Deletion with new_edits=false, no history
    ✓ Modification with new_edits=false, no history
    ✓ Deletion with new_edits=false, no history, no revisions
    ✓ Testing new_edits=false in req body
    ✓ 656 regression in handling deleted docs
    ✓ Test quotes in doc ids
    ✓ Bulk docs empty list
    ✓ handles simultaneous writes
    ✓ bulk docs input by array
    ✓ Bulk empty list
    ✓ Bulk docs not an array
    ✓ Bulk docs not an object
    ✓ Bulk docs two different revisions to same document id
    ✓ 4204 respect revs_limit (289ms)
    ✓ 2839 implement revs_limit
    ✓ 4372 revs_limit deletes old revisions of the doc
    ✓ 4372 revs_limit with auto_compaction deletes old revisions of the doc
    ✓ 4712 invalid rev for new doc generates conflict
    ✓ 5793 bulk docs accepts _conflicts when new_edits=false (43ms)

  test.bulk_get.js-http
    ✓ test bulk get with rev specified
    ✓ test bulk get with latest=true
    ✓ test bulk get with no rev specified
    ✓ _revisions is not returned by default
    ✓ #5886 bulkGet with reserved id
    ✓ _revisions is returned when specified
    ✓ _revisions is returned when specified, using implicit rev
    ✓ attachments are not included by default
    ✓ attachments are included when specified
    ✓ attachments are included when specified, using implicit rev

  test.bulk_get.js-local
    ✓ test bulk get with rev specified
    ✓ test bulk get with latest=true
    ✓ test bulk get with no rev specified
    ✓ _revisions is not returned by default
    ✓ #5886 bulkGet with reserved id
    ✓ _revisions is returned when specified
    ✓ _revisions is returned when specified, using implicit rev
    ✓ attachments are not included by default
    ✓ attachments are included when specified
    ✓ attachments are included when specified, using implicit rev

  test.changes.js-http
    ✓ All changes
    ✓ Changes with complete callback as param
    ✓ Promise resolved when changes cancelled
    - Live changes should clean listener when cancelled
    ✓ Changes Since
    ✓ Changes Since and limit limit 1
    ✓ Changes Since and limit limit 0
    ✓ Changes limit (39ms)
    ✓ Changes with filter not present in ddoc
    ✓ Changes with `filters` key not present in ddoc
    ✓ Changes limit and filter
    ✓ Changes with shorthand function name
    ✓ Changes with filter from nonexistent ddoc
    ✓ Changes with view not present in ddoc
    ✓ Changes with `views` key not present in ddoc
    ✓ #4451 Changes with invalid view filter
    ✓ 3356 throw inside a filter
    ✓ Changes with missing param `view` in request
    ✓ Changes limit and view instead of filter
    ✓ #3609 view option implies filter: _view
    ✓ Immediately cancel changes
    ✓ Changes with invalid ddoc view name
    ✓ Changes with invalid ddoc view name 2
    ✓ Changes with style = all_docs (62ms)
    ✓ Changes with style = all_docs and a callback for complete (55ms)
    ✓ Changes limit = 0
    ✓ Changes doc
    - Descending many changes
    ✓ live-changes
    ✓ Multiple watchers
    ✓ Continuous changes doc
    ✓ Cancel changes (329ms)
    ✓ #3579 changes firing 1 too many times (74ms)
    ✓ Kill database while listening to live changes
    ✓ #3136 style=all_docs
    ✓ #4191 revs_diff causes endless loop
    ✓ #3136 style=all_docs & include_docs
    ✓ changes-filter with query params
    ✓ Non-live changes filter
    ✓ Non-live changes filter, descending
    ✓ #2569 Non-live doc_ids filter
    ✓ #2569 Big non-live doc_ids filter
    ✓ #2569 Live doc_ids filter
    ✓ #2569 Big live doc_ids filter
    ✓ #2569 Non-live doc_ids filter with filter=_doc_ids
    ✓ #2569 Live doc_ids filter with filter=_doc_ids
    ✓ Changes to same doc are grouped
    ✓ Changes with conflicts are handled correctly (129ms)
    ✓ Change entry for a deleted doc
    ✓ changes large number of docs (47ms)
    ✓ Calling db.changes({since: 'now'})
    ✓ Calling db.changes({since: 'latest'}) (44ms)
    ✓ Closing db does not cause a crash if changes cancelled
    ✓ fire-complete-on-cancel (101ms)
    ✓ changes are not duplicated (1025ms)
    ✓ supports return_docs=false
    ✓ should respects limit (71ms)
    ✓ doesn't throw if opts.complete is undefined
    ✓ handle individual changes in live replication (200ms)
    ✓ changes-filter without filter
    ✓ #3539 - Exception in changes is fine
    ✓ Changes with selector
    ✓ Changes with selector, explicit filter
    ✓ Changes with selector and mismatched filter
    ✓ Changes with limit and selector

  test.changes.js-local
    ✓ All changes
    ✓ Changes with complete callback as param
    ✓ Promise resolved when changes cancelled
    - Live changes should clean listener when cancelled
    ✓ Changes Since
    ✓ Changes Since and limit limit 1
    ✓ Changes Since and limit limit 0
    ✓ Changes limit
    ✓ Changes with filter not present in ddoc
    ✓ Changes with `filters` key not present in ddoc
    ✓ Changes limit and filter
    ✓ Changes with shorthand function name
    ✓ Changes with filter from nonexistent ddoc
    ✓ Changes with view not present in ddoc
    ✓ Changes with `views` key not present in ddoc
    ✓ #4451 Changes with invalid view filter
    ✓ 3356 throw inside a filter
    ✓ Changes with missing param `view` in request
    ✓ Changes limit and view instead of filter
    ✓ #3609 view option implies filter: _view
    ✓ Immediately cancel changes
    ✓ Changes with invalid ddoc view name
    ✓ Changes with invalid ddoc view name 2
    ✓ Changes with style = all_docs
    ✓ Changes with style = all_docs and a callback for complete
    ✓ Changes limit = 0
    ✓ Changes doc
    - Descending many changes
    ✓ live-changes
    ✓ Multiple watchers
    ✓ Continuous changes doc
    ✓ Cancel changes (317ms)
    ✓ #3579 changes firing 1 too many times (66ms)
    ✓ Kill database while listening to live changes
    ✓ #3136 style=all_docs
    ✓ #4191 revs_diff causes endless loop
    ✓ #3136 style=all_docs & include_docs
    ✓ changes-filter with query params
    ✓ Non-live changes filter
    ✓ Non-live changes filter, descending
    ✓ #2569 Non-live doc_ids filter
    ✓ #2569 Big non-live doc_ids filter
    ✓ #2569 Live doc_ids filter
    ✓ #2569 Big live doc_ids filter
    ✓ #2569 Non-live doc_ids filter with filter=_doc_ids
    ✓ #2569 Live doc_ids filter with filter=_doc_ids
    ✓ Changes to same doc are grouped
    ✓ Changes with conflicts are handled correctly
    ✓ Change entry for a deleted doc
    ✓ changes large number of docs
    ✓ Calling db.changes({since: 'now'})
    ✓ Calling db.changes({since: 'latest'})
    ✓ Closing db does not cause a crash if changes cancelled
    ✓ fire-complete-on-cancel (100ms)
    ✓ changes are not duplicated (1029ms)
    ✓ supports return_docs=false
    ✓ should respects limit (68ms)
    ✓ doesn't throw if opts.complete is undefined
    ✓ handle individual changes in live replication (73ms)
    ✓ changes-filter without filter
    ✓ #3539 - Exception in changes is fine
    ✓ Changes with selector
    ✓ Changes with selector, explicit filter
    ✓ Changes with selector and mismatched filter
    ✓ Changes with limit and selector

  changes-standalone
    - Changes reports errors

  test.close.js-local
    ✓ should emit destroyed even when closed (sync)
    ✓ should emit destroyed even when closed (async)
precondition_failed: Database not open
    at Object.<anonymous> (/data/js-variants/multee/Clients/levelup/pouchdb/packages/node_modules/pouchdb/lib/index.js:614:16)
    at Module._compile (node:internal/modules/cjs/loader:1105:14)
    at Module._extensions..js (node:internal/modules/cjs/loader:1159:10)
    at Module.load (node:internal/modules/cjs/loader:981:32)
    at Module._load (node:internal/modules/cjs/loader:827:12)
    at Module.require (node:internal/modules/cjs/loader:1005:19)
    at require (node:internal/modules/cjs/helpers:102:18)
    at commonUtils.loadPouchDBForNode (/data/js-variants/multee/Clients/levelup/pouchdb/tests/common-utils.js:92:17)
    at commonUtils.loadPouchDB (/data/js-variants/multee/Clients/levelup/pouchdb/tests/common-utils.js:78:39)
    at Object.<anonymous> (/data/js-variants/multee/Clients/levelup/pouchdb/tests/integration/node.setup.js:21:28)
    at Module._compile (node:internal/modules/cjs/loader:1105:14)
    at Module._extensions..js (node:internal/modules/cjs/loader:1159:10)
    at Module.load (node:internal/modules/cjs/loader:981:32)
    at Module._load (node:internal/modules/cjs/loader:827:12)
    at Module.require (node:internal/modules/cjs/loader:1005:19)
    at require (node:internal/modules/cjs/helpers:102:18)
    at /data/js-variants/multee/Clients/levelup/pouchdb/node_modules/mocha/bin/_mocha:366:3
    at Array.forEach (<anonymous>)
    at Object.<anonymous> (/data/js-variants/multee/Clients/levelup/pouchdb/node_modules/mocha/bin/_mocha:365:10)
    at Module._compile (node:internal/modules/cjs/loader:1105:14)
    at Module._extensions..js (node:internal/modules/cjs/loader:1159:10)
    at Module.load (node:internal/modules/cjs/loader:981:32)
    at Module._load (node:internal/modules/cjs/loader:827:12)
    at Function.executeUserEntryPoint [as runMain] (node:internal/modules/run_main:77:12)
    at node:internal/main/run_main_module:17:47
    ✓ should emit closed even when destroyed (async #2)
precondition_failed: Database not open
    at Object.<anonymous> (/data/js-variants/multee/Clients/levelup/pouchdb/packages/node_modules/pouchdb/lib/index.js:614:16)
    at Module._compile (node:internal/modules/cjs/loader:1105:14)
    at Module._extensions..js (node:internal/modules/cjs/loader:1159:10)
    at Module.load (node:internal/modules/cjs/loader:981:32)
    at Module._load (node:internal/modules/cjs/loader:827:12)
    at Module.require (node:internal/modules/cjs/loader:1005:19)
    at require (node:internal/modules/cjs/helpers:102:18)
    at commonUtils.loadPouchDBForNode (/data/js-variants/multee/Clients/levelup/pouchdb/tests/common-utils.js:92:17)
    at commonUtils.loadPouchDB (/data/js-variants/multee/Clients/levelup/pouchdb/tests/common-utils.js:78:39)
    at Object.<anonymous> (/data/js-variants/multee/Clients/levelup/pouchdb/tests/integration/node.setup.js:21:28)
    at Module._compile (node:internal/modules/cjs/loader:1105:14)
    at Module._extensions..js (node:internal/modules/cjs/loader:1159:10)
    at Module.load (node:internal/modules/cjs/loader:981:32)
    at Module._load (node:internal/modules/cjs/loader:827:12)
    at Module.require (node:internal/modules/cjs/loader:1005:19)
    at require (node:internal/modules/cjs/helpers:102:18)
    at /data/js-variants/multee/Clients/levelup/pouchdb/node_modules/mocha/bin/_mocha:366:3
    at Array.forEach (<anonymous>)
    at Object.<anonymous> (/data/js-variants/multee/Clients/levelup/pouchdb/node_modules/mocha/bin/_mocha:365:10)
    at Module._compile (node:internal/modules/cjs/loader:1105:14)
    at Module._extensions..js (node:internal/modules/cjs/loader:1159:10)
    at Module.load (node:internal/modules/cjs/loader:981:32)
    at Module._load (node:internal/modules/cjs/loader:827:12)
    at Function.executeUserEntryPoint [as runMain] (node:internal/modules/run_main:77:12)
    at node:internal/main/run_main_module:17:47
    ✓ test unref for coverage
    ✓ test double unref for coverage
precondition_failed: Database not open
    at Object.<anonymous> (/data/js-variants/multee/Clients/levelup/pouchdb/packages/node_modules/pouchdb/lib/index.js:614:16)
    at Module._compile (node:internal/modules/cjs/loader:1105:14)
    at Module._extensions..js (node:internal/modules/cjs/loader:1159:10)
    at Module.load (node:internal/modules/cjs/loader:981:32)
    at Module._load (node:internal/modules/cjs/loader:827:12)
    at Module.require (node:internal/modules/cjs/loader:1005:19)
    at require (node:internal/modules/cjs/helpers:102:18)
    at commonUtils.loadPouchDBForNode (/data/js-variants/multee/Clients/levelup/pouchdb/tests/common-utils.js:92:17)
    at commonUtils.loadPouchDB (/data/js-variants/multee/Clients/levelup/pouchdb/tests/common-utils.js:78:39)
    at Object.<anonymous> (/data/js-variants/multee/Clients/levelup/pouchdb/tests/integration/node.setup.js:21:28)
    at Module._compile (node:internal/modules/cjs/loader:1105:14)
    at Module._extensions..js (node:internal/modules/cjs/loader:1159:10)
    at Module.load (node:internal/modules/cjs/loader:981:32)
    at Module._load (node:internal/modules/cjs/loader:827:12)
    at Module.require (node:internal/modules/cjs/loader:1005:19)
    at require (node:internal/modules/cjs/helpers:102:18)
    at /data/js-variants/multee/Clients/levelup/pouchdb/node_modules/mocha/bin/_mocha:366:3
    at Array.forEach (<anonymous>)
    at Object.<anonymous> (/data/js-variants/multee/Clients/levelup/pouchdb/node_modules/mocha/bin/_mocha:365:10)
    at Module._compile (node:internal/modules/cjs/loader:1105:14)
    at Module._extensions..js (node:internal/modules/cjs/loader:1159:10)
    at Module.load (node:internal/modules/cjs/loader:981:32)
    at Module._load (node:internal/modules/cjs/loader:827:12)
    at Function.executeUserEntryPoint [as runMain] (node:internal/modules/run_main:77:12)
    at node:internal/main/run_main_module:17:47
    ✓ test close-then-destroyed for coverage
************* run test done *************
pouchdb is testing ./VariantsDeps/levelup/variant2/levelup
************* npm unlink module *************

removed 1 package, changed 1 package, and audited 1032 packages in 3s

64 packages are looking for funding
  run `npm fund` for details

41 vulnerabilities (1 low, 9 moderate, 25 high, 6 critical)

To address issues that do not require attention, run:
  npm audit fix

To address all issues possible (including breaking changes), run:
  npm audit fix --force

Some issues need review, and may require choosing
a different dependency.

Run `npm audit` for details.
************* npm unlink module done *************
************* npm unlink globally *************

removed 1 package, and audited 1 package in 1s

found 0 vulnerabilities
************* npm unlink module done *************
************* npm link globally *************

added 1 package, and audited 3 packages in 389ms

found 0 vulnerabilities
************* npm link globally done *************
************* npm link module *************

added 1 package, changed 1 package, and audited 1034 packages in 4s

64 packages are looking for funding
  run `npm fund` for details

41 vulnerabilities (1 low, 9 moderate, 25 high, 6 critical)

To address issues that do not require attention, run:
  npm audit fix

To address all issues possible (including breaking changes), run:
  npm audit fix --force

Some issues need review, and may require choosing
a different dependency.

Run `npm audit` for details.
************* npm link module done *************
************* start run test *************

> pouchdb-monorepo@7.0.0-prerelease test
> bash bin/run-test.sh


> pouchdb-monorepo@7.0.0-prerelease build-node
> bash bin/build-node.sh


> pouchdb-monorepo@7.0.0-prerelease build-modules
> node bin/build-modules.js

Building pouchdb...
Building pouchdb-abstract-mapreduce...
Building pouchdb-adapter-http...
Building pouchdb-adapter-idb...
Building pouchdb-adapter-indexeddb...
Building pouchdb-adapter-leveldb...
Building pouchdb-adapter-leveldb-core...
Building pouchdb-adapter-localstorage...
Building pouchdb-adapter-memory...
Building pouchdb-adapter-utils...
Building pouchdb-binary-utils...
Building pouchdb-browser...
Building pouchdb-changes-filter...
Building pouchdb-checkpointer...
Building pouchdb-collate...
Building pouchdb-collections...
Building pouchdb-core...
Building pouchdb-errors...
Building pouchdb-fetch...
Building pouchdb-find...
Building pouchdb-for-coverage...
Building pouchdb-generate-replication-id...
Building pouchdb-json...
Building pouchdb-mapreduce...
Building pouchdb-mapreduce-utils...
Building pouchdb-md5...
Building pouchdb-merge...
Building pouchdb-node...
Building pouchdb-replication...
Building pouchdb-selector-core...
Building pouchdb-utils...
Building sublevel-pouchdb...
  ✓ wrote pouchdb-adapter-localstorage/lib/index.js in vanilla mode
  ✓ wrote pouchdb-adapter-localstorage/lib/index.es.js in vanilla mode
  ✓ wrote pouchdb-adapter-memory/lib/index.js in vanilla mode
  ✓ wrote pouchdb-adapter-memory/lib/index.es.js in vanilla mode
  ✓ wrote pouchdb-checkpointer/lib/index.js in vanilla mode
  ✓ wrote pouchdb-checkpointer/lib/index.es.js in vanilla mode
  ✓ wrote pouchdb-errors/lib/index.js in vanilla mode
  ✓ wrote pouchdb-errors/lib/index.es.js in vanilla mode
  ✓ wrote pouchdb-generate-replication-id/lib/index.js in vanilla mode
  ✓ wrote pouchdb-generate-replication-id/lib/index.es.js in vanilla mode
  ✓ wrote pouchdb-adapter-http/lib/index.js in vanilla mode
  ✓ wrote pouchdb-adapter-http/lib/index.es.js in vanilla mode
  ✓ wrote pouchdb-adapter-leveldb/lib/index.js in node mode
  ✓ wrote pouchdb-adapter-leveldb/lib/index.es.js in node mode
  ✓ wrote pouchdb-adapter-leveldb/lib/index-browser.js in browser mode
  ✓ wrote pouchdb-adapter-leveldb/lib/index-browser.es.js in browser mode
  ✓ wrote pouchdb-adapter-leveldb-core/lib/index.js in node mode
  ✓ wrote pouchdb-adapter-leveldb-core/lib/index.es.js in node mode
  ✓ wrote pouchdb-adapter-leveldb-core/lib/index-browser.js in browser mode
  ✓ wrote pouchdb-adapter-leveldb-core/lib/index-browser.es.js in browser mode
  ✓ wrote pouchdb-changes-filter/lib/index-browser.js in browser mode
  ✓ wrote pouchdb-changes-filter/lib/index-browser.es.js in browser mode
  ✓ wrote pouchdb-fetch/lib/index-browser.js in browser mode
  ✓ wrote pouchdb-fetch/lib/index-browser.es.js in browser mode
  ✓ wrote pouchdb-md5/lib/index-browser.js in browser mode
  ✓ wrote pouchdb-md5/lib/index-browser.es.js in browser mode
  ✓ wrote pouchdb-changes-filter/lib/index.js in node mode
  ✓ wrote pouchdb-changes-filter/lib/index.es.js in node mode
  ✓ wrote pouchdb-collate/lib/index.js in vanilla mode
  ✓ wrote pouchdb-collate/lib/index.es.js in vanilla mode
  ✓ wrote pouchdb-fetch/lib/index.js in node mode
  ✓ wrote pouchdb-fetch/lib/index.es.js in node mode
  ✓ wrote pouchdb-json/lib/index.js in vanilla mode
  ✓ wrote pouchdb-json/lib/index.es.js in vanilla mode
  ✓ wrote pouchdb-mapreduce-utils/lib/index.js in vanilla mode
  ✓ wrote pouchdb-mapreduce-utils/lib/index.es.js in vanilla mode
  ✓ wrote pouchdb-md5/lib/index.js in node mode
  ✓ wrote pouchdb-md5/lib/index.es.js in node mode
  ✓ wrote pouchdb-abstract-mapreduce/lib/index.js in vanilla mode
  ✓ wrote pouchdb-abstract-mapreduce/lib/index.es.js in vanilla mode
  ✓ wrote pouchdb-adapter-idb/lib/index.js in vanilla mode
  ✓ wrote pouchdb-adapter-idb/lib/index.es.js in vanilla mode
  ✓ wrote pouchdb-adapter-indexeddb/lib/index.js in vanilla mode
  ✓ wrote pouchdb-adapter-indexeddb/lib/index.es.js in vanilla mode
  ✓ wrote pouchdb-binary-utils/lib/index-browser.js in browser mode
  ✓ wrote pouchdb-binary-utils/lib/index-browser.es.js in browser mode
  ✓ wrote pouchdb-utils/lib/index-browser.js in browser mode
  ✓ wrote pouchdb-utils/lib/index-browser.es.js in browser mode
  ✓ wrote pouchdb-utils/lib/index.js in node mode
  ✓ wrote pouchdb-utils/lib/index.es.js in node mode
  ✓ wrote pouchdb-adapter-utils/lib/index.js in vanilla mode
  ✓ wrote pouchdb-adapter-utils/lib/index.es.js in vanilla mode
  ✓ wrote pouchdb-binary-utils/lib/index.js in node mode
  ✓ wrote pouchdb-binary-utils/lib/index.es.js in node mode
  ✓ wrote pouchdb-collections/lib/index.js in vanilla mode
  ✓ wrote pouchdb-collections/lib/index.es.js in vanilla mode
  ✓ wrote pouchdb-merge/lib/index.js in vanilla mode
  ✓ wrote pouchdb-merge/lib/index.es.js in vanilla mode
  ✓ wrote pouchdb-selector-core/lib/index.js in vanilla mode
  ✓ wrote pouchdb-selector-core/lib/index.es.js in vanilla mode
  ✓ wrote sublevel-pouchdb/lib/index.js in vanilla mode
  ✓ wrote sublevel-pouchdb/lib/index.es.js in vanilla mode
  ✓ wrote pouchdb-mapreduce/lib/index-browser.js in browser mode
  ✓ wrote pouchdb-mapreduce/lib/index-browser.es.js in browser mode
  ✓ wrote pouchdb-replication/lib/index.js in vanilla mode
  ✓ wrote pouchdb-replication/lib/index.es.js in vanilla mode
  ✓ wrote pouchdb-mapreduce/lib/index.js in node mode
  ✓ wrote pouchdb-mapreduce/lib/index.es.js in node mode
  ✓ wrote pouchdb-core/lib/index.js in vanilla mode
  ✓ wrote pouchdb-core/lib/index.es.js in vanilla mode
  ✓ wrote pouchdb-find/lib/index.js in node mode
  ✓ wrote pouchdb-find/lib/index.es.js in node mode
  ✓ wrote pouchdb-find/lib/index-browser.js in browser mode
  ✓ wrote pouchdb-find/lib/index-browser.es.js in browser mode
  ✓ wrote pouchdb-for-coverage/lib/index.js in node mode
  ✓ wrote pouchdb-for-coverage/lib/index.es.js in node mode
  ✓ wrote pouchdb-for-coverage/lib/index-browser.js in browser mode
  ✓ wrote pouchdb-for-coverage/lib/index-browser.es.js in browser mode
  ✓ wrote pouchdb-browser/lib/index.js in vanilla mode
  ✓ wrote pouchdb-browser/lib/index.es.js in vanilla mode
  ✓ wrote pouchdb-node/lib/index.js in vanilla mode
  ✓ wrote pouchdb-node/lib/index.es.js in vanilla mode
  ✓ wrote packages/node_modules/pouchdb/lib/index.js
  ✓ wrote packages/node_modules/pouchdb/lib/index.es.js
Waiting for host to start ..
Host started :)
> pouchdb-monorepo@7.0.0-prerelease test-node
> bash bin/test-node.sh

Down server listening on port 3010
Seeded with: 1660146619433


  DB Setup
    ✓ PouchDB has a version
    ✓ PouchDB version matches package.json

  test.active_tasks.js
    ✓ Can add a task
    ✓ Can get tasks by id
    ✓ Can get all tasks
    ✓ Can update a task
    ✓ Can remove a task

  test.all_docs.js-http
    ✓ Testing all docs (147ms)
    ✓ Testing allDocs opts.keys (65ms)
    ✓ Testing allDocs opts.keys with skip
    ✓ Testing allDocs opts.keys with limit
    ✓ Testing allDocs invalid opts.keys
    ✓ Testing deleting in changes (50ms)
    ✓ Testing updating in changes (48ms)
    ✓ Testing include docs
    ✓ Testing conflicts (48ms)
    ✓ test basic collation
    ✓ 3883 start_key end_key aliases
    ✓ test total_rows with a variety of criteria (142ms)
    ✓ test total_rows with both skip and limit (38ms)
    ✓ test limit option and total_rows
    ✓ test escaped startkey/endkey
    ✓ test "key" option
    ✓ test inclusive_end=false (54ms)
    ✓ test descending with startkey/endkey
    ✓ #3082 test wrong num results returned (247ms)
    ✓ test empty db
    ✓ test after db close
    ✓ 5793 _conflicts should not exist if no conflicts
    ✓ #6230 Test allDocs opts update_seq: false
    ✓ #6230 Test allDocs opts update_seq: true
    ✓ #6230 Test allDocs opts with update_seq missing

  test.all_docs.js-local
    ✓ Testing all docs
    ✓ Testing allDocs opts.keys
    ✓ Testing allDocs opts.keys with skip
    ✓ Testing allDocs opts.keys with limit
    ✓ Testing allDocs invalid opts.keys
    ✓ Testing deleting in changes
    ✓ Testing updating in changes
    ✓ Testing include docs
    ✓ Testing conflicts
    ✓ test basic collation
    ✓ 3883 start_key end_key aliases
    ✓ test total_rows with a variety of criteria
    ✓ test total_rows with both skip and limit
    ✓ test limit option and total_rows
    ✓ test escaped startkey/endkey
    ✓ test "key" option
    ✓ test inclusive_end=false
    ✓ test descending with startkey/endkey
    ✓ #3082 test wrong num results returned (184ms)
    ✓ test empty db
    ✓ test after db close
    ✓ test unicode ids and revs
    ✓ 5793 _conflicts should not exist if no conflicts
    ✓ #6230 Test allDocs opts update_seq: false
    ✓ #6230 Test allDocs opts update_seq: true
    ✓ #6230 Test allDocs opts with update_seq missing

  suite2 test.attachments.js-local
    ✓ 3357 Attachment names cant start with _
    ✓ 5736 warning for putAttachment without content_type
    ✓ 5736 warning for bulkDocs attachments without content_type
    ✓ fetch atts with open_revs and missing
    ✓ issue 2803 should throw 412
    ✓ issue 2803 should throw 412 part 2
    ✓ issue 2803 should throw 412 part 3
    ✓ issue 2803 should throw 412 part 4
    ✓ #2858 {binary: true} in get()
    ✓ #2858 {binary: true} in allDocs() 1
    ✓ #2858 {binary: true} in allDocs() 2
    ✓ #2858 {binary: true} in allDocs() 3
    ✓ #2858 {binary: true} in allDocs() 4
    ✓ #2858 {binary: true} in allDocs() 5
    ✓ #2858 {binary: true} in allDocs(), many atts
    ✓ #2858 {binary: true} in allDocs(), mixed atts
    ✓ #2858 {binary: true} in changes() non-live
    ✓ #2858 {binary: true} in changes() non-live, many atts
    ✓ #2858 {binary: true} in changes() non-live, mixed atts
    ✓ #2858 {binary: true} non-live changes, complete event
    ✓ #2858 {binary: true} in live changes
    ✓ #2858 {binary: true} in live changes, mixed atts
    ✓ #2858 {binary: true} in live+retry changes
    ✓ #2858 {binary: true} in live changes, attachments:false
    ✓ #2858 {binary: true} in live changes, include_docs:false
    ✓ #6736 {binary: true} in bulkGet()
    ✓ Measures length correctly after put()
    ✓ #3074 non-live changes()
    ✓ #3074 live changes()
    ✓ #3074 non-live changes(), no attachments
    ✓ #3074 live changes(), no attachments
    ✓ #3881 filter extraneous keys from _attachments
    ✓ #2771 allDocs() 1, single attachment
    ✓ #2771 allDocs() 2, many docs same att
    ✓ #2771 allDocs() 3, many docs diff atts
    ✓ #2771 allDocs() 4, mix of atts and no atts
    ✓ #2771 allDocs() 5, no atts
    ✓ #2771 allDocs() 6, no docs
    ✓ #2771 allDocs() 7, revisions and deletions
    ✓ #2771 allDocs() 8, empty attachment
    ✓ No length for non-stubs
    ✓ Test some attachments
    ✓ Test getAttachment
    ✓ Test getAttachment with stubs
    ✓ Test get() with binary:true and stubs
    ✓ Test attachments in allDocs/changes
    ✓ Test putAttachment with base64 plaintext
    ✓ Test putAttachment with invalid base64
    ✓ Test getAttachment with empty text
    ✓ Test getAttachment with normal text
    ✓ Test getAttachment with PNG
    ✓ Test getAttachment with PNG using bulkDocs
    ✓ Test getAttachment with PNG using post
    ✓ Test postAttachment with PNG then bulkDocs
    ✓ proper stub behavior
    ✓ Testing with invalid docs
    ✓ Test create attachment and doc in one go
    ✓ Test create attachment and doc in one go without callback
    ✓ Test create attachment without callback
    ✓ Test put attachment on a doc without attachments
    ✓ Test put attachment with unencoded name
    ✓ 3963 length property on stubs
    ✓ Testing with invalid rev
    ✓ Test put another attachment on a doc with attachments
    ✓ Test get with attachments: true if empty attachments
    ✓ Test delete attachment from a doc
    ✓ Test a document with a json string attachment
    ✓ Test remove doc with attachment
    ✓ Try to insert a doc with unencoded attachment
    ✓ Try to get attachment of unexistent doc
    ✓ Test synchronous putAttachment with text data
    ✓ Test synchronous putAttachment with no text data
    ✓ Test put with partial stubs
    ✓ Test put with attachments and new_edits=false
    ✓ Test getAttachment with specific rev
    ✓ Test getAttachment with diff revs and content
    ✓ Test stubs
    ✓ Try to get unexistent attachment of some doc
    ✓ putAttachment and getAttachment with plaintext
    ✓ putAttachment and getAttachment with png data
    ✓ putAttachment in new doc with base64
    ✓ #2818 - save same attachment in different revs (45ms)
    ✓ #2818 - save same attachment many times in parallel
    ✓ #2818 - revisions keep attachments (no compaction)
    ✓ #2818 - doesn't throw 409 if same filename
    ✓ #3008 test correct encoding/decoding of \u0000 etc.
    ✓ putAttachment and getAttachment with big png data (89ms)
    ✓ #2709 `revpos` with putAttachment
    ✓ #2709 `revpos` with inline attachment
    ✓ #2709 `revpos` with allDocs
    ✓ #7403 {attachments: true, binary: true, include_docs: true} in allDocs with one missing doc

  suite2 test.attachments.js-http
    ✓ 3357 Attachment names cant start with _
    ✓ 5736 warning for putAttachment without content_type
    ✓ 5736 warning for bulkDocs attachments without content_type
    ✓ fetch atts with open_revs and missing
    ✓ issue 2803 should throw 412
    ✓ issue 2803 should throw 412 part 2
    ✓ issue 2803 should throw 412 part 3
    ✓ issue 2803 should throw 412 part 4
    ✓ #2858 {binary: true} in get()
    ✓ #2858 {binary: true} in allDocs() 1
    ✓ #2858 {binary: true} in allDocs() 2
    ✓ #2858 {binary: true} in allDocs() 3
    ✓ #2858 {binary: true} in allDocs() 4
    ✓ #2858 {binary: true} in allDocs() 5
    ✓ #2858 {binary: true} in allDocs(), many atts
    ✓ #2858 {binary: true} in allDocs(), mixed atts
    ✓ #2858 {binary: true} in changes() non-live (38ms)
    ✓ #2858 {binary: true} in changes() non-live, many atts (42ms)
    ✓ #2858 {binary: true} in changes() non-live, mixed atts (40ms)
    ✓ #2858 {binary: true} non-live changes, complete event
    ✓ #2858 {binary: true} in live changes
    ✓ #2858 {binary: true} in live changes, mixed atts
    ✓ #2858 {binary: true} in live+retry changes
    ✓ #2858 {binary: true} in live changes, attachments:false
    ✓ #2858 {binary: true} in live changes, include_docs:false
    ✓ #6736 {binary: true} in bulkGet() (38ms)
    ✓ Measures length correctly after put()
    ✓ #3074 non-live changes() (46ms)
    ✓ #3074 live changes() (44ms)
    ✓ #3074 non-live changes(), no attachments (43ms)
    ✓ #3074 live changes(), no attachments (38ms)
    ✓ #3881 filter extraneous keys from _attachments
    ✓ #2771 allDocs() 1, single attachment
    ✓ #2771 allDocs() 2, many docs same att
    ✓ #2771 allDocs() 3, many docs diff atts
    ✓ #2771 allDocs() 4, mix of atts and no atts (40ms)
    ✓ #2771 allDocs() 5, no atts
    ✓ #2771 allDocs() 6, no docs
    ✓ #2771 allDocs() 7, revisions and deletions (38ms)
    ✓ #2771 allDocs() 8, empty attachment
    ✓ No length for non-stubs
    ✓ Test some attachments (73ms)
    ✓ Test getAttachment
    ✓ Test getAttachment with stubs
    ✓ Test get() with binary:true and stubs (38ms)
    ✓ Test attachments in allDocs/changes
    ✓ Test putAttachment with base64 plaintext
    ✓ Test putAttachment with invalid base64
    ✓ Test getAttachment with empty text
    ✓ Test getAttachment with normal text
    ✓ Test getAttachment with PNG
    ✓ Test getAttachment with PNG using bulkDocs (41ms)
    ✓ Test getAttachment with PNG using post
    ✓ Test postAttachment with PNG then bulkDocs (52ms)
    ✓ proper stub behavior (43ms)
    ✓ Testing with invalid docs
    ✓ Test create attachment and doc in one go
    ✓ Test create attachment and doc in one go without callback
    ✓ Test create attachment without callback (43ms)
    ✓ Test put attachment on a doc without attachments
    ✓ Test put attachment with unencoded name
    ✓ 3963 length property on stubs (51ms)
    ✓ Testing with invalid rev
    ✓ Test put another attachment on a doc with attachments
    ✓ Test get with attachments: true if empty attachments
    ✓ Test delete attachment from a doc (47ms)
    ✓ Test a document with a json string attachment
    ✓ Test remove doc with attachment
    ✓ Try to insert a doc with unencoded attachment
    ✓ Try to get attachment of unexistent doc
    ✓ Test synchronous putAttachment with text data (38ms)
    ✓ Test synchronous putAttachment with no text data
    ✓ Test put with partial stubs
    ✓ Test put with attachments and new_edits=false
    ✓ Test getAttachment with specific rev (43ms)
    ✓ Test getAttachment with diff revs and content
    ✓ Test stubs
    ✓ Try to get unexistent attachment of some doc
    ✓ putAttachment and getAttachment with plaintext
    ✓ putAttachment and getAttachment with png data
    ✓ putAttachment in new doc with base64
    ✓ #2818 - save same attachment in different revs (51ms)
    ✓ #2818 - save same attachment many times in parallel
    ✓ #2818 - revisions keep attachments (no compaction) (41ms)
    ✓ #2818 - doesn't throw 409 if same filename
    ✓ #3008 test correct encoding/decoding of \u0000 etc.
    ✓ putAttachment and getAttachment with big png data (129ms)
    ✓ #2709 `revpos` with putAttachment (41ms)
    ✓ #2709 `revpos` with inline attachment
    ✓ #2709 `revpos` with allDocs
    ✓ #7403 {attachments: true, binary: true, include_docs: true} in allDocs with one missing doc

  suite2 test.attachments.js- local:http
    ✓ Attachments replicate back and forth (114ms)
    ✓ Replicate same doc, same atts (135ms)
    ✓ Replicate same doc, same atts 2 (107ms)
    ✓ Attachments replicate (64ms)
    ✓ Attachment types replicate (74ms)
    ✓ Many many attachments replicate (246ms)
    ✓ Many many png attachments replicate (197ms)
    ✓ Multiple attachments replicate (83ms)
    - #3961 Many attachments on same doc
    ✓ Multiple attachments replicate, different docs (#2698) (86ms)
    ✓ Multiple attachments replicate, different docs png (#2698) (67ms)
    ✓ #3932 attachments with tricky revpos (135ms)
    ✓ replication with changing attachments (103ms)
    ✓ 3955 race condition in put
    ✓ #8456 bad attachment rev after replication (132ms)

  suite2 test.attachments.js- http:http
    ✓ Attachments replicate back and forth (174ms)
    ✓ Replicate same doc, same atts (175ms)
    ✓ Replicate same doc, same atts 2 (174ms)
    ✓ Attachments replicate (80ms)
    ✓ Attachment types replicate (206ms)
    ✓ Many many attachments replicate (340ms)
    ✓ Many many png attachments replicate (286ms)
    ✓ Multiple attachments replicate (125ms)
    - #3961 Many attachments on same doc
    ✓ Multiple attachments replicate, different docs (#2698) (123ms)
    ✓ Multiple attachments replicate, different docs png (#2698) (126ms)
    ✓ #3932 attachments with tricky revpos (225ms)
    ✓ replication with changing attachments (148ms)
    ✓ 3955 race condition in put
    ✓ #8456 bad attachment rev after replication (179ms)

  suite2 test.attachments.js- http:local
    ✓ Attachments replicate back and forth (101ms)
    ✓ Replicate same doc, same atts (155ms)
    ✓ Replicate same doc, same atts 2 (146ms)
    ✓ Attachments replicate (54ms)
    ✓ Attachment types replicate (55ms)
    ✓ Many many attachments replicate (138ms)
    ✓ Many many png attachments replicate (185ms)
    ✓ Multiple attachments replicate (82ms)
    - #3961 Many attachments on same doc
    ✓ Multiple attachments replicate, different docs (#2698) (68ms)
    ✓ Multiple attachments replicate, different docs png (#2698) (96ms)
    ✓ #3932 attachments with tricky revpos (151ms)
    ✓ replication with changing attachments (93ms)
    ✓ 3955 race condition in put
    ✓ #8456 bad attachment rev after replication (115ms)

  suite2 test.attachments.js- local:local
    ✓ Attachments replicate back and forth
    ✓ Replicate same doc, same atts
    ✓ Replicate same doc, same atts 2
    ✓ Attachments replicate (42ms)
    ✓ Attachment types replicate
    ✓ Many many attachments replicate
    ✓ Many many png attachments replicate
    ✓ Multiple attachments replicate
    - #3961 Many attachments on same doc
    ✓ Multiple attachments replicate, different docs (#2698)
    ✓ Multiple attachments replicate, different docs png (#2698)
    ✓ #3932 attachments with tricky revpos (41ms)
    ✓ replication with changing attachments (70ms)
    ✓ 3955 race condition in put
    ✓ #8456 bad attachment rev after replication

  test.basics.js-http
    ✓ Create a pouch without new keyword
    ✓ Name is accessible via instance
    ✓ 4314 Create a pouch with + in name
    ✓ Creating Pouch without name will throw
    ✓ 4314 Create a pouch with urlencoded name
    ✓ 4219 destroy a pouch
    ✓ 4339 throw useful error if method called on stale instance
    ✓ [4595] should reject xhr errors
    ✓ [4595] should emit error event on xhr error
    ✓ Add a doc
    ✓ Get invalid id
    ✓ Missing doc should contain ID in error object
    ✓ PUTed Conflicted doc should contain ID in error object
    ✓ POSTed Conflicted doc should contain ID in error object
    ✓ Add a doc with a promise
    ✓ Add a doc with opts object
    ✓ Modify a doc
    ✓ Modifying a doc that has rewritten content
    ✓ Modify a doc with a promise
    ✓ Read db id
    ✓ Read db id with promise
    ✓ Close db
    ✓ Close db with a promise
    ✓ Read db id after closing Close
    ✓ Modify a doc with incorrect rev
    ✓ Remove doc
    ✓ Remove doc with a promise
    ✓ Remove doc with new syntax
    ✓ Remove doc with new syntax and a promise
    ✓ Doc removal leaves only stub
    ✓ Remove doc twice with specified id
    ✓ Remove doc, no callback
    ✓ Delete document without id
    ✓ Delete document with many args
    ✓ Delete document with many args, callback style
    ✓ Delete doc with id + rev + no opts
    ✓ Delete doc with id + rev + no opts, callback style
    ✓ Delete doc with doc + opts
    ✓ Delete doc with doc + opts, callback style
    ✓ Delete doc with rev in opts
    ✓ Bulk docs
    ✓ Bulk docs with a promise
    ✓ Basic checks
    ✓ update with invalid rev
    ✓ Doc validation
    ✓ Replication fields (#2442)
    ✓ Testing issue #48 (54ms)
    ✓ Testing valid id
    ✓ Put doc without _id should fail
    ✓ Put doc with bad reserved id should fail
    ✓ update_seq persists
    ✓ deletions persists
    ✓ #4126 should not store raw Dates
    ✓ Create a db with a reserved name
    ✓ Error when document is not an object
    ✓ Test instance update_seq updates correctly
    ✓ Fail to fetch a doc after db was deleted (47ms)
    ✓ Fail to fetch a doc after db was deleted (54ms)
    ✓ Cant add docs with empty ids
    ✓ Test doc with percent in ID
    ✓ db.info should give auto_compaction = false (#2744)
    ✓ db.info should give auto_compaction = true (#2744)
    ✓ db.info should give adapter name (#3567)
    ✓ db.info should give correct doc_count
    ✓ putting returns {ok: true}
    ✓ putting is override-able
    ✓ issue 2779, deleted docs, old revs COUCHDB-292
    ✓ issue 2888, successive deletes and writes (38ms)
    ✓ 2 invalid puts
    ✓ Docs save "null" value
    ✓ replace PouchDB.destroy() (express-pouchdb#203)
    ✓ 3968, keeps all object fields
    ✓ 4712 invalid rev for new doc generates conflict
    ✓ test info() after db close
    ✓ test get() after db close
    ✓ test close() after db close
    ✓ 7259 should have "this" keyword properly scoped
    ✓ #5471 PouchDB.plugin() should throw error if passed wrong type or empty object

  test.basics.js-local
    ✓ Create a pouch without new keyword
    ✓ Name is accessible via instance
    ✓ 4314 Create a pouch with + in name
    ✓ Creating Pouch without name will throw
    ✓ 4314 Create a pouch with urlencoded name
    ✓ 4219 destroy a pouch
    ✓ 4339 throw useful error if method called on stale instance
    ✓ [4595] should reject xhr errors
    ✓ [4595] should emit error event on xhr error
    ✓ Add a doc
    ✓ Get invalid id
    ✓ Missing doc should contain ID in error object
    ✓ PUTed Conflicted doc should contain ID in error object
    ✓ POSTed Conflicted doc should contain ID in error object
    ✓ Add a doc with a promise
    ✓ Add a doc with opts object
    ✓ Modify a doc
    ✓ Modifying a doc that has rewritten content
    ✓ Modify a doc with a promise
    ✓ Read db id
    ✓ Read db id with promise
    ✓ Close db
    ✓ Close db with a promise
    ✓ Read db id after closing Close (45ms)
    ✓ Modify a doc with incorrect rev
    ✓ Remove doc
    ✓ Remove doc with a promise
    ✓ Remove doc with new syntax
    ✓ Remove doc with new syntax and a promise
    ✓ Doc removal leaves only stub
    ✓ Remove doc twice with specified id
    ✓ Remove doc, no callback
    ✓ Delete document without id
    ✓ Delete document with many args
    ✓ Delete document with many args, callback style
    ✓ Delete doc with id + rev + no opts
    ✓ Delete doc with id + rev + no opts, callback style
    ✓ Delete doc with doc + opts
    ✓ Delete doc with doc + opts, callback style
    ✓ Delete doc with rev in opts
    ✓ Bulk docs
    ✓ Bulk docs with a promise
    ✓ Basic checks
    ✓ update with invalid rev
    ✓ Doc validation
    ✓ Replication fields (#2442)
    ✓ Allows _access field in documents (#8171)
    ✓ Testing issue #48 (53ms)
    ✓ Testing valid id
    ✓ Put doc without _id should fail
    ✓ Put doc with bad reserved id should fail
    ✓ update_seq persists
    ✓ deletions persists
    ✓ #4126 should not store raw Dates
    ✓ Create a db with a reserved name
    ✓ Error when document is not an object
    ✓ Test instance update_seq updates correctly
    ✓ Fail to fetch a doc after db was deleted
    ✓ Fail to fetch a doc after db was deleted
    ✓ Cant add docs with empty ids
    ✓ Test doc with percent in ID
    ✓ db.info should give auto_compaction = false (#2744)
    ✓ db.info should give auto_compaction = true (#2744)
    ✓ db.info should give adapter name (#3567)
    ✓ db.info should give correct doc_count
    ✓ putting returns {ok: true}
    ✓ putting is override-able
    ✓ issue 2779, deleted docs, old revs COUCHDB-292
    ✓ issue 2888, successive deletes and writes
    ✓ 2 invalid puts
    ✓ Docs save "null" value
    ✓ replace PouchDB.destroy() (express-pouchdb#203)
    ✓ 3968, keeps all object fields
    ✓ 4712 invalid rev for new doc generates conflict
    ✓ test info() after db close
    ✓ test get() after db close
    ✓ test close() after db close
    ✓ 7259 should have "this" keyword properly scoped
    ✓ should allow unicode doc ids
    ✓ should have same blob support for 2 dbs
    ✓ 6053, PouchDB.plugin() resets defaults
    ✓ #5471 PouchDB.plugin() should throw error if passed wrong type or empty object

  test.bulk_docs.js-local
    ✓ Testing bulk docs
    ✓ #6039 test id in bulk docs for conflict
    ✓ No id in bulk docs
    ✓ No _rev and new_edits=false
    ✓ 7829 bare rev 1- with new_edits=false
    ✓ Test empty bulkDocs
    ✓ Test many bulkDocs
    ✓ Test errors on invalid doc id
    ✓ Test two errors on invalid doc id
    ✓ No docs
    ✓ Jira 911
    ✓ Test multiple bulkdocs
    ✓ #2935 new_edits=false correct number
    ✓ #2935 new_edits=false correct number 2
    ✓ bulk docs update then delete then conflict
    ✓ bulk_docs delete then undelete
    ✓ #2935 new_edits=false with single unauthorized
    ✓ Deleting _local docs with bulkDocs
    ✓ Deleting _local docs with bulkDocs, not found
    ✓ Deleting _local docs with bulkDocs, wrong rev
    ✓ Bulk with new_edits=false
    ✓ Testing successive new_edits to the same doc
    ✓ #3062 bulkDocs with staggered seqs
    ✓ Testing successive new_edits to the same doc, different content
    ✓ Testing successive new_edits to two doc
    ✓ Deletion with new_edits=false
    ✓ Deletion with new_edits=false, no history
    ✓ Modification with new_edits=false, no history
    ✓ Deletion with new_edits=false, no history, no revisions
    ✓ Testing new_edits=false in req body
    ✓ 656 regression in handling deleted docs
    ✓ Test quotes in doc ids
    ✓ Bulk docs empty list
    ✓ handles simultaneous writes
    ✓ bulk docs input by array
    ✓ Bulk empty list
    ✓ Bulk docs not an array
    ✓ Bulk docs not an object
    ✓ Bulk docs two different revisions to same document id
    ✓ 4204 respect revs_limit (262ms)
    ✓ 2839 implement revs_limit (180ms)
    ✓ 4372 revs_limit deletes old revisions of the doc
    ✓ 4372 revs_limit with auto_compaction deletes old revisions of the doc
    ✓ 4712 invalid rev for new doc generates conflict
    ✓ 5793 bulk docs accepts _conflicts when new_edits=false

  test.bulk_docs.js-http
    ✓ Testing bulk docs
    ✓ #6039 test id in bulk docs for conflict
    ✓ No id in bulk docs
    ✓ No _rev and new_edits=false
    ✓ 7829 bare rev 1- with new_edits=false
    ✓ Test empty bulkDocs
    ✓ Test many bulkDocs
    ✓ Test errors on invalid doc id
    ✓ Test two errors on invalid doc id
    ✓ No docs
    ✓ Jira 911
    ✓ Test multiple bulkdocs
    ✓ #2935 new_edits=false correct number
    ✓ #2935 new_edits=false correct number 2
    ✓ bulk docs update then delete then conflict
    ✓ bulk_docs delete then undelete
    ✓ #2935 new_edits=false with single unauthorized
    ✓ Deleting _local docs with bulkDocs
    ✓ Bulk with new_edits=false
    ✓ Testing successive new_edits to the same doc
    ✓ #3062 bulkDocs with staggered seqs
    ✓ Testing successive new_edits to the same doc, different content (39ms)
    ✓ Testing successive new_edits to two doc (40ms)
    ✓ Deletion with new_edits=false
    ✓ Deletion with new_edits=false, no history
    ✓ Modification with new_edits=false, no history
    ✓ Deletion with new_edits=false, no history, no revisions
    ✓ Testing new_edits=false in req body
    ✓ 656 regression in handling deleted docs
    ✓ Test quotes in doc ids
    ✓ Bulk docs empty list
    ✓ handles simultaneous writes
    ✓ bulk docs input by array
    ✓ Bulk empty list
    ✓ Bulk docs not an array
    ✓ Bulk docs not an object
    ✓ Bulk docs two different revisions to same document id
    ✓ 4204 respect revs_limit (382ms)
    ✓ 2839 implement revs_limit
    ✓ 4372 revs_limit deletes old revisions of the doc
    ✓ 4372 revs_limit with auto_compaction deletes old revisions of the doc
    ✓ 4712 invalid rev for new doc generates conflict
    ✓ 5793 bulk docs accepts _conflicts when new_edits=false (42ms)

  test.bulk_get.js-http
    ✓ test bulk get with rev specified
    ✓ test bulk get with latest=true
    ✓ test bulk get with no rev specified
    ✓ _revisions is not returned by default
    ✓ #5886 bulkGet with reserved id
    ✓ _revisions is returned when specified
    ✓ _revisions is returned when specified, using implicit rev
    ✓ attachments are not included by default
    ✓ attachments are included when specified
    ✓ attachments are included when specified, using implicit rev

  test.bulk_get.js-local
    ✓ test bulk get with rev specified
    ✓ test bulk get with latest=true
    ✓ test bulk get with no rev specified
    ✓ _revisions is not returned by default
    ✓ #5886 bulkGet with reserved id
    ✓ _revisions is returned when specified
    ✓ _revisions is returned when specified, using implicit rev
    ✓ attachments are not included by default
    ✓ attachments are included when specified
    ✓ attachments are included when specified, using implicit rev

  test.changes.js-http
    ✓ All changes
    ✓ Changes with complete callback as param
    ✓ Promise resolved when changes cancelled
    - Live changes should clean listener when cancelled
    ✓ Changes Since
    ✓ Changes Since and limit limit 1
    ✓ Changes Since and limit limit 0
    ✓ Changes limit (38ms)
    ✓ Changes with filter not present in ddoc
    ✓ Changes with `filters` key not present in ddoc
    ✓ Changes limit and filter
    ✓ Changes with shorthand function name
    ✓ Changes with filter from nonexistent ddoc
    ✓ Changes with view not present in ddoc
    ✓ Changes with `views` key not present in ddoc
    ✓ #4451 Changes with invalid view filter
    ✓ 3356 throw inside a filter
    ✓ Changes with missing param `view` in request
    ✓ Changes limit and view instead of filter
    ✓ #3609 view option implies filter: _view
    ✓ Immediately cancel changes
    ✓ Changes with invalid ddoc view name
    ✓ Changes with invalid ddoc view name 2
    ✓ Changes with style = all_docs (60ms)
    ✓ Changes with style = all_docs and a callback for complete (60ms)
    ✓ Changes limit = 0
    ✓ Changes doc
    - Descending many changes
    ✓ live-changes
    ✓ Multiple watchers
    ✓ Continuous changes doc
    ✓ Cancel changes (322ms)
    ✓ #3579 changes firing 1 too many times (74ms)
    ✓ Kill database while listening to live changes
    ✓ #3136 style=all_docs (39ms)
    ✓ #4191 revs_diff causes endless loop
    ✓ #3136 style=all_docs & include_docs
    ✓ changes-filter with query params
    ✓ Non-live changes filter
    ✓ Non-live changes filter, descending
    ✓ #2569 Non-live doc_ids filter
    ✓ #2569 Big non-live doc_ids filter
    ✓ #2569 Live doc_ids filter
    ✓ #2569 Big live doc_ids filter
    ✓ #2569 Non-live doc_ids filter with filter=_doc_ids
    ✓ #2569 Live doc_ids filter with filter=_doc_ids
    ✓ Changes to same doc are grouped
    ✓ Changes with conflicts are handled correctly (129ms)
    ✓ Change entry for a deleted doc
    ✓ changes large number of docs (43ms)
    ✓ Calling db.changes({since: 'now'})
    ✓ Calling db.changes({since: 'latest'})
    ✓ Closing db does not cause a crash if changes cancelled
    ✓ fire-complete-on-cancel (101ms)
    ✓ changes are not duplicated (1026ms)
    ✓ supports return_docs=false
    ✓ should respects limit (75ms)
    ✓ doesn't throw if opts.complete is undefined
    ✓ handle individual changes in live replication (206ms)
    ✓ changes-filter without filter
    ✓ #3539 - Exception in changes is fine
    ✓ Changes with selector
    ✓ Changes with selector, explicit filter
    ✓ Changes with selector and mismatched filter
    ✓ Changes with limit and selector

  test.changes.js-local
    ✓ All changes
    ✓ Changes with complete callback as param
    ✓ Promise resolved when changes cancelled
    - Live changes should clean listener when cancelled
    ✓ Changes Since
    ✓ Changes Since and limit limit 1
    ✓ Changes Since and limit limit 0
    ✓ Changes limit
    ✓ Changes with filter not present in ddoc
    ✓ Changes with `filters` key not present in ddoc
    ✓ Changes limit and filter
    ✓ Changes with shorthand function name
    ✓ Changes with filter from nonexistent ddoc
    ✓ Changes with view not present in ddoc
    ✓ Changes with `views` key not present in ddoc
    ✓ #4451 Changes with invalid view filter
    ✓ 3356 throw inside a filter
    ✓ Changes with missing param `view` in request
    ✓ Changes limit and view instead of filter
    ✓ #3609 view option implies filter: _view
    ✓ Immediately cancel changes
    ✓ Changes with invalid ddoc view name
    ✓ Changes with invalid ddoc view name 2
    ✓ Changes with style = all_docs
    ✓ Changes with style = all_docs and a callback for complete
    ✓ Changes limit = 0
    ✓ Changes doc
    - Descending many changes
    ✓ live-changes
    ✓ Multiple watchers
    ✓ Continuous changes doc
    ✓ Cancel changes (318ms)
    ✓ #3579 changes firing 1 too many times (66ms)
    ✓ Kill database while listening to live changes
    ✓ #3136 style=all_docs
    ✓ #4191 revs_diff causes endless loop
    ✓ #3136 style=all_docs & include_docs
    ✓ changes-filter with query params
    ✓ Non-live changes filter
    ✓ Non-live changes filter, descending
    ✓ #2569 Non-live doc_ids filter
    ✓ #2569 Big non-live doc_ids filter
    ✓ #2569 Live doc_ids filter
    ✓ #2569 Big live doc_ids filter
    ✓ #2569 Non-live doc_ids filter with filter=_doc_ids
    ✓ #2569 Live doc_ids filter with filter=_doc_ids
    ✓ Changes to same doc are grouped
    ✓ Changes with conflicts are handled correctly
    ✓ Change entry for a deleted doc
    ✓ changes large number of docs
    ✓ Calling db.changes({since: 'now'})
    ✓ Calling db.changes({since: 'latest'})
    ✓ Closing db does not cause a crash if changes cancelled
    ✓ fire-complete-on-cancel (100ms)
    ✓ changes are not duplicated (1018ms)
    ✓ supports return_docs=false
    ✓ should respects limit (76ms)
    ✓ doesn't throw if opts.complete is undefined
    ✓ handle individual changes in live replication (67ms)
    ✓ changes-filter without filter
    ✓ #3539 - Exception in changes is fine
    ✓ Changes with selector
    ✓ Changes with selector, explicit filter
    ✓ Changes with selector and mismatched filter
    ✓ Changes with limit and selector

  changes-standalone
    - Changes reports errors

  test.close.js-local
    ✓ should emit destroyed even when closed (sync)
    ✓ should emit destroyed even when closed (async)
precondition_failed: Database not open
    at Object.<anonymous> (/data/js-variants/multee/Clients/levelup/pouchdb/packages/node_modules/pouchdb/lib/index.js:614:16)
    at Module._compile (node:internal/modules/cjs/loader:1105:14)
    at Module._extensions..js (node:internal/modules/cjs/loader:1159:10)
    at Module.load (node:internal/modules/cjs/loader:981:32)
    at Module._load (node:internal/modules/cjs/loader:827:12)
    at Module.require (node:internal/modules/cjs/loader:1005:19)
    at require (node:internal/modules/cjs/helpers:102:18)
    at commonUtils.loadPouchDBForNode (/data/js-variants/multee/Clients/levelup/pouchdb/tests/common-utils.js:92:17)
    at commonUtils.loadPouchDB (/data/js-variants/multee/Clients/levelup/pouchdb/tests/common-utils.js:78:39)
    at Object.<anonymous> (/data/js-variants/multee/Clients/levelup/pouchdb/tests/integration/node.setup.js:21:28)
    at Module._compile (node:internal/modules/cjs/loader:1105:14)
    at Module._extensions..js (node:internal/modules/cjs/loader:1159:10)
    at Module.load (node:internal/modules/cjs/loader:981:32)
    at Module._load (node:internal/modules/cjs/loader:827:12)
    at Module.require (node:internal/modules/cjs/loader:1005:19)
    at require (node:internal/modules/cjs/helpers:102:18)
    at /data/js-variants/multee/Clients/levelup/pouchdb/node_modules/mocha/bin/_mocha:366:3
    at Array.forEach (<anonymous>)
    at Object.<anonymous> (/data/js-variants/multee/Clients/levelup/pouchdb/node_modules/mocha/bin/_mocha:365:10)
    at Module._compile (node:internal/modules/cjs/loader:1105:14)
    at Module._extensions..js (node:internal/modules/cjs/loader:1159:10)
    at Module.load (node:internal/modules/cjs/loader:981:32)
    at Module._load (node:internal/modules/cjs/loader:827:12)
    at Function.executeUserEntryPoint [as runMain] (node:internal/modules/run_main:77:12)
    at node:internal/main/run_main_module:17:47
    ✓ should emit closed even when destroyed (async #2)
precondition_failed: Database not open
    at Object.<anonymous> (/data/js-variants/multee/Clients/levelup/pouchdb/packages/node_modules/pouchdb/lib/index.js:614:16)
    at Module._compile (node:internal/modules/cjs/loader:1105:14)
    at Module._extensions..js (node:internal/modules/cjs/loader:1159:10)
    at Module.load (node:internal/modules/cjs/loader:981:32)
    at Module._load (node:internal/modules/cjs/loader:827:12)
    at Module.require (node:internal/modules/cjs/loader:1005:19)
    at require (node:internal/modules/cjs/helpers:102:18)
    at commonUtils.loadPouchDBForNode (/data/js-variants/multee/Clients/levelup/pouchdb/tests/common-utils.js:92:17)
    at commonUtils.loadPouchDB (/data/js-variants/multee/Clients/levelup/pouchdb/tests/common-utils.js:78:39)
    at Object.<anonymous> (/data/js-variants/multee/Clients/levelup/pouchdb/tests/integration/node.setup.js:21:28)
    at Module._compile (node:internal/modules/cjs/loader:1105:14)
    at Module._extensions..js (node:internal/modules/cjs/loader:1159:10)
    at Module.load (node:internal/modules/cjs/loader:981:32)
    at Module._load (node:internal/modules/cjs/loader:827:12)
    at Module.require (node:internal/modules/cjs/loader:1005:19)
    at require (node:internal/modules/cjs/helpers:102:18)
    at /data/js-variants/multee/Clients/levelup/pouchdb/node_modules/mocha/bin/_mocha:366:3
    at Array.forEach (<anonymous>)
    at Object.<anonymous> (/data/js-variants/multee/Clients/levelup/pouchdb/node_modules/mocha/bin/_mocha:365:10)
    at Module._compile (node:internal/modules/cjs/loader:1105:14)
    at Module._extensions..js (node:internal/modules/cjs/loader:1159:10)
    at Module.load (node:internal/modules/cjs/loader:981:32)
    at Module._load (node:internal/modules/cjs/loader:827:12)
    at Function.executeUserEntryPoint [as runMain] (node:internal/modules/run_main:77:12)
    at node:internal/main/run_main_module:17:47
    ✓ test unref for coverage
    ✓ test double unref for coverage
precondition_failed: Database not open
    at Object.<anonymous> (/data/js-variants/multee/Clients/levelup/pouchdb/packages/node_modules/pouchdb/lib/index.js:614:16)
    at Module._compile (node:internal/modules/cjs/loader:1105:14)
    at Module._extensions..js (node:internal/modules/cjs/loader:1159:10)
    at Module.load (node:internal/modules/cjs/loader:981:32)
    at Module._load (node:internal/modules/cjs/loader:827:12)
    at Module.require (node:internal/modules/cjs/loader:1005:19)
    at require (node:internal/modules/cjs/helpers:102:18)
    at commonUtils.loadPouchDBForNode (/data/js-variants/multee/Clients/levelup/pouchdb/tests/common-utils.js:92:17)
    at commonUtils.loadPouchDB (/data/js-variants/multee/Clients/levelup/pouchdb/tests/common-utils.js:78:39)
    at Object.<anonymous> (/data/js-variants/multee/Clients/levelup/pouchdb/tests/integration/node.setup.js:21:28)
    at Module._compile (node:internal/modules/cjs/loader:1105:14)
    at Module._extensions..js (node:internal/modules/cjs/loader:1159:10)
    at Module.load (node:internal/modules/cjs/loader:981:32)
    at Module._load (node:internal/modules/cjs/loader:827:12)
    at Module.require (node:internal/modules/cjs/loader:1005:19)
    at require (node:internal/modules/cjs/helpers:102:18)
    at /data/js-variants/multee/Clients/levelup/pouchdb/node_modules/mocha/bin/_mocha:366:3
    at Array.forEach (<anonymous>)
    at Object.<anonymous> (/data/js-variants/multee/Clients/levelup/pouchdb/node_modules/mocha/bin/_mocha:365:10)
    at Module._compile (node:internal/modules/cjs/loader:1105:14)
    at Module._extensions..js (node:internal/modules/cjs/loader:1159:10)
    at Module.load (node:internal/modules/cjs/loader:981:32)
    at Module._load (node:internal/modules/cjs/loader:827:12)
    at Function.executeUserEntryPoint [as runMain] (node:internal/modules/run_main:77:12)
    at node:internal/main/run_main_module:17:47
    ✓ test close-then-destroyed for coverage
************* run test done *************
pouchdb is testing ./VariantsDeps/levelup/variant1/levelup
************* npm unlink module *************

removed 1 package, changed 1 package, and audited 1032 packages in 3s

64 packages are looking for funding
  run `npm fund` for details

41 vulnerabilities (1 low, 9 moderate, 25 high, 6 critical)

To address issues that do not require attention, run:
  npm audit fix

To address all issues possible (including breaking changes), run:
  npm audit fix --force

Some issues need review, and may require choosing
a different dependency.

Run `npm audit` for details.
************* npm unlink module done *************
************* npm unlink globally *************

removed 1 package, and audited 1 package in 1s

found 0 vulnerabilities
************* npm unlink module done *************
************* npm link globally *************

added 1 package, and audited 3 packages in 386ms

found 0 vulnerabilities
************* npm link globally done *************
************* npm link module *************

added 1 package, changed 1 package, and audited 1034 packages in 4s

64 packages are looking for funding
  run `npm fund` for details

41 vulnerabilities (1 low, 9 moderate, 25 high, 6 critical)

To address issues that do not require attention, run:
  npm audit fix

To address all issues possible (including breaking changes), run:
  npm audit fix --force

Some issues need review, and may require choosing
a different dependency.

Run `npm audit` for details.
************* npm link module done *************
************* start run test *************

> pouchdb-monorepo@7.0.0-prerelease test
> bash bin/run-test.sh


> pouchdb-monorepo@7.0.0-prerelease build-node
> bash bin/build-node.sh


> pouchdb-monorepo@7.0.0-prerelease build-modules
> node bin/build-modules.js

Building pouchdb...
Building pouchdb-abstract-mapreduce...
Building pouchdb-adapter-http...
Building pouchdb-adapter-idb...
Building pouchdb-adapter-indexeddb...
Building pouchdb-adapter-leveldb...
Building pouchdb-adapter-leveldb-core...
Building pouchdb-adapter-localstorage...
Building pouchdb-adapter-memory...
Building pouchdb-adapter-utils...
Building pouchdb-binary-utils...
Building pouchdb-browser...
Building pouchdb-changes-filter...
Building pouchdb-checkpointer...
Building pouchdb-collate...
Building pouchdb-collections...
Building pouchdb-core...
Building pouchdb-errors...
Building pouchdb-fetch...
Building pouchdb-find...
Building pouchdb-for-coverage...
Building pouchdb-generate-replication-id...
Building pouchdb-json...
Building pouchdb-mapreduce...
Building pouchdb-mapreduce-utils...
Building pouchdb-md5...
Building pouchdb-merge...
Building pouchdb-node...
Building pouchdb-replication...
Building pouchdb-selector-core...
Building pouchdb-utils...
Building sublevel-pouchdb...
  ✓ wrote pouchdb-adapter-localstorage/lib/index.js in vanilla mode
  ✓ wrote pouchdb-adapter-localstorage/lib/index.es.js in vanilla mode
  ✓ wrote pouchdb-adapter-memory/lib/index.js in vanilla mode
  ✓ wrote pouchdb-adapter-memory/lib/index.es.js in vanilla mode
  ✓ wrote pouchdb-checkpointer/lib/index.js in vanilla mode
  ✓ wrote pouchdb-checkpointer/lib/index.es.js in vanilla mode
  ✓ wrote pouchdb-errors/lib/index.js in vanilla mode
  ✓ wrote pouchdb-errors/lib/index.es.js in vanilla mode
  ✓ wrote pouchdb-generate-replication-id/lib/index.js in vanilla mode
  ✓ wrote pouchdb-generate-replication-id/lib/index.es.js in vanilla mode
  ✓ wrote pouchdb-adapter-http/lib/index.js in vanilla mode
  ✓ wrote pouchdb-adapter-http/lib/index.es.js in vanilla mode
  ✓ wrote pouchdb-adapter-leveldb/lib/index.js in node mode
  ✓ wrote pouchdb-adapter-leveldb/lib/index.es.js in node mode
  ✓ wrote pouchdb-adapter-leveldb/lib/index-browser.js in browser mode
  ✓ wrote pouchdb-adapter-leveldb/lib/index-browser.es.js in browser mode
  ✓ wrote pouchdb-adapter-leveldb-core/lib/index.js in node mode
  ✓ wrote pouchdb-adapter-leveldb-core/lib/index.es.js in node mode
  ✓ wrote pouchdb-adapter-leveldb-core/lib/index-browser.js in browser mode
  ✓ wrote pouchdb-adapter-leveldb-core/lib/index-browser.es.js in browser mode
  ✓ wrote pouchdb-changes-filter/lib/index-browser.js in browser mode
  ✓ wrote pouchdb-changes-filter/lib/index-browser.es.js in browser mode
  ✓ wrote pouchdb-fetch/lib/index-browser.js in browser mode
  ✓ wrote pouchdb-fetch/lib/index-browser.es.js in browser mode
  ✓ wrote pouchdb-md5/lib/index-browser.js in browser mode
  ✓ wrote pouchdb-md5/lib/index-browser.es.js in browser mode
  ✓ wrote pouchdb-changes-filter/lib/index.js in node mode
  ✓ wrote pouchdb-changes-filter/lib/index.es.js in node mode
  ✓ wrote pouchdb-collate/lib/index.js in vanilla mode
  ✓ wrote pouchdb-collate/lib/index.es.js in vanilla mode
  ✓ wrote pouchdb-fetch/lib/index.js in node mode
  ✓ wrote pouchdb-fetch/lib/index.es.js in node mode
  ✓ wrote pouchdb-json/lib/index.js in vanilla mode
  ✓ wrote pouchdb-json/lib/index.es.js in vanilla mode
  ✓ wrote pouchdb-mapreduce-utils/lib/index.js in vanilla mode
  ✓ wrote pouchdb-mapreduce-utils/lib/index.es.js in vanilla mode
  ✓ wrote pouchdb-md5/lib/index.js in node mode
  ✓ wrote pouchdb-md5/lib/index.es.js in node mode
  ✓ wrote pouchdb-abstract-mapreduce/lib/index.js in vanilla mode
  ✓ wrote pouchdb-abstract-mapreduce/lib/index.es.js in vanilla mode
  ✓ wrote pouchdb-adapter-idb/lib/index.js in vanilla mode
  ✓ wrote pouchdb-adapter-idb/lib/index.es.js in vanilla mode
  ✓ wrote pouchdb-adapter-indexeddb/lib/index.js in vanilla mode
  ✓ wrote pouchdb-adapter-indexeddb/lib/index.es.js in vanilla mode
  ✓ wrote pouchdb-binary-utils/lib/index-browser.js in browser mode
  ✓ wrote pouchdb-binary-utils/lib/index-browser.es.js in browser mode
  ✓ wrote pouchdb-utils/lib/index-browser.js in browser mode
  ✓ wrote pouchdb-utils/lib/index-browser.es.js in browser mode
  ✓ wrote pouchdb-utils/lib/index.js in node mode
  ✓ wrote pouchdb-utils/lib/index.es.js in node mode
  ✓ wrote pouchdb-adapter-utils/lib/index.js in vanilla mode
  ✓ wrote pouchdb-binary-utils/lib/index.js in node mode
  ✓ wrote pouchdb-adapter-utils/lib/index.es.js in vanilla mode
  ✓ wrote pouchdb-binary-utils/lib/index.es.js in node mode
  ✓ wrote pouchdb-collections/lib/index.js in vanilla mode
  ✓ wrote pouchdb-collections/lib/index.es.js in vanilla mode
  ✓ wrote pouchdb-merge/lib/index.js in vanilla mode
  ✓ wrote pouchdb-merge/lib/index.es.js in vanilla mode
  ✓ wrote pouchdb-selector-core/lib/index.js in vanilla mode
  ✓ wrote pouchdb-selector-core/lib/index.es.js in vanilla mode
  ✓ wrote sublevel-pouchdb/lib/index.js in vanilla mode
  ✓ wrote sublevel-pouchdb/lib/index.es.js in vanilla mode
  ✓ wrote pouchdb-mapreduce/lib/index-browser.js in browser mode
  ✓ wrote pouchdb-mapreduce/lib/index-browser.es.js in browser mode
  ✓ wrote pouchdb-replication/lib/index.js in vanilla mode
  ✓ wrote pouchdb-replication/lib/index.es.js in vanilla mode
  ✓ wrote pouchdb-mapreduce/lib/index.js in node mode
  ✓ wrote pouchdb-mapreduce/lib/index.es.js in node mode
  ✓ wrote pouchdb-core/lib/index.js in vanilla mode
  ✓ wrote pouchdb-core/lib/index.es.js in vanilla mode
  ✓ wrote pouchdb-find/lib/index.js in node mode
  ✓ wrote pouchdb-find/lib/index.es.js in node mode
  ✓ wrote pouchdb-find/lib/index-browser.js in browser mode
  ✓ wrote pouchdb-find/lib/index-browser.es.js in browser mode
  ✓ wrote pouchdb-for-coverage/lib/index.js in node mode
  ✓ wrote pouchdb-for-coverage/lib/index.es.js in node mode
  ✓ wrote pouchdb-for-coverage/lib/index-browser.js in browser mode
  ✓ wrote pouchdb-for-coverage/lib/index-browser.es.js in browser mode
  ✓ wrote pouchdb-browser/lib/index.js in vanilla mode
  ✓ wrote pouchdb-browser/lib/index.es.js in vanilla mode
  ✓ wrote pouchdb-node/lib/index.js in vanilla mode
  ✓ wrote pouchdb-node/lib/index.es.js in vanilla mode
  ✓ wrote packages/node_modules/pouchdb/lib/index.es.js
  ✓ wrote packages/node_modules/pouchdb/lib/index.js
Waiting for host to start ..
Host started :)
> pouchdb-monorepo@7.0.0-prerelease test-node
> bash bin/test-node.sh

Down server listening on port 3010
Seeded with: 1660146673263


  DB Setup
    ✓ PouchDB has a version
    ✓ PouchDB version matches package.json

  test.active_tasks.js
    ✓ Can add a task
    ✓ Can get tasks by id
    ✓ Can get all tasks
    ✓ Can update a task
    ✓ Can remove a task

  test.all_docs.js-http
    ✓ Testing all docs (162ms)
    ✓ Testing allDocs opts.keys (65ms)
    ✓ Testing allDocs opts.keys with skip
    ✓ Testing allDocs opts.keys with limit (46ms)
    ✓ Testing allDocs invalid opts.keys (54ms)
    ✓ Testing deleting in changes (81ms)
    ✓ Testing updating in changes (49ms)
    ✓ Testing include docs (38ms)
    ✓ Testing conflicts (51ms)
    ✓ test basic collation
    ✓ 3883 start_key end_key aliases
    ✓ test total_rows with a variety of criteria (135ms)
    ✓ test total_rows with both skip and limit (38ms)
    ✓ test limit option and total_rows
    ✓ test escaped startkey/endkey
    ✓ test "key" option
    ✓ test inclusive_end=false (62ms)
    ✓ test descending with startkey/endkey
    ✓ #3082 test wrong num results returned (248ms)
    ✓ test empty db
    ✓ test after db close
    ✓ 5793 _conflicts should not exist if no conflicts
    ✓ #6230 Test allDocs opts update_seq: false
    ✓ #6230 Test allDocs opts update_seq: true
    ✓ #6230 Test allDocs opts with update_seq missing

  test.all_docs.js-local
    ✓ Testing all docs
    ✓ Testing allDocs opts.keys
    ✓ Testing allDocs opts.keys with skip
    ✓ Testing allDocs opts.keys with limit
    ✓ Testing allDocs invalid opts.keys
    ✓ Testing deleting in changes
    ✓ Testing updating in changes
    ✓ Testing include docs
    ✓ Testing conflicts
    ✓ test basic collation
    ✓ 3883 start_key end_key aliases
    ✓ test total_rows with a variety of criteria
    ✓ test total_rows with both skip and limit
    ✓ test limit option and total_rows
    ✓ test escaped startkey/endkey
    ✓ test "key" option
    ✓ test inclusive_end=false
    ✓ test descending with startkey/endkey
    ✓ #3082 test wrong num results returned (182ms)
    ✓ test empty db
    ✓ test after db close
    ✓ test unicode ids and revs
    ✓ 5793 _conflicts should not exist if no conflicts
    ✓ #6230 Test allDocs opts update_seq: false
    ✓ #6230 Test allDocs opts update_seq: true
    ✓ #6230 Test allDocs opts with update_seq missing

  suite2 test.attachments.js-local
    ✓ 3357 Attachment names cant start with _
    ✓ 5736 warning for putAttachment without content_type
    ✓ 5736 warning for bulkDocs attachments without content_type
    ✓ fetch atts with open_revs and missing
    ✓ issue 2803 should throw 412
    ✓ issue 2803 should throw 412 part 2
    ✓ issue 2803 should throw 412 part 3
    ✓ issue 2803 should throw 412 part 4
    ✓ #2858 {binary: true} in get()
    ✓ #2858 {binary: true} in allDocs() 1
    ✓ #2858 {binary: true} in allDocs() 2
    ✓ #2858 {binary: true} in allDocs() 3
    ✓ #2858 {binary: true} in allDocs() 4
    ✓ #2858 {binary: true} in allDocs() 5
    ✓ #2858 {binary: true} in allDocs(), many atts
    ✓ #2858 {binary: true} in allDocs(), mixed atts
    ✓ #2858 {binary: true} in changes() non-live
    ✓ #2858 {binary: true} in changes() non-live, many atts
    ✓ #2858 {binary: true} in changes() non-live, mixed atts
    ✓ #2858 {binary: true} non-live changes, complete event
    ✓ #2858 {binary: true} in live changes
    ✓ #2858 {binary: true} in live changes, mixed atts
    ✓ #2858 {binary: true} in live+retry changes
    ✓ #2858 {binary: true} in live changes, attachments:false
    ✓ #2858 {binary: true} in live changes, include_docs:false
    ✓ #6736 {binary: true} in bulkGet()
    ✓ Measures length correctly after put()
    ✓ #3074 non-live changes()
    ✓ #3074 live changes()
    ✓ #3074 non-live changes(), no attachments
    ✓ #3074 live changes(), no attachments
    ✓ #3881 filter extraneous keys from _attachments
    ✓ #2771 allDocs() 1, single attachment
    ✓ #2771 allDocs() 2, many docs same att
    ✓ #2771 allDocs() 3, many docs diff atts
    ✓ #2771 allDocs() 4, mix of atts and no atts
    ✓ #2771 allDocs() 5, no atts
    ✓ #2771 allDocs() 6, no docs
    ✓ #2771 allDocs() 7, revisions and deletions
    ✓ #2771 allDocs() 8, empty attachment
    ✓ No length for non-stubs
    ✓ Test some attachments
    ✓ Test getAttachment
    ✓ Test getAttachment with stubs
    ✓ Test get() with binary:true and stubs
    ✓ Test attachments in allDocs/changes
    ✓ Test putAttachment with base64 plaintext
    ✓ Test putAttachment with invalid base64
    ✓ Test getAttachment with empty text
    ✓ Test getAttachment with normal text
    ✓ Test getAttachment with PNG
    ✓ Test getAttachment with PNG using bulkDocs
    ✓ Test getAttachment with PNG using post
    ✓ Test postAttachment with PNG then bulkDocs
    ✓ proper stub behavior
    ✓ Testing with invalid docs
    ✓ Test create attachment and doc in one go
    ✓ Test create attachment and doc in one go without callback
    ✓ Test create attachment without callback
    ✓ Test put attachment on a doc without attachments
    ✓ Test put attachment with unencoded name
    ✓ 3963 length property on stubs
    ✓ Testing with invalid rev
    ✓ Test put another attachment on a doc with attachments
    ✓ Test get with attachments: true if empty attachments
    ✓ Test delete attachment from a doc
    ✓ Test a document with a json string attachment
    ✓ Test remove doc with attachment
    ✓ Try to insert a doc with unencoded attachment
    ✓ Try to get attachment of unexistent doc
    ✓ Test synchronous putAttachment with text data
    ✓ Test synchronous putAttachment with no text data
    ✓ Test put with partial stubs
    ✓ Test put with attachments and new_edits=false
    ✓ Test getAttachment with specific rev
    ✓ Test getAttachment with diff revs and content
    ✓ Test stubs
    ✓ Try to get unexistent attachment of some doc
    ✓ putAttachment and getAttachment with plaintext
    ✓ putAttachment and getAttachment with png data
    ✓ putAttachment in new doc with base64
    ✓ #2818 - save same attachment in different revs
    ✓ #2818 - save same attachment many times in parallel
    ✓ #2818 - revisions keep attachments (no compaction)
    ✓ #2818 - doesn't throw 409 if same filename
    ✓ #3008 test correct encoding/decoding of \u0000 etc.
    ✓ putAttachment and getAttachment with big png data (92ms)
    ✓ #2709 `revpos` with putAttachment
    ✓ #2709 `revpos` with inline attachment
    ✓ #2709 `revpos` with allDocs
    ✓ #7403 {attachments: true, binary: true, include_docs: true} in allDocs with one missing doc

  suite2 test.attachments.js-http
    ✓ 3357 Attachment names cant start with _
    ✓ 5736 warning for putAttachment without content_type
    ✓ 5736 warning for bulkDocs attachments without content_type
    ✓ fetch atts with open_revs and missing
    ✓ issue 2803 should throw 412
    ✓ issue 2803 should throw 412 part 2
    ✓ issue 2803 should throw 412 part 3
    ✓ issue 2803 should throw 412 part 4
    ✓ #2858 {binary: true} in get()
    ✓ #2858 {binary: true} in allDocs() 1
    ✓ #2858 {binary: true} in allDocs() 2
    ✓ #2858 {binary: true} in allDocs() 3
    ✓ #2858 {binary: true} in allDocs() 4
    ✓ #2858 {binary: true} in allDocs() 5
    ✓ #2858 {binary: true} in allDocs(), many atts
    ✓ #2858 {binary: true} in allDocs(), mixed atts
    ✓ #2858 {binary: true} in changes() non-live
    ✓ #2858 {binary: true} in changes() non-live, many atts
    ✓ #2858 {binary: true} in changes() non-live, mixed atts
    ✓ #2858 {binary: true} non-live changes, complete event
    ✓ #2858 {binary: true} in live changes
    ✓ #2858 {binary: true} in live changes, mixed atts
    ✓ #2858 {binary: true} in live+retry changes
    ✓ #2858 {binary: true} in live changes, attachments:false
    ✓ #2858 {binary: true} in live changes, include_docs:false (49ms)
    ✓ #6736 {binary: true} in bulkGet() (38ms)
    ✓ Measures length correctly after put()
    ✓ #3074 non-live changes() (55ms)
    ✓ #3074 live changes() (46ms)
    ✓ #3074 non-live changes(), no attachments
    ✓ #3074 live changes(), no attachments
    ✓ #3881 filter extraneous keys from _attachments
    ✓ #2771 allDocs() 1, single attachment (39ms)
    ✓ #2771 allDocs() 2, many docs same att
    ✓ #2771 allDocs() 3, many docs diff atts
    ✓ #2771 allDocs() 4, mix of atts and no atts (38ms)
    ✓ #2771 allDocs() 5, no atts
    ✓ #2771 allDocs() 6, no docs
    ✓ #2771 allDocs() 7, revisions and deletions
    ✓ #2771 allDocs() 8, empty attachment
    ✓ No length for non-stubs
    ✓ Test some attachments (73ms)
    ✓ Test getAttachment
    ✓ Test getAttachment with stubs
    ✓ Test get() with binary:true and stubs
    ✓ Test attachments in allDocs/changes
    ✓ Test putAttachment with base64 plaintext
    ✓ Test putAttachment with invalid base64
    ✓ Test getAttachment with empty text
    ✓ Test getAttachment with normal text
    ✓ Test getAttachment with PNG
    ✓ Test getAttachment with PNG using bulkDocs
    ✓ Test getAttachment with PNG using post
    ✓ Test postAttachment with PNG then bulkDocs
    ✓ proper stub behavior
    ✓ Testing with invalid docs
    ✓ Test create attachment and doc in one go
    ✓ Test create attachment and doc in one go without callback
    ✓ Test create attachment without callback (39ms)
    ✓ Test put attachment on a doc without attachments
    ✓ Test put attachment with unencoded name
    ✓ 3963 length property on stubs (49ms)
    ✓ Testing with invalid rev
    ✓ Test put another attachment on a doc with attachments
    ✓ Test get with attachments: true if empty attachments
    ✓ Test delete attachment from a doc (49ms)
    ✓ Test a document with a json string attachment
    ✓ Test remove doc with attachment
    ✓ Try to insert a doc with unencoded attachment
    ✓ Try to get attachment of unexistent doc
    ✓ Test synchronous putAttachment with text data
    ✓ Test synchronous putAttachment with no text data
    ✓ Test put with partial stubs
    ✓ Test put with attachments and new_edits=false (38ms)
    ✓ Test getAttachment with specific rev (48ms)
    ✓ Test getAttachment with diff revs and content (40ms)
    ✓ Test stubs
    ✓ Try to get unexistent attachment of some doc
    ✓ putAttachment and getAttachment with plaintext
    ✓ putAttachment and getAttachment with png data
    ✓ putAttachment in new doc with base64
    ✓ #2818 - save same attachment in different revs (59ms)
    ✓ #2818 - save same attachment many times in parallel
    ✓ #2818 - revisions keep attachments (no compaction) (44ms)
    ✓ #2818 - doesn't throw 409 if same filename
    ✓ #3008 test correct encoding/decoding of \u0000 etc.
    ✓ putAttachment and getAttachment with big png data (229ms)
    ✓ #2709 `revpos` with putAttachment (42ms)
    ✓ #2709 `revpos` with inline attachment
    ✓ #2709 `revpos` with allDocs
    ✓ #7403 {attachments: true, binary: true, include_docs: true} in allDocs with one missing doc

  suite2 test.attachments.js- local:http
    ✓ Attachments replicate back and forth (111ms)
    ✓ Replicate same doc, same atts (112ms)
    ✓ Replicate same doc, same atts 2 (121ms)
    ✓ Attachments replicate (65ms)
    ✓ Attachment types replicate (51ms)
    ✓ Many many attachments replicate (183ms)
    ✓ Many many png attachments replicate (208ms)
    ✓ Multiple attachments replicate (78ms)
    - #3961 Many attachments on same doc
    ✓ Multiple attachments replicate, different docs (#2698) (78ms)
    ✓ Multiple attachments replicate, different docs png (#2698) (76ms)
    ✓ #3932 attachments with tricky revpos (130ms)
    ✓ replication with changing attachments (98ms)
    ✓ 3955 race condition in put
    ✓ #8456 bad attachment rev after replication (128ms)

  suite2 test.attachments.js- http:http
    ✓ Attachments replicate back and forth (223ms)
    ✓ Replicate same doc, same atts (180ms)
    ✓ Replicate same doc, same atts 2 (178ms)
    ✓ Attachments replicate (81ms)
    ✓ Attachment types replicate (90ms)
    ✓ Many many attachments replicate (366ms)
    ✓ Many many png attachments replicate (287ms)
    ✓ Multiple attachments replicate (124ms)
    - #3961 Many attachments on same doc
    ✓ Multiple attachments replicate, different docs (#2698) (127ms)
    ✓ Multiple attachments replicate, different docs png (#2698) (127ms)
    ✓ #3932 attachments with tricky revpos (326ms)
    ✓ replication with changing attachments (149ms)
    ✓ 3955 race condition in put
    ✓ #8456 bad attachment rev after replication (170ms)

  suite2 test.attachments.js- http:local
    ✓ Attachments replicate back and forth (106ms)
    ✓ Replicate same doc, same atts (98ms)
    ✓ Replicate same doc, same atts 2 (103ms)
    ✓ Attachments replicate (63ms)
    ✓ Attachment types replicate (51ms)
    ✓ Many many attachments replicate (142ms)
    ✓ Many many png attachments replicate (157ms)
    ✓ Multiple attachments replicate (108ms)
    - #3961 Many attachments on same doc
    ✓ Multiple attachments replicate, different docs (#2698) (69ms)
    ✓ Multiple attachments replicate, different docs png (#2698) (91ms)
    ✓ #3932 attachments with tricky revpos (157ms)
    ✓ replication with changing attachments (94ms)
    ✓ 3955 race condition in put
    ✓ #8456 bad attachment rev after replication (167ms)

  suite2 test.attachments.js- local:local
    ✓ Attachments replicate back and forth
    ✓ Replicate same doc, same atts
    ✓ Replicate same doc, same atts 2
    ✓ Attachments replicate
    ✓ Attachment types replicate
    ✓ Many many attachments replicate
    ✓ Many many png attachments replicate
    ✓ Multiple attachments replicate
    - #3961 Many attachments on same doc
    ✓ Multiple attachments replicate, different docs (#2698)
    ✓ Multiple attachments replicate, different docs png (#2698)
    ✓ #3932 attachments with tricky revpos (38ms)
    ✓ replication with changing attachments
    ✓ 3955 race condition in put
    ✓ #8456 bad attachment rev after replication

  test.basics.js-http
    ✓ Create a pouch without new keyword
    ✓ Name is accessible via instance
    ✓ 4314 Create a pouch with + in name
    ✓ Creating Pouch without name will throw
    ✓ 4314 Create a pouch with urlencoded name
    ✓ 4219 destroy a pouch
    ✓ 4339 throw useful error if method called on stale instance
    ✓ [4595] should reject xhr errors
    ✓ [4595] should emit error event on xhr error
    ✓ Add a doc
    ✓ Get invalid id
    ✓ Missing doc should contain ID in error object
    ✓ PUTed Conflicted doc should contain ID in error object
    ✓ POSTed Conflicted doc should contain ID in error object
    ✓ Add a doc with a promise
    ✓ Add a doc with opts object
    ✓ Modify a doc
    ✓ Modifying a doc that has rewritten content
    ✓ Modify a doc with a promise
    ✓ Read db id
    ✓ Read db id with promise (39ms)
    ✓ Close db
    ✓ Close db with a promise
    ✓ Read db id after closing Close
    ✓ Modify a doc with incorrect rev
    ✓ Remove doc
    ✓ Remove doc with a promise
    ✓ Remove doc with new syntax
    ✓ Remove doc with new syntax and a promise
    ✓ Doc removal leaves only stub
    ✓ Remove doc twice with specified id
    ✓ Remove doc, no callback
    ✓ Delete document without id
    ✓ Delete document with many args
    ✓ Delete document with many args, callback style
    ✓ Delete doc with id + rev + no opts
    ✓ Delete doc with id + rev + no opts, callback style
    ✓ Delete doc with doc + opts
    ✓ Delete doc with doc + opts, callback style
    ✓ Delete doc with rev in opts
    ✓ Bulk docs
    ✓ Bulk docs with a promise
    ✓ Basic checks (52ms)
    ✓ update with invalid rev
    ✓ Doc validation
    ✓ Replication fields (#2442)
    ✓ Testing issue #48 (54ms)
    ✓ Testing valid id
    ✓ Put doc without _id should fail
    ✓ Put doc with bad reserved id should fail
    ✓ update_seq persists
    ✓ deletions persists
    ✓ #4126 should not store raw Dates
    ✓ Create a db with a reserved name
    ✓ Error when document is not an object
    ✓ Test instance update_seq updates correctly
    ✓ Fail to fetch a doc after db was deleted (53ms)
    ✓ Fail to fetch a doc after db was deleted (57ms)
    ✓ Cant add docs with empty ids
    ✓ Test doc with percent in ID (62ms)
    ✓ db.info should give auto_compaction = false (#2744)
    ✓ db.info should give auto_compaction = true (#2744)
    ✓ db.info should give adapter name (#3567)
    ✓ db.info should give correct doc_count
    ✓ putting returns {ok: true}
    ✓ putting is override-able
    ✓ issue 2779, deleted docs, old revs COUCHDB-292
    ✓ issue 2888, successive deletes and writes (41ms)
    ✓ 2 invalid puts
    ✓ Docs save "null" value
    ✓ replace PouchDB.destroy() (express-pouchdb#203)
    ✓ 3968, keeps all object fields
    ✓ 4712 invalid rev for new doc generates conflict
    ✓ test info() after db close
    ✓ test get() after db close
    ✓ test close() after db close
    ✓ 7259 should have "this" keyword properly scoped
    ✓ #5471 PouchDB.plugin() should throw error if passed wrong type or empty object

  test.basics.js-local
    ✓ Create a pouch without new keyword
    ✓ Name is accessible via instance
    ✓ 4314 Create a pouch with + in name
    ✓ Creating Pouch without name will throw
    ✓ 4314 Create a pouch with urlencoded name
    ✓ 4219 destroy a pouch
    ✓ 4339 throw useful error if method called on stale instance
    ✓ [4595] should reject xhr errors
    ✓ [4595] should emit error event on xhr error
    ✓ Add a doc
    ✓ Get invalid id
    ✓ Missing doc should contain ID in error object
    ✓ PUTed Conflicted doc should contain ID in error object
    ✓ POSTed Conflicted doc should contain ID in error object
    ✓ Add a doc with a promise
    ✓ Add a doc with opts object
    ✓ Modify a doc
    ✓ Modifying a doc that has rewritten content
    ✓ Modify a doc with a promise
    ✓ Read db id
    ✓ Read db id with promise
    ✓ Close db
    ✓ Close db with a promise
    ✓ Read db id after closing Close (38ms)
    ✓ Modify a doc with incorrect rev
    ✓ Remove doc
    ✓ Remove doc with a promise
    ✓ Remove doc with new syntax
    ✓ Remove doc with new syntax and a promise
    ✓ Doc removal leaves only stub
    ✓ Remove doc twice with specified id
    ✓ Remove doc, no callback
    ✓ Delete document without id
    ✓ Delete document with many args
    ✓ Delete document with many args, callback style
    ✓ Delete doc with id + rev + no opts
    ✓ Delete doc with id + rev + no opts, callback style
    ✓ Delete doc with doc + opts
    ✓ Delete doc with doc + opts, callback style
    ✓ Delete doc with rev in opts
    ✓ Bulk docs
    ✓ Bulk docs with a promise
    ✓ Basic checks
    ✓ update with invalid rev
    ✓ Doc validation
    ✓ Replication fields (#2442)
    ✓ Allows _access field in documents (#8171)
    ✓ Testing issue #48 (53ms)
    ✓ Testing valid id
    ✓ Put doc without _id should fail
    ✓ Put doc with bad reserved id should fail
    ✓ update_seq persists (40ms)
    ✓ deletions persists
    ✓ #4126 should not store raw Dates
    ✓ Create a db with a reserved name
    ✓ Error when document is not an object
    ✓ Test instance update_seq updates correctly
    ✓ Fail to fetch a doc after db was deleted
    ✓ Fail to fetch a doc after db was deleted
    ✓ Cant add docs with empty ids
    ✓ Test doc with percent in ID
    ✓ db.info should give auto_compaction = false (#2744)
    ✓ db.info should give auto_compaction = true (#2744)
    ✓ db.info should give adapter name (#3567)
    ✓ db.info should give correct doc_count
    ✓ putting returns {ok: true}
    ✓ putting is override-able
    ✓ issue 2779, deleted docs, old revs COUCHDB-292
    ✓ issue 2888, successive deletes and writes
    ✓ 2 invalid puts
    ✓ Docs save "null" value
    ✓ replace PouchDB.destroy() (express-pouchdb#203)
    ✓ 3968, keeps all object fields
    ✓ 4712 invalid rev for new doc generates conflict
    ✓ test info() after db close
    ✓ test get() after db close
    ✓ test close() after db close
    ✓ 7259 should have "this" keyword properly scoped
    ✓ should allow unicode doc ids
    ✓ should have same blob support for 2 dbs
    ✓ 6053, PouchDB.plugin() resets defaults
    ✓ #5471 PouchDB.plugin() should throw error if passed wrong type or empty object

  test.bulk_docs.js-local
    ✓ Testing bulk docs
    ✓ #6039 test id in bulk docs for conflict
    ✓ No id in bulk docs
    ✓ No _rev and new_edits=false
    ✓ 7829 bare rev 1- with new_edits=false
    ✓ Test empty bulkDocs
    ✓ Test many bulkDocs (41ms)
    ✓ Test errors on invalid doc id
    ✓ Test two errors on invalid doc id
    ✓ No docs
    ✓ Jira 911
    ✓ Test multiple bulkdocs
    ✓ #2935 new_edits=false correct number
    ✓ #2935 new_edits=false correct number 2
    ✓ bulk docs update then delete then conflict
    ✓ bulk_docs delete then undelete
    ✓ #2935 new_edits=false with single unauthorized
    ✓ Deleting _local docs with bulkDocs
    ✓ Deleting _local docs with bulkDocs, not found
    ✓ Deleting _local docs with bulkDocs, wrong rev
    ✓ Bulk with new_edits=false
    ✓ Testing successive new_edits to the same doc
    ✓ #3062 bulkDocs with staggered seqs
    ✓ Testing successive new_edits to the same doc, different content
    ✓ Testing successive new_edits to two doc
    ✓ Deletion with new_edits=false
    ✓ Deletion with new_edits=false, no history
    ✓ Modification with new_edits=false, no history
    ✓ Deletion with new_edits=false, no history, no revisions
    ✓ Testing new_edits=false in req body
    ✓ 656 regression in handling deleted docs
    ✓ Test quotes in doc ids
    ✓ Bulk docs empty list
    ✓ handles simultaneous writes
    ✓ bulk docs input by array
    ✓ Bulk empty list
    ✓ Bulk docs not an array
    ✓ Bulk docs not an object
    ✓ Bulk docs two different revisions to same document id
    ✓ 4204 respect revs_limit (265ms)
    ✓ 2839 implement revs_limit (287ms)
    ✓ 4372 revs_limit deletes old revisions of the doc
    ✓ 4372 revs_limit with auto_compaction deletes old revisions of the doc
    ✓ 4712 invalid rev for new doc generates conflict
    ✓ 5793 bulk docs accepts _conflicts when new_edits=false

  test.bulk_docs.js-http
    ✓ Testing bulk docs
    ✓ #6039 test id in bulk docs for conflict
    ✓ No id in bulk docs
    ✓ No _rev and new_edits=false
    ✓ 7829 bare rev 1- with new_edits=false
    ✓ Test empty bulkDocs
    ✓ Test many bulkDocs (38ms)
    ✓ Test errors on invalid doc id
    ✓ Test two errors on invalid doc id
    ✓ No docs
    ✓ Jira 911
    ✓ Test multiple bulkdocs
    ✓ #2935 new_edits=false correct number
    ✓ #2935 new_edits=false correct number 2
    ✓ bulk docs update then delete then conflict
    ✓ bulk_docs delete then undelete
    ✓ #2935 new_edits=false with single unauthorized
    ✓ Deleting _local docs with bulkDocs (48ms)
    ✓ Bulk with new_edits=false
    ✓ Testing successive new_edits to the same doc
    ✓ #3062 bulkDocs with staggered seqs
    ✓ Testing successive new_edits to the same doc, different content (42ms)
    ✓ Testing successive new_edits to two doc
    ✓ Deletion with new_edits=false
    ✓ Deletion with new_edits=false, no history
    ✓ Modification with new_edits=false, no history
    ✓ Deletion with new_edits=false, no history, no revisions
    ✓ Testing new_edits=false in req body
    ✓ 656 regression in handling deleted docs
    ✓ Test quotes in doc ids
    ✓ Bulk docs empty list
    ✓ handles simultaneous writes
    ✓ bulk docs input by array (41ms)
    ✓ Bulk empty list (42ms)
    ✓ Bulk docs not an array
    ✓ Bulk docs not an object
    ✓ Bulk docs two different revisions to same document id (39ms)
    ✓ 4204 respect revs_limit (307ms)
    ✓ 2839 implement revs_limit
    ✓ 4372 revs_limit deletes old revisions of the doc
    ✓ 4372 revs_limit with auto_compaction deletes old revisions of the doc
    ✓ 4712 invalid rev for new doc generates conflict
    ✓ 5793 bulk docs accepts _conflicts when new_edits=false (64ms)

  test.bulk_get.js-http
    ✓ test bulk get with rev specified
    ✓ test bulk get with latest=true
    ✓ test bulk get with no rev specified
    ✓ _revisions is not returned by default
    ✓ #5886 bulkGet with reserved id
    ✓ _revisions is returned when specified
    ✓ _revisions is returned when specified, using implicit rev
    ✓ attachments are not included by default (48ms)
    ✓ attachments are included when specified (52ms)
    ✓ attachments are included when specified, using implicit rev

  test.bulk_get.js-local
    ✓ test bulk get with rev specified
    ✓ test bulk get with latest=true
    ✓ test bulk get with no rev specified
    ✓ _revisions is not returned by default
    ✓ #5886 bulkGet with reserved id
    ✓ _revisions is returned when specified
    ✓ _revisions is returned when specified, using implicit rev
    ✓ attachments are not included by default
    ✓ attachments are included when specified
    ✓ attachments are included when specified, using implicit rev

  test.changes.js-http
    ✓ All changes
    ✓ Changes with complete callback as param
    ✓ Promise resolved when changes cancelled
    - Live changes should clean listener when cancelled
    ✓ Changes Since
    ✓ Changes Since and limit limit 1
    ✓ Changes Since and limit limit 0
    ✓ Changes limit (39ms)
    ✓ Changes with filter not present in ddoc
    ✓ Changes with `filters` key not present in ddoc
    ✓ Changes limit and filter
    ✓ Changes with shorthand function name
    ✓ Changes with filter from nonexistent ddoc
    ✓ Changes with view not present in ddoc
    ✓ Changes with `views` key not present in ddoc
    ✓ #4451 Changes with invalid view filter
    ✓ 3356 throw inside a filter
    ✓ Changes with missing param `view` in request
    ✓ Changes limit and view instead of filter
    ✓ #3609 view option implies filter: _view
    ✓ Immediately cancel changes
    ✓ Changes with invalid ddoc view name
    ✓ Changes with invalid ddoc view name 2
    ✓ Changes with style = all_docs (60ms)
    ✓ Changes with style = all_docs and a callback for complete (56ms)
    ✓ Changes limit = 0
    ✓ Changes doc
    - Descending many changes
    ✓ live-changes
    ✓ Multiple watchers
    ✓ Continuous changes doc
    ✓ Cancel changes (331ms)
    ✓ #3579 changes firing 1 too many times (93ms)
    ✓ Kill database while listening to live changes
    ✓ #3136 style=all_docs (42ms)
    ✓ #4191 revs_diff causes endless loop
    ✓ #3136 style=all_docs & include_docs
    ✓ changes-filter with query params
    ✓ Non-live changes filter
    ✓ Non-live changes filter, descending
    ✓ #2569 Non-live doc_ids filter
    ✓ #2569 Big non-live doc_ids filter
    ✓ #2569 Live doc_ids filter
    ✓ #2569 Big live doc_ids filter (44ms)
    ✓ #2569 Non-live doc_ids filter with filter=_doc_ids
    ✓ #2569 Live doc_ids filter with filter=_doc_ids
    ✓ Changes to same doc are grouped
    ✓ Changes with conflicts are handled correctly (135ms)
    ✓ Change entry for a deleted doc (43ms)
    ✓ changes large number of docs (55ms)
    ✓ Calling db.changes({since: 'now'})
    ✓ Calling db.changes({since: 'latest'})
    ✓ Closing db does not cause a crash if changes cancelled
    ✓ fire-complete-on-cancel (102ms)
    ✓ changes are not duplicated (1026ms)
    ✓ supports return_docs=false
    ✓ should respects limit (73ms)
    ✓ doesn't throw if opts.complete is undefined
    ✓ handle individual changes in live replication (191ms)
    ✓ changes-filter without filter
    ✓ #3539 - Exception in changes is fine (42ms)
    ✓ Changes with selector
    ✓ Changes with selector, explicit filter
    ✓ Changes with selector and mismatched filter
    ✓ Changes with limit and selector

  test.changes.js-local
    ✓ All changes
    ✓ Changes with complete callback as param
    ✓ Promise resolved when changes cancelled
    - Live changes should clean listener when cancelled
    ✓ Changes Since
    ✓ Changes Since and limit limit 1
    ✓ Changes Since and limit limit 0
    ✓ Changes limit
    ✓ Changes with filter not present in ddoc
    ✓ Changes with `filters` key not present in ddoc
    ✓ Changes limit and filter
    ✓ Changes with shorthand function name
    ✓ Changes with filter from nonexistent ddoc
    ✓ Changes with view not present in ddoc
    ✓ Changes with `views` key not present in ddoc
    ✓ #4451 Changes with invalid view filter
    ✓ 3356 throw inside a filter
    ✓ Changes with missing param `view` in request
    ✓ Changes limit and view instead of filter
    ✓ #3609 view option implies filter: _view
    ✓ Immediately cancel changes
    ✓ Changes with invalid ddoc view name
    ✓ Changes with invalid ddoc view name 2
    ✓ Changes with style = all_docs
    ✓ Changes with style = all_docs and a callback for complete
    ✓ Changes limit = 0
    ✓ Changes doc
    - Descending many changes
    ✓ live-changes
    ✓ Multiple watchers
    ✓ Continuous changes doc
    ✓ Cancel changes (314ms)
    ✓ #3579 changes firing 1 too many times (65ms)
    ✓ Kill database while listening to live changes
    ✓ #3136 style=all_docs
    ✓ #4191 revs_diff causes endless loop
    ✓ #3136 style=all_docs & include_docs
    ✓ changes-filter with query params
    ✓ Non-live changes filter
    ✓ Non-live changes filter, descending
    ✓ #2569 Non-live doc_ids filter
    ✓ #2569 Big non-live doc_ids filter
    ✓ #2569 Live doc_ids filter
    ✓ #2569 Big live doc_ids filter
    ✓ #2569 Non-live doc_ids filter with filter=_doc_ids
    ✓ #2569 Live doc_ids filter with filter=_doc_ids
    ✓ Changes to same doc are grouped
    ✓ Changes with conflicts are handled correctly
    ✓ Change entry for a deleted doc
    ✓ changes large number of docs
    ✓ Calling db.changes({since: 'now'})
    ✓ Calling db.changes({since: 'latest'})
    ✓ Closing db does not cause a crash if changes cancelled
    ✓ fire-complete-on-cancel (100ms)
    ✓ changes are not duplicated (1017ms)
    ✓ supports return_docs=false
    ✓ should respects limit (74ms)
    ✓ doesn't throw if opts.complete is undefined
    ✓ handle individual changes in live replication (78ms)
    ✓ changes-filter without filter
    ✓ #3539 - Exception in changes is fine
    ✓ Changes with selector
    ✓ Changes with selector, explicit filter
    ✓ Changes with selector and mismatched filter
    ✓ Changes with limit and selector

  changes-standalone
    - Changes reports errors

  test.close.js-local
    ✓ should emit destroyed even when closed (sync)
    ✓ should emit destroyed even when closed (async)
precondition_failed: Database not open
    at Object.<anonymous> (/data/js-variants/multee/Clients/levelup/pouchdb/packages/node_modules/pouchdb/lib/index.js:614:16)
    at Module._compile (node:internal/modules/cjs/loader:1105:14)
    at Module._extensions..js (node:internal/modules/cjs/loader:1159:10)
    at Module.load (node:internal/modules/cjs/loader:981:32)
    at Module._load (node:internal/modules/cjs/loader:827:12)
    at Module.require (node:internal/modules/cjs/loader:1005:19)
    at require (node:internal/modules/cjs/helpers:102:18)
    at commonUtils.loadPouchDBForNode (/data/js-variants/multee/Clients/levelup/pouchdb/tests/common-utils.js:92:17)
    at commonUtils.loadPouchDB (/data/js-variants/multee/Clients/levelup/pouchdb/tests/common-utils.js:78:39)
    at Object.<anonymous> (/data/js-variants/multee/Clients/levelup/pouchdb/tests/integration/node.setup.js:21:28)
    at Module._compile (node:internal/modules/cjs/loader:1105:14)
    at Module._extensions..js (node:internal/modules/cjs/loader:1159:10)
    at Module.load (node:internal/modules/cjs/loader:981:32)
    at Module._load (node:internal/modules/cjs/loader:827:12)
    at Module.require (node:internal/modules/cjs/loader:1005:19)
    at require (node:internal/modules/cjs/helpers:102:18)
    at /data/js-variants/multee/Clients/levelup/pouchdb/node_modules/mocha/bin/_mocha:366:3
    at Array.forEach (<anonymous>)
    at Object.<anonymous> (/data/js-variants/multee/Clients/levelup/pouchdb/node_modules/mocha/bin/_mocha:365:10)
    at Module._compile (node:internal/modules/cjs/loader:1105:14)
    at Module._extensions..js (node:internal/modules/cjs/loader:1159:10)
    at Module.load (node:internal/modules/cjs/loader:981:32)
    at Module._load (node:internal/modules/cjs/loader:827:12)
    at Function.executeUserEntryPoint [as runMain] (node:internal/modules/run_main:77:12)
    at node:internal/main/run_main_module:17:47
    ✓ should emit closed even when destroyed (async #2)
precondition_failed: Database not open
    at Object.<anonymous> (/data/js-variants/multee/Clients/levelup/pouchdb/packages/node_modules/pouchdb/lib/index.js:614:16)
    at Module._compile (node:internal/modules/cjs/loader:1105:14)
    at Module._extensions..js (node:internal/modules/cjs/loader:1159:10)
    at Module.load (node:internal/modules/cjs/loader:981:32)
    at Module._load (node:internal/modules/cjs/loader:827:12)
    at Module.require (node:internal/modules/cjs/loader:1005:19)
    at require (node:internal/modules/cjs/helpers:102:18)
    at commonUtils.loadPouchDBForNode (/data/js-variants/multee/Clients/levelup/pouchdb/tests/common-utils.js:92:17)
    at commonUtils.loadPouchDB (/data/js-variants/multee/Clients/levelup/pouchdb/tests/common-utils.js:78:39)
    at Object.<anonymous> (/data/js-variants/multee/Clients/levelup/pouchdb/tests/integration/node.setup.js:21:28)
    at Module._compile (node:internal/modules/cjs/loader:1105:14)
    at Module._extensions..js (node:internal/modules/cjs/loader:1159:10)
    at Module.load (node:internal/modules/cjs/loader:981:32)
    at Module._load (node:internal/modules/cjs/loader:827:12)
    at Module.require (node:internal/modules/cjs/loader:1005:19)
    at require (node:internal/modules/cjs/helpers:102:18)
    at /data/js-variants/multee/Clients/levelup/pouchdb/node_modules/mocha/bin/_mocha:366:3
    at Array.forEach (<anonymous>)
    at Object.<anonymous> (/data/js-variants/multee/Clients/levelup/pouchdb/node_modules/mocha/bin/_mocha:365:10)
    at Module._compile (node:internal/modules/cjs/loader:1105:14)
    at Module._extensions..js (node:internal/modules/cjs/loader:1159:10)
    at Module.load (node:internal/modules/cjs/loader:981:32)
    at Module._load (node:internal/modules/cjs/loader:827:12)
    at Function.executeUserEntryPoint [as runMain] (node:internal/modules/run_main:77:12)
    at node:internal/main/run_main_module:17:47
    ✓ test unref for coverage
    ✓ test double unref for coverage
precondition_failed: Database not open
    at Object.<anonymous> (/data/js-variants/multee/Clients/levelup/pouchdb/packages/node_modules/pouchdb/lib/index.js:614:16)
    at Module._compile (node:internal/modules/cjs/loader:1105:14)
    at Module._extensions..js (node:internal/modules/cjs/loader:1159:10)
    at Module.load (node:internal/modules/cjs/loader:981:32)
    at Module._load (node:internal/modules/cjs/loader:827:12)
    at Module.require (node:internal/modules/cjs/loader:1005:19)
    at require (node:internal/modules/cjs/helpers:102:18)
    at commonUtils.loadPouchDBForNode (/data/js-variants/multee/Clients/levelup/pouchdb/tests/common-utils.js:92:17)
    at commonUtils.loadPouchDB (/data/js-variants/multee/Clients/levelup/pouchdb/tests/common-utils.js:78:39)
    at Object.<anonymous> (/data/js-variants/multee/Clients/levelup/pouchdb/tests/integration/node.setup.js:21:28)
    at Module._compile (node:internal/modules/cjs/loader:1105:14)
    at Module._extensions..js (node:internal/modules/cjs/loader:1159:10)
    at Module.load (node:internal/modules/cjs/loader:981:32)
    at Module._load (node:internal/modules/cjs/loader:827:12)
    at Module.require (node:internal/modules/cjs/loader:1005:19)
    at require (node:internal/modules/cjs/helpers:102:18)
    at /data/js-variants/multee/Clients/levelup/pouchdb/node_modules/mocha/bin/_mocha:366:3
    at Array.forEach (<anonymous>)
    at Object.<anonymous> (/data/js-variants/multee/Clients/levelup/pouchdb/node_modules/mocha/bin/_mocha:365:10)
    at Module._compile (node:internal/modules/cjs/loader:1105:14)
    at Module._extensions..js (node:internal/modules/cjs/loader:1159:10)
    at Module.load (node:internal/modules/cjs/loader:981:32)
    at Module._load (node:internal/modules/cjs/loader:827:12)
    at Function.executeUserEntryPoint [as runMain] (node:internal/modules/run_main:77:12)
    at node:internal/main/run_main_module:17:47
    ✓ test close-then-destroyed for coverage
************* run test done *************
